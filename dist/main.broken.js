/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(function webpackUniversalModuleDefinition(root, factory) {
	if(typeof exports === 'object' && typeof module === 'object')
		module.exports = factory();
	else if(typeof define === 'function' && define.amd)
		define("CitationExtractor", [], factory);
	else if(typeof exports === 'object')
		exports["CitationExtractor"] = factory();
	else
		root["CitationExtractor"] = factory();
})(self, () => {
return /******/ (() => { // webpackBootstrap
/******/ 	"use strict";
/******/ 	var __webpack_modules__ = ({

/***/ "./app/extract_citation.js":
/*!*********************************!*\
  !*** ./app/extract_citation.js ***!
  \*********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"getCitationFor\": () => (/* binding */ getCitationFor)\n/* harmony export */ });\n/* harmony import */ var _extension_site_ancestry_core_ancestry_extract_data_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../extension/site/ancestry/core/ancestry_extract_data.mjs */ \"./extension/site/ancestry/core/ancestry_extract_data.mjs\");\n/* harmony import */ var _extension_site_ancestry_core_ancestry_generalize_data_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../extension/site/ancestry/core/ancestry_generalize_data.mjs */ \"./extension/site/ancestry/core/ancestry_generalize_data.mjs\");\n/* harmony import */ var _extension_site_ancestry_core_ancestry_build_citation_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../extension/site/ancestry/core/ancestry_build_citation.mjs */ \"./extension/site/ancestry/core/ancestry_build_citation.mjs\");\n/* harmony import */ var _extension_base_core_options_options_database_mjs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../extension/base/core/options/options_database.mjs */ \"./extension/base/core/options/options_database.mjs\");\n/* harmony import */ var _extension_site_ancestry_browser_ancestry_fetch_mjs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../extension/site/ancestry/browser/ancestry_fetch.mjs */ \"./extension/site/ancestry/browser/ancestry_fetch.mjs\");\n/* harmony import */ var _extension_site_fg_core_fg_extract_data_mjs__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../extension/site/fg/core/fg_extract_data.mjs */ \"./extension/site/fg/core/fg_extract_data.mjs\");\n/* harmony import */ var _extension_site_fg_core_fg_generalize_data_mjs__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../extension/site/fg/core/fg_generalize_data.mjs */ \"./extension/site/fg/core/fg_generalize_data.mjs\");\n/* harmony import */ var _extension_site_fg_core_fg_build_citation_mjs__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../extension/site/fg/core/fg_build_citation.mjs */ \"./extension/site/fg/core/fg_build_citation.mjs\");\n/* harmony import */ var _extension_site_fs_core_fs_extract_data_mjs__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../extension/site/fs/core/fs_extract_data.mjs */ \"./extension/site/fs/core/fs_extract_data.mjs\");\n/* harmony import */ var _extension_site_fs_core_fs_generalize_data_mjs__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../extension/site/fs/core/fs_generalize_data.mjs */ \"./extension/site/fs/core/fs_generalize_data.mjs\");\n/* harmony import */ var _extension_site_fs_core_fs_build_citation_mjs__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../extension/site/fs/core/fs_build_citation.mjs */ \"./extension/site/fs/core/fs_build_citation.mjs\");\n/* harmony import */ var _extension_site_fs_browser_fs_content_js__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../extension/site/fs/browser/fs_content.js */ \"./extension/site/fs/browser/fs_content.js\");\n/*\r\nMIT License\r\n\r\nCopyright (c) 2022 Thomas W Shanley\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy\r\nof this software and associated documentation files (the \"Software\"), to deal\r\nin the Software without restriction, including without limitation the rights\r\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\ncopies of the Software, and to permit persons to whom the Software is\r\nfurnished to do so, subject to the following conditions:\r\n\r\nThe above copyright notice and this permission notice shall be included in all\r\ncopies or substantial portions of the Software.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\nSOFTWARE.\r\n*/\r\n\r\n// provides functional interface for selected capabilites in the extension \r\n// code when (webpack) packed as a module.\r\n\r\n\r\n\r\n\r\n// import { buildHouseholdTable } from \"../extension/base/core/table_builder.mjs\";\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//import { buildHouseholdTable } from \"../../extension/base/core/table_builder.mjs\";\r\n\r\n\r\n//async function getThisCite(doc, input, fnEx, fnGd, fnBc, fnSd) {\r\n//    input.extractedData = fnEx(doc, doc.URL);\r\n\r\n//    if (fnSd) {\r\n//        let rezult = await fnSd(input.extractedData);\r\n//        if (rezult.success) {\r\n//            input.sharingDataObj = rezult.dataObj;\r\n//        }\r\n//    }\r\n\r\n//    input.generalizedData = fnGd(input);\r\n\r\n//    console.log(\"to call buildCitation with input:\");\r\n//    console.log(input);\r\n//    let rv = fnBc(input);\r\n//    return rv;\r\n//}\r\n\r\n////////////// test out using cloned code (bleah\r\nasync function fsDoFetchLocalCopy() {\r\n    console.log('doFetch, document.location is: ' + document.location);\r\n\r\n    let fetchType = \"record\";\r\n\r\n    let fetchUrl = document.location.href;\r\n    //console.log('doFetch, fetchUrl is: ' + fetchUrl);\r\n\r\n    if (fetchUrl.indexOf(\"/search/record/results?\") != -1) {\r\n        //console.log('doFetch, looks like a search page, checking sidebar');\r\n        // this looks like a search page, see if a record is selected in sidebar\r\n        let viewRecord = document.querySelector(\"a[data-testid=viewSimilarRecordButton]\");\r\n        if (viewRecord) {\r\n            //console.log(\"found view record\");\r\n            let text = viewRecord.textContent;\r\n            let viewRecordUrl = viewRecord.getAttribute(\"href\");\r\n            if (viewRecordUrl) {\r\n                // strangely on firefox viewRecordUrl can be something like:\r\n                // /ark:/61903/1:1:J39Y-3Q6\r\n                // while on Chrome it is:\r\n                // https://www.familysearch.org/ark:/61903/1:1:J39Y-3Q6\r\n                // Recently (25 May 2022) on Chrome it looks like:\r\n                // /search/ark:/61903/1:1:QVJP-4T6V\r\n\r\n                //console.log(\"viewRecordUrl = \" + viewRecordUrl);\r\n\r\n                if (viewRecordUrl.startsWith(\"/ark:/\") || viewRecordUrl.startsWith(\"/search/ark:/\")) {\r\n                    viewRecordUrl = \"https://www.familysearch.org\" + viewRecordUrl;\r\n                }\r\n\r\n                fetchUrl = viewRecordUrl;\r\n            }\r\n        }\r\n    } else if (fetchUrl.startsWith(\"https://www.familysearch.org/tree/person/details/\")) {\r\n        let personId = fetchUrl.replace(\"https://www.familysearch.org/tree/person/details/\", \"\");\r\n        let slashOrQueryIndex = personId.search(/[/?]/);\r\n        if (slashOrQueryIndex != -1) {\r\n            personId = personId.substring(0, slashOrQueryIndex);\r\n        }\r\n\r\n        // API URL looks like this: https://api.familysearch.org/platform/tree/persons/K2F9-F5Z\r\n        if (personId) {\r\n            fetchUrl = \"https://www.familysearch.org/platform/tree/persons/\" + personId + \"?relatives\";\r\n            fetchType = \"person\";\r\n        }\r\n    }\r\n\r\n    // This seems like a recent change on FamilySearch (noticed on 25 May 2022).\r\n    // Sometimes the URL contains \"/search/\" and this stops the fetch working\r\n    if (fetchUrl.indexOf(\"www.familysearch.org/search/ark:/\") != -1) {\r\n        fetchUrl = fetchUrl.replace(\"www.familysearch.org/search/ark:/\", \"www.familysearch.org/ark:/\");\r\n    }\r\n\r\n    //console.log('doFetch, fetchUrl is: ' + fetchUrl);\r\n\r\n    let fetchOptionsHeaders = {\r\n        accept: \"application/x-gedcomx-v1+json, application/json\",\r\n        \"accept-language\": \"en\",\r\n        from: \"fsSearch.record.getGedcomX@familysearch.org\",\r\n        \"sec-fetch-dest\": \"empty\",\r\n        \"sec-fetch-mode\": \"cors\",\r\n        \"sec-fetch-site\": \"same-origin\",\r\n    };\r\n\r\n    let fetchOptions = {\r\n        headers: fetchOptionsHeaders,\r\n        referrerPolicy: \"strict-origin-when-cross-origin\",\r\n        body: null,\r\n        method: \"GET\",\r\n        mode: \"cors\",\r\n        credentials: \"include\",\r\n    };\r\n\r\n    try {\r\n        let response = await fetch(fetchUrl, fetchOptions);\r\n\r\n        //console.log('doFetch, response.status is: ' + response.status);\r\n\r\n        if (response.status !== 200) {\r\n            console.log(\"Looks like there was a problem. Status Code: \" + response.status);\r\n            return {\r\n                success: false,\r\n                errorCondition: \"FetchError\",\r\n                status: response.status,\r\n            };\r\n        }\r\n\r\n        let jsonData = await response.text();\r\n\r\n        //console.log(\"doFetch: response text is:\");\r\n        //console.log(jsonData);\r\n\r\n        if (!jsonData || jsonData[0] != `{`) {\r\n            console.log(\"The response text does not look like JSON\");\r\n            //console.log(jsonData);\r\n            return { success: false, errorCondition: \"NotJSON\" };\r\n        }\r\n\r\n        const dataObj = JSON.parse(jsonData);\r\n\r\n        //console.log(\"dataObj is:\");\r\n        //console.log(dataObj);\r\n\r\n        return { success: true, dataObj: dataObj, fetchType: fetchType };\r\n    } catch (error) {\r\n        console.log(\"fetch failed, error is:\");\r\n        console.log(error);\r\n        return { success: false };\r\n    }\r\n}\r\n////////////// test out using cloned code (bleah\r\n\r\n\r\n\r\n\r\n// this serves for operations that use the two-arg\r\n// extractData() function for the site\r\n// including ancestry where it will also do sharing data\r\nasync function execExtractData(doc, input, fnEx, fnSd) {\r\n    input.extractedData = fnEx(doc, doc.URL);\r\n\r\n    if (fnSd) {\r\n        let rezult = await fnSd(input.extractedData);\r\n        if (rezult.success) {\r\n            input.sharingDataObj = rezult.dataObj;\r\n        }\r\n    }\r\n}\r\n\r\n// this serves for all sites that use standard generalize()\r\n// and buid() functions on the inoput data\r\nfunction generalizeAndBuild(input, fnGd, fnBc) {\r\n    console.log(\"generalizeAndBuild() to call generalizeData with input:\");\r\n    console.log(input);\r\n    input.generalizedData = fnGd(input);\r\n\r\n    console.log(\"generalizeAndBuild() to call buildCitation with input:\");\r\n    console.log(input);\r\n    let rv = fnBc(input);\r\n    return rv;\r\n}\r\n\r\n// if all three steps are standard this will serve\r\nasync function getThisCite(doc, input, fnEx, fnGd, fnBc, fnSd) {\r\n    await execExtractData(doc, input, fnEx, fnSd);\r\n    return generalizeAndBuild(input, fnGd, fnBc);\r\n}\r\n\r\nasync function getCitationFor(doc, options = null) {\r\n    console.log(\"Enter getCitationFor: \" + doc.URL);\r\n    if (options) {\r\n        console.log(\"options:\");\r\n        console.log(options);\r\n    }\r\n\r\n    let domain = (new URL(doc.URL));\r\n    let hostname = domain.hostname;\r\n    let path = domain.pathname;\r\n\r\n    let input = [];\r\n    input.runDate = new Date();\r\n    input.type = \"inline\";\r\n    input.options = (0,_extension_base_core_options_options_database_mjs__WEBPACK_IMPORTED_MODULE_3__.getDefaultOptions)();\r\n    if (options) {\r\n        // apply the option overrides\r\n        for (var i = 0; i < options.length; i += 2) {\r\n            if (options[i] === \"type\")\r\n                input.type = options[i + 1];\r\n            else\r\n                input.options[options[i]] = options[i + 1];\r\n        }\r\n    }\r\n\r\n    let rv = {url: doc.URL, message: \"unrecognized hostname \" + hostname, citation: null};\r\n    //let rv[\"message\"] = \"unrecognized hostname \" + hostname;\r\n\r\n    let citationObject = null;\r\n    if (hostname.includes(\"ancestry.\")) {\r\n        citationObject = await getThisCite(doc, input, _extension_site_ancestry_core_ancestry_extract_data_mjs__WEBPACK_IMPORTED_MODULE_0__.extractData, _extension_site_ancestry_core_ancestry_generalize_data_mjs__WEBPACK_IMPORTED_MODULE_1__.generalizeData, _extension_site_ancestry_core_ancestry_build_citation_mjs__WEBPACK_IMPORTED_MODULE_2__.buildCitation, _extension_site_ancestry_browser_ancestry_fetch_mjs__WEBPACK_IMPORTED_MODULE_4__.fetchAncestrySharingDataObj);\r\n    } else if (hostname.includes(\"findagrave.\")) {\r\n        citationObject = await getThisCite(doc, input, _extension_site_fg_core_fg_extract_data_mjs__WEBPACK_IMPORTED_MODULE_5__.extractData, _extension_site_fg_core_fg_generalize_data_mjs__WEBPACK_IMPORTED_MODULE_6__.generalizeData, _extension_site_fg_core_fg_build_citation_mjs__WEBPACK_IMPORTED_MODULE_7__.buildCitation, null);\r\n    } else if (hostname.includes(\"familysearch.org\")) {\r\n        if (path.startsWith(\"/ark:/61903/3:1:\")) {\r\n            console.log(\"familysearch image\");\r\n            citationObject = await getThisCite(doc, input, _extension_site_fs_core_fs_extract_data_mjs__WEBPACK_IMPORTED_MODULE_8__.extractData, _extension_site_fs_core_fs_generalize_data_mjs__WEBPACK_IMPORTED_MODULE_9__.generalizeData, _extension_site_fs_core_fs_build_citation_mjs__WEBPACK_IMPORTED_MODULE_10__.buildCitation, null);\r\n        } else if (path.startsWith(\"/ark:/61903/1:1:\")) {\r\n            console.log(\"familysearch record\");\r\n            // todo: NO NO NO not the same call signature! whut?\r\n            //function extractDataFromFetch(document, dataObj, fetchType, options) {}\r\n            //     return { success: true, dataObj: dataObj, fetchType: fetchType };\r\n            let fetchResult = await (0,_extension_site_fs_browser_fs_content_js__WEBPACK_IMPORTED_MODULE_11__.doFetch)();\r\n            if (!fetchResult.success) {\r\n                console.log(\"familysearch doFetch failed\");\r\n                rv.message += \"; fetch failed\";\r\n                return rv;\r\n            }\r\n            console.log(\"result from doFetch:\");\r\n            console.log(fetchResult);\r\n            //input.pageType = fetchResult.fetchType; // ????\r\n            input.extractedData = (0,_extension_site_fs_core_fs_extract_data_mjs__WEBPACK_IMPORTED_MODULE_8__.extractDataFromFetch)(doc, fetchResult.dataObj, fetchResult.fetchType, options);\r\n            console.log(\"extractedData from fsFetchEx:\");\r\n            console.log(input.extractedData);\r\n            citationObject = generalizeAndBuild(input, _extension_site_fs_core_fs_generalize_data_mjs__WEBPACK_IMPORTED_MODULE_9__.generalizeData, _extension_site_fs_core_fs_build_citation_mjs__WEBPACK_IMPORTED_MODULE_10__.buildCitation);\r\n        }\r\n    }\r\n\r\n    if (citationObject == null) {\r\n        console.log(rv.message);\r\n        return rv;\r\n    }\r\n\r\n    rv.citation = citationObject.citation;\r\n    rv.message = \"returning citation of type: \" + citationObject.type;\r\n    console.log(\"getCitationFor returns:\");\r\n    console.log(rv);\r\n    return rv;\r\n}\r\n\r\n\r\n\r\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vQ2l0YXRpb25FeHRyYWN0b3IvLi9hcHAvZXh0cmFjdF9jaXRhdGlvbi5qcz82MzEzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qXHJcbk1JVCBMaWNlbnNlXHJcblxyXG5Db3B5cmlnaHQgKGMpIDIwMjIgVGhvbWFzIFcgU2hhbmxleVxyXG5cclxuUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEgY29weVxyXG5vZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSBcIlNvZnR3YXJlXCIpLCB0byBkZWFsXHJcbmluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHNcclxudG8gdXNlLCBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLCBkaXN0cmlidXRlLCBzdWJsaWNlbnNlLCBhbmQvb3Igc2VsbFxyXG5jb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXNcclxuZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczpcclxuXHJcblRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkIGluIGFsbFxyXG5jb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLlxyXG5cclxuVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEIFwiQVMgSVNcIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUlxyXG5JTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSxcclxuRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFXHJcbkFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVJcclxuTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSxcclxuT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTiBUSEVcclxuU09GVFdBUkUuXHJcbiovXHJcblxyXG4vLyBwcm92aWRlcyBmdW5jdGlvbmFsIGludGVyZmFjZSBmb3Igc2VsZWN0ZWQgY2FwYWJpbGl0ZXMgaW4gdGhlIGV4dGVuc2lvbiBcclxuLy8gY29kZSB3aGVuICh3ZWJwYWNrKSBwYWNrZWQgYXMgYSBtb2R1bGUuXHJcblxyXG5pbXBvcnQgeyBleHRyYWN0RGF0YSBhcyBhbmNFeCB9IGZyb20gXCIuLi9leHRlbnNpb24vc2l0ZS9hbmNlc3RyeS9jb3JlL2FuY2VzdHJ5X2V4dHJhY3RfZGF0YS5tanNcIjtcclxuaW1wb3J0IHsgZ2VuZXJhbGl6ZURhdGEgYXMgYW5jR2QgfSBmcm9tIFwiLi4vZXh0ZW5zaW9uL3NpdGUvYW5jZXN0cnkvY29yZS9hbmNlc3RyeV9nZW5lcmFsaXplX2RhdGEubWpzXCI7XHJcbmltcG9ydCB7IGJ1aWxkQ2l0YXRpb24gYXMgYW5jQmMgfSBmcm9tIFwiLi4vZXh0ZW5zaW9uL3NpdGUvYW5jZXN0cnkvY29yZS9hbmNlc3RyeV9idWlsZF9jaXRhdGlvbi5tanNcIjtcclxuLy8gaW1wb3J0IHsgYnVpbGRIb3VzZWhvbGRUYWJsZSB9IGZyb20gXCIuLi9leHRlbnNpb24vYmFzZS9jb3JlL3RhYmxlX2J1aWxkZXIubWpzXCI7XHJcbmltcG9ydCB7IGdldERlZmF1bHRPcHRpb25zIH0gZnJvbSBcIi4uL2V4dGVuc2lvbi9iYXNlL2NvcmUvb3B0aW9ucy9vcHRpb25zX2RhdGFiYXNlLm1qc1wiO1xyXG5pbXBvcnQgeyBmZXRjaEFuY2VzdHJ5U2hhcmluZ0RhdGFPYmogfSBmcm9tIFwiLi4vZXh0ZW5zaW9uL3NpdGUvYW5jZXN0cnkvYnJvd3Nlci9hbmNlc3RyeV9mZXRjaC5tanNcIjtcclxuXHJcbmltcG9ydCB7IGV4dHJhY3REYXRhIGFzIGZnRXggfSBmcm9tIFwiLi4vZXh0ZW5zaW9uL3NpdGUvZmcvY29yZS9mZ19leHRyYWN0X2RhdGEubWpzXCI7XHJcbmltcG9ydCB7IGdlbmVyYWxpemVEYXRhIGFzIGZnR2QgfSBmcm9tIFwiLi4vZXh0ZW5zaW9uL3NpdGUvZmcvY29yZS9mZ19nZW5lcmFsaXplX2RhdGEubWpzXCI7XHJcbmltcG9ydCB7IGJ1aWxkQ2l0YXRpb24gYXMgZmdCYyB9IGZyb20gXCIuLi9leHRlbnNpb24vc2l0ZS9mZy9jb3JlL2ZnX2J1aWxkX2NpdGF0aW9uLm1qc1wiO1xyXG5cclxuaW1wb3J0IHsgZXh0cmFjdERhdGFGcm9tRmV0Y2ggYXMgZnNFeEZldGNoLCBleHRyYWN0RGF0YSBhcyBmc0V4IH0gZnJvbSBcIi4uL2V4dGVuc2lvbi9zaXRlL2ZzL2NvcmUvZnNfZXh0cmFjdF9kYXRhLm1qc1wiO1xyXG5pbXBvcnQgeyBnZW5lcmFsaXplRGF0YSBhcyBmc0dkIH0gZnJvbSBcIi4uL2V4dGVuc2lvbi9zaXRlL2ZzL2NvcmUvZnNfZ2VuZXJhbGl6ZV9kYXRhLm1qc1wiO1xyXG5pbXBvcnQgeyBidWlsZENpdGF0aW9uIGFzIGZzQmN9IGZyb20gXCIuLi9leHRlbnNpb24vc2l0ZS9mcy9jb3JlL2ZzX2J1aWxkX2NpdGF0aW9uLm1qc1wiO1xyXG5pbXBvcnQgeyBkb0ZldGNoIGFzIGZzRG9GZXRjaCB9IGZyb20gXCIuLi9leHRlbnNpb24vc2l0ZS9mcy9icm93c2VyL2ZzX2NvbnRlbnQuanNcIjtcclxuLy9pbXBvcnQgeyBidWlsZEhvdXNlaG9sZFRhYmxlIH0gZnJvbSBcIi4uLy4uL2V4dGVuc2lvbi9iYXNlL2NvcmUvdGFibGVfYnVpbGRlci5tanNcIjtcclxuXHJcblxyXG4vL2FzeW5jIGZ1bmN0aW9uIGdldFRoaXNDaXRlKGRvYywgaW5wdXQsIGZuRXgsIGZuR2QsIGZuQmMsIGZuU2QpIHtcclxuLy8gICAgaW5wdXQuZXh0cmFjdGVkRGF0YSA9IGZuRXgoZG9jLCBkb2MuVVJMKTtcclxuXHJcbi8vICAgIGlmIChmblNkKSB7XHJcbi8vICAgICAgICBsZXQgcmV6dWx0ID0gYXdhaXQgZm5TZChpbnB1dC5leHRyYWN0ZWREYXRhKTtcclxuLy8gICAgICAgIGlmIChyZXp1bHQuc3VjY2Vzcykge1xyXG4vLyAgICAgICAgICAgIGlucHV0LnNoYXJpbmdEYXRhT2JqID0gcmV6dWx0LmRhdGFPYmo7XHJcbi8vICAgICAgICB9XHJcbi8vICAgIH1cclxuXHJcbi8vICAgIGlucHV0LmdlbmVyYWxpemVkRGF0YSA9IGZuR2QoaW5wdXQpO1xyXG5cclxuLy8gICAgY29uc29sZS5sb2coXCJ0byBjYWxsIGJ1aWxkQ2l0YXRpb24gd2l0aCBpbnB1dDpcIik7XHJcbi8vICAgIGNvbnNvbGUubG9nKGlucHV0KTtcclxuLy8gICAgbGV0IHJ2ID0gZm5CYyhpbnB1dCk7XHJcbi8vICAgIHJldHVybiBydjtcclxuLy99XHJcblxyXG4vLy8vLy8vLy8vLy8vLyB0ZXN0IG91dCB1c2luZyBjbG9uZWQgY29kZSAoYmxlYWhcclxuYXN5bmMgZnVuY3Rpb24gZnNEb0ZldGNoTG9jYWxDb3B5KCkge1xyXG4gICAgY29uc29sZS5sb2coJ2RvRmV0Y2gsIGRvY3VtZW50LmxvY2F0aW9uIGlzOiAnICsgZG9jdW1lbnQubG9jYXRpb24pO1xyXG5cclxuICAgIGxldCBmZXRjaFR5cGUgPSBcInJlY29yZFwiO1xyXG5cclxuICAgIGxldCBmZXRjaFVybCA9IGRvY3VtZW50LmxvY2F0aW9uLmhyZWY7XHJcbiAgICAvL2NvbnNvbGUubG9nKCdkb0ZldGNoLCBmZXRjaFVybCBpczogJyArIGZldGNoVXJsKTtcclxuXHJcbiAgICBpZiAoZmV0Y2hVcmwuaW5kZXhPZihcIi9zZWFyY2gvcmVjb3JkL3Jlc3VsdHM/XCIpICE9IC0xKSB7XHJcbiAgICAgICAgLy9jb25zb2xlLmxvZygnZG9GZXRjaCwgbG9va3MgbGlrZSBhIHNlYXJjaCBwYWdlLCBjaGVja2luZyBzaWRlYmFyJyk7XHJcbiAgICAgICAgLy8gdGhpcyBsb29rcyBsaWtlIGEgc2VhcmNoIHBhZ2UsIHNlZSBpZiBhIHJlY29yZCBpcyBzZWxlY3RlZCBpbiBzaWRlYmFyXHJcbiAgICAgICAgbGV0IHZpZXdSZWNvcmQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiYVtkYXRhLXRlc3RpZD12aWV3U2ltaWxhclJlY29yZEJ1dHRvbl1cIik7XHJcbiAgICAgICAgaWYgKHZpZXdSZWNvcmQpIHtcclxuICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhcImZvdW5kIHZpZXcgcmVjb3JkXCIpO1xyXG4gICAgICAgICAgICBsZXQgdGV4dCA9IHZpZXdSZWNvcmQudGV4dENvbnRlbnQ7XHJcbiAgICAgICAgICAgIGxldCB2aWV3UmVjb3JkVXJsID0gdmlld1JlY29yZC5nZXRBdHRyaWJ1dGUoXCJocmVmXCIpO1xyXG4gICAgICAgICAgICBpZiAodmlld1JlY29yZFVybCkge1xyXG4gICAgICAgICAgICAgICAgLy8gc3RyYW5nZWx5IG9uIGZpcmVmb3ggdmlld1JlY29yZFVybCBjYW4gYmUgc29tZXRoaW5nIGxpa2U6XHJcbiAgICAgICAgICAgICAgICAvLyAvYXJrOi82MTkwMy8xOjE6SjM5WS0zUTZcclxuICAgICAgICAgICAgICAgIC8vIHdoaWxlIG9uIENocm9tZSBpdCBpczpcclxuICAgICAgICAgICAgICAgIC8vIGh0dHBzOi8vd3d3LmZhbWlseXNlYXJjaC5vcmcvYXJrOi82MTkwMy8xOjE6SjM5WS0zUTZcclxuICAgICAgICAgICAgICAgIC8vIFJlY2VudGx5ICgyNSBNYXkgMjAyMikgb24gQ2hyb21lIGl0IGxvb2tzIGxpa2U6XHJcbiAgICAgICAgICAgICAgICAvLyAvc2VhcmNoL2FyazovNjE5MDMvMToxOlFWSlAtNFQ2VlxyXG5cclxuICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coXCJ2aWV3UmVjb3JkVXJsID0gXCIgKyB2aWV3UmVjb3JkVXJsKTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAodmlld1JlY29yZFVybC5zdGFydHNXaXRoKFwiL2FyazovXCIpIHx8IHZpZXdSZWNvcmRVcmwuc3RhcnRzV2l0aChcIi9zZWFyY2gvYXJrOi9cIikpIHtcclxuICAgICAgICAgICAgICAgICAgICB2aWV3UmVjb3JkVXJsID0gXCJodHRwczovL3d3dy5mYW1pbHlzZWFyY2gub3JnXCIgKyB2aWV3UmVjb3JkVXJsO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGZldGNoVXJsID0gdmlld1JlY29yZFVybDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH0gZWxzZSBpZiAoZmV0Y2hVcmwuc3RhcnRzV2l0aChcImh0dHBzOi8vd3d3LmZhbWlseXNlYXJjaC5vcmcvdHJlZS9wZXJzb24vZGV0YWlscy9cIikpIHtcclxuICAgICAgICBsZXQgcGVyc29uSWQgPSBmZXRjaFVybC5yZXBsYWNlKFwiaHR0cHM6Ly93d3cuZmFtaWx5c2VhcmNoLm9yZy90cmVlL3BlcnNvbi9kZXRhaWxzL1wiLCBcIlwiKTtcclxuICAgICAgICBsZXQgc2xhc2hPclF1ZXJ5SW5kZXggPSBwZXJzb25JZC5zZWFyY2goL1svP10vKTtcclxuICAgICAgICBpZiAoc2xhc2hPclF1ZXJ5SW5kZXggIT0gLTEpIHtcclxuICAgICAgICAgICAgcGVyc29uSWQgPSBwZXJzb25JZC5zdWJzdHJpbmcoMCwgc2xhc2hPclF1ZXJ5SW5kZXgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gQVBJIFVSTCBsb29rcyBsaWtlIHRoaXM6IGh0dHBzOi8vYXBpLmZhbWlseXNlYXJjaC5vcmcvcGxhdGZvcm0vdHJlZS9wZXJzb25zL0syRjktRjVaXHJcbiAgICAgICAgaWYgKHBlcnNvbklkKSB7XHJcbiAgICAgICAgICAgIGZldGNoVXJsID0gXCJodHRwczovL3d3dy5mYW1pbHlzZWFyY2gub3JnL3BsYXRmb3JtL3RyZWUvcGVyc29ucy9cIiArIHBlcnNvbklkICsgXCI/cmVsYXRpdmVzXCI7XHJcbiAgICAgICAgICAgIGZldGNoVHlwZSA9IFwicGVyc29uXCI7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIFRoaXMgc2VlbXMgbGlrZSBhIHJlY2VudCBjaGFuZ2Ugb24gRmFtaWx5U2VhcmNoIChub3RpY2VkIG9uIDI1IE1heSAyMDIyKS5cclxuICAgIC8vIFNvbWV0aW1lcyB0aGUgVVJMIGNvbnRhaW5zIFwiL3NlYXJjaC9cIiBhbmQgdGhpcyBzdG9wcyB0aGUgZmV0Y2ggd29ya2luZ1xyXG4gICAgaWYgKGZldGNoVXJsLmluZGV4T2YoXCJ3d3cuZmFtaWx5c2VhcmNoLm9yZy9zZWFyY2gvYXJrOi9cIikgIT0gLTEpIHtcclxuICAgICAgICBmZXRjaFVybCA9IGZldGNoVXJsLnJlcGxhY2UoXCJ3d3cuZmFtaWx5c2VhcmNoLm9yZy9zZWFyY2gvYXJrOi9cIiwgXCJ3d3cuZmFtaWx5c2VhcmNoLm9yZy9hcms6L1wiKTtcclxuICAgIH1cclxuXHJcbiAgICAvL2NvbnNvbGUubG9nKCdkb0ZldGNoLCBmZXRjaFVybCBpczogJyArIGZldGNoVXJsKTtcclxuXHJcbiAgICBsZXQgZmV0Y2hPcHRpb25zSGVhZGVycyA9IHtcclxuICAgICAgICBhY2NlcHQ6IFwiYXBwbGljYXRpb24veC1nZWRjb214LXYxK2pzb24sIGFwcGxpY2F0aW9uL2pzb25cIixcclxuICAgICAgICBcImFjY2VwdC1sYW5ndWFnZVwiOiBcImVuXCIsXHJcbiAgICAgICAgZnJvbTogXCJmc1NlYXJjaC5yZWNvcmQuZ2V0R2VkY29tWEBmYW1pbHlzZWFyY2gub3JnXCIsXHJcbiAgICAgICAgXCJzZWMtZmV0Y2gtZGVzdFwiOiBcImVtcHR5XCIsXHJcbiAgICAgICAgXCJzZWMtZmV0Y2gtbW9kZVwiOiBcImNvcnNcIixcclxuICAgICAgICBcInNlYy1mZXRjaC1zaXRlXCI6IFwic2FtZS1vcmlnaW5cIixcclxuICAgIH07XHJcblxyXG4gICAgbGV0IGZldGNoT3B0aW9ucyA9IHtcclxuICAgICAgICBoZWFkZXJzOiBmZXRjaE9wdGlvbnNIZWFkZXJzLFxyXG4gICAgICAgIHJlZmVycmVyUG9saWN5OiBcInN0cmljdC1vcmlnaW4td2hlbi1jcm9zcy1vcmlnaW5cIixcclxuICAgICAgICBib2R5OiBudWxsLFxyXG4gICAgICAgIG1ldGhvZDogXCJHRVRcIixcclxuICAgICAgICBtb2RlOiBcImNvcnNcIixcclxuICAgICAgICBjcmVkZW50aWFsczogXCJpbmNsdWRlXCIsXHJcbiAgICB9O1xyXG5cclxuICAgIHRyeSB7XHJcbiAgICAgICAgbGV0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goZmV0Y2hVcmwsIGZldGNoT3B0aW9ucyk7XHJcblxyXG4gICAgICAgIC8vY29uc29sZS5sb2coJ2RvRmV0Y2gsIHJlc3BvbnNlLnN0YXR1cyBpczogJyArIHJlc3BvbnNlLnN0YXR1cyk7XHJcblxyXG4gICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgIT09IDIwMCkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIkxvb2tzIGxpa2UgdGhlcmUgd2FzIGEgcHJvYmxlbS4gU3RhdHVzIENvZGU6IFwiICsgcmVzcG9uc2Uuc3RhdHVzKTtcclxuICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgICAgICAgZXJyb3JDb25kaXRpb246IFwiRmV0Y2hFcnJvclwiLFxyXG4gICAgICAgICAgICAgICAgc3RhdHVzOiByZXNwb25zZS5zdGF0dXMsXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBsZXQganNvbkRhdGEgPSBhd2FpdCByZXNwb25zZS50ZXh0KCk7XHJcblxyXG4gICAgICAgIC8vY29uc29sZS5sb2coXCJkb0ZldGNoOiByZXNwb25zZSB0ZXh0IGlzOlwiKTtcclxuICAgICAgICAvL2NvbnNvbGUubG9nKGpzb25EYXRhKTtcclxuXHJcbiAgICAgICAgaWYgKCFqc29uRGF0YSB8fCBqc29uRGF0YVswXSAhPSBge2ApIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coXCJUaGUgcmVzcG9uc2UgdGV4dCBkb2VzIG5vdCBsb29rIGxpa2UgSlNPTlwiKTtcclxuICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhqc29uRGF0YSk7XHJcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvckNvbmRpdGlvbjogXCJOb3RKU09OXCIgfTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IGRhdGFPYmogPSBKU09OLnBhcnNlKGpzb25EYXRhKTtcclxuXHJcbiAgICAgICAgLy9jb25zb2xlLmxvZyhcImRhdGFPYmogaXM6XCIpO1xyXG4gICAgICAgIC8vY29uc29sZS5sb2coZGF0YU9iaik7XHJcblxyXG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIGRhdGFPYmo6IGRhdGFPYmosIGZldGNoVHlwZTogZmV0Y2hUeXBlIH07XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKFwiZmV0Y2ggZmFpbGVkLCBlcnJvciBpczpcIik7XHJcbiAgICAgICAgY29uc29sZS5sb2coZXJyb3IpO1xyXG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlIH07XHJcbiAgICB9XHJcbn1cclxuLy8vLy8vLy8vLy8vLy8gdGVzdCBvdXQgdXNpbmcgY2xvbmVkIGNvZGUgKGJsZWFoXHJcblxyXG5cclxuXHJcblxyXG4vLyB0aGlzIHNlcnZlcyBmb3Igb3BlcmF0aW9ucyB0aGF0IHVzZSB0aGUgdHdvLWFyZ1xyXG4vLyBleHRyYWN0RGF0YSgpIGZ1bmN0aW9uIGZvciB0aGUgc2l0ZVxyXG4vLyBpbmNsdWRpbmcgYW5jZXN0cnkgd2hlcmUgaXQgd2lsbCBhbHNvIGRvIHNoYXJpbmcgZGF0YVxyXG5hc3luYyBmdW5jdGlvbiBleGVjRXh0cmFjdERhdGEoZG9jLCBpbnB1dCwgZm5FeCwgZm5TZCkge1xyXG4gICAgaW5wdXQuZXh0cmFjdGVkRGF0YSA9IGZuRXgoZG9jLCBkb2MuVVJMKTtcclxuXHJcbiAgICBpZiAoZm5TZCkge1xyXG4gICAgICAgIGxldCByZXp1bHQgPSBhd2FpdCBmblNkKGlucHV0LmV4dHJhY3RlZERhdGEpO1xyXG4gICAgICAgIGlmIChyZXp1bHQuc3VjY2Vzcykge1xyXG4gICAgICAgICAgICBpbnB1dC5zaGFyaW5nRGF0YU9iaiA9IHJlenVsdC5kYXRhT2JqO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG5cclxuLy8gdGhpcyBzZXJ2ZXMgZm9yIGFsbCBzaXRlcyB0aGF0IHVzZSBzdGFuZGFyZCBnZW5lcmFsaXplKClcclxuLy8gYW5kIGJ1aWQoKSBmdW5jdGlvbnMgb24gdGhlIGlub3B1dCBkYXRhXHJcbmZ1bmN0aW9uIGdlbmVyYWxpemVBbmRCdWlsZChpbnB1dCwgZm5HZCwgZm5CYykge1xyXG4gICAgY29uc29sZS5sb2coXCJnZW5lcmFsaXplQW5kQnVpbGQoKSB0byBjYWxsIGdlbmVyYWxpemVEYXRhIHdpdGggaW5wdXQ6XCIpO1xyXG4gICAgY29uc29sZS5sb2coaW5wdXQpO1xyXG4gICAgaW5wdXQuZ2VuZXJhbGl6ZWREYXRhID0gZm5HZChpbnB1dCk7XHJcblxyXG4gICAgY29uc29sZS5sb2coXCJnZW5lcmFsaXplQW5kQnVpbGQoKSB0byBjYWxsIGJ1aWxkQ2l0YXRpb24gd2l0aCBpbnB1dDpcIik7XHJcbiAgICBjb25zb2xlLmxvZyhpbnB1dCk7XHJcbiAgICBsZXQgcnYgPSBmbkJjKGlucHV0KTtcclxuICAgIHJldHVybiBydjtcclxufVxyXG5cclxuLy8gaWYgYWxsIHRocmVlIHN0ZXBzIGFyZSBzdGFuZGFyZCB0aGlzIHdpbGwgc2VydmVcclxuYXN5bmMgZnVuY3Rpb24gZ2V0VGhpc0NpdGUoZG9jLCBpbnB1dCwgZm5FeCwgZm5HZCwgZm5CYywgZm5TZCkge1xyXG4gICAgYXdhaXQgZXhlY0V4dHJhY3REYXRhKGRvYywgaW5wdXQsIGZuRXgsIGZuU2QpO1xyXG4gICAgcmV0dXJuIGdlbmVyYWxpemVBbmRCdWlsZChpbnB1dCwgZm5HZCwgZm5CYyk7XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRDaXRhdGlvbkZvcihkb2MsIG9wdGlvbnMgPSBudWxsKSB7XHJcbiAgICBjb25zb2xlLmxvZyhcIkVudGVyIGdldENpdGF0aW9uRm9yOiBcIiArIGRvYy5VUkwpO1xyXG4gICAgaWYgKG9wdGlvbnMpIHtcclxuICAgICAgICBjb25zb2xlLmxvZyhcIm9wdGlvbnM6XCIpO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKG9wdGlvbnMpO1xyXG4gICAgfVxyXG5cclxuICAgIGxldCBkb21haW4gPSAobmV3IFVSTChkb2MuVVJMKSk7XHJcbiAgICBsZXQgaG9zdG5hbWUgPSBkb21haW4uaG9zdG5hbWU7XHJcbiAgICBsZXQgcGF0aCA9IGRvbWFpbi5wYXRobmFtZTtcclxuXHJcbiAgICBsZXQgaW5wdXQgPSBbXTtcclxuICAgIGlucHV0LnJ1bkRhdGUgPSBuZXcgRGF0ZSgpO1xyXG4gICAgaW5wdXQudHlwZSA9IFwiaW5saW5lXCI7XHJcbiAgICBpbnB1dC5vcHRpb25zID0gZ2V0RGVmYXVsdE9wdGlvbnMoKTtcclxuICAgIGlmIChvcHRpb25zKSB7XHJcbiAgICAgICAgLy8gYXBwbHkgdGhlIG9wdGlvbiBvdmVycmlkZXNcclxuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG9wdGlvbnMubGVuZ3RoOyBpICs9IDIpIHtcclxuICAgICAgICAgICAgaWYgKG9wdGlvbnNbaV0gPT09IFwidHlwZVwiKVxyXG4gICAgICAgICAgICAgICAgaW5wdXQudHlwZSA9IG9wdGlvbnNbaSArIDFdO1xyXG4gICAgICAgICAgICBlbHNlXHJcbiAgICAgICAgICAgICAgICBpbnB1dC5vcHRpb25zW29wdGlvbnNbaV1dID0gb3B0aW9uc1tpICsgMV07XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGxldCBydiA9IHt1cmw6IGRvYy5VUkwsIG1lc3NhZ2U6IFwidW5yZWNvZ25pemVkIGhvc3RuYW1lIFwiICsgaG9zdG5hbWUsIGNpdGF0aW9uOiBudWxsfTtcclxuICAgIC8vbGV0IHJ2W1wibWVzc2FnZVwiXSA9IFwidW5yZWNvZ25pemVkIGhvc3RuYW1lIFwiICsgaG9zdG5hbWU7XHJcblxyXG4gICAgbGV0IGNpdGF0aW9uT2JqZWN0ID0gbnVsbDtcclxuICAgIGlmIChob3N0bmFtZS5pbmNsdWRlcyhcImFuY2VzdHJ5LlwiKSkge1xyXG4gICAgICAgIGNpdGF0aW9uT2JqZWN0ID0gYXdhaXQgZ2V0VGhpc0NpdGUoZG9jLCBpbnB1dCwgYW5jRXgsIGFuY0dkLCBhbmNCYywgZmV0Y2hBbmNlc3RyeVNoYXJpbmdEYXRhT2JqKTtcclxuICAgIH0gZWxzZSBpZiAoaG9zdG5hbWUuaW5jbHVkZXMoXCJmaW5kYWdyYXZlLlwiKSkge1xyXG4gICAgICAgIGNpdGF0aW9uT2JqZWN0ID0gYXdhaXQgZ2V0VGhpc0NpdGUoZG9jLCBpbnB1dCwgZmdFeCwgZmdHZCwgZmdCYywgbnVsbCk7XHJcbiAgICB9IGVsc2UgaWYgKGhvc3RuYW1lLmluY2x1ZGVzKFwiZmFtaWx5c2VhcmNoLm9yZ1wiKSkge1xyXG4gICAgICAgIGlmIChwYXRoLnN0YXJ0c1dpdGgoXCIvYXJrOi82MTkwMy8zOjE6XCIpKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiZmFtaWx5c2VhcmNoIGltYWdlXCIpO1xyXG4gICAgICAgICAgICBjaXRhdGlvbk9iamVjdCA9IGF3YWl0IGdldFRoaXNDaXRlKGRvYywgaW5wdXQsIGZzRXgsIGZzR2QsIGZzQmMsIG51bGwpO1xyXG4gICAgICAgIH0gZWxzZSBpZiAocGF0aC5zdGFydHNXaXRoKFwiL2FyazovNjE5MDMvMToxOlwiKSkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcImZhbWlseXNlYXJjaCByZWNvcmRcIik7XHJcbiAgICAgICAgICAgIC8vIHRvZG86IE5PIE5PIE5PIG5vdCB0aGUgc2FtZSBjYWxsIHNpZ25hdHVyZSEgd2h1dD9cclxuICAgICAgICAgICAgLy9mdW5jdGlvbiBleHRyYWN0RGF0YUZyb21GZXRjaChkb2N1bWVudCwgZGF0YU9iaiwgZmV0Y2hUeXBlLCBvcHRpb25zKSB7fVxyXG4gICAgICAgICAgICAvLyAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgZGF0YU9iajogZGF0YU9iaiwgZmV0Y2hUeXBlOiBmZXRjaFR5cGUgfTtcclxuICAgICAgICAgICAgbGV0IGZldGNoUmVzdWx0ID0gYXdhaXQgZnNEb0ZldGNoKCk7XHJcbiAgICAgICAgICAgIGlmICghZmV0Y2hSZXN1bHQuc3VjY2Vzcykge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJmYW1pbHlzZWFyY2ggZG9GZXRjaCBmYWlsZWRcIik7XHJcbiAgICAgICAgICAgICAgICBydi5tZXNzYWdlICs9IFwiOyBmZXRjaCBmYWlsZWRcIjtcclxuICAgICAgICAgICAgICAgIHJldHVybiBydjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcInJlc3VsdCBmcm9tIGRvRmV0Y2g6XCIpO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhmZXRjaFJlc3VsdCk7XHJcbiAgICAgICAgICAgIC8vaW5wdXQucGFnZVR5cGUgPSBmZXRjaFJlc3VsdC5mZXRjaFR5cGU7IC8vID8/Pz9cclxuICAgICAgICAgICAgaW5wdXQuZXh0cmFjdGVkRGF0YSA9IGZzRXhGZXRjaChkb2MsIGZldGNoUmVzdWx0LmRhdGFPYmosIGZldGNoUmVzdWx0LmZldGNoVHlwZSwgb3B0aW9ucyk7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiZXh0cmFjdGVkRGF0YSBmcm9tIGZzRmV0Y2hFeDpcIik7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGlucHV0LmV4dHJhY3RlZERhdGEpO1xyXG4gICAgICAgICAgICBjaXRhdGlvbk9iamVjdCA9IGdlbmVyYWxpemVBbmRCdWlsZChpbnB1dCwgZnNHZCwgZnNCYyk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGlmIChjaXRhdGlvbk9iamVjdCA9PSBudWxsKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2cocnYubWVzc2FnZSk7XHJcbiAgICAgICAgcmV0dXJuIHJ2O1xyXG4gICAgfVxyXG5cclxuICAgIHJ2LmNpdGF0aW9uID0gY2l0YXRpb25PYmplY3QuY2l0YXRpb247XHJcbiAgICBydi5tZXNzYWdlID0gXCJyZXR1cm5pbmcgY2l0YXRpb24gb2YgdHlwZTogXCIgKyBjaXRhdGlvbk9iamVjdC50eXBlO1xyXG4gICAgY29uc29sZS5sb2coXCJnZXRDaXRhdGlvbkZvciByZXR1cm5zOlwiKTtcclxuICAgIGNvbnNvbGUubG9nKHJ2KTtcclxuICAgIHJldHVybiBydjtcclxufVxyXG5cclxuXHJcblxyXG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./app/extract_citation.js\n");

/***/ }),

/***/ "./extension/site/fs/browser/fs_content.js":
/*!*************************************************!*\
  !*** ./extension/site/fs/browser/fs_content.js ***!
  \*************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"doFetch\": () => (/* binding */ doFetch)\n/* harmony export */ });\n/*\nMIT License\n\nCopyright (c) 2020 Robert M Pavey\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.\n*/\n\nasync function doFetch() {\n  console.log('doFetch, document.location is: ' + document.location);\n\n  let fetchType = \"record\";\n\n  let fetchUrl = document.location.href;\n  //console.log('doFetch, fetchUrl is: ' + fetchUrl);\n\n  if (fetchUrl.indexOf(\"/search/record/results?\") != -1) {\n    //console.log('doFetch, looks like a search page, checking sidebar');\n    // this looks like a search page, see if a record is selected in sidebar\n    let viewRecord = document.querySelector(\"a[data-testid=viewSimilarRecordButton]\");\n    if (viewRecord) {\n      //console.log(\"found view record\");\n      let text = viewRecord.textContent;\n      let viewRecordUrl = viewRecord.getAttribute(\"href\");\n      if (viewRecordUrl) {\n        // strangely on firefox viewRecordUrl can be something like:\n        // /ark:/61903/1:1:J39Y-3Q6\n        // while on Chrome it is:\n        // https://www.familysearch.org/ark:/61903/1:1:J39Y-3Q6\n        // Recently (25 May 2022) on Chrome it looks like:\n        // /search/ark:/61903/1:1:QVJP-4T6V\n\n        //console.log(\"viewRecordUrl = \" + viewRecordUrl);\n\n        if (viewRecordUrl.startsWith(\"/ark:/\") || viewRecordUrl.startsWith(\"/search/ark:/\")) {\n          viewRecordUrl = \"https://www.familysearch.org\" + viewRecordUrl;\n        }\n\n        fetchUrl = viewRecordUrl;\n      }\n    }\n  } else if (fetchUrl.startsWith(\"https://www.familysearch.org/tree/person/details/\")) {\n    let personId = fetchUrl.replace(\"https://www.familysearch.org/tree/person/details/\", \"\");\n    let slashOrQueryIndex = personId.search(/[/?]/);\n    if (slashOrQueryIndex != -1) {\n      personId = personId.substring(0, slashOrQueryIndex);\n    }\n\n    // API URL looks like this: https://api.familysearch.org/platform/tree/persons/K2F9-F5Z\n    if (personId) {\n      fetchUrl = \"https://www.familysearch.org/platform/tree/persons/\" + personId + \"?relatives\";\n      fetchType = \"person\";\n    }\n  }\n\n  // This seems like a recent change on FamilySearch (noticed on 25 May 2022).\n  // Sometimes the URL contains \"/search/\" and this stops the fetch working\n  if (fetchUrl.indexOf(\"www.familysearch.org/search/ark:/\") != -1) {\n    fetchUrl = fetchUrl.replace(\"www.familysearch.org/search/ark:/\", \"www.familysearch.org/ark:/\");\n  }\n\n  //console.log('doFetch, fetchUrl is: ' + fetchUrl);\n\n  let fetchOptionsHeaders = {\n    accept: \"application/x-gedcomx-v1+json, application/json\",\n    \"accept-language\": \"en\",\n    from: \"fsSearch.record.getGedcomX@familysearch.org\",\n    \"sec-fetch-dest\": \"empty\",\n    \"sec-fetch-mode\": \"cors\",\n    \"sec-fetch-site\": \"same-origin\",\n  };\n\n  let fetchOptions = {\n    headers: fetchOptionsHeaders,\n    referrerPolicy: \"strict-origin-when-cross-origin\",\n    body: null,\n    method: \"GET\",\n    mode: \"cors\",\n    credentials: \"include\",\n  };\n\n  try {\n    let response = await fetch(fetchUrl, fetchOptions);\n\n    //console.log('doFetch, response.status is: ' + response.status);\n\n    if (response.status !== 200) {\n      console.log(\"Looks like there was a problem. Status Code: \" + response.status);\n      return {\n        success: false,\n        errorCondition: \"FetchError\",\n        status: response.status,\n      };\n    }\n\n    let jsonData = await response.text();\n\n    //console.log(\"doFetch: response text is:\");\n    //console.log(jsonData);\n\n    if (!jsonData || jsonData[0] != `{`) {\n      console.log(\"The response text does not look like JSON\");\n      //console.log(jsonData);\n      return { success: false, errorCondition: \"NotJSON\" };\n    }\n\n    const dataObj = JSON.parse(jsonData);\n\n    //console.log(\"dataObj is:\");\n    //console.log(dataObj);\n\n    return { success: true, dataObj: dataObj, fetchType: fetchType };\n  } catch (error) {\n    console.log(\"fetch failed, error is:\");\n    console.log(error);\n    return { success: false };\n  }\n}\n\nasync function extractDataFromFetchAndRespond(document, dataObj, fetchType, options, sendResponse) {\n    console.log('extractDataFromFetchAndRespond entered');\n    console.log(document);\n    console.log(dataObj);\n    console.log(fetchType);\n    console.log(options);\n    console.log(sendResponse);\n\n\n  if (!isLoadedExtractDataModuleReady) {\n    if (loadedExtractDataModuleFailed) {\n      sendResponse({\n        success: false,\n        errorMessage: \"Error loading extract data module\",\n      });\n    }\n    // dependencies not ready, wait a few milliseconds and try again\n    else if (loadExtractDataModuleRetries < maxLoadModuleRetries) {\n      loadExtractDataModuleRetries++;\n      console.log(\"extractDataFromFetchAndRespond. Retry number: \", loadExtractDataModuleRetries);\n      setTimeout(function () {\n        extractDataFromFetchAndRespond(document, dataObj, options, sendResponse);\n      }, loadModuleTimeout);\n      return true;\n    } else {\n      console.log(\"extractDataFromFetchAndRespond. Too many retries\");\n      sendResponse({\n        success: false,\n        errorMessage: \"Extract data module never loaded\",\n      });\n    }\n    return false;\n  }\n\n  // Extract the data.\n  let extractedData = loadedExtractDataModule.extractDataFromFetch(document, dataObj, fetchType, options);\n\n  // respond with the type of content and the extracted data\n  sendResponse({\n    success: true,\n    contentType: \"fs\",\n    extractedData: extractedData,\n  });\n}\n\nasync function doFetchAndSendResponse(sendResponse, options) {\n  let result = await doFetch();\n\n  if (result.success) {\n    // Extract the data.\n    extractDataFromFetchAndRespond(document, result.dataObj, result.fetchType, options, sendResponse);\n  } else {\n    if (result.errorCondition == \"NotJSON\") {\n      // This is normal for some pages that could be records but are not.\n      // For example:\n      // https://www.familysearch.org/search/genealogies\n      let extractedData = { pageType: \"unknown\" };\n      sendResponse({\n        success: true,\n        contentType: \"fs\",\n        extractedData: extractedData,\n      });\n    } else if (result.errorCondition == \"FetchError\" && result.status == 401) {\n      // This is normal if the login has expired, so don't raise an unexpected\n      // error message. It will be handled in FS popup.\n      let extractedData = { pageType: \"unknown\" };\n      sendResponse({\n        success: true,\n        contentType: \"fs\",\n        extractedData: extractedData,\n      });\n    } else {\n      // treat this as a serious error\n      sendResponse({\n        success: false,\n        errorMessage: \"Fetch failed\",\n        contentType: \"fs\",\n      });\n    }\n  }\n}\n\nfunction shouldUseFetch() {\n  // There are many kinds of pages on the FamilySearch site.\n  // We only want to use fetch for record pages (and not images)\n  // So not for search results, collection pages etc\n\n  // An image page has:\n  // #main-content-section\n  // Many pages have:\n  // #main\n  // On the element with id #main the record pages have aria-label=\"Main Content\"\n  // However this is true for other pages like this:\n  // https://www.familysearch.org/search/genealogies\n  // For thise we return true and it will just fail when it doesn't get JSON data back from the fetch.\n\n  let useFetch = false;\n\n  if (location.href.startsWith(\"https://www.familysearch.org/tree/person/details/\")) {\n    useFetch = true;\n  } else {\n    let main = document.querySelector(\"#main\");\n    if (main) {\n      //console.log(\"shouldUseFetch, main found\");\n      if (main.getAttribute(\"aria-label\") == \"Main Content\") {\n        //console.log(\"shouldUseFetch, aria-label of Main Content found\");\n\n        useFetch = true;\n      }\n    }\n  }\n\n  //console.log(\"shouldUseFetch, returning useFetch = \" + useFetch);\n\n  return useFetch;\n}\n\nfunction extractHandler(request, sendResponse) {\n  const useFetch = shouldUseFetch();\n\n  //console.log(\"received extract request, useFetch = \" + useFetch);\n\n  if (useFetch) {\n    // extract the data via a fetch thatreturns JSON data\n    doFetchAndSendResponse(sendResponse, request.options);\n    return true; // will respond async\n  } else {\n    // Extract the data via DOM scraping\n    let isAsync = extractDataAndRespond(document, location.href, \"fs\", sendResponse);\n    if (isAsync) {\n      return true;\n    }\n  }\n}\n\nsiteContentInit(`fs`, `site/fs/core/fs_extract_data.mjs`, extractHandler);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9leHRlbnNpb24vc2l0ZS9mcy9icm93c2VyL2ZzX2NvbnRlbnQuanMuanMiLCJtYXBwaW5ncyI6Ijs7OztBQUFBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFTztBQUNQOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUEsc0NBQXNDO0FBQ3RDO0FBQ0E7QUFDQSxlQUFlO0FBQ2Y7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQSxhQUFhO0FBQ2IsSUFBSTtBQUNKO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNEJBQTRCO0FBQzVCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQLE1BQU07QUFDTjtBQUNBO0FBQ0EsNEJBQTRCO0FBQzVCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSIsInNvdXJjZXMiOlsid2VicGFjazovL0NpdGF0aW9uRXh0cmFjdG9yLy4vZXh0ZW5zaW9uL3NpdGUvZnMvYnJvd3Nlci9mc19jb250ZW50LmpzP2EwMTciXSwic291cmNlc0NvbnRlbnQiOlsiLypcbk1JVCBMaWNlbnNlXG5cbkNvcHlyaWdodCAoYykgMjAyMCBSb2JlcnQgTSBQYXZleVxuXG5QZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYSBjb3B5XG5vZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSBcIlNvZnR3YXJlXCIpLCB0byBkZWFsXG5pbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzXG50byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsXG5jb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXNcbmZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6XG5cblRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkIGluIGFsbFxuY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS5cblxuVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEIFwiQVMgSVNcIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUlxuSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksXG5GSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEVcbkFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVJcbkxJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sXG5PVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOIFRIRVxuU09GVFdBUkUuXG4qL1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZG9GZXRjaCgpIHtcbiAgY29uc29sZS5sb2coJ2RvRmV0Y2gsIGRvY3VtZW50LmxvY2F0aW9uIGlzOiAnICsgZG9jdW1lbnQubG9jYXRpb24pO1xuXG4gIGxldCBmZXRjaFR5cGUgPSBcInJlY29yZFwiO1xuXG4gIGxldCBmZXRjaFVybCA9IGRvY3VtZW50LmxvY2F0aW9uLmhyZWY7XG4gIC8vY29uc29sZS5sb2coJ2RvRmV0Y2gsIGZldGNoVXJsIGlzOiAnICsgZmV0Y2hVcmwpO1xuXG4gIGlmIChmZXRjaFVybC5pbmRleE9mKFwiL3NlYXJjaC9yZWNvcmQvcmVzdWx0cz9cIikgIT0gLTEpIHtcbiAgICAvL2NvbnNvbGUubG9nKCdkb0ZldGNoLCBsb29rcyBsaWtlIGEgc2VhcmNoIHBhZ2UsIGNoZWNraW5nIHNpZGViYXInKTtcbiAgICAvLyB0aGlzIGxvb2tzIGxpa2UgYSBzZWFyY2ggcGFnZSwgc2VlIGlmIGEgcmVjb3JkIGlzIHNlbGVjdGVkIGluIHNpZGViYXJcbiAgICBsZXQgdmlld1JlY29yZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCJhW2RhdGEtdGVzdGlkPXZpZXdTaW1pbGFyUmVjb3JkQnV0dG9uXVwiKTtcbiAgICBpZiAodmlld1JlY29yZCkge1xuICAgICAgLy9jb25zb2xlLmxvZyhcImZvdW5kIHZpZXcgcmVjb3JkXCIpO1xuICAgICAgbGV0IHRleHQgPSB2aWV3UmVjb3JkLnRleHRDb250ZW50O1xuICAgICAgbGV0IHZpZXdSZWNvcmRVcmwgPSB2aWV3UmVjb3JkLmdldEF0dHJpYnV0ZShcImhyZWZcIik7XG4gICAgICBpZiAodmlld1JlY29yZFVybCkge1xuICAgICAgICAvLyBzdHJhbmdlbHkgb24gZmlyZWZveCB2aWV3UmVjb3JkVXJsIGNhbiBiZSBzb21ldGhpbmcgbGlrZTpcbiAgICAgICAgLy8gL2FyazovNjE5MDMvMToxOkozOVktM1E2XG4gICAgICAgIC8vIHdoaWxlIG9uIENocm9tZSBpdCBpczpcbiAgICAgICAgLy8gaHR0cHM6Ly93d3cuZmFtaWx5c2VhcmNoLm9yZy9hcms6LzYxOTAzLzE6MTpKMzlZLTNRNlxuICAgICAgICAvLyBSZWNlbnRseSAoMjUgTWF5IDIwMjIpIG9uIENocm9tZSBpdCBsb29rcyBsaWtlOlxuICAgICAgICAvLyAvc2VhcmNoL2FyazovNjE5MDMvMToxOlFWSlAtNFQ2VlxuXG4gICAgICAgIC8vY29uc29sZS5sb2coXCJ2aWV3UmVjb3JkVXJsID0gXCIgKyB2aWV3UmVjb3JkVXJsKTtcblxuICAgICAgICBpZiAodmlld1JlY29yZFVybC5zdGFydHNXaXRoKFwiL2FyazovXCIpIHx8IHZpZXdSZWNvcmRVcmwuc3RhcnRzV2l0aChcIi9zZWFyY2gvYXJrOi9cIikpIHtcbiAgICAgICAgICB2aWV3UmVjb3JkVXJsID0gXCJodHRwczovL3d3dy5mYW1pbHlzZWFyY2gub3JnXCIgKyB2aWV3UmVjb3JkVXJsO1xuICAgICAgICB9XG5cbiAgICAgICAgZmV0Y2hVcmwgPSB2aWV3UmVjb3JkVXJsO1xuICAgICAgfVxuICAgIH1cbiAgfSBlbHNlIGlmIChmZXRjaFVybC5zdGFydHNXaXRoKFwiaHR0cHM6Ly93d3cuZmFtaWx5c2VhcmNoLm9yZy90cmVlL3BlcnNvbi9kZXRhaWxzL1wiKSkge1xuICAgIGxldCBwZXJzb25JZCA9IGZldGNoVXJsLnJlcGxhY2UoXCJodHRwczovL3d3dy5mYW1pbHlzZWFyY2gub3JnL3RyZWUvcGVyc29uL2RldGFpbHMvXCIsIFwiXCIpO1xuICAgIGxldCBzbGFzaE9yUXVlcnlJbmRleCA9IHBlcnNvbklkLnNlYXJjaCgvWy8/XS8pO1xuICAgIGlmIChzbGFzaE9yUXVlcnlJbmRleCAhPSAtMSkge1xuICAgICAgcGVyc29uSWQgPSBwZXJzb25JZC5zdWJzdHJpbmcoMCwgc2xhc2hPclF1ZXJ5SW5kZXgpO1xuICAgIH1cblxuICAgIC8vIEFQSSBVUkwgbG9va3MgbGlrZSB0aGlzOiBodHRwczovL2FwaS5mYW1pbHlzZWFyY2gub3JnL3BsYXRmb3JtL3RyZWUvcGVyc29ucy9LMkY5LUY1WlxuICAgIGlmIChwZXJzb25JZCkge1xuICAgICAgZmV0Y2hVcmwgPSBcImh0dHBzOi8vd3d3LmZhbWlseXNlYXJjaC5vcmcvcGxhdGZvcm0vdHJlZS9wZXJzb25zL1wiICsgcGVyc29uSWQgKyBcIj9yZWxhdGl2ZXNcIjtcbiAgICAgIGZldGNoVHlwZSA9IFwicGVyc29uXCI7XG4gICAgfVxuICB9XG5cbiAgLy8gVGhpcyBzZWVtcyBsaWtlIGEgcmVjZW50IGNoYW5nZSBvbiBGYW1pbHlTZWFyY2ggKG5vdGljZWQgb24gMjUgTWF5IDIwMjIpLlxuICAvLyBTb21ldGltZXMgdGhlIFVSTCBjb250YWlucyBcIi9zZWFyY2gvXCIgYW5kIHRoaXMgc3RvcHMgdGhlIGZldGNoIHdvcmtpbmdcbiAgaWYgKGZldGNoVXJsLmluZGV4T2YoXCJ3d3cuZmFtaWx5c2VhcmNoLm9yZy9zZWFyY2gvYXJrOi9cIikgIT0gLTEpIHtcbiAgICBmZXRjaFVybCA9IGZldGNoVXJsLnJlcGxhY2UoXCJ3d3cuZmFtaWx5c2VhcmNoLm9yZy9zZWFyY2gvYXJrOi9cIiwgXCJ3d3cuZmFtaWx5c2VhcmNoLm9yZy9hcms6L1wiKTtcbiAgfVxuXG4gIC8vY29uc29sZS5sb2coJ2RvRmV0Y2gsIGZldGNoVXJsIGlzOiAnICsgZmV0Y2hVcmwpO1xuXG4gIGxldCBmZXRjaE9wdGlvbnNIZWFkZXJzID0ge1xuICAgIGFjY2VwdDogXCJhcHBsaWNhdGlvbi94LWdlZGNvbXgtdjEranNvbiwgYXBwbGljYXRpb24vanNvblwiLFxuICAgIFwiYWNjZXB0LWxhbmd1YWdlXCI6IFwiZW5cIixcbiAgICBmcm9tOiBcImZzU2VhcmNoLnJlY29yZC5nZXRHZWRjb21YQGZhbWlseXNlYXJjaC5vcmdcIixcbiAgICBcInNlYy1mZXRjaC1kZXN0XCI6IFwiZW1wdHlcIixcbiAgICBcInNlYy1mZXRjaC1tb2RlXCI6IFwiY29yc1wiLFxuICAgIFwic2VjLWZldGNoLXNpdGVcIjogXCJzYW1lLW9yaWdpblwiLFxuICB9O1xuXG4gIGxldCBmZXRjaE9wdGlvbnMgPSB7XG4gICAgaGVhZGVyczogZmV0Y2hPcHRpb25zSGVhZGVycyxcbiAgICByZWZlcnJlclBvbGljeTogXCJzdHJpY3Qtb3JpZ2luLXdoZW4tY3Jvc3Mtb3JpZ2luXCIsXG4gICAgYm9keTogbnVsbCxcbiAgICBtZXRob2Q6IFwiR0VUXCIsXG4gICAgbW9kZTogXCJjb3JzXCIsXG4gICAgY3JlZGVudGlhbHM6IFwiaW5jbHVkZVwiLFxuICB9O1xuXG4gIHRyeSB7XG4gICAgbGV0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goZmV0Y2hVcmwsIGZldGNoT3B0aW9ucyk7XG5cbiAgICAvL2NvbnNvbGUubG9nKCdkb0ZldGNoLCByZXNwb25zZS5zdGF0dXMgaXM6ICcgKyByZXNwb25zZS5zdGF0dXMpO1xuXG4gICAgaWYgKHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7XG4gICAgICBjb25zb2xlLmxvZyhcIkxvb2tzIGxpa2UgdGhlcmUgd2FzIGEgcHJvYmxlbS4gU3RhdHVzIENvZGU6IFwiICsgcmVzcG9uc2Uuc3RhdHVzKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBlcnJvckNvbmRpdGlvbjogXCJGZXRjaEVycm9yXCIsXG4gICAgICAgIHN0YXR1czogcmVzcG9uc2Uuc3RhdHVzLFxuICAgICAgfTtcbiAgICB9XG5cbiAgICBsZXQganNvbkRhdGEgPSBhd2FpdCByZXNwb25zZS50ZXh0KCk7XG5cbiAgICAvL2NvbnNvbGUubG9nKFwiZG9GZXRjaDogcmVzcG9uc2UgdGV4dCBpczpcIik7XG4gICAgLy9jb25zb2xlLmxvZyhqc29uRGF0YSk7XG5cbiAgICBpZiAoIWpzb25EYXRhIHx8IGpzb25EYXRhWzBdICE9IGB7YCkge1xuICAgICAgY29uc29sZS5sb2coXCJUaGUgcmVzcG9uc2UgdGV4dCBkb2VzIG5vdCBsb29rIGxpa2UgSlNPTlwiKTtcbiAgICAgIC8vY29uc29sZS5sb2coanNvbkRhdGEpO1xuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yQ29uZGl0aW9uOiBcIk5vdEpTT05cIiB9O1xuICAgIH1cblxuICAgIGNvbnN0IGRhdGFPYmogPSBKU09OLnBhcnNlKGpzb25EYXRhKTtcblxuICAgIC8vY29uc29sZS5sb2coXCJkYXRhT2JqIGlzOlwiKTtcbiAgICAvL2NvbnNvbGUubG9nKGRhdGFPYmopO1xuXG4gICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgZGF0YU9iajogZGF0YU9iaiwgZmV0Y2hUeXBlOiBmZXRjaFR5cGUgfTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmxvZyhcImZldGNoIGZhaWxlZCwgZXJyb3IgaXM6XCIpO1xuICAgIGNvbnNvbGUubG9nKGVycm9yKTtcbiAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSB9O1xuICB9XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGV4dHJhY3REYXRhRnJvbUZldGNoQW5kUmVzcG9uZChkb2N1bWVudCwgZGF0YU9iaiwgZmV0Y2hUeXBlLCBvcHRpb25zLCBzZW5kUmVzcG9uc2UpIHtcbiAgICBjb25zb2xlLmxvZygnZXh0cmFjdERhdGFGcm9tRmV0Y2hBbmRSZXNwb25kIGVudGVyZWQnKTtcbiAgICBjb25zb2xlLmxvZyhkb2N1bWVudCk7XG4gICAgY29uc29sZS5sb2coZGF0YU9iaik7XG4gICAgY29uc29sZS5sb2coZmV0Y2hUeXBlKTtcbiAgICBjb25zb2xlLmxvZyhvcHRpb25zKTtcbiAgICBjb25zb2xlLmxvZyhzZW5kUmVzcG9uc2UpO1xuXG5cbiAgaWYgKCFpc0xvYWRlZEV4dHJhY3REYXRhTW9kdWxlUmVhZHkpIHtcbiAgICBpZiAobG9hZGVkRXh0cmFjdERhdGFNb2R1bGVGYWlsZWQpIHtcbiAgICAgIHNlbmRSZXNwb25zZSh7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBlcnJvck1lc3NhZ2U6IFwiRXJyb3IgbG9hZGluZyBleHRyYWN0IGRhdGEgbW9kdWxlXCIsXG4gICAgICB9KTtcbiAgICB9XG4gICAgLy8gZGVwZW5kZW5jaWVzIG5vdCByZWFkeSwgd2FpdCBhIGZldyBtaWxsaXNlY29uZHMgYW5kIHRyeSBhZ2FpblxuICAgIGVsc2UgaWYgKGxvYWRFeHRyYWN0RGF0YU1vZHVsZVJldHJpZXMgPCBtYXhMb2FkTW9kdWxlUmV0cmllcykge1xuICAgICAgbG9hZEV4dHJhY3REYXRhTW9kdWxlUmV0cmllcysrO1xuICAgICAgY29uc29sZS5sb2coXCJleHRyYWN0RGF0YUZyb21GZXRjaEFuZFJlc3BvbmQuIFJldHJ5IG51bWJlcjogXCIsIGxvYWRFeHRyYWN0RGF0YU1vZHVsZVJldHJpZXMpO1xuICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgIGV4dHJhY3REYXRhRnJvbUZldGNoQW5kUmVzcG9uZChkb2N1bWVudCwgZGF0YU9iaiwgb3B0aW9ucywgc2VuZFJlc3BvbnNlKTtcbiAgICAgIH0sIGxvYWRNb2R1bGVUaW1lb3V0KTtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zb2xlLmxvZyhcImV4dHJhY3REYXRhRnJvbUZldGNoQW5kUmVzcG9uZC4gVG9vIG1hbnkgcmV0cmllc1wiKTtcbiAgICAgIHNlbmRSZXNwb25zZSh7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBlcnJvck1lc3NhZ2U6IFwiRXh0cmFjdCBkYXRhIG1vZHVsZSBuZXZlciBsb2FkZWRcIixcbiAgICAgIH0pO1xuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICAvLyBFeHRyYWN0IHRoZSBkYXRhLlxuICBsZXQgZXh0cmFjdGVkRGF0YSA9IGxvYWRlZEV4dHJhY3REYXRhTW9kdWxlLmV4dHJhY3REYXRhRnJvbUZldGNoKGRvY3VtZW50LCBkYXRhT2JqLCBmZXRjaFR5cGUsIG9wdGlvbnMpO1xuXG4gIC8vIHJlc3BvbmQgd2l0aCB0aGUgdHlwZSBvZiBjb250ZW50IGFuZCB0aGUgZXh0cmFjdGVkIGRhdGFcbiAgc2VuZFJlc3BvbnNlKHtcbiAgICBzdWNjZXNzOiB0cnVlLFxuICAgIGNvbnRlbnRUeXBlOiBcImZzXCIsXG4gICAgZXh0cmFjdGVkRGF0YTogZXh0cmFjdGVkRGF0YSxcbiAgfSk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGRvRmV0Y2hBbmRTZW5kUmVzcG9uc2Uoc2VuZFJlc3BvbnNlLCBvcHRpb25zKSB7XG4gIGxldCByZXN1bHQgPSBhd2FpdCBkb0ZldGNoKCk7XG5cbiAgaWYgKHJlc3VsdC5zdWNjZXNzKSB7XG4gICAgLy8gRXh0cmFjdCB0aGUgZGF0YS5cbiAgICBleHRyYWN0RGF0YUZyb21GZXRjaEFuZFJlc3BvbmQoZG9jdW1lbnQsIHJlc3VsdC5kYXRhT2JqLCByZXN1bHQuZmV0Y2hUeXBlLCBvcHRpb25zLCBzZW5kUmVzcG9uc2UpO1xuICB9IGVsc2Uge1xuICAgIGlmIChyZXN1bHQuZXJyb3JDb25kaXRpb24gPT0gXCJOb3RKU09OXCIpIHtcbiAgICAgIC8vIFRoaXMgaXMgbm9ybWFsIGZvciBzb21lIHBhZ2VzIHRoYXQgY291bGQgYmUgcmVjb3JkcyBidXQgYXJlIG5vdC5cbiAgICAgIC8vIEZvciBleGFtcGxlOlxuICAgICAgLy8gaHR0cHM6Ly93d3cuZmFtaWx5c2VhcmNoLm9yZy9zZWFyY2gvZ2VuZWFsb2dpZXNcbiAgICAgIGxldCBleHRyYWN0ZWREYXRhID0geyBwYWdlVHlwZTogXCJ1bmtub3duXCIgfTtcbiAgICAgIHNlbmRSZXNwb25zZSh7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIGNvbnRlbnRUeXBlOiBcImZzXCIsXG4gICAgICAgIGV4dHJhY3RlZERhdGE6IGV4dHJhY3RlZERhdGEsXG4gICAgICB9KTtcbiAgICB9IGVsc2UgaWYgKHJlc3VsdC5lcnJvckNvbmRpdGlvbiA9PSBcIkZldGNoRXJyb3JcIiAmJiByZXN1bHQuc3RhdHVzID09IDQwMSkge1xuICAgICAgLy8gVGhpcyBpcyBub3JtYWwgaWYgdGhlIGxvZ2luIGhhcyBleHBpcmVkLCBzbyBkb24ndCByYWlzZSBhbiB1bmV4cGVjdGVkXG4gICAgICAvLyBlcnJvciBtZXNzYWdlLiBJdCB3aWxsIGJlIGhhbmRsZWQgaW4gRlMgcG9wdXAuXG4gICAgICBsZXQgZXh0cmFjdGVkRGF0YSA9IHsgcGFnZVR5cGU6IFwidW5rbm93blwiIH07XG4gICAgICBzZW5kUmVzcG9uc2Uoe1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBjb250ZW50VHlwZTogXCJmc1wiLFxuICAgICAgICBleHRyYWN0ZWREYXRhOiBleHRyYWN0ZWREYXRhLFxuICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIHRyZWF0IHRoaXMgYXMgYSBzZXJpb3VzIGVycm9yXG4gICAgICBzZW5kUmVzcG9uc2Uoe1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgZXJyb3JNZXNzYWdlOiBcIkZldGNoIGZhaWxlZFwiLFxuICAgICAgICBjb250ZW50VHlwZTogXCJmc1wiLFxuICAgICAgfSk7XG4gICAgfVxuICB9XG59XG5cbmZ1bmN0aW9uIHNob3VsZFVzZUZldGNoKCkge1xuICAvLyBUaGVyZSBhcmUgbWFueSBraW5kcyBvZiBwYWdlcyBvbiB0aGUgRmFtaWx5U2VhcmNoIHNpdGUuXG4gIC8vIFdlIG9ubHkgd2FudCB0byB1c2UgZmV0Y2ggZm9yIHJlY29yZCBwYWdlcyAoYW5kIG5vdCBpbWFnZXMpXG4gIC8vIFNvIG5vdCBmb3Igc2VhcmNoIHJlc3VsdHMsIGNvbGxlY3Rpb24gcGFnZXMgZXRjXG5cbiAgLy8gQW4gaW1hZ2UgcGFnZSBoYXM6XG4gIC8vICNtYWluLWNvbnRlbnQtc2VjdGlvblxuICAvLyBNYW55IHBhZ2VzIGhhdmU6XG4gIC8vICNtYWluXG4gIC8vIE9uIHRoZSBlbGVtZW50IHdpdGggaWQgI21haW4gdGhlIHJlY29yZCBwYWdlcyBoYXZlIGFyaWEtbGFiZWw9XCJNYWluIENvbnRlbnRcIlxuICAvLyBIb3dldmVyIHRoaXMgaXMgdHJ1ZSBmb3Igb3RoZXIgcGFnZXMgbGlrZSB0aGlzOlxuICAvLyBodHRwczovL3d3dy5mYW1pbHlzZWFyY2gub3JnL3NlYXJjaC9nZW5lYWxvZ2llc1xuICAvLyBGb3IgdGhpc2Ugd2UgcmV0dXJuIHRydWUgYW5kIGl0IHdpbGwganVzdCBmYWlsIHdoZW4gaXQgZG9lc24ndCBnZXQgSlNPTiBkYXRhIGJhY2sgZnJvbSB0aGUgZmV0Y2guXG5cbiAgbGV0IHVzZUZldGNoID0gZmFsc2U7XG5cbiAgaWYgKGxvY2F0aW9uLmhyZWYuc3RhcnRzV2l0aChcImh0dHBzOi8vd3d3LmZhbWlseXNlYXJjaC5vcmcvdHJlZS9wZXJzb24vZGV0YWlscy9cIikpIHtcbiAgICB1c2VGZXRjaCA9IHRydWU7XG4gIH0gZWxzZSB7XG4gICAgbGV0IG1haW4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI21haW5cIik7XG4gICAgaWYgKG1haW4pIHtcbiAgICAgIC8vY29uc29sZS5sb2coXCJzaG91bGRVc2VGZXRjaCwgbWFpbiBmb3VuZFwiKTtcbiAgICAgIGlmIChtYWluLmdldEF0dHJpYnV0ZShcImFyaWEtbGFiZWxcIikgPT0gXCJNYWluIENvbnRlbnRcIikge1xuICAgICAgICAvL2NvbnNvbGUubG9nKFwic2hvdWxkVXNlRmV0Y2gsIGFyaWEtbGFiZWwgb2YgTWFpbiBDb250ZW50IGZvdW5kXCIpO1xuXG4gICAgICAgIHVzZUZldGNoID0gdHJ1ZTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvL2NvbnNvbGUubG9nKFwic2hvdWxkVXNlRmV0Y2gsIHJldHVybmluZyB1c2VGZXRjaCA9IFwiICsgdXNlRmV0Y2gpO1xuXG4gIHJldHVybiB1c2VGZXRjaDtcbn1cblxuZnVuY3Rpb24gZXh0cmFjdEhhbmRsZXIocmVxdWVzdCwgc2VuZFJlc3BvbnNlKSB7XG4gIGNvbnN0IHVzZUZldGNoID0gc2hvdWxkVXNlRmV0Y2goKTtcblxuICAvL2NvbnNvbGUubG9nKFwicmVjZWl2ZWQgZXh0cmFjdCByZXF1ZXN0LCB1c2VGZXRjaCA9IFwiICsgdXNlRmV0Y2gpO1xuXG4gIGlmICh1c2VGZXRjaCkge1xuICAgIC8vIGV4dHJhY3QgdGhlIGRhdGEgdmlhIGEgZmV0Y2ggdGhhdHJldHVybnMgSlNPTiBkYXRhXG4gICAgZG9GZXRjaEFuZFNlbmRSZXNwb25zZShzZW5kUmVzcG9uc2UsIHJlcXVlc3Qub3B0aW9ucyk7XG4gICAgcmV0dXJuIHRydWU7IC8vIHdpbGwgcmVzcG9uZCBhc3luY1xuICB9IGVsc2Uge1xuICAgIC8vIEV4dHJhY3QgdGhlIGRhdGEgdmlhIERPTSBzY3JhcGluZ1xuICAgIGxldCBpc0FzeW5jID0gZXh0cmFjdERhdGFBbmRSZXNwb25kKGRvY3VtZW50LCBsb2NhdGlvbi5ocmVmLCBcImZzXCIsIHNlbmRSZXNwb25zZSk7XG4gICAgaWYgKGlzQXN5bmMpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgfVxufVxuXG5zaXRlQ29udGVudEluaXQoYGZzYCwgYHNpdGUvZnMvY29yZS9mc19leHRyYWN0X2RhdGEubWpzYCwgZXh0cmFjdEhhbmRsZXIpO1xuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./extension/site/fs/browser/fs_content.js\n");

/***/ }),

/***/ "./extension/base/browser/common/browser_compat.mjs":
/*!**********************************************************!*\
  !*** ./extension/base/browser/common/browser_compat.mjs ***!
  \**********************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"getLocalStorageItem\": () => (/* binding */ getLocalStorageItem),\n/* harmony export */   \"getSyncStorageItems\": () => (/* binding */ getSyncStorageItems),\n/* harmony export */   \"getTabDetails\": () => (/* binding */ getTabDetails)\n/* harmony export */ });\n/*\nMIT License\n\nCopyright (c) 2020 Robert M Pavey\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.\n*/\n\n//////////////////////////////////////////////////////////////////////////////////////////\n// Browser compatibility\n//////////////////////////////////////////////////////////////////////////////////////////\n\nasync function getTabDetails(tabId) {\n  // while chrome.tabs.get exists on Firefox it does not return a promise so await doesn't work\n  // meanwhile the browser global does not exist in Chrome\n  if (typeof browser === \"undefined\") {\n    return await chrome.tabs.get(tabId);\n  } else {\n    return await browser.tabs.get(tabId);\n  }\n}\n\nasync function getLocalStorageItem(key) {\n  let item = undefined;\n  let items = undefined;\n  if (typeof browser === \"undefined\") {\n    items = await chrome.storage.local.get(key);\n  } else {\n    items = await browser.storage.local.get(key);\n  }\n\n  if (items && items[key]) {\n    item = items[key];\n  }\n  return item;\n}\n\nasync function getSyncStorageItems(keyList) {\n  let items = undefined;\n  if (typeof browser === \"undefined\") {\n    items = await chrome.storage.sync.get(keyList);\n  } else {\n    items = await browser.storage.sync.get(keyList);\n  }\n  return items;\n}\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9leHRlbnNpb24vYmFzZS9icm93c2VyL2NvbW1vbi9icm93c2VyX2NvbXBhdC5tanMuanMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTs7QUFFbUUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9DaXRhdGlvbkV4dHJhY3Rvci8uL2V4dGVuc2lvbi9iYXNlL2Jyb3dzZXIvY29tbW9uL2Jyb3dzZXJfY29tcGF0Lm1qcz82MzY2Il0sInNvdXJjZXNDb250ZW50IjpbIi8qXG5NSVQgTGljZW5zZVxuXG5Db3B5cmlnaHQgKGMpIDIwMjAgUm9iZXJ0IE0gUGF2ZXlcblxuUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEgY29weVxub2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGUgXCJTb2Z0d2FyZVwiKSwgdG8gZGVhbFxuaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVzdHJpY3Rpb24sIGluY2x1ZGluZyB3aXRob3V0IGxpbWl0YXRpb24gdGhlIHJpZ2h0c1xudG8gdXNlLCBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLCBkaXN0cmlidXRlLCBzdWJsaWNlbnNlLCBhbmQvb3Igc2VsbFxuY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzXG5mdXJuaXNoZWQgdG8gZG8gc28sIHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZyBjb25kaXRpb25zOlxuXG5UaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZCBpbiBhbGxcbmNvcGllcyBvciBzdWJzdGFudGlhbCBwb3J0aW9ucyBvZiB0aGUgU29mdHdhcmUuXG5cblRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCBcIkFTIElTXCIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1JcbklNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLFxuRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFXG5BVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSXG5MSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLFxuT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTiBUSEVcblNPRlRXQVJFLlxuKi9cblxuLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBCcm93c2VyIGNvbXBhdGliaWxpdHlcbi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG5hc3luYyBmdW5jdGlvbiBnZXRUYWJEZXRhaWxzKHRhYklkKSB7XG4gIC8vIHdoaWxlIGNocm9tZS50YWJzLmdldCBleGlzdHMgb24gRmlyZWZveCBpdCBkb2VzIG5vdCByZXR1cm4gYSBwcm9taXNlIHNvIGF3YWl0IGRvZXNuJ3Qgd29ya1xuICAvLyBtZWFud2hpbGUgdGhlIGJyb3dzZXIgZ2xvYmFsIGRvZXMgbm90IGV4aXN0IGluIENocm9tZVxuICBpZiAodHlwZW9mIGJyb3dzZXIgPT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICByZXR1cm4gYXdhaXQgY2hyb21lLnRhYnMuZ2V0KHRhYklkKTtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gYXdhaXQgYnJvd3Nlci50YWJzLmdldCh0YWJJZCk7XG4gIH1cbn1cblxuYXN5bmMgZnVuY3Rpb24gZ2V0TG9jYWxTdG9yYWdlSXRlbShrZXkpIHtcbiAgbGV0IGl0ZW0gPSB1bmRlZmluZWQ7XG4gIGxldCBpdGVtcyA9IHVuZGVmaW5lZDtcbiAgaWYgKHR5cGVvZiBicm93c2VyID09PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgaXRlbXMgPSBhd2FpdCBjaHJvbWUuc3RvcmFnZS5sb2NhbC5nZXQoa2V5KTtcbiAgfSBlbHNlIHtcbiAgICBpdGVtcyA9IGF3YWl0IGJyb3dzZXIuc3RvcmFnZS5sb2NhbC5nZXQoa2V5KTtcbiAgfVxuXG4gIGlmIChpdGVtcyAmJiBpdGVtc1trZXldKSB7XG4gICAgaXRlbSA9IGl0ZW1zW2tleV07XG4gIH1cbiAgcmV0dXJuIGl0ZW07XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGdldFN5bmNTdG9yYWdlSXRlbXMoa2V5TGlzdCkge1xuICBsZXQgaXRlbXMgPSB1bmRlZmluZWQ7XG4gIGlmICh0eXBlb2YgYnJvd3NlciA9PT0gXCJ1bmRlZmluZWRcIikge1xuICAgIGl0ZW1zID0gYXdhaXQgY2hyb21lLnN0b3JhZ2Uuc3luYy5nZXQoa2V5TGlzdCk7XG4gIH0gZWxzZSB7XG4gICAgaXRlbXMgPSBhd2FpdCBicm93c2VyLnN0b3JhZ2Uuc3luYy5nZXQoa2V5TGlzdCk7XG4gIH1cbiAgcmV0dXJuIGl0ZW1zO1xufVxuXG5leHBvcnQgeyBnZXRUYWJEZXRhaWxzLCBnZXRMb2NhbFN0b3JhZ2VJdGVtLCBnZXRTeW5jU3RvcmFnZUl0ZW1zIH07XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./extension/base/browser/common/browser_compat.mjs\n");

/***/ }),

/***/ "./extension/base/core/citation_builder.mjs":
/*!**************************************************!*\
  !*** ./extension/base/core/citation_builder.mjs ***!
  \**************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"CitationBuilder\": () => (/* binding */ CitationBuilder)\n/* harmony export */ });\n/* harmony import */ var _narrative_builder_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./narrative_builder.mjs */ \"./extension/base/core/narrative_builder.mjs\");\n/*\nMIT License\n\nCopyright (c) 2020 Robert M Pavey\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.\n*/\n\n\n\n// The different parts of a citation are:\n//\n//     - Meaningful title. e.g. 1851 Census\n//     - Source/repository name (possibly with link to original data) e.g. 1851 England Census\n//     - Source reference e.g. Class: HO107; Piece: 1946; Folio: 647; Page: 25; GSU roll: 221106\n//     - optional sharing link/template\n//     - record link/template plus accessed date\n//     - optional link to external site (e.g. FMP image from FS)\n//     - data table or dataString\n\nclass CitationBuilder {\n  constructor(type, runDate, options) {\n    this.type = type; // \"inline\", \"narrative\" or \"source\"\n    this.options = options;\n    this.runDate = runDate;\n    this.meaningfulTitle = \"\";\n    this.sourceTitle = \"\";\n    this.sourceReference = \"\";\n    this.sharingLinkOrTemplate = \"\";\n    this.recordLinkOrTemplate = \"\";\n    this.externalSiteLink = \"\";\n    this.dataString = \"\";\n    this.includeSubscriptionRequired = \"none\";\n    this.putSourceTitleInQuotes = true;\n    this.databaseHasImages = false;\n  }\n\n  getOptions() {\n    return this.options;\n  }\n\n  getDateString(date) {\n    const monthStrings = [\n      \"January\",\n      \"February\",\n      \"March\",\n      \"April\",\n      \"May\",\n      \"June\",\n      \"July\",\n      \"August\",\n      \"September\",\n      \"October\",\n      \"November\",\n      \"December\",\n    ];\n\n    const dateString = \"\" + date.getDate() + \" \" + monthStrings[date.getMonth()] + \" \" + date.getFullYear();\n\n    return dateString;\n  }\n\n  getSubReqString(subReqOption) {\n    let subReqString = \"\";\n    if (subReqOption == \"subscriptionRequired\") {\n      subReqString = \"subscription required\";\n    } else if (subReqOption == \"requiresSubscription\") {\n      subReqString = \"requires subscription\";\n    } else if (subReqOption == \"dollar\") {\n      subReqString = \"$\";\n    } else if (subReqOption == \"paywall\") {\n      subReqString = \"paywall\";\n    }\n    return subReqString;\n  }\n\n  addBreakNewlineOrAlternatives(oldCitation, separatorChar = \",\") {\n    let citation = oldCitation;\n\n    if (this.options.citation_general_addBreaksWithinBody) {\n      citation += \"<br/>\";\n    } else {\n      if (citation.endsWith(\";\") || citation.endsWith(\",\") || citation.endsWith(\".\")) {\n        citation = citation.substring(0, citation.length - 1);\n      }\n\n      if (this.options.citation_general_commaInsideQuotes && citation.endsWith('\"')) {\n        citation = citation.substring(0, citation.length - 1);\n        citation += separatorChar + '\"';\n      } else {\n        citation += separatorChar;\n      }\n\n      citation += \" \";\n    }\n    if (this.type != \"source\" && this.options.citation_general_addNewlinesWithinBody) {\n      citation += \"\\n\";\n    }\n\n    return citation;\n  }\n\n  addNarrative(gd, dataCache, options) {\n    // eventually these should come from the dataCache\n    // The problem is how to be sure we get a valid match from the data cache?\n    // It could be worth just getting it for the gender for pronouns\n    let wtExtractedData = undefined;\n    let wtGeneralizedData = undefined;\n\n    const narrativeInput = {\n      eventGeneralizedData: gd,\n      wtExtractedData: wtExtractedData,\n      wtGeneralizedData: wtGeneralizedData,\n      options: options,\n    };\n    let narrative = (0,_narrative_builder_mjs__WEBPACK_IMPORTED_MODULE_0__.buildNarrative)(narrativeInput);\n\n    //console.log(\"addNarrative, narrative is\");\n    //console.log(narrative);\n\n    if (narrative) {\n      this.narrative = narrative;\n    }\n  }\n\n  buildDataList(recordData, keyFilterFunction) {\n    let itemSep = \";\";\n    let valueSep = \":\";\n    if (this.options.citation_general_dataListSeparator == \"commaColon\") {\n      itemSep = \",\";\n      valueSep = \":\";\n    } else if (this.options.citation_general_dataListSeparator == \"commaSpace\") {\n      itemSep = \",\";\n      valueSep = \"\";\n    }\n\n    let keys = Object.keys(recordData);\n    if (keyFilterFunction) {\n      keys = keyFilterFunction(keys, recordData);\n    }\n\n    let dataListString = \"\";\n\n    for (let key of keys) {\n      let value = recordData[key];\n      if (value && value != \"-\") {\n        value = value.trim();\n        if (dataListString != \"\") {\n          dataListString += itemSep + \" \";\n        }\n        if (value.startsWith(\"http\")) {\n          dataListString += \"[\" + value + \" \" + key + \"]\";\n        } else {\n          dataListString += key + valueSep + \" \" + value;\n        }\n      }\n    }\n\n    return dataListString;\n  }\n\n  getCitationString() {\n    let autoTableOpt = this.options.table_general_autoGenerate;\n\n    let citation = \"\";\n    let subReqString = this.getSubReqString(this.includeSubscriptionRequired);\n\n    if (this.type == \"narrative\" && this.narrative) {\n      citation += this.narrative;\n    }\n\n    if (this.type == \"source\") {\n      citation += \"* \";\n    } else {\n      citation += \"<ref>\";\n    }\n\n    if (this.type != \"source\" && this.options.citation_general_addNewlinesWithinRefs) {\n      citation += \"\\n\";\n    }\n\n    if (this.options.citation_general_meaningfulNames != \"none\" && this.meaningfulTitle) {\n      if (this.options.citation_general_meaningfulNames == \"bold\") {\n        citation += \"'''\" + this.meaningfulTitle + \"''':\";\n      } else if (this.options.citation_general_meaningfulNames == \"italic\") {\n        citation += \"''\" + this.meaningfulTitle + \"'':\";\n      } else {\n        citation += this.meaningfulTitle + \":\";\n      }\n\n      if (this.type != \"source\" && this.options.citation_general_addNewlinesWithinBody) {\n        citation += \"\\n\";\n      } else {\n        citation += \" \";\n      }\n    }\n\n    if (this.sourceTitle) {\n      let sourceTitle = this.sourceTitle.trim();\n      if (this.putSourceTitleInQuotes) {\n        sourceTitle = '\"' + sourceTitle + '\"';\n      }\n      citation += sourceTitle;\n\n      if (this.options.citation_general_addEeItemType) {\n        if (this.options.citation_general_commaInsideQuotes && citation.endsWith('\"')) {\n          citation = citation.substring(0, citation.length - 1);\n          citation += ',\"';\n        } else {\n          citation += \",\";\n        }\n        if (this.databaseHasImages) {\n          citation += \" database with images\";\n        } else {\n          citation += \" database\";\n        }\n      }\n\n      citation = this.addBreakNewlineOrAlternatives(citation);\n    }\n\n    if (this.websiteCreatorOwner) {\n      citation += this.websiteCreatorOwner;\n\n      if (this.sourceReference && this.options.citation_general_referencePosition == \"afterSourceTitle\") {\n        citation += \", \";\n      } else {\n        citation = this.addBreakNewlineOrAlternatives(citation);\n      }\n    }\n\n    if (this.sourceReference && this.options.citation_general_referencePosition == \"afterSourceTitle\") {\n      citation += this.sourceReference;\n      citation = this.addBreakNewlineOrAlternatives(citation);\n    }\n\n    if (this.sharingLinkOrTemplate) {\n      citation += this.sharingLinkOrTemplate;\n      if (this.recordLinkOrTemplate) {\n        if (subReqString) {\n          citation += \" (free access)<br/>\";\n          if (this.type != \"source\" && this.options.citation_general_addNewlinesWithinBody) {\n            citation += \"\\n\";\n          }\n        } else {\n          citation += \" - \"; // separate the two links with a hyphen for space\n        }\n      }\n    } else if (this.imageLink) {\n      citation += this.imageLink;\n      if (this.recordLinkOrTemplate) {\n        citation += \" - \"; // separate the two links with a hyphen for space\n      }\n    }\n\n    if (this.recordLinkOrTemplate) {\n      let accessedDate = this.getDateString(this.runDate);\n      if (this.options.citation_general_addAccessedDate == \"parenAfterLink\") {\n        citation += this.recordLinkOrTemplate;\n\n        if (subReqString) {\n          citation += \" (\" + subReqString + \", accessed \" + accessedDate + \")\";\n        } else {\n          citation += \" (accessed \" + accessedDate + \")\";\n        }\n      } else if (this.options.citation_general_addAccessedDate == \"parenBeforeLink\") {\n        citation += \"(\";\n        citation += this.recordLinkOrTemplate;\n\n        if (subReqString) {\n          citation += \" : \" + subReqString + \", accessed \" + accessedDate + \")\";\n        } else {\n          citation += \" : accessed \" + accessedDate + \")\";\n        }\n      } else {\n        citation += this.recordLinkOrTemplate;\n\n        if (subReqString) {\n          citation += \" (\" + subReqString + \")\";\n        }\n      }\n    }\n\n    if (this.externalSiteLink) {\n      if (!citation.endsWith(\"\\n\")) {\n        if (this.options.citation_general_addBreaksWithinBody) {\n          citation += \"<br/>\";\n        } else {\n          citation += \" \";\n        }\n        if (this.type != \"source\" && this.options.citation_general_addNewlinesWithinBody) {\n          citation += \"\\n\";\n        }\n      }\n      citation += this.externalSiteLink;\n    }\n\n    if (this.dataString) {\n      if (!this.dataString.startsWith(\"{|\")) {\n        citation = this.addBreakNewlineOrAlternatives(citation);\n      } else {\n        citation += \"\\n\"; // always need a newline before table\n      }\n      citation += this.dataString;\n    }\n\n    if (this.sourceReference && this.options.citation_general_referencePosition == \"atEnd\") {\n      citation = this.addBreakNewlineOrAlternatives(citation, \";\");\n      if (!this.sourceReference.toLowerCase().startsWith(\"citing \")) {\n        citation += \"citing \";\n      }\n      citation += this.sourceReference;\n    }\n\n    citation = citation.trim();\n    while (citation.endsWith(\",\")) {\n      citation = citation.substring(0, citation.length - 1).trim();\n    }\n\n    if (!(citation.endsWith(\".\") || citation.endsWith(\"}\"))) {\n      // doesn't end with a period already and doesn't end in template or table\n      // However, it could end with accessed date if there is no data section, or just\n      // a bare link and we don't want a period then. There are various ways we could test\n      // for this\n      if (!(citation.endsWith(\"]\") || citation.endsWith(\">\") || citation.endsWith(\"\\n\") || citation.endsWith(\"* \"))) {\n        // if ends with accessed date then (for now) we don't add a period\n        // (accessed 6 May 2021)\n        if (!/accessed \\d+ \\w+ \\d+\\)$/.test(citation)) {\n          citation += \".\";\n        }\n      }\n    }\n\n    if (this.type != \"source\" && this.options.citation_general_addNewlinesWithinRefs) {\n      citation += \"\\n\";\n    }\n\n    if (this.householdTableString) {\n      if (autoTableOpt == \"withinRefOrSource\") {\n        let tableFormat = this.options.table_general_format;\n        // we used to disallow having a table or list format household if this is a \"source\" type\n        // However, people do want to use the :: style list format in a source\n        // Maybe we should just allow whetever they want?\n        //if (!(this.type == \"source\" && (tableFormat == \"table\" || tableFormat == \"list\"))) {\n        if (!citation.endsWith(\"\\n\")) {\n          if (this.type == \"source\") {\n            if (tableFormat == \"table\" || tableFormat == \"list\") {\n              citation += \"\\n\";\n            } else if (this.options.citation_general_addBreaksWithinBody) {\n              citation += \"<br/>\";\n            } else {\n              citation += \" \";\n            }\n          } else {\n            if (tableFormat == \"table\" || tableFormat == \"list\") {\n              citation += \"\\n\";\n            } else if (this.options.citation_general_addNewlinesWithinRefs) {\n              citation += \"\\n\";\n            } else {\n              citation += \" \";\n            }\n          }\n        }\n        citation += this.householdTableString;\n        if (tableFormat != \"sentence\" || this.options.citation_general_addNewlinesWithinRefs) {\n          citation += \"\\n\";\n        }\n        //}\n      }\n    }\n\n    if (this.type != \"source\") {\n      citation += \"</ref>\";\n    }\n\n    if (this.householdTableString && this.type != \"source\") {\n      if (autoTableOpt == \"afterRef\" || autoTableOpt == \"afterRefBlankLine\") {\n        if (autoTableOpt == \"afterRef\") {\n          citation += \"\\n\";\n        } else if (autoTableOpt == \"afterRefBlankLine\") {\n          citation += \"\\n\\n\";\n        }\n        citation += this.householdTableString;\n      }\n    }\n\n    return citation;\n  }\n}\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9leHRlbnNpb24vYmFzZS9jb3JlL2NpdGF0aW9uX2J1aWxkZXIubWpzLmpzIiwibWFwcGluZ3MiOiI7Ozs7O0FBQUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUV5RDs7QUFFekQ7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2Q0FBNkMsYUFBYSxZQUFZLFVBQVU7QUFDaEY7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLHNCQUFzQjtBQUN0QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQSxNQUFNO0FBQ047QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsTUFBTTtBQUNOLDhCQUE4QjtBQUM5QjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLHNFQUFjOztBQUVsQztBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0Esb0JBQW9CO0FBQ3BCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVO0FBQ1Y7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsUUFBUTtBQUNSO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVTtBQUNWO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVTtBQUNWO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVU7QUFDViw2QkFBNkI7QUFDN0I7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0EsMkJBQTJCO0FBQzNCO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLFVBQVU7QUFDVjtBQUNBO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLFVBQVU7QUFDVjtBQUNBO0FBQ0EsUUFBUTtBQUNSOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVO0FBQ1Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLHdDQUF3QztBQUN4QztBQUNBLFFBQVE7QUFDUiwwQkFBMEI7QUFDMUI7QUFDQTtBQUNBOztBQUVBO0FBQ0EsZ0VBQWdFO0FBQ2hFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsd0RBQXdEO0FBQ3hEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGNBQWM7QUFDZDtBQUNBLGNBQWM7QUFDZDtBQUNBO0FBQ0EsWUFBWTtBQUNaO0FBQ0E7QUFDQSxjQUFjO0FBQ2Q7QUFDQSxjQUFjO0FBQ2Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVO0FBQ1Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRTJCIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vQ2l0YXRpb25FeHRyYWN0b3IvLi9leHRlbnNpb24vYmFzZS9jb3JlL2NpdGF0aW9uX2J1aWxkZXIubWpzPzIzNmIiXSwic291cmNlc0NvbnRlbnQiOlsiLypcbk1JVCBMaWNlbnNlXG5cbkNvcHlyaWdodCAoYykgMjAyMCBSb2JlcnQgTSBQYXZleVxuXG5QZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYSBjb3B5XG5vZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSBcIlNvZnR3YXJlXCIpLCB0byBkZWFsXG5pbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzXG50byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsXG5jb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXNcbmZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6XG5cblRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkIGluIGFsbFxuY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS5cblxuVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEIFwiQVMgSVNcIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUlxuSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksXG5GSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEVcbkFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVJcbkxJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sXG5PVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOIFRIRVxuU09GVFdBUkUuXG4qL1xuXG5pbXBvcnQgeyBidWlsZE5hcnJhdGl2ZSB9IGZyb20gXCIuL25hcnJhdGl2ZV9idWlsZGVyLm1qc1wiO1xuXG4vLyBUaGUgZGlmZmVyZW50IHBhcnRzIG9mIGEgY2l0YXRpb24gYXJlOlxuLy9cbi8vICAgICAtIE1lYW5pbmdmdWwgdGl0bGUuIGUuZy4gMTg1MSBDZW5zdXNcbi8vICAgICAtIFNvdXJjZS9yZXBvc2l0b3J5IG5hbWUgKHBvc3NpYmx5IHdpdGggbGluayB0byBvcmlnaW5hbCBkYXRhKSBlLmcuIDE4NTEgRW5nbGFuZCBDZW5zdXNcbi8vICAgICAtIFNvdXJjZSByZWZlcmVuY2UgZS5nLiBDbGFzczogSE8xMDc7IFBpZWNlOiAxOTQ2OyBGb2xpbzogNjQ3OyBQYWdlOiAyNTsgR1NVIHJvbGw6IDIyMTEwNlxuLy8gICAgIC0gb3B0aW9uYWwgc2hhcmluZyBsaW5rL3RlbXBsYXRlXG4vLyAgICAgLSByZWNvcmQgbGluay90ZW1wbGF0ZSBwbHVzIGFjY2Vzc2VkIGRhdGVcbi8vICAgICAtIG9wdGlvbmFsIGxpbmsgdG8gZXh0ZXJuYWwgc2l0ZSAoZS5nLiBGTVAgaW1hZ2UgZnJvbSBGUylcbi8vICAgICAtIGRhdGEgdGFibGUgb3IgZGF0YVN0cmluZ1xuXG5jbGFzcyBDaXRhdGlvbkJ1aWxkZXIge1xuICBjb25zdHJ1Y3Rvcih0eXBlLCBydW5EYXRlLCBvcHRpb25zKSB7XG4gICAgdGhpcy50eXBlID0gdHlwZTsgLy8gXCJpbmxpbmVcIiwgXCJuYXJyYXRpdmVcIiBvciBcInNvdXJjZVwiXG4gICAgdGhpcy5vcHRpb25zID0gb3B0aW9ucztcbiAgICB0aGlzLnJ1bkRhdGUgPSBydW5EYXRlO1xuICAgIHRoaXMubWVhbmluZ2Z1bFRpdGxlID0gXCJcIjtcbiAgICB0aGlzLnNvdXJjZVRpdGxlID0gXCJcIjtcbiAgICB0aGlzLnNvdXJjZVJlZmVyZW5jZSA9IFwiXCI7XG4gICAgdGhpcy5zaGFyaW5nTGlua09yVGVtcGxhdGUgPSBcIlwiO1xuICAgIHRoaXMucmVjb3JkTGlua09yVGVtcGxhdGUgPSBcIlwiO1xuICAgIHRoaXMuZXh0ZXJuYWxTaXRlTGluayA9IFwiXCI7XG4gICAgdGhpcy5kYXRhU3RyaW5nID0gXCJcIjtcbiAgICB0aGlzLmluY2x1ZGVTdWJzY3JpcHRpb25SZXF1aXJlZCA9IFwibm9uZVwiO1xuICAgIHRoaXMucHV0U291cmNlVGl0bGVJblF1b3RlcyA9IHRydWU7XG4gICAgdGhpcy5kYXRhYmFzZUhhc0ltYWdlcyA9IGZhbHNlO1xuICB9XG5cbiAgZ2V0T3B0aW9ucygpIHtcbiAgICByZXR1cm4gdGhpcy5vcHRpb25zO1xuICB9XG5cbiAgZ2V0RGF0ZVN0cmluZyhkYXRlKSB7XG4gICAgY29uc3QgbW9udGhTdHJpbmdzID0gW1xuICAgICAgXCJKYW51YXJ5XCIsXG4gICAgICBcIkZlYnJ1YXJ5XCIsXG4gICAgICBcIk1hcmNoXCIsXG4gICAgICBcIkFwcmlsXCIsXG4gICAgICBcIk1heVwiLFxuICAgICAgXCJKdW5lXCIsXG4gICAgICBcIkp1bHlcIixcbiAgICAgIFwiQXVndXN0XCIsXG4gICAgICBcIlNlcHRlbWJlclwiLFxuICAgICAgXCJPY3RvYmVyXCIsXG4gICAgICBcIk5vdmVtYmVyXCIsXG4gICAgICBcIkRlY2VtYmVyXCIsXG4gICAgXTtcblxuICAgIGNvbnN0IGRhdGVTdHJpbmcgPSBcIlwiICsgZGF0ZS5nZXREYXRlKCkgKyBcIiBcIiArIG1vbnRoU3RyaW5nc1tkYXRlLmdldE1vbnRoKCldICsgXCIgXCIgKyBkYXRlLmdldEZ1bGxZZWFyKCk7XG5cbiAgICByZXR1cm4gZGF0ZVN0cmluZztcbiAgfVxuXG4gIGdldFN1YlJlcVN0cmluZyhzdWJSZXFPcHRpb24pIHtcbiAgICBsZXQgc3ViUmVxU3RyaW5nID0gXCJcIjtcbiAgICBpZiAoc3ViUmVxT3B0aW9uID09IFwic3Vic2NyaXB0aW9uUmVxdWlyZWRcIikge1xuICAgICAgc3ViUmVxU3RyaW5nID0gXCJzdWJzY3JpcHRpb24gcmVxdWlyZWRcIjtcbiAgICB9IGVsc2UgaWYgKHN1YlJlcU9wdGlvbiA9PSBcInJlcXVpcmVzU3Vic2NyaXB0aW9uXCIpIHtcbiAgICAgIHN1YlJlcVN0cmluZyA9IFwicmVxdWlyZXMgc3Vic2NyaXB0aW9uXCI7XG4gICAgfSBlbHNlIGlmIChzdWJSZXFPcHRpb24gPT0gXCJkb2xsYXJcIikge1xuICAgICAgc3ViUmVxU3RyaW5nID0gXCIkXCI7XG4gICAgfSBlbHNlIGlmIChzdWJSZXFPcHRpb24gPT0gXCJwYXl3YWxsXCIpIHtcbiAgICAgIHN1YlJlcVN0cmluZyA9IFwicGF5d2FsbFwiO1xuICAgIH1cbiAgICByZXR1cm4gc3ViUmVxU3RyaW5nO1xuICB9XG5cbiAgYWRkQnJlYWtOZXdsaW5lT3JBbHRlcm5hdGl2ZXMob2xkQ2l0YXRpb24sIHNlcGFyYXRvckNoYXIgPSBcIixcIikge1xuICAgIGxldCBjaXRhdGlvbiA9IG9sZENpdGF0aW9uO1xuXG4gICAgaWYgKHRoaXMub3B0aW9ucy5jaXRhdGlvbl9nZW5lcmFsX2FkZEJyZWFrc1dpdGhpbkJvZHkpIHtcbiAgICAgIGNpdGF0aW9uICs9IFwiPGJyLz5cIjtcbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKGNpdGF0aW9uLmVuZHNXaXRoKFwiO1wiKSB8fCBjaXRhdGlvbi5lbmRzV2l0aChcIixcIikgfHwgY2l0YXRpb24uZW5kc1dpdGgoXCIuXCIpKSB7XG4gICAgICAgIGNpdGF0aW9uID0gY2l0YXRpb24uc3Vic3RyaW5nKDAsIGNpdGF0aW9uLmxlbmd0aCAtIDEpO1xuICAgICAgfVxuXG4gICAgICBpZiAodGhpcy5vcHRpb25zLmNpdGF0aW9uX2dlbmVyYWxfY29tbWFJbnNpZGVRdW90ZXMgJiYgY2l0YXRpb24uZW5kc1dpdGgoJ1wiJykpIHtcbiAgICAgICAgY2l0YXRpb24gPSBjaXRhdGlvbi5zdWJzdHJpbmcoMCwgY2l0YXRpb24ubGVuZ3RoIC0gMSk7XG4gICAgICAgIGNpdGF0aW9uICs9IHNlcGFyYXRvckNoYXIgKyAnXCInO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY2l0YXRpb24gKz0gc2VwYXJhdG9yQ2hhcjtcbiAgICAgIH1cblxuICAgICAgY2l0YXRpb24gKz0gXCIgXCI7XG4gICAgfVxuICAgIGlmICh0aGlzLnR5cGUgIT0gXCJzb3VyY2VcIiAmJiB0aGlzLm9wdGlvbnMuY2l0YXRpb25fZ2VuZXJhbF9hZGROZXdsaW5lc1dpdGhpbkJvZHkpIHtcbiAgICAgIGNpdGF0aW9uICs9IFwiXFxuXCI7XG4gICAgfVxuXG4gICAgcmV0dXJuIGNpdGF0aW9uO1xuICB9XG5cbiAgYWRkTmFycmF0aXZlKGdkLCBkYXRhQ2FjaGUsIG9wdGlvbnMpIHtcbiAgICAvLyBldmVudHVhbGx5IHRoZXNlIHNob3VsZCBjb21lIGZyb20gdGhlIGRhdGFDYWNoZVxuICAgIC8vIFRoZSBwcm9ibGVtIGlzIGhvdyB0byBiZSBzdXJlIHdlIGdldCBhIHZhbGlkIG1hdGNoIGZyb20gdGhlIGRhdGEgY2FjaGU/XG4gICAgLy8gSXQgY291bGQgYmUgd29ydGgganVzdCBnZXR0aW5nIGl0IGZvciB0aGUgZ2VuZGVyIGZvciBwcm9ub3Vuc1xuICAgIGxldCB3dEV4dHJhY3RlZERhdGEgPSB1bmRlZmluZWQ7XG4gICAgbGV0IHd0R2VuZXJhbGl6ZWREYXRhID0gdW5kZWZpbmVkO1xuXG4gICAgY29uc3QgbmFycmF0aXZlSW5wdXQgPSB7XG4gICAgICBldmVudEdlbmVyYWxpemVkRGF0YTogZ2QsXG4gICAgICB3dEV4dHJhY3RlZERhdGE6IHd0RXh0cmFjdGVkRGF0YSxcbiAgICAgIHd0R2VuZXJhbGl6ZWREYXRhOiB3dEdlbmVyYWxpemVkRGF0YSxcbiAgICAgIG9wdGlvbnM6IG9wdGlvbnMsXG4gICAgfTtcbiAgICBsZXQgbmFycmF0aXZlID0gYnVpbGROYXJyYXRpdmUobmFycmF0aXZlSW5wdXQpO1xuXG4gICAgLy9jb25zb2xlLmxvZyhcImFkZE5hcnJhdGl2ZSwgbmFycmF0aXZlIGlzXCIpO1xuICAgIC8vY29uc29sZS5sb2cobmFycmF0aXZlKTtcblxuICAgIGlmIChuYXJyYXRpdmUpIHtcbiAgICAgIHRoaXMubmFycmF0aXZlID0gbmFycmF0aXZlO1xuICAgIH1cbiAgfVxuXG4gIGJ1aWxkRGF0YUxpc3QocmVjb3JkRGF0YSwga2V5RmlsdGVyRnVuY3Rpb24pIHtcbiAgICBsZXQgaXRlbVNlcCA9IFwiO1wiO1xuICAgIGxldCB2YWx1ZVNlcCA9IFwiOlwiO1xuICAgIGlmICh0aGlzLm9wdGlvbnMuY2l0YXRpb25fZ2VuZXJhbF9kYXRhTGlzdFNlcGFyYXRvciA9PSBcImNvbW1hQ29sb25cIikge1xuICAgICAgaXRlbVNlcCA9IFwiLFwiO1xuICAgICAgdmFsdWVTZXAgPSBcIjpcIjtcbiAgICB9IGVsc2UgaWYgKHRoaXMub3B0aW9ucy5jaXRhdGlvbl9nZW5lcmFsX2RhdGFMaXN0U2VwYXJhdG9yID09IFwiY29tbWFTcGFjZVwiKSB7XG4gICAgICBpdGVtU2VwID0gXCIsXCI7XG4gICAgICB2YWx1ZVNlcCA9IFwiXCI7XG4gICAgfVxuXG4gICAgbGV0IGtleXMgPSBPYmplY3Qua2V5cyhyZWNvcmREYXRhKTtcbiAgICBpZiAoa2V5RmlsdGVyRnVuY3Rpb24pIHtcbiAgICAgIGtleXMgPSBrZXlGaWx0ZXJGdW5jdGlvbihrZXlzLCByZWNvcmREYXRhKTtcbiAgICB9XG5cbiAgICBsZXQgZGF0YUxpc3RTdHJpbmcgPSBcIlwiO1xuXG4gICAgZm9yIChsZXQga2V5IG9mIGtleXMpIHtcbiAgICAgIGxldCB2YWx1ZSA9IHJlY29yZERhdGFba2V5XTtcbiAgICAgIGlmICh2YWx1ZSAmJiB2YWx1ZSAhPSBcIi1cIikge1xuICAgICAgICB2YWx1ZSA9IHZhbHVlLnRyaW0oKTtcbiAgICAgICAgaWYgKGRhdGFMaXN0U3RyaW5nICE9IFwiXCIpIHtcbiAgICAgICAgICBkYXRhTGlzdFN0cmluZyArPSBpdGVtU2VwICsgXCIgXCI7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHZhbHVlLnN0YXJ0c1dpdGgoXCJodHRwXCIpKSB7XG4gICAgICAgICAgZGF0YUxpc3RTdHJpbmcgKz0gXCJbXCIgKyB2YWx1ZSArIFwiIFwiICsga2V5ICsgXCJdXCI7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgZGF0YUxpc3RTdHJpbmcgKz0ga2V5ICsgdmFsdWVTZXAgKyBcIiBcIiArIHZhbHVlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIGRhdGFMaXN0U3RyaW5nO1xuICB9XG5cbiAgZ2V0Q2l0YXRpb25TdHJpbmcoKSB7XG4gICAgbGV0IGF1dG9UYWJsZU9wdCA9IHRoaXMub3B0aW9ucy50YWJsZV9nZW5lcmFsX2F1dG9HZW5lcmF0ZTtcblxuICAgIGxldCBjaXRhdGlvbiA9IFwiXCI7XG4gICAgbGV0IHN1YlJlcVN0cmluZyA9IHRoaXMuZ2V0U3ViUmVxU3RyaW5nKHRoaXMuaW5jbHVkZVN1YnNjcmlwdGlvblJlcXVpcmVkKTtcblxuICAgIGlmICh0aGlzLnR5cGUgPT0gXCJuYXJyYXRpdmVcIiAmJiB0aGlzLm5hcnJhdGl2ZSkge1xuICAgICAgY2l0YXRpb24gKz0gdGhpcy5uYXJyYXRpdmU7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMudHlwZSA9PSBcInNvdXJjZVwiKSB7XG4gICAgICBjaXRhdGlvbiArPSBcIiogXCI7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNpdGF0aW9uICs9IFwiPHJlZj5cIjtcbiAgICB9XG5cbiAgICBpZiAodGhpcy50eXBlICE9IFwic291cmNlXCIgJiYgdGhpcy5vcHRpb25zLmNpdGF0aW9uX2dlbmVyYWxfYWRkTmV3bGluZXNXaXRoaW5SZWZzKSB7XG4gICAgICBjaXRhdGlvbiArPSBcIlxcblwiO1xuICAgIH1cblxuICAgIGlmICh0aGlzLm9wdGlvbnMuY2l0YXRpb25fZ2VuZXJhbF9tZWFuaW5nZnVsTmFtZXMgIT0gXCJub25lXCIgJiYgdGhpcy5tZWFuaW5nZnVsVGl0bGUpIHtcbiAgICAgIGlmICh0aGlzLm9wdGlvbnMuY2l0YXRpb25fZ2VuZXJhbF9tZWFuaW5nZnVsTmFtZXMgPT0gXCJib2xkXCIpIHtcbiAgICAgICAgY2l0YXRpb24gKz0gXCInJydcIiArIHRoaXMubWVhbmluZ2Z1bFRpdGxlICsgXCInJyc6XCI7XG4gICAgICB9IGVsc2UgaWYgKHRoaXMub3B0aW9ucy5jaXRhdGlvbl9nZW5lcmFsX21lYW5pbmdmdWxOYW1lcyA9PSBcIml0YWxpY1wiKSB7XG4gICAgICAgIGNpdGF0aW9uICs9IFwiJydcIiArIHRoaXMubWVhbmluZ2Z1bFRpdGxlICsgXCInJzpcIjtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNpdGF0aW9uICs9IHRoaXMubWVhbmluZ2Z1bFRpdGxlICsgXCI6XCI7XG4gICAgICB9XG5cbiAgICAgIGlmICh0aGlzLnR5cGUgIT0gXCJzb3VyY2VcIiAmJiB0aGlzLm9wdGlvbnMuY2l0YXRpb25fZ2VuZXJhbF9hZGROZXdsaW5lc1dpdGhpbkJvZHkpIHtcbiAgICAgICAgY2l0YXRpb24gKz0gXCJcXG5cIjtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNpdGF0aW9uICs9IFwiIFwiO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmICh0aGlzLnNvdXJjZVRpdGxlKSB7XG4gICAgICBsZXQgc291cmNlVGl0bGUgPSB0aGlzLnNvdXJjZVRpdGxlLnRyaW0oKTtcbiAgICAgIGlmICh0aGlzLnB1dFNvdXJjZVRpdGxlSW5RdW90ZXMpIHtcbiAgICAgICAgc291cmNlVGl0bGUgPSAnXCInICsgc291cmNlVGl0bGUgKyAnXCInO1xuICAgICAgfVxuICAgICAgY2l0YXRpb24gKz0gc291cmNlVGl0bGU7XG5cbiAgICAgIGlmICh0aGlzLm9wdGlvbnMuY2l0YXRpb25fZ2VuZXJhbF9hZGRFZUl0ZW1UeXBlKSB7XG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMuY2l0YXRpb25fZ2VuZXJhbF9jb21tYUluc2lkZVF1b3RlcyAmJiBjaXRhdGlvbi5lbmRzV2l0aCgnXCInKSkge1xuICAgICAgICAgIGNpdGF0aW9uID0gY2l0YXRpb24uc3Vic3RyaW5nKDAsIGNpdGF0aW9uLmxlbmd0aCAtIDEpO1xuICAgICAgICAgIGNpdGF0aW9uICs9ICcsXCInO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNpdGF0aW9uICs9IFwiLFwiO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmRhdGFiYXNlSGFzSW1hZ2VzKSB7XG4gICAgICAgICAgY2l0YXRpb24gKz0gXCIgZGF0YWJhc2Ugd2l0aCBpbWFnZXNcIjtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjaXRhdGlvbiArPSBcIiBkYXRhYmFzZVwiO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGNpdGF0aW9uID0gdGhpcy5hZGRCcmVha05ld2xpbmVPckFsdGVybmF0aXZlcyhjaXRhdGlvbik7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMud2Vic2l0ZUNyZWF0b3JPd25lcikge1xuICAgICAgY2l0YXRpb24gKz0gdGhpcy53ZWJzaXRlQ3JlYXRvck93bmVyO1xuXG4gICAgICBpZiAodGhpcy5zb3VyY2VSZWZlcmVuY2UgJiYgdGhpcy5vcHRpb25zLmNpdGF0aW9uX2dlbmVyYWxfcmVmZXJlbmNlUG9zaXRpb24gPT0gXCJhZnRlclNvdXJjZVRpdGxlXCIpIHtcbiAgICAgICAgY2l0YXRpb24gKz0gXCIsIFwiO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY2l0YXRpb24gPSB0aGlzLmFkZEJyZWFrTmV3bGluZU9yQWx0ZXJuYXRpdmVzKGNpdGF0aW9uKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAodGhpcy5zb3VyY2VSZWZlcmVuY2UgJiYgdGhpcy5vcHRpb25zLmNpdGF0aW9uX2dlbmVyYWxfcmVmZXJlbmNlUG9zaXRpb24gPT0gXCJhZnRlclNvdXJjZVRpdGxlXCIpIHtcbiAgICAgIGNpdGF0aW9uICs9IHRoaXMuc291cmNlUmVmZXJlbmNlO1xuICAgICAgY2l0YXRpb24gPSB0aGlzLmFkZEJyZWFrTmV3bGluZU9yQWx0ZXJuYXRpdmVzKGNpdGF0aW9uKTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5zaGFyaW5nTGlua09yVGVtcGxhdGUpIHtcbiAgICAgIGNpdGF0aW9uICs9IHRoaXMuc2hhcmluZ0xpbmtPclRlbXBsYXRlO1xuICAgICAgaWYgKHRoaXMucmVjb3JkTGlua09yVGVtcGxhdGUpIHtcbiAgICAgICAgaWYgKHN1YlJlcVN0cmluZykge1xuICAgICAgICAgIGNpdGF0aW9uICs9IFwiIChmcmVlIGFjY2Vzcyk8YnIvPlwiO1xuICAgICAgICAgIGlmICh0aGlzLnR5cGUgIT0gXCJzb3VyY2VcIiAmJiB0aGlzLm9wdGlvbnMuY2l0YXRpb25fZ2VuZXJhbF9hZGROZXdsaW5lc1dpdGhpbkJvZHkpIHtcbiAgICAgICAgICAgIGNpdGF0aW9uICs9IFwiXFxuXCI7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNpdGF0aW9uICs9IFwiIC0gXCI7IC8vIHNlcGFyYXRlIHRoZSB0d28gbGlua3Mgd2l0aCBhIGh5cGhlbiBmb3Igc3BhY2VcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0gZWxzZSBpZiAodGhpcy5pbWFnZUxpbmspIHtcbiAgICAgIGNpdGF0aW9uICs9IHRoaXMuaW1hZ2VMaW5rO1xuICAgICAgaWYgKHRoaXMucmVjb3JkTGlua09yVGVtcGxhdGUpIHtcbiAgICAgICAgY2l0YXRpb24gKz0gXCIgLSBcIjsgLy8gc2VwYXJhdGUgdGhlIHR3byBsaW5rcyB3aXRoIGEgaHlwaGVuIGZvciBzcGFjZVxuICAgICAgfVxuICAgIH1cblxuICAgIGlmICh0aGlzLnJlY29yZExpbmtPclRlbXBsYXRlKSB7XG4gICAgICBsZXQgYWNjZXNzZWREYXRlID0gdGhpcy5nZXREYXRlU3RyaW5nKHRoaXMucnVuRGF0ZSk7XG4gICAgICBpZiAodGhpcy5vcHRpb25zLmNpdGF0aW9uX2dlbmVyYWxfYWRkQWNjZXNzZWREYXRlID09IFwicGFyZW5BZnRlckxpbmtcIikge1xuICAgICAgICBjaXRhdGlvbiArPSB0aGlzLnJlY29yZExpbmtPclRlbXBsYXRlO1xuXG4gICAgICAgIGlmIChzdWJSZXFTdHJpbmcpIHtcbiAgICAgICAgICBjaXRhdGlvbiArPSBcIiAoXCIgKyBzdWJSZXFTdHJpbmcgKyBcIiwgYWNjZXNzZWQgXCIgKyBhY2Nlc3NlZERhdGUgKyBcIilcIjtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjaXRhdGlvbiArPSBcIiAoYWNjZXNzZWQgXCIgKyBhY2Nlc3NlZERhdGUgKyBcIilcIjtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmICh0aGlzLm9wdGlvbnMuY2l0YXRpb25fZ2VuZXJhbF9hZGRBY2Nlc3NlZERhdGUgPT0gXCJwYXJlbkJlZm9yZUxpbmtcIikge1xuICAgICAgICBjaXRhdGlvbiArPSBcIihcIjtcbiAgICAgICAgY2l0YXRpb24gKz0gdGhpcy5yZWNvcmRMaW5rT3JUZW1wbGF0ZTtcblxuICAgICAgICBpZiAoc3ViUmVxU3RyaW5nKSB7XG4gICAgICAgICAgY2l0YXRpb24gKz0gXCIgOiBcIiArIHN1YlJlcVN0cmluZyArIFwiLCBhY2Nlc3NlZCBcIiArIGFjY2Vzc2VkRGF0ZSArIFwiKVwiO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNpdGF0aW9uICs9IFwiIDogYWNjZXNzZWQgXCIgKyBhY2Nlc3NlZERhdGUgKyBcIilcIjtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY2l0YXRpb24gKz0gdGhpcy5yZWNvcmRMaW5rT3JUZW1wbGF0ZTtcblxuICAgICAgICBpZiAoc3ViUmVxU3RyaW5nKSB7XG4gICAgICAgICAgY2l0YXRpb24gKz0gXCIgKFwiICsgc3ViUmVxU3RyaW5nICsgXCIpXCI7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAodGhpcy5leHRlcm5hbFNpdGVMaW5rKSB7XG4gICAgICBpZiAoIWNpdGF0aW9uLmVuZHNXaXRoKFwiXFxuXCIpKSB7XG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMuY2l0YXRpb25fZ2VuZXJhbF9hZGRCcmVha3NXaXRoaW5Cb2R5KSB7XG4gICAgICAgICAgY2l0YXRpb24gKz0gXCI8YnIvPlwiO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNpdGF0aW9uICs9IFwiIFwiO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLnR5cGUgIT0gXCJzb3VyY2VcIiAmJiB0aGlzLm9wdGlvbnMuY2l0YXRpb25fZ2VuZXJhbF9hZGROZXdsaW5lc1dpdGhpbkJvZHkpIHtcbiAgICAgICAgICBjaXRhdGlvbiArPSBcIlxcblwiO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBjaXRhdGlvbiArPSB0aGlzLmV4dGVybmFsU2l0ZUxpbms7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuZGF0YVN0cmluZykge1xuICAgICAgaWYgKCF0aGlzLmRhdGFTdHJpbmcuc3RhcnRzV2l0aChcInt8XCIpKSB7XG4gICAgICAgIGNpdGF0aW9uID0gdGhpcy5hZGRCcmVha05ld2xpbmVPckFsdGVybmF0aXZlcyhjaXRhdGlvbik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjaXRhdGlvbiArPSBcIlxcblwiOyAvLyBhbHdheXMgbmVlZCBhIG5ld2xpbmUgYmVmb3JlIHRhYmxlXG4gICAgICB9XG4gICAgICBjaXRhdGlvbiArPSB0aGlzLmRhdGFTdHJpbmc7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuc291cmNlUmVmZXJlbmNlICYmIHRoaXMub3B0aW9ucy5jaXRhdGlvbl9nZW5lcmFsX3JlZmVyZW5jZVBvc2l0aW9uID09IFwiYXRFbmRcIikge1xuICAgICAgY2l0YXRpb24gPSB0aGlzLmFkZEJyZWFrTmV3bGluZU9yQWx0ZXJuYXRpdmVzKGNpdGF0aW9uLCBcIjtcIik7XG4gICAgICBpZiAoIXRoaXMuc291cmNlUmVmZXJlbmNlLnRvTG93ZXJDYXNlKCkuc3RhcnRzV2l0aChcImNpdGluZyBcIikpIHtcbiAgICAgICAgY2l0YXRpb24gKz0gXCJjaXRpbmcgXCI7XG4gICAgICB9XG4gICAgICBjaXRhdGlvbiArPSB0aGlzLnNvdXJjZVJlZmVyZW5jZTtcbiAgICB9XG5cbiAgICBjaXRhdGlvbiA9IGNpdGF0aW9uLnRyaW0oKTtcbiAgICB3aGlsZSAoY2l0YXRpb24uZW5kc1dpdGgoXCIsXCIpKSB7XG4gICAgICBjaXRhdGlvbiA9IGNpdGF0aW9uLnN1YnN0cmluZygwLCBjaXRhdGlvbi5sZW5ndGggLSAxKS50cmltKCk7XG4gICAgfVxuXG4gICAgaWYgKCEoY2l0YXRpb24uZW5kc1dpdGgoXCIuXCIpIHx8IGNpdGF0aW9uLmVuZHNXaXRoKFwifVwiKSkpIHtcbiAgICAgIC8vIGRvZXNuJ3QgZW5kIHdpdGggYSBwZXJpb2QgYWxyZWFkeSBhbmQgZG9lc24ndCBlbmQgaW4gdGVtcGxhdGUgb3IgdGFibGVcbiAgICAgIC8vIEhvd2V2ZXIsIGl0IGNvdWxkIGVuZCB3aXRoIGFjY2Vzc2VkIGRhdGUgaWYgdGhlcmUgaXMgbm8gZGF0YSBzZWN0aW9uLCBvciBqdXN0XG4gICAgICAvLyBhIGJhcmUgbGluayBhbmQgd2UgZG9uJ3Qgd2FudCBhIHBlcmlvZCB0aGVuLiBUaGVyZSBhcmUgdmFyaW91cyB3YXlzIHdlIGNvdWxkIHRlc3RcbiAgICAgIC8vIGZvciB0aGlzXG4gICAgICBpZiAoIShjaXRhdGlvbi5lbmRzV2l0aChcIl1cIikgfHwgY2l0YXRpb24uZW5kc1dpdGgoXCI+XCIpIHx8IGNpdGF0aW9uLmVuZHNXaXRoKFwiXFxuXCIpIHx8IGNpdGF0aW9uLmVuZHNXaXRoKFwiKiBcIikpKSB7XG4gICAgICAgIC8vIGlmIGVuZHMgd2l0aCBhY2Nlc3NlZCBkYXRlIHRoZW4gKGZvciBub3cpIHdlIGRvbid0IGFkZCBhIHBlcmlvZFxuICAgICAgICAvLyAoYWNjZXNzZWQgNiBNYXkgMjAyMSlcbiAgICAgICAgaWYgKCEvYWNjZXNzZWQgXFxkKyBcXHcrIFxcZCtcXCkkLy50ZXN0KGNpdGF0aW9uKSkge1xuICAgICAgICAgIGNpdGF0aW9uICs9IFwiLlwiO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKHRoaXMudHlwZSAhPSBcInNvdXJjZVwiICYmIHRoaXMub3B0aW9ucy5jaXRhdGlvbl9nZW5lcmFsX2FkZE5ld2xpbmVzV2l0aGluUmVmcykge1xuICAgICAgY2l0YXRpb24gKz0gXCJcXG5cIjtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5ob3VzZWhvbGRUYWJsZVN0cmluZykge1xuICAgICAgaWYgKGF1dG9UYWJsZU9wdCA9PSBcIndpdGhpblJlZk9yU291cmNlXCIpIHtcbiAgICAgICAgbGV0IHRhYmxlRm9ybWF0ID0gdGhpcy5vcHRpb25zLnRhYmxlX2dlbmVyYWxfZm9ybWF0O1xuICAgICAgICAvLyB3ZSB1c2VkIHRvIGRpc2FsbG93IGhhdmluZyBhIHRhYmxlIG9yIGxpc3QgZm9ybWF0IGhvdXNlaG9sZCBpZiB0aGlzIGlzIGEgXCJzb3VyY2VcIiB0eXBlXG4gICAgICAgIC8vIEhvd2V2ZXIsIHBlb3BsZSBkbyB3YW50IHRvIHVzZSB0aGUgOjogc3R5bGUgbGlzdCBmb3JtYXQgaW4gYSBzb3VyY2VcbiAgICAgICAgLy8gTWF5YmUgd2Ugc2hvdWxkIGp1c3QgYWxsb3cgd2hldGV2ZXIgdGhleSB3YW50P1xuICAgICAgICAvL2lmICghKHRoaXMudHlwZSA9PSBcInNvdXJjZVwiICYmICh0YWJsZUZvcm1hdCA9PSBcInRhYmxlXCIgfHwgdGFibGVGb3JtYXQgPT0gXCJsaXN0XCIpKSkge1xuICAgICAgICBpZiAoIWNpdGF0aW9uLmVuZHNXaXRoKFwiXFxuXCIpKSB7XG4gICAgICAgICAgaWYgKHRoaXMudHlwZSA9PSBcInNvdXJjZVwiKSB7XG4gICAgICAgICAgICBpZiAodGFibGVGb3JtYXQgPT0gXCJ0YWJsZVwiIHx8IHRhYmxlRm9ybWF0ID09IFwibGlzdFwiKSB7XG4gICAgICAgICAgICAgIGNpdGF0aW9uICs9IFwiXFxuXCI7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMub3B0aW9ucy5jaXRhdGlvbl9nZW5lcmFsX2FkZEJyZWFrc1dpdGhpbkJvZHkpIHtcbiAgICAgICAgICAgICAgY2l0YXRpb24gKz0gXCI8YnIvPlwiO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgY2l0YXRpb24gKz0gXCIgXCI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmICh0YWJsZUZvcm1hdCA9PSBcInRhYmxlXCIgfHwgdGFibGVGb3JtYXQgPT0gXCJsaXN0XCIpIHtcbiAgICAgICAgICAgICAgY2l0YXRpb24gKz0gXCJcXG5cIjtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5vcHRpb25zLmNpdGF0aW9uX2dlbmVyYWxfYWRkTmV3bGluZXNXaXRoaW5SZWZzKSB7XG4gICAgICAgICAgICAgIGNpdGF0aW9uICs9IFwiXFxuXCI7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBjaXRhdGlvbiArPSBcIiBcIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgY2l0YXRpb24gKz0gdGhpcy5ob3VzZWhvbGRUYWJsZVN0cmluZztcbiAgICAgICAgaWYgKHRhYmxlRm9ybWF0ICE9IFwic2VudGVuY2VcIiB8fCB0aGlzLm9wdGlvbnMuY2l0YXRpb25fZ2VuZXJhbF9hZGROZXdsaW5lc1dpdGhpblJlZnMpIHtcbiAgICAgICAgICBjaXRhdGlvbiArPSBcIlxcblwiO1xuICAgICAgICB9XG4gICAgICAgIC8vfVxuICAgICAgfVxuICAgIH1cblxuICAgIGlmICh0aGlzLnR5cGUgIT0gXCJzb3VyY2VcIikge1xuICAgICAgY2l0YXRpb24gKz0gXCI8L3JlZj5cIjtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5ob3VzZWhvbGRUYWJsZVN0cmluZyAmJiB0aGlzLnR5cGUgIT0gXCJzb3VyY2VcIikge1xuICAgICAgaWYgKGF1dG9UYWJsZU9wdCA9PSBcImFmdGVyUmVmXCIgfHwgYXV0b1RhYmxlT3B0ID09IFwiYWZ0ZXJSZWZCbGFua0xpbmVcIikge1xuICAgICAgICBpZiAoYXV0b1RhYmxlT3B0ID09IFwiYWZ0ZXJSZWZcIikge1xuICAgICAgICAgIGNpdGF0aW9uICs9IFwiXFxuXCI7XG4gICAgICAgIH0gZWxzZSBpZiAoYXV0b1RhYmxlT3B0ID09IFwiYWZ0ZXJSZWZCbGFua0xpbmVcIikge1xuICAgICAgICAgIGNpdGF0aW9uICs9IFwiXFxuXFxuXCI7XG4gICAgICAgIH1cbiAgICAgICAgY2l0YXRpb24gKz0gdGhpcy5ob3VzZWhvbGRUYWJsZVN0cmluZztcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gY2l0YXRpb247XG4gIH1cbn1cblxuZXhwb3J0IHsgQ2l0YXRpb25CdWlsZGVyIH07XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./extension/base/core/citation_builder.mjs\n");

/***/ }),

/***/ "./extension/base/core/country_data.mjs":
/*!**********************************************!*\
  !*** ./extension/base/core/country_data.mjs ***!
  \**********************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"CD\": () => (/* binding */ CD)\n/* harmony export */ });\n/*\nMIT License\n\nCopyright (c) 2020 Robert M Pavey\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.\n*/\n\nconst CountryData = [\n  {\n    stdName: \"England\",\n    matches: [\"England\", \"England, United Kingdom\"],\n    partOf: [\"United Kingdom\", \"England and Wales\"],\n    usesMiddleNames: true,\n  },\n  {\n    stdName: \"Wales\",\n    matches: [\"Wales\", \"Wales, United Kingdom\"],\n    partOf: [\"United Kingdom\", \"England and Wales\"],\n    usesMiddleNames: true,\n  },\n  {\n    stdName: \"Scotland\",\n    matches: [\"Scotland\", \"Scotland, United Kingdom\"],\n    partOf: [\"United Kingdom\"],\n    usesMiddleNames: true,\n  },\n  {\n    stdName: \"England and Wales\",\n    matches: [\n      \"England and Wales\",\n      \"England & Wales\",\n      \"England and Wales, United Kingdom\",\n      \"England & Wales, United Kingdom\",\n    ],\n    partOf: [\"United Kingdom\"],\n    invalidCountryName: true, // we never want to use this as a country name in a placename or a search\n    usesMiddleNames: true,\n  },\n  {\n    stdName: \"Guernsey\",\n    matches: [\n      \"Guernsey\",\n      \"Guernsey, United Kingdom\",\n      \"Guernsey, Channel Islands\",\n      \"Guernsey, Channel Islands, United Kingdom\",\n    ],\n    partOf: [\"United Kingdom\", \"Channel Islands\"],\n  },\n  {\n    stdName: \"Jersey\",\n    matches: [\"Jersey\", \"Jersey, United Kingdom\", \"Jersey, Channel Islands\", \"Jersey, Channel Islands, United Kingdom\"],\n    partOf: [\"United Kingdom\", \"Channel Islands\"],\n  },\n  {\n    stdName: \"Channel Islands\",\n    matches: [\"Channel Islands\", \"Channel Islands, United Kingdom\"],\n    partOf: [\"United Kingdom\"],\n  },\n\n  {\n    stdName: \"United Kingdom\",\n    matches: [\"United Kingdom\", \"U.K.\", \"UK\", \"Great Britain\"],\n    usesMiddleNames: true,\n  }, // must come after ones it contains\n\n  { stdName: \"Ireland\", matches: [\"Ireland\"], usesMiddleNames: true },\n  { stdName: \"France\", matches: [\"France\"] },\n  { stdName: \"Germany\", matches: [\"Germany\"] },\n  { stdName: \"Austria\", matches: [\"Austria\"] },\n  { stdName: \"Italy\", matches: [\"Italy\"] },\n  { stdName: \"Netherlands\", matches: [\"Netherlands\"] },\n  { stdName: \"Sweden\", matches: [\"Sweden\"] },\n  { stdName: \"Denmark\", matches: [\"Denmark\"] },\n  { stdName: \"Norway\", matches: [\"Norway\"] },\n  {\n    stdName: \"Poland\",\n    matches: [\"Poland\", \"Polska\"],\n  },\n  {\n    stdName: \"Ukraine\",\n    matches: [\"Ukraine\", \"Україна\", \"Ukraina\"],\n  },\n  {\n    stdName: \"Lithuania\",\n    matches: [\"Lithuania\", \"Lietuva\", \"Litwa\"],\n  },\n  {\n    stdName: \"Belarus\",\n    matches: [\"Belarus\", \"Беларусь\", \"Беларусь, Советский Союз\", \"Białoruś\"],\n  },\n  {\n    stdName: \"Galicia\",\n    matches: [\"Galicia\", \"Galicia, Austria\", \"Galicja\"],\n  },\n\n  { stdName: \"Turkey\", matches: [\"Turkey\"] },\n\n  {\n    stdName: \"United States\",\n    matches: [\"United States\", \"USA\", \"US\", \"U.S.\", \"U.S.A.\", \"U.S\", \"U.S.A\", \"United States of America\"],\n    hasStates: true,\n    usesMiddleNames: true,\n  },\n  {\n    stdName: \"Canada\",\n    matches: [\"Canada\"],\n    hasStates: true,\n    usesMiddleNames: true,\n  },\n  { stdName: \"Mexico\", matches: [\"Mexico\"], hasStates: true },\n\n  {\n    stdName: \"Australia\",\n    matches: [\"Australia\"],\n    hasStates: true,\n    usesMiddleNames: true,\n  },\n  { stdName: \"New Zealand\", matches: [\"New Zealand\"], usesMiddleNames: true },\n  { stdName: \"South Africa\", matches: [\"South Africa\"] },\n];\n\nconst CountyData = {\n  England: [\n    { stdName: \"Avon\", matches: [\"Avon\"] },\n    { stdName: \"Bedfordshire\", matches: [\"Bedfordshire\", \"Beds\"] },\n    { stdName: \"Berkshire\", matches: [\"Berkshire\", \"Berks\"] },\n    { stdName: \"Bristol\", matches: [\"Bristol\"] },\n    { stdName: \"Buckinghamshire\", matches: [\"Buckinghamshire\", \"Bucks\"] },\n    {\n      stdName: \"Cambridgeshire\",\n      matches: [\"Cambridgeshire\", \"Cambs\", \"Isle of Ely\"],\n    },\n    { stdName: \"Cheshire\", matches: [\"Cheshire\"] },\n    { stdName: \"Cleveland\", matches: [\"Cleveland\"] },\n    { stdName: \"Cornwall\", matches: [\"Cornwall\"] },\n    { stdName: \"Cumberland\", matches: [\"Cumberland\"] },\n    { stdName: \"Cumbria\", matches: [\"Cumbria\"] },\n    { stdName: \"Derbyshire\", matches: [\"Derbyshire\"] },\n    { stdName: \"Devon\", matches: [\"Devon\"] },\n    { stdName: \"Dorset\", matches: [\"Dorset\"] },\n    { stdName: \"Durham\", matches: [\"County Durham\", \"Durham\"] },\n    { stdName: \"Essex\", matches: [\"Essex\"] },\n    { stdName: \"Gloucestershire\", matches: [\"Gloucestershire\", \"Glos\"] },\n    { stdName: \"Hampshire\", matches: [\"Hampshire\", \"Isle of Wight\"] },\n    { stdName: \"Herefordshire\", matches: [\"Herefordshire\"] },\n    { stdName: \"Hertfordshire\", matches: [\"Hertfordshire\"] },\n    { stdName: \"Huntingdonshire\", matches: [\"Huntingdonshire\"] },\n    { stdName: \"Humberside\", matches: [\"Humberside\"] },\n    { stdName: \"Kent\", matches: [\"Kent\"] },\n    { stdName: \"Lancashire\", matches: [\"Lancashire\"] },\n    { stdName: \"Leicestershire\", matches: [\"Leicestershire\"] },\n    { stdName: \"Lincolnshire\", matches: [\"Lincolnshire\"] },\n    { stdName: \"Leicestershire\", matches: [\"Leicestershire\"] },\n    {\n      stdName: \"London\",\n      matches: [\"London\", \"Greater London\", \"London (City)\"],\n    },\n    {\n      stdName: \"London & Middlesex\",\n      matches: [\"London & Middlesex\", \"London and Middlesex\", \"London, Middlesex\"],\n    },\n    {\n      stdName: \"London & Surrey\",\n      matches: [\"London & Surrey\", \"London and Surrey\", \"London, Surrey\"],\n    },\n    { stdName: \"London (City)\", matches: [\"London (City)\"] },\n    { stdName: \"Middlesex\", matches: [\"Middlesex\"] },\n    { stdName: \"Norfolk\", matches: [\"Norfolk\"] },\n    { stdName: \"Northamptonshire\", matches: [\"Northamptonshire\"] },\n    { stdName: \"Northumberland\", matches: [\"Northumberland\"] },\n    { stdName: \"Nottinghamshire\", matches: [\"Nottinghamshire\"] },\n    { stdName: \"Oxfordshire\", matches: [\"Oxfordshire\"] },\n    { stdName: \"Rutland\", matches: [\"Rutland\"] },\n    { stdName: \"Shropshire\", matches: [\"Shropshire\"] },\n    { stdName: \"Somerset\", matches: [\"Somerset\"] },\n    { stdName: \"Staffordshire\", matches: [\"Staffordshire\"] },\n    { stdName: \"Suffolk\", matches: [\"Suffolk\"] },\n    { stdName: \"Surrey\", matches: [\"Surrey\"] },\n    { stdName: \"Sussex\", matches: [\"Sussex\", \"East Sussex\", \"West Sussex\"] },\n    { stdName: \"Warwickshire\", matches: [\"Warwickshire\"] },\n    { stdName: \"Westmorland\", matches: [\"Westmorland\"] },\n    { stdName: \"Wiltshire\", matches: [\"Wiltshire\"] },\n    { stdName: \"Worcestershire\", matches: [\"Worcestershire\"] },\n    { stdName: \"Yorkshire\", matches: [\"Yorkshire\"] },\n    { stdName: \"Yorkshire, East Riding\", matches: [\"Yorkshire, East Riding\"] },\n    {\n      stdName: \"Yorkshire, North Riding\",\n      matches: [\"Yorkshire, North Riding\"],\n    },\n    { stdName: \"Yorkshire, West Riding\", matches: [\"Yorkshire, West Riding\"] },\n  ],\n  Wales: [\n    { stdName: \"Anglesey\", matches: [\"Anglesey\"] },\n    { stdName: \"Breconshire\", matches: [\"Breconshire\"] },\n    { stdName: \"Caernarvonshire\", matches: [\"Caernarvonshire\"] },\n    { stdName: \"Cardiganshire\", matches: [\"Cardiganshire\"] },\n    { stdName: \"Carmarthenshire\", matches: [\"Carmarthenshire\"] },\n    { stdName: \"Denbighshire\", matches: [\"Denbighshire\"] },\n    { stdName: \"Flintshire\", matches: [\"Flintshire\"] },\n    { stdName: \"Glamorgan\", matches: [\"Glamorgan\"] },\n    { stdName: \"Merionethshire\", matches: [\"Merionethshire\"] },\n    { stdName: \"Monmouthshire\", matches: [\"Monmouthshire\"] },\n    { stdName: \"Montgomeryshire\", matches: [\"Montgomeryshire\"] },\n    { stdName: \"Pembrokeshire\", matches: [\"Pembrokeshire\"] },\n    { stdName: \"Radnorshire\", matches: [\"Radnorshire\"] },\n    // post 1996\n    { stdName: \"Clwyd\", matches: [\"Clwyd\"] },\n    { stdName: \"Dyfed\", matches: [\"Dyfed\"] },\n    { stdName: \"Gwent\", matches: [\"Gwent\"] },\n    { stdName: \"Gwynedd\", matches: [\"Gwynedd\"] },\n    { stdName: \"Mid Glamorgan\", matches: [\"Mid Glamorgan\"] },\n    { stdName: \"Powys\", matches: [\"Powys\"] },\n    { stdName: \"South Glamorgan\", matches: [\"South Glamorgan\"] },\n    { stdName: \"West Glamorgan\", matches: [\"West Glamorgan\"] },\n  ],\n  Scotland: [\n    { stdName: \"Aberdeenshire\", matches: [\"Aberdeenshire\", \"Aberdeen\"] },\n    { stdName: \"Angus\", matches: [\"Angus\"] },\n    { stdName: \"Argyllshire\", matches: [\"Argyllshire\", \"Argyll\"] },\n    { stdName: \"Ayrshire\", matches: [\"Ayrshire\", \"Ayr\"] },\n    { stdName: \"Banffshire\", matches: [\"Banffshire\", \"Banff\"] },\n    { stdName: \"Berwickshire\", matches: [\"Berwickshire\", \"Berwick\"] },\n    { stdName: \"Bute\", matches: [\"Bute\"] },\n    { stdName: \"Caithness\", matches: [\"Caithness\"] },\n    {\n      stdName: \"Clackmannanshire\",\n      matches: [\"Clackmannanshire\", \"Clackmannan\"],\n    },\n    {\n      stdName: \"Dunbartonshire\",\n      matches: [\"Dunbartonshire\", \"Dunbarton\", \"Dumbartonshire\", \"Dumbarton\"],\n    },\n    { stdName: \"Dumfriesshire\", matches: [\"Dumfriesshire\", \"Dumfries\"] },\n    { stdName: \"East Lothian\", matches: [\"East Lothian\"] },\n    { stdName: \"Edinburgh\", matches: [\"Edinburgh\", \"Edinburghshire\"] },\n    { stdName: \"Fife\", matches: [\"Fife\"] },\n    { stdName: \"Forfarshire\", matches: [\"Forfarshire\", \"Forfar\"] },\n    {\n      stdName: \"Inverness-shire\",\n      matches: [\"Inverness-shire\", \"Invernesshire\", \"Invernessshire\", , \"Inverneshire\", \"Inverness\"],\n    },\n    { stdName: \"Kincardineshire\", matches: [\"Kincardineshire\", \"Kincardine\"] },\n    {\n      stdName: \"Kinross-shire\",\n      matches: [\"Kinross-shire\", \"Kinrossshire\", \"Kinrosshire\", \"Kinroshire\", \"Kinross\"],\n    },\n    {\n      stdName: \"Kirkcudbrightshire\",\n      matches: [\"Kirkcudbrightshire\", \"Kirkcudbright\"],\n    },\n    { stdName: \"Lanarkshire\", matches: [\"Lanarkshire\", \"Lanark\"] },\n    { stdName: \"Midlothian\", matches: [\"Midlothian\"] },\n    { stdName: \"Moray\", matches: [\"Moray\"] },\n    { stdName: \"Nairnshire\", matches: [\"Nairnshire\", \"Nairn\"] },\n    { stdName: \"Orkney\", matches: [\"Orkney\"] },\n    {\n      stdName: \"Peeblesshire\",\n      matches: [\"Peeblesshire\", \"Peebleshire\", \"Peebles-shire\", \"Peebles\"],\n    },\n    { stdName: \"Perthshire\", matches: [\"Perthshire\", \"Perth\"] },\n    { stdName: \"Renfrewshire\", matches: [\"Renfrewshire\", \"Renfrew\"] },\n    {\n      stdName: \"Ross and Cromarty\",\n      matches: [\"Ross and Cromarty\", \"Ross & Cromarty\"],\n    },\n    { stdName: \"Roxburghshire\", matches: [\"Roxburghshire\", \"Roxburgh\"] },\n    { stdName: \"Selkirkshire\", matches: [\"Selkirkshire\", \"Selkirk\"] },\n    { stdName: \"Shetland\", matches: [\"Shetland\"] },\n    { stdName: \"Stirlingshire\", matches: [\"Stirlingshire\", \"Stirling\"] },\n    { stdName: \"Sutherland\", matches: [\"Sutherland\"] },\n    { stdName: \"West Lothian\", matches: [\"West Lothian\"] },\n    { stdName: \"Wigtownshire\", matches: [\"Wigtownshire\", \"Wigtown\"] },\n    // post 1996\n    { stdName: \"Borders\", matches: [\"Borders\"] },\n    { stdName: \"Central\", matches: [\"Central\"] },\n    { stdName: \"Dumfries and Galloway\", matches: [\"Dumfries and Galloway\"] },\n    { stdName: \"Grampian\", matches: [\"Grampian\"] },\n    { stdName: \"Highland\", matches: [\"Highland\"] },\n    { stdName: \"Lothian\", matches: [\"Lothian\"] },\n    { stdName: \"Strathclyde\", matches: [\"Strathclyde\"] },\n    { stdName: \"Tayside\", matches: [\"Tayside\"] },\n    { stdName: \"Western Isles\", matches: [\"Western Isles\"] },\n  ],\n  Ireland: [],\n};\n\nconst CD = {\n  matchCountryFromPlaceName: function (placeName) {\n    for (let country of CountryData) {\n      for (let match of country.matches) {\n        if (placeName == match) {\n          return country;\n        }\n        let ending = \", \" + match;\n        if (placeName.endsWith(ending)) {\n          return country;\n        }\n      }\n    }\n  },\n\n  extractCountryFromPlaceName: function (placeName) {\n    for (let country of CountryData) {\n      for (let match of country.matches) {\n        if (placeName == match) {\n          return { country: country, remainder: \"\" };\n        }\n        let ending = \", \" + match;\n        if (placeName.endsWith(ending)) {\n          let remainder = placeName.substring(0, placeName.length - ending.length);\n          return { country: country, remainder: remainder };\n        }\n      }\n    }\n  },\n\n  isPartOf: function (ownedCountryName, owningCountryName) {\n    for (let country of CountryData) {\n      if (country.stdName == ownedCountryName) {\n        if (country.partOf != undefined) {\n          for (let owner of country.partOf) {\n            if (owner == owningCountryName) {\n              return true;\n            }\n          }\n        }\n        break;\n      }\n    }\n    return false;\n  },\n\n  isValidCountryForPlaceName: function (countryName) {\n    for (let country of CountryData) {\n      if (country.stdName == countryName) {\n        if (country.invalidCountryName) {\n          return false;\n        } else {\n          return true;\n        }\n      }\n    }\n    return false;\n  },\n\n  buildCountryArrayFromPlaceArray: function (placeNames) {\n    let countrySet = new Set();\n    for (let placeName of placeNames) {\n      let country = CD.matchCountryFromPlaceName(placeName);\n      if (country) {\n        countrySet.add(country.stdName);\n      }\n    }\n\n    let foundInvalidCountryContainedByValidCountry = false;\n\n    // we now have a set of unique country names but some may be part of others in the list\n    // if so we want to remove the more general ones and use the specific ones\n    if (countrySet.size > 0) {\n      let finalCountries = [];\n\n      if (countrySet.size == 1) {\n        finalCountries.push(countrySet.values().next().value);\n      } else {\n        for (let country of countrySet) {\n          // see if this country contains one of the other countries\n          let containsOtherCountry = false;\n          for (let otherCountry of countrySet) {\n            if (otherCountry != country) {\n              if (CD.isPartOf(otherCountry, country)) {\n                if (CD.isValidCountryForPlaceName(otherCountry)) {\n                  containsOtherCountry = true;\n                } else {\n                  foundInvalidCountryContainedByValidCountry = true;\n                }\n              }\n            }\n          }\n          if (!containsOtherCountry) {\n            finalCountries.push(country);\n          }\n        }\n      }\n\n      // we could still have an invalid country (like England & Wales) in the list,\n      // if there is also a containing country (like United Kingdom) in the list\n      // then remove the contained invalid country\n      // Otherwise it gets left in list and may get broken into its parts later -\n      // for example in adaptCountryArrayForFamilySearch\n      if (foundInvalidCountryContainedByValidCountry) {\n        let currentCountries = finalCountries;\n        finalCountries = [];\n\n        for (let country of currentCountries) {\n          if (!CD.isValidCountryForPlaceName(country)) {\n            let isContained = false;\n            for (let otherCountry of currentCountries) {\n              if (otherCountry != country) {\n                if (CD.isPartOf(country, otherCountry)) {\n                  isContained = true;\n                  break;\n                }\n              }\n            }\n            if (!isContained) {\n              finalCountries.push(country);\n            }\n          } else {\n            finalCountries.push(country);\n          }\n        }\n      }\n\n      return finalCountries;\n    }\n\n    return undefined;\n  },\n\n  getContainingCountries: function (stdName) {\n    let containingCountries = [];\n\n    for (let country of CountryData) {\n      if (country.stdName == stdName) {\n        let parentCountries = country.partOf;\n        if (parentCountries) {\n          for (let containingCountry of parentCountries) {\n            containingCountries.push(containingCountry);\n          }\n        }\n        break;\n      }\n    }\n\n    return containingCountries;\n  },\n\n  standardizeCountryName: function (countryName) {\n    for (let country of CountryData) {\n      for (let match of country.matches) {\n        if (countryName == match) {\n          return country.stdName;\n        }\n      }\n    }\n  },\n\n  standardizeCountyNameForCountry: function (countyName, country) {\n    // country is a country object\n    let countyArray = CountyData[country.stdName];\n    if (!countyArray || countyArray.length < 1) {\n      return undefined;\n    }\n\n    for (let county of countyArray) {\n      for (let match of county.matches) {\n        if (countyName == match) {\n          return county.stdName;\n        }\n      }\n    }\n\n    return undefined;\n  },\n\n  usesMiddleNames: function (countryName) {\n    let stdName = CD.standardizeCountryName(countryName);\n\n    for (let country of CountryData) {\n      if (country.stdName == stdName) {\n        if (country.usesMiddleNames) {\n          return true;\n        }\n        break;\n      }\n    }\n    return false;\n  },\n};\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9leHRlbnNpb24vYmFzZS9jb3JlL2NvdW50cnlfZGF0YS5tanMuanMiLCJtYXBwaW5ncyI6Ijs7OztBQUFBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUgsSUFBSSxpRUFBaUU7QUFDckUsSUFBSSx3Q0FBd0M7QUFDNUMsSUFBSSwwQ0FBMEM7QUFDOUMsSUFBSSwwQ0FBMEM7QUFDOUMsSUFBSSxzQ0FBc0M7QUFDMUMsSUFBSSxrREFBa0Q7QUFDdEQsSUFBSSx3Q0FBd0M7QUFDNUMsSUFBSSwwQ0FBMEM7QUFDOUMsSUFBSSx3Q0FBd0M7QUFDNUM7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUgsSUFBSSx3Q0FBd0M7O0FBRTVDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSCxJQUFJLHlEQUF5RDs7QUFF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Q0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQkFBa0I7QUFDbEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWTtBQUNaO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQSxHQUFHOztBQUVIO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDs7QUFFYyIsInNvdXJjZXMiOlsid2VicGFjazovL0NpdGF0aW9uRXh0cmFjdG9yLy4vZXh0ZW5zaW9uL2Jhc2UvY29yZS9jb3VudHJ5X2RhdGEubWpzPzA2MDUiXSwic291cmNlc0NvbnRlbnQiOlsiLypcbk1JVCBMaWNlbnNlXG5cbkNvcHlyaWdodCAoYykgMjAyMCBSb2JlcnQgTSBQYXZleVxuXG5QZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYSBjb3B5XG5vZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSBcIlNvZnR3YXJlXCIpLCB0byBkZWFsXG5pbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzXG50byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsXG5jb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXNcbmZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6XG5cblRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkIGluIGFsbFxuY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS5cblxuVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEIFwiQVMgSVNcIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUlxuSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksXG5GSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEVcbkFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVJcbkxJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sXG5PVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOIFRIRVxuU09GVFdBUkUuXG4qL1xuXG5jb25zdCBDb3VudHJ5RGF0YSA9IFtcbiAge1xuICAgIHN0ZE5hbWU6IFwiRW5nbGFuZFwiLFxuICAgIG1hdGNoZXM6IFtcIkVuZ2xhbmRcIiwgXCJFbmdsYW5kLCBVbml0ZWQgS2luZ2RvbVwiXSxcbiAgICBwYXJ0T2Y6IFtcIlVuaXRlZCBLaW5nZG9tXCIsIFwiRW5nbGFuZCBhbmQgV2FsZXNcIl0sXG4gICAgdXNlc01pZGRsZU5hbWVzOiB0cnVlLFxuICB9LFxuICB7XG4gICAgc3RkTmFtZTogXCJXYWxlc1wiLFxuICAgIG1hdGNoZXM6IFtcIldhbGVzXCIsIFwiV2FsZXMsIFVuaXRlZCBLaW5nZG9tXCJdLFxuICAgIHBhcnRPZjogW1wiVW5pdGVkIEtpbmdkb21cIiwgXCJFbmdsYW5kIGFuZCBXYWxlc1wiXSxcbiAgICB1c2VzTWlkZGxlTmFtZXM6IHRydWUsXG4gIH0sXG4gIHtcbiAgICBzdGROYW1lOiBcIlNjb3RsYW5kXCIsXG4gICAgbWF0Y2hlczogW1wiU2NvdGxhbmRcIiwgXCJTY290bGFuZCwgVW5pdGVkIEtpbmdkb21cIl0sXG4gICAgcGFydE9mOiBbXCJVbml0ZWQgS2luZ2RvbVwiXSxcbiAgICB1c2VzTWlkZGxlTmFtZXM6IHRydWUsXG4gIH0sXG4gIHtcbiAgICBzdGROYW1lOiBcIkVuZ2xhbmQgYW5kIFdhbGVzXCIsXG4gICAgbWF0Y2hlczogW1xuICAgICAgXCJFbmdsYW5kIGFuZCBXYWxlc1wiLFxuICAgICAgXCJFbmdsYW5kICYgV2FsZXNcIixcbiAgICAgIFwiRW5nbGFuZCBhbmQgV2FsZXMsIFVuaXRlZCBLaW5nZG9tXCIsXG4gICAgICBcIkVuZ2xhbmQgJiBXYWxlcywgVW5pdGVkIEtpbmdkb21cIixcbiAgICBdLFxuICAgIHBhcnRPZjogW1wiVW5pdGVkIEtpbmdkb21cIl0sXG4gICAgaW52YWxpZENvdW50cnlOYW1lOiB0cnVlLCAvLyB3ZSBuZXZlciB3YW50IHRvIHVzZSB0aGlzIGFzIGEgY291bnRyeSBuYW1lIGluIGEgcGxhY2VuYW1lIG9yIGEgc2VhcmNoXG4gICAgdXNlc01pZGRsZU5hbWVzOiB0cnVlLFxuICB9LFxuICB7XG4gICAgc3RkTmFtZTogXCJHdWVybnNleVwiLFxuICAgIG1hdGNoZXM6IFtcbiAgICAgIFwiR3Vlcm5zZXlcIixcbiAgICAgIFwiR3Vlcm5zZXksIFVuaXRlZCBLaW5nZG9tXCIsXG4gICAgICBcIkd1ZXJuc2V5LCBDaGFubmVsIElzbGFuZHNcIixcbiAgICAgIFwiR3Vlcm5zZXksIENoYW5uZWwgSXNsYW5kcywgVW5pdGVkIEtpbmdkb21cIixcbiAgICBdLFxuICAgIHBhcnRPZjogW1wiVW5pdGVkIEtpbmdkb21cIiwgXCJDaGFubmVsIElzbGFuZHNcIl0sXG4gIH0sXG4gIHtcbiAgICBzdGROYW1lOiBcIkplcnNleVwiLFxuICAgIG1hdGNoZXM6IFtcIkplcnNleVwiLCBcIkplcnNleSwgVW5pdGVkIEtpbmdkb21cIiwgXCJKZXJzZXksIENoYW5uZWwgSXNsYW5kc1wiLCBcIkplcnNleSwgQ2hhbm5lbCBJc2xhbmRzLCBVbml0ZWQgS2luZ2RvbVwiXSxcbiAgICBwYXJ0T2Y6IFtcIlVuaXRlZCBLaW5nZG9tXCIsIFwiQ2hhbm5lbCBJc2xhbmRzXCJdLFxuICB9LFxuICB7XG4gICAgc3RkTmFtZTogXCJDaGFubmVsIElzbGFuZHNcIixcbiAgICBtYXRjaGVzOiBbXCJDaGFubmVsIElzbGFuZHNcIiwgXCJDaGFubmVsIElzbGFuZHMsIFVuaXRlZCBLaW5nZG9tXCJdLFxuICAgIHBhcnRPZjogW1wiVW5pdGVkIEtpbmdkb21cIl0sXG4gIH0sXG5cbiAge1xuICAgIHN0ZE5hbWU6IFwiVW5pdGVkIEtpbmdkb21cIixcbiAgICBtYXRjaGVzOiBbXCJVbml0ZWQgS2luZ2RvbVwiLCBcIlUuSy5cIiwgXCJVS1wiLCBcIkdyZWF0IEJyaXRhaW5cIl0sXG4gICAgdXNlc01pZGRsZU5hbWVzOiB0cnVlLFxuICB9LCAvLyBtdXN0IGNvbWUgYWZ0ZXIgb25lcyBpdCBjb250YWluc1xuXG4gIHsgc3RkTmFtZTogXCJJcmVsYW5kXCIsIG1hdGNoZXM6IFtcIklyZWxhbmRcIl0sIHVzZXNNaWRkbGVOYW1lczogdHJ1ZSB9LFxuICB7IHN0ZE5hbWU6IFwiRnJhbmNlXCIsIG1hdGNoZXM6IFtcIkZyYW5jZVwiXSB9LFxuICB7IHN0ZE5hbWU6IFwiR2VybWFueVwiLCBtYXRjaGVzOiBbXCJHZXJtYW55XCJdIH0sXG4gIHsgc3RkTmFtZTogXCJBdXN0cmlhXCIsIG1hdGNoZXM6IFtcIkF1c3RyaWFcIl0gfSxcbiAgeyBzdGROYW1lOiBcIkl0YWx5XCIsIG1hdGNoZXM6IFtcIkl0YWx5XCJdIH0sXG4gIHsgc3RkTmFtZTogXCJOZXRoZXJsYW5kc1wiLCBtYXRjaGVzOiBbXCJOZXRoZXJsYW5kc1wiXSB9LFxuICB7IHN0ZE5hbWU6IFwiU3dlZGVuXCIsIG1hdGNoZXM6IFtcIlN3ZWRlblwiXSB9LFxuICB7IHN0ZE5hbWU6IFwiRGVubWFya1wiLCBtYXRjaGVzOiBbXCJEZW5tYXJrXCJdIH0sXG4gIHsgc3RkTmFtZTogXCJOb3J3YXlcIiwgbWF0Y2hlczogW1wiTm9yd2F5XCJdIH0sXG4gIHtcbiAgICBzdGROYW1lOiBcIlBvbGFuZFwiLFxuICAgIG1hdGNoZXM6IFtcIlBvbGFuZFwiLCBcIlBvbHNrYVwiXSxcbiAgfSxcbiAge1xuICAgIHN0ZE5hbWU6IFwiVWtyYWluZVwiLFxuICAgIG1hdGNoZXM6IFtcIlVrcmFpbmVcIiwgXCLQo9C60YDQsNGX0L3QsFwiLCBcIlVrcmFpbmFcIl0sXG4gIH0sXG4gIHtcbiAgICBzdGROYW1lOiBcIkxpdGh1YW5pYVwiLFxuICAgIG1hdGNoZXM6IFtcIkxpdGh1YW5pYVwiLCBcIkxpZXR1dmFcIiwgXCJMaXR3YVwiXSxcbiAgfSxcbiAge1xuICAgIHN0ZE5hbWU6IFwiQmVsYXJ1c1wiLFxuICAgIG1hdGNoZXM6IFtcIkJlbGFydXNcIiwgXCLQkdC10LvQsNGA0YPRgdGMXCIsIFwi0JHQtdC70LDRgNGD0YHRjCwg0KHQvtCy0LXRgtGB0LrQuNC5INCh0L7RjtC3XCIsIFwiQmlhxYJvcnXFm1wiXSxcbiAgfSxcbiAge1xuICAgIHN0ZE5hbWU6IFwiR2FsaWNpYVwiLFxuICAgIG1hdGNoZXM6IFtcIkdhbGljaWFcIiwgXCJHYWxpY2lhLCBBdXN0cmlhXCIsIFwiR2FsaWNqYVwiXSxcbiAgfSxcblxuICB7IHN0ZE5hbWU6IFwiVHVya2V5XCIsIG1hdGNoZXM6IFtcIlR1cmtleVwiXSB9LFxuXG4gIHtcbiAgICBzdGROYW1lOiBcIlVuaXRlZCBTdGF0ZXNcIixcbiAgICBtYXRjaGVzOiBbXCJVbml0ZWQgU3RhdGVzXCIsIFwiVVNBXCIsIFwiVVNcIiwgXCJVLlMuXCIsIFwiVS5TLkEuXCIsIFwiVS5TXCIsIFwiVS5TLkFcIiwgXCJVbml0ZWQgU3RhdGVzIG9mIEFtZXJpY2FcIl0sXG4gICAgaGFzU3RhdGVzOiB0cnVlLFxuICAgIHVzZXNNaWRkbGVOYW1lczogdHJ1ZSxcbiAgfSxcbiAge1xuICAgIHN0ZE5hbWU6IFwiQ2FuYWRhXCIsXG4gICAgbWF0Y2hlczogW1wiQ2FuYWRhXCJdLFxuICAgIGhhc1N0YXRlczogdHJ1ZSxcbiAgICB1c2VzTWlkZGxlTmFtZXM6IHRydWUsXG4gIH0sXG4gIHsgc3RkTmFtZTogXCJNZXhpY29cIiwgbWF0Y2hlczogW1wiTWV4aWNvXCJdLCBoYXNTdGF0ZXM6IHRydWUgfSxcblxuICB7XG4gICAgc3RkTmFtZTogXCJBdXN0cmFsaWFcIixcbiAgICBtYXRjaGVzOiBbXCJBdXN0cmFsaWFcIl0sXG4gICAgaGFzU3RhdGVzOiB0cnVlLFxuICAgIHVzZXNNaWRkbGVOYW1lczogdHJ1ZSxcbiAgfSxcbiAgeyBzdGROYW1lOiBcIk5ldyBaZWFsYW5kXCIsIG1hdGNoZXM6IFtcIk5ldyBaZWFsYW5kXCJdLCB1c2VzTWlkZGxlTmFtZXM6IHRydWUgfSxcbiAgeyBzdGROYW1lOiBcIlNvdXRoIEFmcmljYVwiLCBtYXRjaGVzOiBbXCJTb3V0aCBBZnJpY2FcIl0gfSxcbl07XG5cbmNvbnN0IENvdW50eURhdGEgPSB7XG4gIEVuZ2xhbmQ6IFtcbiAgICB7IHN0ZE5hbWU6IFwiQXZvblwiLCBtYXRjaGVzOiBbXCJBdm9uXCJdIH0sXG4gICAgeyBzdGROYW1lOiBcIkJlZGZvcmRzaGlyZVwiLCBtYXRjaGVzOiBbXCJCZWRmb3Jkc2hpcmVcIiwgXCJCZWRzXCJdIH0sXG4gICAgeyBzdGROYW1lOiBcIkJlcmtzaGlyZVwiLCBtYXRjaGVzOiBbXCJCZXJrc2hpcmVcIiwgXCJCZXJrc1wiXSB9LFxuICAgIHsgc3RkTmFtZTogXCJCcmlzdG9sXCIsIG1hdGNoZXM6IFtcIkJyaXN0b2xcIl0gfSxcbiAgICB7IHN0ZE5hbWU6IFwiQnVja2luZ2hhbXNoaXJlXCIsIG1hdGNoZXM6IFtcIkJ1Y2tpbmdoYW1zaGlyZVwiLCBcIkJ1Y2tzXCJdIH0sXG4gICAge1xuICAgICAgc3RkTmFtZTogXCJDYW1icmlkZ2VzaGlyZVwiLFxuICAgICAgbWF0Y2hlczogW1wiQ2FtYnJpZGdlc2hpcmVcIiwgXCJDYW1ic1wiLCBcIklzbGUgb2YgRWx5XCJdLFxuICAgIH0sXG4gICAgeyBzdGROYW1lOiBcIkNoZXNoaXJlXCIsIG1hdGNoZXM6IFtcIkNoZXNoaXJlXCJdIH0sXG4gICAgeyBzdGROYW1lOiBcIkNsZXZlbGFuZFwiLCBtYXRjaGVzOiBbXCJDbGV2ZWxhbmRcIl0gfSxcbiAgICB7IHN0ZE5hbWU6IFwiQ29ybndhbGxcIiwgbWF0Y2hlczogW1wiQ29ybndhbGxcIl0gfSxcbiAgICB7IHN0ZE5hbWU6IFwiQ3VtYmVybGFuZFwiLCBtYXRjaGVzOiBbXCJDdW1iZXJsYW5kXCJdIH0sXG4gICAgeyBzdGROYW1lOiBcIkN1bWJyaWFcIiwgbWF0Y2hlczogW1wiQ3VtYnJpYVwiXSB9LFxuICAgIHsgc3RkTmFtZTogXCJEZXJieXNoaXJlXCIsIG1hdGNoZXM6IFtcIkRlcmJ5c2hpcmVcIl0gfSxcbiAgICB7IHN0ZE5hbWU6IFwiRGV2b25cIiwgbWF0Y2hlczogW1wiRGV2b25cIl0gfSxcbiAgICB7IHN0ZE5hbWU6IFwiRG9yc2V0XCIsIG1hdGNoZXM6IFtcIkRvcnNldFwiXSB9LFxuICAgIHsgc3RkTmFtZTogXCJEdXJoYW1cIiwgbWF0Y2hlczogW1wiQ291bnR5IER1cmhhbVwiLCBcIkR1cmhhbVwiXSB9LFxuICAgIHsgc3RkTmFtZTogXCJFc3NleFwiLCBtYXRjaGVzOiBbXCJFc3NleFwiXSB9LFxuICAgIHsgc3RkTmFtZTogXCJHbG91Y2VzdGVyc2hpcmVcIiwgbWF0Y2hlczogW1wiR2xvdWNlc3RlcnNoaXJlXCIsIFwiR2xvc1wiXSB9LFxuICAgIHsgc3RkTmFtZTogXCJIYW1wc2hpcmVcIiwgbWF0Y2hlczogW1wiSGFtcHNoaXJlXCIsIFwiSXNsZSBvZiBXaWdodFwiXSB9LFxuICAgIHsgc3RkTmFtZTogXCJIZXJlZm9yZHNoaXJlXCIsIG1hdGNoZXM6IFtcIkhlcmVmb3Jkc2hpcmVcIl0gfSxcbiAgICB7IHN0ZE5hbWU6IFwiSGVydGZvcmRzaGlyZVwiLCBtYXRjaGVzOiBbXCJIZXJ0Zm9yZHNoaXJlXCJdIH0sXG4gICAgeyBzdGROYW1lOiBcIkh1bnRpbmdkb25zaGlyZVwiLCBtYXRjaGVzOiBbXCJIdW50aW5nZG9uc2hpcmVcIl0gfSxcbiAgICB7IHN0ZE5hbWU6IFwiSHVtYmVyc2lkZVwiLCBtYXRjaGVzOiBbXCJIdW1iZXJzaWRlXCJdIH0sXG4gICAgeyBzdGROYW1lOiBcIktlbnRcIiwgbWF0Y2hlczogW1wiS2VudFwiXSB9LFxuICAgIHsgc3RkTmFtZTogXCJMYW5jYXNoaXJlXCIsIG1hdGNoZXM6IFtcIkxhbmNhc2hpcmVcIl0gfSxcbiAgICB7IHN0ZE5hbWU6IFwiTGVpY2VzdGVyc2hpcmVcIiwgbWF0Y2hlczogW1wiTGVpY2VzdGVyc2hpcmVcIl0gfSxcbiAgICB7IHN0ZE5hbWU6IFwiTGluY29sbnNoaXJlXCIsIG1hdGNoZXM6IFtcIkxpbmNvbG5zaGlyZVwiXSB9LFxuICAgIHsgc3RkTmFtZTogXCJMZWljZXN0ZXJzaGlyZVwiLCBtYXRjaGVzOiBbXCJMZWljZXN0ZXJzaGlyZVwiXSB9LFxuICAgIHtcbiAgICAgIHN0ZE5hbWU6IFwiTG9uZG9uXCIsXG4gICAgICBtYXRjaGVzOiBbXCJMb25kb25cIiwgXCJHcmVhdGVyIExvbmRvblwiLCBcIkxvbmRvbiAoQ2l0eSlcIl0sXG4gICAgfSxcbiAgICB7XG4gICAgICBzdGROYW1lOiBcIkxvbmRvbiAmIE1pZGRsZXNleFwiLFxuICAgICAgbWF0Y2hlczogW1wiTG9uZG9uICYgTWlkZGxlc2V4XCIsIFwiTG9uZG9uIGFuZCBNaWRkbGVzZXhcIiwgXCJMb25kb24sIE1pZGRsZXNleFwiXSxcbiAgICB9LFxuICAgIHtcbiAgICAgIHN0ZE5hbWU6IFwiTG9uZG9uICYgU3VycmV5XCIsXG4gICAgICBtYXRjaGVzOiBbXCJMb25kb24gJiBTdXJyZXlcIiwgXCJMb25kb24gYW5kIFN1cnJleVwiLCBcIkxvbmRvbiwgU3VycmV5XCJdLFxuICAgIH0sXG4gICAgeyBzdGROYW1lOiBcIkxvbmRvbiAoQ2l0eSlcIiwgbWF0Y2hlczogW1wiTG9uZG9uIChDaXR5KVwiXSB9LFxuICAgIHsgc3RkTmFtZTogXCJNaWRkbGVzZXhcIiwgbWF0Y2hlczogW1wiTWlkZGxlc2V4XCJdIH0sXG4gICAgeyBzdGROYW1lOiBcIk5vcmZvbGtcIiwgbWF0Y2hlczogW1wiTm9yZm9sa1wiXSB9LFxuICAgIHsgc3RkTmFtZTogXCJOb3J0aGFtcHRvbnNoaXJlXCIsIG1hdGNoZXM6IFtcIk5vcnRoYW1wdG9uc2hpcmVcIl0gfSxcbiAgICB7IHN0ZE5hbWU6IFwiTm9ydGh1bWJlcmxhbmRcIiwgbWF0Y2hlczogW1wiTm9ydGh1bWJlcmxhbmRcIl0gfSxcbiAgICB7IHN0ZE5hbWU6IFwiTm90dGluZ2hhbXNoaXJlXCIsIG1hdGNoZXM6IFtcIk5vdHRpbmdoYW1zaGlyZVwiXSB9LFxuICAgIHsgc3RkTmFtZTogXCJPeGZvcmRzaGlyZVwiLCBtYXRjaGVzOiBbXCJPeGZvcmRzaGlyZVwiXSB9LFxuICAgIHsgc3RkTmFtZTogXCJSdXRsYW5kXCIsIG1hdGNoZXM6IFtcIlJ1dGxhbmRcIl0gfSxcbiAgICB7IHN0ZE5hbWU6IFwiU2hyb3BzaGlyZVwiLCBtYXRjaGVzOiBbXCJTaHJvcHNoaXJlXCJdIH0sXG4gICAgeyBzdGROYW1lOiBcIlNvbWVyc2V0XCIsIG1hdGNoZXM6IFtcIlNvbWVyc2V0XCJdIH0sXG4gICAgeyBzdGROYW1lOiBcIlN0YWZmb3Jkc2hpcmVcIiwgbWF0Y2hlczogW1wiU3RhZmZvcmRzaGlyZVwiXSB9LFxuICAgIHsgc3RkTmFtZTogXCJTdWZmb2xrXCIsIG1hdGNoZXM6IFtcIlN1ZmZvbGtcIl0gfSxcbiAgICB7IHN0ZE5hbWU6IFwiU3VycmV5XCIsIG1hdGNoZXM6IFtcIlN1cnJleVwiXSB9LFxuICAgIHsgc3RkTmFtZTogXCJTdXNzZXhcIiwgbWF0Y2hlczogW1wiU3Vzc2V4XCIsIFwiRWFzdCBTdXNzZXhcIiwgXCJXZXN0IFN1c3NleFwiXSB9LFxuICAgIHsgc3RkTmFtZTogXCJXYXJ3aWNrc2hpcmVcIiwgbWF0Y2hlczogW1wiV2Fyd2lja3NoaXJlXCJdIH0sXG4gICAgeyBzdGROYW1lOiBcIldlc3Rtb3JsYW5kXCIsIG1hdGNoZXM6IFtcIldlc3Rtb3JsYW5kXCJdIH0sXG4gICAgeyBzdGROYW1lOiBcIldpbHRzaGlyZVwiLCBtYXRjaGVzOiBbXCJXaWx0c2hpcmVcIl0gfSxcbiAgICB7IHN0ZE5hbWU6IFwiV29yY2VzdGVyc2hpcmVcIiwgbWF0Y2hlczogW1wiV29yY2VzdGVyc2hpcmVcIl0gfSxcbiAgICB7IHN0ZE5hbWU6IFwiWW9ya3NoaXJlXCIsIG1hdGNoZXM6IFtcIllvcmtzaGlyZVwiXSB9LFxuICAgIHsgc3RkTmFtZTogXCJZb3Jrc2hpcmUsIEVhc3QgUmlkaW5nXCIsIG1hdGNoZXM6IFtcIllvcmtzaGlyZSwgRWFzdCBSaWRpbmdcIl0gfSxcbiAgICB7XG4gICAgICBzdGROYW1lOiBcIllvcmtzaGlyZSwgTm9ydGggUmlkaW5nXCIsXG4gICAgICBtYXRjaGVzOiBbXCJZb3Jrc2hpcmUsIE5vcnRoIFJpZGluZ1wiXSxcbiAgICB9LFxuICAgIHsgc3RkTmFtZTogXCJZb3Jrc2hpcmUsIFdlc3QgUmlkaW5nXCIsIG1hdGNoZXM6IFtcIllvcmtzaGlyZSwgV2VzdCBSaWRpbmdcIl0gfSxcbiAgXSxcbiAgV2FsZXM6IFtcbiAgICB7IHN0ZE5hbWU6IFwiQW5nbGVzZXlcIiwgbWF0Y2hlczogW1wiQW5nbGVzZXlcIl0gfSxcbiAgICB7IHN0ZE5hbWU6IFwiQnJlY29uc2hpcmVcIiwgbWF0Y2hlczogW1wiQnJlY29uc2hpcmVcIl0gfSxcbiAgICB7IHN0ZE5hbWU6IFwiQ2Flcm5hcnZvbnNoaXJlXCIsIG1hdGNoZXM6IFtcIkNhZXJuYXJ2b25zaGlyZVwiXSB9LFxuICAgIHsgc3RkTmFtZTogXCJDYXJkaWdhbnNoaXJlXCIsIG1hdGNoZXM6IFtcIkNhcmRpZ2Fuc2hpcmVcIl0gfSxcbiAgICB7IHN0ZE5hbWU6IFwiQ2FybWFydGhlbnNoaXJlXCIsIG1hdGNoZXM6IFtcIkNhcm1hcnRoZW5zaGlyZVwiXSB9LFxuICAgIHsgc3RkTmFtZTogXCJEZW5iaWdoc2hpcmVcIiwgbWF0Y2hlczogW1wiRGVuYmlnaHNoaXJlXCJdIH0sXG4gICAgeyBzdGROYW1lOiBcIkZsaW50c2hpcmVcIiwgbWF0Y2hlczogW1wiRmxpbnRzaGlyZVwiXSB9LFxuICAgIHsgc3RkTmFtZTogXCJHbGFtb3JnYW5cIiwgbWF0Y2hlczogW1wiR2xhbW9yZ2FuXCJdIH0sXG4gICAgeyBzdGROYW1lOiBcIk1lcmlvbmV0aHNoaXJlXCIsIG1hdGNoZXM6IFtcIk1lcmlvbmV0aHNoaXJlXCJdIH0sXG4gICAgeyBzdGROYW1lOiBcIk1vbm1vdXRoc2hpcmVcIiwgbWF0Y2hlczogW1wiTW9ubW91dGhzaGlyZVwiXSB9LFxuICAgIHsgc3RkTmFtZTogXCJNb250Z29tZXJ5c2hpcmVcIiwgbWF0Y2hlczogW1wiTW9udGdvbWVyeXNoaXJlXCJdIH0sXG4gICAgeyBzdGROYW1lOiBcIlBlbWJyb2tlc2hpcmVcIiwgbWF0Y2hlczogW1wiUGVtYnJva2VzaGlyZVwiXSB9LFxuICAgIHsgc3RkTmFtZTogXCJSYWRub3JzaGlyZVwiLCBtYXRjaGVzOiBbXCJSYWRub3JzaGlyZVwiXSB9LFxuICAgIC8vIHBvc3QgMTk5NlxuICAgIHsgc3RkTmFtZTogXCJDbHd5ZFwiLCBtYXRjaGVzOiBbXCJDbHd5ZFwiXSB9LFxuICAgIHsgc3RkTmFtZTogXCJEeWZlZFwiLCBtYXRjaGVzOiBbXCJEeWZlZFwiXSB9LFxuICAgIHsgc3RkTmFtZTogXCJHd2VudFwiLCBtYXRjaGVzOiBbXCJHd2VudFwiXSB9LFxuICAgIHsgc3RkTmFtZTogXCJHd3luZWRkXCIsIG1hdGNoZXM6IFtcIkd3eW5lZGRcIl0gfSxcbiAgICB7IHN0ZE5hbWU6IFwiTWlkIEdsYW1vcmdhblwiLCBtYXRjaGVzOiBbXCJNaWQgR2xhbW9yZ2FuXCJdIH0sXG4gICAgeyBzdGROYW1lOiBcIlBvd3lzXCIsIG1hdGNoZXM6IFtcIlBvd3lzXCJdIH0sXG4gICAgeyBzdGROYW1lOiBcIlNvdXRoIEdsYW1vcmdhblwiLCBtYXRjaGVzOiBbXCJTb3V0aCBHbGFtb3JnYW5cIl0gfSxcbiAgICB7IHN0ZE5hbWU6IFwiV2VzdCBHbGFtb3JnYW5cIiwgbWF0Y2hlczogW1wiV2VzdCBHbGFtb3JnYW5cIl0gfSxcbiAgXSxcbiAgU2NvdGxhbmQ6IFtcbiAgICB7IHN0ZE5hbWU6IFwiQWJlcmRlZW5zaGlyZVwiLCBtYXRjaGVzOiBbXCJBYmVyZGVlbnNoaXJlXCIsIFwiQWJlcmRlZW5cIl0gfSxcbiAgICB7IHN0ZE5hbWU6IFwiQW5ndXNcIiwgbWF0Y2hlczogW1wiQW5ndXNcIl0gfSxcbiAgICB7IHN0ZE5hbWU6IFwiQXJneWxsc2hpcmVcIiwgbWF0Y2hlczogW1wiQXJneWxsc2hpcmVcIiwgXCJBcmd5bGxcIl0gfSxcbiAgICB7IHN0ZE5hbWU6IFwiQXlyc2hpcmVcIiwgbWF0Y2hlczogW1wiQXlyc2hpcmVcIiwgXCJBeXJcIl0gfSxcbiAgICB7IHN0ZE5hbWU6IFwiQmFuZmZzaGlyZVwiLCBtYXRjaGVzOiBbXCJCYW5mZnNoaXJlXCIsIFwiQmFuZmZcIl0gfSxcbiAgICB7IHN0ZE5hbWU6IFwiQmVyd2lja3NoaXJlXCIsIG1hdGNoZXM6IFtcIkJlcndpY2tzaGlyZVwiLCBcIkJlcndpY2tcIl0gfSxcbiAgICB7IHN0ZE5hbWU6IFwiQnV0ZVwiLCBtYXRjaGVzOiBbXCJCdXRlXCJdIH0sXG4gICAgeyBzdGROYW1lOiBcIkNhaXRobmVzc1wiLCBtYXRjaGVzOiBbXCJDYWl0aG5lc3NcIl0gfSxcbiAgICB7XG4gICAgICBzdGROYW1lOiBcIkNsYWNrbWFubmFuc2hpcmVcIixcbiAgICAgIG1hdGNoZXM6IFtcIkNsYWNrbWFubmFuc2hpcmVcIiwgXCJDbGFja21hbm5hblwiXSxcbiAgICB9LFxuICAgIHtcbiAgICAgIHN0ZE5hbWU6IFwiRHVuYmFydG9uc2hpcmVcIixcbiAgICAgIG1hdGNoZXM6IFtcIkR1bmJhcnRvbnNoaXJlXCIsIFwiRHVuYmFydG9uXCIsIFwiRHVtYmFydG9uc2hpcmVcIiwgXCJEdW1iYXJ0b25cIl0sXG4gICAgfSxcbiAgICB7IHN0ZE5hbWU6IFwiRHVtZnJpZXNzaGlyZVwiLCBtYXRjaGVzOiBbXCJEdW1mcmllc3NoaXJlXCIsIFwiRHVtZnJpZXNcIl0gfSxcbiAgICB7IHN0ZE5hbWU6IFwiRWFzdCBMb3RoaWFuXCIsIG1hdGNoZXM6IFtcIkVhc3QgTG90aGlhblwiXSB9LFxuICAgIHsgc3RkTmFtZTogXCJFZGluYnVyZ2hcIiwgbWF0Y2hlczogW1wiRWRpbmJ1cmdoXCIsIFwiRWRpbmJ1cmdoc2hpcmVcIl0gfSxcbiAgICB7IHN0ZE5hbWU6IFwiRmlmZVwiLCBtYXRjaGVzOiBbXCJGaWZlXCJdIH0sXG4gICAgeyBzdGROYW1lOiBcIkZvcmZhcnNoaXJlXCIsIG1hdGNoZXM6IFtcIkZvcmZhcnNoaXJlXCIsIFwiRm9yZmFyXCJdIH0sXG4gICAge1xuICAgICAgc3RkTmFtZTogXCJJbnZlcm5lc3Mtc2hpcmVcIixcbiAgICAgIG1hdGNoZXM6IFtcIkludmVybmVzcy1zaGlyZVwiLCBcIkludmVybmVzc2hpcmVcIiwgXCJJbnZlcm5lc3NzaGlyZVwiLCAsIFwiSW52ZXJuZXNoaXJlXCIsIFwiSW52ZXJuZXNzXCJdLFxuICAgIH0sXG4gICAgeyBzdGROYW1lOiBcIktpbmNhcmRpbmVzaGlyZVwiLCBtYXRjaGVzOiBbXCJLaW5jYXJkaW5lc2hpcmVcIiwgXCJLaW5jYXJkaW5lXCJdIH0sXG4gICAge1xuICAgICAgc3RkTmFtZTogXCJLaW5yb3NzLXNoaXJlXCIsXG4gICAgICBtYXRjaGVzOiBbXCJLaW5yb3NzLXNoaXJlXCIsIFwiS2lucm9zc3NoaXJlXCIsIFwiS2lucm9zc2hpcmVcIiwgXCJLaW5yb3NoaXJlXCIsIFwiS2lucm9zc1wiXSxcbiAgICB9LFxuICAgIHtcbiAgICAgIHN0ZE5hbWU6IFwiS2lya2N1ZGJyaWdodHNoaXJlXCIsXG4gICAgICBtYXRjaGVzOiBbXCJLaXJrY3VkYnJpZ2h0c2hpcmVcIiwgXCJLaXJrY3VkYnJpZ2h0XCJdLFxuICAgIH0sXG4gICAgeyBzdGROYW1lOiBcIkxhbmFya3NoaXJlXCIsIG1hdGNoZXM6IFtcIkxhbmFya3NoaXJlXCIsIFwiTGFuYXJrXCJdIH0sXG4gICAgeyBzdGROYW1lOiBcIk1pZGxvdGhpYW5cIiwgbWF0Y2hlczogW1wiTWlkbG90aGlhblwiXSB9LFxuICAgIHsgc3RkTmFtZTogXCJNb3JheVwiLCBtYXRjaGVzOiBbXCJNb3JheVwiXSB9LFxuICAgIHsgc3RkTmFtZTogXCJOYWlybnNoaXJlXCIsIG1hdGNoZXM6IFtcIk5haXJuc2hpcmVcIiwgXCJOYWlyblwiXSB9LFxuICAgIHsgc3RkTmFtZTogXCJPcmtuZXlcIiwgbWF0Y2hlczogW1wiT3JrbmV5XCJdIH0sXG4gICAge1xuICAgICAgc3RkTmFtZTogXCJQZWVibGVzc2hpcmVcIixcbiAgICAgIG1hdGNoZXM6IFtcIlBlZWJsZXNzaGlyZVwiLCBcIlBlZWJsZXNoaXJlXCIsIFwiUGVlYmxlcy1zaGlyZVwiLCBcIlBlZWJsZXNcIl0sXG4gICAgfSxcbiAgICB7IHN0ZE5hbWU6IFwiUGVydGhzaGlyZVwiLCBtYXRjaGVzOiBbXCJQZXJ0aHNoaXJlXCIsIFwiUGVydGhcIl0gfSxcbiAgICB7IHN0ZE5hbWU6IFwiUmVuZnJld3NoaXJlXCIsIG1hdGNoZXM6IFtcIlJlbmZyZXdzaGlyZVwiLCBcIlJlbmZyZXdcIl0gfSxcbiAgICB7XG4gICAgICBzdGROYW1lOiBcIlJvc3MgYW5kIENyb21hcnR5XCIsXG4gICAgICBtYXRjaGVzOiBbXCJSb3NzIGFuZCBDcm9tYXJ0eVwiLCBcIlJvc3MgJiBDcm9tYXJ0eVwiXSxcbiAgICB9LFxuICAgIHsgc3RkTmFtZTogXCJSb3hidXJnaHNoaXJlXCIsIG1hdGNoZXM6IFtcIlJveGJ1cmdoc2hpcmVcIiwgXCJSb3hidXJnaFwiXSB9LFxuICAgIHsgc3RkTmFtZTogXCJTZWxraXJrc2hpcmVcIiwgbWF0Y2hlczogW1wiU2Vsa2lya3NoaXJlXCIsIFwiU2Vsa2lya1wiXSB9LFxuICAgIHsgc3RkTmFtZTogXCJTaGV0bGFuZFwiLCBtYXRjaGVzOiBbXCJTaGV0bGFuZFwiXSB9LFxuICAgIHsgc3RkTmFtZTogXCJTdGlybGluZ3NoaXJlXCIsIG1hdGNoZXM6IFtcIlN0aXJsaW5nc2hpcmVcIiwgXCJTdGlybGluZ1wiXSB9LFxuICAgIHsgc3RkTmFtZTogXCJTdXRoZXJsYW5kXCIsIG1hdGNoZXM6IFtcIlN1dGhlcmxhbmRcIl0gfSxcbiAgICB7IHN0ZE5hbWU6IFwiV2VzdCBMb3RoaWFuXCIsIG1hdGNoZXM6IFtcIldlc3QgTG90aGlhblwiXSB9LFxuICAgIHsgc3RkTmFtZTogXCJXaWd0b3duc2hpcmVcIiwgbWF0Y2hlczogW1wiV2lndG93bnNoaXJlXCIsIFwiV2lndG93blwiXSB9LFxuICAgIC8vIHBvc3QgMTk5NlxuICAgIHsgc3RkTmFtZTogXCJCb3JkZXJzXCIsIG1hdGNoZXM6IFtcIkJvcmRlcnNcIl0gfSxcbiAgICB7IHN0ZE5hbWU6IFwiQ2VudHJhbFwiLCBtYXRjaGVzOiBbXCJDZW50cmFsXCJdIH0sXG4gICAgeyBzdGROYW1lOiBcIkR1bWZyaWVzIGFuZCBHYWxsb3dheVwiLCBtYXRjaGVzOiBbXCJEdW1mcmllcyBhbmQgR2FsbG93YXlcIl0gfSxcbiAgICB7IHN0ZE5hbWU6IFwiR3JhbXBpYW5cIiwgbWF0Y2hlczogW1wiR3JhbXBpYW5cIl0gfSxcbiAgICB7IHN0ZE5hbWU6IFwiSGlnaGxhbmRcIiwgbWF0Y2hlczogW1wiSGlnaGxhbmRcIl0gfSxcbiAgICB7IHN0ZE5hbWU6IFwiTG90aGlhblwiLCBtYXRjaGVzOiBbXCJMb3RoaWFuXCJdIH0sXG4gICAgeyBzdGROYW1lOiBcIlN0cmF0aGNseWRlXCIsIG1hdGNoZXM6IFtcIlN0cmF0aGNseWRlXCJdIH0sXG4gICAgeyBzdGROYW1lOiBcIlRheXNpZGVcIiwgbWF0Y2hlczogW1wiVGF5c2lkZVwiXSB9LFxuICAgIHsgc3RkTmFtZTogXCJXZXN0ZXJuIElzbGVzXCIsIG1hdGNoZXM6IFtcIldlc3Rlcm4gSXNsZXNcIl0gfSxcbiAgXSxcbiAgSXJlbGFuZDogW10sXG59O1xuXG5jb25zdCBDRCA9IHtcbiAgbWF0Y2hDb3VudHJ5RnJvbVBsYWNlTmFtZTogZnVuY3Rpb24gKHBsYWNlTmFtZSkge1xuICAgIGZvciAobGV0IGNvdW50cnkgb2YgQ291bnRyeURhdGEpIHtcbiAgICAgIGZvciAobGV0IG1hdGNoIG9mIGNvdW50cnkubWF0Y2hlcykge1xuICAgICAgICBpZiAocGxhY2VOYW1lID09IG1hdGNoKSB7XG4gICAgICAgICAgcmV0dXJuIGNvdW50cnk7XG4gICAgICAgIH1cbiAgICAgICAgbGV0IGVuZGluZyA9IFwiLCBcIiArIG1hdGNoO1xuICAgICAgICBpZiAocGxhY2VOYW1lLmVuZHNXaXRoKGVuZGluZykpIHtcbiAgICAgICAgICByZXR1cm4gY291bnRyeTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfSxcblxuICBleHRyYWN0Q291bnRyeUZyb21QbGFjZU5hbWU6IGZ1bmN0aW9uIChwbGFjZU5hbWUpIHtcbiAgICBmb3IgKGxldCBjb3VudHJ5IG9mIENvdW50cnlEYXRhKSB7XG4gICAgICBmb3IgKGxldCBtYXRjaCBvZiBjb3VudHJ5Lm1hdGNoZXMpIHtcbiAgICAgICAgaWYgKHBsYWNlTmFtZSA9PSBtYXRjaCkge1xuICAgICAgICAgIHJldHVybiB7IGNvdW50cnk6IGNvdW50cnksIHJlbWFpbmRlcjogXCJcIiB9O1xuICAgICAgICB9XG4gICAgICAgIGxldCBlbmRpbmcgPSBcIiwgXCIgKyBtYXRjaDtcbiAgICAgICAgaWYgKHBsYWNlTmFtZS5lbmRzV2l0aChlbmRpbmcpKSB7XG4gICAgICAgICAgbGV0IHJlbWFpbmRlciA9IHBsYWNlTmFtZS5zdWJzdHJpbmcoMCwgcGxhY2VOYW1lLmxlbmd0aCAtIGVuZGluZy5sZW5ndGgpO1xuICAgICAgICAgIHJldHVybiB7IGNvdW50cnk6IGNvdW50cnksIHJlbWFpbmRlcjogcmVtYWluZGVyIH07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH0sXG5cbiAgaXNQYXJ0T2Y6IGZ1bmN0aW9uIChvd25lZENvdW50cnlOYW1lLCBvd25pbmdDb3VudHJ5TmFtZSkge1xuICAgIGZvciAobGV0IGNvdW50cnkgb2YgQ291bnRyeURhdGEpIHtcbiAgICAgIGlmIChjb3VudHJ5LnN0ZE5hbWUgPT0gb3duZWRDb3VudHJ5TmFtZSkge1xuICAgICAgICBpZiAoY291bnRyeS5wYXJ0T2YgIT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgZm9yIChsZXQgb3duZXIgb2YgY291bnRyeS5wYXJ0T2YpIHtcbiAgICAgICAgICAgIGlmIChvd25lciA9PSBvd25pbmdDb3VudHJ5TmFtZSkge1xuICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfSxcblxuICBpc1ZhbGlkQ291bnRyeUZvclBsYWNlTmFtZTogZnVuY3Rpb24gKGNvdW50cnlOYW1lKSB7XG4gICAgZm9yIChsZXQgY291bnRyeSBvZiBDb3VudHJ5RGF0YSkge1xuICAgICAgaWYgKGNvdW50cnkuc3RkTmFtZSA9PSBjb3VudHJ5TmFtZSkge1xuICAgICAgICBpZiAoY291bnRyeS5pbnZhbGlkQ291bnRyeU5hbWUpIHtcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9LFxuXG4gIGJ1aWxkQ291bnRyeUFycmF5RnJvbVBsYWNlQXJyYXk6IGZ1bmN0aW9uIChwbGFjZU5hbWVzKSB7XG4gICAgbGV0IGNvdW50cnlTZXQgPSBuZXcgU2V0KCk7XG4gICAgZm9yIChsZXQgcGxhY2VOYW1lIG9mIHBsYWNlTmFtZXMpIHtcbiAgICAgIGxldCBjb3VudHJ5ID0gQ0QubWF0Y2hDb3VudHJ5RnJvbVBsYWNlTmFtZShwbGFjZU5hbWUpO1xuICAgICAgaWYgKGNvdW50cnkpIHtcbiAgICAgICAgY291bnRyeVNldC5hZGQoY291bnRyeS5zdGROYW1lKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBsZXQgZm91bmRJbnZhbGlkQ291bnRyeUNvbnRhaW5lZEJ5VmFsaWRDb3VudHJ5ID0gZmFsc2U7XG5cbiAgICAvLyB3ZSBub3cgaGF2ZSBhIHNldCBvZiB1bmlxdWUgY291bnRyeSBuYW1lcyBidXQgc29tZSBtYXkgYmUgcGFydCBvZiBvdGhlcnMgaW4gdGhlIGxpc3RcbiAgICAvLyBpZiBzbyB3ZSB3YW50IHRvIHJlbW92ZSB0aGUgbW9yZSBnZW5lcmFsIG9uZXMgYW5kIHVzZSB0aGUgc3BlY2lmaWMgb25lc1xuICAgIGlmIChjb3VudHJ5U2V0LnNpemUgPiAwKSB7XG4gICAgICBsZXQgZmluYWxDb3VudHJpZXMgPSBbXTtcblxuICAgICAgaWYgKGNvdW50cnlTZXQuc2l6ZSA9PSAxKSB7XG4gICAgICAgIGZpbmFsQ291bnRyaWVzLnB1c2goY291bnRyeVNldC52YWx1ZXMoKS5uZXh0KCkudmFsdWUpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZm9yIChsZXQgY291bnRyeSBvZiBjb3VudHJ5U2V0KSB7XG4gICAgICAgICAgLy8gc2VlIGlmIHRoaXMgY291bnRyeSBjb250YWlucyBvbmUgb2YgdGhlIG90aGVyIGNvdW50cmllc1xuICAgICAgICAgIGxldCBjb250YWluc090aGVyQ291bnRyeSA9IGZhbHNlO1xuICAgICAgICAgIGZvciAobGV0IG90aGVyQ291bnRyeSBvZiBjb3VudHJ5U2V0KSB7XG4gICAgICAgICAgICBpZiAob3RoZXJDb3VudHJ5ICE9IGNvdW50cnkpIHtcbiAgICAgICAgICAgICAgaWYgKENELmlzUGFydE9mKG90aGVyQ291bnRyeSwgY291bnRyeSkpIHtcbiAgICAgICAgICAgICAgICBpZiAoQ0QuaXNWYWxpZENvdW50cnlGb3JQbGFjZU5hbWUob3RoZXJDb3VudHJ5KSkge1xuICAgICAgICAgICAgICAgICAgY29udGFpbnNPdGhlckNvdW50cnkgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICBmb3VuZEludmFsaWRDb3VudHJ5Q29udGFpbmVkQnlWYWxpZENvdW50cnkgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoIWNvbnRhaW5zT3RoZXJDb3VudHJ5KSB7XG4gICAgICAgICAgICBmaW5hbENvdW50cmllcy5wdXNoKGNvdW50cnkpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyB3ZSBjb3VsZCBzdGlsbCBoYXZlIGFuIGludmFsaWQgY291bnRyeSAobGlrZSBFbmdsYW5kICYgV2FsZXMpIGluIHRoZSBsaXN0LFxuICAgICAgLy8gaWYgdGhlcmUgaXMgYWxzbyBhIGNvbnRhaW5pbmcgY291bnRyeSAobGlrZSBVbml0ZWQgS2luZ2RvbSkgaW4gdGhlIGxpc3RcbiAgICAgIC8vIHRoZW4gcmVtb3ZlIHRoZSBjb250YWluZWQgaW52YWxpZCBjb3VudHJ5XG4gICAgICAvLyBPdGhlcndpc2UgaXQgZ2V0cyBsZWZ0IGluIGxpc3QgYW5kIG1heSBnZXQgYnJva2VuIGludG8gaXRzIHBhcnRzIGxhdGVyIC1cbiAgICAgIC8vIGZvciBleGFtcGxlIGluIGFkYXB0Q291bnRyeUFycmF5Rm9yRmFtaWx5U2VhcmNoXG4gICAgICBpZiAoZm91bmRJbnZhbGlkQ291bnRyeUNvbnRhaW5lZEJ5VmFsaWRDb3VudHJ5KSB7XG4gICAgICAgIGxldCBjdXJyZW50Q291bnRyaWVzID0gZmluYWxDb3VudHJpZXM7XG4gICAgICAgIGZpbmFsQ291bnRyaWVzID0gW107XG5cbiAgICAgICAgZm9yIChsZXQgY291bnRyeSBvZiBjdXJyZW50Q291bnRyaWVzKSB7XG4gICAgICAgICAgaWYgKCFDRC5pc1ZhbGlkQ291bnRyeUZvclBsYWNlTmFtZShjb3VudHJ5KSkge1xuICAgICAgICAgICAgbGV0IGlzQ29udGFpbmVkID0gZmFsc2U7XG4gICAgICAgICAgICBmb3IgKGxldCBvdGhlckNvdW50cnkgb2YgY3VycmVudENvdW50cmllcykge1xuICAgICAgICAgICAgICBpZiAob3RoZXJDb3VudHJ5ICE9IGNvdW50cnkpIHtcbiAgICAgICAgICAgICAgICBpZiAoQ0QuaXNQYXJ0T2YoY291bnRyeSwgb3RoZXJDb3VudHJ5KSkge1xuICAgICAgICAgICAgICAgICAgaXNDb250YWluZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIWlzQ29udGFpbmVkKSB7XG4gICAgICAgICAgICAgIGZpbmFsQ291bnRyaWVzLnB1c2goY291bnRyeSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGZpbmFsQ291bnRyaWVzLnB1c2goY291bnRyeSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBmaW5hbENvdW50cmllcztcbiAgICB9XG5cbiAgICByZXR1cm4gdW5kZWZpbmVkO1xuICB9LFxuXG4gIGdldENvbnRhaW5pbmdDb3VudHJpZXM6IGZ1bmN0aW9uIChzdGROYW1lKSB7XG4gICAgbGV0IGNvbnRhaW5pbmdDb3VudHJpZXMgPSBbXTtcblxuICAgIGZvciAobGV0IGNvdW50cnkgb2YgQ291bnRyeURhdGEpIHtcbiAgICAgIGlmIChjb3VudHJ5LnN0ZE5hbWUgPT0gc3RkTmFtZSkge1xuICAgICAgICBsZXQgcGFyZW50Q291bnRyaWVzID0gY291bnRyeS5wYXJ0T2Y7XG4gICAgICAgIGlmIChwYXJlbnRDb3VudHJpZXMpIHtcbiAgICAgICAgICBmb3IgKGxldCBjb250YWluaW5nQ291bnRyeSBvZiBwYXJlbnRDb3VudHJpZXMpIHtcbiAgICAgICAgICAgIGNvbnRhaW5pbmdDb3VudHJpZXMucHVzaChjb250YWluaW5nQ291bnRyeSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBjb250YWluaW5nQ291bnRyaWVzO1xuICB9LFxuXG4gIHN0YW5kYXJkaXplQ291bnRyeU5hbWU6IGZ1bmN0aW9uIChjb3VudHJ5TmFtZSkge1xuICAgIGZvciAobGV0IGNvdW50cnkgb2YgQ291bnRyeURhdGEpIHtcbiAgICAgIGZvciAobGV0IG1hdGNoIG9mIGNvdW50cnkubWF0Y2hlcykge1xuICAgICAgICBpZiAoY291bnRyeU5hbWUgPT0gbWF0Y2gpIHtcbiAgICAgICAgICByZXR1cm4gY291bnRyeS5zdGROYW1lO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9LFxuXG4gIHN0YW5kYXJkaXplQ291bnR5TmFtZUZvckNvdW50cnk6IGZ1bmN0aW9uIChjb3VudHlOYW1lLCBjb3VudHJ5KSB7XG4gICAgLy8gY291bnRyeSBpcyBhIGNvdW50cnkgb2JqZWN0XG4gICAgbGV0IGNvdW50eUFycmF5ID0gQ291bnR5RGF0YVtjb3VudHJ5LnN0ZE5hbWVdO1xuICAgIGlmICghY291bnR5QXJyYXkgfHwgY291bnR5QXJyYXkubGVuZ3RoIDwgMSkge1xuICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICB9XG5cbiAgICBmb3IgKGxldCBjb3VudHkgb2YgY291bnR5QXJyYXkpIHtcbiAgICAgIGZvciAobGV0IG1hdGNoIG9mIGNvdW50eS5tYXRjaGVzKSB7XG4gICAgICAgIGlmIChjb3VudHlOYW1lID09IG1hdGNoKSB7XG4gICAgICAgICAgcmV0dXJuIGNvdW50eS5zdGROYW1lO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgfSxcblxuICB1c2VzTWlkZGxlTmFtZXM6IGZ1bmN0aW9uIChjb3VudHJ5TmFtZSkge1xuICAgIGxldCBzdGROYW1lID0gQ0Quc3RhbmRhcmRpemVDb3VudHJ5TmFtZShjb3VudHJ5TmFtZSk7XG5cbiAgICBmb3IgKGxldCBjb3VudHJ5IG9mIENvdW50cnlEYXRhKSB7XG4gICAgICBpZiAoY291bnRyeS5zdGROYW1lID09IHN0ZE5hbWUpIHtcbiAgICAgICAgaWYgKGNvdW50cnkudXNlc01pZGRsZU5hbWVzKSB7XG4gICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfSxcbn07XG5cbmV4cG9ydCB7IENEIH07XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./extension/base/core/country_data.mjs\n");

/***/ }),

/***/ "./extension/base/core/data_string.mjs":
/*!*********************************************!*\
  !*** ./extension/base/core/data_string.mjs ***!
  \*********************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"DataString\": () => (/* binding */ DataString)\n/* harmony export */ });\n/* harmony import */ var _country_data_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./country_data.mjs */ \"./extension/base/core/country_data.mjs\");\n/* harmony import */ var _generalize_data_utils_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./generalize_data_utils.mjs */ \"./extension/base/core/generalize_data_utils.mjs\");\n/* harmony import */ var _record_type_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./record_type.mjs */ \"./extension/base/core/record_type.mjs\");\n/* harmony import */ var _record_collections_mjs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./record_collections.mjs */ \"./extension/base/core/record_collections.mjs\");\n/* harmony import */ var _wts_date_mjs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./wts_date.mjs */ \"./extension/base/core/wts_date.mjs\");\n/* harmony import */ var _wts_string_mjs__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./wts_string.mjs */ \"./extension/base/core/wts_string.mjs\");\n/* harmony import */ var _narrative_or_sentence_utils_mjs__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ./narrative_or_sentence_utils.mjs */ \"./extension/base/core/narrative_or_sentence_utils.mjs\");\n/* harmony import */ var _site_gro_core_gro_uri_builder_mjs__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../site/gro/core/gro_uri_builder.mjs */ \"./extension/site/gro/core/gro_uri_builder.mjs\");\n/*\nMIT License\n\nCopyright (c) 2020 Robert M Pavey\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.\n*/\n\n\n\n\n\n\n\n\n\n\nfunction getQuarterName(quarterNumber) {\n  const quarterNames = [\"Jan-Feb-Mar\", \"Apr-May-Jun\", \"Jul-Aug-Sep\", \"Oct-Nov-Dec\"];\n  if (quarterNumber != undefined && quarterNumber >= 1 && quarterNumber <= 4) {\n    return quarterNames[quarterNumber - 1];\n  }\n\n  return \"\";\n}\n\nfunction getPlaceWithPreposition(placeString) {\n  let preposition = _wts_string_mjs__WEBPACK_IMPORTED_MODULE_5__.WTS_String.getPrepositionForPlaceString(placeString);\n  return preposition + \" \" + placeString;\n}\n\nfunction cleanDateObj(dateObj) {\n  if (dateObj) {\n    return dateObj.getDataStringFormat(false);\n  }\n  return \"\";\n}\n\nfunction cleanAge(age) {\n  let result = age;\n  if (result) {\n    if (typeof result == \"string\") {\n      result = result.toLowerCase();\n    }\n  }\n  return result;\n}\n\nfunction getDateWithPreposition(dateObj, prepSuffix = \"\") {\n  if (dateObj) {\n    return dateObj.getDataStringFormat(true, prepSuffix);\n  }\n  return \"\";\n}\n\nfunction getDateFromStringWithPreposition(dateString, prepSuffix = \"\") {\n  if (dateString) {\n    let dateObj = new _generalize_data_utils_mjs__WEBPACK_IMPORTED_MODULE_1__.WtsDate();\n    dateObj.dateString = dateString;\n\n    return dateObj.getDataStringFormat(true, prepSuffix);\n  }\n  return \"\";\n}\n\nfunction getFullName(gd) {\n  let name = gd.inferFullName();\n  if (!name) {\n    name = \"Unknown\";\n  }\n  return name;\n}\n\nfunction getReferenceString(gd, options) {\n  let dataString = \"\";\n\n  if (gd.collectionData) {\n    let volume = gd.collectionData.volume;\n    if (volume) {\n      dataString += \" volume \" + volume;\n\n      let page = gd.collectionData.page;\n      if (page) {\n        dataString += \" page \" + page;\n      }\n    }\n\n    let reg = gd.collectionData.registerNumber;\n    if (reg) {\n      dataString += \" reg \" + reg;\n    }\n\n    let entryNum = gd.collectionData.entryNumber;\n    if (entryNum) {\n      dataString += \" entry number \" + entryNum;\n    }\n\n    let registrationNumber = gd.collectionData.registrationNumber;\n    if (registrationNumber) {\n      dataString += \" registration number \" + registrationNumber;\n    }\n  }\n\n  return dataString;\n}\n\nfunction getUkCensusString(gd, options) {\n  let dataString = getFullName(gd);\n\n  let age = cleanAge(gd.ageAtEvent);\n  let maritalStatus = gd.maritalStatus;\n  let relationshipToHead = gd.relationshipToHead;\n\n  if (maritalStatus == \"widow\") {\n    maritalStatus = \"widowed\";\n  } else if (maritalStatus == \"single\") {\n    maritalStatus = gd.getTermForUnmarried();\n  }\n\n  if (age) {\n    dataString += \" (\" + age + \")\";\n  }\n\n  if (!relationshipToHead) {\n    // no relationship defined (e.g. 1841)\n    if (maritalStatus) {\n      dataString += \", \" + maritalStatus;\n    }\n    let occupation = gd.occupation;\n    if (occupation) {\n      dataString += \", \" + occupation + \",\";\n    }\n  } else if (relationshipToHead == \"head\") {\n    if (maritalStatus) {\n      dataString += \", \" + maritalStatus;\n    }\n    let occupation = gd.occupation;\n    if (occupation) {\n      dataString += \", \" + occupation + \",\";\n    }\n    dataString += \" head of household\";\n  } else {\n    let needsClosingComma = false;\n    if (relationshipToHead == \"wife\") {\n      dataString += \", wife\";\n      needsClosingComma = true;\n    } else if (relationshipToHead) {\n      if (maritalStatus) {\n        dataString += \", \" + maritalStatus;\n        needsClosingComma = true;\n      }\n      dataString += \" \" + relationshipToHead;\n    }\n\n    let occupation = gd.occupation;\n    if (occupation) {\n      dataString += \", \" + occupation;\n      needsClosingComma = true;\n    }\n\n    if (needsClosingComma) {\n      dataString += \",\";\n    }\n\n    if (gd.householdArray && gd.householdArray.length > 0) {\n      let headIndex = getHeadOfHouseholdIndex(gd.householdArray);\n      let headName = gd.householdArray[headIndex].name;\n      let headAge = cleanAge(gd.householdArray[headIndex].age);\n\n      if (headName) {\n        dataString += \" in household of \";\n        dataString += headName;\n        if (headAge) {\n          dataString += \" (\" + headAge + \")\";\n        }\n      }\n    }\n  }\n\n  // we want to give more than just the street address and the registration district if possible\n  // First check if the registration district is part of the placeString.\n  if (gd.eventPlace) {\n    if (!gd.registrationDistrict) {\n      // this can happen for 1911 ceneus on Ancestry which just has a number for district\n      if (gd.eventPlace && gd.eventPlace.placeString) {\n        dataString += \" \" + getPlaceWithPreposition(gd.eventPlace.placeString);\n      }\n    } else {\n      let addedPlace = false;\n      let placeParts = gd.eventPlace.separatePlaceIntoParts();\n      if (placeParts.localPlace) {\n        let regIndex = placeParts.localPlace.indexOf(\", \" + gd.registrationDistrict + \", \");\n        if (regIndex == -1) {\n          if (placeParts.localPlace.endsWith(\", \" + gd.registrationDistrict)) {\n            regIndex = placeParts.localPlace.indexOf(\", \" + gd.registrationDistrict);\n          }\n        }\n        if (regIndex != -1) {\n          let shortPlaceString = placeParts.localPlace.substring(0, regIndex);\n          shortPlaceString = getPlaceWithPreposition(shortPlaceString);\n          dataString += \" \" + shortPlaceString;\n          dataString += \" in \" + gd.registrationDistrict + \" registration district\";\n          addedPlace = true;\n        } else if (placeParts.localPlace == gd.registrationDistrict) {\n          // no point duplicating the info - just give registration district\n          dataString += \" in \" + gd.registrationDistrict + \" registration district\";\n          addedPlace = true;\n        }\n      }\n      if (!addedPlace) {\n        if (placeParts.localPlace) {\n          dataString += \" \" + getPlaceWithPreposition(placeParts.localPlace);\n        } else if (gd.eventPlace && gd.eventPlace.placeString) {\n          dataString += \" \" + getPlaceWithPreposition(gd.eventPlace.placeString);\n        }\n        dataString += \" in \" + gd.registrationDistrict + \" registration district\";\n      }\n      if (placeParts.county || placeParts.country) {\n        dataString += \" in \";\n        if (placeParts.county && placeParts.country) {\n          dataString += placeParts.county + \", \" + placeParts.country;\n        } else if (placeParts.county) {\n          dataString += placeParts.county;\n        } else if (placeParts.country) {\n          dataString += placeParts.country;\n        }\n      }\n    }\n  } else if (gd.registrationDistrict) {\n    dataString += \" in \" + gd.registrationDistrict + \" registration district\";\n  }\n\n  let birthPlace = gd.inferBirthPlace();\n  if (birthPlace) {\n    dataString += \". Born in \" + birthPlace;\n  }\n\n  let employer = gd.employer;\n  if (employer) {\n    dataString += \". Employed by \" + employer;\n  }\n\n  return dataString;\n}\n\nfunction get1939RegisterString(gd, options) {\n  let dataString = getFullName(gd);\n\n  let birthDate = gd.inferBirthDateObj();\n  if (birthDate) {\n    dataString += \" (born \" + cleanDateObj(birthDate) + \")\";\n  }\n  let maritalStatus = gd.maritalStatus;\n  if (maritalStatus) {\n    // Note in the 1939 register the term single is used rather than unmarried so leave it that way\n    dataString += \", \" + maritalStatus;\n  }\n  let occupation = gd.occupation;\n  if (occupation) {\n    dataString += \", \" + occupation + \",\";\n  }\n\n  let place = gd.inferFullEventPlace();\n  if (place) {\n    // Note we used to always use \"at\" which may be correct for Ancestry and FMP but FS doesn't have\n    // house number/name.\n    dataString += \" \" + getPlaceWithPreposition(place);\n  }\n\n  return dataString;\n}\n\nfunction getHeadOfHouseholdIndex(householdArray) {\n  for (let index = 0; index < householdArray.length; index++) {\n    let member = householdArray[index];\n    if (member.relationship) {\n      let relationshipLc = member.relationship.toLowerCase();\n      if (relationshipLc == \"head\" || relationshipLc.includes(\"head\")) {\n        return index;\n      }\n    }\n  }\n  return 0;\n}\n\nfunction getOtherCensusString(gd, options) {\n  let dataString = getFullName(gd);\n\n  let age = cleanAge(gd.ageAtEvent);\n  let maritalStatus = gd.maritalStatus;\n  let relationshipToHead = gd.relationshipToHead;\n\n  if (age) {\n    dataString += \" (\" + age + \")\";\n  }\n\n  if (relationshipToHead == \"head\") {\n    if (maritalStatus) {\n      dataString += \", \" + maritalStatus;\n    }\n    let occupation = gd.occupation;\n    if (occupation) {\n      dataString += \", \" + occupation + \",\";\n    }\n    dataString += \" head of household\";\n  } else if (relationshipToHead) {\n    let needsClosingComma = false;\n    if (relationshipToHead == \"wife\") {\n      dataString += \", wife\";\n      needsClosingComma = true;\n    } else if (relationshipToHead) {\n      if (maritalStatus) {\n        dataString += \", \" + maritalStatus;\n        needsClosingComma = true;\n      }\n      dataString += \" \" + relationshipToHead;\n    }\n\n    let occupation = gd.occupation;\n    if (occupation) {\n      dataString += \", \" + occupation;\n      needsClosingComma = true;\n    }\n\n    if (needsClosingComma) {\n      dataString += \",\";\n    }\n\n    if (gd.householdArray && gd.householdArray.length > 0) {\n      let headIndex = getHeadOfHouseholdIndex(gd.householdArray);\n      let headName = gd.householdArray[headIndex].name;\n      let headAge = cleanAge(gd.householdArray[headIndex].age);\n\n      if (headName) {\n        dataString += \" in household of \";\n        dataString += headName;\n        if (headAge) {\n          dataString += \" (\" + headAge + \")\";\n        }\n      }\n    }\n  } else {\n    if (maritalStatus) {\n      dataString += \", \" + maritalStatus;\n    }\n    let occupation = gd.occupation;\n    if (occupation) {\n      dataString += \", \" + occupation + \",\";\n    }\n  }\n\n  let place = gd.inferFullEventPlace();\n  if (place) {\n    dataString += \" \" + getPlaceWithPreposition(place);\n  }\n\n  let birthPlace = gd.inferBirthPlace();\n  if (birthPlace) {\n    dataString += \". Born in \" + birthPlace;\n  }\n\n  return dataString;\n}\n\nfunction getCensusString(gd, options) {\n  // First test if this is a regular england census or a 1939 register\n\n  let is1939Register = false;\n  let isUkCensus = false;\n\n  if (gd.collectionData && gd.collectionData.id) {\n    let collection = _record_collections_mjs__WEBPACK_IMPORTED_MODULE_3__.RC.findCollection(gd.sourceOfData, gd.collectionData.id);\n    if (collection) {\n      if (collection.wtsId == \"EnglandAndWales1939Register\") {\n        is1939Register = true;\n      } else {\n        if (collection.country) {\n          let country = collection.country;\n          if (country == \"United Kingdom\" || _country_data_mjs__WEBPACK_IMPORTED_MODULE_0__.CD.isPartOf(country, \"United Kingdom\")) {\n            isUkCensus = true;\n          }\n        }\n      }\n    }\n  }\n\n  if (is1939Register) {\n    return get1939RegisterString(gd, options);\n  }\n\n  if (isUkCensus) {\n    return getUkCensusString(gd, options);\n  }\n\n  // it is some other census record\n  return getOtherCensusString(gd, options);\n}\n\nfunction getUkRegistrationString(gd, options, type) {\n  let dataString = getFullName(gd);\n  dataString += \" \" + type;\n\n  if (type == \"marriage\" && gd.spouses && gd.spouses.length == 1) {\n    let spouse = gd.spouses[0];\n    if (spouse.name) {\n      let spouseName = spouse.name.inferFullName();\n      if (spouseName) {\n        dataString += \" to \" + spouseName;\n      }\n    }\n  }\n\n  dataString += \" registered\"; // make clear that it is date of registration not event\n\n  let quarter = getQuarterName(gd.inferEventQuarter());\n  if (quarter) {\n    dataString += \" \" + quarter;\n\n    let eventYear = gd.inferEventYear();\n    if (eventYear) {\n      dataString += \" \" + eventYear;\n    }\n  } else {\n    let eventDate = gd.inferEventDateObj();\n    if (eventDate) {\n      dataString += \" \" + cleanDateObj(eventDate);\n    }\n  }\n\n  let district = gd.registrationDistrict;\n  if (!district) {\n    return \"\"; // fallback to non-custom string\n  }\n  dataString += \" in \" + district;\n\n  if (type == \"birth\") {\n    if (gd.mothersMaidenName) {\n      dataString += \", mother's maiden name \" + gd.mothersMaidenName;\n    }\n  } else if (type == \"death\") {\n    let bornOrAgeText = \"\";\n\n    // coming from FS the gd.birthDate.dateString could be something like \"1844\", we don't want to use that\n    if (gd.birthDate && gd.birthDate.dateString && gd.birthDate.dateString.length > 8) {\n      // later UK death registrations include full birth date (available after June quarter 1969)\n      let birthDate = gd.inferBirthDateObj();\n      bornOrAgeText = \"born \" + cleanDateObj(birthDate);\n    } else {\n      let age = cleanAge(gd.ageAtDeath);\n      if (!age) {\n        age = cleanAge(gd.age);\n      }\n      if (!age) {\n        age = cleanAge(gd.ageAtEvent);\n      }\n      if (age) {\n        bornOrAgeText = \"age \" + age;\n      } else if (gd.birthDate) {\n        let dateString = gd.birthDate.dateString;\n        if (!dateString) {\n          dateString = gd.birthDate.yearString;\n        }\n        if (dateString) {\n          bornOrAgeText = \"born \" + dateString;\n        }\n      }\n    }\n\n    let mmnText = \"\";\n    if (gd.mothersMaidenName) {\n      mmnText = \"mother's maiden name \" + gd.mothersMaidenName;\n    }\n\n    if (bornOrAgeText && mmnText) {\n      dataString += \" (\" + bornOrAgeText + \", \" + mmnText + \")\";\n    } else if (bornOrAgeText) {\n      dataString += \" (\" + bornOrAgeText + \")\";\n    } else if (mmnText) {\n      dataString += \" (\" + mmnText + \")\";\n    }\n  }\n\n  // Normally a reference string would be a separate part of the citation - not in the data string\n  // GRO and FreeBMD are special cases.\n  if (gd.sourceOfData == \"gro\" || gd.sourceOfData == \"freebmd\") {\n    dataString += getReferenceString(gd, options);\n  }\n\n  return dataString;\n}\n\nfunction getBirthRegistrationString(gd, options) {\n  if (gd.isRecordInCountry(\"United Kingdom\")) {\n    return getUkRegistrationString(gd, options, \"birth\");\n  }\n\n  let dataString = \"\";\n\n  // generic birth registration\n  if (gd.role && gd.role == _record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.Role.Parent) {\n    if (gd.primaryPerson) {\n      dataString += gd.primaryPerson;\n    } else {\n      dataString += \"child\";\n    }\n\n    dataString += \" born to \";\n\n    dataString += getFullName(gd);\n    if (gd.spouses && gd.spouses[0] && gd.spouses[0].name && gd.spouses[0].name.name) {\n      dataString += \" and \" + gd.spouses[0].name.name;\n    }\n\n    let date = gd.inferEventDateObj();\n    if (date) {\n      dataString += \" \" + getDateWithPreposition(date);\n    }\n\n    let place = gd.inferEventPlace();\n    if (place) {\n      dataString += \" in \" + place;\n    }\n  } else {\n    dataString = getFullName(gd);\n    dataString += \" birth\";\n\n    let birthDate = gd.inferBirthDate();\n    if (birthDate) {\n      dataString += \" \" + birthDate;\n    }\n\n    let place = gd.inferEventPlace();\n    if (place) {\n      dataString += \" in \" + place;\n    }\n\n    if (gd.parents) {\n      let fatherName = \"\";\n      if (gd.parents.father && gd.parents.father.name) {\n        fatherName = gd.parents.father.name.inferFullName();\n      }\n      let motherName = \"\";\n      if (gd.parents.mother && gd.parents.mother.name) {\n        motherName = gd.parents.mother.name.inferFullName();\n      }\n\n      if (gd.personGender == \"male\") {\n        dataString += \", son of\";\n      } else if (gd.personGender == \"female\") {\n        dataString += \", daughter of\";\n      } else {\n        dataString += \", child of\";\n      }\n      if (fatherName) {\n        dataString += \" \" + fatherName;\n      }\n      if (motherName) {\n        if (fatherName) {\n          dataString += \" &\";\n        }\n        dataString += \" \" + motherName;\n      }\n    }\n\n    if (gd.mothersMaidenName) {\n      dataString += \", mother's maiden name \" + gd.mothersMaidenName;\n    }\n  }\n\n  return dataString;\n}\n\nfunction getDeathRegistrationString(gd, options) {\n  if (gd.isRecordInCountry(\"United Kingdom\")) {\n    return getUkRegistrationString(gd, options, \"death\");\n  }\n\n  let deathDate = gd.inferDeathDateObj();\n\n  // generic death registration\n  let dataString = getFullName(gd);\n  if (gd.role == _record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.Role.Parent) {\n    dataString += \" in death record for \" + (0,_narrative_or_sentence_utils_mjs__WEBPACK_IMPORTED_MODULE_6__.getPrimaryPersonChildTerm)(gd);\n    if (gd.primaryPerson) {\n      dataString += \" \" + gd.primaryPerson + \",\";\n    }\n    deathDate = gd.inferEventDateObj();\n  } else if (gd.role == _record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.Role.Spouse) {\n    dataString += \" in death record for \" + (0,_narrative_or_sentence_utils_mjs__WEBPACK_IMPORTED_MODULE_6__.getPrimaryPersonSpouseTerm)(gd);\n    if (gd.primaryPerson) {\n      dataString += \" \" + gd.primaryPerson + \",\";\n    }\n    deathDate = gd.inferEventDateObj();\n  } else {\n    dataString += \" death\";\n  }\n\n  if (deathDate) {\n    dataString += \" \" + cleanDateObj(deathDate);\n  }\n\n  let age = cleanAge(gd.ageAtDeath);\n  if (age) {\n    dataString += \" (age \" + age + \")\";\n  }\n\n  let place = gd.inferEventPlace();\n  let registrationDistrict = gd.registrationDistrict;\n\n  if (place) {\n    dataString += \" in \" + place;\n  } else if (registrationDistrict) {\n    dataString += \" in the \" + registrationDistrict + \" district\";\n  }\n\n  return dataString;\n}\n\nfunction getMarriageRegistrationString(gd, options) {\n  if (gd.isRecordInCountry(\"United Kingdom\")) {\n    return getUkRegistrationString(gd, options, \"marriage\");\n  }\n\n  // generic marriage reg\n  let dataString = getFullName(gd);\n\n  let age = cleanAge(gd.ageAtEvent);\n  if (age) {\n    dataString += \" (\" + age + \")\";\n  }\n\n  if (gd.role && gd.role == _record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.Role.Parent) {\n    dataString += \" child\";\n  }\n\n  dataString += \" marriage\";\n\n  if (gd.spouses && gd.spouses.length == 1) {\n    let spouse = gd.spouses[0];\n    if (spouse.name) {\n      let spouseName = spouse.name.inferFullName();\n      dataString += \" to \" + spouseName;\n\n      let spouseAge = cleanAge(spouse.age);\n      if (spouseAge) {\n        dataString += \" (\" + spouseAge + \")\";\n      }\n    }\n  }\n\n  let date = gd.inferEventDateObj();\n  if (!date && gd.marriageDate) {\n    date = new _generalize_data_utils_mjs__WEBPACK_IMPORTED_MODULE_1__.WtsDate();\n    date.dateString = gd.marriageDate;\n  }\n  if (date) {\n    dataString += \" \" + getDateWithPreposition(date);\n  }\n\n  let place = gd.inferFullEventPlace();\n  if (place) {\n    dataString += \" \" + getPlaceWithPreposition(place);\n  }\n\n  return dataString;\n}\n\nfunction getBirthString(gd, options) {\n  let dataString = \"\";\n\n  if (gd.role && gd.role == _record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.Role.Parent) {\n    if (gd.primaryPerson) {\n      dataString += gd.primaryPerson;\n    } else {\n      dataString += \"child\";\n    }\n\n    if (gd.recordType == _record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Birth) {\n      dataString += \" born to \";\n    } else {\n      dataString += \" born or baptised to \";\n    }\n    dataString += getFullName(gd);\n    if (gd.spouses && gd.spouses[0] && gd.spouses[0].name && gd.spouses[0].name.name) {\n      dataString += \" and \" + gd.spouses[0].name.name;\n    }\n\n    let date = gd.inferEventDateObj();\n    if (date) {\n      dataString += \" \" + getDateWithPreposition(date);\n    }\n  } else {\n    dataString += getFullName(gd);\n\n    if (gd.recordType == _record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Birth) {\n      dataString += \" born\";\n    } else {\n      dataString += \" born or baptised\";\n    }\n\n    let date = gd.inferEventDateObj();\n    if (date) {\n      dataString += \" \" + getDateWithPreposition(date);\n    }\n\n    let parentNames = gd.inferParentNamesForDataString();\n    if (parentNames.fatherName || parentNames.motherName) {\n      if (gd.personGender == \"male\") {\n        dataString += \", son of \";\n      } else if (gd.personGender == \"female\") {\n        dataString += \", daughter of \";\n      } else {\n        dataString += \", child of \";\n      }\n      if (parentNames.fatherName) {\n        dataString += parentNames.fatherName;\n      }\n      if (parentNames.motherName) {\n        if (parentNames.fatherName) {\n          dataString += \" & \";\n        }\n        dataString += parentNames.motherName;\n      }\n      dataString += \",\";\n    }\n  }\n\n  let place = gd.inferFullEventPlace();\n  if (place) {\n    dataString += \" \" + getPlaceWithPreposition(place);\n  } else if (dataString.endsWith(\",\")) {\n    dataString = dataString.substring(0, dataString.length - 1);\n  }\n\n  return dataString;\n}\n\nfunction getDeathString(gd, options) {\n  let dataString = getFullName(gd);\n\n  let deathDate = gd.inferDeathDateObj();\n\n  if (gd.role == _record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.Role.Parent) {\n    dataString += \" in death record for \" + (0,_narrative_or_sentence_utils_mjs__WEBPACK_IMPORTED_MODULE_6__.getPrimaryPersonChildTerm)(gd);\n    if (gd.primaryPerson) {\n      dataString += \" \" + gd.primaryPerson + \",\";\n    }\n    deathDate = gd.inferEventDateObj();\n  } else if (gd.role == _record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.Role.Spouse) {\n    dataString += \" in death record for \" + (0,_narrative_or_sentence_utils_mjs__WEBPACK_IMPORTED_MODULE_6__.getPrimaryPersonSpouseTerm)(gd);\n    if (gd.primaryPerson) {\n      dataString += \" \" + gd.primaryPerson + \",\";\n    }\n    deathDate = gd.inferEventDateObj();\n  } else {\n    dataString += \" death\";\n  }\n\n  if (deathDate) {\n    dataString += \" \" + cleanDateObj(deathDate);\n  }\n\n  if (gd.birthDate && gd.birthDate.dateString && gd.birthDate.dateString.length > 4) {\n    dataString += \" (born \" + gd.birthDate.dateString + \")\";\n  } else {\n    let age = cleanAge(gd.ageAtDeath);\n    if (age) {\n      dataString += \" (age \" + age + \")\";\n    }\n  }\n\n  let parentNames = gd.inferParentNamesForDataString();\n  if (parentNames.fatherName || parentNames.motherName) {\n    if (gd.personGender == \"male\") {\n      dataString += \", son of \";\n    } else if (gd.personGender == \"female\") {\n      dataString += \", daughter of \";\n    } else {\n      dataString += \", child of \";\n    }\n    if (parentNames.fatherName) {\n      dataString += parentNames.fatherName;\n    }\n    if (parentNames.motherName) {\n      if (parentNames.fatherName) {\n        dataString += \" & \";\n      }\n      dataString += parentNames.motherName;\n    }\n    dataString += \",\";\n  }\n\n  if (gd.spouses && gd.spouses.length == 1) {\n    let spouse = gd.spouses[0];\n    if (spouse.name) {\n      let spouseName = spouse.name.inferFullName();\n      if (spouseName) {\n        let relation = \"spouse\";\n        if (gd.personGender == \"male\") {\n          relation = \"husband\";\n        } else if (gd.personGender == \"female\") {\n          relation = \"wife\";\n        }\n        if (!dataString.endsWith(\",\")) {\n          dataString += \",\";\n        }\n        dataString += \" \" + relation + \" of \" + spouseName + \",\";\n      }\n    }\n  }\n\n  let place = gd.inferFullEventPlace();\n  if (place) {\n    dataString += \" \" + getPlaceWithPreposition(place);\n  } else {\n    let residencePlace = gd.inferResidencePlace();\n    if (residencePlace) {\n      dataString += \" residing \" + getPlaceWithPreposition(residencePlace);\n    }\n  }\n\n  if (dataString.endsWith(\",\")) {\n    dataString = dataString.substring(0, dataString.length - 1);\n  }\n\n  if (gd.mothersMaidenName) {\n    dataString += \", mother's maiden name \" + gd.mothersMaidenName;\n  }\n\n  return dataString;\n}\n\nfunction getBaptismString(gd, options) {\n  let dataString = getFullName(gd);\n\n  if (gd.role && gd.role == _record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.Role.Parent) {\n    dataString += \"'s \" + (0,_narrative_or_sentence_utils_mjs__WEBPACK_IMPORTED_MODULE_6__.getPrimaryPersonChildTerm)(gd) + \" \" + gd.primaryPerson;\n  }\n\n  dataString += \" baptism\";\n\n  let date = gd.inferEventDateObj();\n  if (date) {\n    dataString += \" \" + getDateWithPreposition(date);\n  }\n\n  if (gd.birthDate) {\n    let birthDate = gd.inferBirthDateObj();\n    if (birthDate) {\n      dataString += \" (born \" + cleanDateObj(birthDate) + \")\";\n    }\n  }\n\n  let place = gd.inferFullEventPlace();\n\n  let parentNames = gd.inferParentNamesForDataString();\n  if (parentNames.fatherName || parentNames.motherName) {\n    if (gd.personGender == \"male\") {\n      dataString += \", son of \";\n    } else if (gd.personGender == \"female\") {\n      dataString += \", daughter of \";\n    } else {\n      dataString += \", child of \";\n    }\n    if (parentNames.fatherName) {\n      dataString += parentNames.fatherName;\n    }\n    if (parentNames.motherName) {\n      if (parentNames.fatherName) {\n        dataString += \" & \";\n      }\n      dataString += parentNames.motherName;\n    }\n    if (place) {\n      dataString += \",\";\n    }\n  }\n\n  if (place) {\n    dataString += \" \" + getPlaceWithPreposition(place);\n  }\n\n  // sometimes a baptism has a death date. (e.g. germany_baptism_1840_johanna_hartmann)\n  let deathDate = gd.inferDeathDateObj();\n  if (deathDate) {\n    dataString += \" and died \" + getDateWithPreposition(deathDate);\n  }\n\n  return dataString;\n}\n\nfunction getMarriageString(gd, options) {\n  let dataString = \"\";\n\n  if (gd.role && gd.role == _record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.Role.Parent) {\n    let possessiveName = getFullName(gd) + \"'s\";\n    dataString += possessiveName + \" \" + (0,_narrative_or_sentence_utils_mjs__WEBPACK_IMPORTED_MODULE_6__.getPrimaryPersonChildTerm)(gd);\n    if (gd.primaryPerson) {\n      dataString += \" \" + gd.primaryPerson;\n    }\n\n    let age = cleanAge(gd.primaryPersonAge);\n    if (age) {\n      dataString += \" (\" + age + \")\";\n    }\n  } else {\n    dataString += getFullName(gd);\n\n    let age = cleanAge(gd.ageAtEvent);\n    if (age) {\n      dataString += \" (\" + age + \")\";\n    }\n  }\n\n  dataString += \" marriage\";\n\n  if (gd.spouses && gd.spouses.length == 1 && gd.spouses[0].name) {\n    let spouseName = gd.spouses[0].name.inferFullName();\n    dataString += \" to \" + spouseName;\n\n    let spouseAge = cleanAge(gd.spouses[0].age);\n    if (spouseAge) {\n      dataString += \" (\" + spouseAge + \")\";\n    }\n  }\n\n  if (gd.recordSubtype && gd.recordSubtype == _record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RecordSubtype.Banns) {\n    dataString += \". Banns read\";\n  }\n\n  if (gd.marriageDate) {\n    let date = new _generalize_data_utils_mjs__WEBPACK_IMPORTED_MODULE_1__.WtsDate();\n    date.dateString = gd.marriageDate;\n    dataString += \" \" + getDateWithPreposition(date);\n  } else {\n    let date = gd.inferEventDateObj();\n    if (date) {\n      let prepSuffix = \"\";\n      if (gd.recordSubtype && gd.recordSubtype == _record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RecordSubtype.MarriageOrBanns) {\n        prepSuffix = \"or after\";\n      }\n      dataString += \" \" + getDateWithPreposition(date, prepSuffix);\n    }\n  }\n\n  let place = gd.inferFullEventPlace();\n  if (place) {\n    dataString += \" \" + getPlaceWithPreposition(place);\n  }\n\n  return dataString;\n}\n\nfunction getBurialString(gd, options) {\n  let dataString = getFullName(gd);\n  if (gd.role && gd.role == _record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.Role.Parent) {\n    dataString += \"'s \" + (0,_narrative_or_sentence_utils_mjs__WEBPACK_IMPORTED_MODULE_6__.getPrimaryPersonChildTerm)(gd) + \" \" + gd.primaryPerson;\n  } else {\n    if (gd.parents) {\n      let fatherName = \"\";\n      if (gd.parents.father && gd.parents.father.name) {\n        fatherName = gd.parents.father.name.inferFullName();\n      }\n      let motherName = \"\";\n      if (gd.parents.mother && gd.parents.mother.name) {\n        motherName = gd.parents.mother.name.inferFullName();\n      }\n\n      if (gd.personGender == \"male\") {\n        dataString += \", son of\";\n      } else if (gd.personGender == \"female\") {\n        dataString += \", daughter of\";\n      } else {\n        dataString += \", child of\";\n      }\n      if (fatherName) {\n        dataString += \" \" + fatherName;\n      }\n      if (motherName) {\n        if (fatherName) {\n          dataString += \" &\";\n        }\n        dataString += \" \" + motherName;\n      }\n\n      dataString += \",\";\n    }\n  }\n\n  if (gd.recordType == _record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.DeathOrBurial) {\n    dataString += \" death or burial\";\n  } else {\n    dataString += \" burial\";\n  }\n\n  let deathDate = gd.inferDeathDateObj();\n  let age = cleanAge(gd.ageAtDeath);\n  if (!age) {\n    age = cleanAge(gd.ageAtEvent);\n  }\n  if (deathDate && age) {\n    dataString += \" (died \" + getDateWithPreposition(deathDate) + \" at age \" + age + \")\";\n  } else if (deathDate) {\n    dataString += \" (died \" + getDateWithPreposition(deathDate) + \")\";\n  } else if (age) {\n    dataString += \" (died age \" + age + \")\";\n  }\n\n  let burialDate = gd.inferEventDateObj();\n  if (burialDate) {\n    dataString += \" \" + getDateWithPreposition(burialDate);\n  }\n\n  let place = gd.inferFullEventPlace();\n  if (place) {\n    dataString += \" \" + getPlaceWithPreposition(place);\n  }\n\n  if (gd.causeOfDeath) {\n    dataString += \". Cause of death: \" + gd.causeOfDeath;\n  }\n\n  return dataString;\n}\n\nfunction getCremationString(gd, options) {\n  let dataString = getFullName(gd);\n  dataString += \" cremation\";\n\n  let deathDate = gd.inferDeathDateObj();\n  let age = cleanAge(gd.ageAtDeath);\n  if (deathDate && age) {\n    dataString += \" (died \" + getDateWithPreposition(deathDate) + \" at age \" + age + \")\";\n  } else if (deathDate) {\n    dataString += \" (died \" + getDateWithPreposition(deathDate) + \")\";\n  } else if (age) {\n    dataString += \" (died age \" + age + \")\";\n  }\n\n  let cremationDate = gd.inferEventDateObj();\n  if (cremationDate) {\n    dataString += \" \" + getDateWithPreposition(cremationDate);\n  }\n\n  let place = gd.inferFullEventPlace();\n  if (place) {\n    dataString += \" \" + getPlaceWithPreposition(place);\n  }\n\n  return dataString;\n}\n\nfunction getProbateString(gd, options) {\n  let dataString = getFullName(gd);\n  dataString += \" probate\";\n\n  let date = gd.inferEventDateObj();\n  if (date) {\n    dataString += \" \" + getDateWithPreposition(date);\n  }\n\n  let place = gd.inferFullEventPlace();\n  if (place) {\n    dataString += \" \" + getPlaceWithPreposition(place);\n  }\n\n  let deathDate = gd.inferDeathDateObj();\n  if (deathDate) {\n    dataString += \". Died \" + cleanDateObj(deathDate);\n\n    let deathPlace = gd.inferDeathPlace();\n    if (deathPlace) {\n      dataString += \" \" + getPlaceWithPreposition(deathPlace);\n    } else {\n      let residencePlace = gd.inferResidencePlace();\n      if (residencePlace) {\n        dataString += \" residing \" + getPlaceWithPreposition(residencePlace);\n      }\n    }\n  } else {\n    let residencePlace = gd.inferResidencePlace();\n    if (residencePlace) {\n      dataString += \". Residence \" + residencePlace;\n    }\n  }\n\n  if (gd.occupation) {\n    dataString += \". Occupation: \" + gd.occupation;\n  }\n\n  return dataString;\n}\n\nfunction getScottishWillString(gd, options) {\n  if (gd.role && gd.role != _record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.Role.Primary) {\n    return \"\"; // fall back to non-custom string\n  }\n\n  let dataString = \"\";\n\n  if (gd.recordSubtype == \"Probate\") {\n    dataString = \"Confirmation of probate of will of \";\n  } else if (gd.recordSubtype == \"Testament\") {\n    if (gd.testateOrIntestate == \"testate\") {\n      dataString = \"Confirmation of will of \";\n    } else if (gd.testateOrIntestate == \"intestate\") {\n      dataString = \"Confirmation of testament of \";\n    } else {\n      dataString = \"Confirmation of will or testament of \";\n    }\n  } else if (gd.recordSubtype == \"Inventory\") {\n    dataString = \"Confirmation of inventory for \";\n  } else if (gd.recordSubtype == \"AdditionalInventory\") {\n    dataString = \"Confirmation of inventory for \";\n  } else if (gd.recordSubtype == \"AdditionalInventory\") {\n    dataString = \"Confirmation of additional inventory for \";\n  } else {\n    dataString = \"Confirmation of will or testament of \";\n  }\n\n  dataString += getFullName(gd);\n\n  if (gd.courtName) {\n    dataString += \" at \" + gd.courtName;\n  } else {\n    let place = gd.inferFullEventPlace();\n    if (place) {\n      dataString += \" in \" + place;\n    }\n  }\n\n  let eventDate = gd.inferEventDateObj();\n  let origDate = gd.originalConfirmationGrantedDate;\n  let grantedDate = gd.grantedDate;\n\n  if (eventDate) {\n    if (grantedDate) {\n      dataString += \" \" + getDateFromStringWithPreposition(grantedDate);\n      dataString += \" (original confirmation \" + getDateWithPreposition(eventDate) + \")\";\n    } else if (origDate) {\n      dataString += \" \" + getDateWithPreposition(eventDate);\n      dataString += \" (original confirmation \" + getDateFromStringWithPreposition(origDate) + \")\";\n    } else {\n      dataString += \" \" + getDateWithPreposition(eventDate);\n    }\n  }\n\n  let deathDate = gd.inferDeathDateObj();\n  if (deathDate) {\n    dataString += \". Died \" + cleanDateObj(deathDate);\n\n    let deathPlace = gd.inferDeathPlace();\n    if (deathPlace && deathPlace != place) {\n      dataString += \" \" + getPlaceWithPreposition(place);\n    }\n  }\n\n  if (gd.occupation) {\n    dataString += \". Occupation: \" + gd.occupation;\n  }\n\n  return dataString;\n}\n\nfunction getWillString(gd, options) {\n  if (gd.inferEventCountry() == \"Scotland\" || (gd.courtName && gd.courtName.startsWith(\"non-Scot\"))) {\n    return getScottishWillString(gd, options);\n  }\n\n  if (gd.role && gd.role != _record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.Role.Primary) {\n    return \"\"; // fall back to non-custom string\n  }\n\n  let dateObj = gd.inferEventDateObj();\n  let deathDateObj = gd.inferDeathDateObj();\n\n  let hasProbateDate = false;\n  if (dateObj) {\n    if (!deathDateObj || dateObj.getDateString() != deathDateObj.getDateString()) {\n      // there is a probate date (probably)\n      hasProbateDate = true;\n    }\n  }\n\n  let dataString = \"Will of \" + getFullName(gd);\n\n  let eventPlace = gd.inferFullEventPlace();\n  let deathPlace = gd.inferDeathPlace();\n  let residencePlace = gd.inferResidencePlace();\n\n  let usedResidence = false;\n  if (residencePlace) {\n    dataString += \" of \" + residencePlace;\n    usedResidence = true;\n  } else if (eventPlace) {\n    dataString += \" of \" + eventPlace;\n  }\n\n  if (hasProbateDate) {\n    dataString += \", granted probate\";\n    dataString += \" \" + getDateWithPreposition(dateObj);\n  }\n\n  let deathDate = gd.inferDeathDateObj();\n  if (deathDate) {\n    dataString += \". Died \" + cleanDateObj(deathDate);\n    if (deathPlace) {\n      dataString += \" \" + getPlaceWithPreposition(deathPlace);\n    } else if (!usedResidence && residencePlace) {\n      dataString += \" \" + getPlaceWithPreposition(residencePlace);\n    }\n  }\n\n  if (gd.occupation) {\n    dataString += \". Occupation: \" + gd.occupation;\n  }\n\n  return dataString;\n}\n\nfunction getDivorceString(gd, options) {\n  let dataString = getFullName(gd);\n  dataString += \" divorce\";\n\n  if (gd.spouses && gd.spouses.length == 1 && gd.spouses[0].name) {\n    let spouseName = gd.spouses[0].name.inferFullName();\n    dataString += \" from \" + spouseName;\n  }\n\n  let date = gd.inferEventDateObj();\n  if (date) {\n    dataString += \" \" + getDateWithPreposition(date);\n  }\n\n  let place = gd.inferFullEventPlace();\n  if (place) {\n    dataString += \" \" + getPlaceWithPreposition(place);\n  }\n\n  return dataString;\n}\n\nconst DataString = {\n  buildDataString: function (input) {\n    if (!input || !input.generalizedData || !input.options) {\n      return \"\";\n    }\n\n    let gd = input.generalizedData;\n    let options = input.options;\n\n    let dataString = \"\";\n\n    switch (gd.recordType) {\n      case _record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.BirthRegistration: {\n        dataString = getBirthRegistrationString(gd, options);\n        break;\n      }\n      case _record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Birth:\n      case _record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.BirthOrBaptism: {\n        dataString = getBirthString(gd, options);\n        break;\n      }\n      case _record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.DeathRegistration: {\n        dataString = getDeathRegistrationString(gd, options);\n        break;\n      }\n      case _record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Death: {\n        dataString = getDeathString(gd, options);\n        break;\n      }\n      case _record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.MarriageRegistration: {\n        dataString = getMarriageRegistrationString(gd, options);\n        break;\n      }\n      case _record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Baptism: {\n        dataString = getBaptismString(gd, options);\n        break;\n      }\n      case _record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Marriage: {\n        dataString = getMarriageString(gd, options);\n        break;\n      }\n      case _record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Burial:\n      case _record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.DeathOrBurial: {\n        dataString = getBurialString(gd, options);\n        break;\n      }\n      case _record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Cremation: {\n        dataString = getCremationString(gd, options);\n        break;\n      }\n      case _record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Census: {\n        dataString = getCensusString(gd, options);\n        break;\n      }\n      case _record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Probate: {\n        dataString = getProbateString(gd, options);\n        break;\n      }\n      case _record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Will: {\n        dataString = getWillString(gd, options);\n        break;\n      }\n      case _record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Divorce: {\n        dataString = getDivorceString(gd, options);\n        break;\n      }\n    }\n\n    if (dataString) {\n      dataString += \".\";\n    }\n\n    return dataString;\n  },\n};\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9leHRlbnNpb24vYmFzZS9jb3JlL2RhdGFfc3RyaW5nLm1qcy5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7QUFBQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRXdDO0FBQ2M7QUFDTTtBQUNkO0FBQ0o7QUFDSTtBQUM0RDtBQUNsQzs7QUFFeEU7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0Esb0JBQW9CLG9GQUF1QztBQUMzRDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxzQkFBc0IsK0RBQU87QUFDN0I7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVO0FBQ1Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVU7QUFDVjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVTtBQUNWO0FBQ0EsVUFBVTtBQUNWO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0Esc0JBQXNCLCtCQUErQjtBQUNyRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQSxxQkFBcUIsc0VBQWlCO0FBQ3RDO0FBQ0E7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0EsNkNBQTZDLDBEQUFXO0FBQ3hEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLCtCQUErQjs7QUFFL0I7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLGVBQWU7QUFDZjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQSw0QkFBNEIseURBQVc7QUFDdkM7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNK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QTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBLElBQUk7QUFDSjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0EsNEJBQTRCLDBEQUFZO0FBQ3hDLGVBQWU7QUFDZjs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBLElBQUk7QUFDSjtBQUNBLElBQUk7QUFDSjtBQUNBLElBQUk7QUFDSjtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsNEJBQTRCLDBEQUFZO0FBQ3hDLGVBQWU7QUFDZjs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBLFdBQVcsa0VBQW9CO0FBQy9CO0FBQ0E7QUFDQTtBQUNBLFdBQVcsc0RBQVE7QUFDbkIsV0FBVywrREFBaUI7QUFDNUI7QUFDQTtBQUNBO0FBQ0EsV0FBVyxrRUFBb0I7QUFDL0I7QUFDQTtBQUNBO0FBQ0EsV0FBVyxzREFBUTtBQUNuQjtBQUNBO0FBQ0E7QUFDQSxXQUFXLHFFQUF1QjtBQUNsQztBQUNBO0FBQ0E7QUFDQSxXQUFXLHdEQUFVO0FBQ3JCO0FBQ0E7QUFDQTtBQUNBLFdBQVcseURBQVc7QUFDdEI7QUFDQTtBQUNBO0FBQ0EsV0FBVyx1REFBUztBQUNwQixXQUFXLDhEQUFnQjtBQUMzQjtBQUNBO0FBQ0E7QUFDQSxXQUFXLDBEQUFZO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBLFdBQVcsdURBQVM7QUFDcEI7QUFDQTtBQUNBO0FBQ0EsV0FBVyx3REFBVTtBQUNyQjtBQUNBO0FBQ0E7QUFDQSxXQUFXLHFEQUFPO0FBQ2xCO0FBQ0E7QUFDQTtBQUNBLFdBQVcsd0RBQVU7QUFDckI7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0EsR0FBRztBQUNIOztBQUVzQiIsInNvdXJjZXMiOlsid2VicGFjazovL0NpdGF0aW9uRXh0cmFjdG9yLy4vZXh0ZW5zaW9uL2Jhc2UvY29yZS9kYXRhX3N0cmluZy5tanM/YzVmNiJdLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuTUlUIExpY2Vuc2VcblxuQ29weXJpZ2h0IChjKSAyMDIwIFJvYmVydCBNIFBhdmV5XG5cblBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHlcbm9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlIFwiU29mdHdhcmVcIiksIHRvIGRlYWxcbmluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHNcbnRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGxcbmNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQgcGVyc29ucyB0byB3aG9tIHRoZSBTb2Z0d2FyZSBpc1xuZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczpcblxuVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW4gYWxsXG5jb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLlxuXG5USEUgU09GVFdBUkUgSVMgUFJPVklERUQgXCJBUyBJU1wiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SXG5JTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSxcbkZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRVxuQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUlxuTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSxcbk9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4gVEhFXG5TT0ZUV0FSRS5cbiovXG5cbmltcG9ydCB7IENEIH0gZnJvbSBcIi4vY291bnRyeV9kYXRhLm1qc1wiO1xuaW1wb3J0IHsgV3RzRGF0ZSB9IGZyb20gXCIuL2dlbmVyYWxpemVfZGF0YV91dGlscy5tanNcIjtcbmltcG9ydCB7IFJULCBSb2xlLCBSZWNvcmRTdWJ0eXBlIH0gZnJvbSBcIi4vcmVjb3JkX3R5cGUubWpzXCI7XG5pbXBvcnQgeyBSQyB9IGZyb20gXCIuL3JlY29yZF9jb2xsZWN0aW9ucy5tanNcIjtcbmltcG9ydCB7IFdUU19EYXRlIH0gZnJvbSBcIi4vd3RzX2RhdGUubWpzXCI7XG5pbXBvcnQgeyBXVFNfU3RyaW5nIH0gZnJvbSBcIi4vd3RzX3N0cmluZy5tanNcIjtcbmltcG9ydCB7IGdldFByaW1hcnlQZXJzb25DaGlsZFRlcm0sIGdldFByaW1hcnlQZXJzb25TcG91c2VUZXJtIH0gZnJvbSBcIi4vbmFycmF0aXZlX29yX3NlbnRlbmNlX3V0aWxzLm1qc1wiO1xuaW1wb3J0IHsgR3JvVXJpQnVpbGRlciB9IGZyb20gXCIuLi8uLi9zaXRlL2dyby9jb3JlL2dyb191cmlfYnVpbGRlci5tanNcIjtcblxuZnVuY3Rpb24gZ2V0UXVhcnRlck5hbWUocXVhcnRlck51bWJlcikge1xuICBjb25zdCBxdWFydGVyTmFtZXMgPSBbXCJKYW4tRmViLU1hclwiLCBcIkFwci1NYXktSnVuXCIsIFwiSnVsLUF1Zy1TZXBcIiwgXCJPY3QtTm92LURlY1wiXTtcbiAgaWYgKHF1YXJ0ZXJOdW1iZXIgIT0gdW5kZWZpbmVkICYmIHF1YXJ0ZXJOdW1iZXIgPj0gMSAmJiBxdWFydGVyTnVtYmVyIDw9IDQpIHtcbiAgICByZXR1cm4gcXVhcnRlck5hbWVzW3F1YXJ0ZXJOdW1iZXIgLSAxXTtcbiAgfVxuXG4gIHJldHVybiBcIlwiO1xufVxuXG5mdW5jdGlvbiBnZXRQbGFjZVdpdGhQcmVwb3NpdGlvbihwbGFjZVN0cmluZykge1xuICBsZXQgcHJlcG9zaXRpb24gPSBXVFNfU3RyaW5nLmdldFByZXBvc2l0aW9uRm9yUGxhY2VTdHJpbmcocGxhY2VTdHJpbmcpO1xuICByZXR1cm4gcHJlcG9zaXRpb24gKyBcIiBcIiArIHBsYWNlU3RyaW5nO1xufVxuXG5mdW5jdGlvbiBjbGVhbkRhdGVPYmooZGF0ZU9iaikge1xuICBpZiAoZGF0ZU9iaikge1xuICAgIHJldHVybiBkYXRlT2JqLmdldERhdGFTdHJpbmdGb3JtYXQoZmFsc2UpO1xuICB9XG4gIHJldHVybiBcIlwiO1xufVxuXG5mdW5jdGlvbiBjbGVhbkFnZShhZ2UpIHtcbiAgbGV0IHJlc3VsdCA9IGFnZTtcbiAgaWYgKHJlc3VsdCkge1xuICAgIGlmICh0eXBlb2YgcmVzdWx0ID09IFwic3RyaW5nXCIpIHtcbiAgICAgIHJlc3VsdCA9IHJlc3VsdC50b0xvd2VyQ2FzZSgpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gcmVzdWx0O1xufVxuXG5mdW5jdGlvbiBnZXREYXRlV2l0aFByZXBvc2l0aW9uKGRhdGVPYmosIHByZXBTdWZmaXggPSBcIlwiKSB7XG4gIGlmIChkYXRlT2JqKSB7XG4gICAgcmV0dXJuIGRhdGVPYmouZ2V0RGF0YVN0cmluZ0Zvcm1hdCh0cnVlLCBwcmVwU3VmZml4KTtcbiAgfVxuICByZXR1cm4gXCJcIjtcbn1cblxuZnVuY3Rpb24gZ2V0RGF0ZUZyb21TdHJpbmdXaXRoUHJlcG9zaXRpb24oZGF0ZVN0cmluZywgcHJlcFN1ZmZpeCA9IFwiXCIpIHtcbiAgaWYgKGRhdGVTdHJpbmcpIHtcbiAgICBsZXQgZGF0ZU9iaiA9IG5ldyBXdHNEYXRlKCk7XG4gICAgZGF0ZU9iai5kYXRlU3RyaW5nID0gZGF0ZVN0cmluZztcblxuICAgIHJldHVybiBkYXRlT2JqLmdldERhdGFTdHJpbmdGb3JtYXQodHJ1ZSwgcHJlcFN1ZmZpeCk7XG4gIH1cbiAgcmV0dXJuIFwiXCI7XG59XG5cbmZ1bmN0aW9uIGdldEZ1bGxOYW1lKGdkKSB7XG4gIGxldCBuYW1lID0gZ2QuaW5mZXJGdWxsTmFtZSgpO1xuICBpZiAoIW5hbWUpIHtcbiAgICBuYW1lID0gXCJVbmtub3duXCI7XG4gIH1cbiAgcmV0dXJuIG5hbWU7XG59XG5cbmZ1bmN0aW9uIGdldFJlZmVyZW5jZVN0cmluZyhnZCwgb3B0aW9ucykge1xuICBsZXQgZGF0YVN0cmluZyA9IFwiXCI7XG5cbiAgaWYgKGdkLmNvbGxlY3Rpb25EYXRhKSB7XG4gICAgbGV0IHZvbHVtZSA9IGdkLmNvbGxlY3Rpb25EYXRhLnZvbHVtZTtcbiAgICBpZiAodm9sdW1lKSB7XG4gICAgICBkYXRhU3RyaW5nICs9IFwiIHZvbHVtZSBcIiArIHZvbHVtZTtcblxuICAgICAgbGV0IHBhZ2UgPSBnZC5jb2xsZWN0aW9uRGF0YS5wYWdlO1xuICAgICAgaWYgKHBhZ2UpIHtcbiAgICAgICAgZGF0YVN0cmluZyArPSBcIiBwYWdlIFwiICsgcGFnZTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBsZXQgcmVnID0gZ2QuY29sbGVjdGlvbkRhdGEucmVnaXN0ZXJOdW1iZXI7XG4gICAgaWYgKHJlZykge1xuICAgICAgZGF0YVN0cmluZyArPSBcIiByZWcgXCIgKyByZWc7XG4gICAgfVxuXG4gICAgbGV0IGVudHJ5TnVtID0gZ2QuY29sbGVjdGlvbkRhdGEuZW50cnlOdW1iZXI7XG4gICAgaWYgKGVudHJ5TnVtKSB7XG4gICAgICBkYXRhU3RyaW5nICs9IFwiIGVudHJ5IG51bWJlciBcIiArIGVudHJ5TnVtO1xuICAgIH1cblxuICAgIGxldCByZWdpc3RyYXRpb25OdW1iZXIgPSBnZC5jb2xsZWN0aW9uRGF0YS5yZWdpc3RyYXRpb25OdW1iZXI7XG4gICAgaWYgKHJlZ2lzdHJhdGlvbk51bWJlcikge1xuICAgICAgZGF0YVN0cmluZyArPSBcIiByZWdpc3RyYXRpb24gbnVtYmVyIFwiICsgcmVnaXN0cmF0aW9uTnVtYmVyO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiBkYXRhU3RyaW5nO1xufVxuXG5mdW5jdGlvbiBnZXRVa0NlbnN1c1N0cmluZyhnZCwgb3B0aW9ucykge1xuICBsZXQgZGF0YVN0cmluZyA9IGdldEZ1bGxOYW1lKGdkKTtcblxuICBsZXQgYWdlID0gY2xlYW5BZ2UoZ2QuYWdlQXRFdmVudCk7XG4gIGxldCBtYXJpdGFsU3RhdHVzID0gZ2QubWFyaXRhbFN0YXR1cztcbiAgbGV0IHJlbGF0aW9uc2hpcFRvSGVhZCA9IGdkLnJlbGF0aW9uc2hpcFRvSGVhZDtcblxuICBpZiAobWFyaXRhbFN0YXR1cyA9PSBcIndpZG93XCIpIHtcbiAgICBtYXJpdGFsU3RhdHVzID0gXCJ3aWRvd2VkXCI7XG4gIH0gZWxzZSBpZiAobWFyaXRhbFN0YXR1cyA9PSBcInNpbmdsZVwiKSB7XG4gICAgbWFyaXRhbFN0YXR1cyA9IGdkLmdldFRlcm1Gb3JVbm1hcnJpZWQoKTtcbiAgfVxuXG4gIGlmIChhZ2UpIHtcbiAgICBkYXRhU3RyaW5nICs9IFwiIChcIiArIGFnZSArIFwiKVwiO1xuICB9XG5cbiAgaWYgKCFyZWxhdGlvbnNoaXBUb0hlYWQpIHtcbiAgICAvLyBubyByZWxhdGlvbnNoaXAgZGVmaW5lZCAoZS5nLiAxODQxKVxuICAgIGlmIChtYXJpdGFsU3RhdHVzKSB7XG4gICAgICBkYXRhU3RyaW5nICs9IFwiLCBcIiArIG1hcml0YWxTdGF0dXM7XG4gICAgfVxuICAgIGxldCBvY2N1cGF0aW9uID0gZ2Qub2NjdXBhdGlvbjtcbiAgICBpZiAob2NjdXBhdGlvbikge1xuICAgICAgZGF0YVN0cmluZyArPSBcIiwgXCIgKyBvY2N1cGF0aW9uICsgXCIsXCI7XG4gICAgfVxuICB9IGVsc2UgaWYgKHJlbGF0aW9uc2hpcFRvSGVhZCA9PSBcImhlYWRcIikge1xuICAgIGlmIChtYXJpdGFsU3RhdHVzKSB7XG4gICAgICBkYXRhU3RyaW5nICs9IFwiLCBcIiArIG1hcml0YWxTdGF0dXM7XG4gICAgfVxuICAgIGxldCBvY2N1cGF0aW9uID0gZ2Qub2NjdXBhdGlvbjtcbiAgICBpZiAob2NjdXBhdGlvbikge1xuICAgICAgZGF0YVN0cmluZyArPSBcIiwgXCIgKyBvY2N1cGF0aW9uICsgXCIsXCI7XG4gICAgfVxuICAgIGRhdGFTdHJpbmcgKz0gXCIgaGVhZCBvZiBob3VzZWhvbGRcIjtcbiAgfSBlbHNlIHtcbiAgICBsZXQgbmVlZHNDbG9zaW5nQ29tbWEgPSBmYWxzZTtcbiAgICBpZiAocmVsYXRpb25zaGlwVG9IZWFkID09IFwid2lmZVwiKSB7XG4gICAgICBkYXRhU3RyaW5nICs9IFwiLCB3aWZlXCI7XG4gICAgICBuZWVkc0Nsb3NpbmdDb21tYSA9IHRydWU7XG4gICAgfSBlbHNlIGlmIChyZWxhdGlvbnNoaXBUb0hlYWQpIHtcbiAgICAgIGlmIChtYXJpdGFsU3RhdHVzKSB7XG4gICAgICAgIGRhdGFTdHJpbmcgKz0gXCIsIFwiICsgbWFyaXRhbFN0YXR1cztcbiAgICAgICAgbmVlZHNDbG9zaW5nQ29tbWEgPSB0cnVlO1xuICAgICAgfVxuICAgICAgZGF0YVN0cmluZyArPSBcIiBcIiArIHJlbGF0aW9uc2hpcFRvSGVhZDtcbiAgICB9XG5cbiAgICBsZXQgb2NjdXBhdGlvbiA9IGdkLm9jY3VwYXRpb247XG4gICAgaWYgKG9jY3VwYXRpb24pIHtcbiAgICAgIGRhdGFTdHJpbmcgKz0gXCIsIFwiICsgb2NjdXBhdGlvbjtcbiAgICAgIG5lZWRzQ2xvc2luZ0NvbW1hID0gdHJ1ZTtcbiAgICB9XG5cbiAgICBpZiAobmVlZHNDbG9zaW5nQ29tbWEpIHtcbiAgICAgIGRhdGFTdHJpbmcgKz0gXCIsXCI7XG4gICAgfVxuXG4gICAgaWYgKGdkLmhvdXNlaG9sZEFycmF5ICYmIGdkLmhvdXNlaG9sZEFycmF5Lmxlbmd0aCA+IDApIHtcbiAgICAgIGxldCBoZWFkSW5kZXggPSBnZXRIZWFkT2ZIb3VzZWhvbGRJbmRleChnZC5ob3VzZWhvbGRBcnJheSk7XG4gICAgICBsZXQgaGVhZE5hbWUgPSBnZC5ob3VzZWhvbGRBcnJheVtoZWFkSW5kZXhdLm5hbWU7XG4gICAgICBsZXQgaGVhZEFnZSA9IGNsZWFuQWdlKGdkLmhvdXNlaG9sZEFycmF5W2hlYWRJbmRleF0uYWdlKTtcblxuICAgICAgaWYgKGhlYWROYW1lKSB7XG4gICAgICAgIGRhdGFTdHJpbmcgKz0gXCIgaW4gaG91c2Vob2xkIG9mIFwiO1xuICAgICAgICBkYXRhU3RyaW5nICs9IGhlYWROYW1lO1xuICAgICAgICBpZiAoaGVhZEFnZSkge1xuICAgICAgICAgIGRhdGFTdHJpbmcgKz0gXCIgKFwiICsgaGVhZEFnZSArIFwiKVwiO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLy8gd2Ugd2FudCB0byBnaXZlIG1vcmUgdGhhbiBqdXN0IHRoZSBzdHJlZXQgYWRkcmVzcyBhbmQgdGhlIHJlZ2lzdHJhdGlvbiBkaXN0cmljdCBpZiBwb3NzaWJsZVxuICAvLyBGaXJzdCBjaGVjayBpZiB0aGUgcmVnaXN0cmF0aW9uIGRpc3RyaWN0IGlzIHBhcnQgb2YgdGhlIHBsYWNlU3RyaW5nLlxuICBpZiAoZ2QuZXZlbnRQbGFjZSkge1xuICAgIGlmICghZ2QucmVnaXN0cmF0aW9uRGlzdHJpY3QpIHtcbiAgICAgIC8vIHRoaXMgY2FuIGhhcHBlbiBmb3IgMTkxMSBjZW5ldXMgb24gQW5jZXN0cnkgd2hpY2gganVzdCBoYXMgYSBudW1iZXIgZm9yIGRpc3RyaWN0XG4gICAgICBpZiAoZ2QuZXZlbnRQbGFjZSAmJiBnZC5ldmVudFBsYWNlLnBsYWNlU3RyaW5nKSB7XG4gICAgICAgIGRhdGFTdHJpbmcgKz0gXCIgXCIgKyBnZXRQbGFjZVdpdGhQcmVwb3NpdGlvbihnZC5ldmVudFBsYWNlLnBsYWNlU3RyaW5nKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgbGV0IGFkZGVkUGxhY2UgPSBmYWxzZTtcbiAgICAgIGxldCBwbGFjZVBhcnRzID0gZ2QuZXZlbnRQbGFjZS5zZXBhcmF0ZVBsYWNlSW50b1BhcnRzKCk7XG4gICAgICBpZiAocGxhY2VQYXJ0cy5sb2NhbFBsYWNlKSB7XG4gICAgICAgIGxldCByZWdJbmRleCA9IHBsYWNlUGFydHMubG9jYWxQbGFjZS5pbmRleE9mKFwiLCBcIiArIGdkLnJlZ2lzdHJhdGlvbkRpc3RyaWN0ICsgXCIsIFwiKTtcbiAgICAgICAgaWYgKHJlZ0luZGV4ID09IC0xKSB7XG4gICAgICAgICAgaWYgKHBsYWNlUGFydHMubG9jYWxQbGFjZS5lbmRzV2l0aChcIiwgXCIgKyBnZC5yZWdpc3RyYXRpb25EaXN0cmljdCkpIHtcbiAgICAgICAgICAgIHJlZ0luZGV4ID0gcGxhY2VQYXJ0cy5sb2NhbFBsYWNlLmluZGV4T2YoXCIsIFwiICsgZ2QucmVnaXN0cmF0aW9uRGlzdHJpY3QpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAocmVnSW5kZXggIT0gLTEpIHtcbiAgICAgICAgICBsZXQgc2hvcnRQbGFjZVN0cmluZyA9IHBsYWNlUGFydHMubG9jYWxQbGFjZS5zdWJzdHJpbmcoMCwgcmVnSW5kZXgpO1xuICAgICAgICAgIHNob3J0UGxhY2VTdHJpbmcgPSBnZXRQbGFjZVdpdGhQcmVwb3NpdGlvbihzaG9ydFBsYWNlU3RyaW5nKTtcbiAgICAgICAgICBkYXRhU3RyaW5nICs9IFwiIFwiICsgc2hvcnRQbGFjZVN0cmluZztcbiAgICAgICAgICBkYXRhU3RyaW5nICs9IFwiIGluIFwiICsgZ2QucmVnaXN0cmF0aW9uRGlzdHJpY3QgKyBcIiByZWdpc3RyYXRpb24gZGlzdHJpY3RcIjtcbiAgICAgICAgICBhZGRlZFBsYWNlID0gdHJ1ZTtcbiAgICAgICAgfSBlbHNlIGlmIChwbGFjZVBhcnRzLmxvY2FsUGxhY2UgPT0gZ2QucmVnaXN0cmF0aW9uRGlzdHJpY3QpIHtcbiAgICAgICAgICAvLyBubyBwb2ludCBkdXBsaWNhdGluZyB0aGUgaW5mbyAtIGp1c3QgZ2l2ZSByZWdpc3RyYXRpb24gZGlzdHJpY3RcbiAgICAgICAgICBkYXRhU3RyaW5nICs9IFwiIGluIFwiICsgZ2QucmVnaXN0cmF0aW9uRGlzdHJpY3QgKyBcIiByZWdpc3RyYXRpb24gZGlzdHJpY3RcIjtcbiAgICAgICAgICBhZGRlZFBsYWNlID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKCFhZGRlZFBsYWNlKSB7XG4gICAgICAgIGlmIChwbGFjZVBhcnRzLmxvY2FsUGxhY2UpIHtcbiAgICAgICAgICBkYXRhU3RyaW5nICs9IFwiIFwiICsgZ2V0UGxhY2VXaXRoUHJlcG9zaXRpb24ocGxhY2VQYXJ0cy5sb2NhbFBsYWNlKTtcbiAgICAgICAgfSBlbHNlIGlmIChnZC5ldmVudFBsYWNlICYmIGdkLmV2ZW50UGxhY2UucGxhY2VTdHJpbmcpIHtcbiAgICAgICAgICBkYXRhU3RyaW5nICs9IFwiIFwiICsgZ2V0UGxhY2VXaXRoUHJlcG9zaXRpb24oZ2QuZXZlbnRQbGFjZS5wbGFjZVN0cmluZyk7XG4gICAgICAgIH1cbiAgICAgICAgZGF0YVN0cmluZyArPSBcIiBpbiBcIiArIGdkLnJlZ2lzdHJhdGlvbkRpc3RyaWN0ICsgXCIgcmVnaXN0cmF0aW9uIGRpc3RyaWN0XCI7XG4gICAgICB9XG4gICAgICBpZiAocGxhY2VQYXJ0cy5jb3VudHkgfHwgcGxhY2VQYXJ0cy5jb3VudHJ5KSB7XG4gICAgICAgIGRhdGFTdHJpbmcgKz0gXCIgaW4gXCI7XG4gICAgICAgIGlmIChwbGFjZVBhcnRzLmNvdW50eSAmJiBwbGFjZVBhcnRzLmNvdW50cnkpIHtcbiAgICAgICAgICBkYXRhU3RyaW5nICs9IHBsYWNlUGFydHMuY291bnR5ICsgXCIsIFwiICsgcGxhY2VQYXJ0cy5jb3VudHJ5O1xuICAgICAgICB9IGVsc2UgaWYgKHBsYWNlUGFydHMuY291bnR5KSB7XG4gICAgICAgICAgZGF0YVN0cmluZyArPSBwbGFjZVBhcnRzLmNvdW50eTtcbiAgICAgICAgfSBlbHNlIGlmIChwbGFjZVBhcnRzLmNvdW50cnkpIHtcbiAgICAgICAgICBkYXRhU3RyaW5nICs9IHBsYWNlUGFydHMuY291bnRyeTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfSBlbHNlIGlmIChnZC5yZWdpc3RyYXRpb25EaXN0cmljdCkge1xuICAgIGRhdGFTdHJpbmcgKz0gXCIgaW4gXCIgKyBnZC5yZWdpc3RyYXRpb25EaXN0cmljdCArIFwiIHJlZ2lzdHJhdGlvbiBkaXN0cmljdFwiO1xuICB9XG5cbiAgbGV0IGJpcnRoUGxhY2UgPSBnZC5pbmZlckJpcnRoUGxhY2UoKTtcbiAgaWYgKGJpcnRoUGxhY2UpIHtcbiAgICBkYXRhU3RyaW5nICs9IFwiLiBCb3JuIGluIFwiICsgYmlydGhQbGFjZTtcbiAgfVxuXG4gIGxldCBlbXBsb3llciA9IGdkLmVtcGxveWVyO1xuICBpZiAoZW1wbG95ZXIpIHtcbiAgICBkYXRhU3RyaW5nICs9IFwiLiBFbXBsb3llZCBieSBcIiArIGVtcGxveWVyO1xuICB9XG5cbiAgcmV0dXJuIGRhdGFTdHJpbmc7XG59XG5cbmZ1bmN0aW9uIGdldDE5MzlSZWdpc3RlclN0cmluZyhnZCwgb3B0aW9ucykge1xuICBsZXQgZGF0YVN0cmluZyA9IGdldEZ1bGxOYW1lKGdkKTtcblxuICBsZXQgYmlydGhEYXRlID0gZ2QuaW5mZXJCaXJ0aERhdGVPYmooKTtcbiAgaWYgKGJpcnRoRGF0ZSkge1xuICAgIGRhdGFTdHJpbmcgKz0gXCIgKGJvcm4gXCIgKyBjbGVhbkRhdGVPYmooYmlydGhEYXRlKSArIFwiKVwiO1xuICB9XG4gIGxldCBtYXJpdGFsU3RhdHVzID0gZ2QubWFyaXRhbFN0YXR1cztcbiAgaWYgKG1hcml0YWxTdGF0dXMpIHtcbiAgICAvLyBOb3RlIGluIHRoZSAxOTM5IHJlZ2lzdGVyIHRoZSB0ZXJtIHNpbmdsZSBpcyB1c2VkIHJhdGhlciB0aGFuIHVubWFycmllZCBzbyBsZWF2ZSBpdCB0aGF0IHdheVxuICAgIGRhdGFTdHJpbmcgKz0gXCIsIFwiICsgbWFyaXRhbFN0YXR1cztcbiAgfVxuICBsZXQgb2NjdXBhdGlvbiA9IGdkLm9jY3VwYXRpb247XG4gIGlmIChvY2N1cGF0aW9uKSB7XG4gICAgZGF0YVN0cmluZyArPSBcIiwgXCIgKyBvY2N1cGF0aW9uICsgXCIsXCI7XG4gIH1cblxuICBsZXQgcGxhY2UgPSBnZC5pbmZlckZ1bGxFdmVudFBsYWNlKCk7XG4gIGlmIChwbGFjZSkge1xuICAgIC8vIE5vdGUgd2UgdXNlZCB0byBhbHdheXMgdXNlIFwiYXRcIiB3aGljaCBtYXkgYmUgY29ycmVjdCBmb3IgQW5jZXN0cnkgYW5kIEZNUCBidXQgRlMgZG9lc24ndCBoYXZlXG4gICAgLy8gaG91c2UgbnVtYmVyL25hbWUuXG4gICAgZGF0YVN0cmluZyArPSBcIiBcIiArIGdldFBsYWNlV2l0aFByZXBvc2l0aW9uKHBsYWNlKTtcbiAgfVxuXG4gIHJldHVybiBkYXRhU3RyaW5nO1xufVxuXG5mdW5jdGlvbiBnZXRIZWFkT2ZIb3VzZWhvbGRJbmRleChob3VzZWhvbGRBcnJheSkge1xuICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgaG91c2Vob2xkQXJyYXkubGVuZ3RoOyBpbmRleCsrKSB7XG4gICAgbGV0IG1lbWJlciA9IGhvdXNlaG9sZEFycmF5W2luZGV4XTtcbiAgICBpZiAobWVtYmVyLnJlbGF0aW9uc2hpcCkge1xuICAgICAgbGV0IHJlbGF0aW9uc2hpcExjID0gbWVtYmVyLnJlbGF0aW9uc2hpcC50b0xvd2VyQ2FzZSgpO1xuICAgICAgaWYgKHJlbGF0aW9uc2hpcExjID09IFwiaGVhZFwiIHx8IHJlbGF0aW9uc2hpcExjLmluY2x1ZGVzKFwiaGVhZFwiKSkge1xuICAgICAgICByZXR1cm4gaW5kZXg7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIHJldHVybiAwO1xufVxuXG5mdW5jdGlvbiBnZXRPdGhlckNlbnN1c1N0cmluZyhnZCwgb3B0aW9ucykge1xuICBsZXQgZGF0YVN0cmluZyA9IGdldEZ1bGxOYW1lKGdkKTtcblxuICBsZXQgYWdlID0gY2xlYW5BZ2UoZ2QuYWdlQXRFdmVudCk7XG4gIGxldCBtYXJpdGFsU3RhdHVzID0gZ2QubWFyaXRhbFN0YXR1cztcbiAgbGV0IHJlbGF0aW9uc2hpcFRvSGVhZCA9IGdkLnJlbGF0aW9uc2hpcFRvSGVhZDtcblxuICBpZiAoYWdlKSB7XG4gICAgZGF0YVN0cmluZyArPSBcIiAoXCIgKyBhZ2UgKyBcIilcIjtcbiAgfVxuXG4gIGlmIChyZWxhdGlvbnNoaXBUb0hlYWQgPT0gXCJoZWFkXCIpIHtcbiAgICBpZiAobWFyaXRhbFN0YXR1cykge1xuICAgICAgZGF0YVN0cmluZyArPSBcIiwgXCIgKyBtYXJpdGFsU3RhdHVzO1xuICAgIH1cbiAgICBsZXQgb2NjdXBhdGlvbiA9IGdkLm9jY3VwYXRpb247XG4gICAgaWYgKG9jY3VwYXRpb24pIHtcbiAgICAgIGRhdGFTdHJpbmcgKz0gXCIsIFwiICsgb2NjdXBhdGlvbiArIFwiLFwiO1xuICAgIH1cbiAgICBkYXRhU3RyaW5nICs9IFwiIGhlYWQgb2YgaG91c2Vob2xkXCI7XG4gIH0gZWxzZSBpZiAocmVsYXRpb25zaGlwVG9IZWFkKSB7XG4gICAgbGV0IG5lZWRzQ2xvc2luZ0NvbW1hID0gZmFsc2U7XG4gICAgaWYgKHJlbGF0aW9uc2hpcFRvSGVhZCA9PSBcIndpZmVcIikge1xuICAgICAgZGF0YVN0cmluZyArPSBcIiwgd2lmZVwiO1xuICAgICAgbmVlZHNDbG9zaW5nQ29tbWEgPSB0cnVlO1xuICAgIH0gZWxzZSBpZiAocmVsYXRpb25zaGlwVG9IZWFkKSB7XG4gICAgICBpZiAobWFyaXRhbFN0YXR1cykge1xuICAgICAgICBkYXRhU3RyaW5nICs9IFwiLCBcIiArIG1hcml0YWxTdGF0dXM7XG4gICAgICAgIG5lZWRzQ2xvc2luZ0NvbW1hID0gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIGRhdGFTdHJpbmcgKz0gXCIgXCIgKyByZWxhdGlvbnNoaXBUb0hlYWQ7XG4gICAgfVxuXG4gICAgbGV0IG9jY3VwYXRpb24gPSBnZC5vY2N1cGF0aW9uO1xuICAgIGlmIChvY2N1cGF0aW9uKSB7XG4gICAgICBkYXRhU3RyaW5nICs9IFwiLCBcIiArIG9jY3VwYXRpb247XG4gICAgICBuZWVkc0Nsb3NpbmdDb21tYSA9IHRydWU7XG4gICAgfVxuXG4gICAgaWYgKG5lZWRzQ2xvc2luZ0NvbW1hKSB7XG4gICAgICBkYXRhU3RyaW5nICs9IFwiLFwiO1xuICAgIH1cblxuICAgIGlmIChnZC5ob3VzZWhvbGRBcnJheSAmJiBnZC5ob3VzZWhvbGRBcnJheS5sZW5ndGggPiAwKSB7XG4gICAgICBsZXQgaGVhZEluZGV4ID0gZ2V0SGVhZE9mSG91c2Vob2xkSW5kZXgoZ2QuaG91c2Vob2xkQXJyYXkpO1xuICAgICAgbGV0IGhlYWROYW1lID0gZ2QuaG91c2Vob2xkQXJyYXlbaGVhZEluZGV4XS5uYW1lO1xuICAgICAgbGV0IGhlYWRBZ2UgPSBjbGVhbkFnZShnZC5ob3VzZWhvbGRBcnJheVtoZWFkSW5kZXhdLmFnZSk7XG5cbiAgICAgIGlmIChoZWFkTmFtZSkge1xuICAgICAgICBkYXRhU3RyaW5nICs9IFwiIGluIGhvdXNlaG9sZCBvZiBcIjtcbiAgICAgICAgZGF0YVN0cmluZyArPSBoZWFkTmFtZTtcbiAgICAgICAgaWYgKGhlYWRBZ2UpIHtcbiAgICAgICAgICBkYXRhU3RyaW5nICs9IFwiIChcIiArIGhlYWRBZ2UgKyBcIilcIjtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfSBlbHNlIHtcbiAgICBpZiAobWFyaXRhbFN0YXR1cykge1xuICAgICAgZGF0YVN0cmluZyArPSBcIiwgXCIgKyBtYXJpdGFsU3RhdHVzO1xuICAgIH1cbiAgICBsZXQgb2NjdXBhdGlvbiA9IGdkLm9jY3VwYXRpb247XG4gICAgaWYgKG9jY3VwYXRpb24pIHtcbiAgICAgIGRhdGFTdHJpbmcgKz0gXCIsIFwiICsgb2NjdXBhdGlvbiArIFwiLFwiO1xuICAgIH1cbiAgfVxuXG4gIGxldCBwbGFjZSA9IGdkLmluZmVyRnVsbEV2ZW50UGxhY2UoKTtcbiAgaWYgKHBsYWNlKSB7XG4gICAgZGF0YVN0cmluZyArPSBcIiBcIiArIGdldFBsYWNlV2l0aFByZXBvc2l0aW9uKHBsYWNlKTtcbiAgfVxuXG4gIGxldCBiaXJ0aFBsYWNlID0gZ2QuaW5mZXJCaXJ0aFBsYWNlKCk7XG4gIGlmIChiaXJ0aFBsYWNlKSB7XG4gICAgZGF0YVN0cmluZyArPSBcIi4gQm9ybiBpbiBcIiArIGJpcnRoUGxhY2U7XG4gIH1cblxuICByZXR1cm4gZGF0YVN0cmluZztcbn1cblxuZnVuY3Rpb24gZ2V0Q2Vuc3VzU3RyaW5nKGdkLCBvcHRpb25zKSB7XG4gIC8vIEZpcnN0IHRlc3QgaWYgdGhpcyBpcyBhIHJlZ3VsYXIgZW5nbGFuZCBjZW5zdXMgb3IgYSAxOTM5IHJlZ2lzdGVyXG5cbiAgbGV0IGlzMTkzOVJlZ2lzdGVyID0gZmFsc2U7XG4gIGxldCBpc1VrQ2Vuc3VzID0gZmFsc2U7XG5cbiAgaWYgKGdkLmNvbGxlY3Rpb25EYXRhICYmIGdkLmNvbGxlY3Rpb25EYXRhLmlkKSB7XG4gICAgbGV0IGNvbGxlY3Rpb24gPSBSQy5maW5kQ29sbGVjdGlvbihnZC5zb3VyY2VPZkRhdGEsIGdkLmNvbGxlY3Rpb25EYXRhLmlkKTtcbiAgICBpZiAoY29sbGVjdGlvbikge1xuICAgICAgaWYgKGNvbGxlY3Rpb24ud3RzSWQgPT0gXCJFbmdsYW5kQW5kV2FsZXMxOTM5UmVnaXN0ZXJcIikge1xuICAgICAgICBpczE5MzlSZWdpc3RlciA9IHRydWU7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoY29sbGVjdGlvbi5jb3VudHJ5KSB7XG4gICAgICAgICAgbGV0IGNvdW50cnkgPSBjb2xsZWN0aW9uLmNvdW50cnk7XG4gICAgICAgICAgaWYgKGNvdW50cnkgPT0gXCJVbml0ZWQgS2luZ2RvbVwiIHx8IENELmlzUGFydE9mKGNvdW50cnksIFwiVW5pdGVkIEtpbmdkb21cIikpIHtcbiAgICAgICAgICAgIGlzVWtDZW5zdXMgPSB0cnVlO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGlmIChpczE5MzlSZWdpc3Rlcikge1xuICAgIHJldHVybiBnZXQxOTM5UmVnaXN0ZXJTdHJpbmcoZ2QsIG9wdGlvbnMpO1xuICB9XG5cbiAgaWYgKGlzVWtDZW5zdXMpIHtcbiAgICByZXR1cm4gZ2V0VWtDZW5zdXNTdHJpbmcoZ2QsIG9wdGlvbnMpO1xuICB9XG5cbiAgLy8gaXQgaXMgc29tZSBvdGhlciBjZW5zdXMgcmVjb3JkXG4gIHJldHVybiBnZXRPdGhlckNlbnN1c1N0cmluZyhnZCwgb3B0aW9ucyk7XG59XG5cbmZ1bmN0aW9uIGdldFVrUmVnaXN0cmF0aW9uU3RyaW5nKGdkLCBvcHRpb25zLCB0eXBlKSB7XG4gIGxldCBkYXRhU3RyaW5nID0gZ2V0RnVsbE5hbWUoZ2QpO1xuICBkYXRhU3RyaW5nICs9IFwiIFwiICsgdHlwZTtcblxuICBpZiAodHlwZSA9PSBcIm1hcnJpYWdlXCIgJiYgZ2Quc3BvdXNlcyAmJiBnZC5zcG91c2VzLmxlbmd0aCA9PSAxKSB7XG4gICAgbGV0IHNwb3VzZSA9IGdkLnNwb3VzZXNbMF07XG4gICAgaWYgKHNwb3VzZS5uYW1lKSB7XG4gICAgICBsZXQgc3BvdXNlTmFtZSA9IHNwb3VzZS5uYW1lLmluZmVyRnVsbE5hbWUoKTtcbiAgICAgIGlmIChzcG91c2VOYW1lKSB7XG4gICAgICAgIGRhdGFTdHJpbmcgKz0gXCIgdG8gXCIgKyBzcG91c2VOYW1lO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGRhdGFTdHJpbmcgKz0gXCIgcmVnaXN0ZXJlZFwiOyAvLyBtYWtlIGNsZWFyIHRoYXQgaXQgaXMgZGF0ZSBvZiByZWdpc3RyYXRpb24gbm90IGV2ZW50XG5cbiAgbGV0IHF1YXJ0ZXIgPSBnZXRRdWFydGVyTmFtZShnZC5pbmZlckV2ZW50UXVhcnRlcigpKTtcbiAgaWYgKHF1YXJ0ZXIpIHtcbiAgICBkYXRhU3RyaW5nICs9IFwiIFwiICsgcXVhcnRlcjtcblxuICAgIGxldCBldmVudFllYXIgPSBnZC5pbmZlckV2ZW50WWVhcigpO1xuICAgIGlmIChldmVudFllYXIpIHtcbiAgICAgIGRhdGFTdHJpbmcgKz0gXCIgXCIgKyBldmVudFllYXI7XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIGxldCBldmVudERhdGUgPSBnZC5pbmZlckV2ZW50RGF0ZU9iaigpO1xuICAgIGlmIChldmVudERhdGUpIHtcbiAgICAgIGRhdGFTdHJpbmcgKz0gXCIgXCIgKyBjbGVhbkRhdGVPYmooZXZlbnREYXRlKTtcbiAgICB9XG4gIH1cblxuICBsZXQgZGlzdHJpY3QgPSBnZC5yZWdpc3RyYXRpb25EaXN0cmljdDtcbiAgaWYgKCFkaXN0cmljdCkge1xuICAgIHJldHVybiBcIlwiOyAvLyBmYWxsYmFjayB0byBub24tY3VzdG9tIHN0cmluZ1xuICB9XG4gIGRhdGFTdHJpbmcgKz0gXCIgaW4gXCIgKyBkaXN0cmljdDtcblxuICBpZiAodHlwZSA9PSBcImJpcnRoXCIpIHtcbiAgICBpZiAoZ2QubW90aGVyc01haWRlbk5hbWUpIHtcbiAgICAgIGRhdGFTdHJpbmcgKz0gXCIsIG1vdGhlcidzIG1haWRlbiBuYW1lIFwiICsgZ2QubW90aGVyc01haWRlbk5hbWU7XG4gICAgfVxuICB9IGVsc2UgaWYgKHR5cGUgPT0gXCJkZWF0aFwiKSB7XG4gICAgbGV0IGJvcm5PckFnZVRleHQgPSBcIlwiO1xuXG4gICAgLy8gY29taW5nIGZyb20gRlMgdGhlIGdkLmJpcnRoRGF0ZS5kYXRlU3RyaW5nIGNvdWxkIGJlIHNvbWV0aGluZyBsaWtlIFwiMTg0NFwiLCB3ZSBkb24ndCB3YW50IHRvIHVzZSB0aGF0XG4gICAgaWYgKGdkLmJpcnRoRGF0ZSAmJiBnZC5iaXJ0aERhdGUuZGF0ZVN0cmluZyAmJiBnZC5iaXJ0aERhdGUuZGF0ZVN0cmluZy5sZW5ndGggPiA4KSB7XG4gICAgICAvLyBsYXRlciBVSyBkZWF0aCByZWdpc3RyYXRpb25zIGluY2x1ZGUgZnVsbCBiaXJ0aCBkYXRlIChhdmFpbGFibGUgYWZ0ZXIgSnVuZSBxdWFydGVyIDE5NjkpXG4gICAgICBsZXQgYmlydGhEYXRlID0gZ2QuaW5mZXJCaXJ0aERhdGVPYmooKTtcbiAgICAgIGJvcm5PckFnZVRleHQgPSBcImJvcm4gXCIgKyBjbGVhbkRhdGVPYmooYmlydGhEYXRlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgbGV0IGFnZSA9IGNsZWFuQWdlKGdkLmFnZUF0RGVhdGgpO1xuICAgICAgaWYgKCFhZ2UpIHtcbiAgICAgICAgYWdlID0gY2xlYW5BZ2UoZ2QuYWdlKTtcbiAgICAgIH1cbiAgICAgIGlmICghYWdlKSB7XG4gICAgICAgIGFnZSA9IGNsZWFuQWdlKGdkLmFnZUF0RXZlbnQpO1xuICAgICAgfVxuICAgICAgaWYgKGFnZSkge1xuICAgICAgICBib3JuT3JBZ2VUZXh0ID0gXCJhZ2UgXCIgKyBhZ2U7XG4gICAgICB9IGVsc2UgaWYgKGdkLmJpcnRoRGF0ZSkge1xuICAgICAgICBsZXQgZGF0ZVN0cmluZyA9IGdkLmJpcnRoRGF0ZS5kYXRlU3RyaW5nO1xuICAgICAgICBpZiAoIWRhdGVTdHJpbmcpIHtcbiAgICAgICAgICBkYXRlU3RyaW5nID0gZ2QuYmlydGhEYXRlLnllYXJTdHJpbmc7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGRhdGVTdHJpbmcpIHtcbiAgICAgICAgICBib3JuT3JBZ2VUZXh0ID0gXCJib3JuIFwiICsgZGF0ZVN0cmluZztcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIGxldCBtbW5UZXh0ID0gXCJcIjtcbiAgICBpZiAoZ2QubW90aGVyc01haWRlbk5hbWUpIHtcbiAgICAgIG1tblRleHQgPSBcIm1vdGhlcidzIG1haWRlbiBuYW1lIFwiICsgZ2QubW90aGVyc01haWRlbk5hbWU7XG4gICAgfVxuXG4gICAgaWYgKGJvcm5PckFnZVRleHQgJiYgbW1uVGV4dCkge1xuICAgICAgZGF0YVN0cmluZyArPSBcIiAoXCIgKyBib3JuT3JBZ2VUZXh0ICsgXCIsIFwiICsgbW1uVGV4dCArIFwiKVwiO1xuICAgIH0gZWxzZSBpZiAoYm9ybk9yQWdlVGV4dCkge1xuICAgICAgZGF0YVN0cmluZyArPSBcIiAoXCIgKyBib3JuT3JBZ2VUZXh0ICsgXCIpXCI7XG4gICAgfSBlbHNlIGlmIChtbW5UZXh0KSB7XG4gICAgICBkYXRhU3RyaW5nICs9IFwiIChcIiArIG1tblRleHQgKyBcIilcIjtcbiAgICB9XG4gIH1cblxuICAvLyBOb3JtYWxseSBhIHJlZmVyZW5jZSBzdHJpbmcgd291bGQgYmUgYSBzZXBhcmF0ZSBwYXJ0IG9mIHRoZSBjaXRhdGlvbiAtIG5vdCBpbiB0aGUgZGF0YSBzdHJpbmdcbiAgLy8gR1JPIGFuZCBGcmVlQk1EIGFyZSBzcGVjaWFsIGNhc2VzLlxuICBpZiAoZ2Quc291cmNlT2ZEYXRhID09IFwiZ3JvXCIgfHwgZ2Quc291cmNlT2ZEYXRhID09IFwiZnJlZWJtZFwiKSB7XG4gICAgZGF0YVN0cmluZyArPSBnZXRSZWZlcmVuY2VTdHJpbmcoZ2QsIG9wdGlvbnMpO1xuICB9XG5cbiAgcmV0dXJuIGRhdGFTdHJpbmc7XG59XG5cbmZ1bmN0aW9uIGdldEJpcnRoUmVnaXN0cmF0aW9uU3RyaW5nKGdkLCBvcHRpb25zKSB7XG4gIGlmIChnZC5pc1JlY29yZEluQ291bnRyeShcIlVuaXRlZCBLaW5nZG9tXCIpKSB7XG4gICAgcmV0dXJuIGdldFVrUmVnaXN0cmF0aW9uU3RyaW5nKGdkLCBvcHRpb25zLCBcImJpcnRoXCIpO1xuICB9XG5cbiAgbGV0IGRhdGFTdHJpbmcgPSBcIlwiO1xuXG4gIC8vIGdlbmVyaWMgYmlydGggcmVnaXN0cmF0aW9uXG4gIGlmIChnZC5yb2xlICYmIGdkLnJvbGUgPT0gUm9sZS5QYXJlbnQpIHtcbiAgICBpZiAoZ2QucHJpbWFyeVBlcnNvbikge1xuICAgICAgZGF0YVN0cmluZyArPSBnZC5wcmltYXJ5UGVyc29uO1xuICAgIH0gZWxzZSB7XG4gICAgICBkYXRhU3RyaW5nICs9IFwiY2hpbGRcIjtcbiAgICB9XG5cbiAgICBkYXRhU3RyaW5nICs9IFwiIGJvcm4gdG8gXCI7XG5cbiAgICBkYXRhU3RyaW5nICs9IGdldEZ1bGxOYW1lKGdkKTtcbiAgICBpZiAoZ2Quc3BvdXNlcyAmJiBnZC5zcG91c2VzWzBdICYmIGdkLnNwb3VzZXNbMF0ubmFtZSAmJiBnZC5zcG91c2VzWzBdLm5hbWUubmFtZSkge1xuICAgICAgZGF0YVN0cmluZyArPSBcIiBhbmQgXCIgKyBnZC5zcG91c2VzWzBdLm5hbWUubmFtZTtcbiAgICB9XG5cbiAgICBsZXQgZGF0ZSA9IGdkLmluZmVyRXZlbnREYXRlT2JqKCk7XG4gICAgaWYgKGRhdGUpIHtcbiAgICAgIGRhdGFTdHJpbmcgKz0gXCIgXCIgKyBnZXREYXRlV2l0aFByZXBvc2l0aW9uKGRhdGUpO1xuICAgIH1cblxuICAgIGxldCBwbGFjZSA9IGdkLmluZmVyRXZlbnRQbGFjZSgpO1xuICAgIGlmIChwbGFjZSkge1xuICAgICAgZGF0YVN0cmluZyArPSBcIiBpbiBcIiArIHBsYWNlO1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICBkYXRhU3RyaW5nID0gZ2V0RnVsbE5hbWUoZ2QpO1xuICAgIGRhdGFTdHJpbmcgKz0gXCIgYmlydGhcIjtcblxuICAgIGxldCBiaXJ0aERhdGUgPSBnZC5pbmZlckJpcnRoRGF0ZSgpO1xuICAgIGlmIChiaXJ0aERhdGUpIHtcbiAgICAgIGRhdGFTdHJpbmcgKz0gXCIgXCIgKyBiaXJ0aERhdGU7XG4gICAgfVxuXG4gICAgbGV0IHBsYWNlID0gZ2QuaW5mZXJFdmVudFBsYWNlKCk7XG4gICAgaWYgKHBsYWNlKSB7XG4gICAgICBkYXRhU3RyaW5nICs9IFwiIGluIFwiICsgcGxhY2U7XG4gICAgfVxuXG4gICAgaWYgKGdkLnBhcmVudHMpIHtcbiAgICAgIGxldCBmYXRoZXJOYW1lID0gXCJcIjtcbiAgICAgIGlmIChnZC5wYXJlbnRzLmZhdGhlciAmJiBnZC5wYXJlbnRzLmZhdGhlci5uYW1lKSB7XG4gICAgICAgIGZhdGhlck5hbWUgPSBnZC5wYXJlbnRzLmZhdGhlci5uYW1lLmluZmVyRnVsbE5hbWUoKTtcbiAgICAgIH1cbiAgICAgIGxldCBtb3RoZXJOYW1lID0gXCJcIjtcbiAgICAgIGlmIChnZC5wYXJlbnRzLm1vdGhlciAmJiBnZC5wYXJlbnRzLm1vdGhlci5uYW1lKSB7XG4gICAgICAgIG1vdGhlck5hbWUgPSBnZC5wYXJlbnRzLm1vdGhlci5uYW1lLmluZmVyRnVsbE5hbWUoKTtcbiAgICAgIH1cblxuICAgICAgaWYgKGdkLnBlcnNvbkdlbmRlciA9PSBcIm1hbGVcIikge1xuICAgICAgICBkYXRhU3RyaW5nICs9IFwiLCBzb24gb2ZcIjtcbiAgICAgIH0gZWxzZSBpZiAoZ2QucGVyc29uR2VuZGVyID09IFwiZmVtYWxlXCIpIHtcbiAgICAgICAgZGF0YVN0cmluZyArPSBcIiwgZGF1Z2h0ZXIgb2ZcIjtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGRhdGFTdHJpbmcgKz0gXCIsIGNoaWxkIG9mXCI7XG4gICAgICB9XG4gICAgICBpZiAoZmF0aGVyTmFtZSkge1xuICAgICAgICBkYXRhU3RyaW5nICs9IFwiIFwiICsgZmF0aGVyTmFtZTtcbiAgICAgIH1cbiAgICAgIGlmIChtb3RoZXJOYW1lKSB7XG4gICAgICAgIGlmIChmYXRoZXJOYW1lKSB7XG4gICAgICAgICAgZGF0YVN0cmluZyArPSBcIiAmXCI7XG4gICAgICAgIH1cbiAgICAgICAgZGF0YVN0cmluZyArPSBcIiBcIiArIG1vdGhlck5hbWU7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKGdkLm1vdGhlcnNNYWlkZW5OYW1lKSB7XG4gICAgICBkYXRhU3RyaW5nICs9IFwiLCBtb3RoZXIncyBtYWlkZW4gbmFtZSBcIiArIGdkLm1vdGhlcnNNYWlkZW5OYW1lO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiBkYXRhU3RyaW5nO1xufVxuXG5mdW5jdGlvbiBnZXREZWF0aFJlZ2lzdHJhdGlvblN0cmluZyhnZCwgb3B0aW9ucykge1xuICBpZiAoZ2QuaXNSZWNvcmRJbkNvdW50cnkoXCJVbml0ZWQgS2luZ2RvbVwiKSkge1xuICAgIHJldHVybiBnZXRVa1JlZ2lzdHJhdGlvblN0cmluZyhnZCwgb3B0aW9ucywgXCJkZWF0aFwiKTtcbiAgfVxuXG4gIGxldCBkZWF0aERhdGUgPSBnZC5pbmZlckRlYXRoRGF0ZU9iaigpO1xuXG4gIC8vIGdlbmVyaWMgZGVhdGggcmVnaXN0cmF0aW9uXG4gIGxldCBkYXRhU3RyaW5nID0gZ2V0RnVsbE5hbWUoZ2QpO1xuICBpZiAoZ2Qucm9sZSA9PSBSb2xlLlBhcmVudCkge1xuICAgIGRhdGFTdHJpbmcgKz0gXCIgaW4gZGVhdGggcmVjb3JkIGZvciBcIiArIGdldFByaW1hcnlQZXJzb25DaGlsZFRlcm0oZ2QpO1xuICAgIGlmIChnZC5wcmltYXJ5UGVyc29uKSB7XG4gICAgICBkYXRhU3RyaW5nICs9IFwiIFwiICsgZ2QucHJpbWFyeVBlcnNvbiArIFwiLFwiO1xuICAgIH1cbiAgICBkZWF0aERhdGUgPSBnZC5pbmZlckV2ZW50RGF0ZU9iaigpO1xuICB9IGVsc2UgaWYgKGdkLnJvbGUgPT0gUm9sZS5TcG91c2UpIHtcbiAgICBkYXRhU3RyaW5nICs9IFwiIGluIGRlYXRoIHJlY29yZCBmb3IgXCIgKyBnZXRQcmltYXJ5UGVyc29uU3BvdXNlVGVybShnZCk7XG4gICAgaWYgKGdkLnByaW1hcnlQZXJzb24pIHtcbiAgICAgIGRhdGFTdHJpbmcgKz0gXCIgXCIgKyBnZC5wcmltYXJ5UGVyc29uICsgXCIsXCI7XG4gICAgfVxuICAgIGRlYXRoRGF0ZSA9IGdkLmluZmVyRXZlbnREYXRlT2JqKCk7XG4gIH0gZWxzZSB7XG4gICAgZGF0YVN0cmluZyArPSBcIiBkZWF0aFwiO1xuICB9XG5cbiAgaWYgKGRlYXRoRGF0ZSkge1xuICAgIGRhdGFTdHJpbmcgKz0gXCIgXCIgKyBjbGVhbkRhdGVPYmooZGVhdGhEYXRlKTtcbiAgfVxuXG4gIGxldCBhZ2UgPSBjbGVhbkFnZShnZC5hZ2VBdERlYXRoKTtcbiAgaWYgKGFnZSkge1xuICAgIGRhdGFTdHJpbmcgKz0gXCIgKGFnZSBcIiArIGFnZSArIFwiKVwiO1xuICB9XG5cbiAgbGV0IHBsYWNlID0gZ2QuaW5mZXJFdmVudFBsYWNlKCk7XG4gIGxldCByZWdpc3RyYXRpb25EaXN0cmljdCA9IGdkLnJlZ2lzdHJhdGlvbkRpc3RyaWN0O1xuXG4gIGlmIChwbGFjZSkge1xuICAgIGRhdGFTdHJpbmcgKz0gXCIgaW4gXCIgKyBwbGFjZTtcbiAgfSBlbHNlIGlmIChyZWdpc3RyYXRpb25EaXN0cmljdCkge1xuICAgIGRhdGFTdHJpbmcgKz0gXCIgaW4gdGhlIFwiICsgcmVnaXN0cmF0aW9uRGlzdHJpY3QgKyBcIiBkaXN0cmljdFwiO1xuICB9XG5cbiAgcmV0dXJuIGRhdGFTdHJpbmc7XG59XG5cbmZ1bmN0aW9uIGdldE1hcnJpYWdlUmVnaXN0cmF0aW9uU3RyaW5nKGdkLCBvcHRpb25zKSB7XG4gIGlmIChnZC5pc1JlY29yZEluQ291bnRyeShcIlVuaXRlZCBLaW5nZG9tXCIpKSB7XG4gICAgcmV0dXJuIGdldFVrUmVnaXN0cmF0aW9uU3RyaW5nKGdkLCBvcHRpb25zLCBcIm1hcnJpYWdlXCIpO1xuICB9XG5cbiAgLy8gZ2VuZXJpYyBtYXJyaWFnZSByZWdcbiAgbGV0IGRhdGFTdHJpbmcgPSBnZXRGdWxsTmFtZShnZCk7XG5cbiAgbGV0IGFnZSA9IGNsZWFuQWdlKGdkLmFnZUF0RXZlbnQpO1xuICBpZiAoYWdlKSB7XG4gICAgZGF0YVN0cmluZyArPSBcIiAoXCIgKyBhZ2UgKyBcIilcIjtcbiAgfVxuXG4gIGlmIChnZC5yb2xlICYmIGdkLnJvbGUgPT0gUm9sZS5QYXJlbnQpIHtcbiAgICBkYXRhU3RyaW5nICs9IFwiIGNoaWxkXCI7XG4gIH1cblxuICBkYXRhU3RyaW5nICs9IFwiIG1hcnJpYWdlXCI7XG5cbiAgaWYgKGdkLnNwb3VzZXMgJiYgZ2Quc3BvdXNlcy5sZW5ndGggPT0gMSkge1xuICAgIGxldCBzcG91c2UgPSBnZC5zcG91c2VzWzBdO1xuICAgIGlmIChzcG91c2UubmFtZSkge1xuICAgICAgbGV0IHNwb3VzZU5hbWUgPSBzcG91c2UubmFtZS5pbmZlckZ1bGxOYW1lKCk7XG4gICAgICBkYXRhU3RyaW5nICs9IFwiIHRvIFwiICsgc3BvdXNlTmFtZTtcblxuICAgICAgbGV0IHNwb3VzZUFnZSA9IGNsZWFuQWdlKHNwb3VzZS5hZ2UpO1xuICAgICAgaWYgKHNwb3VzZUFnZSkge1xuICAgICAgICBkYXRhU3RyaW5nICs9IFwiIChcIiArIHNwb3VzZUFnZSArIFwiKVwiO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGxldCBkYXRlID0gZ2QuaW5mZXJFdmVudERhdGVPYmooKTtcbiAgaWYgKCFkYXRlICYmIGdkLm1hcnJpYWdlRGF0ZSkge1xuICAgIGRhdGUgPSBuZXcgV3RzRGF0ZSgpO1xuICAgIGRhdGUuZGF0ZVN0cmluZyA9IGdkLm1hcnJpYWdlRGF0ZTtcbiAgfVxuICBpZiAoZGF0ZSkge1xuICAgIGRhdGFTdHJpbmcgKz0gXCIgXCIgKyBnZXREYXRlV2l0aFByZXBvc2l0aW9uKGRhdGUpO1xuICB9XG5cbiAgbGV0IHBsYWNlID0gZ2QuaW5mZXJGdWxsRXZlbnRQbGFjZSgpO1xuICBpZiAocGxhY2UpIHtcbiAgICBkYXRhU3RyaW5nICs9IFwiIFwiICsgZ2V0UGxhY2VXaXRoUHJlcG9zaXRpb24ocGxhY2UpO1xuICB9XG5cbiAgcmV0dXJuIGRhdGFTdHJpbmc7XG59XG5cbmZ1bmN0aW9uIGdldEJpcnRoU3RyaW5nKGdkLCBvcHRpb25zKSB7XG4gIGxldCBkYXRhU3RyaW5nID0gXCJcIjtcblxuICBpZiAoZ2Qucm9sZSAmJiBnZC5yb2xlID09IFJvbGUuUGFyZW50KSB7XG4gICAgaWYgKGdkLnByaW1hcnlQZXJzb24pIHtcbiAgICAgIGRhdGFTdHJpbmcgKz0gZ2QucHJpbWFyeVBlcnNvbjtcbiAgICB9IGVsc2Uge1xuICAgICAgZGF0YVN0cmluZyArPSBcImNoaWxkXCI7XG4gICAgfVxuXG4gICAgaWYgKGdkLnJlY29yZFR5cGUgPT0gUlQuQmlydGgpIHtcbiAgICAgIGRhdGFTdHJpbmcgKz0gXCIgYm9ybiB0byBcIjtcbiAgICB9IGVsc2Uge1xuICAgICAgZGF0YVN0cmluZyArPSBcIiBib3JuIG9yIGJhcHRpc2VkIHRvIFwiO1xuICAgIH1cbiAgICBkYXRhU3RyaW5nICs9IGdldEZ1bGxOYW1lKGdkKTtcbiAgICBpZiAoZ2Quc3BvdXNlcyAmJiBnZC5zcG91c2VzWzBdICYmIGdkLnNwb3VzZXNbMF0ubmFtZSAmJiBnZC5zcG91c2VzWzBdLm5hbWUubmFtZSkge1xuICAgICAgZGF0YVN0cmluZyArPSBcIiBhbmQgXCIgKyBnZC5zcG91c2VzWzBdLm5hbWUubmFtZTtcbiAgICB9XG5cbiAgICBsZXQgZGF0ZSA9IGdkLmluZmVyRXZlbnREYXRlT2JqKCk7XG4gICAgaWYgKGRhdGUpIHtcbiAgICAgIGRhdGFTdHJpbmcgKz0gXCIgXCIgKyBnZXREYXRlV2l0aFByZXBvc2l0aW9uKGRhdGUpO1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICBkYXRhU3RyaW5nICs9IGdldEZ1bGxOYW1lKGdkKTtcblxuICAgIGlmIChnZC5yZWNvcmRUeXBlID09IFJULkJpcnRoKSB7XG4gICAgICBkYXRhU3RyaW5nICs9IFwiIGJvcm5cIjtcbiAgICB9IGVsc2Uge1xuICAgICAgZGF0YVN0cmluZyArPSBcIiBib3JuIG9yIGJhcHRpc2VkXCI7XG4gICAgfVxuXG4gICAgbGV0IGRhdGUgPSBnZC5pbmZlckV2ZW50RGF0ZU9iaigpO1xuICAgIGlmIChkYXRlKSB7XG4gICAgICBkYXRhU3RyaW5nICs9IFwiIFwiICsgZ2V0RGF0ZVdpdGhQcmVwb3NpdGlvbihkYXRlKTtcbiAgICB9XG5cbiAgICBsZXQgcGFyZW50TmFtZXMgPSBnZC5pbmZlclBhcmVudE5hbWVzRm9yRGF0YVN0cmluZygpO1xuICAgIGlmIChwYXJlbnROYW1lcy5mYXRoZXJOYW1lIHx8IHBhcmVudE5hbWVzLm1vdGhlck5hbWUpIHtcbiAgICAgIGlmIChnZC5wZXJzb25HZW5kZXIgPT0gXCJtYWxlXCIpIHtcbiAgICAgICAgZGF0YVN0cmluZyArPSBcIiwgc29uIG9mIFwiO1xuICAgICAgfSBlbHNlIGlmIChnZC5wZXJzb25HZW5kZXIgPT0gXCJmZW1hbGVcIikge1xuICAgICAgICBkYXRhU3RyaW5nICs9IFwiLCBkYXVnaHRlciBvZiBcIjtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGRhdGFTdHJpbmcgKz0gXCIsIGNoaWxkIG9mIFwiO1xuICAgICAgfVxuICAgICAgaWYgKHBhcmVudE5hbWVzLmZhdGhlck5hbWUpIHtcbiAgICAgICAgZGF0YVN0cmluZyArPSBwYXJlbnROYW1lcy5mYXRoZXJOYW1lO1xuICAgICAgfVxuICAgICAgaWYgKHBhcmVudE5hbWVzLm1vdGhlck5hbWUpIHtcbiAgICAgICAgaWYgKHBhcmVudE5hbWVzLmZhdGhlck5hbWUpIHtcbiAgICAgICAgICBkYXRhU3RyaW5nICs9IFwiICYgXCI7XG4gICAgICAgIH1cbiAgICAgICAgZGF0YVN0cmluZyArPSBwYXJlbnROYW1lcy5tb3RoZXJOYW1lO1xuICAgICAgfVxuICAgICAgZGF0YVN0cmluZyArPSBcIixcIjtcbiAgICB9XG4gIH1cblxuICBsZXQgcGxhY2UgPSBnZC5pbmZlckZ1bGxFdmVudFBsYWNlKCk7XG4gIGlmIChwbGFjZSkge1xuICAgIGRhdGFTdHJpbmcgKz0gXCIgXCIgKyBnZXRQbGFjZVdpdGhQcmVwb3NpdGlvbihwbGFjZSk7XG4gIH0gZWxzZSBpZiAoZGF0YVN0cmluZy5lbmRzV2l0aChcIixcIikpIHtcbiAgICBkYXRhU3RyaW5nID0gZGF0YVN0cmluZy5zdWJzdHJpbmcoMCwgZGF0YVN0cmluZy5sZW5ndGggLSAxKTtcbiAgfVxuXG4gIHJldHVybiBkYXRhU3RyaW5nO1xufVxuXG5mdW5jdGlvbiBnZXREZWF0aFN0cmluZyhnZCwgb3B0aW9ucykge1xuICBsZXQgZGF0YVN0cmluZyA9IGdldEZ1bGxOYW1lKGdkKTtcblxuICBsZXQgZGVhdGhEYXRlID0gZ2QuaW5mZXJEZWF0aERhdGVPYmooKTtcblxuICBpZiAoZ2Qucm9sZSA9PSBSb2xlLlBhcmVudCkge1xuICAgIGRhdGFTdHJpbmcgKz0gXCIgaW4gZGVhdGggcmVjb3JkIGZvciBcIiArIGdldFByaW1hcnlQZXJzb25DaGlsZFRlcm0oZ2QpO1xuICAgIGlmIChnZC5wcmltYXJ5UGVyc29uKSB7XG4gICAgICBkYXRhU3RyaW5nICs9IFwiIFwiICsgZ2QucHJpbWFyeVBlcnNvbiArIFwiLFwiO1xuICAgIH1cbiAgICBkZWF0aERhdGUgPSBnZC5pbmZlckV2ZW50RGF0ZU9iaigpO1xuICB9IGVsc2UgaWYgKGdkLnJvbGUgPT0gUm9sZS5TcG91c2UpIHtcbiAgICBkYXRhU3RyaW5nICs9IFwiIGluIGRlYXRoIHJlY29yZCBmb3IgXCIgKyBnZXRQcmltYXJ5UGVyc29uU3BvdXNlVGVybShnZCk7XG4gICAgaWYgKGdkLnByaW1hcnlQZXJzb24pIHtcbiAgICAgIGRhdGFTdHJpbmcgKz0gXCIgXCIgKyBnZC5wcmltYXJ5UGVyc29uICsgXCIsXCI7XG4gICAgfVxuICAgIGRlYXRoRGF0ZSA9IGdkLmluZmVyRXZlbnREYXRlT2JqKCk7XG4gIH0gZWxzZSB7XG4gICAgZGF0YVN0cmluZyArPSBcIiBkZWF0aFwiO1xuICB9XG5cbiAgaWYgKGRlYXRoRGF0ZSkge1xuICAgIGRhdGFTdHJpbmcgKz0gXCIgXCIgKyBjbGVhbkRhdGVPYmooZGVhdGhEYXRlKTtcbiAgfVxuXG4gIGlmIChnZC5iaXJ0aERhdGUgJiYgZ2QuYmlydGhEYXRlLmRhdGVTdHJpbmcgJiYgZ2QuYmlydGhEYXRlLmRhdGVTdHJpbmcubGVuZ3RoID4gNCkge1xuICAgIGRhdGFTdHJpbmcgKz0gXCIgKGJvcm4gXCIgKyBnZC5iaXJ0aERhdGUuZGF0ZVN0cmluZyArIFwiKVwiO1xuICB9IGVsc2Uge1xuICAgIGxldCBhZ2UgPSBjbGVhbkFnZShnZC5hZ2VBdERlYXRoKTtcbiAgICBpZiAoYWdlKSB7XG4gICAgICBkYXRhU3RyaW5nICs9IFwiIChhZ2UgXCIgKyBhZ2UgKyBcIilcIjtcbiAgICB9XG4gIH1cblxuICBsZXQgcGFyZW50TmFtZXMgPSBnZC5pbmZlclBhcmVudE5hbWVzRm9yRGF0YVN0cmluZygpO1xuICBpZiAocGFyZW50TmFtZXMuZmF0aGVyTmFtZSB8fCBwYXJlbnROYW1lcy5tb3RoZXJOYW1lKSB7XG4gICAgaWYgKGdkLnBlcnNvbkdlbmRlciA9PSBcIm1hbGVcIikge1xuICAgICAgZGF0YVN0cmluZyArPSBcIiwgc29uIG9mIFwiO1xuICAgIH0gZWxzZSBpZiAoZ2QucGVyc29uR2VuZGVyID09IFwiZmVtYWxlXCIpIHtcbiAgICAgIGRhdGFTdHJpbmcgKz0gXCIsIGRhdWdodGVyIG9mIFwiO1xuICAgIH0gZWxzZSB7XG4gICAgICBkYXRhU3RyaW5nICs9IFwiLCBjaGlsZCBvZiBcIjtcbiAgICB9XG4gICAgaWYgKHBhcmVudE5hbWVzLmZhdGhlck5hbWUpIHtcbiAgICAgIGRhdGFTdHJpbmcgKz0gcGFyZW50TmFtZXMuZmF0aGVyTmFtZTtcbiAgICB9XG4gICAgaWYgKHBhcmVudE5hbWVzLm1vdGhlck5hbWUpIHtcbiAgICAgIGlmIChwYXJlbnROYW1lcy5mYXRoZXJOYW1lKSB7XG4gICAgICAgIGRhdGFTdHJpbmcgKz0gXCIgJiBcIjtcbiAgICAgIH1cbiAgICAgIGRhdGFTdHJpbmcgKz0gcGFyZW50TmFtZXMubW90aGVyTmFtZTtcbiAgICB9XG4gICAgZGF0YVN0cmluZyArPSBcIixcIjtcbiAgfVxuXG4gIGlmIChnZC5zcG91c2VzICYmIGdkLnNwb3VzZXMubGVuZ3RoID09IDEpIHtcbiAgICBsZXQgc3BvdXNlID0gZ2Quc3BvdXNlc1swXTtcbiAgICBpZiAoc3BvdXNlLm5hbWUpIHtcbiAgICAgIGxldCBzcG91c2VOYW1lID0gc3BvdXNlLm5hbWUuaW5mZXJGdWxsTmFtZSgpO1xuICAgICAgaWYgKHNwb3VzZU5hbWUpIHtcbiAgICAgICAgbGV0IHJlbGF0aW9uID0gXCJzcG91c2VcIjtcbiAgICAgICAgaWYgKGdkLnBlcnNvbkdlbmRlciA9PSBcIm1hbGVcIikge1xuICAgICAgICAgIHJlbGF0aW9uID0gXCJodXNiYW5kXCI7XG4gICAgICAgIH0gZWxzZSBpZiAoZ2QucGVyc29uR2VuZGVyID09IFwiZmVtYWxlXCIpIHtcbiAgICAgICAgICByZWxhdGlvbiA9IFwid2lmZVwiO1xuICAgICAgICB9XG4gICAgICAgIGlmICghZGF0YVN0cmluZy5lbmRzV2l0aChcIixcIikpIHtcbiAgICAgICAgICBkYXRhU3RyaW5nICs9IFwiLFwiO1xuICAgICAgICB9XG4gICAgICAgIGRhdGFTdHJpbmcgKz0gXCIgXCIgKyByZWxhdGlvbiArIFwiIG9mIFwiICsgc3BvdXNlTmFtZSArIFwiLFwiO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGxldCBwbGFjZSA9IGdkLmluZmVyRnVsbEV2ZW50UGxhY2UoKTtcbiAgaWYgKHBsYWNlKSB7XG4gICAgZGF0YVN0cmluZyArPSBcIiBcIiArIGdldFBsYWNlV2l0aFByZXBvc2l0aW9uKHBsYWNlKTtcbiAgfSBlbHNlIHtcbiAgICBsZXQgcmVzaWRlbmNlUGxhY2UgPSBnZC5pbmZlclJlc2lkZW5jZVBsYWNlKCk7XG4gICAgaWYgKHJlc2lkZW5jZVBsYWNlKSB7XG4gICAgICBkYXRhU3RyaW5nICs9IFwiIHJlc2lkaW5nIFwiICsgZ2V0UGxhY2VXaXRoUHJlcG9zaXRpb24ocmVzaWRlbmNlUGxhY2UpO1xuICAgIH1cbiAgfVxuXG4gIGlmIChkYXRhU3RyaW5nLmVuZHNXaXRoKFwiLFwiKSkge1xuICAgIGRhdGFTdHJpbmcgPSBkYXRhU3RyaW5nLnN1YnN0cmluZygwLCBkYXRhU3RyaW5nLmxlbmd0aCAtIDEpO1xuICB9XG5cbiAgaWYgKGdkLm1vdGhlcnNNYWlkZW5OYW1lKSB7XG4gICAgZGF0YVN0cmluZyArPSBcIiwgbW90aGVyJ3MgbWFpZGVuIG5hbWUgXCIgKyBnZC5tb3RoZXJzTWFpZGVuTmFtZTtcbiAgfVxuXG4gIHJldHVybiBkYXRhU3RyaW5nO1xufVxuXG5mdW5jdGlvbiBnZXRCYXB0aXNtU3RyaW5nKGdkLCBvcHRpb25zKSB7XG4gIGxldCBkYXRhU3RyaW5nID0gZ2V0RnVsbE5hbWUoZ2QpO1xuXG4gIGlmIChnZC5yb2xlICYmIGdkLnJvbGUgPT0gUm9sZS5QYXJlbnQpIHtcbiAgICBkYXRhU3RyaW5nICs9IFwiJ3MgXCIgKyBnZXRQcmltYXJ5UGVyc29uQ2hpbGRUZXJtKGdkKSArIFwiIFwiICsgZ2QucHJpbWFyeVBlcnNvbjtcbiAgfVxuXG4gIGRhdGFTdHJpbmcgKz0gXCIgYmFwdGlzbVwiO1xuXG4gIGxldCBkYXRlID0gZ2QuaW5mZXJFdmVudERhdGVPYmooKTtcbiAgaWYgKGRhdGUpIHtcbiAgICBkYXRhU3RyaW5nICs9IFwiIFwiICsgZ2V0RGF0ZVdpdGhQcmVwb3NpdGlvbihkYXRlKTtcbiAgfVxuXG4gIGlmIChnZC5iaXJ0aERhdGUpIHtcbiAgICBsZXQgYmlydGhEYXRlID0gZ2QuaW5mZXJCaXJ0aERhdGVPYmooKTtcbiAgICBpZiAoYmlydGhEYXRlKSB7XG4gICAgICBkYXRhU3RyaW5nICs9IFwiIChib3JuIFwiICsgY2xlYW5EYXRlT2JqKGJpcnRoRGF0ZSkgKyBcIilcIjtcbiAgICB9XG4gIH1cblxuICBsZXQgcGxhY2UgPSBnZC5pbmZlckZ1bGxFdmVudFBsYWNlKCk7XG5cbiAgbGV0IHBhcmVudE5hbWVzID0gZ2QuaW5mZXJQYXJlbnROYW1lc0ZvckRhdGFTdHJpbmcoKTtcbiAgaWYgKHBhcmVudE5hbWVzLmZhdGhlck5hbWUgfHwgcGFyZW50TmFtZXMubW90aGVyTmFtZSkge1xuICAgIGlmIChnZC5wZXJzb25HZW5kZXIgPT0gXCJtYWxlXCIpIHtcbiAgICAgIGRhdGFTdHJpbmcgKz0gXCIsIHNvbiBvZiBcIjtcbiAgICB9IGVsc2UgaWYgKGdkLnBlcnNvbkdlbmRlciA9PSBcImZlbWFsZVwiKSB7XG4gICAgICBkYXRhU3RyaW5nICs9IFwiLCBkYXVnaHRlciBvZiBcIjtcbiAgICB9IGVsc2Uge1xuICAgICAgZGF0YVN0cmluZyArPSBcIiwgY2hpbGQgb2YgXCI7XG4gICAgfVxuICAgIGlmIChwYXJlbnROYW1lcy5mYXRoZXJOYW1lKSB7XG4gICAgICBkYXRhU3RyaW5nICs9IHBhcmVudE5hbWVzLmZhdGhlck5hbWU7XG4gICAgfVxuICAgIGlmIChwYXJlbnROYW1lcy5tb3RoZXJOYW1lKSB7XG4gICAgICBpZiAocGFyZW50TmFtZXMuZmF0aGVyTmFtZSkge1xuICAgICAgICBkYXRhU3RyaW5nICs9IFwiICYgXCI7XG4gICAgICB9XG4gICAgICBkYXRhU3RyaW5nICs9IHBhcmVudE5hbWVzLm1vdGhlck5hbWU7XG4gICAgfVxuICAgIGlmIChwbGFjZSkge1xuICAgICAgZGF0YVN0cmluZyArPSBcIixcIjtcbiAgICB9XG4gIH1cblxuICBpZiAocGxhY2UpIHtcbiAgICBkYXRhU3RyaW5nICs9IFwiIFwiICsgZ2V0UGxhY2VXaXRoUHJlcG9zaXRpb24ocGxhY2UpO1xuICB9XG5cbiAgLy8gc29tZXRpbWVzIGEgYmFwdGlzbSBoYXMgYSBkZWF0aCBkYXRlLiAoZS5nLiBnZXJtYW55X2JhcHRpc21fMTg0MF9qb2hhbm5hX2hhcnRtYW5uKVxuICBsZXQgZGVhdGhEYXRlID0gZ2QuaW5mZXJEZWF0aERhdGVPYmooKTtcbiAgaWYgKGRlYXRoRGF0ZSkge1xuICAgIGRhdGFTdHJpbmcgKz0gXCIgYW5kIGRpZWQgXCIgKyBnZXREYXRlV2l0aFByZXBvc2l0aW9uKGRlYXRoRGF0ZSk7XG4gIH1cblxuICByZXR1cm4gZGF0YVN0cmluZztcbn1cblxuZnVuY3Rpb24gZ2V0TWFycmlhZ2VTdHJpbmcoZ2QsIG9wdGlvbnMpIHtcbiAgbGV0IGRhdGFTdHJpbmcgPSBcIlwiO1xuXG4gIGlmIChnZC5yb2xlICYmIGdkLnJvbGUgPT0gUm9sZS5QYXJlbnQpIHtcbiAgICBsZXQgcG9zc2Vzc2l2ZU5hbWUgPSBnZXRGdWxsTmFtZShnZCkgKyBcIidzXCI7XG4gICAgZGF0YVN0cmluZyArPSBwb3NzZXNzaXZlTmFtZSArIFwiIFwiICsgZ2V0UHJpbWFyeVBlcnNvbkNoaWxkVGVybShnZCk7XG4gICAgaWYgKGdkLnByaW1hcnlQZXJzb24pIHtcbiAgICAgIGRhdGFTdHJpbmcgKz0gXCIgXCIgKyBnZC5wcmltYXJ5UGVyc29uO1xuICAgIH1cblxuICAgIGxldCBhZ2UgPSBjbGVhbkFnZShnZC5wcmltYXJ5UGVyc29uQWdlKTtcbiAgICBpZiAoYWdlKSB7XG4gICAgICBkYXRhU3RyaW5nICs9IFwiIChcIiArIGFnZSArIFwiKVwiO1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICBkYXRhU3RyaW5nICs9IGdldEZ1bGxOYW1lKGdkKTtcblxuICAgIGxldCBhZ2UgPSBjbGVhbkFnZShnZC5hZ2VBdEV2ZW50KTtcbiAgICBpZiAoYWdlKSB7XG4gICAgICBkYXRhU3RyaW5nICs9IFwiIChcIiArIGFnZSArIFwiKVwiO1xuICAgIH1cbiAgfVxuXG4gIGRhdGFTdHJpbmcgKz0gXCIgbWFycmlhZ2VcIjtcblxuICBpZiAoZ2Quc3BvdXNlcyAmJiBnZC5zcG91c2VzLmxlbmd0aCA9PSAxICYmIGdkLnNwb3VzZXNbMF0ubmFtZSkge1xuICAgIGxldCBzcG91c2VOYW1lID0gZ2Quc3BvdXNlc1swXS5uYW1lLmluZmVyRnVsbE5hbWUoKTtcbiAgICBkYXRhU3RyaW5nICs9IFwiIHRvIFwiICsgc3BvdXNlTmFtZTtcblxuICAgIGxldCBzcG91c2VBZ2UgPSBjbGVhbkFnZShnZC5zcG91c2VzWzBdLmFnZSk7XG4gICAgaWYgKHNwb3VzZUFnZSkge1xuICAgICAgZGF0YVN0cmluZyArPSBcIiAoXCIgKyBzcG91c2VBZ2UgKyBcIilcIjtcbiAgICB9XG4gIH1cblxuICBpZiAoZ2QucmVjb3JkU3VidHlwZSAmJiBnZC5yZWNvcmRTdWJ0eXBlID09IFJlY29yZFN1YnR5cGUuQmFubnMpIHtcbiAgICBkYXRhU3RyaW5nICs9IFwiLiBCYW5ucyByZWFkXCI7XG4gIH1cblxuICBpZiAoZ2QubWFycmlhZ2VEYXRlKSB7XG4gICAgbGV0IGRhdGUgPSBuZXcgV3RzRGF0ZSgpO1xuICAgIGRhdGUuZGF0ZVN0cmluZyA9IGdkLm1hcnJpYWdlRGF0ZTtcbiAgICBkYXRhU3RyaW5nICs9IFwiIFwiICsgZ2V0RGF0ZVdpdGhQcmVwb3NpdGlvbihkYXRlKTtcbiAgfSBlbHNlIHtcbiAgICBsZXQgZGF0ZSA9IGdkLmluZmVyRXZlbnREYXRlT2JqKCk7XG4gICAgaWYgKGRhdGUpIHtcbiAgICAgIGxldCBwcmVwU3VmZml4ID0gXCJcIjtcbiAgICAgIGlmIChnZC5yZWNvcmRTdWJ0eXBlICYmIGdkLnJlY29yZFN1YnR5cGUgPT0gUmVjb3JkU3VidHlwZS5NYXJyaWFnZU9yQmFubnMpIHtcbiAgICAgICAgcHJlcFN1ZmZpeCA9IFwib3IgYWZ0ZXJcIjtcbiAgICAgIH1cbiAgICAgIGRhdGFTdHJpbmcgKz0gXCIgXCIgKyBnZXREYXRlV2l0aFByZXBvc2l0aW9uKGRhdGUsIHByZXBTdWZmaXgpO1xuICAgIH1cbiAgfVxuXG4gIGxldCBwbGFjZSA9IGdkLmluZmVyRnVsbEV2ZW50UGxhY2UoKTtcbiAgaWYgKHBsYWNlKSB7XG4gICAgZGF0YVN0cmluZyArPSBcIiBcIiArIGdldFBsYWNlV2l0aFByZXBvc2l0aW9uKHBsYWNlKTtcbiAgfVxuXG4gIHJldHVybiBkYXRhU3RyaW5nO1xufVxuXG5mdW5jdGlvbiBnZXRCdXJpYWxTdHJpbmcoZ2QsIG9wdGlvbnMpIHtcbiAgbGV0IGRhdGFTdHJpbmcgPSBnZXRGdWxsTmFtZShnZCk7XG4gIGlmIChnZC5yb2xlICYmIGdkLnJvbGUgPT0gUm9sZS5QYXJlbnQpIHtcbiAgICBkYXRhU3RyaW5nICs9IFwiJ3MgXCIgKyBnZXRQcmltYXJ5UGVyc29uQ2hpbGRUZXJtKGdkKSArIFwiIFwiICsgZ2QucHJpbWFyeVBlcnNvbjtcbiAgfSBlbHNlIHtcbiAgICBpZiAoZ2QucGFyZW50cykge1xuICAgICAgbGV0IGZhdGhlck5hbWUgPSBcIlwiO1xuICAgICAgaWYgKGdkLnBhcmVudHMuZmF0aGVyICYmIGdkLnBhcmVudHMuZmF0aGVyLm5hbWUpIHtcbiAgICAgICAgZmF0aGVyTmFtZSA9IGdkLnBhcmVudHMuZmF0aGVyLm5hbWUuaW5mZXJGdWxsTmFtZSgpO1xuICAgICAgfVxuICAgICAgbGV0IG1vdGhlck5hbWUgPSBcIlwiO1xuICAgICAgaWYgKGdkLnBhcmVudHMubW90aGVyICYmIGdkLnBhcmVudHMubW90aGVyLm5hbWUpIHtcbiAgICAgICAgbW90aGVyTmFtZSA9IGdkLnBhcmVudHMubW90aGVyLm5hbWUuaW5mZXJGdWxsTmFtZSgpO1xuICAgICAgfVxuXG4gICAgICBpZiAoZ2QucGVyc29uR2VuZGVyID09IFwibWFsZVwiKSB7XG4gICAgICAgIGRhdGFTdHJpbmcgKz0gXCIsIHNvbiBvZlwiO1xuICAgICAgfSBlbHNlIGlmIChnZC5wZXJzb25HZW5kZXIgPT0gXCJmZW1hbGVcIikge1xuICAgICAgICBkYXRhU3RyaW5nICs9IFwiLCBkYXVnaHRlciBvZlwiO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZGF0YVN0cmluZyArPSBcIiwgY2hpbGQgb2ZcIjtcbiAgICAgIH1cbiAgICAgIGlmIChmYXRoZXJOYW1lKSB7XG4gICAgICAgIGRhdGFTdHJpbmcgKz0gXCIgXCIgKyBmYXRoZXJOYW1lO1xuICAgICAgfVxuICAgICAgaWYgKG1vdGhlck5hbWUpIHtcbiAgICAgICAgaWYgKGZhdGhlck5hbWUpIHtcbiAgICAgICAgICBkYXRhU3RyaW5nICs9IFwiICZcIjtcbiAgICAgICAgfVxuICAgICAgICBkYXRhU3RyaW5nICs9IFwiIFwiICsgbW90aGVyTmFtZTtcbiAgICAgIH1cblxuICAgICAgZGF0YVN0cmluZyArPSBcIixcIjtcbiAgICB9XG4gIH1cblxuICBpZiAoZ2QucmVjb3JkVHlwZSA9PSBSVC5EZWF0aE9yQnVyaWFsKSB7XG4gICAgZGF0YVN0cmluZyArPSBcIiBkZWF0aCBvciBidXJpYWxcIjtcbiAgfSBlbHNlIHtcbiAgICBkYXRhU3RyaW5nICs9IFwiIGJ1cmlhbFwiO1xuICB9XG5cbiAgbGV0IGRlYXRoRGF0ZSA9IGdkLmluZmVyRGVhdGhEYXRlT2JqKCk7XG4gIGxldCBhZ2UgPSBjbGVhbkFnZShnZC5hZ2VBdERlYXRoKTtcbiAgaWYgKCFhZ2UpIHtcbiAgICBhZ2UgPSBjbGVhbkFnZShnZC5hZ2VBdEV2ZW50KTtcbiAgfVxuICBpZiAoZGVhdGhEYXRlICYmIGFnZSkge1xuICAgIGRhdGFTdHJpbmcgKz0gXCIgKGRpZWQgXCIgKyBnZXREYXRlV2l0aFByZXBvc2l0aW9uKGRlYXRoRGF0ZSkgKyBcIiBhdCBhZ2UgXCIgKyBhZ2UgKyBcIilcIjtcbiAgfSBlbHNlIGlmIChkZWF0aERhdGUpIHtcbiAgICBkYXRhU3RyaW5nICs9IFwiIChkaWVkIFwiICsgZ2V0RGF0ZVdpdGhQcmVwb3NpdGlvbihkZWF0aERhdGUpICsgXCIpXCI7XG4gIH0gZWxzZSBpZiAoYWdlKSB7XG4gICAgZGF0YVN0cmluZyArPSBcIiAoZGllZCBhZ2UgXCIgKyBhZ2UgKyBcIilcIjtcbiAgfVxuXG4gIGxldCBidXJpYWxEYXRlID0gZ2QuaW5mZXJFdmVudERhdGVPYmooKTtcbiAgaWYgKGJ1cmlhbERhdGUpIHtcbiAgICBkYXRhU3RyaW5nICs9IFwiIFwiICsgZ2V0RGF0ZVdpdGhQcmVwb3NpdGlvbihidXJpYWxEYXRlKTtcbiAgfVxuXG4gIGxldCBwbGFjZSA9IGdkLmluZmVyRnVsbEV2ZW50UGxhY2UoKTtcbiAgaWYgKHBsYWNlKSB7XG4gICAgZGF0YVN0cmluZyArPSBcIiBcIiArIGdldFBsYWNlV2l0aFByZXBvc2l0aW9uKHBsYWNlKTtcbiAgfVxuXG4gIGlmIChnZC5jYXVzZU9mRGVhdGgpIHtcbiAgICBkYXRhU3RyaW5nICs9IFwiLiBDYXVzZSBvZiBkZWF0aDogXCIgKyBnZC5jYXVzZU9mRGVhdGg7XG4gIH1cblxuICByZXR1cm4gZGF0YVN0cmluZztcbn1cblxuZnVuY3Rpb24gZ2V0Q3JlbWF0aW9uU3RyaW5nKGdkLCBvcHRpb25zKSB7XG4gIGxldCBkYXRhU3RyaW5nID0gZ2V0RnVsbE5hbWUoZ2QpO1xuICBkYXRhU3RyaW5nICs9IFwiIGNyZW1hdGlvblwiO1xuXG4gIGxldCBkZWF0aERhdGUgPSBnZC5pbmZlckRlYXRoRGF0ZU9iaigpO1xuICBsZXQgYWdlID0gY2xlYW5BZ2UoZ2QuYWdlQXREZWF0aCk7XG4gIGlmIChkZWF0aERhdGUgJiYgYWdlKSB7XG4gICAgZGF0YVN0cmluZyArPSBcIiAoZGllZCBcIiArIGdldERhdGVXaXRoUHJlcG9zaXRpb24oZGVhdGhEYXRlKSArIFwiIGF0IGFnZSBcIiArIGFnZSArIFwiKVwiO1xuICB9IGVsc2UgaWYgKGRlYXRoRGF0ZSkge1xuICAgIGRhdGFTdHJpbmcgKz0gXCIgKGRpZWQgXCIgKyBnZXREYXRlV2l0aFByZXBvc2l0aW9uKGRlYXRoRGF0ZSkgKyBcIilcIjtcbiAgfSBlbHNlIGlmIChhZ2UpIHtcbiAgICBkYXRhU3RyaW5nICs9IFwiIChkaWVkIGFnZSBcIiArIGFnZSArIFwiKVwiO1xuICB9XG5cbiAgbGV0IGNyZW1hdGlvbkRhdGUgPSBnZC5pbmZlckV2ZW50RGF0ZU9iaigpO1xuICBpZiAoY3JlbWF0aW9uRGF0ZSkge1xuICAgIGRhdGFTdHJpbmcgKz0gXCIgXCIgKyBnZXREYXRlV2l0aFByZXBvc2l0aW9uKGNyZW1hdGlvbkRhdGUpO1xuICB9XG5cbiAgbGV0IHBsYWNlID0gZ2QuaW5mZXJGdWxsRXZlbnRQbGFjZSgpO1xuICBpZiAocGxhY2UpIHtcbiAgICBkYXRhU3RyaW5nICs9IFwiIFwiICsgZ2V0UGxhY2VXaXRoUHJlcG9zaXRpb24ocGxhY2UpO1xuICB9XG5cbiAgcmV0dXJuIGRhdGFTdHJpbmc7XG59XG5cbmZ1bmN0aW9uIGdldFByb2JhdGVTdHJpbmcoZ2QsIG9wdGlvbnMpIHtcbiAgbGV0IGRhdGFTdHJpbmcgPSBnZXRGdWxsTmFtZShnZCk7XG4gIGRhdGFTdHJpbmcgKz0gXCIgcHJvYmF0ZVwiO1xuXG4gIGxldCBkYXRlID0gZ2QuaW5mZXJFdmVudERhdGVPYmooKTtcbiAgaWYgKGRhdGUpIHtcbiAgICBkYXRhU3RyaW5nICs9IFwiIFwiICsgZ2V0RGF0ZVdpdGhQcmVwb3NpdGlvbihkYXRlKTtcbiAgfVxuXG4gIGxldCBwbGFjZSA9IGdkLmluZmVyRnVsbEV2ZW50UGxhY2UoKTtcbiAgaWYgKHBsYWNlKSB7XG4gICAgZGF0YVN0cmluZyArPSBcIiBcIiArIGdldFBsYWNlV2l0aFByZXBvc2l0aW9uKHBsYWNlKTtcbiAgfVxuXG4gIGxldCBkZWF0aERhdGUgPSBnZC5pbmZlckRlYXRoRGF0ZU9iaigpO1xuICBpZiAoZGVhdGhEYXRlKSB7XG4gICAgZGF0YVN0cmluZyArPSBcIi4gRGllZCBcIiArIGNsZWFuRGF0ZU9iaihkZWF0aERhdGUpO1xuXG4gICAgbGV0IGRlYXRoUGxhY2UgPSBnZC5pbmZlckRlYXRoUGxhY2UoKTtcbiAgICBpZiAoZGVhdGhQbGFjZSkge1xuICAgICAgZGF0YVN0cmluZyArPSBcIiBcIiArIGdldFBsYWNlV2l0aFByZXBvc2l0aW9uKGRlYXRoUGxhY2UpO1xuICAgIH0gZWxzZSB7XG4gICAgICBsZXQgcmVzaWRlbmNlUGxhY2UgPSBnZC5pbmZlclJlc2lkZW5jZVBsYWNlKCk7XG4gICAgICBpZiAocmVzaWRlbmNlUGxhY2UpIHtcbiAgICAgICAgZGF0YVN0cmluZyArPSBcIiByZXNpZGluZyBcIiArIGdldFBsYWNlV2l0aFByZXBvc2l0aW9uKHJlc2lkZW5jZVBsYWNlKTtcbiAgICAgIH1cbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgbGV0IHJlc2lkZW5jZVBsYWNlID0gZ2QuaW5mZXJSZXNpZGVuY2VQbGFjZSgpO1xuICAgIGlmIChyZXNpZGVuY2VQbGFjZSkge1xuICAgICAgZGF0YVN0cmluZyArPSBcIi4gUmVzaWRlbmNlIFwiICsgcmVzaWRlbmNlUGxhY2U7XG4gICAgfVxuICB9XG5cbiAgaWYgKGdkLm9jY3VwYXRpb24pIHtcbiAgICBkYXRhU3RyaW5nICs9IFwiLiBPY2N1cGF0aW9uOiBcIiArIGdkLm9jY3VwYXRpb247XG4gIH1cblxuICByZXR1cm4gZGF0YVN0cmluZztcbn1cblxuZnVuY3Rpb24gZ2V0U2NvdHRpc2hXaWxsU3RyaW5nKGdkLCBvcHRpb25zKSB7XG4gIGlmIChnZC5yb2xlICYmIGdkLnJvbGUgIT0gUm9sZS5QcmltYXJ5KSB7XG4gICAgcmV0dXJuIFwiXCI7IC8vIGZhbGwgYmFjayB0byBub24tY3VzdG9tIHN0cmluZ1xuICB9XG5cbiAgbGV0IGRhdGFTdHJpbmcgPSBcIlwiO1xuXG4gIGlmIChnZC5yZWNvcmRTdWJ0eXBlID09IFwiUHJvYmF0ZVwiKSB7XG4gICAgZGF0YVN0cmluZyA9IFwiQ29uZmlybWF0aW9uIG9mIHByb2JhdGUgb2Ygd2lsbCBvZiBcIjtcbiAgfSBlbHNlIGlmIChnZC5yZWNvcmRTdWJ0eXBlID09IFwiVGVzdGFtZW50XCIpIHtcbiAgICBpZiAoZ2QudGVzdGF0ZU9ySW50ZXN0YXRlID09IFwidGVzdGF0ZVwiKSB7XG4gICAgICBkYXRhU3RyaW5nID0gXCJDb25maXJtYXRpb24gb2Ygd2lsbCBvZiBcIjtcbiAgICB9IGVsc2UgaWYgKGdkLnRlc3RhdGVPckludGVzdGF0ZSA9PSBcImludGVzdGF0ZVwiKSB7XG4gICAgICBkYXRhU3RyaW5nID0gXCJDb25maXJtYXRpb24gb2YgdGVzdGFtZW50IG9mIFwiO1xuICAgIH0gZWxzZSB7XG4gICAgICBkYXRhU3RyaW5nID0gXCJDb25maXJtYXRpb24gb2Ygd2lsbCBvciB0ZXN0YW1lbnQgb2YgXCI7XG4gICAgfVxuICB9IGVsc2UgaWYgKGdkLnJlY29yZFN1YnR5cGUgPT0gXCJJbnZlbnRvcnlcIikge1xuICAgIGRhdGFTdHJpbmcgPSBcIkNvbmZpcm1hdGlvbiBvZiBpbnZlbnRvcnkgZm9yIFwiO1xuICB9IGVsc2UgaWYgKGdkLnJlY29yZFN1YnR5cGUgPT0gXCJBZGRpdGlvbmFsSW52ZW50b3J5XCIpIHtcbiAgICBkYXRhU3RyaW5nID0gXCJDb25maXJtYXRpb24gb2YgaW52ZW50b3J5IGZvciBcIjtcbiAgfSBlbHNlIGlmIChnZC5yZWNvcmRTdWJ0eXBlID09IFwiQWRkaXRpb25hbEludmVudG9yeVwiKSB7XG4gICAgZGF0YVN0cmluZyA9IFwiQ29uZmlybWF0aW9uIG9mIGFkZGl0aW9uYWwgaW52ZW50b3J5IGZvciBcIjtcbiAgfSBlbHNlIHtcbiAgICBkYXRhU3RyaW5nID0gXCJDb25maXJtYXRpb24gb2Ygd2lsbCBvciB0ZXN0YW1lbnQgb2YgXCI7XG4gIH1cblxuICBkYXRhU3RyaW5nICs9IGdldEZ1bGxOYW1lKGdkKTtcblxuICBpZiAoZ2QuY291cnROYW1lKSB7XG4gICAgZGF0YVN0cmluZyArPSBcIiBhdCBcIiArIGdkLmNvdXJ0TmFtZTtcbiAgfSBlbHNlIHtcbiAgICBsZXQgcGxhY2UgPSBnZC5pbmZlckZ1bGxFdmVudFBsYWNlKCk7XG4gICAgaWYgKHBsYWNlKSB7XG4gICAgICBkYXRhU3RyaW5nICs9IFwiIGluIFwiICsgcGxhY2U7XG4gICAgfVxuICB9XG5cbiAgbGV0IGV2ZW50RGF0ZSA9IGdkLmluZmVyRXZlbnREYXRlT2JqKCk7XG4gIGxldCBvcmlnRGF0ZSA9IGdkLm9yaWdpbmFsQ29uZmlybWF0aW9uR3JhbnRlZERhdGU7XG4gIGxldCBncmFudGVkRGF0ZSA9IGdkLmdyYW50ZWREYXRlO1xuXG4gIGlmIChldmVudERhdGUpIHtcbiAgICBpZiAoZ3JhbnRlZERhdGUpIHtcbiAgICAgIGRhdGFTdHJpbmcgKz0gXCIgXCIgKyBnZXREYXRlRnJvbVN0cmluZ1dpdGhQcmVwb3NpdGlvbihncmFudGVkRGF0ZSk7XG4gICAgICBkYXRhU3RyaW5nICs9IFwiIChvcmlnaW5hbCBjb25maXJtYXRpb24gXCIgKyBnZXREYXRlV2l0aFByZXBvc2l0aW9uKGV2ZW50RGF0ZSkgKyBcIilcIjtcbiAgICB9IGVsc2UgaWYgKG9yaWdEYXRlKSB7XG4gICAgICBkYXRhU3RyaW5nICs9IFwiIFwiICsgZ2V0RGF0ZVdpdGhQcmVwb3NpdGlvbihldmVudERhdGUpO1xuICAgICAgZGF0YVN0cmluZyArPSBcIiAob3JpZ2luYWwgY29uZmlybWF0aW9uIFwiICsgZ2V0RGF0ZUZyb21TdHJpbmdXaXRoUHJlcG9zaXRpb24ob3JpZ0RhdGUpICsgXCIpXCI7XG4gICAgfSBlbHNlIHtcbiAgICAgIGRhdGFTdHJpbmcgKz0gXCIgXCIgKyBnZXREYXRlV2l0aFByZXBvc2l0aW9uKGV2ZW50RGF0ZSk7XG4gICAgfVxuICB9XG5cbiAgbGV0IGRlYXRoRGF0ZSA9IGdkLmluZmVyRGVhdGhEYXRlT2JqKCk7XG4gIGlmIChkZWF0aERhdGUpIHtcbiAgICBkYXRhU3RyaW5nICs9IFwiLiBEaWVkIFwiICsgY2xlYW5EYXRlT2JqKGRlYXRoRGF0ZSk7XG5cbiAgICBsZXQgZGVhdGhQbGFjZSA9IGdkLmluZmVyRGVhdGhQbGFjZSgpO1xuICAgIGlmIChkZWF0aFBsYWNlICYmIGRlYXRoUGxhY2UgIT0gcGxhY2UpIHtcbiAgICAgIGRhdGFTdHJpbmcgKz0gXCIgXCIgKyBnZXRQbGFjZVdpdGhQcmVwb3NpdGlvbihwbGFjZSk7XG4gICAgfVxuICB9XG5cbiAgaWYgKGdkLm9jY3VwYXRpb24pIHtcbiAgICBkYXRhU3RyaW5nICs9IFwiLiBPY2N1cGF0aW9uOiBcIiArIGdkLm9jY3VwYXRpb247XG4gIH1cblxuICByZXR1cm4gZGF0YVN0cmluZztcbn1cblxuZnVuY3Rpb24gZ2V0V2lsbFN0cmluZyhnZCwgb3B0aW9ucykge1xuICBpZiAoZ2QuaW5mZXJFdmVudENvdW50cnkoKSA9PSBcIlNjb3RsYW5kXCIgfHwgKGdkLmNvdXJ0TmFtZSAmJiBnZC5jb3VydE5hbWUuc3RhcnRzV2l0aChcIm5vbi1TY290XCIpKSkge1xuICAgIHJldHVybiBnZXRTY290dGlzaFdpbGxTdHJpbmcoZ2QsIG9wdGlvbnMpO1xuICB9XG5cbiAgaWYgKGdkLnJvbGUgJiYgZ2Qucm9sZSAhPSBSb2xlLlByaW1hcnkpIHtcbiAgICByZXR1cm4gXCJcIjsgLy8gZmFsbCBiYWNrIHRvIG5vbi1jdXN0b20gc3RyaW5nXG4gIH1cblxuICBsZXQgZGF0ZU9iaiA9IGdkLmluZmVyRXZlbnREYXRlT2JqKCk7XG4gIGxldCBkZWF0aERhdGVPYmogPSBnZC5pbmZlckRlYXRoRGF0ZU9iaigpO1xuXG4gIGxldCBoYXNQcm9iYXRlRGF0ZSA9IGZhbHNlO1xuICBpZiAoZGF0ZU9iaikge1xuICAgIGlmICghZGVhdGhEYXRlT2JqIHx8IGRhdGVPYmouZ2V0RGF0ZVN0cmluZygpICE9IGRlYXRoRGF0ZU9iai5nZXREYXRlU3RyaW5nKCkpIHtcbiAgICAgIC8vIHRoZXJlIGlzIGEgcHJvYmF0ZSBkYXRlIChwcm9iYWJseSlcbiAgICAgIGhhc1Byb2JhdGVEYXRlID0gdHJ1ZTtcbiAgICB9XG4gIH1cblxuICBsZXQgZGF0YVN0cmluZyA9IFwiV2lsbCBvZiBcIiArIGdldEZ1bGxOYW1lKGdkKTtcblxuICBsZXQgZXZlbnRQbGFjZSA9IGdkLmluZmVyRnVsbEV2ZW50UGxhY2UoKTtcbiAgbGV0IGRlYXRoUGxhY2UgPSBnZC5pbmZlckRlYXRoUGxhY2UoKTtcbiAgbGV0IHJlc2lkZW5jZVBsYWNlID0gZ2QuaW5mZXJSZXNpZGVuY2VQbGFjZSgpO1xuXG4gIGxldCB1c2VkUmVzaWRlbmNlID0gZmFsc2U7XG4gIGlmIChyZXNpZGVuY2VQbGFjZSkge1xuICAgIGRhdGFTdHJpbmcgKz0gXCIgb2YgXCIgKyByZXNpZGVuY2VQbGFjZTtcbiAgICB1c2VkUmVzaWRlbmNlID0gdHJ1ZTtcbiAgfSBlbHNlIGlmIChldmVudFBsYWNlKSB7XG4gICAgZGF0YVN0cmluZyArPSBcIiBvZiBcIiArIGV2ZW50UGxhY2U7XG4gIH1cblxuICBpZiAoaGFzUHJvYmF0ZURhdGUpIHtcbiAgICBkYXRhU3RyaW5nICs9IFwiLCBncmFudGVkIHByb2JhdGVcIjtcbiAgICBkYXRhU3RyaW5nICs9IFwiIFwiICsgZ2V0RGF0ZVdpdGhQcmVwb3NpdGlvbihkYXRlT2JqKTtcbiAgfVxuXG4gIGxldCBkZWF0aERhdGUgPSBnZC5pbmZlckRlYXRoRGF0ZU9iaigpO1xuICBpZiAoZGVhdGhEYXRlKSB7XG4gICAgZGF0YVN0cmluZyArPSBcIi4gRGllZCBcIiArIGNsZWFuRGF0ZU9iaihkZWF0aERhdGUpO1xuICAgIGlmIChkZWF0aFBsYWNlKSB7XG4gICAgICBkYXRhU3RyaW5nICs9IFwiIFwiICsgZ2V0UGxhY2VXaXRoUHJlcG9zaXRpb24oZGVhdGhQbGFjZSk7XG4gICAgfSBlbHNlIGlmICghdXNlZFJlc2lkZW5jZSAmJiByZXNpZGVuY2VQbGFjZSkge1xuICAgICAgZGF0YVN0cmluZyArPSBcIiBcIiArIGdldFBsYWNlV2l0aFByZXBvc2l0aW9uKHJlc2lkZW5jZVBsYWNlKTtcbiAgICB9XG4gIH1cblxuICBpZiAoZ2Qub2NjdXBhdGlvbikge1xuICAgIGRhdGFTdHJpbmcgKz0gXCIuIE9jY3VwYXRpb246IFwiICsgZ2Qub2NjdXBhdGlvbjtcbiAgfVxuXG4gIHJldHVybiBkYXRhU3RyaW5nO1xufVxuXG5mdW5jdGlvbiBnZXREaXZvcmNlU3RyaW5nKGdkLCBvcHRpb25zKSB7XG4gIGxldCBkYXRhU3RyaW5nID0gZ2V0RnVsbE5hbWUoZ2QpO1xuICBkYXRhU3RyaW5nICs9IFwiIGRpdm9yY2VcIjtcblxuICBpZiAoZ2Quc3BvdXNlcyAmJiBnZC5zcG91c2VzLmxlbmd0aCA9PSAxICYmIGdkLnNwb3VzZXNbMF0ubmFtZSkge1xuICAgIGxldCBzcG91c2VOYW1lID0gZ2Quc3BvdXNlc1swXS5uYW1lLmluZmVyRnVsbE5hbWUoKTtcbiAgICBkYXRhU3RyaW5nICs9IFwiIGZyb20gXCIgKyBzcG91c2VOYW1lO1xuICB9XG5cbiAgbGV0IGRhdGUgPSBnZC5pbmZlckV2ZW50RGF0ZU9iaigpO1xuICBpZiAoZGF0ZSkge1xuICAgIGRhdGFTdHJpbmcgKz0gXCIgXCIgKyBnZXREYXRlV2l0aFByZXBvc2l0aW9uKGRhdGUpO1xuICB9XG5cbiAgbGV0IHBsYWNlID0gZ2QuaW5mZXJGdWxsRXZlbnRQbGFjZSgpO1xuICBpZiAocGxhY2UpIHtcbiAgICBkYXRhU3RyaW5nICs9IFwiIFwiICsgZ2V0UGxhY2VXaXRoUHJlcG9zaXRpb24ocGxhY2UpO1xuICB9XG5cbiAgcmV0dXJuIGRhdGFTdHJpbmc7XG59XG5cbmNvbnN0IERhdGFTdHJpbmcgPSB7XG4gIGJ1aWxkRGF0YVN0cmluZzogZnVuY3Rpb24gKGlucHV0KSB7XG4gICAgaWYgKCFpbnB1dCB8fCAhaW5wdXQuZ2VuZXJhbGl6ZWREYXRhIHx8ICFpbnB1dC5vcHRpb25zKSB7XG4gICAgICByZXR1cm4gXCJcIjtcbiAgICB9XG5cbiAgICBsZXQgZ2QgPSBpbnB1dC5nZW5lcmFsaXplZERhdGE7XG4gICAgbGV0IG9wdGlvbnMgPSBpbnB1dC5vcHRpb25zO1xuXG4gICAgbGV0IGRhdGFTdHJpbmcgPSBcIlwiO1xuXG4gICAgc3dpdGNoIChnZC5yZWNvcmRUeXBlKSB7XG4gICAgICBjYXNlIFJULkJpcnRoUmVnaXN0cmF0aW9uOiB7XG4gICAgICAgIGRhdGFTdHJpbmcgPSBnZXRCaXJ0aFJlZ2lzdHJhdGlvblN0cmluZyhnZCwgb3B0aW9ucyk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgY2FzZSBSVC5CaXJ0aDpcbiAgICAgIGNhc2UgUlQuQmlydGhPckJhcHRpc206IHtcbiAgICAgICAgZGF0YVN0cmluZyA9IGdldEJpcnRoU3RyaW5nKGdkLCBvcHRpb25zKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBjYXNlIFJULkRlYXRoUmVnaXN0cmF0aW9uOiB7XG4gICAgICAgIGRhdGFTdHJpbmcgPSBnZXREZWF0aFJlZ2lzdHJhdGlvblN0cmluZyhnZCwgb3B0aW9ucyk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgY2FzZSBSVC5EZWF0aDoge1xuICAgICAgICBkYXRhU3RyaW5nID0gZ2V0RGVhdGhTdHJpbmcoZ2QsIG9wdGlvbnMpO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIGNhc2UgUlQuTWFycmlhZ2VSZWdpc3RyYXRpb246IHtcbiAgICAgICAgZGF0YVN0cmluZyA9IGdldE1hcnJpYWdlUmVnaXN0cmF0aW9uU3RyaW5nKGdkLCBvcHRpb25zKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBjYXNlIFJULkJhcHRpc206IHtcbiAgICAgICAgZGF0YVN0cmluZyA9IGdldEJhcHRpc21TdHJpbmcoZ2QsIG9wdGlvbnMpO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIGNhc2UgUlQuTWFycmlhZ2U6IHtcbiAgICAgICAgZGF0YVN0cmluZyA9IGdldE1hcnJpYWdlU3RyaW5nKGdkLCBvcHRpb25zKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBjYXNlIFJULkJ1cmlhbDpcbiAgICAgIGNhc2UgUlQuRGVhdGhPckJ1cmlhbDoge1xuICAgICAgICBkYXRhU3RyaW5nID0gZ2V0QnVyaWFsU3RyaW5nKGdkLCBvcHRpb25zKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBjYXNlIFJULkNyZW1hdGlvbjoge1xuICAgICAgICBkYXRhU3RyaW5nID0gZ2V0Q3JlbWF0aW9uU3RyaW5nKGdkLCBvcHRpb25zKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBjYXNlIFJULkNlbnN1czoge1xuICAgICAgICBkYXRhU3RyaW5nID0gZ2V0Q2Vuc3VzU3RyaW5nKGdkLCBvcHRpb25zKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBjYXNlIFJULlByb2JhdGU6IHtcbiAgICAgICAgZGF0YVN0cmluZyA9IGdldFByb2JhdGVTdHJpbmcoZ2QsIG9wdGlvbnMpO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIGNhc2UgUlQuV2lsbDoge1xuICAgICAgICBkYXRhU3RyaW5nID0gZ2V0V2lsbFN0cmluZyhnZCwgb3B0aW9ucyk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgY2FzZSBSVC5EaXZvcmNlOiB7XG4gICAgICAgIGRhdGFTdHJpbmcgPSBnZXREaXZvcmNlU3RyaW5nKGdkLCBvcHRpb25zKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKGRhdGFTdHJpbmcpIHtcbiAgICAgIGRhdGFTdHJpbmcgKz0gXCIuXCI7XG4gICAgfVxuXG4gICAgcmV0dXJuIGRhdGFTdHJpbmc7XG4gIH0sXG59O1xuXG5leHBvcnQgeyBEYXRhU3RyaW5nIH07XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./extension/base/core/data_string.mjs\n");

/***/ }),

/***/ "./extension/base/core/generalize_data_utils.mjs":
/*!*******************************************************!*\
  !*** ./extension/base/core/generalize_data_utils.mjs ***!
  \*******************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"GD\": () => (/* binding */ GD),\n/* harmony export */   \"GeneralizedData\": () => (/* binding */ GeneralizedData),\n/* harmony export */   \"RT\": () => (/* reexport safe */ _record_type_mjs__WEBPACK_IMPORTED_MODULE_4__.RT),\n/* harmony export */   \"WtsDate\": () => (/* binding */ WtsDate),\n/* harmony export */   \"WtsName\": () => (/* binding */ WtsName),\n/* harmony export */   \"WtsPlace\": () => (/* binding */ WtsPlace),\n/* harmony export */   \"dateQualifiers\": () => (/* binding */ dateQualifiers)\n/* harmony export */ });\n/* harmony import */ var _country_data_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./country_data.mjs */ \"./extension/base/core/country_data.mjs\");\n/* harmony import */ var _record_collections_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./record_collections.mjs */ \"./extension/base/core/record_collections.mjs\");\n/* harmony import */ var _wts_string_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./wts_string.mjs */ \"./extension/base/core/wts_string.mjs\");\n/* harmony import */ var _wts_date_mjs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./wts_date.mjs */ \"./extension/base/core/wts_date.mjs\");\n/* harmony import */ var _record_type_mjs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./record_type.mjs */ \"./extension/base/core/record_type.mjs\");\n/*\nMIT License\n\nCopyright (c) 2020 Robert M Pavey\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.\n*/\n\n\n\n\n\n\n\nconst possibleLifeSpan = 120;\n\nconst dateQualifiers = {\n  NONE: 0,\n  EXACT: 1,\n  ABOUT: 2,\n  BEFORE: 3,\n  AFTER: 4,\n};\n\nconst GD = {\n  extractYearStringFromDateString: function (date) {\n    var result = undefined;\n    if (date != undefined && date != \"\") {\n      const year = date.replace(/^.*(\\d\\d\\d\\d)$/, \"$1\");\n      if (year.length == 4) {\n        result = year;\n      }\n    }\n    return result;\n  },\n\n  extractYearNumFromDateString: function (date) {\n    var result = 0;\n    let yearString = extractYearStringFromDateString(date);\n    if (yearString) {\n      var yearNum = parseInt(yearString);\n      if (yearNum == NaN) {\n        yearNum = 0;\n      }\n      result = yearNum;\n    }\n    return result;\n  },\n\n  standardizeGender: function (string) {\n    if (!string) {\n      return \"\";\n    }\n    let lc = string.toLowerCase();\n    if (lc == \"male\" || lc == \"m\" || lc == \"m (male)\") {\n      return \"male\";\n    }\n    if (lc == \"female\" || lc == \"f\" || lc == \"f (female)\") {\n      return \"female\";\n    }\n    if (lc.startsWith(\"m\")) {\n      return \"male\";\n    }\n    if (lc.startsWith(\"f\")) {\n      return \"female\";\n    }\n    return \"\";\n  },\n\n  standardizeMaritalStatus: function (string) {\n    if (!string) {\n      return \"\";\n    }\n    let lc = string.toLowerCase();\n    if (lc == \"married\" || lc == \"m\" || lc.startsWith(\"mar\")) {\n      return \"married\";\n    }\n    if (\n      lc == \"single\" ||\n      lc == \"s\" ||\n      lc == \"unmarried\" ||\n      lc == \"u\" ||\n      lc.startsWith(\"unm\") ||\n      lc.startsWith(\"sin\") ||\n      lc.startsWith(\"nev\")\n    ) {\n      return \"single\";\n    }\n    if (lc == \"widowed\" || lc == \"w\" || lc == \"wd\" || lc.startsWith(\"wid\")) {\n      return \"widowed\";\n    }\n    if (lc == \"divorced\" || lc == \"d\" || lc.startsWith(\"div\")) {\n      return \"divorced\";\n    }\n    if (lc == \"separated\" || lc.startsWith(\"sep\")) {\n      return \"separated\";\n    }\n    // Note that \"-\" is turned into \"\", this is typical on some site for young children\n    return \"\";\n  },\n\n  standardizeRelationshipToHead: function (string) {\n    if (!string) {\n      return \"\";\n    }\n\n    const exactMap = {\n      head: \"head\",\n      husband: \"husband\",\n      husbnd: \"husband\",\n      self: \"head\",\n      \"self (head)\": \"head\",\n      wife: \"wife\",\n      w: \"wife\",\n      // children\n      son: \"son\",\n      s: \"son\",\n      daughter: \"daughter\",\n      dau: \"daughter\",\n      d: \"daughter\",\n      // step children\n      stepdaughter: \"stepdaughter\",\n      \"step-daughter\": \"stepdaughter\",\n      \"step daughter\": \"stepdaughter\",\n      \"step-dau\": \"stepdaughter\",\n      \"step dau\": \"stepdaughter\",\n      stepdau: \"stepdaughter\",\n      stpdau: \"stepdaughter\",\n      \"step-d\": \"stepdaughter\",\n      \"step d\": \"stepdaughter\",\n\n      stepson: \"stepson\",\n      \"step-son\": \"stepson\",\n      \"step son\": \"stepson\",\n      stpson: \"stepson\",\n      \"step-s\": \"stepson\",\n      \"step s\": \"stepson\",\n\n      \"step-child\": \"stepchild\",\n      \"step child\": \"stepchild\",\n      stepchild: \"stepchild\",\n      // in-law children\n      \"daughter-in-law\": \"daughter-in-law\",\n      \"dau-in-law\": \"daughter-in-law\",\n      daulaw: \"daughter-in-law\",\n      \"son-in-law\": \"son-in-law\",\n      sonlaw: \"son-in-law\",\n\n      // grandchildren\n      grandchild: \"grandchild\",\n      granddaughter: \"granddaughter\",\n      grndau: \"granddaughter\",\n      grandson: \"grandson\",\n      grnson: \"grandson\",\n      // parents\n      father: \"father\",\n      mother: \"mother\",\n      // in-law parents\n      \"father-in-law\": \"father-in-law\",\n      \"fa-law\": \"father-in-law\",\n      \"mother-in-law\": \"mother-in-law\",\n      \"ma-law\": \"mother-in-law\",\n      // step parents\n      stepfather: \"stepfather\",\n      \"step-father\": \"stepfather\",\n      stpdad: \"stepfather\",\n      steppa: \"stepfather\",\n      stppa: \"stepfather\",\n      stepmother: \"stepmother\",\n      \"step-mother\": \"stepmother\",\n      stpmum: \"stepmother\",\n      stepma: \"stepmother\",\n      stpma: \"stepmother\",\n      // grandparents\n      grandfather: \"grandfather\",\n      granpa: \"grandfather\",\n      grandmother: \"grandmother\",\n      granma: \"grandmother\",\n\n      // siblings\n      brother: \"brother\",\n      brothr: \"brother\",\n      sister: \"sister\",\n      \"brother-in-law\": \"brother-in-law\",\n      \"brother in law\": \"brother-in-law\",\n      brolaw: \"brother-in-law\",\n      \"half brother\": \"half brother\",\n      hlfbro: \"half brother\",\n      \"half sister\": \"half sister\",\n      hlfsis: \"half sister\",\n      \"sister-in-law\": \"sister-in-law\",\n      \"sister in law\": \"sister-in-law\",\n      sislaw: \"sister-in-law\",\n      stepbrother: \"stepbrother\",\n      \"step-brother\": \"stepbrother\",\n      stpbro: \"stepbrother\",\n      stepsister: \"stepsister\",\n      \"step-sister\": \"stepsister\",\n      stpsis: \"stepsister\",\n      // other family\n      aunt: \"aunt\",\n      cousin: \"cousin\",\n      \"great aunt\": \"great aunt\",\n      gtaunt: \"great aunt\",\n      \"great uncle\": \"great uncle\",\n      gtuncl: \"great uncle\",\n      niece: \"niece\",\n      nephew: \"nephew\",\n      uncle: \"uncle\",\n      // other relationships\n      apprentice: \"apprentice\",\n      appren: \"apprentice\",\n      assistant: \"assistant\",\n      asstnt: \"assistant\",\n      boarder: \"boarder\",\n      boardr: \"boarder\",\n      governess: \"governess\",\n      gvrnss: \"governess\",\n      inmate: \"inmate\",\n      lodger: \"lodger\",\n      mistress: \"mistress\",\n      mstres: \"mistress\",\n      \"nurse child\": \"nurse child\",\n      \"nrs-ch\": \"nurse child\",\n      patient: \"patient\",\n      ptient: \"patient\",\n      prisoner: \"prisoner\",\n      prisnr: \"prisoner\",\n      pupil: \"pupil\",\n      relative: \"relative\",\n      reltiv: \"relative\",\n      scholar: \"scholar\",\n      servant: \"servant\",\n      servnt: \"servant\",\n      serv: \"servant\",\n      stranger: \"stranger\",\n      strngr: \"stranger\",\n      traveller: \"traveller\",\n      trvelr: \"traveller\",\n      visitor: \"visitor\",\n      visitr: \"visitor\",\n\n      \"wife's daughter\": \"wife's daughter\",\n      \"wife's dau\": \"wife's daughter\",\n      wifdau: \"wife's daughter\",\n      \"wife's mother\": \"wife's mother\",\n      \"wif-ma\": \"wife's mother\",\n      \"wife's son\": \"wife's son\",\n      wifson: \"wife's son\",\n    };\n\n    // allows for transcription errors also (like \"Mead\" for head)\n    const fuzzyList = [\n      { standard: \"head\", starts: [\"head\", \"mead\"], notContains: [\"master\"] },\n\n      // these more fuzzy ones should come last\n      {\n        standard: \"daughter\",\n        starts: [\"dau\"],\n        notContains: [\"step\", \"law\", \"-\", \" \"],\n      },\n      { standard: \"step-daughter\", starts: [\"dau\"], andContains: [\"step\"] },\n      { standard: \"step-daughter\", starts: [\"step\"], andContains: [\"dau\"] },\n    ];\n\n    let lc = string.toLowerCase();\n\n    let exactValue = exactMap[lc];\n    if (exactValue) {\n      return exactValue;\n    }\n\n    let match = \"\";\n    for (let fuzzy of fuzzyList) {\n      if (fuzzy.starts) {\n        for (let start of fuzzy.starts) {\n          if (lc.startsWith(start)) {\n            match = fuzzy.standard;\n            break;\n          }\n        }\n      }\n      if (match && fuzzy.notContains) {\n        for (let cont of fuzzy.notContains) {\n          if (lc.includes(cont)) {\n            match = \"\";\n            break;\n          }\n        }\n      }\n      if (match && fuzzy.andContains) {\n        let doesContainOne = false;\n        for (let cont of fuzzy.andContains) {\n          if (lc.includes(cont)) {\n            doesContainOne = true;\n            break;\n          }\n        }\n        if (!doesContainOne) {\n          match = \"\";\n        }\n      }\n\n      if (match) {\n        return match;\n      }\n    }\n\n    console.log(\"standardizeRelationshipToHead: unrecognized: \" + lc);\n\n    return lc;\n  },\n\n  standardizeOccupation: function (string) {\n    // we could handle all the abbreviations here: https://www.freecen.org.uk/cms/information-for-transcribers/abbreviations\n\n    if (!string) {\n      return \"\";\n    }\n\n    let newValue = string;\n\n    const parenMap = {\n      \"em'ee\": \"employee\",\n    };\n\n    // see if there is a value in parentheses at end\n    let lastOpenParenIndex = string.lastIndexOf(\"(\");\n    if (lastOpenParenIndex != -1) {\n      let closeParenIndex = string.indexOf(\")\", lastOpenParenIndex);\n      if (closeParenIndex != -1) {\n        let parenString = string.substring(lastOpenParenIndex + 1, closeParenIndex).trim();\n        let remainderString = string.substring(closeParenIndex + 1).trim();\n        parenString = parenString.toLowerCase();\n        let match = parenMap[parenString];\n        if (match) {\n          newValue = string.substring(0, lastOpenParenIndex).trim();\n          newValue += \" (\" + match + \")\";\n          if (remainderString) {\n            newValue += \" \" + remainderString;\n          }\n        }\n      }\n    }\n\n    return newValue;\n  },\n};\n\nclass WtsDate {\n  constructor() {\n    // Fields are only set if from the record/profile, methods can infer/extract\n    // possible fields are:\n    // dateString: the date string from the record/profile\n    // yearString: a string, only set if that is what the record/profile specifies\n    // quarter: a number from 1-4\n    // qualifier: the dateQualifiers enum\n  }\n\n  static createFromPlainObject(obj) {\n    if (!obj) {\n      return undefined;\n    }\n\n    let classObj = new WtsDate();\n    const keys = Object.keys(obj);\n    for (let key of keys) {\n      classObj[key] = obj[key];\n    }\n\n    return classObj;\n  }\n\n  getYearString() {\n    if (this.yearString) {\n      return this.yearString;\n    }\n\n    if (this.dateString) {\n      return GD.extractYearStringFromDateString(this.dateString);\n    }\n  }\n\n  getDateString() {\n    if (this.dateString) {\n      return this.dateString;\n    }\n    if (this.yearString) {\n      return this.yearString;\n    }\n  }\n\n  setDateAndQualifierFromString(dateString, isYearString) {\n    const prefixes = [\n      { prefix: \"about\", qualifier: dateQualifiers.ABOUT },\n      { prefix: \"abt\", qualifier: dateQualifiers.ABOUT },\n      { prefix: \"after\", qualifier: dateQualifiers.AFTER }, // must come before aft\n      { prefix: \"aft\", qualifier: dateQualifiers.AFTER },\n      { prefix: \"before\", qualifier: dateQualifiers.BEFORE }, // must come before bef\n      { prefix: \"bef\", qualifier: dateQualifiers.BEFORE },\n    ];\n\n    let qualifier = dateQualifiers.NONE;\n    let lcDateString = dateString.toLowerCase();\n\n    if (lcDateString == \"deceased\") {\n      dateString = \"\";\n      qualifier = dateQualifiers.ABOUT;\n    } else {\n      for (let prefixEntry of prefixes) {\n        if (lcDateString.startsWith(prefixEntry.prefix)) {\n          qualifier = prefixEntry.qualifier;\n          dateString = dateString.substring(prefixEntry.prefix.length).trim();\n          while (dateString.startsWith(\".\")) {\n            dateString = dateString.substring(1).trim();\n          }\n          break;\n        }\n      }\n    }\n\n    if (qualifier != dateQualifiers.NONE) {\n      this.qualifier = qualifier;\n    }\n\n    if (isYearString) {\n      this.yearString = dateString;\n    } else {\n      this.dateString = dateString;\n    }\n  }\n\n  getQualifiedDateString(dateString, qualifier, preposition) {\n    let prep = \"\";\n    if (preposition) {\n      prep = preposition + \" \";\n    }\n\n    switch (qualifier) {\n      case dateQualifiers.ABOUT:\n        return prep + \"about \" + dateString;\n      case dateQualifiers.AFTER:\n        return \"after \" + dateString;\n      case dateQualifiers.BEFORE:\n        return \"before \" + dateString;\n    }\n\n    return prep + dateString;\n  }\n\n  getFormattedStringForCitationOrNarrative(format, highlightOption, addPreposition, prepSuffix = \"\") {\n    let dateString = this.getDateString();\n    let qualifier = this.qualifier;\n\n    let parsedDate = _wts_date_mjs__WEBPACK_IMPORTED_MODULE_3__.WTS_Date.parseDateString(dateString);\n    if (!parsedDate.isValid) {\n      if (addPreposition) {\n        let preposition = \"on\";\n        if (dateString.length <= 4 || /^[a-zA-Z].*$/.test(dateString)) {\n          preposition = \"in\";\n        }\n\n        if (prepSuffix) {\n          preposition += \" \" + prepSuffix;\n        }\n        return this.getQualifiedDateString(dateString, qualifier, preposition);\n      } else {\n        return this.getQualifiedDateString(dateString, qualifier);\n      }\n    }\n\n    let newString = \"\";\n    if (format == \"short\") {\n      newString = _wts_date_mjs__WEBPACK_IMPORTED_MODULE_3__.WTS_Date.getStdShortFormDateString(parsedDate);\n    } else if (format == \"long\") {\n      newString = _wts_date_mjs__WEBPACK_IMPORTED_MODULE_3__.WTS_Date.getStdLongFormDateString(parsedDate);\n    } else if (format == \"theNth\") {\n      newString = _wts_date_mjs__WEBPACK_IMPORTED_MODULE_3__.WTS_Date.getStdNthFormDateString(parsedDate);\n    } else if (format == \"monthComma\") {\n      newString = _wts_date_mjs__WEBPACK_IMPORTED_MODULE_3__.WTS_Date.getUsLongFormDateString(parsedDate);\n    } else if (format == \"monthCommaNth\") {\n      newString = _wts_date_mjs__WEBPACK_IMPORTED_MODULE_3__.WTS_Date.getUsNthFormDateString(parsedDate);\n    } else {\n      console.log(\"unknown date format: \" + format);\n      newString = _wts_date_mjs__WEBPACK_IMPORTED_MODULE_3__.WTS_Date.getStdLongFormDateString(parsedDate);\n    }\n\n    newString = _wts_string_mjs__WEBPACK_IMPORTED_MODULE_2__.WTS_String.highlightString(newString, highlightOption);\n\n    let preposition = \"on\";\n    if (!parsedDate.hasDay) {\n      preposition = \"in\";\n    }\n\n    if (prepSuffix) {\n      preposition += \" \" + prepSuffix;\n    }\n\n    if (!addPreposition) {\n      preposition = \"\";\n    }\n\n    return this.getQualifiedDateString(newString, qualifier, preposition);\n  }\n\n  getNarrativeFormat(format, highlightOption, addPreposition, prepSuffix = \"\") {\n    return this.getFormattedStringForCitationOrNarrative(format, highlightOption, addPreposition, prepSuffix);\n  }\n\n  getDataStringFormat(addPreposition, prepSuffix = \"\") {\n    return this.getFormattedStringForCitationOrNarrative(\"short\", \"none\", addPreposition, prepSuffix);\n  }\n}\n\n// NOTE: Is Location of Place the best term? All the sites (including wikitree) use \"Place\"\nclass WtsPlace {\n  constructor() {\n    // Fields are only set if from the record/profile, methods can infer/extract\n    // possible fields are:\n    // placeString: the place string from the record/profile\n    // country: a string, only set if that is what the record/profile specifies\n    // qualifier: the placeQualifiers enum\n  }\n\n  static createFromPlainObject(obj) {\n    if (!obj) {\n      return undefined;\n    }\n\n    let classObj = new WtsPlace();\n    const keys = Object.keys(obj);\n    for (let key of keys) {\n      classObj[key] = obj[key];\n    }\n\n    return classObj;\n  }\n\n  separatePlaceIntoParts() {\n    // it can be hard to get the county from the string.\n    let country = undefined;\n    let placeNameMinusCountry = this.placeString;\n\n    let result = {};\n\n    if (!placeNameMinusCountry) {\n      return result;\n    }\n\n    let countryExtract = _country_data_mjs__WEBPACK_IMPORTED_MODULE_0__.CD.extractCountryFromPlaceName(this.placeString);\n    if (countryExtract) {\n      country = countryExtract.country;\n      placeNameMinusCountry = countryExtract.remainder;\n\n      if (country.hasStates) {\n        return result;\n      }\n\n      result.country = country.stdName;\n    }\n\n    let placeNameMinusCounty = \"\";\n\n    let possibleCountyName = undefined;\n    let lastCommaIndex = placeNameMinusCountry.lastIndexOf(\",\");\n    if (lastCommaIndex != -1) {\n      possibleCountyName = placeNameMinusCountry.substring(lastCommaIndex + 1).trim();\n      placeNameMinusCounty = placeNameMinusCountry.substring(0, lastCommaIndex).trim();\n    } else {\n      possibleCountyName = placeNameMinusCountry;\n    }\n\n    result.localPlace = placeNameMinusCountry;\n    if (country) {\n      let stdCountyName = _country_data_mjs__WEBPACK_IMPORTED_MODULE_0__.CD.standardizeCountyNameForCountry(possibleCountyName, country);\n      if (stdCountyName) {\n        result.county = stdCountyName;\n        result.localPlace = placeNameMinusCounty;\n      } else if (possibleCountyName) {\n        // it is possible that the county name has a comma in in like \"Yorkshire, East Riding\"\n        let lastCommaIndex = placeNameMinusCounty.lastIndexOf(\",\");\n        if (lastCommaIndex != -1) {\n          let possibleExtraCountyName = placeNameMinusCounty.substring(lastCommaIndex + 1).trim();\n          if (possibleExtraCountyName) {\n            let combinedName = possibleExtraCountyName + \", \" + possibleCountyName;\n            stdCountyName = _country_data_mjs__WEBPACK_IMPORTED_MODULE_0__.CD.standardizeCountyNameForCountry(combinedName, country);\n            if (stdCountyName) {\n              placeNameMinusCounty = placeNameMinusCounty.substring(0, lastCommaIndex).trim();\n              result.county = stdCountyName;\n              result.localPlace = placeNameMinusCounty;\n            }\n          }\n        }\n      }\n    }\n\n    return result;\n  }\n\n  inferCounty() {\n    if (this.county) {\n      return this.county;\n    }\n\n    if (!this.placeString) {\n      return \"\";\n    }\n\n    // it can be hard to get the county from the string.\n    let country = undefined;\n    let placeNameMinusCountry = this.placeString;\n\n    let countryExtract = _country_data_mjs__WEBPACK_IMPORTED_MODULE_0__.CD.extractCountryFromPlaceName(this.placeString);\n    if (countryExtract) {\n      country = countryExtract.country;\n      placeNameMinusCountry = countryExtract.remainder;\n\n      if (country.hasStates) {\n        return \"\";\n      }\n    }\n\n    let countyName = undefined;\n    let lastCommaIndex = placeNameMinusCountry.lastIndexOf(\",\");\n    if (lastCommaIndex != -1) {\n      countyName = placeNameMinusCountry.substring(lastCommaIndex + 1).trim();\n    } else {\n      countyName = placeNameMinusCountry;\n    }\n\n    if (country) {\n      let stdCountyName = _country_data_mjs__WEBPACK_IMPORTED_MODULE_0__.CD.standardizeCountyNameForCountry(countyName, country);\n      if (stdCountyName) {\n        return stdCountyName;\n      }\n    }\n  }\n\n  inferTown() {\n    // it can be hard to get the county from the string, the town is harder\n    // this is not always going to work but can be useful if you can check it later\n    let country = undefined;\n    let placeNameMinusCountry = this.placeString;\n\n    let countryExtract = _country_data_mjs__WEBPACK_IMPORTED_MODULE_0__.CD.extractCountryFromPlaceName(this.placeString);\n    if (countryExtract) {\n      country = countryExtract.country;\n      placeNameMinusCountry = countryExtract.remainder;\n\n      if (country.hasStates) {\n        return \"\";\n      }\n    }\n\n    let countyName = undefined;\n    let placeNameMinusCounty = undefined;\n    let lastCommaIndex = placeNameMinusCountry.lastIndexOf(\",\");\n    if (lastCommaIndex != -1) {\n      countyName = placeNameMinusCountry.substring(lastCommaIndex + 1).trim();\n      placeNameMinusCounty = placeNameMinusCountry.substring(0, lastCommaIndex).trim();\n    } else {\n      countyName = placeNameMinusCountry;\n    }\n\n    if (country) {\n      let stdCountyName = _country_data_mjs__WEBPACK_IMPORTED_MODULE_0__.CD.standardizeCountyNameForCountry(countyName, country);\n      if (!stdCountyName) {\n        // the county is not recognized, so it could be the twon name\n        placeNameMinusCounty = placeNameMinusCountry;\n      }\n    }\n\n    // best guess is that the town name is what is after the last comma in placeNameMinusCounty\n    let townName = \"\";\n    if (placeNameMinusCounty) {\n      lastCommaIndex = placeNameMinusCounty.lastIndexOf(\",\");\n      if (lastCommaIndex != -1) {\n        townName = placeNameMinusCounty.substring(lastCommaIndex + 1).trim();\n      } else {\n        townName = placeNameMinusCounty;\n      }\n    }\n\n    return townName;\n  }\n\n  getCommonPlace(otherPlace) {\n    if (!otherPlace || !otherPlace.placeString) {\n      return this.placeString;\n    }\n\n    if (!this.placeString) {\n      return otherPlace.placeString;\n    }\n\n    if (this.placeString == otherPlace.placeString) {\n      return this.placeString;\n    }\n\n    let thisCountry = _country_data_mjs__WEBPACK_IMPORTED_MODULE_0__.CD.extractCountryFromPlaceName(this.placeString);\n    let otherCountry = _country_data_mjs__WEBPACK_IMPORTED_MODULE_0__.CD.extractCountryFromPlaceName(otherPlace.placeString);\n    if (thisCountry && otherCountry) {\n      if (thisCountry.country.stdName != otherCountry.country.stdName) {\n        return \"\";\n      }\n    }\n\n    let thisCounty = this.inferCounty();\n    let otherCounty = otherPlace.inferCounty();\n    if (thisCounty && otherCounty) {\n      if (thisCounty == otherCounty) {\n        let place = thisCounty;\n        if (thisCountry) {\n          place += \", \" + thisCountry.country.stdName;\n        }\n        if (otherCountry) {\n          place += \", \" + otherCountry.country.stdName;\n        }\n        return place;\n      }\n    }\n\n    if (thisCountry) {\n      return thisCountry.country.stdName;\n    }\n    if (otherCountry) {\n      return otherCountry.country.stdName;\n    }\n\n    // would could also find the first difference in strings starting from end.\n    // would only work if spaces/commas were consistent\n    return \"\";\n  }\n}\n\nclass WtsName {\n  constructor() {\n    // Note, all strings have all white space replaced with single spaces and are trimmed\n    // possible fields are:\n    // name : the \"full\" name from the record/profile\n    // forenames\n    // firstName\n    // firstNames\n    // middleName\n    // middleNames\n    // prefName\n    // prefNames\n    // lastName\n  }\n\n  static createFromPlainObject(obj) {\n    if (!obj) {\n      return undefined;\n    }\n\n    let classObj = new WtsName();\n    const keys = Object.keys(obj);\n    for (let key of keys) {\n      classObj[key] = obj[key];\n    }\n\n    return classObj;\n  }\n\n  cleanName(name) {\n    if (!name) {\n      return name;\n    }\n    // remove any '.' characters in name\n    name = name.replace(/\\./g, \"\");\n    name = name.replace(/\\s+/g, \" \");\n    name = name.trim();\n    return name;\n  }\n\n  removeTitle(name, isFull = false) {\n    if (!name) {\n      return 0;\n    }\n\n    let wordCount = _wts_string_mjs__WEBPACK_IMPORTED_MODULE_2__.WTS_String.countWords(name);\n\n    if (isFull) {\n      if (wordCount < 3) {\n        return name;\n      }\n    } else {\n      if (wordCount < 2) {\n        return name;\n      }\n    }\n\n    let firstWord = _wts_string_mjs__WEBPACK_IMPORTED_MODULE_2__.WTS_String.getFirstWord(name);\n\n    const titles = [\"mr\", \"mrs\", \"miss\", \"ms\"];\n    let lcFirstWord = firstWord.toLowerCase();\n    if (titles.includes(lcFirstWord)) {\n      // remove the title\n      return _wts_string_mjs__WEBPACK_IMPORTED_MODULE_2__.WTS_String.getWordsAfterFirstWord(name);\n    }\n\n    return name;\n  }\n\n  setFullName(name) {\n    if (name) {\n      this.name = this.cleanName(name);\n      this.name = this.removeTitle(this.name, true);\n    }\n  }\n\n  setLastName(name) {\n    if (name) {\n      this.lastName = this.cleanName(name);\n    }\n  }\n\n  setForeNames(name) {\n    if (name) {\n      this.forenames = this.cleanName(name);\n      this.forenames = this.removeTitle(this.forenames);\n    }\n  }\n\n  setFirstName(name) {\n    if (name) {\n      this.firstName = this.cleanName(name);\n      this.firstName = this.removeTitle(this.firstName);\n    }\n  }\n\n  setFirstNames(name) {\n    if (name) {\n      this.firstNames = this.cleanName(name);\n      this.firstNames = this.removeTitle(this.firstNames);\n    }\n  }\n\n  setMiddleName(name) {\n    if (name) {\n      this.middleName = this.cleanName(name);\n    }\n  }\n\n  setMiddleNames(name) {\n    if (name) {\n      this.middleNames = this.cleanName(name);\n    }\n  }\n\n  getMiddleName() {\n    if (this.middleName) {\n      return this.middleName;\n    }\n    if (this.middleNames) {\n      return _wts_string_mjs__WEBPACK_IMPORTED_MODULE_2__.WTS_String.getFirstWord(this.middleNames);\n    }\n    if (this.forenames) {\n      let middleNames = _wts_string_mjs__WEBPACK_IMPORTED_MODULE_2__.WTS_String.getWordsAfterFirstWord(this.forenames);\n      if (middleNames) {\n        return _wts_string_mjs__WEBPACK_IMPORTED_MODULE_2__.WTS_String.getFirstWord(middleNames);\n      }\n    }\n    if (this.name) {\n      let forenames = _wts_string_mjs__WEBPACK_IMPORTED_MODULE_2__.WTS_String.getWordsBeforeLastWord(this.name);\n      if (forenames) {\n        let middleNames = _wts_string_mjs__WEBPACK_IMPORTED_MODULE_2__.WTS_String.getWordsAfterFirstWord(forenames);\n        if (middleNames) {\n          return _wts_string_mjs__WEBPACK_IMPORTED_MODULE_2__.WTS_String.getFirstWord(middleNames);\n        }\n      }\n    }\n  }\n\n  inferFullName() {\n    if (this.name) {\n      return this.name;\n    }\n\n    if (this.middleName || this.firstName || this.middleNames || this.firstNames || this.forenames || this.lastName) {\n      let name = \"\";\n      if (this.forenames) {\n        name = this.forenames;\n      } else {\n        if (this.firstNames) {\n          name = this.firstNames;\n        } else if (this.firstName) {\n          name = this.firstName;\n        }\n\n        if (this.middleNames) {\n          name += \" \" + this.middleNames;\n        } else if (this.middleName) {\n          name += \" \" + this.middleName;\n        }\n      }\n\n      if (this.lastName) {\n        if (name) {\n          name += \" \";\n        }\n        name += this.lastName;\n      }\n      return name;\n    }\n  }\n\n  inferLastName() {\n    if (this.lastName) {\n      return this.lastName;\n    }\n    if (this.name) {\n      return _wts_string_mjs__WEBPACK_IMPORTED_MODULE_2__.WTS_String.getLastWord(this.name);\n    }\n  }\n\n  inferFirstName() {\n    if (this.firstName) {\n      return this.firstName;\n    }\n    if (this.firstNames) {\n      return _wts_string_mjs__WEBPACK_IMPORTED_MODULE_2__.WTS_String.getFirstWord(this.firstNames);\n    }\n    if (this.forenames) {\n      return _wts_string_mjs__WEBPACK_IMPORTED_MODULE_2__.WTS_String.getFirstWord(this.forenames);\n    }\n    if (this.name) {\n      return _wts_string_mjs__WEBPACK_IMPORTED_MODULE_2__.WTS_String.getFirstWord(this.name);\n    }\n  }\n\n  inferMiddleName() {\n    if (this.middleName) {\n      return this.middleName;\n    }\n    if (this.middleNames) {\n      return _wts_string_mjs__WEBPACK_IMPORTED_MODULE_2__.WTS_String.getFirstWord(this.middleNames);\n    }\n    if (this.forenames) {\n      return _wts_string_mjs__WEBPACK_IMPORTED_MODULE_2__.WTS_String.getSecondWord(this.forenames);\n    }\n    if (this.name) {\n      return _wts_string_mjs__WEBPACK_IMPORTED_MODULE_2__.WTS_String.getMiddleWord(this.name);\n    }\n  }\n\n  inferSecondForename() {\n    let result = \"\";\n\n    if (this.firstNames) {\n      result = _wts_string_mjs__WEBPACK_IMPORTED_MODULE_2__.WTS_String.getSecondWord(this.firstNames);\n      if (result) {\n        return result;\n      }\n    }\n\n    if (this.forenames) {\n      result = _wts_string_mjs__WEBPACK_IMPORTED_MODULE_2__.WTS_String.getSecondWord(this.forenames);\n      if (result) {\n        return result;\n      }\n    }\n    if (this.middleName) {\n      return this.middleName;\n    }\n    if (this.middleNames) {\n      return _wts_string_mjs__WEBPACK_IMPORTED_MODULE_2__.WTS_String.getFirstWord(this.middleNames);\n    }\n    if (this.name) {\n      return _wts_string_mjs__WEBPACK_IMPORTED_MODULE_2__.WTS_String.getMiddleWord(this.name);\n    }\n  }\n\n  inferMiddleNames() {\n    if (this.middleNames) {\n      return this.middleNames;\n    }\n    if (this.middleName) {\n      return this.middleName;\n    }\n    if (this.forenames) {\n      return _wts_string_mjs__WEBPACK_IMPORTED_MODULE_2__.WTS_String.getWordsAfterFirstWord(this.forenames);\n    }\n    if (this.name) {\n      return _wts_string_mjs__WEBPACK_IMPORTED_MODULE_2__.WTS_String.getMiddleWords(this.name);\n    }\n  }\n\n  inferForenames() {\n    if (this.forenames) {\n      return this.forenames;\n    }\n    if (this.middleName || this.firstName || this.middleNames || this.firstNames) {\n      let forenames = \"\";\n      if (this.firstNames) {\n        forenames = this.firstNames;\n      } else if (this.firstName) {\n        forenames = this.firstName;\n      }\n      if (this.middleNames) {\n        forenames += \" \" + this.middleNames;\n      } else if (this.middleName) {\n        forenames += \" \" + this.middleName;\n      }\n      return forenames;\n    }\n    if (this.name) {\n      return _wts_string_mjs__WEBPACK_IMPORTED_MODULE_2__.WTS_String.getWordsBeforeLastWord(this.name);\n    }\n  }\n\n  inferPrefix() {\n    if (this.prefix) {\n      return this.prefix;\n    }\n  }\n\n  inferSuffix() {\n    if (this.suffix) {\n      return this.suffix;\n    }\n  }\n}\n\nclass GeneralizedData {\n  constructor() {\n    // NOTE: Adding a new field here will likely invalidate all generalize test data\n    // so we don't actually initialize an fields here.\n    // The only fields set are ones that come from the record/profile\n    // Supported fields are:\n    // hasValidData : not sure if we need it - used in popup to determine whether to show menu items\n    // sourceOfData : must be one of the supported site names\n    // sourceType: A string either \"record\" or \"profile\"\n    // recordType: A string, if a record this is something like \"BirthRegistration\" or \"Census\"\n    // birthDate: a WtsDate object\n    // deathDate: a WtsDate object\n    // eventDate: a WtsDate object\n    // ageAtEvent: a string\n    // ageAtDeath: a string\n    // lastNameAtBirth: string\n    // lastNameAtDeath: string\n    // mothersMaidenName: string\n    // name: WtsName object, the name from the record/profile. For a profile this would include the LNAB as lastName\n    // birthPlace: a WtsPlace object\n    // deathPlace: a WtsPlace object\n    // eventPlace: a WtsPlace object\n    // residencePlace: a WtsPlace object\n    // registrationDistrict: a string\n    // personGender: a lowerface string, either \"male\", \"female\" or not defined\n    // parents: an object with father and mother fields\n    // spouses: an array of objects\n  }\n\n  static createFromPlainObject(obj) {\n    if (!obj) {\n      return undefined;\n    }\n\n    let classObj = new GeneralizedData();\n    const keys = Object.keys(obj);\n    for (let key of keys) {\n      if (key == \"eventDate\" || key == \"birthDate\" || key == \"deathDate\") {\n        classObj[key] = WtsDate.createFromPlainObject(obj[key]);\n      } else if (key == \"name\") {\n        classObj[key] = WtsName.createFromPlainObject(obj[key]);\n      } else if (key == \"birthPlace\" || key == \"deathPlace\" || key == \"eventPlace\" || key == \"residencePlace\") {\n        classObj[key] = WtsPlace.createFromPlainObject(obj[key]);\n      } else if (key == \"parents\") {\n        classObj[key] = {};\n        if (obj.parents.father) {\n          let father = obj.parents.father;\n          classObj[key].father = {};\n          if (father.name) {\n            classObj[key].father.name = WtsName.createFromPlainObject(father.name);\n          }\n          if (father.lastNameAtBirth) {\n            classObj[key].father.lastNameAtBirth = father.lastNameAtBirth;\n          }\n          if (father.lastNameAtDeath) {\n            classObj[key].father.lastNameAtDeath = father.lastNameAtDeath;\n          }\n        }\n        if (obj.parents.mother) {\n          let mother = obj.parents.mother;\n          classObj[key].mother = {};\n          if (mother.name) {\n            classObj[key].mother.name = WtsName.createFromPlainObject(mother.name);\n          }\n          if (mother.lastNameAtBirth) {\n            classObj[key].mother.lastNameAtBirth = mother.lastNameAtBirth;\n          }\n          if (mother.lastNameAtDeath) {\n            classObj[key].mother.lastNameAtDeath = mother.lastNameAtDeath;\n          }\n        }\n      } else if (key == \"spouses\") {\n        classObj[key] = [];\n        for (let spouse of obj.spouses) {\n          let newSpouse = {};\n          if (spouse.name) {\n            newSpouse.name = WtsName.createFromPlainObject(spouse.name);\n          }\n          if (spouse.lastNameAtBirth) {\n            newSpouse.lastNameAtBirth = spouse.lastNameAtBirth;\n          }\n          if (spouse.lastNameAtBirth) {\n            newSpouse.lastNameAtBirth = spouse.lastNameAtBirth;\n          }\n          if (spouse.marriageDate) {\n            newSpouse.marriageDate = WtsDate.createFromPlainObject(spouse.marriageDate);\n          }\n          if (spouse.marriagePlace) {\n            newSpouse.marriagePlace = WtsPlace.createFromPlainObject(spouse.marriagePlace);\n          }\n          if (spouse.age) {\n            newSpouse.age = spouse.age;\n          }\n          classObj[key].push(newSpouse);\n        }\n      } else {\n        classObj[key] = obj[key];\n      }\n    }\n\n    return classObj;\n  }\n\n  static makeDateStringFromDate(date) {\n    const monthStrings = [\n      \"January\",\n      \"February\",\n      \"March\",\n      \"April\",\n      \"May\",\n      \"June\",\n      \"July\",\n      \"August\",\n      \"September\",\n      \"October\",\n      \"November\",\n      \"December\",\n    ];\n\n    const dateString = \"\" + date.getUTCDate() + \" \" + monthStrings[date.getUTCMonth()] + \" \" + date.getUTCFullYear();\n\n    return dateString;\n  }\n\n  static getAgeAtDate(birthDate, otherDate) {\n    let years = _wts_date_mjs__WEBPACK_IMPORTED_MODULE_3__.WTS_Date.getWholeYearsBetweenDateStrings(birthDate, otherDate);\n    return years;\n  }\n\n  static getSubtractAgeFromDate(dateString, age) {\n    let parsedDate = _wts_date_mjs__WEBPACK_IMPORTED_MODULE_3__.WTS_Date.parseDateString(dateString);\n    if (!parsedDate.isValid) {\n      return dateString;\n    }\n\n    parsedDate.yearNum -= age;\n\n    return _wts_date_mjs__WEBPACK_IMPORTED_MODULE_3__.WTS_Date.getStdShortFormDateString(parsedDate);\n  }\n\n  static getSubtractAgeFromDateYear(dateYear, age) {\n    return dateYear - age;\n  }\n\n  extractNamePartsFromForeNames(nameParts) {\n    // we assume that the full name has all white space replaced with single spaces and is trimmed\n    let firstSpaceIndex = nameParts.forenames.indexOf(\" \");\n    if (firstSpaceIndex == -1) {\n      // no spaces,\n      nameParts.firstName = nameParts.forenames;\n      return;\n    }\n\n    nameParts.firstName = nameParts.forenames.substring(0, firstSpaceIndex);\n    nameParts.middleNames = nameParts.forenames.substring(firstSpaceIndex + 1);\n\n    firstSpaceIndex = nameParts.middleNames.indexOf(\" \");\n    if (firstSpaceIndex != -1) {\n      // no spaces,\n      nameParts.middleName = nameParts.middleNames.substring(0, firstSpaceIndex);\n    } else {\n      nameParts.middleName = nameParts.middleNames;\n    }\n  }\n\n  extractNamePartsFromFullName(nameParts) {\n    if (!nameParts.fullName) {\n      return;\n    }\n\n    // we assume that the full name has all white space replaced with single spaces and is trimmed\n    let lastSpaceIndex = nameParts.fullName.lastIndexOf(\" \");\n    if (lastSpaceIndex == -1) {\n      // no spaces,\n      nameParts.lastName = nameParts.fullName;\n      return nameParts;\n    }\n\n    nameParts.forenames = nameParts.fullName.substring(0, lastSpaceIndex);\n    nameParts.lastName = nameParts.fullName.substring(lastSpaceIndex + 1);\n\n    this.extractNamePartsFromForeNames(nameParts);\n\n    return;\n  }\n\n  extractNamesFromForeNames() {\n    this.extractNamePartsFromForeNames(this.name);\n  }\n\n  extractNamesFromFullName() {\n    this.extractNamePartsFromFullName(this.name);\n    this.eventLastName = this.lastName;\n    delete this.lastName; // for the GeneralizedData itself we use eventLastName rather than lastName\n  }\n\n  createNameIfNeeded() {\n    if (!this.name) {\n      this.name = new WtsName();\n    }\n  }\n\n  setFullName(string) {\n    if (string) {\n      this.createNameIfNeeded();\n      this.name.setFullName(string);\n    }\n  }\n\n  setLastNameAndForeNames(lastName, forenames) {\n    if (lastName) {\n      this.createNameIfNeeded();\n      this.name.setLastName(lastName);\n    }\n    if (forenames) {\n      this.createNameIfNeeded();\n      this.name.setForeNames(forenames);\n    }\n  }\n\n  isUsableDateString(string) {\n    if (string) {\n      let lcString = string.toLowerCase().trim();\n      if (lcString != \"unknown\") {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  createBirthDateIfNeeded() {\n    if (!this.birthDate) {\n      this.birthDate = new WtsDate();\n    }\n  }\n\n  setBirthDate(string) {\n    if (this.isUsableDateString(string)) {\n      this.createBirthDateIfNeeded();\n      this.birthDate.setDateAndQualifierFromString(string);\n    }\n  }\n\n  setBirthYear(string) {\n    if (this.isUsableDateString(string)) {\n      this.createBirthDateIfNeeded();\n      this.birthDate.setDateAndQualifierFromString(string, true);\n    }\n  }\n\n  setBirthDateFromYearMonthDay(year, month, day) {\n    let dateString = _wts_date_mjs__WEBPACK_IMPORTED_MODULE_3__.WTS_Date.getDateStringFromYearMonthDay(year, month, day);\n\n    if (dateString) {\n      this.createBirthDateIfNeeded();\n      this.birthDate.dateString = dateString;\n    }\n  }\n\n  createBirthPlaceIfNeeded() {\n    if (!this.birthPlace) {\n      this.birthPlace = new WtsPlace();\n    }\n  }\n\n  setBirthPlace(value) {\n    if (value) {\n      this.createBirthPlaceIfNeeded();\n      this.birthPlace.placeString = value;\n    }\n  }\n\n  createDeathDateIfNeeded() {\n    if (!this.deathDate) {\n      this.deathDate = new WtsDate();\n    }\n  }\n\n  setDeathDate(string) {\n    if (this.isUsableDateString(string)) {\n      this.createDeathDateIfNeeded();\n      this.deathDate.setDateAndQualifierFromString(string);\n    }\n  }\n\n  setDeathYear(string) {\n    if (this.isUsableDateString(string)) {\n      this.createDeathDateIfNeeded();\n      this.deathDate.setDateAndQualifierFromString(string, true);\n    }\n  }\n\n  createDeathPlaceIfNeeded() {\n    if (!this.deathPlace) {\n      this.deathPlace = new WtsPlace();\n    }\n  }\n\n  setDeathPlace(value) {\n    if (value) {\n      this.createDeathPlaceIfNeeded();\n      this.deathPlace.placeString = value;\n    }\n  }\n\n  createEventDateIfNeeded() {\n    if (!this.eventDate) {\n      this.eventDate = new WtsDate();\n    }\n  }\n\n  setEventDate(string) {\n    if (this.isUsableDateString(string)) {\n      this.createEventDateIfNeeded();\n      this.eventDate.dateString = string;\n    }\n  }\n\n  setEventYear(string) {\n    if (this.isUsableDateString(string)) {\n      this.createEventDateIfNeeded();\n      this.eventDate.yearString = string;\n    }\n  }\n\n  setEventQuarter(value) {\n    if (typeof value !== \"undefined\") {\n      this.createEventDateIfNeeded();\n      this.eventDate.quarter = value;\n    }\n  }\n\n  createEventPlaceIfNeeded() {\n    if (!this.eventPlace) {\n      this.eventPlace = new WtsPlace();\n    }\n  }\n\n  setEventPlace(value) {\n    if (value) {\n      this.createEventPlaceIfNeeded();\n      this.eventPlace.placeString = value;\n    }\n  }\n\n  setEventCountry(value) {\n    if (value) {\n      this.createEventPlaceIfNeeded();\n      this.eventPlace.country = value;\n    }\n  }\n\n  setEventCounty(value) {\n    if (value) {\n      this.createEventPlaceIfNeeded();\n      this.eventPlace.county = value;\n    }\n  }\n\n  createResidencePlaceIfNeeded() {\n    if (!this.residencePlace) {\n      this.residencePlace = new WtsPlace();\n    }\n  }\n\n  setResidencePlace(value) {\n    if (value) {\n      this.createResidencePlaceIfNeeded();\n      this.residencePlace.placeString = value;\n    }\n  }\n\n  setFieldIfValueExists(fieldName, value) {\n    if (fieldName && value) {\n      this[fieldName] = value;\n    }\n  }\n\n  setPersonGender(value) {\n    value = GD.standardizeGender(value);\n    if (value) {\n      this.personGender = value;\n    }\n  }\n\n  setMaritalStatus(value) {\n    value = GD.standardizeMaritalStatus(value);\n    if (value) {\n      this.maritalStatus = value;\n    }\n  }\n\n  setRelationshipToHead(value) {\n    value = GD.standardizeRelationshipToHead(value);\n    if (value) {\n      this.relationshipToHead = value;\n    }\n  }\n\n  setOccupation(value) {\n    value = GD.standardizeOccupation(value);\n    if (value) {\n      this.occupation = value;\n    }\n  }\n\n  addSpouse() {\n    if (this.spouses == undefined) {\n      this.spouses = [];\n    }\n\n    let spouse = {};\n    spouse.name = new WtsName();\n    spouse.marriageDate = new WtsDate();\n    spouse.marriagePlace = new WtsPlace();\n\n    this.spouses.push(spouse);\n\n    return spouse;\n  }\n\n  addMother() {\n    if (this.parents == undefined) {\n      this.parents = {};\n    }\n\n    if (this.parents.mother == undefined) {\n      this.parents.mother = {};\n    }\n\n    if (this.parents.mother.name == undefined) {\n      this.parents.mother.name = new WtsName();\n    }\n\n    return this.parents.mother;\n  }\n\n  addFather() {\n    if (this.parents == undefined) {\n      this.parents = {};\n    }\n\n    if (this.parents.father == undefined) {\n      this.parents.father = {};\n    }\n\n    if (this.parents.father.name == undefined) {\n      this.parents.father.name = new WtsName();\n    }\n\n    return this.parents.father;\n  }\n\n  addSpouseOrParentsForSelectedHouseholdMember() {\n    let members = this.householdArray;\n    if (!members || members.length <= 1) {\n      return;\n    }\n\n    let gd = this;\n\n    function findHouseholdMemberByRelationship(relationship) {\n      for (let member of members) {\n        if (member.relationship == relationship) {\n          return member;\n        }\n      }\n      return undefined;\n    }\n\n    function addParentWithRelationship(relationship, addParent) {\n      let member = findHouseholdMemberByRelationship(relationship);\n      if (member) {\n        let parent = addParent();\n        parent.name.setFullName(member.name);\n      }\n    }\n\n    function addFather() {\n      return gd.addFather();\n    }\n\n    function addMother() {\n      return gd.addMother();\n    }\n\n    if (this.relationshipToHead) {\n      if (this.relationshipToHead == \"head\") {\n        // look for spouse\n        if (!this.maritalStatus || this.maritalStatus == \"married\") {\n          let wife = findHouseholdMemberByRelationship(\"wife\");\n          if (wife) {\n            // could there be more than one member with relationship of wife?\n            // seems like an error but could happen. Might be safest to check this wife member comes\n            // immediately after this person.\n            let thisIndex = this.householdArray.findIndex(function (element) {\n              return element.isSelected;\n            });\n            let wifeIndex = this.householdArray.indexOf(wife);\n\n            if (thisIndex != -1 && wifeIndex == thisIndex + 1) {\n              // add a spouse\n              let spouse = this.addSpouse();\n              spouse.name.setFullName(wife.name);\n            }\n          }\n        }\n\n        addParentWithRelationship(\"father\", addFather);\n        addParentWithRelationship(\"mother\", addMother);\n      } else if (this.relationshipToHead == \"wife\") {\n        // look for spouse\n        if (!this.maritalStatus || this.maritalStatus == \"married\") {\n          let head = findHouseholdMemberByRelationship(\"head\");\n          if (head) {\n            // could there be more than one member with relationship of head or wife?\n            // seems like an error but could happen. Might be safest to check this wife member comes\n            // immediately after the head person.\n            let thisIndex = this.householdArray.findIndex(function (element) {\n              return element.isSelected;\n            });\n            let headIndex = this.householdArray.indexOf(head);\n\n            if (headIndex != -1 && thisIndex == headIndex + 1) {\n              // add a spouse\n              let spouse = this.addSpouse();\n              spouse.name.setFullName(head.name);\n            }\n          }\n        }\n\n        addParentWithRelationship(\"father-in-law\", addFather);\n        addParentWithRelationship(\"mother-in-law\", addMother);\n      } else if (this.relationshipToHead == \"son\" || this.relationshipToHead == \"daughter\") {\n        // we have to be careful, see https://www.findmypast.co.uk/transcript?id=GBC/1851/0016942518&expand=true\n        // for an example of a daughter who is not related to the head\n        // If there are any non-family members before this person in the household then don't add parents.\n        // For now be super restricive. If there is any member who is not a head, wife, son or daughter\n        // before the selected person then do not assume head is a parent.\n        let closeFamilyRelationships = [\"head\", \"wife\", \"son\", \"daughter\"];\n        let isFamilyMember = true;\n        for (let member of members) {\n          if (member.isSelected) {\n            break;\n          }\n          if (!closeFamilyRelationships.includes(member.relationship)) {\n            isFamilyMember = false;\n            break;\n          }\n        }\n\n        if (isFamilyMember) {\n          let head = findHouseholdMemberByRelationship(\"head\");\n          if (head) {\n            if (head.gender == \"male\") {\n              addParentWithRelationship(\"head\", addFather);\n\n              let headIndex = this.householdArray.findIndex(function (element) {\n                return element.relationship == \"head\";\n              });\n              let wifeIndex = this.householdArray.findIndex(function (element) {\n                return element.relationship == \"wife\";\n              });\n              if (wifeIndex != -1 && wifeIndex == headIndex + 1) {\n                addParentWithRelationship(\"wife\", addMother);\n              }\n            } else if (head.gender == \"female\") {\n              addParentWithRelationship(\"head\", addMother);\n            } else {\n              // some census transcriptions (e.g. Ancestry) do not have the gender.\n              // In household tables it digs deeper to get this.\n              // We can't assume which the head is - father or mother - unless there is a wife.\n              let headIndex = this.householdArray.findIndex(function (element) {\n                return element.relationship == \"head\";\n              });\n              let wifeIndex = this.householdArray.findIndex(function (element) {\n                return element.relationship == \"wife\";\n              });\n              if (wifeIndex != -1 && wifeIndex == headIndex + 1) {\n                addParentWithRelationship(\"head\", addFather);\n                addParentWithRelationship(\"wife\", addMother);\n              }\n            }\n          }\n        }\n      } else if (this.relationshipToHead == \"wife's son\" || this.relationshipToHead == \"wife's daughter\") {\n        let closeFamilyRelationships = [\"head\", \"wife\", \"son\", \"daughter\", \"wife's son\", \"wife's daughter\"];\n        let isFamilyMember = true;\n        for (let member of members) {\n          if (member.isSelected) {\n            break;\n          }\n          if (!closeFamilyRelationships.includes(member.relationship)) {\n            isFamilyMember = false;\n            break;\n          }\n        }\n\n        if (isFamilyMember) {\n          let head = findHouseholdMemberByRelationship(\"head\");\n          if (head && head.gender == \"male\") {\n            let headIndex = this.householdArray.findIndex(function (element) {\n              return element.relationship == \"head\";\n            });\n            let wifeIndex = this.householdArray.findIndex(function (element) {\n              return element.relationship == \"wife\";\n            });\n            if (wifeIndex != -1 && wifeIndex == headIndex + 1) {\n              addParentWithRelationship(\"wife\", addMother);\n            }\n          }\n        }\n      }\n    }\n  }\n\n  // return an array of last names\n  inferPersonLastNamesArray(person) {\n    var lastNames = [];\n\n    if (person.lastNameAtBirth) {\n      lastNames.push(person.lastNameAtBirth);\n    }\n    if (person.lastNameAtDeath) {\n      if (person.lastNameAtDeath != person.lastNameAtBirth) {\n        lastNames.push(person.lastNameAtDeath);\n      }\n    }\n    if (person.name) {\n      let lastName = person.name.inferLastName();\n      if (lastName && !lastNames.includes(lastName)) {\n        lastNames.push(lastName);\n      }\n    }\n    if (person.spouses && person.personGender == \"female\") {\n      for (let spouse of person.spouses) {\n        if (spouse.name) {\n          let lastName = spouse.name.inferLastName();\n          if (lastName && !lastNames.includes(lastName)) {\n            lastNames.push(lastName);\n          }\n        }\n      }\n    }\n\n    return lastNames;\n  }\n\n  inferLastNames() {\n    return this.inferPersonLastNames(this);\n  }\n\n  inferPersonLastNames(person) {\n    let lastNames = \"\";\n    let lastNamesArray = this.inferPersonLastNamesArray(person);\n    if (lastNamesArray.length > 0) {\n      for (let name of lastNamesArray) {\n        if (lastNames != \"\") {\n          lastNames += \" \";\n        }\n        lastNames += name;\n      }\n    }\n    return lastNames;\n  }\n\n  // return a string of space separated forenames\n  inferForenames() {\n    let forenames = \"\";\n\n    if (this.name) {\n      forenames = this.name.inferForenames();\n    }\n\n    return forenames;\n  }\n\n  inferFullName() {\n    let fullName = \"\";\n\n    if (this.name) {\n      fullName = this.name.inferFullName();\n    }\n\n    return fullName;\n  }\n\n  inferFirstName() {\n    let firstName = \"\";\n\n    if (this.name) {\n      firstName = this.name.inferFirstName();\n    }\n\n    return firstName;\n  }\n\n  inferSecondForename() {\n    let secondForename = \"\";\n\n    if (this.name) {\n      secondForename = this.name.inferSecondForename();\n    }\n\n    return secondForename;\n  }\n\n  inferMiddleName() {\n    let middleName = \"\";\n\n    if (this.name) {\n      middleName = this.name.inferMiddleName();\n    }\n\n    return middleName;\n  }\n\n  inferMiddleNames() {\n    let middleNames = \"\";\n\n    if (this.name) {\n      middleNames = this.name.inferMiddleNames();\n    }\n\n    return middleNames;\n  }\n\n  inferLastName() {\n    let lastName = \"\";\n\n    if (this.name) {\n      return this.name.inferLastName();\n    }\n\n    if (this.lastNameAtBirth) {\n      return this.lastNameAtBirth;\n    }\n    if (this.lastNameAtDeath) {\n      return this.lastNameAtDeath;\n    }\n\n    return lastName;\n  }\n\n  inferLastNameAtBirth() {\n    if (this.lastNameAtBirth) {\n      return this.lastNameAtBirth;\n    }\n\n    if (this.name) {\n      return this.name.inferLastName();\n    }\n\n    return \"\";\n  }\n\n  inferLastNameAtDeath() {\n    function getSpouseLnab(spouse) {\n      if (spouse.lastNameAtBirth) {\n        return spouse.lastNameAtBirth;\n      }\n      if (spouse.name) {\n        return spouse.name.inferLastName();\n      }\n    }\n\n    // this is a woman and had spouses it may be that the CLN has not been set to husband's name\n    let lnabAndLnadPresentAndDifferent = false;\n    if (this.lastNameAtDeath && this.lastNameAtBirth && this.lastNameAtDeath != this.lastNameAtBirth) {\n      lnabAndLnadPresentAndDifferent = true;\n    }\n\n    if (this.personGender == \"female\" && this.spouses && !lnabAndLnadPresentAndDifferent) {\n      let lastSpouseLastName = \"\";\n      let lastMarriageDate = undefined;\n      for (let spouse of this.spouses) {\n        if (spouse.marriageDate) {\n          let marriageDate = spouse.marriageDate.getDateString();\n          let marriageParsedDate = _wts_date_mjs__WEBPACK_IMPORTED_MODULE_3__.WTS_Date.parseDateString(marriageDate);\n          if (marriageParsedDate.isValid) {\n            if (!lastMarriageDate) {\n              lastMarriageDate = marriageParsedDate;\n              lastSpouseLastName = getSpouseLnab(spouse);\n            } else {\n              let diff = _wts_date_mjs__WEBPACK_IMPORTED_MODULE_3__.WTS_Date.getDaysBetweenParsedDates(lastMarriageDate, marriageParsedDate);\n              if (diff > 0) {\n                lastMarriageDate = marriageParsedDate;\n                let spouseLnab = getSpouseLnab(spouse);\n                if (spouseLnab) {\n                  lastSpouseLastName = spouseLnab;\n                } else {\n                  // sometimes an Ancestry profile might have multiple marriages, some with no spouse name\n                  // If this is close to last marriage ignore it as it probably referes to the same one\n                  // (if could be generated from the \"years married\" in the 1911 census for example)\n                  // Otherwise count it and set name to blank\n                  if (diff > 380) {\n                    lastSpouseLastName = \"\";\n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n\n      if (lastSpouseLastName) {\n        return lastSpouseLastName;\n      }\n    }\n\n    if (this.lastNameAtDeath) {\n      return this.lastNameAtDeath;\n    }\n\n    return this.inferLastName();\n  }\n\n  inferPrefix() {\n    let prefix = \"\";\n\n    if (this.name) {\n      prefix = this.name.inferPrefix();\n    }\n\n    return prefix;\n  }\n\n  inferSuffix() {\n    let suffix = \"\";\n\n    if (this.name) {\n      suffix = this.name.inferSuffix();\n    }\n\n    return suffix;\n  }\n\n  inferBirthDateObj() {\n    if (this.birthDate) {\n      return this.birthDate;\n    }\n    if (this.deathDate) {\n      if (this.ageAtDeath) {\n        let deathDateString = this.deathDate.getDateString();\n\n        let dateString = GeneralizedData.getSubtractAgeFromDate(deathDateString, this.ageAtDeath);\n        let yearString = _wts_string_mjs__WEBPACK_IMPORTED_MODULE_2__.WTS_String.getLastWord(dateString);\n        let dateObj = new WtsDate();\n        dateObj.yearString = yearString;\n        dateObj.qualifier = dateQualifiers.ABOUT;\n        return dateObj;\n      }\n    }\n    if (this.eventDate && !this.role) {\n      if (this.recordType == _record_type_mjs__WEBPACK_IMPORTED_MODULE_4__.RT.BirthRegistration || this.recordType == _record_type_mjs__WEBPACK_IMPORTED_MODULE_4__.RT.Birth) {\n        return this.eventDate;\n      }\n    }\n    if (this.eventDate && this.ageAtEvent) {\n      let eventDateString = this.eventDate.getDateString();\n      let dateString = GeneralizedData.getSubtractAgeFromDate(eventDateString, this.ageAtEvent);\n      let yearString = _wts_string_mjs__WEBPACK_IMPORTED_MODULE_2__.WTS_String.getLastWord(dateString);\n      let dateObj = new WtsDate();\n      dateObj.yearString = yearString;\n      dateObj.qualifier = dateQualifiers.ABOUT;\n      return dateObj;\n    }\n  }\n\n  inferBirthYear() {\n    let dateObj = this.inferBirthDateObj();\n    if (dateObj) {\n      return dateObj.getYearString();\n    }\n  }\n\n  inferBirthDate() {\n    let dateObj = this.inferBirthDateObj();\n    if (dateObj) {\n      return dateObj.getDateString();\n    }\n  }\n\n  inferBirthDateQualifier() {\n    let dateObj = this.inferBirthDateObj();\n    if (dateObj) {\n      return dateObj.qualifier;\n    }\n  }\n\n  inferDeathDateObj() {\n    if (this.deathDate) {\n      return this.deathDate;\n    }\n    if (this.eventDate && !this.role) {\n      if (this.recordType == _record_type_mjs__WEBPACK_IMPORTED_MODULE_4__.RT.Death || this.recordType == _record_type_mjs__WEBPACK_IMPORTED_MODULE_4__.RT.DeathRegistration) {\n        return this.eventDate;\n      }\n    }\n  }\n\n  inferDeathYear() {\n    let dateObj = this.inferDeathDateObj();\n    if (dateObj) {\n      return dateObj.getYearString();\n    }\n  }\n\n  inferDeathDate() {\n    let dateObj = this.inferDeathDateObj();\n    if (dateObj) {\n      return dateObj.getDateString();\n    }\n  }\n\n  inferDeathDateQualifier() {\n    let dateObj = this.inferDeathDateObj();\n    if (dateObj) {\n      return dateObj.qualifier;\n    }\n  }\n\n  inferBirthPlace() {\n    if (this.birthPlace) {\n      return this.birthPlace.placeString;\n    } else if (this.recordType == _record_type_mjs__WEBPACK_IMPORTED_MODULE_4__.RT.BirthRegistration) {\n      // An eventPlace can contain the county/country so is prefered to a registrationDistrict\n      if (this.eventPlace) {\n        return this.eventPlace.placeString;\n      } else if (this.registrationDistrict) {\n        return this.registrationDistrict;\n      }\n    } else if (this.recordType == _record_type_mjs__WEBPACK_IMPORTED_MODULE_4__.RT.Baptism || this.recordType == _record_type_mjs__WEBPACK_IMPORTED_MODULE_4__.RT.Birth) {\n      if (this.eventPlace && !this.role) {\n        return this.eventPlace.placeString;\n      }\n    }\n  }\n\n  inferBirthCounty() {\n    let birthPlace = undefined;\n    if (this.birthPlace) {\n      birthPlace = this.birthPlace;\n    } else if (\n      this.recordType == _record_type_mjs__WEBPACK_IMPORTED_MODULE_4__.RT.BirthRegistration ||\n      this.recordType == _record_type_mjs__WEBPACK_IMPORTED_MODULE_4__.RT.Baptism ||\n      this.recordType == _record_type_mjs__WEBPACK_IMPORTED_MODULE_4__.RT.Birth\n    ) {\n      if (this.eventPlace && !this.role) {\n        birthPlace = this.eventPlace;\n      }\n    }\n\n    if (birthPlace) {\n      return birthPlace.inferCounty();\n    }\n\n    return undefined;\n  }\n\n  inferDeathPlace() {\n    if (this.deathPlace) {\n      return this.deathPlace.placeString;\n    } else if (this.recordType == _record_type_mjs__WEBPACK_IMPORTED_MODULE_4__.RT.Death || this.recordType == _record_type_mjs__WEBPACK_IMPORTED_MODULE_4__.RT.DeathRegistration) {\n      // An eventPlace can contain the county/country so is prefered to a registrationDistrict\n      if (this.eventPlace && !this.role) {\n        return this.eventPlace.placeString;\n      } else if (this.registrationDistrict) {\n        return this.registrationDistrict;\n      }\n    }\n  }\n\n  inferDeathCounty() {\n    let deathPlace = undefined;\n    if (this.deathPlace) {\n      deathPlace = this.deathPlace;\n    } else if (this.recordType == _record_type_mjs__WEBPACK_IMPORTED_MODULE_4__.RT.DeathRegistration || this.recordType == _record_type_mjs__WEBPACK_IMPORTED_MODULE_4__.RT.Burial || this.recordType == _record_type_mjs__WEBPACK_IMPORTED_MODULE_4__.RT.Death) {\n      if (this.eventPlace && !this.role) {\n        deathPlace = this.eventPlace;\n      }\n    }\n\n    if (deathPlace) {\n      return deathPlace.inferCounty();\n    }\n\n    return undefined;\n  }\n\n  inferDeathCountry() {\n    let placeNames = [];\n\n    let deathPlace = this.inferDeathPlace();\n    if (deathPlace) {\n      placeNames.push(deathPlace);\n    }\n\n    if (this.recordType == _record_type_mjs__WEBPACK_IMPORTED_MODULE_4__.RT.DeathRegistration || this.recordType == _record_type_mjs__WEBPACK_IMPORTED_MODULE_4__.RT.Burial || this.recordType == _record_type_mjs__WEBPACK_IMPORTED_MODULE_4__.RT.Death) {\n      if (this.eventPlace && !this.role) {\n        placeNames.push(this.eventPlace);\n      }\n\n      // Collection\n      if (this.collectionData) {\n        let collection = _record_collections_mjs__WEBPACK_IMPORTED_MODULE_1__.RC.findCollection(this.sourceOfData, this.collectionData.id);\n        let country = _record_collections_mjs__WEBPACK_IMPORTED_MODULE_1__.RC.getCountryFromCollection(collection);\n        if (country) {\n          placeNames.push(country);\n        }\n      }\n    }\n\n    return this.inferCountryFromPlaceNames(placeNames);\n  }\n\n  inferResidencePlace() {\n    if (this.residencePlace) {\n      return this.residencePlace.placeString;\n    }\n  }\n\n  inferResidenceCounty() {\n    if (this.residencePlace) {\n      return this.residencePlace.inferCounty();\n    }\n\n    return undefined;\n  }\n\n  inferGeneralPlace() {\n    if (this.sourceType == \"record\") {\n      return this.inferEventPlace();\n    }\n\n    if (this.deathPlace && this.birthPlace) {\n      return this.birthPlace.getCommonPlace(this.deathPlace);\n    }\n\n    if (this.birthPlace) {\n      return this.birthPlace.placeString;\n    }\n\n    if (this.deathPlace) {\n      return this.deathPlace.placeString;\n    }\n\n    if (this.residencePlace) {\n      return this.residencePlace.placeString;\n    }\n\n    return \"\";\n  }\n\n  inferEventDateObj() {\n    if (this.eventDate) {\n      return this.eventDate;\n    }\n  }\n\n  inferEventDate() {\n    if (this.eventDate) {\n      return this.eventDate.getDateString();\n    }\n  }\n\n  inferEventYear() {\n    if (this.eventDate) {\n      return this.eventDate.getYearString();\n    }\n  }\n\n  inferEventDateQualifier() {\n    if (this.eventDate) {\n      return this.eventDate.qualifier;\n    }\n  }\n\n  inferEventQuarter() {\n    if (this.eventDate) {\n      return this.eventDate.quarter;\n    }\n  }\n\n  inferEventPlace() {\n    if (this.eventPlace) {\n      return this.eventPlace.placeString;\n    }\n  }\n\n  inferFullEventPlace() {\n    if (this.eventPlace) {\n      let place = this.eventPlace.placeString;\n      let streetAddress = this.eventPlace.streetAddress;\n      if (streetAddress && place && !place.toLowerCase().startsWith(streetAddress.toLowerCase())) {\n        place = streetAddress + \", \" + place;\n      }\n      return place;\n    }\n  }\n\n  inferAgeAtDeath() {\n    if (this.ageAtDeath) {\n      return this.ageAtDeath;\n    }\n\n    let birthDateString = this.inferBirthDate();\n    let deathDateString = this.inferDeathDate();\n\n    if (birthDateString && deathDateString) {\n      return GeneralizedData.getAgeAtDate(birthDateString, deathDateString);\n    }\n\n    return undefined;\n  }\n\n  inferAgeAtEvent() {\n    if (this.ageAtEvent) {\n      return this.ageAtEvent;\n    }\n\n    if (this.recordType == _record_type_mjs__WEBPACK_IMPORTED_MODULE_4__.RT.Death || this.recordType == _record_type_mjs__WEBPACK_IMPORTED_MODULE_4__.RT.DeathRegistration) {\n      if (this.ageAtDeath) {\n        return this.ageAtDeath;\n      }\n\n      let birthDateString = this.inferBirthDate();\n      let deathDateString = this.inferDeathDate();\n\n      if (birthDateString && deathDateString) {\n        return GeneralizedData.getAgeAtDate(birthDateString, deathDateString);\n      }\n    }\n\n    return undefined;\n  }\n\n  inferCountries() {\n    //console.log(\"inferCountries, this is:\");\n    //console.log(this);\n\n    let placeNames = [];\n\n    let birthPlace = this.inferBirthPlace();\n    if (birthPlace) {\n      placeNames.push(birthPlace);\n    }\n\n    let deathPlace = this.inferDeathPlace();\n    if (deathPlace) {\n      placeNames.push(deathPlace);\n    }\n\n    let eventPlace = this.inferEventPlace();\n    if (eventPlace) {\n      placeNames.push(eventPlace);\n    }\n\n    let residencePlace = this.inferResidencePlace();\n    if (residencePlace) {\n      placeNames.push(residencePlace);\n    }\n\n    // Collection\n    if (this.collectionData) {\n      let collection = _record_collections_mjs__WEBPACK_IMPORTED_MODULE_1__.RC.findCollection(this.sourceOfData, this.collectionData.id);\n      let country = _record_collections_mjs__WEBPACK_IMPORTED_MODULE_1__.RC.getCountryFromCollection(collection);\n      if (country) {\n        placeNames.push(country);\n      }\n    }\n\n    // add marriage places\n    if (this.sourceType == \"profile\" && this.spouses) {\n      for (let spouse of this.spouses) {\n        if (spouse.marriagePlace && spouse.marriagePlace.placeString) {\n          placeNames.push(spouse.marriagePlace.placeString);\n        }\n      }\n    }\n\n    // determine the country or countries from placeNames array\n    if (placeNames.length > 0) {\n      let countryArray = _country_data_mjs__WEBPACK_IMPORTED_MODULE_0__.CD.buildCountryArrayFromPlaceArray(placeNames);\n      if (countryArray) {\n        return countryArray;\n      }\n    }\n\n    return [];\n  }\n\n  inferCountryFromPlaceNames(placeNames) {\n    // determine the country from placeNames array\n    if (placeNames.length > 0) {\n      let countryArray = _country_data_mjs__WEBPACK_IMPORTED_MODULE_0__.CD.buildCountryArrayFromPlaceArray(placeNames);\n      if (countryArray && countryArray.length > 0) {\n        if (countryArray.length > 1) {\n          //console.log(\"inferCountryFromPlaceNames, there are \" + countryArray.length + \" countries!\");\n          //console.log(countryArray);\n        }\n        return countryArray[0];\n      }\n    }\n\n    return undefined;\n  }\n\n  inferCountriesFromPlaceNames(placeNames) {\n    // determine the country from placeNames array\n    if (placeNames.length > 0) {\n      let countryArray = _country_data_mjs__WEBPACK_IMPORTED_MODULE_0__.CD.buildCountryArrayFromPlaceArray(placeNames);\n      if (countryArray && countryArray.length > 0) {\n        return countryArray;\n      }\n    }\n\n    return undefined;\n  }\n\n  inferEventCountry() {\n    let placeNames = [];\n\n    let eventPlace = this.inferEventPlace();\n    if (eventPlace) {\n      placeNames.push(eventPlace);\n    }\n\n    // Collection\n    if (this.collectionData) {\n      let collection = _record_collections_mjs__WEBPACK_IMPORTED_MODULE_1__.RC.findCollection(this.sourceOfData, this.collectionData.id);\n      let country = _record_collections_mjs__WEBPACK_IMPORTED_MODULE_1__.RC.getCountryFromCollection(collection);\n      if (country) {\n        placeNames.push(country);\n      }\n    }\n\n    return this.inferCountryFromPlaceNames(placeNames);\n  }\n\n  inferEventCounty() {\n    let eventCounty = \"\";\n\n    if (this.eventPlace) {\n      eventCounty = this.eventPlace.inferCounty();\n    }\n\n    return eventCounty;\n  }\n\n  inferLastNameGivenParametersAndCollection(parameters, collection, allowMultiple = false) {\n    let lastNamesArray = this.inferPersonLastNamesArray(this);\n    if (lastNamesArray.length < 1) {\n      return \"\";\n    }\n    if (lastNamesArray.length == 1) {\n      return lastNamesArray[0];\n    }\n\n    if (parameters && lastNamesArray.length > parameters.lastNameIndex) {\n      return lastNamesArray[parameters.lastNameIndex];\n    }\n\n    if (collection) {\n      if (collection.isDeath && this.lastNameAtDeath) {\n        return this.lastNameAtDeath;\n      } else if (collection.isBirth && this.lastNameAtBirth) {\n        return this.lastNameAtBirth;\n      }\n\n      if (collection.dates && (collection.dates.year || collection.dates.exactDate)) {\n        // this collection is for a specific year\n        if (this.personGender == \"female\" && this.spouses) {\n          let targetDate = collection.dates.exactDate;\n          if (!targetDate) {\n            targetDate = collection.dates.year.toString();\n          }\n          let targetParsedDate = _wts_date_mjs__WEBPACK_IMPORTED_MODULE_3__.WTS_Date.parseDateString(targetDate);\n          let bestMatchName = \"\";\n          let howCloseIsBestMatch = -1;\n          for (let spouse of this.spouses) {\n            if (spouse.marriageDate) {\n              let marriageDate = spouse.marriageDate.getDateString();\n              let marriageParsedDate = _wts_date_mjs__WEBPACK_IMPORTED_MODULE_3__.WTS_Date.parseDateString(marriageDate);\n              let diff = _wts_date_mjs__WEBPACK_IMPORTED_MODULE_3__.WTS_Date.getDaysBetweenParsedDates(marriageParsedDate, targetParsedDate);\n              if (diff >= 0) {\n                let howClose = diff;\n                if (!bestMatchName || howClose <= howCloseIsBestMatch) {\n                  bestMatchName = spouse.lastNameAtBirth;\n                  howCloseIsBestMatch = howClose;\n                }\n              }\n            }\n          }\n\n          if (bestMatchName) {\n            return bestMatchName;\n          } else if (this.lastNameAtBirth) {\n            // there are some marriages and this collection seems to be before all of them\n            return this.lastNameAtBirth;\n          }\n        }\n      }\n    }\n\n    if (allowMultiple) {\n      return this.inferLastNames();\n    }\n\n    return lastNamesArray[0];\n  }\n\n  inferLastNamesArrayGivenParametersAndCollection(parameters, collection) {\n    let lastNamesArray = this.inferPersonLastNamesArray(this);\n    if (lastNamesArray.length < 1) {\n      return [];\n    }\n    if (lastNamesArray.length == 1) {\n      return lastNamesArray;\n    }\n\n    if (parameters && lastNamesArray.length > parameters.lastNameIndex) {\n      return [lastNamesArray[parameters.lastNameIndex]];\n    }\n\n    if (collection) {\n      if (collection.isDeath && this.lastNameAtDeath) {\n        return [this.lastNameAtDeath];\n      } else if (collection.isBirth && this.lastNameAtBirth) {\n        return [this.lastNameAtBirth];\n      }\n\n      if (collection.dates && (collection.dates.year || collection.dates.exactDate)) {\n        // this collection is for a specific year\n        if (this.personGender == \"female\" && this.spouses) {\n          let targetDate = collection.dates.exactDate;\n          if (!targetDate) {\n            targetDate = collection.dates.year.toString();\n          }\n          let targetParsedDate = _wts_date_mjs__WEBPACK_IMPORTED_MODULE_3__.WTS_Date.parseDateString(targetDate);\n          let bestMatchName = \"\";\n          let howCloseIsBestMatch = -1;\n          for (let spouse of this.spouses) {\n            if (spouse.marriageDate) {\n              let marriageDate = spouse.marriageDate.getDateString();\n              let marriageParsedDate = _wts_date_mjs__WEBPACK_IMPORTED_MODULE_3__.WTS_Date.parseDateString(marriageDate);\n              let diff = _wts_date_mjs__WEBPACK_IMPORTED_MODULE_3__.WTS_Date.getDaysBetweenParsedDates(marriageParsedDate, targetParsedDate);\n              if (diff >= 0) {\n                let howClose = diff;\n                if (!bestMatchName || howClose <= howCloseIsBestMatch) {\n                  bestMatchName = spouse.lastNameAtBirth;\n                  howCloseIsBestMatch = howClose;\n                }\n              }\n            }\n          }\n\n          if (bestMatchName) {\n            return [bestMatchName];\n          } else if (this.lastNameAtBirth) {\n            // there are some marriages and this collection seems to be before all of them\n            return [this.lastNameAtBirth];\n          }\n        }\n      }\n    }\n\n    return lastNamesArray;\n  }\n\n  getRelationshipOfPrimaryPersonToThisPerson() {\n    let relationship = \"\";\n    if (this.role) {\n      if (this.role == _record_type_mjs__WEBPACK_IMPORTED_MODULE_4__.Role.Parent) {\n        relationship = \"child\";\n        if (this.primaryPersonGender) {\n          if (this.primaryPersonGender == \"male\") {\n            relationship = \"son\";\n          } else if (this.primaryPersonGender == \"female\") {\n            relationship = \"daughter\";\n          }\n        }\n      } else if (this.role == _record_type_mjs__WEBPACK_IMPORTED_MODULE_4__.Role.Child) {\n        relationship = \"parent\";\n        if (this.primaryPersonGender) {\n          if (this.primaryPersonGender == \"male\") {\n            relationship = \"father\";\n          } else if (this.primaryPersonGender == \"female\") {\n            relationship = \"mother\";\n          }\n        }\n      } else if (this.role == _record_type_mjs__WEBPACK_IMPORTED_MODULE_4__.Role.Spouse) {\n        relationship = \"spouse\";\n        if (this.primaryPersonGender) {\n          if (this.primaryPersonGender == \"male\") {\n            relationship = \"husband\";\n          } else if (this.primaryPersonGender == \"female\") {\n            relationship = \"wife\";\n          }\n        }\n      } else if (this.role == _record_type_mjs__WEBPACK_IMPORTED_MODULE_4__.Role.Sibling) {\n        relationship = \"sibling\";\n        if (this.primaryPersonGender) {\n          if (this.primaryPersonGender == \"male\") {\n            relationship = \"brother\";\n          } else if (this.primaryPersonGender == \"female\") {\n            relationship = \"sister\";\n          }\n        }\n      }\n    }\n    return relationship;\n  }\n\n  getRefTitle(collectionTitle, overrideTable) {\n    //console.log(\"generalised_data_utils getRefTitle, this is:\");\n    //console.log(this);\n\n    const defaultTable = [\n      {\n        type: undefined,\n        defaultTitle: \"Unclassified\",\n      },\n      {\n        type: _record_type_mjs__WEBPACK_IMPORTED_MODULE_4__.RT.Unclassified,\n        defaultTitle: \"Unclassified\",\n      },\n      {\n        type: _record_type_mjs__WEBPACK_IMPORTED_MODULE_4__.RT.BirthRegistration,\n        defaultTitle: \"Birth Registration\",\n      },\n      {\n        type: _record_type_mjs__WEBPACK_IMPORTED_MODULE_4__.RT.Birth,\n        defaultTitle: \"Birth\",\n      },\n      {\n        type: _record_type_mjs__WEBPACK_IMPORTED_MODULE_4__.RT.MarriageRegistration,\n        defaultTitle: \"Marriage Registration\",\n      },\n      {\n        type: _record_type_mjs__WEBPACK_IMPORTED_MODULE_4__.RT.Death,\n        defaultTitle: \"Death\",\n      },\n      {\n        type: _record_type_mjs__WEBPACK_IMPORTED_MODULE_4__.RT.DeathRegistration,\n        defaultTitle: \"Death Registration\",\n      },\n      {\n        type: _record_type_mjs__WEBPACK_IMPORTED_MODULE_4__.RT.Baptism,\n        defaultTitle: \"Baptism\",\n      },\n      {\n        type: _record_type_mjs__WEBPACK_IMPORTED_MODULE_4__.RT.Burial,\n        defaultTitle: \"Burial\",\n      },\n      {\n        type: _record_type_mjs__WEBPACK_IMPORTED_MODULE_4__.RT.Certificate,\n        defaultTitle: \"Certificate\",\n      },\n      {\n        type: _record_type_mjs__WEBPACK_IMPORTED_MODULE_4__.RT.Cremation,\n        defaultTitle: \"Cremation\",\n      },\n      {\n        type: _record_type_mjs__WEBPACK_IMPORTED_MODULE_4__.RT.Marriage,\n        defaultTitle: \"Marriage\",\n        titleMatches: [\n          { title: \"Marriage Banns\", matches: [\"Marriage Banns\"] },\n          { title: \"Marriage Bond\", matches: [\"Marriage Bond\"] },\n        ],\n        subtypes: [{ title: \"Marriage Banns\", subtype: _record_type_mjs__WEBPACK_IMPORTED_MODULE_4__.RecordSubtype.Banns }],\n      },\n      {\n        type: _record_type_mjs__WEBPACK_IMPORTED_MODULE_4__.RT.BirthOrBaptism,\n        defaultTitle: \"Birth or Baptism\",\n      },\n      {\n        type: _record_type_mjs__WEBPACK_IMPORTED_MODULE_4__.RT.DeathOrBurial,\n        defaultTitle: \"Death or Burial\",\n      },\n      {\n        type: _record_type_mjs__WEBPACK_IMPORTED_MODULE_4__.RT.Census,\n        defaultTitle: \"Census\",\n        addYear: true,\n      },\n      {\n        type: _record_type_mjs__WEBPACK_IMPORTED_MODULE_4__.RT.NonpopulationCensus,\n        defaultTitle: \"Non-population Census\",\n        addYear: true,\n      },\n      {\n        type: _record_type_mjs__WEBPACK_IMPORTED_MODULE_4__.RT.ElectoralRegister,\n        defaultTitle: \"Electoral Register\",\n        addYear: true,\n        titleMatches: [{ title: \"Voter Register\", matches: [\"Voter Register\"] }],\n      },\n      {\n        type: _record_type_mjs__WEBPACK_IMPORTED_MODULE_4__.RT.Probate,\n        defaultTitle: \"Probate\",\n      },\n      {\n        type: _record_type_mjs__WEBPACK_IMPORTED_MODULE_4__.RT.Will,\n        defaultTitle: \"Will\",\n      },\n      {\n        type: _record_type_mjs__WEBPACK_IMPORTED_MODULE_4__.RT.Divorce,\n        defaultTitle: \"Divorce\",\n      },\n      {\n        type: _record_type_mjs__WEBPACK_IMPORTED_MODULE_4__.RT.Memorial,\n        defaultTitle: \"Memorial\",\n      },\n\n      {\n        type: _record_type_mjs__WEBPACK_IMPORTED_MODULE_4__.RT.CriminalRegister,\n        defaultTitle: \"Criminal Register\",\n      },\n      {\n        type: _record_type_mjs__WEBPACK_IMPORTED_MODULE_4__.RT.FreemasonMembership,\n        defaultTitle: \"Freemason Membership\",\n      },\n      {\n        type: _record_type_mjs__WEBPACK_IMPORTED_MODULE_4__.RT.Directory,\n        defaultTitle: \"Directory\",\n        addYear: true,\n      },\n      {\n        type: _record_type_mjs__WEBPACK_IMPORTED_MODULE_4__.RT.Employment,\n        defaultTitle: \"Employment\",\n      },\n      {\n        type: _record_type_mjs__WEBPACK_IMPORTED_MODULE_4__.RT.WorkhouseRecord,\n        defaultTitle: \"Workhouse Record\",\n      },\n      {\n        type: _record_type_mjs__WEBPACK_IMPORTED_MODULE_4__.RT.CrewList,\n        defaultTitle: \"Crew List\",\n      },\n      {\n        type: _record_type_mjs__WEBPACK_IMPORTED_MODULE_4__.RT.PassengerList,\n        defaultTitle: \"Passenger List\",\n      },\n      {\n        type: _record_type_mjs__WEBPACK_IMPORTED_MODULE_4__.RT.ConvictTransportation,\n        defaultTitle: \"Convict Transportation\",\n      },\n      {\n        type: _record_type_mjs__WEBPACK_IMPORTED_MODULE_4__.RT.Military,\n        defaultTitle: \"Military\",\n      },\n      {\n        type: _record_type_mjs__WEBPACK_IMPORTED_MODULE_4__.RT.MedicalPatient,\n        defaultTitle: \"Medical Patient\",\n      },\n      {\n        type: _record_type_mjs__WEBPACK_IMPORTED_MODULE_4__.RT.QuarterSession,\n        defaultTitle: \"Quarter Session\",\n      },\n      {\n        type: _record_type_mjs__WEBPACK_IMPORTED_MODULE_4__.RT.LandTax,\n        defaultTitle: \"Land Tax\",\n      },\n      {\n        type: _record_type_mjs__WEBPACK_IMPORTED_MODULE_4__.RT.Tax,\n        defaultTitle: \"Tax Record\",\n      },\n      {\n        type: _record_type_mjs__WEBPACK_IMPORTED_MODULE_4__.RT.ValuationRoll,\n        defaultTitle: \"Valuation Roll\",\n      },\n      {\n        type: _record_type_mjs__WEBPACK_IMPORTED_MODULE_4__.RT.Apprenticeship,\n        defaultTitle: \"Apprenticeship\",\n      },\n      {\n        type: _record_type_mjs__WEBPACK_IMPORTED_MODULE_4__.RT.SocialSecurity,\n        defaultTitle: \"Social Security\",\n      },\n      {\n        type: _record_type_mjs__WEBPACK_IMPORTED_MODULE_4__.RT.SchoolRecords,\n        defaultTitle: \"School Records\",\n        addYear: true,\n        titleMatches: [{ title: \"School Yearbook\", matches: [\"School Yearbook\"] }],\n      },\n      {\n        type: _record_type_mjs__WEBPACK_IMPORTED_MODULE_4__.RT.Residence,\n        defaultTitle: \"Residence\",\n      },\n      {\n        type: _record_type_mjs__WEBPACK_IMPORTED_MODULE_4__.RT.Obituary,\n        defaultTitle: \"Obituary\",\n      },\n      {\n        type: _record_type_mjs__WEBPACK_IMPORTED_MODULE_4__.RT.Immigration,\n        defaultTitle: \"Immigration\",\n      },\n      {\n        type: _record_type_mjs__WEBPACK_IMPORTED_MODULE_4__.RT.Pension,\n        defaultTitle: \"Pension\",\n      },\n      {\n        type: _record_type_mjs__WEBPACK_IMPORTED_MODULE_4__.RT.PassportApplication,\n        defaultTitle: \"Passport Application\",\n        addYear: true,\n      },\n      {\n        type: _record_type_mjs__WEBPACK_IMPORTED_MODULE_4__.RT.Newspaper,\n        addYear: true,\n        defaultTitle: \"Newspaper\",\n      },\n      {\n        type: _record_type_mjs__WEBPACK_IMPORTED_MODULE_4__.RT.LegalRecord,\n        addYear: true,\n        defaultTitle: \"Legal Record\",\n      },\n      {\n        type: _record_type_mjs__WEBPACK_IMPORTED_MODULE_4__.RT.RateBook,\n        addYear: true,\n        defaultTitle: \"Rate Book\",\n      },\n      {\n        type: _record_type_mjs__WEBPACK_IMPORTED_MODULE_4__.RT.FamHistOrPedigree,\n        defaultTitle: \"Family History or Pedigree\",\n      },\n      {\n        type: _record_type_mjs__WEBPACK_IMPORTED_MODULE_4__.RT.Heraldry,\n        defaultTitle: \"Heraldic Record\",\n      },\n      {\n        type: _record_type_mjs__WEBPACK_IMPORTED_MODULE_4__.RT.OtherChurchEvent,\n        defaultTitle: \"Other Church Event\",\n      },\n    ];\n\n    function lookup(gd, collectionTitle, table) {\n      for (let obj of table) {\n        if (gd.recordType == obj.type) {\n          if (obj.subtypes) {\n            for (let subtype of obj.subtypes) {\n              if (gd.recordSubtype && gd.recordSubtype == subtype.subtype) {\n                let title = subtype.title;\n                // if we would like to add a year to this title\n                if (obj.addYear) {\n                  let year = gd.inferEventYear();\n                  if (year) {\n                    title = year + \" \" + title;\n                  }\n                }\n                return title;\n              }\n            }\n          }\n          if (obj.titleMatches) {\n            for (let titleMatch of obj.titleMatches) {\n              for (let match of titleMatch.matches) {\n                if (collectionTitle && collectionTitle.includes(match)) {\n                  let title = titleMatch.title;\n                  // if we would like to add a year to this title\n                  if (obj.addYear) {\n                    let year = gd.inferEventYear();\n                    if (year) {\n                      title = year + \" \" + title;\n                    }\n                  }\n                  return title;\n                }\n              }\n            }\n          }\n          let title = obj.defaultTitle;\n          // if we would like to add a year to this title\n          if (title) {\n            if (obj.addYear) {\n              let year = gd.inferEventYear();\n              if (year) {\n                title = year + \" \" + title;\n              }\n            }\n            return title;\n          }\n        }\n      }\n    }\n\n    let refTitle = undefined;\n\n    if (this.overrideRefTitle) {\n      refTitle = this.overrideRefTitle;\n    }\n\n    if (!refTitle && overrideTable) {\n      refTitle = lookup(this, collectionTitle, overrideTable);\n    }\n\n    if (!refTitle) {\n      refTitle = lookup(this, collectionTitle, defaultTable);\n    }\n\n    if (this.role) {\n      let relationship = this.getRelationshipOfPrimaryPersonToThisPerson();\n      if (refTitle == \"Unclassified\" || !refTitle) {\n        refTitle = \"Record\";\n      }\n\n      refTitle += \" of \" + relationship;\n      if (this.primaryPerson) {\n        refTitle += \" \" + this.primaryPerson;\n      }\n    }\n\n    return refTitle;\n  }\n\n  isRecordInCountry(stdCountryName) {\n    let country = this.inferEventCountry();\n    if (country) {\n      if (country == stdCountryName || _country_data_mjs__WEBPACK_IMPORTED_MODULE_0__.CD.isPartOf(country, stdCountryName)) {\n        return true;\n      }\n    }\n\n    return false;\n  }\n\n  inferParentNamesForDataString() {\n    // we used to only use the forenames if the last names were the same, this can be confusing for an example\n    // like: https://www.ancestry.com/discoveryui-content/view/12946595:60143\n    // Where the mother has a middle name (possibly maiden name) that looks like a surname.\n    // Also, user's may want to make the parent links to their profiles so a full name is better for that.\n\n    let fatherName = \"\";\n    let motherName = \"\";\n\n    if (this.parents) {\n      if (this.parents.father && this.parents.father.name) {\n        fatherName = this.parents.father.name.inferFullName();\n      }\n      if (this.parents.mother && this.parents.mother.name) {\n        motherName = this.parents.mother.name.inferFullName();\n      }\n    }\n\n    return { fatherName: fatherName, motherName: motherName };\n  }\n\n  setDatesUsingQualifierAndYearNum(dates, yearNum, dateQualifier) {\n    if (!yearNum) {\n      return;\n    }\n\n    var fromYear = yearNum;\n    var toYear = yearNum;\n\n    switch (dateQualifier) {\n      case dateQualifiers.NONE:\n        fromYear = yearNum - 2;\n        toYear = yearNum + 2;\n        break;\n      case dateQualifiers.EXACT:\n        fromYear = yearNum;\n        toYear = yearNum;\n        break;\n      case dateQualifiers.ABOUT:\n        fromYear = yearNum - 5;\n        toYear = yearNum + 5;\n        break;\n      case dateQualifiers.BEFORE:\n        fromYear = yearNum - 5;\n        toYear = yearNum;\n        break;\n      case dateQualifiers.AFTER:\n        fromYear = yearNum;\n        toYear = yearNum + 5;\n        break;\n    }\n\n    // add an extra 1 year either side because the target records that we are searching for\n    // can have inaccuracies\n    fromYear = fromYear - 1;\n    toYear = toYear + 1;\n\n    dates.startYear = fromYear;\n    dates.endYear = toYear;\n  }\n\n  setDatesUsingQualifier(dates, yearString, dateQualifier) {\n    if (!yearString || yearString == \"\") {\n      return;\n    }\n\n    let yearNum = _wts_date_mjs__WEBPACK_IMPORTED_MODULE_3__.WTS_Date.getYearNumFromYearString(yearString);\n    if (!yearNum) {\n      return;\n    }\n\n    var fromYear = yearNum;\n    var toYear = yearNum;\n\n    switch (dateQualifier) {\n      case dateQualifiers.NONE:\n        fromYear = yearNum - 2;\n        toYear = yearNum + 2;\n        break;\n      case dateQualifiers.EXACT:\n        fromYear = yearNum;\n        toYear = yearNum;\n        break;\n      case dateQualifiers.ABOUT:\n        fromYear = yearNum - 5;\n        toYear = yearNum + 5;\n        break;\n      case dateQualifiers.BEFORE:\n        fromYear = yearNum - 5;\n        toYear = yearNum;\n        break;\n      case dateQualifiers.AFTER:\n        fromYear = yearNum;\n        toYear = yearNum + 5;\n        break;\n    }\n\n    // add an extra 1 year either side because the target records that we are searching for\n    // can have inaccuracies\n    fromYear = fromYear - 1;\n    toYear = toYear + 1;\n\n    dates.startYear = fromYear;\n    dates.endYear = toYear;\n  }\n\n  couldPersonHaveBeenBornInDateRange(startYear, endYear, maxLifeSpan = possibleLifeSpan) {\n    if (!startYear) {\n      startYear = 0;\n    }\n    if (!endYear) {\n      endYear = 3000;\n    }\n\n    let birthYearNum = _wts_date_mjs__WEBPACK_IMPORTED_MODULE_3__.WTS_Date.getYearNumFromYearString(this.inferBirthYear());\n    if (birthYearNum) {\n      return birthYearNum >= startYear && birthYearNum <= endYear;\n    }\n\n    let deathYearNum = _wts_date_mjs__WEBPACK_IMPORTED_MODULE_3__.WTS_Date.getYearNumFromYearString(this.inferDeathYear());\n    if (deathYearNum) {\n      let lastestBirthYearNum = deathYearNum;\n      let earliestBirthYearNum = deathYearNum - maxLifeSpan;\n      return lastestBirthYearNum >= startYear && earliestBirthYearNum <= endYear;\n    }\n\n    let eventYearNum = _wts_date_mjs__WEBPACK_IMPORTED_MODULE_3__.WTS_Date.getYearNumFromYearString(this.inferEventYear());\n    if (eventYearNum) {\n      let lastestBirthYearNum = eventYearNum + maxLifeSpan;\n      let earliestBirthYearNum = eventYearNum - maxLifeSpan;\n      return lastestBirthYearNum >= startYear && earliestBirthYearNum <= endYear;\n    }\n\n    return true; // if we don't know the birth year then it could be in range\n  }\n\n  couldPersonHaveMarriedInDateRange(startYear, endYear, maxLifeSpan = possibleLifeSpan) {\n    if (!startYear) {\n      startYear = 0;\n    }\n    if (!endYear) {\n      endYear = 3000;\n    }\n\n    let birthYearNum = _wts_date_mjs__WEBPACK_IMPORTED_MODULE_3__.WTS_Date.getYearNumFromYearString(this.inferBirthYear());\n    let deathYearNum = _wts_date_mjs__WEBPACK_IMPORTED_MODULE_3__.WTS_Date.getYearNumFromYearString(this.inferDeathYear());\n    let ageAtDeath = this.inferAgeAtDeath();\n\n    //console.log(\"couldPersonHaveMarriedInDateRange: birthYearNum is: \" + birthYearNum + \", deathYearNum is: \" + deathYearNum);\n    //console.log(\"couldPersonHaveMarriedInDateRange: ageAtDeath is: \" + ageAtDeath);\n    //console.log(\"couldPersonHaveMarriedInDateRange: startYear is: \" + startYear + \", endYear is: \" + endYear);\n\n    if (ageAtDeath && ageAtDeath < 14) {\n      //console.log(\"couldPersonHaveMarriedInDateRange: ageAtDeath < 14\");\n      return false;\n    }\n\n    if (birthYearNum && deathYearNum) {\n      return deathYearNum >= startYear + 16 && birthYearNum <= endYear - 16;\n    } else if (birthYearNum) {\n      return birthYearNum <= endYear - 16;\n    } else if (deathYearNum) {\n      return deathYearNum >= startYear + 16;\n    }\n\n    let eventYearNum = _wts_date_mjs__WEBPACK_IMPORTED_MODULE_3__.WTS_Date.getYearNumFromYearString(this.inferEventYear());\n    //console.log(\"couldPersonHaveMarriedInDateRange: eventYearNum is: \" + eventYearNum);\n\n    if (eventYearNum) {\n      let lastestDeathYearNum = eventYearNum + maxLifeSpan;\n      let earliestBirthYearNum = eventYearNum - maxLifeSpan;\n      return lastestDeathYearNum >= startYear && earliestBirthYearNum <= endYear;\n    }\n\n    return true; // if we don't know the birth or death year then it could be in range\n  }\n\n  couldPersonHaveDiedInDateRange(startYear, endYear, maxLifespan = possibleLifeSpan) {\n    if (!startYear) {\n      startYear = 0;\n    }\n    if (!endYear) {\n      endYear = 3000;\n    }\n\n    let deathYearNum = _wts_date_mjs__WEBPACK_IMPORTED_MODULE_3__.WTS_Date.getYearNumFromYearString(this.inferDeathYear());\n    if (deathYearNum) {\n      return deathYearNum >= startYear && deathYearNum <= endYear;\n    }\n\n    let birthYearNum = _wts_date_mjs__WEBPACK_IMPORTED_MODULE_3__.WTS_Date.getYearNumFromYearString(this.inferBirthYear());\n    if (birthYearNum) {\n      let lastestDeathYearNum = birthYearNum + maxLifespan;\n      let earliestDeathYearNum = birthYearNum;\n      return lastestDeathYearNum >= startYear && earliestDeathYearNum <= endYear;\n    }\n\n    let eventYearNum = _wts_date_mjs__WEBPACK_IMPORTED_MODULE_3__.WTS_Date.getYearNumFromYearString(this.inferEventYear());\n    if (eventYearNum) {\n      let lastestDeathYearNum = eventYearNum + maxLifespan;\n      let earliestDeathYearNum = eventYearNum - maxLifespan;\n      return lastestDeathYearNum >= startYear && earliestDeathYearNum <= endYear;\n    }\n\n    return true; // if we don't know the death year then it could be in range\n  }\n\n  couldPersonHaveLivedInDateRange(startYear, endYear, maxLifespan = possibleLifeSpan) {\n    if (!startYear) {\n      startYear = 0;\n    }\n    if (!endYear) {\n      endYear = 3000;\n    }\n\n    let birthYearNum = _wts_date_mjs__WEBPACK_IMPORTED_MODULE_3__.WTS_Date.getYearNumFromYearString(this.inferBirthYear());\n    let deathYearNum = _wts_date_mjs__WEBPACK_IMPORTED_MODULE_3__.WTS_Date.getYearNumFromYearString(this.inferDeathYear());\n\n    //console.log(\"couldPersonHaveLivedInDateRange: birthYearNum is: \" + birthYearNum + \", deathYearNum is: \" + deathYearNum);\n    //console.log(\"couldPersonHaveLivedInDateRange: startYear is: \" + startYear + \", endYear is: \" + endYear);\n\n    if (birthYearNum && deathYearNum) {\n      return deathYearNum >= startYear && birthYearNum <= endYear;\n    } else if (birthYearNum) {\n      return birthYearNum <= endYear;\n    } else if (deathYearNum) {\n      return deathYearNum >= startYear;\n    }\n\n    let eventYearNum = _wts_date_mjs__WEBPACK_IMPORTED_MODULE_3__.WTS_Date.getYearNumFromYearString(this.inferEventYear());\n    //console.log(\"couldPersonHaveLivedInDateRange: eventYearNum is: \" + eventYearNum);\n\n    if (eventYearNum) {\n      let lastestDeathYearNum = eventYearNum + maxLifespan;\n      let earliestBirthYearNum = eventYearNum - maxLifespan;\n      return lastestDeathYearNum >= startYear && earliestBirthYearNum <= endYear;\n    }\n\n    return true; // if we don't know the birth or death year then it could be in range\n  }\n\n  inferPossibleLifeYearRange(maxLifespan = possibleLifeSpan) {\n    let birthYear = this.inferBirthYear();\n    let deathYear = this.inferDeathYear();\n    let eventYear = this.inferEventYear();\n\n    let currentDate = new Date();\n    let currentYear = currentDate.getFullYear();\n\n    let birthYearNum = _wts_date_mjs__WEBPACK_IMPORTED_MODULE_3__.WTS_Date.getYearNumFromYearString(birthYear);\n    let deathYearNum = _wts_date_mjs__WEBPACK_IMPORTED_MODULE_3__.WTS_Date.getYearNumFromYearString(deathYear);\n    let eventYearNum = _wts_date_mjs__WEBPACK_IMPORTED_MODULE_3__.WTS_Date.getYearNumFromYearString(eventYear);\n\n    let range = {\n      startYear: undefined,\n      endYear: undefined,\n    };\n\n    if (birthYearNum) {\n      range.startYear = birthYearNum;\n\n      if (deathYearNum) {\n        range.endYear = deathYearNum;\n      } else {\n        range.endYear = birthYearNum + maxLifespan;\n      }\n    } else if (deathYearNum && deathYearNum > maxLifespan) {\n      range.startYear = deathYearNum - maxLifespan;\n      range.endYear = deathYearNum;\n    } else if (eventYearNum) {\n      range.startYear = eventYearNum - maxLifespan;\n      range.endYear = eventYearNum + maxLifespan;\n    }\n\n    if (range.endYear > currentYear) {\n      range.endYear = currentYear;\n    }\n\n    return range;\n  }\n\n  didPersonLiveInCountryList(searchCountryArray) {\n    let countryArray = this.inferCountries();\n\n    //console.log(\"didPersonLiveInCountryList: searchCountryArray is: \");\n    //console.log(searchCountryArray);\n    //console.log(\"didPersonLiveInCountryList: countryArray is: \");\n    //console.log(countryArray);\n\n    if (countryArray.length > 0) {\n      for (let country of countryArray) {\n        for (let searchCountry of searchCountryArray) {\n          if (country == searchCountry || _country_data_mjs__WEBPACK_IMPORTED_MODULE_0__.CD.isPartOf(country, searchCountry)) {\n            return true;\n          }\n        }\n      }\n    }\n\n    return false;\n  }\n\n  getTermForUnmarried() {\n    let term = \"single\";\n    if (this.isRecordInCountry(\"United Kingdom\")) {\n      let eventYear = this.inferEventYear();\n      let yearNum = parseInt(eventYear);\n      if (!isNaN(yearNum) && yearNum < 1891) {\n        // In UK the term Unmarried was used until it was replace with single in 1891\n        term = \"unmarried\";\n      }\n    } else if (this.isRecordInCountry(\"United States\")) {\n      let eventYear = this.inferEventYear();\n      let yearNum = parseInt(eventYear);\n      if (!isNaN(yearNum) && yearNum == 1950) {\n        // In US 1950 census the term Nev (for Never Married) was used (as was \"Separated\")\n        term = \"never married\";\n      }\n    }\n    return term;\n  }\n\n  hasHouseholdTable() {\n    let fieldNames = this.householdArrayFields;\n    let objectArray = this.householdArray;\n\n    if (fieldNames && objectArray) {\n      return true;\n    }\n\n    return false;\n  }\n\n  getNarrativeDateFormat(dateObj, format, highlightOption, addPreposition, prepSuffix = \"\") {\n    let newFormat = format;\n    if (format == \"country\" || format == \"countryNth\") {\n      let countryArray = this.inferCountries();\n      if (countryArray.length == 1 && countryArray[0] == \"United States\") {\n        if (format == \"country\") {\n          newFormat = \"monthComma\";\n        } else {\n          newFormat = \"monthCommaNth\";\n        }\n      } else {\n        if (format == \"country\") {\n          newFormat = \"long\";\n        } else {\n          newFormat = \"theNth\";\n        }\n      }\n    }\n\n    return dateObj.getNarrativeFormat(newFormat, highlightOption, addPreposition, prepSuffix);\n  }\n}\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9leHRlbnNpb24vYmFzZS9jb3JlL2dlbmVyYWxpemVfZGF0YV91dGlscy5tanMuanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUV3QztBQUNNO0FBQ0E7QUFDSjtBQUNrQjs7QUFFNUQ7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxRQUFRLHFFQUFxRTs7QUFFN0U7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU87QUFDUCxRQUFRLG1FQUFtRTtBQUMzRSxRQUFRLG1FQUFtRTtBQUMzRTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQSxHQUFHOztBQUVIO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FB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QUF5QjtBQUN0QztBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRO0FBQ1I7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRO0FBQ1I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWEsOEVBQWlDO0FBQzlDO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBLFFBQVE7QUFDUjtBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRO0FBQ1I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBLGdCQUFnQixtRkFBd0M7QUFDeEQ7QUFDQTs7QUFFQTtBQUNBLHFCQUFxQixtRUFBd0I7QUFDN0M7QUFDQTtBQUNBOztBQUVBOztBQUVBLFdBQVcsNkVBQWtDO0FBQzdDOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsMEJBQTBCO0FBQzFCOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxxQkFBcUIsaUZBQXNDOztBQUUzRDtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxlQUFlO0FBQ2Y7QUFDQTtBQUNBLGVBQWU7QUFDZjtBQUNBO0FBQ0E7QUFDQSxjQUFjO0FBQ2Q7QUFDQSxjQUFjO0FBQ2Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGVBQWU7QUFDZjtBQUNBO0FBQ0EsZUFBZTtBQUNmO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVB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d2VicGFjazovL0NpdGF0aW9uRXh0cmFjdG9yLy4vZXh0ZW5zaW9uL2Jhc2UvY29yZS9nZW5lcmFsaXplX2RhdGFfdXRpbHMubWpzPzRhOTYiXSwic291cmNlc0NvbnRlbnQiOlsiLypcbk1JVCBMaWNlbnNlXG5cbkNvcHlyaWdodCAoYykgMjAyMCBSb2JlcnQgTSBQYXZleVxuXG5QZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYSBjb3B5XG5vZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSBcIlNvZnR3YXJlXCIpLCB0byBkZWFsXG5pbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzXG50byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsXG5jb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXNcbmZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6XG5cblRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkIGluIGFsbFxuY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS5cblxuVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEIFwiQVMgSVNcIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUlxuSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksXG5GSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEVcbkFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVJcbkxJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sXG5PVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOIFRIRVxuU09GVFdBUkUuXG4qL1xuXG5pbXBvcnQgeyBDRCB9IGZyb20gXCIuL2NvdW50cnlfZGF0YS5tanNcIjtcbmltcG9ydCB7IFJDIH0gZnJvbSBcIi4vcmVjb3JkX2NvbGxlY3Rpb25zLm1qc1wiO1xuaW1wb3J0IHsgV1RTX1N0cmluZyB9IGZyb20gXCIuL3d0c19zdHJpbmcubWpzXCI7XG5pbXBvcnQgeyBXVFNfRGF0ZSB9IGZyb20gXCIuL3d0c19kYXRlLm1qc1wiO1xuaW1wb3J0IHsgUlQsIFJlY29yZFN1YnR5cGUsIFJvbGUgfSBmcm9tIFwiLi9yZWNvcmRfdHlwZS5tanNcIjtcblxuY29uc3QgcG9zc2libGVMaWZlU3BhbiA9IDEyMDtcblxuY29uc3QgZGF0ZVF1YWxpZmllcnMgPSB7XG4gIE5PTkU6IDAsXG4gIEVYQUNUOiAxLFxuICBBQk9VVDogMixcbiAgQkVGT1JFOiAzLFxuICBBRlRFUjogNCxcbn07XG5cbmNvbnN0IEdEID0ge1xuICBleHRyYWN0WWVhclN0cmluZ0Zyb21EYXRlU3RyaW5nOiBmdW5jdGlvbiAoZGF0ZSkge1xuICAgIHZhciByZXN1bHQgPSB1bmRlZmluZWQ7XG4gICAgaWYgKGRhdGUgIT0gdW5kZWZpbmVkICYmIGRhdGUgIT0gXCJcIikge1xuICAgICAgY29uc3QgeWVhciA9IGRhdGUucmVwbGFjZSgvXi4qKFxcZFxcZFxcZFxcZCkkLywgXCIkMVwiKTtcbiAgICAgIGlmICh5ZWFyLmxlbmd0aCA9PSA0KSB7XG4gICAgICAgIHJlc3VsdCA9IHllYXI7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG4gIH0sXG5cbiAgZXh0cmFjdFllYXJOdW1Gcm9tRGF0ZVN0cmluZzogZnVuY3Rpb24gKGRhdGUpIHtcbiAgICB2YXIgcmVzdWx0ID0gMDtcbiAgICBsZXQgeWVhclN0cmluZyA9IGV4dHJhY3RZZWFyU3RyaW5nRnJvbURhdGVTdHJpbmcoZGF0ZSk7XG4gICAgaWYgKHllYXJTdHJpbmcpIHtcbiAgICAgIHZhciB5ZWFyTnVtID0gcGFyc2VJbnQoeWVhclN0cmluZyk7XG4gICAgICBpZiAoeWVhck51bSA9PSBOYU4pIHtcbiAgICAgICAgeWVhck51bSA9IDA7XG4gICAgICB9XG4gICAgICByZXN1bHQgPSB5ZWFyTnVtO1xuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9LFxuXG4gIHN0YW5kYXJkaXplR2VuZGVyOiBmdW5jdGlvbiAoc3RyaW5nKSB7XG4gICAgaWYgKCFzdHJpbmcpIHtcbiAgICAgIHJldHVybiBcIlwiO1xuICAgIH1cbiAgICBsZXQgbGMgPSBzdHJpbmcudG9Mb3dlckNhc2UoKTtcbiAgICBpZiAobGMgPT0gXCJtYWxlXCIgfHwgbGMgPT0gXCJtXCIgfHwgbGMgPT0gXCJtIChtYWxlKVwiKSB7XG4gICAgICByZXR1cm4gXCJtYWxlXCI7XG4gICAgfVxuICAgIGlmIChsYyA9PSBcImZlbWFsZVwiIHx8IGxjID09IFwiZlwiIHx8IGxjID09IFwiZiAoZmVtYWxlKVwiKSB7XG4gICAgICByZXR1cm4gXCJmZW1hbGVcIjtcbiAgICB9XG4gICAgaWYgKGxjLnN0YXJ0c1dpdGgoXCJtXCIpKSB7XG4gICAgICByZXR1cm4gXCJtYWxlXCI7XG4gICAgfVxuICAgIGlmIChsYy5zdGFydHNXaXRoKFwiZlwiKSkge1xuICAgICAgcmV0dXJuIFwiZmVtYWxlXCI7XG4gICAgfVxuICAgIHJldHVybiBcIlwiO1xuICB9LFxuXG4gIHN0YW5kYXJkaXplTWFyaXRhbFN0YXR1czogZnVuY3Rpb24gKHN0cmluZykge1xuICAgIGlmICghc3RyaW5nKSB7XG4gICAgICByZXR1cm4gXCJcIjtcbiAgICB9XG4gICAgbGV0IGxjID0gc3RyaW5nLnRvTG93ZXJDYXNlKCk7XG4gICAgaWYgKGxjID09IFwibWFycmllZFwiIHx8IGxjID09IFwibVwiIHx8IGxjLnN0YXJ0c1dpdGgoXCJtYXJcIikpIHtcbiAgICAgIHJldHVybiBcIm1hcnJpZWRcIjtcbiAgICB9XG4gICAgaWYgKFxuICAgICAgbGMgPT0gXCJzaW5nbGVcIiB8fFxuICAgICAgbGMgPT0gXCJzXCIgfHxcbiAgICAgIGxjID09IFwidW5tYXJyaWVkXCIgfHxcbiAgICAgIGxjID09IFwidVwiIHx8XG4gICAgICBsYy5zdGFydHNXaXRoKFwidW5tXCIpIHx8XG4gICAgICBsYy5zdGFydHNXaXRoKFwic2luXCIpIHx8XG4gICAgICBsYy5zdGFydHNXaXRoKFwibmV2XCIpXG4gICAgKSB7XG4gICAgICByZXR1cm4gXCJzaW5nbGVcIjtcbiAgICB9XG4gICAgaWYgKGxjID09IFwid2lkb3dlZFwiIHx8IGxjID09IFwid1wiIHx8IGxjID09IFwid2RcIiB8fCBsYy5zdGFydHNXaXRoKFwid2lkXCIpKSB7XG4gICAgICByZXR1cm4gXCJ3aWRvd2VkXCI7XG4gICAgfVxuICAgIGlmIChsYyA9PSBcImRpdm9yY2VkXCIgfHwgbGMgPT0gXCJkXCIgfHwgbGMuc3RhcnRzV2l0aChcImRpdlwiKSkge1xuICAgICAgcmV0dXJuIFwiZGl2b3JjZWRcIjtcbiAgICB9XG4gICAgaWYgKGxjID09IFwic2VwYXJhdGVkXCIgfHwgbGMuc3RhcnRzV2l0aChcInNlcFwiKSkge1xuICAgICAgcmV0dXJuIFwic2VwYXJhdGVkXCI7XG4gICAgfVxuICAgIC8vIE5vdGUgdGhhdCBcIi1cIiBpcyB0dXJuZWQgaW50byBcIlwiLCB0aGlzIGlzIHR5cGljYWwgb24gc29tZSBzaXRlIGZvciB5b3VuZyBjaGlsZHJlblxuICAgIHJldHVybiBcIlwiO1xuICB9LFxuXG4gIHN0YW5kYXJkaXplUmVsYXRpb25zaGlwVG9IZWFkOiBmdW5jdGlvbiAoc3RyaW5nKSB7XG4gICAgaWYgKCFzdHJpbmcpIHtcbiAgICAgIHJldHVybiBcIlwiO1xuICAgIH1cblxuICAgIGNvbnN0IGV4YWN0TWFwID0ge1xuICAgICAgaGVhZDogXCJoZWFkXCIsXG4gICAgICBodXNiYW5kOiBcImh1c2JhbmRcIixcbiAgICAgIGh1c2JuZDogXCJodXNiYW5kXCIsXG4gICAgICBzZWxmOiBcImhlYWRcIixcbiAgICAgIFwic2VsZiAoaGVhZClcIjogXCJoZWFkXCIsXG4gICAgICB3aWZlOiBcIndpZmVcIixcbiAgICAgIHc6IFwid2lmZVwiLFxuICAgICAgLy8gY2hpbGRyZW5cbiAgICAgIHNvbjogXCJzb25cIixcbiAgICAgIHM6IFwic29uXCIsXG4gICAgICBkYXVnaHRlcjogXCJkYXVnaHRlclwiLFxuICAgICAgZGF1OiBcImRhdWdodGVyXCIsXG4gICAgICBkOiBcImRhdWdodGVyXCIsXG4gICAgICAvLyBzdGVwIGNoaWxkcmVuXG4gICAgICBzdGVwZGF1Z2h0ZXI6IFwic3RlcGRhdWdodGVyXCIsXG4gICAgICBcInN0ZXAtZGF1Z2h0ZXJcIjogXCJzdGVwZGF1Z2h0ZXJcIixcbiAgICAgIFwic3RlcCBkYXVnaHRlclwiOiBcInN0ZXBkYXVnaHRlclwiLFxuICAgICAgXCJzdGVwLWRhdVwiOiBcInN0ZXBkYXVnaHRlclwiLFxuICAgICAgXCJzdGVwIGRhdVwiOiBcInN0ZXBkYXVnaHRlclwiLFxuICAgICAgc3RlcGRhdTogXCJzdGVwZGF1Z2h0ZXJcIixcbiAgICAgIHN0cGRhdTogXCJzdGVwZGF1Z2h0ZXJcIixcbiAgICAgIFwic3RlcC1kXCI6IFwic3RlcGRhdWdodGVyXCIsXG4gICAgICBcInN0ZXAgZFwiOiBcInN0ZXBkYXVnaHRlclwiLFxuXG4gICAgICBzdGVwc29uOiBcInN0ZXBzb25cIixcbiAgICAgIFwic3RlcC1zb25cIjogXCJzdGVwc29uXCIsXG4gICAgICBcInN0ZXAgc29uXCI6IFwic3RlcHNvblwiLFxuICAgICAgc3Rwc29uOiBcInN0ZXBzb25cIixcbiAgICAgIFwic3RlcC1zXCI6IFwic3RlcHNvblwiLFxuICAgICAgXCJzdGVwIHNcIjogXCJzdGVwc29uXCIsXG5cbiAgICAgIFwic3RlcC1jaGlsZFwiOiBcInN0ZXBjaGlsZFwiLFxuICAgICAgXCJzdGVwIGNoaWxkXCI6IFwic3RlcGNoaWxkXCIsXG4gICAgICBzdGVwY2hpbGQ6IFwic3RlcGNoaWxkXCIsXG4gICAgICAvLyBpbi1sYXcgY2hpbGRyZW5cbiAgICAgIFwiZGF1Z2h0ZXItaW4tbGF3XCI6IFwiZGF1Z2h0ZXItaW4tbGF3XCIsXG4gICAgICBcImRhdS1pbi1sYXdcIjogXCJkYXVnaHRlci1pbi1sYXdcIixcbiAgICAgIGRhdWxhdzogXCJkYXVnaHRlci1pbi1sYXdcIixcbiAgICAgIFwic29uLWluLWxhd1wiOiBcInNvbi1pbi1sYXdcIixcbiAgICAgIHNvbmxhdzogXCJzb24taW4tbGF3XCIsXG5cbiAgICAgIC8vIGdyYW5kY2hpbGRyZW5cbiAgICAgIGdyYW5kY2hpbGQ6IFwiZ3JhbmRjaGlsZFwiLFxuICAgICAgZ3JhbmRkYXVnaHRlcjogXCJncmFuZGRhdWdodGVyXCIsXG4gICAgICBncm5kYXU6IFwiZ3JhbmRkYXVnaHRlclwiLFxuICAgICAgZ3JhbmRzb246IFwiZ3JhbmRzb25cIixcbiAgICAgIGdybnNvbjogXCJncmFuZHNvblwiLFxuICAgICAgLy8gcGFyZW50c1xuICAgICAgZmF0aGVyOiBcImZhdGhlclwiLFxuICAgICAgbW90aGVyOiBcIm1vdGhlclwiLFxuICAgICAgLy8gaW4tbGF3IHBhcmVudHNcbiAgICAgIFwiZmF0aGVyLWluLWxhd1wiOiBcImZhdGhlci1pbi1sYXdcIixcbiAgICAgIFwiZmEtbGF3XCI6IFwiZmF0aGVyLWluLWxhd1wiLFxuICAgICAgXCJtb3RoZXItaW4tbGF3XCI6IFwibW90aGVyLWluLWxhd1wiLFxuICAgICAgXCJtYS1sYXdcIjogXCJtb3RoZXItaW4tbGF3XCIsXG4gICAgICAvLyBzdGVwIHBhcmVudHNcbiAgICAgIHN0ZXBmYXRoZXI6IFwic3RlcGZhdGhlclwiLFxuICAgICAgXCJzdGVwLWZhdGhlclwiOiBcInN0ZXBmYXRoZXJcIixcbiAgICAgIHN0cGRhZDogXCJzdGVwZmF0aGVyXCIsXG4gICAgICBzdGVwcGE6IFwic3RlcGZhdGhlclwiLFxuICAgICAgc3RwcGE6IFwic3RlcGZhdGhlclwiLFxuICAgICAgc3RlcG1vdGhlcjogXCJzdGVwbW90aGVyXCIsXG4gICAgICBcInN0ZXAtbW90aGVyXCI6IFwic3RlcG1vdGhlclwiLFxuICAgICAgc3RwbXVtOiBcInN0ZXBtb3RoZXJcIixcbiAgICAgIHN0ZXBtYTogXCJzdGVwbW90aGVyXCIsXG4gICAgICBzdHBtYTogXCJzdGVwbW90aGVyXCIsXG4gICAgICAvLyBncmFuZHBhcmVudHNcbiAgICAgIGdyYW5kZmF0aGVyOiBcImdyYW5kZmF0aGVyXCIsXG4gICAgICBncmFucGE6IFwiZ3JhbmRmYXRoZXJcIixcbiAgICAgIGdyYW5kbW90aGVyOiBcImdyYW5kbW90aGVyXCIsXG4gICAgICBncmFubWE6IFwiZ3JhbmRtb3RoZXJcIixcblxuICAgICAgLy8gc2libGluZ3NcbiAgICAgIGJyb3RoZXI6IFwiYnJvdGhlclwiLFxuICAgICAgYnJvdGhyOiBcImJyb3RoZXJcIixcbiAgICAgIHNpc3RlcjogXCJzaXN0ZXJcIixcbiAgICAgIFwiYnJvdGhlci1pbi1sYXdcIjogXCJicm90aGVyLWluLWxhd1wiLFxuICAgICAgXCJicm90aGVyIGluIGxhd1wiOiBcImJyb3RoZXItaW4tbGF3XCIsXG4gICAgICBicm9sYXc6IFwiYnJvdGhlci1pbi1sYXdcIixcbiAgICAgIFwiaGFsZiBicm90aGVyXCI6IFwiaGFsZiBicm90aGVyXCIsXG4gICAgICBobGZicm86IFwiaGFsZiBicm90aGVyXCIsXG4gICAgICBcImhhbGYgc2lzdGVyXCI6IFwiaGFsZiBzaXN0ZXJcIixcbiAgICAgIGhsZnNpczogXCJoYWxmIHNpc3RlclwiLFxuICAgICAgXCJzaXN0ZXItaW4tbGF3XCI6IFwic2lzdGVyLWluLWxhd1wiLFxuICAgICAgXCJzaXN0ZXIgaW4gbGF3XCI6IFwic2lzdGVyLWluLWxhd1wiLFxuICAgICAgc2lzbGF3OiBcInNpc3Rlci1pbi1sYXdcIixcbiAgICAgIHN0ZXBicm90aGVyOiBcInN0ZXBicm90aGVyXCIsXG4gICAgICBcInN0ZXAtYnJvdGhlclwiOiBcInN0ZXBicm90aGVyXCIsXG4gICAgICBzdHBicm86IFwic3RlcGJyb3RoZXJcIixcbiAgICAgIHN0ZXBzaXN0ZXI6IFwic3RlcHNpc3RlclwiLFxuICAgICAgXCJzdGVwLXNpc3RlclwiOiBcInN0ZXBzaXN0ZXJcIixcbiAgICAgIHN0cHNpczogXCJzdGVwc2lzdGVyXCIsXG4gICAgICAvLyBvdGhlciBmYW1pbHlcbiAgICAgIGF1bnQ6IFwiYXVudFwiLFxuICAgICAgY291c2luOiBcImNvdXNpblwiLFxuICAgICAgXCJncmVhdCBhdW50XCI6IFwiZ3JlYXQgYXVudFwiLFxuICAgICAgZ3RhdW50OiBcImdyZWF0IGF1bnRcIixcbiAgICAgIFwiZ3JlYXQgdW5jbGVcIjogXCJncmVhdCB1bmNsZVwiLFxuICAgICAgZ3R1bmNsOiBcImdyZWF0IHVuY2xlXCIsXG4gICAgICBuaWVjZTogXCJuaWVjZVwiLFxuICAgICAgbmVwaGV3OiBcIm5lcGhld1wiLFxuICAgICAgdW5jbGU6IFwidW5jbGVcIixcbiAgICAgIC8vIG90aGVyIHJlbGF0aW9uc2hpcHNcbiAgICAgIGFwcHJlbnRpY2U6IFwiYXBwcmVudGljZVwiLFxuICAgICAgYXBwcmVuOiBcImFwcHJlbnRpY2VcIixcbiAgICAgIGFzc2lzdGFudDogXCJhc3Npc3RhbnRcIixcbiAgICAgIGFzc3RudDogXCJhc3Npc3RhbnRcIixcbiAgICAgIGJvYXJkZXI6IFwiYm9hcmRlclwiLFxuICAgICAgYm9hcmRyOiBcImJvYXJkZXJcIixcbiAgICAgIGdvdmVybmVzczogXCJnb3Zlcm5lc3NcIixcbiAgICAgIGd2cm5zczogXCJnb3Zlcm5lc3NcIixcbiAgICAgIGlubWF0ZTogXCJpbm1hdGVcIixcbiAgICAgIGxvZGdlcjogXCJsb2RnZXJcIixcbiAgICAgIG1pc3RyZXNzOiBcIm1pc3RyZXNzXCIsXG4gICAgICBtc3RyZXM6IFwibWlzdHJlc3NcIixcbiAgICAgIFwibnVyc2UgY2hpbGRcIjogXCJudXJzZSBjaGlsZFwiLFxuICAgICAgXCJucnMtY2hcIjogXCJudXJzZSBjaGlsZFwiLFxuICAgICAgcGF0aWVudDogXCJwYXRpZW50XCIsXG4gICAgICBwdGllbnQ6IFwicGF0aWVudFwiLFxuICAgICAgcHJpc29uZXI6IFwicHJpc29uZXJcIixcbiAgICAgIHByaXNucjogXCJwcmlzb25lclwiLFxuICAgICAgcHVwaWw6IFwicHVwaWxcIixcbiAgICAgIHJlbGF0aXZlOiBcInJlbGF0aXZlXCIsXG4gICAgICByZWx0aXY6IFwicmVsYXRpdmVcIixcbiAgICAgIHNjaG9sYXI6IFwic2Nob2xhclwiLFxuICAgICAgc2VydmFudDogXCJzZXJ2YW50XCIsXG4gICAgICBzZXJ2bnQ6IFwic2VydmFudFwiLFxuICAgICAgc2VydjogXCJzZXJ2YW50XCIsXG4gICAgICBzdHJhbmdlcjogXCJzdHJhbmdlclwiLFxuICAgICAgc3RybmdyOiBcInN0cmFuZ2VyXCIsXG4gICAgICB0cmF2ZWxsZXI6IFwidHJhdmVsbGVyXCIsXG4gICAgICB0cnZlbHI6IFwidHJhdmVsbGVyXCIsXG4gICAgICB2aXNpdG9yOiBcInZpc2l0b3JcIixcbiAgICAgIHZpc2l0cjogXCJ2aXNpdG9yXCIsXG5cbiAgICAgIFwid2lmZSdzIGRhdWdodGVyXCI6IFwid2lmZSdzIGRhdWdodGVyXCIsXG4gICAgICBcIndpZmUncyBkYXVcIjogXCJ3aWZlJ3MgZGF1Z2h0ZXJcIixcbiAgICAgIHdpZmRhdTogXCJ3aWZlJ3MgZGF1Z2h0ZXJcIixcbiAgICAgIFwid2lmZSdzIG1vdGhlclwiOiBcIndpZmUncyBtb3RoZXJcIixcbiAgICAgIFwid2lmLW1hXCI6IFwid2lmZSdzIG1vdGhlclwiLFxuICAgICAgXCJ3aWZlJ3Mgc29uXCI6IFwid2lmZSdzIHNvblwiLFxuICAgICAgd2lmc29uOiBcIndpZmUncyBzb25cIixcbiAgICB9O1xuXG4gICAgLy8gYWxsb3dzIGZvciB0cmFuc2NyaXB0aW9uIGVycm9ycyBhbHNvIChsaWtlIFwiTWVhZFwiIGZvciBoZWFkKVxuICAgIGNvbnN0IGZ1enp5TGlzdCA9IFtcbiAgICAgIHsgc3RhbmRhcmQ6IFwiaGVhZFwiLCBzdGFydHM6IFtcImhlYWRcIiwgXCJtZWFkXCJdLCBub3RDb250YWluczogW1wibWFzdGVyXCJdIH0sXG5cbiAgICAgIC8vIHRoZXNlIG1vcmUgZnV6enkgb25lcyBzaG91bGQgY29tZSBsYXN0XG4gICAgICB7XG4gICAgICAgIHN0YW5kYXJkOiBcImRhdWdodGVyXCIsXG4gICAgICAgIHN0YXJ0czogW1wiZGF1XCJdLFxuICAgICAgICBub3RDb250YWluczogW1wic3RlcFwiLCBcImxhd1wiLCBcIi1cIiwgXCIgXCJdLFxuICAgICAgfSxcbiAgICAgIHsgc3RhbmRhcmQ6IFwic3RlcC1kYXVnaHRlclwiLCBzdGFydHM6IFtcImRhdVwiXSwgYW5kQ29udGFpbnM6IFtcInN0ZXBcIl0gfSxcbiAgICAgIHsgc3RhbmRhcmQ6IFwic3RlcC1kYXVnaHRlclwiLCBzdGFydHM6IFtcInN0ZXBcIl0sIGFuZENvbnRhaW5zOiBbXCJkYXVcIl0gfSxcbiAgICBdO1xuXG4gICAgbGV0IGxjID0gc3RyaW5nLnRvTG93ZXJDYXNlKCk7XG5cbiAgICBsZXQgZXhhY3RWYWx1ZSA9IGV4YWN0TWFwW2xjXTtcbiAgICBpZiAoZXhhY3RWYWx1ZSkge1xuICAgICAgcmV0dXJuIGV4YWN0VmFsdWU7XG4gICAgfVxuXG4gICAgbGV0IG1hdGNoID0gXCJcIjtcbiAgICBmb3IgKGxldCBmdXp6eSBvZiBmdXp6eUxpc3QpIHtcbiAgICAgIGlmIChmdXp6eS5zdGFydHMpIHtcbiAgICAgICAgZm9yIChsZXQgc3RhcnQgb2YgZnV6enkuc3RhcnRzKSB7XG4gICAgICAgICAgaWYgKGxjLnN0YXJ0c1dpdGgoc3RhcnQpKSB7XG4gICAgICAgICAgICBtYXRjaCA9IGZ1enp5LnN0YW5kYXJkO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgICBpZiAobWF0Y2ggJiYgZnV6enkubm90Q29udGFpbnMpIHtcbiAgICAgICAgZm9yIChsZXQgY29udCBvZiBmdXp6eS5ub3RDb250YWlucykge1xuICAgICAgICAgIGlmIChsYy5pbmNsdWRlcyhjb250KSkge1xuICAgICAgICAgICAgbWF0Y2ggPSBcIlwiO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgICBpZiAobWF0Y2ggJiYgZnV6enkuYW5kQ29udGFpbnMpIHtcbiAgICAgICAgbGV0IGRvZXNDb250YWluT25lID0gZmFsc2U7XG4gICAgICAgIGZvciAobGV0IGNvbnQgb2YgZnV6enkuYW5kQ29udGFpbnMpIHtcbiAgICAgICAgICBpZiAobGMuaW5jbHVkZXMoY29udCkpIHtcbiAgICAgICAgICAgIGRvZXNDb250YWluT25lID0gdHJ1ZTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoIWRvZXNDb250YWluT25lKSB7XG4gICAgICAgICAgbWF0Y2ggPSBcIlwiO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGlmIChtYXRjaCkge1xuICAgICAgICByZXR1cm4gbWF0Y2g7XG4gICAgICB9XG4gICAgfVxuXG4gICAgY29uc29sZS5sb2coXCJzdGFuZGFyZGl6ZVJlbGF0aW9uc2hpcFRvSGVhZDogdW5yZWNvZ25pemVkOiBcIiArIGxjKTtcblxuICAgIHJldHVybiBsYztcbiAgfSxcblxuICBzdGFuZGFyZGl6ZU9jY3VwYXRpb246IGZ1bmN0aW9uIChzdHJpbmcpIHtcbiAgICAvLyB3ZSBjb3VsZCBoYW5kbGUgYWxsIHRoZSBhYmJyZXZpYXRpb25zIGhlcmU6IGh0dHBzOi8vd3d3LmZyZWVjZW4ub3JnLnVrL2Ntcy9pbmZvcm1hdGlvbi1mb3ItdHJhbnNjcmliZXJzL2FiYnJldmlhdGlvbnNcblxuICAgIGlmICghc3RyaW5nKSB7XG4gICAgICByZXR1cm4gXCJcIjtcbiAgICB9XG5cbiAgICBsZXQgbmV3VmFsdWUgPSBzdHJpbmc7XG5cbiAgICBjb25zdCBwYXJlbk1hcCA9IHtcbiAgICAgIFwiZW0nZWVcIjogXCJlbXBsb3llZVwiLFxuICAgIH07XG5cbiAgICAvLyBzZWUgaWYgdGhlcmUgaXMgYSB2YWx1ZSBpbiBwYXJlbnRoZXNlcyBhdCBlbmRcbiAgICBsZXQgbGFzdE9wZW5QYXJlbkluZGV4ID0gc3RyaW5nLmxhc3RJbmRleE9mKFwiKFwiKTtcbiAgICBpZiAobGFzdE9wZW5QYXJlbkluZGV4ICE9IC0xKSB7XG4gICAgICBsZXQgY2xvc2VQYXJlbkluZGV4ID0gc3RyaW5nLmluZGV4T2YoXCIpXCIsIGxhc3RPcGVuUGFyZW5JbmRleCk7XG4gICAgICBpZiAoY2xvc2VQYXJlbkluZGV4ICE9IC0xKSB7XG4gICAgICAgIGxldCBwYXJlblN0cmluZyA9IHN0cmluZy5zdWJzdHJpbmcobGFzdE9wZW5QYXJlbkluZGV4ICsgMSwgY2xvc2VQYXJlbkluZGV4KS50cmltKCk7XG4gICAgICAgIGxldCByZW1haW5kZXJTdHJpbmcgPSBzdHJpbmcuc3Vic3RyaW5nKGNsb3NlUGFyZW5JbmRleCArIDEpLnRyaW0oKTtcbiAgICAgICAgcGFyZW5TdHJpbmcgPSBwYXJlblN0cmluZy50b0xvd2VyQ2FzZSgpO1xuICAgICAgICBsZXQgbWF0Y2ggPSBwYXJlbk1hcFtwYXJlblN0cmluZ107XG4gICAgICAgIGlmIChtYXRjaCkge1xuICAgICAgICAgIG5ld1ZhbHVlID0gc3RyaW5nLnN1YnN0cmluZygwLCBsYXN0T3BlblBhcmVuSW5kZXgpLnRyaW0oKTtcbiAgICAgICAgICBuZXdWYWx1ZSArPSBcIiAoXCIgKyBtYXRjaCArIFwiKVwiO1xuICAgICAgICAgIGlmIChyZW1haW5kZXJTdHJpbmcpIHtcbiAgICAgICAgICAgIG5ld1ZhbHVlICs9IFwiIFwiICsgcmVtYWluZGVyU3RyaW5nO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBuZXdWYWx1ZTtcbiAgfSxcbn07XG5cbmNsYXNzIFd0c0RhdGUge1xuICBjb25zdHJ1Y3RvcigpIHtcbiAgICAvLyBGaWVsZHMgYXJlIG9ubHkgc2V0IGlmIGZyb20gdGhlIHJlY29yZC9wcm9maWxlLCBtZXRob2RzIGNhbiBpbmZlci9leHRyYWN0XG4gICAgLy8gcG9zc2libGUgZmllbGRzIGFyZTpcbiAgICAvLyBkYXRlU3RyaW5nOiB0aGUgZGF0ZSBzdHJpbmcgZnJvbSB0aGUgcmVjb3JkL3Byb2ZpbGVcbiAgICAvLyB5ZWFyU3RyaW5nOiBhIHN0cmluZywgb25seSBzZXQgaWYgdGhhdCBpcyB3aGF0IHRoZSByZWNvcmQvcHJvZmlsZSBzcGVjaWZpZXNcbiAgICAvLyBxdWFydGVyOiBhIG51bWJlciBmcm9tIDEtNFxuICAgIC8vIHF1YWxpZmllcjogdGhlIGRhdGVRdWFsaWZpZXJzIGVudW1cbiAgfVxuXG4gIHN0YXRpYyBjcmVhdGVGcm9tUGxhaW5PYmplY3Qob2JqKSB7XG4gICAgaWYgKCFvYmopIHtcbiAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgfVxuXG4gICAgbGV0IGNsYXNzT2JqID0gbmV3IFd0c0RhdGUoKTtcbiAgICBjb25zdCBrZXlzID0gT2JqZWN0LmtleXMob2JqKTtcbiAgICBmb3IgKGxldCBrZXkgb2Yga2V5cykge1xuICAgICAgY2xhc3NPYmpba2V5XSA9IG9ialtrZXldO1xuICAgIH1cblxuICAgIHJldHVybiBjbGFzc09iajtcbiAgfVxuXG4gIGdldFllYXJTdHJpbmcoKSB7XG4gICAgaWYgKHRoaXMueWVhclN0cmluZykge1xuICAgICAgcmV0dXJuIHRoaXMueWVhclN0cmluZztcbiAgICB9XG5cbiAgICBpZiAodGhpcy5kYXRlU3RyaW5nKSB7XG4gICAgICByZXR1cm4gR0QuZXh0cmFjdFllYXJTdHJpbmdGcm9tRGF0ZVN0cmluZyh0aGlzLmRhdGVTdHJpbmcpO1xuICAgIH1cbiAgfVxuXG4gIGdldERhdGVTdHJpbmcoKSB7XG4gICAgaWYgKHRoaXMuZGF0ZVN0cmluZykge1xuICAgICAgcmV0dXJuIHRoaXMuZGF0ZVN0cmluZztcbiAgICB9XG4gICAgaWYgKHRoaXMueWVhclN0cmluZykge1xuICAgICAgcmV0dXJuIHRoaXMueWVhclN0cmluZztcbiAgICB9XG4gIH1cblxuICBzZXREYXRlQW5kUXVhbGlmaWVyRnJvbVN0cmluZyhkYXRlU3RyaW5nLCBpc1llYXJTdHJpbmcpIHtcbiAgICBjb25zdCBwcmVmaXhlcyA9IFtcbiAgICAgIHsgcHJlZml4OiBcImFib3V0XCIsIHF1YWxpZmllcjogZGF0ZVF1YWxpZmllcnMuQUJPVVQgfSxcbiAgICAgIHsgcHJlZml4OiBcImFidFwiLCBxdWFsaWZpZXI6IGRhdGVRdWFsaWZpZXJzLkFCT1VUIH0sXG4gICAgICB7IHByZWZpeDogXCJhZnRlclwiLCBxdWFsaWZpZXI6IGRhdGVRdWFsaWZpZXJzLkFGVEVSIH0sIC8vIG11c3QgY29tZSBiZWZvcmUgYWZ0XG4gICAgICB7IHByZWZpeDogXCJhZnRcIiwgcXVhbGlmaWVyOiBkYXRlUXVhbGlmaWVycy5BRlRFUiB9LFxuICAgICAgeyBwcmVmaXg6IFwiYmVmb3JlXCIsIHF1YWxpZmllcjogZGF0ZVF1YWxpZmllcnMuQkVGT1JFIH0sIC8vIG11c3QgY29tZSBiZWZvcmUgYmVmXG4gICAgICB7IHByZWZpeDogXCJiZWZcIiwgcXVhbGlmaWVyOiBkYXRlUXVhbGlmaWVycy5CRUZPUkUgfSxcbiAgICBdO1xuXG4gICAgbGV0IHF1YWxpZmllciA9IGRhdGVRdWFsaWZpZXJzLk5PTkU7XG4gICAgbGV0IGxjRGF0ZVN0cmluZyA9IGRhdGVTdHJpbmcudG9Mb3dlckNhc2UoKTtcblxuICAgIGlmIChsY0RhdGVTdHJpbmcgPT0gXCJkZWNlYXNlZFwiKSB7XG4gICAgICBkYXRlU3RyaW5nID0gXCJcIjtcbiAgICAgIHF1YWxpZmllciA9IGRhdGVRdWFsaWZpZXJzLkFCT1VUO1xuICAgIH0gZWxzZSB7XG4gICAgICBmb3IgKGxldCBwcmVmaXhFbnRyeSBvZiBwcmVmaXhlcykge1xuICAgICAgICBpZiAobGNEYXRlU3RyaW5nLnN0YXJ0c1dpdGgocHJlZml4RW50cnkucHJlZml4KSkge1xuICAgICAgICAgIHF1YWxpZmllciA9IHByZWZpeEVudHJ5LnF1YWxpZmllcjtcbiAgICAgICAgICBkYXRlU3RyaW5nID0gZGF0ZVN0cmluZy5zdWJzdHJpbmcocHJlZml4RW50cnkucHJlZml4Lmxlbmd0aCkudHJpbSgpO1xuICAgICAgICAgIHdoaWxlIChkYXRlU3RyaW5nLnN0YXJ0c1dpdGgoXCIuXCIpKSB7XG4gICAgICAgICAgICBkYXRlU3RyaW5nID0gZGF0ZVN0cmluZy5zdWJzdHJpbmcoMSkudHJpbSgpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChxdWFsaWZpZXIgIT0gZGF0ZVF1YWxpZmllcnMuTk9ORSkge1xuICAgICAgdGhpcy5xdWFsaWZpZXIgPSBxdWFsaWZpZXI7XG4gICAgfVxuXG4gICAgaWYgKGlzWWVhclN0cmluZykge1xuICAgICAgdGhpcy55ZWFyU3RyaW5nID0gZGF0ZVN0cmluZztcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5kYXRlU3RyaW5nID0gZGF0ZVN0cmluZztcbiAgICB9XG4gIH1cblxuICBnZXRRdWFsaWZpZWREYXRlU3RyaW5nKGRhdGVTdHJpbmcsIHF1YWxpZmllciwgcHJlcG9zaXRpb24pIHtcbiAgICBsZXQgcHJlcCA9IFwiXCI7XG4gICAgaWYgKHByZXBvc2l0aW9uKSB7XG4gICAgICBwcmVwID0gcHJlcG9zaXRpb24gKyBcIiBcIjtcbiAgICB9XG5cbiAgICBzd2l0Y2ggKHF1YWxpZmllcikge1xuICAgICAgY2FzZSBkYXRlUXVhbGlmaWVycy5BQk9VVDpcbiAgICAgICAgcmV0dXJuIHByZXAgKyBcImFib3V0IFwiICsgZGF0ZVN0cmluZztcbiAgICAgIGNhc2UgZGF0ZVF1YWxpZmllcnMuQUZURVI6XG4gICAgICAgIHJldHVybiBcImFmdGVyIFwiICsgZGF0ZVN0cmluZztcbiAgICAgIGNhc2UgZGF0ZVF1YWxpZmllcnMuQkVGT1JFOlxuICAgICAgICByZXR1cm4gXCJiZWZvcmUgXCIgKyBkYXRlU3RyaW5nO1xuICAgIH1cblxuICAgIHJldHVybiBwcmVwICsgZGF0ZVN0cmluZztcbiAgfVxuXG4gIGdldEZvcm1hdHRlZFN0cmluZ0ZvckNpdGF0aW9uT3JOYXJyYXRpdmUoZm9ybWF0LCBoaWdobGlnaHRPcHRpb24sIGFkZFByZXBvc2l0aW9uLCBwcmVwU3VmZml4ID0gXCJcIikge1xuICAgIGxldCBkYXRlU3RyaW5nID0gdGhpcy5nZXREYXRlU3RyaW5nKCk7XG4gICAgbGV0IHF1YWxpZmllciA9IHRoaXMucXVhbGlmaWVyO1xuXG4gICAgbGV0IHBhcnNlZERhdGUgPSBXVFNfRGF0ZS5wYXJzZURhdGVTdHJpbmcoZGF0ZVN0cmluZyk7XG4gICAgaWYgKCFwYXJzZWREYXRlLmlzVmFsaWQpIHtcbiAgICAgIGlmIChhZGRQcmVwb3NpdGlvbikge1xuICAgICAgICBsZXQgcHJlcG9zaXRpb24gPSBcIm9uXCI7XG4gICAgICAgIGlmIChkYXRlU3RyaW5nLmxlbmd0aCA8PSA0IHx8IC9eW2EtekEtWl0uKiQvLnRlc3QoZGF0ZVN0cmluZykpIHtcbiAgICAgICAgICBwcmVwb3NpdGlvbiA9IFwiaW5cIjtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChwcmVwU3VmZml4KSB7XG4gICAgICAgICAgcHJlcG9zaXRpb24gKz0gXCIgXCIgKyBwcmVwU3VmZml4O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLmdldFF1YWxpZmllZERhdGVTdHJpbmcoZGF0ZVN0cmluZywgcXVhbGlmaWVyLCBwcmVwb3NpdGlvbik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gdGhpcy5nZXRRdWFsaWZpZWREYXRlU3RyaW5nKGRhdGVTdHJpbmcsIHF1YWxpZmllcik7XG4gICAgICB9XG4gICAgfVxuXG4gICAgbGV0IG5ld1N0cmluZyA9IFwiXCI7XG4gICAgaWYgKGZvcm1hdCA9PSBcInNob3J0XCIpIHtcbiAgICAgIG5ld1N0cmluZyA9IFdUU19EYXRlLmdldFN0ZFNob3J0Rm9ybURhdGVTdHJpbmcocGFyc2VkRGF0ZSk7XG4gICAgfSBlbHNlIGlmIChmb3JtYXQgPT0gXCJsb25nXCIpIHtcbiAgICAgIG5ld1N0cmluZyA9IFdUU19EYXRlLmdldFN0ZExvbmdGb3JtRGF0ZVN0cmluZyhwYXJzZWREYXRlKTtcbiAgICB9IGVsc2UgaWYgKGZvcm1hdCA9PSBcInRoZU50aFwiKSB7XG4gICAgICBuZXdTdHJpbmcgPSBXVFNfRGF0ZS5nZXRTdGROdGhGb3JtRGF0ZVN0cmluZyhwYXJzZWREYXRlKTtcbiAgICB9IGVsc2UgaWYgKGZvcm1hdCA9PSBcIm1vbnRoQ29tbWFcIikge1xuICAgICAgbmV3U3RyaW5nID0gV1RTX0RhdGUuZ2V0VXNMb25nRm9ybURhdGVTdHJpbmcocGFyc2VkRGF0ZSk7XG4gICAgfSBlbHNlIGlmIChmb3JtYXQgPT0gXCJtb250aENvbW1hTnRoXCIpIHtcbiAgICAgIG5ld1N0cmluZyA9IFdUU19EYXRlLmdldFVzTnRoRm9ybURhdGVTdHJpbmcocGFyc2VkRGF0ZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnNvbGUubG9nKFwidW5rbm93biBkYXRlIGZvcm1hdDogXCIgKyBmb3JtYXQpO1xuICAgICAgbmV3U3RyaW5nID0gV1RTX0RhdGUuZ2V0U3RkTG9uZ0Zvcm1EYXRlU3RyaW5nKHBhcnNlZERhdGUpO1xuICAgIH1cblxuICAgIG5ld1N0cmluZyA9IFdUU19TdHJpbmcuaGlnaGxpZ2h0U3RyaW5nKG5ld1N0cmluZywgaGlnaGxpZ2h0T3B0aW9uKTtcblxuICAgIGxldCBwcmVwb3NpdGlvbiA9IFwib25cIjtcbiAgICBpZiAoIXBhcnNlZERhdGUuaGFzRGF5KSB7XG4gICAgICBwcmVwb3NpdGlvbiA9IFwiaW5cIjtcbiAgICB9XG5cbiAgICBpZiAocHJlcFN1ZmZpeCkge1xuICAgICAgcHJlcG9zaXRpb24gKz0gXCIgXCIgKyBwcmVwU3VmZml4O1xuICAgIH1cblxuICAgIGlmICghYWRkUHJlcG9zaXRpb24pIHtcbiAgICAgIHByZXBvc2l0aW9uID0gXCJcIjtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5nZXRRdWFsaWZpZWREYXRlU3RyaW5nKG5ld1N0cmluZywgcXVhbGlmaWVyLCBwcmVwb3NpdGlvbik7XG4gIH1cblxuICBnZXROYXJyYXRpdmVGb3JtYXQoZm9ybWF0LCBoaWdobGlnaHRPcHRpb24sIGFkZFByZXBvc2l0aW9uLCBwcmVwU3VmZml4ID0gXCJcIikge1xuICAgIHJldHVybiB0aGlzLmdldEZvcm1hdHRlZFN0cmluZ0ZvckNpdGF0aW9uT3JOYXJyYXRpdmUoZm9ybWF0LCBoaWdobGlnaHRPcHRpb24sIGFkZFByZXBvc2l0aW9uLCBwcmVwU3VmZml4KTtcbiAgfVxuXG4gIGdldERhdGFTdHJpbmdGb3JtYXQoYWRkUHJlcG9zaXRpb24sIHByZXBTdWZmaXggPSBcIlwiKSB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0Rm9ybWF0dGVkU3RyaW5nRm9yQ2l0YXRpb25Pck5hcnJhdGl2ZShcInNob3J0XCIsIFwibm9uZVwiLCBhZGRQcmVwb3NpdGlvbiwgcHJlcFN1ZmZpeCk7XG4gIH1cbn1cblxuLy8gTk9URTogSXMgTG9jYXRpb24gb2YgUGxhY2UgdGhlIGJlc3QgdGVybT8gQWxsIHRoZSBzaXRlcyAoaW5jbHVkaW5nIHdpa2l0cmVlKSB1c2UgXCJQbGFjZVwiXG5jbGFzcyBXdHNQbGFjZSB7XG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIC8vIEZpZWxkcyBhcmUgb25seSBzZXQgaWYgZnJvbSB0aGUgcmVjb3JkL3Byb2ZpbGUsIG1ldGhvZHMgY2FuIGluZmVyL2V4dHJhY3RcbiAgICAvLyBwb3NzaWJsZSBmaWVsZHMgYXJlOlxuICAgIC8vIHBsYWNlU3RyaW5nOiB0aGUgcGxhY2Ugc3RyaW5nIGZyb20gdGhlIHJlY29yZC9wcm9maWxlXG4gICAgLy8gY291bnRyeTogYSBzdHJpbmcsIG9ubHkgc2V0IGlmIHRoYXQgaXMgd2hhdCB0aGUgcmVjb3JkL3Byb2ZpbGUgc3BlY2lmaWVzXG4gICAgLy8gcXVhbGlmaWVyOiB0aGUgcGxhY2VRdWFsaWZpZXJzIGVudW1cbiAgfVxuXG4gIHN0YXRpYyBjcmVhdGVGcm9tUGxhaW5PYmplY3Qob2JqKSB7XG4gICAgaWYgKCFvYmopIHtcbiAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgfVxuXG4gICAgbGV0IGNsYXNzT2JqID0gbmV3IFd0c1BsYWNlKCk7XG4gICAgY29uc3Qga2V5cyA9IE9iamVjdC5rZXlzKG9iaik7XG4gICAgZm9yIChsZXQga2V5IG9mIGtleXMpIHtcbiAgICAgIGNsYXNzT2JqW2tleV0gPSBvYmpba2V5XTtcbiAgICB9XG5cbiAgICByZXR1cm4gY2xhc3NPYmo7XG4gIH1cblxuICBzZXBhcmF0ZVBsYWNlSW50b1BhcnRzKCkge1xuICAgIC8vIGl0IGNhbiBiZSBoYXJkIHRvIGdldCB0aGUgY291bnR5IGZyb20gdGhlIHN0cmluZy5cbiAgICBsZXQgY291bnRyeSA9IHVuZGVmaW5lZDtcbiAgICBsZXQgcGxhY2VOYW1lTWludXNDb3VudHJ5ID0gdGhpcy5wbGFjZVN0cmluZztcblxuICAgIGxldCByZXN1bHQgPSB7fTtcblxuICAgIGlmICghcGxhY2VOYW1lTWludXNDb3VudHJ5KSB7XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cblxuICAgIGxldCBjb3VudHJ5RXh0cmFjdCA9IENELmV4dHJhY3RDb3VudHJ5RnJvbVBsYWNlTmFtZSh0aGlzLnBsYWNlU3RyaW5nKTtcbiAgICBpZiAoY291bnRyeUV4dHJhY3QpIHtcbiAgICAgIGNvdW50cnkgPSBjb3VudHJ5RXh0cmFjdC5jb3VudHJ5O1xuICAgICAgcGxhY2VOYW1lTWludXNDb3VudHJ5ID0gY291bnRyeUV4dHJhY3QucmVtYWluZGVyO1xuXG4gICAgICBpZiAoY291bnRyeS5oYXNTdGF0ZXMpIHtcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgIH1cblxuICAgICAgcmVzdWx0LmNvdW50cnkgPSBjb3VudHJ5LnN0ZE5hbWU7XG4gICAgfVxuXG4gICAgbGV0IHBsYWNlTmFtZU1pbnVzQ291bnR5ID0gXCJcIjtcblxuICAgIGxldCBwb3NzaWJsZUNvdW50eU5hbWUgPSB1bmRlZmluZWQ7XG4gICAgbGV0IGxhc3RDb21tYUluZGV4ID0gcGxhY2VOYW1lTWludXNDb3VudHJ5Lmxhc3RJbmRleE9mKFwiLFwiKTtcbiAgICBpZiAobGFzdENvbW1hSW5kZXggIT0gLTEpIHtcbiAgICAgIHBvc3NpYmxlQ291bnR5TmFtZSA9IHBsYWNlTmFtZU1pbnVzQ291bnRyeS5zdWJzdHJpbmcobGFzdENvbW1hSW5kZXggKyAxKS50cmltKCk7XG4gICAgICBwbGFjZU5hbWVNaW51c0NvdW50eSA9IHBsYWNlTmFtZU1pbnVzQ291bnRyeS5zdWJzdHJpbmcoMCwgbGFzdENvbW1hSW5kZXgpLnRyaW0oKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcG9zc2libGVDb3VudHlOYW1lID0gcGxhY2VOYW1lTWludXNDb3VudHJ5O1xuICAgIH1cblxuICAgIHJlc3VsdC5sb2NhbFBsYWNlID0gcGxhY2VOYW1lTWludXNDb3VudHJ5O1xuICAgIGlmIChjb3VudHJ5KSB7XG4gICAgICBsZXQgc3RkQ291bnR5TmFtZSA9IENELnN0YW5kYXJkaXplQ291bnR5TmFtZUZvckNvdW50cnkocG9zc2libGVDb3VudHlOYW1lLCBjb3VudHJ5KTtcbiAgICAgIGlmIChzdGRDb3VudHlOYW1lKSB7XG4gICAgICAgIHJlc3VsdC5jb3VudHkgPSBzdGRDb3VudHlOYW1lO1xuICAgICAgICByZXN1bHQubG9jYWxQbGFjZSA9IHBsYWNlTmFtZU1pbnVzQ291bnR5O1xuICAgICAgfSBlbHNlIGlmIChwb3NzaWJsZUNvdW50eU5hbWUpIHtcbiAgICAgICAgLy8gaXQgaXMgcG9zc2libGUgdGhhdCB0aGUgY291bnR5IG5hbWUgaGFzIGEgY29tbWEgaW4gaW4gbGlrZSBcIllvcmtzaGlyZSwgRWFzdCBSaWRpbmdcIlxuICAgICAgICBsZXQgbGFzdENvbW1hSW5kZXggPSBwbGFjZU5hbWVNaW51c0NvdW50eS5sYXN0SW5kZXhPZihcIixcIik7XG4gICAgICAgIGlmIChsYXN0Q29tbWFJbmRleCAhPSAtMSkge1xuICAgICAgICAgIGxldCBwb3NzaWJsZUV4dHJhQ291bnR5TmFtZSA9IHBsYWNlTmFtZU1pbnVzQ291bnR5LnN1YnN0cmluZyhsYXN0Q29tbWFJbmRleCArIDEpLnRyaW0oKTtcbiAgICAgICAgICBpZiAocG9zc2libGVFeHRyYUNvdW50eU5hbWUpIHtcbiAgICAgICAgICAgIGxldCBjb21iaW5lZE5hbWUgPSBwb3NzaWJsZUV4dHJhQ291bnR5TmFtZSArIFwiLCBcIiArIHBvc3NpYmxlQ291bnR5TmFtZTtcbiAgICAgICAgICAgIHN0ZENvdW50eU5hbWUgPSBDRC5zdGFuZGFyZGl6ZUNvdW50eU5hbWVGb3JDb3VudHJ5KGNvbWJpbmVkTmFtZSwgY291bnRyeSk7XG4gICAgICAgICAgICBpZiAoc3RkQ291bnR5TmFtZSkge1xuICAgICAgICAgICAgICBwbGFjZU5hbWVNaW51c0NvdW50eSA9IHBsYWNlTmFtZU1pbnVzQ291bnR5LnN1YnN0cmluZygwLCBsYXN0Q29tbWFJbmRleCkudHJpbSgpO1xuICAgICAgICAgICAgICByZXN1bHQuY291bnR5ID0gc3RkQ291bnR5TmFtZTtcbiAgICAgICAgICAgICAgcmVzdWx0LmxvY2FsUGxhY2UgPSBwbGFjZU5hbWVNaW51c0NvdW50eTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgaW5mZXJDb3VudHkoKSB7XG4gICAgaWYgKHRoaXMuY291bnR5KSB7XG4gICAgICByZXR1cm4gdGhpcy5jb3VudHk7XG4gICAgfVxuXG4gICAgaWYgKCF0aGlzLnBsYWNlU3RyaW5nKSB7XG4gICAgICByZXR1cm4gXCJcIjtcbiAgICB9XG5cbiAgICAvLyBpdCBjYW4gYmUgaGFyZCB0byBnZXQgdGhlIGNvdW50eSBmcm9tIHRoZSBzdHJpbmcuXG4gICAgbGV0IGNvdW50cnkgPSB1bmRlZmluZWQ7XG4gICAgbGV0IHBsYWNlTmFtZU1pbnVzQ291bnRyeSA9IHRoaXMucGxhY2VTdHJpbmc7XG5cbiAgICBsZXQgY291bnRyeUV4dHJhY3QgPSBDRC5leHRyYWN0Q291bnRyeUZyb21QbGFjZU5hbWUodGhpcy5wbGFjZVN0cmluZyk7XG4gICAgaWYgKGNvdW50cnlFeHRyYWN0KSB7XG4gICAgICBjb3VudHJ5ID0gY291bnRyeUV4dHJhY3QuY291bnRyeTtcbiAgICAgIHBsYWNlTmFtZU1pbnVzQ291bnRyeSA9IGNvdW50cnlFeHRyYWN0LnJlbWFpbmRlcjtcblxuICAgICAgaWYgKGNvdW50cnkuaGFzU3RhdGVzKSB7XG4gICAgICAgIHJldHVybiBcIlwiO1xuICAgICAgfVxuICAgIH1cblxuICAgIGxldCBjb3VudHlOYW1lID0gdW5kZWZpbmVkO1xuICAgIGxldCBsYXN0Q29tbWFJbmRleCA9IHBsYWNlTmFtZU1pbnVzQ291bnRyeS5sYXN0SW5kZXhPZihcIixcIik7XG4gICAgaWYgKGxhc3RDb21tYUluZGV4ICE9IC0xKSB7XG4gICAgICBjb3VudHlOYW1lID0gcGxhY2VOYW1lTWludXNDb3VudHJ5LnN1YnN0cmluZyhsYXN0Q29tbWFJbmRleCArIDEpLnRyaW0oKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY291bnR5TmFtZSA9IHBsYWNlTmFtZU1pbnVzQ291bnRyeTtcbiAgICB9XG5cbiAgICBpZiAoY291bnRyeSkge1xuICAgICAgbGV0IHN0ZENvdW50eU5hbWUgPSBDRC5zdGFuZGFyZGl6ZUNvdW50eU5hbWVGb3JDb3VudHJ5KGNvdW50eU5hbWUsIGNvdW50cnkpO1xuICAgICAgaWYgKHN0ZENvdW50eU5hbWUpIHtcbiAgICAgICAgcmV0dXJuIHN0ZENvdW50eU5hbWU7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgaW5mZXJUb3duKCkge1xuICAgIC8vIGl0IGNhbiBiZSBoYXJkIHRvIGdldCB0aGUgY291bnR5IGZyb20gdGhlIHN0cmluZywgdGhlIHRvd24gaXMgaGFyZGVyXG4gICAgLy8gdGhpcyBpcyBub3QgYWx3YXlzIGdvaW5nIHRvIHdvcmsgYnV0IGNhbiBiZSB1c2VmdWwgaWYgeW91IGNhbiBjaGVjayBpdCBsYXRlclxuICAgIGxldCBjb3VudHJ5ID0gdW5kZWZpbmVkO1xuICAgIGxldCBwbGFjZU5hbWVNaW51c0NvdW50cnkgPSB0aGlzLnBsYWNlU3RyaW5nO1xuXG4gICAgbGV0IGNvdW50cnlFeHRyYWN0ID0gQ0QuZXh0cmFjdENvdW50cnlGcm9tUGxhY2VOYW1lKHRoaXMucGxhY2VTdHJpbmcpO1xuICAgIGlmIChjb3VudHJ5RXh0cmFjdCkge1xuICAgICAgY291bnRyeSA9IGNvdW50cnlFeHRyYWN0LmNvdW50cnk7XG4gICAgICBwbGFjZU5hbWVNaW51c0NvdW50cnkgPSBjb3VudHJ5RXh0cmFjdC5yZW1haW5kZXI7XG5cbiAgICAgIGlmIChjb3VudHJ5Lmhhc1N0YXRlcykge1xuICAgICAgICByZXR1cm4gXCJcIjtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBsZXQgY291bnR5TmFtZSA9IHVuZGVmaW5lZDtcbiAgICBsZXQgcGxhY2VOYW1lTWludXNDb3VudHkgPSB1bmRlZmluZWQ7XG4gICAgbGV0IGxhc3RDb21tYUluZGV4ID0gcGxhY2VOYW1lTWludXNDb3VudHJ5Lmxhc3RJbmRleE9mKFwiLFwiKTtcbiAgICBpZiAobGFzdENvbW1hSW5kZXggIT0gLTEpIHtcbiAgICAgIGNvdW50eU5hbWUgPSBwbGFjZU5hbWVNaW51c0NvdW50cnkuc3Vic3RyaW5nKGxhc3RDb21tYUluZGV4ICsgMSkudHJpbSgpO1xuICAgICAgcGxhY2VOYW1lTWludXNDb3VudHkgPSBwbGFjZU5hbWVNaW51c0NvdW50cnkuc3Vic3RyaW5nKDAsIGxhc3RDb21tYUluZGV4KS50cmltKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvdW50eU5hbWUgPSBwbGFjZU5hbWVNaW51c0NvdW50cnk7XG4gICAgfVxuXG4gICAgaWYgKGNvdW50cnkpIHtcbiAgICAgIGxldCBzdGRDb3VudHlOYW1lID0gQ0Quc3RhbmRhcmRpemVDb3VudHlOYW1lRm9yQ291bnRyeShjb3VudHlOYW1lLCBjb3VudHJ5KTtcbiAgICAgIGlmICghc3RkQ291bnR5TmFtZSkge1xuICAgICAgICAvLyB0aGUgY291bnR5IGlzIG5vdCByZWNvZ25pemVkLCBzbyBpdCBjb3VsZCBiZSB0aGUgdHdvbiBuYW1lXG4gICAgICAgIHBsYWNlTmFtZU1pbnVzQ291bnR5ID0gcGxhY2VOYW1lTWludXNDb3VudHJ5O1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIGJlc3QgZ3Vlc3MgaXMgdGhhdCB0aGUgdG93biBuYW1lIGlzIHdoYXQgaXMgYWZ0ZXIgdGhlIGxhc3QgY29tbWEgaW4gcGxhY2VOYW1lTWludXNDb3VudHlcbiAgICBsZXQgdG93bk5hbWUgPSBcIlwiO1xuICAgIGlmIChwbGFjZU5hbWVNaW51c0NvdW50eSkge1xuICAgICAgbGFzdENvbW1hSW5kZXggPSBwbGFjZU5hbWVNaW51c0NvdW50eS5sYXN0SW5kZXhPZihcIixcIik7XG4gICAgICBpZiAobGFzdENvbW1hSW5kZXggIT0gLTEpIHtcbiAgICAgICAgdG93bk5hbWUgPSBwbGFjZU5hbWVNaW51c0NvdW50eS5zdWJzdHJpbmcobGFzdENvbW1hSW5kZXggKyAxKS50cmltKCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0b3duTmFtZSA9IHBsYWNlTmFtZU1pbnVzQ291bnR5O1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB0b3duTmFtZTtcbiAgfVxuXG4gIGdldENvbW1vblBsYWNlKG90aGVyUGxhY2UpIHtcbiAgICBpZiAoIW90aGVyUGxhY2UgfHwgIW90aGVyUGxhY2UucGxhY2VTdHJpbmcpIHtcbiAgICAgIHJldHVybiB0aGlzLnBsYWNlU3RyaW5nO1xuICAgIH1cblxuICAgIGlmICghdGhpcy5wbGFjZVN0cmluZykge1xuICAgICAgcmV0dXJuIG90aGVyUGxhY2UucGxhY2VTdHJpbmc7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMucGxhY2VTdHJpbmcgPT0gb3RoZXJQbGFjZS5wbGFjZVN0cmluZykge1xuICAgICAgcmV0dXJuIHRoaXMucGxhY2VTdHJpbmc7XG4gICAgfVxuXG4gICAgbGV0IHRoaXNDb3VudHJ5ID0gQ0QuZXh0cmFjdENvdW50cnlGcm9tUGxhY2VOYW1lKHRoaXMucGxhY2VTdHJpbmcpO1xuICAgIGxldCBvdGhlckNvdW50cnkgPSBDRC5leHRyYWN0Q291bnRyeUZyb21QbGFjZU5hbWUob3RoZXJQbGFjZS5wbGFjZVN0cmluZyk7XG4gICAgaWYgKHRoaXNDb3VudHJ5ICYmIG90aGVyQ291bnRyeSkge1xuICAgICAgaWYgKHRoaXNDb3VudHJ5LmNvdW50cnkuc3RkTmFtZSAhPSBvdGhlckNvdW50cnkuY291bnRyeS5zdGROYW1lKSB7XG4gICAgICAgIHJldHVybiBcIlwiO1xuICAgICAgfVxuICAgIH1cblxuICAgIGxldCB0aGlzQ291bnR5ID0gdGhpcy5pbmZlckNvdW50eSgpO1xuICAgIGxldCBvdGhlckNvdW50eSA9IG90aGVyUGxhY2UuaW5mZXJDb3VudHkoKTtcbiAgICBpZiAodGhpc0NvdW50eSAmJiBvdGhlckNvdW50eSkge1xuICAgICAgaWYgKHRoaXNDb3VudHkgPT0gb3RoZXJDb3VudHkpIHtcbiAgICAgICAgbGV0IHBsYWNlID0gdGhpc0NvdW50eTtcbiAgICAgICAgaWYgKHRoaXNDb3VudHJ5KSB7XG4gICAgICAgICAgcGxhY2UgKz0gXCIsIFwiICsgdGhpc0NvdW50cnkuY291bnRyeS5zdGROYW1lO1xuICAgICAgICB9XG4gICAgICAgIGlmIChvdGhlckNvdW50cnkpIHtcbiAgICAgICAgICBwbGFjZSArPSBcIiwgXCIgKyBvdGhlckNvdW50cnkuY291bnRyeS5zdGROYW1lO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBwbGFjZTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAodGhpc0NvdW50cnkpIHtcbiAgICAgIHJldHVybiB0aGlzQ291bnRyeS5jb3VudHJ5LnN0ZE5hbWU7XG4gICAgfVxuICAgIGlmIChvdGhlckNvdW50cnkpIHtcbiAgICAgIHJldHVybiBvdGhlckNvdW50cnkuY291bnRyeS5zdGROYW1lO1xuICAgIH1cblxuICAgIC8vIHdvdWxkIGNvdWxkIGFsc28gZmluZCB0aGUgZmlyc3QgZGlmZmVyZW5jZSBpbiBzdHJpbmdzIHN0YXJ0aW5nIGZyb20gZW5kLlxuICAgIC8vIHdvdWxkIG9ubHkgd29yayBpZiBzcGFjZXMvY29tbWFzIHdlcmUgY29uc2lzdGVudFxuICAgIHJldHVybiBcIlwiO1xuICB9XG59XG5cbmNsYXNzIFd0c05hbWUge1xuICBjb25zdHJ1Y3RvcigpIHtcbiAgICAvLyBOb3RlLCBhbGwgc3RyaW5ncyBoYXZlIGFsbCB3aGl0ZSBzcGFjZSByZXBsYWNlZCB3aXRoIHNpbmdsZSBzcGFjZXMgYW5kIGFyZSB0cmltbWVkXG4gICAgLy8gcG9zc2libGUgZmllbGRzIGFyZTpcbiAgICAvLyBuYW1lIDogdGhlIFwiZnVsbFwiIG5hbWUgZnJvbSB0aGUgcmVjb3JkL3Byb2ZpbGVcbiAgICAvLyBmb3JlbmFtZXNcbiAgICAvLyBmaXJzdE5hbWVcbiAgICAvLyBmaXJzdE5hbWVzXG4gICAgLy8gbWlkZGxlTmFtZVxuICAgIC8vIG1pZGRsZU5hbWVzXG4gICAgLy8gcHJlZk5hbWVcbiAgICAvLyBwcmVmTmFtZXNcbiAgICAvLyBsYXN0TmFtZVxuICB9XG5cbiAgc3RhdGljIGNyZWF0ZUZyb21QbGFpbk9iamVjdChvYmopIHtcbiAgICBpZiAoIW9iaikge1xuICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICB9XG5cbiAgICBsZXQgY2xhc3NPYmogPSBuZXcgV3RzTmFtZSgpO1xuICAgIGNvbnN0IGtleXMgPSBPYmplY3Qua2V5cyhvYmopO1xuICAgIGZvciAobGV0IGtleSBvZiBrZXlzKSB7XG4gICAgICBjbGFzc09ialtrZXldID0gb2JqW2tleV07XG4gICAgfVxuXG4gICAgcmV0dXJuIGNsYXNzT2JqO1xuICB9XG5cbiAgY2xlYW5OYW1lKG5hbWUpIHtcbiAgICBpZiAoIW5hbWUpIHtcbiAgICAgIHJldHVybiBuYW1lO1xuICAgIH1cbiAgICAvLyByZW1vdmUgYW55ICcuJyBjaGFyYWN0ZXJzIGluIG5hbWVcbiAgICBuYW1lID0gbmFtZS5yZXBsYWNlKC9cXC4vZywgXCJcIik7XG4gICAgbmFtZSA9IG5hbWUucmVwbGFjZSgvXFxzKy9nLCBcIiBcIik7XG4gICAgbmFtZSA9IG5hbWUudHJpbSgpO1xuICAgIHJldHVybiBuYW1lO1xuICB9XG5cbiAgcmVtb3ZlVGl0bGUobmFtZSwgaXNGdWxsID0gZmFsc2UpIHtcbiAgICBpZiAoIW5hbWUpIHtcbiAgICAgIHJldHVybiAwO1xuICAgIH1cblxuICAgIGxldCB3b3JkQ291bnQgPSBXVFNfU3RyaW5nLmNvdW50V29yZHMobmFtZSk7XG5cbiAgICBpZiAoaXNGdWxsKSB7XG4gICAgICBpZiAod29yZENvdW50IDwgMykge1xuICAgICAgICByZXR1cm4gbmFtZTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKHdvcmRDb3VudCA8IDIpIHtcbiAgICAgICAgcmV0dXJuIG5hbWU7XG4gICAgICB9XG4gICAgfVxuXG4gICAgbGV0IGZpcnN0V29yZCA9IFdUU19TdHJpbmcuZ2V0Rmlyc3RXb3JkKG5hbWUpO1xuXG4gICAgY29uc3QgdGl0bGVzID0gW1wibXJcIiwgXCJtcnNcIiwgXCJtaXNzXCIsIFwibXNcIl07XG4gICAgbGV0IGxjRmlyc3RXb3JkID0gZmlyc3RXb3JkLnRvTG93ZXJDYXNlKCk7XG4gICAgaWYgKHRpdGxlcy5pbmNsdWRlcyhsY0ZpcnN0V29yZCkpIHtcbiAgICAgIC8vIHJlbW92ZSB0aGUgdGl0bGVcbiAgICAgIHJldHVybiBXVFNfU3RyaW5nLmdldFdvcmRzQWZ0ZXJGaXJzdFdvcmQobmFtZSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIG5hbWU7XG4gIH1cblxuICBzZXRGdWxsTmFtZShuYW1lKSB7XG4gICAgaWYgKG5hbWUpIHtcbiAgICAgIHRoaXMubmFtZSA9IHRoaXMuY2xlYW5OYW1lKG5hbWUpO1xuICAgICAgdGhpcy5uYW1lID0gdGhpcy5yZW1vdmVUaXRsZSh0aGlzLm5hbWUsIHRydWUpO1xuICAgIH1cbiAgfVxuXG4gIHNldExhc3ROYW1lKG5hbWUpIHtcbiAgICBpZiAobmFtZSkge1xuICAgICAgdGhpcy5sYXN0TmFtZSA9IHRoaXMuY2xlYW5OYW1lKG5hbWUpO1xuICAgIH1cbiAgfVxuXG4gIHNldEZvcmVOYW1lcyhuYW1lKSB7XG4gICAgaWYgKG5hbWUpIHtcbiAgICAgIHRoaXMuZm9yZW5hbWVzID0gdGhpcy5jbGVhbk5hbWUobmFtZSk7XG4gICAgICB0aGlzLmZvcmVuYW1lcyA9IHRoaXMucmVtb3ZlVGl0bGUodGhpcy5mb3JlbmFtZXMpO1xuICAgIH1cbiAgfVxuXG4gIHNldEZpcnN0TmFtZShuYW1lKSB7XG4gICAgaWYgKG5hbWUpIHtcbiAgICAgIHRoaXMuZmlyc3ROYW1lID0gdGhpcy5jbGVhbk5hbWUobmFtZSk7XG4gICAgICB0aGlzLmZpcnN0TmFtZSA9IHRoaXMucmVtb3ZlVGl0bGUodGhpcy5maXJzdE5hbWUpO1xuICAgIH1cbiAgfVxuXG4gIHNldEZpcnN0TmFtZXMobmFtZSkge1xuICAgIGlmIChuYW1lKSB7XG4gICAgICB0aGlzLmZpcnN0TmFtZXMgPSB0aGlzLmNsZWFuTmFtZShuYW1lKTtcbiAgICAgIHRoaXMuZmlyc3ROYW1lcyA9IHRoaXMucmVtb3ZlVGl0bGUodGhpcy5maXJzdE5hbWVzKTtcbiAgICB9XG4gIH1cblxuICBzZXRNaWRkbGVOYW1lKG5hbWUpIHtcbiAgICBpZiAobmFtZSkge1xuICAgICAgdGhpcy5taWRkbGVOYW1lID0gdGhpcy5jbGVhbk5hbWUobmFtZSk7XG4gICAgfVxuICB9XG5cbiAgc2V0TWlkZGxlTmFtZXMobmFtZSkge1xuICAgIGlmIChuYW1lKSB7XG4gICAgICB0aGlzLm1pZGRsZU5hbWVzID0gdGhpcy5jbGVhbk5hbWUobmFtZSk7XG4gICAgfVxuICB9XG5cbiAgZ2V0TWlkZGxlTmFtZSgpIHtcbiAgICBpZiAodGhpcy5taWRkbGVOYW1lKSB7XG4gICAgICByZXR1cm4gdGhpcy5taWRkbGVOYW1lO1xuICAgIH1cbiAgICBpZiAodGhpcy5taWRkbGVOYW1lcykge1xuICAgICAgcmV0dXJuIFdUU19TdHJpbmcuZ2V0Rmlyc3RXb3JkKHRoaXMubWlkZGxlTmFtZXMpO1xuICAgIH1cbiAgICBpZiAodGhpcy5mb3JlbmFtZXMpIHtcbiAgICAgIGxldCBtaWRkbGVOYW1lcyA9IFdUU19TdHJpbmcuZ2V0V29yZHNBZnRlckZpcnN0V29yZCh0aGlzLmZvcmVuYW1lcyk7XG4gICAgICBpZiAobWlkZGxlTmFtZXMpIHtcbiAgICAgICAgcmV0dXJuIFdUU19TdHJpbmcuZ2V0Rmlyc3RXb3JkKG1pZGRsZU5hbWVzKTtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKHRoaXMubmFtZSkge1xuICAgICAgbGV0IGZvcmVuYW1lcyA9IFdUU19TdHJpbmcuZ2V0V29yZHNCZWZvcmVMYXN0V29yZCh0aGlzLm5hbWUpO1xuICAgICAgaWYgKGZvcmVuYW1lcykge1xuICAgICAgICBsZXQgbWlkZGxlTmFtZXMgPSBXVFNfU3RyaW5nLmdldFdvcmRzQWZ0ZXJGaXJzdFdvcmQoZm9yZW5hbWVzKTtcbiAgICAgICAgaWYgKG1pZGRsZU5hbWVzKSB7XG4gICAgICAgICAgcmV0dXJuIFdUU19TdHJpbmcuZ2V0Rmlyc3RXb3JkKG1pZGRsZU5hbWVzKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGluZmVyRnVsbE5hbWUoKSB7XG4gICAgaWYgKHRoaXMubmFtZSkge1xuICAgICAgcmV0dXJuIHRoaXMubmFtZTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5taWRkbGVOYW1lIHx8IHRoaXMuZmlyc3ROYW1lIHx8IHRoaXMubWlkZGxlTmFtZXMgfHwgdGhpcy5maXJzdE5hbWVzIHx8IHRoaXMuZm9yZW5hbWVzIHx8IHRoaXMubGFzdE5hbWUpIHtcbiAgICAgIGxldCBuYW1lID0gXCJcIjtcbiAgICAgIGlmICh0aGlzLmZvcmVuYW1lcykge1xuICAgICAgICBuYW1lID0gdGhpcy5mb3JlbmFtZXM7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAodGhpcy5maXJzdE5hbWVzKSB7XG4gICAgICAgICAgbmFtZSA9IHRoaXMuZmlyc3ROYW1lcztcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLmZpcnN0TmFtZSkge1xuICAgICAgICAgIG5hbWUgPSB0aGlzLmZpcnN0TmFtZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLm1pZGRsZU5hbWVzKSB7XG4gICAgICAgICAgbmFtZSArPSBcIiBcIiArIHRoaXMubWlkZGxlTmFtZXM7XG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5taWRkbGVOYW1lKSB7XG4gICAgICAgICAgbmFtZSArPSBcIiBcIiArIHRoaXMubWlkZGxlTmFtZTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpZiAodGhpcy5sYXN0TmFtZSkge1xuICAgICAgICBpZiAobmFtZSkge1xuICAgICAgICAgIG5hbWUgKz0gXCIgXCI7XG4gICAgICAgIH1cbiAgICAgICAgbmFtZSArPSB0aGlzLmxhc3ROYW1lO1xuICAgICAgfVxuICAgICAgcmV0dXJuIG5hbWU7XG4gICAgfVxuICB9XG5cbiAgaW5mZXJMYXN0TmFtZSgpIHtcbiAgICBpZiAodGhpcy5sYXN0TmFtZSkge1xuICAgICAgcmV0dXJuIHRoaXMubGFzdE5hbWU7XG4gICAgfVxuICAgIGlmICh0aGlzLm5hbWUpIHtcbiAgICAgIHJldHVybiBXVFNfU3RyaW5nLmdldExhc3RXb3JkKHRoaXMubmFtZSk7XG4gICAgfVxuICB9XG5cbiAgaW5mZXJGaXJzdE5hbWUoKSB7XG4gICAgaWYgKHRoaXMuZmlyc3ROYW1lKSB7XG4gICAgICByZXR1cm4gdGhpcy5maXJzdE5hbWU7XG4gICAgfVxuICAgIGlmICh0aGlzLmZpcnN0TmFtZXMpIHtcbiAgICAgIHJldHVybiBXVFNfU3RyaW5nLmdldEZpcnN0V29yZCh0aGlzLmZpcnN0TmFtZXMpO1xuICAgIH1cbiAgICBpZiAodGhpcy5mb3JlbmFtZXMpIHtcbiAgICAgIHJldHVybiBXVFNfU3RyaW5nLmdldEZpcnN0V29yZCh0aGlzLmZvcmVuYW1lcyk7XG4gICAgfVxuICAgIGlmICh0aGlzLm5hbWUpIHtcbiAgICAgIHJldHVybiBXVFNfU3RyaW5nLmdldEZpcnN0V29yZCh0aGlzLm5hbWUpO1xuICAgIH1cbiAgfVxuXG4gIGluZmVyTWlkZGxlTmFtZSgpIHtcbiAgICBpZiAodGhpcy5taWRkbGVOYW1lKSB7XG4gICAgICByZXR1cm4gdGhpcy5taWRkbGVOYW1lO1xuICAgIH1cbiAgICBpZiAodGhpcy5taWRkbGVOYW1lcykge1xuICAgICAgcmV0dXJuIFdUU19TdHJpbmcuZ2V0Rmlyc3RXb3JkKHRoaXMubWlkZGxlTmFtZXMpO1xuICAgIH1cbiAgICBpZiAodGhpcy5mb3JlbmFtZXMpIHtcbiAgICAgIHJldHVybiBXVFNfU3RyaW5nLmdldFNlY29uZFdvcmQodGhpcy5mb3JlbmFtZXMpO1xuICAgIH1cbiAgICBpZiAodGhpcy5uYW1lKSB7XG4gICAgICByZXR1cm4gV1RTX1N0cmluZy5nZXRNaWRkbGVXb3JkKHRoaXMubmFtZSk7XG4gICAgfVxuICB9XG5cbiAgaW5mZXJTZWNvbmRGb3JlbmFtZSgpIHtcbiAgICBsZXQgcmVzdWx0ID0gXCJcIjtcblxuICAgIGlmICh0aGlzLmZpcnN0TmFtZXMpIHtcbiAgICAgIHJlc3VsdCA9IFdUU19TdHJpbmcuZ2V0U2Vjb25kV29yZCh0aGlzLmZpcnN0TmFtZXMpO1xuICAgICAgaWYgKHJlc3VsdCkge1xuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmICh0aGlzLmZvcmVuYW1lcykge1xuICAgICAgcmVzdWx0ID0gV1RTX1N0cmluZy5nZXRTZWNvbmRXb3JkKHRoaXMuZm9yZW5hbWVzKTtcbiAgICAgIGlmIChyZXN1bHQpIHtcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKHRoaXMubWlkZGxlTmFtZSkge1xuICAgICAgcmV0dXJuIHRoaXMubWlkZGxlTmFtZTtcbiAgICB9XG4gICAgaWYgKHRoaXMubWlkZGxlTmFtZXMpIHtcbiAgICAgIHJldHVybiBXVFNfU3RyaW5nLmdldEZpcnN0V29yZCh0aGlzLm1pZGRsZU5hbWVzKTtcbiAgICB9XG4gICAgaWYgKHRoaXMubmFtZSkge1xuICAgICAgcmV0dXJuIFdUU19TdHJpbmcuZ2V0TWlkZGxlV29yZCh0aGlzLm5hbWUpO1xuICAgIH1cbiAgfVxuXG4gIGluZmVyTWlkZGxlTmFtZXMoKSB7XG4gICAgaWYgKHRoaXMubWlkZGxlTmFtZXMpIHtcbiAgICAgIHJldHVybiB0aGlzLm1pZGRsZU5hbWVzO1xuICAgIH1cbiAgICBpZiAodGhpcy5taWRkbGVOYW1lKSB7XG4gICAgICByZXR1cm4gdGhpcy5taWRkbGVOYW1lO1xuICAgIH1cbiAgICBpZiAodGhpcy5mb3JlbmFtZXMpIHtcbiAgICAgIHJldHVybiBXVFNfU3RyaW5nLmdldFdvcmRzQWZ0ZXJGaXJzdFdvcmQodGhpcy5mb3JlbmFtZXMpO1xuICAgIH1cbiAgICBpZiAodGhpcy5uYW1lKSB7XG4gICAgICByZXR1cm4gV1RTX1N0cmluZy5nZXRNaWRkbGVXb3Jkcyh0aGlzLm5hbWUpO1xuICAgIH1cbiAgfVxuXG4gIGluZmVyRm9yZW5hbWVzKCkge1xuICAgIGlmICh0aGlzLmZvcmVuYW1lcykge1xuICAgICAgcmV0dXJuIHRoaXMuZm9yZW5hbWVzO1xuICAgIH1cbiAgICBpZiAodGhpcy5taWRkbGVOYW1lIHx8IHRoaXMuZmlyc3ROYW1lIHx8IHRoaXMubWlkZGxlTmFtZXMgfHwgdGhpcy5maXJzdE5hbWVzKSB7XG4gICAgICBsZXQgZm9yZW5hbWVzID0gXCJcIjtcbiAgICAgIGlmICh0aGlzLmZpcnN0TmFtZXMpIHtcbiAgICAgICAgZm9yZW5hbWVzID0gdGhpcy5maXJzdE5hbWVzO1xuICAgICAgfSBlbHNlIGlmICh0aGlzLmZpcnN0TmFtZSkge1xuICAgICAgICBmb3JlbmFtZXMgPSB0aGlzLmZpcnN0TmFtZTtcbiAgICAgIH1cbiAgICAgIGlmICh0aGlzLm1pZGRsZU5hbWVzKSB7XG4gICAgICAgIGZvcmVuYW1lcyArPSBcIiBcIiArIHRoaXMubWlkZGxlTmFtZXM7XG4gICAgICB9IGVsc2UgaWYgKHRoaXMubWlkZGxlTmFtZSkge1xuICAgICAgICBmb3JlbmFtZXMgKz0gXCIgXCIgKyB0aGlzLm1pZGRsZU5hbWU7XG4gICAgICB9XG4gICAgICByZXR1cm4gZm9yZW5hbWVzO1xuICAgIH1cbiAgICBpZiAodGhpcy5uYW1lKSB7XG4gICAgICByZXR1cm4gV1RTX1N0cmluZy5nZXRXb3Jkc0JlZm9yZUxhc3RXb3JkKHRoaXMubmFtZSk7XG4gICAgfVxuICB9XG5cbiAgaW5mZXJQcmVmaXgoKSB7XG4gICAgaWYgKHRoaXMucHJlZml4KSB7XG4gICAgICByZXR1cm4gdGhpcy5wcmVmaXg7XG4gICAgfVxuICB9XG5cbiAgaW5mZXJTdWZmaXgoKSB7XG4gICAgaWYgKHRoaXMuc3VmZml4KSB7XG4gICAgICByZXR1cm4gdGhpcy5zdWZmaXg7XG4gICAgfVxuICB9XG59XG5cbmNsYXNzIEdlbmVyYWxpemVkRGF0YSB7XG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIC8vIE5PVEU6IEFkZGluZyBhIG5ldyBmaWVsZCBoZXJlIHdpbGwgbGlrZWx5IGludmFsaWRhdGUgYWxsIGdlbmVyYWxpemUgdGVzdCBkYXRhXG4gICAgLy8gc28gd2UgZG9uJ3QgYWN0dWFsbHkgaW5pdGlhbGl6ZSBhbiBmaWVsZHMgaGVyZS5cbiAgICAvLyBUaGUgb25seSBmaWVsZHMgc2V0IGFyZSBvbmVzIHRoYXQgY29tZSBmcm9tIHRoZSByZWNvcmQvcHJvZmlsZVxuICAgIC8vIFN1cHBvcnRlZCBmaWVsZHMgYXJlOlxuICAgIC8vIGhhc1ZhbGlkRGF0YSA6IG5vdCBzdXJlIGlmIHdlIG5lZWQgaXQgLSB1c2VkIGluIHBvcHVwIHRvIGRldGVybWluZSB3aGV0aGVyIHRvIHNob3cgbWVudSBpdGVtc1xuICAgIC8vIHNvdXJjZU9mRGF0YSA6IG11c3QgYmUgb25lIG9mIHRoZSBzdXBwb3J0ZWQgc2l0ZSBuYW1lc1xuICAgIC8vIHNvdXJjZVR5cGU6IEEgc3RyaW5nIGVpdGhlciBcInJlY29yZFwiIG9yIFwicHJvZmlsZVwiXG4gICAgLy8gcmVjb3JkVHlwZTogQSBzdHJpbmcsIGlmIGEgcmVjb3JkIHRoaXMgaXMgc29tZXRoaW5nIGxpa2UgXCJCaXJ0aFJlZ2lzdHJhdGlvblwiIG9yIFwiQ2Vuc3VzXCJcbiAgICAvLyBiaXJ0aERhdGU6IGEgV3RzRGF0ZSBvYmplY3RcbiAgICAvLyBkZWF0aERhdGU6IGEgV3RzRGF0ZSBvYmplY3RcbiAgICAvLyBldmVudERhdGU6IGEgV3RzRGF0ZSBvYmplY3RcbiAgICAvLyBhZ2VBdEV2ZW50OiBhIHN0cmluZ1xuICAgIC8vIGFnZUF0RGVhdGg6IGEgc3RyaW5nXG4gICAgLy8gbGFzdE5hbWVBdEJpcnRoOiBzdHJpbmdcbiAgICAvLyBsYXN0TmFtZUF0RGVhdGg6IHN0cmluZ1xuICAgIC8vIG1vdGhlcnNNYWlkZW5OYW1lOiBzdHJpbmdcbiAgICAvLyBuYW1lOiBXdHNOYW1lIG9iamVjdCwgdGhlIG5hbWUgZnJvbSB0aGUgcmVjb3JkL3Byb2ZpbGUuIEZvciBhIHByb2ZpbGUgdGhpcyB3b3VsZCBpbmNsdWRlIHRoZSBMTkFCIGFzIGxhc3ROYW1lXG4gICAgLy8gYmlydGhQbGFjZTogYSBXdHNQbGFjZSBvYmplY3RcbiAgICAvLyBkZWF0aFBsYWNlOiBhIFd0c1BsYWNlIG9iamVjdFxuICAgIC8vIGV2ZW50UGxhY2U6IGEgV3RzUGxhY2Ugb2JqZWN0XG4gICAgLy8gcmVzaWRlbmNlUGxhY2U6IGEgV3RzUGxhY2Ugb2JqZWN0XG4gICAgLy8gcmVnaXN0cmF0aW9uRGlzdHJpY3Q6IGEgc3RyaW5nXG4gICAgLy8gcGVyc29uR2VuZGVyOiBhIGxvd2VyZmFjZSBzdHJpbmcsIGVpdGhlciBcIm1hbGVcIiwgXCJmZW1hbGVcIiBvciBub3QgZGVmaW5lZFxuICAgIC8vIHBhcmVudHM6IGFuIG9iamVjdCB3aXRoIGZhdGhlciBhbmQgbW90aGVyIGZpZWxkc1xuICAgIC8vIHNwb3VzZXM6IGFuIGFycmF5IG9mIG9iamVjdHNcbiAgfVxuXG4gIHN0YXRpYyBjcmVhdGVGcm9tUGxhaW5PYmplY3Qob2JqKSB7XG4gICAgaWYgKCFvYmopIHtcbiAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgfVxuXG4gICAgbGV0IGNsYXNzT2JqID0gbmV3IEdlbmVyYWxpemVkRGF0YSgpO1xuICAgIGNvbnN0IGtleXMgPSBPYmplY3Qua2V5cyhvYmopO1xuICAgIGZvciAobGV0IGtleSBvZiBrZXlzKSB7XG4gICAgICBpZiAoa2V5ID09IFwiZXZlbnREYXRlXCIgfHwga2V5ID09IFwiYmlydGhEYXRlXCIgfHwga2V5ID09IFwiZGVhdGhEYXRlXCIpIHtcbiAgICAgICAgY2xhc3NPYmpba2V5XSA9IFd0c0RhdGUuY3JlYXRlRnJvbVBsYWluT2JqZWN0KG9ialtrZXldKTtcbiAgICAgIH0gZWxzZSBpZiAoa2V5ID09IFwibmFtZVwiKSB7XG4gICAgICAgIGNsYXNzT2JqW2tleV0gPSBXdHNOYW1lLmNyZWF0ZUZyb21QbGFpbk9iamVjdChvYmpba2V5XSk7XG4gICAgICB9IGVsc2UgaWYgKGtleSA9PSBcImJpcnRoUGxhY2VcIiB8fCBrZXkgPT0gXCJkZWF0aFBsYWNlXCIgfHwga2V5ID09IFwiZXZlbnRQbGFjZVwiIHx8IGtleSA9PSBcInJlc2lkZW5jZVBsYWNlXCIpIHtcbiAgICAgICAgY2xhc3NPYmpba2V5XSA9IFd0c1BsYWNlLmNyZWF0ZUZyb21QbGFpbk9iamVjdChvYmpba2V5XSk7XG4gICAgICB9IGVsc2UgaWYgKGtleSA9PSBcInBhcmVudHNcIikge1xuICAgICAgICBjbGFzc09ialtrZXldID0ge307XG4gICAgICAgIGlmIChvYmoucGFyZW50cy5mYXRoZXIpIHtcbiAgICAgICAgICBsZXQgZmF0aGVyID0gb2JqLnBhcmVudHMuZmF0aGVyO1xuICAgICAgICAgIGNsYXNzT2JqW2tleV0uZmF0aGVyID0ge307XG4gICAgICAgICAgaWYgKGZhdGhlci5uYW1lKSB7XG4gICAgICAgICAgICBjbGFzc09ialtrZXldLmZhdGhlci5uYW1lID0gV3RzTmFtZS5jcmVhdGVGcm9tUGxhaW5PYmplY3QoZmF0aGVyLm5hbWUpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoZmF0aGVyLmxhc3ROYW1lQXRCaXJ0aCkge1xuICAgICAgICAgICAgY2xhc3NPYmpba2V5XS5mYXRoZXIubGFzdE5hbWVBdEJpcnRoID0gZmF0aGVyLmxhc3ROYW1lQXRCaXJ0aDtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKGZhdGhlci5sYXN0TmFtZUF0RGVhdGgpIHtcbiAgICAgICAgICAgIGNsYXNzT2JqW2tleV0uZmF0aGVyLmxhc3ROYW1lQXREZWF0aCA9IGZhdGhlci5sYXN0TmFtZUF0RGVhdGg7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChvYmoucGFyZW50cy5tb3RoZXIpIHtcbiAgICAgICAgICBsZXQgbW90aGVyID0gb2JqLnBhcmVudHMubW90aGVyO1xuICAgICAgICAgIGNsYXNzT2JqW2tleV0ubW90aGVyID0ge307XG4gICAgICAgICAgaWYgKG1vdGhlci5uYW1lKSB7XG4gICAgICAgICAgICBjbGFzc09ialtrZXldLm1vdGhlci5uYW1lID0gV3RzTmFtZS5jcmVhdGVGcm9tUGxhaW5PYmplY3QobW90aGVyLm5hbWUpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAobW90aGVyLmxhc3ROYW1lQXRCaXJ0aCkge1xuICAgICAgICAgICAgY2xhc3NPYmpba2V5XS5tb3RoZXIubGFzdE5hbWVBdEJpcnRoID0gbW90aGVyLmxhc3ROYW1lQXRCaXJ0aDtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKG1vdGhlci5sYXN0TmFtZUF0RGVhdGgpIHtcbiAgICAgICAgICAgIGNsYXNzT2JqW2tleV0ubW90aGVyLmxhc3ROYW1lQXREZWF0aCA9IG1vdGhlci5sYXN0TmFtZUF0RGVhdGg7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKGtleSA9PSBcInNwb3VzZXNcIikge1xuICAgICAgICBjbGFzc09ialtrZXldID0gW107XG4gICAgICAgIGZvciAobGV0IHNwb3VzZSBvZiBvYmouc3BvdXNlcykge1xuICAgICAgICAgIGxldCBuZXdTcG91c2UgPSB7fTtcbiAgICAgICAgICBpZiAoc3BvdXNlLm5hbWUpIHtcbiAgICAgICAgICAgIG5ld1Nwb3VzZS5uYW1lID0gV3RzTmFtZS5jcmVhdGVGcm9tUGxhaW5PYmplY3Qoc3BvdXNlLm5hbWUpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoc3BvdXNlLmxhc3ROYW1lQXRCaXJ0aCkge1xuICAgICAgICAgICAgbmV3U3BvdXNlLmxhc3ROYW1lQXRCaXJ0aCA9IHNwb3VzZS5sYXN0TmFtZUF0QmlydGg7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChzcG91c2UubGFzdE5hbWVBdEJpcnRoKSB7XG4gICAgICAgICAgICBuZXdTcG91c2UubGFzdE5hbWVBdEJpcnRoID0gc3BvdXNlLmxhc3ROYW1lQXRCaXJ0aDtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKHNwb3VzZS5tYXJyaWFnZURhdGUpIHtcbiAgICAgICAgICAgIG5ld1Nwb3VzZS5tYXJyaWFnZURhdGUgPSBXdHNEYXRlLmNyZWF0ZUZyb21QbGFpbk9iamVjdChzcG91c2UubWFycmlhZ2VEYXRlKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKHNwb3VzZS5tYXJyaWFnZVBsYWNlKSB7XG4gICAgICAgICAgICBuZXdTcG91c2UubWFycmlhZ2VQbGFjZSA9IFd0c1BsYWNlLmNyZWF0ZUZyb21QbGFpbk9iamVjdChzcG91c2UubWFycmlhZ2VQbGFjZSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChzcG91c2UuYWdlKSB7XG4gICAgICAgICAgICBuZXdTcG91c2UuYWdlID0gc3BvdXNlLmFnZTtcbiAgICAgICAgICB9XG4gICAgICAgICAgY2xhc3NPYmpba2V5XS5wdXNoKG5ld1Nwb3VzZSk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNsYXNzT2JqW2tleV0gPSBvYmpba2V5XTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gY2xhc3NPYmo7XG4gIH1cblxuICBzdGF0aWMgbWFrZURhdGVTdHJpbmdGcm9tRGF0ZShkYXRlKSB7XG4gICAgY29uc3QgbW9udGhTdHJpbmdzID0gW1xuICAgICAgXCJKYW51YXJ5XCIsXG4gICAgICBcIkZlYnJ1YXJ5XCIsXG4gICAgICBcIk1hcmNoXCIsXG4gICAgICBcIkFwcmlsXCIsXG4gICAgICBcIk1heVwiLFxuICAgICAgXCJKdW5lXCIsXG4gICAgICBcIkp1bHlcIixcbiAgICAgIFwiQXVndXN0XCIsXG4gICAgICBcIlNlcHRlbWJlclwiLFxuICAgICAgXCJPY3RvYmVyXCIsXG4gICAgICBcIk5vdmVtYmVyXCIsXG4gICAgICBcIkRlY2VtYmVyXCIsXG4gICAgXTtcblxuICAgIGNvbnN0IGRhdGVTdHJpbmcgPSBcIlwiICsgZGF0ZS5nZXRVVENEYXRlKCkgKyBcIiBcIiArIG1vbnRoU3RyaW5nc1tkYXRlLmdldFVUQ01vbnRoKCldICsgXCIgXCIgKyBkYXRlLmdldFVUQ0Z1bGxZZWFyKCk7XG5cbiAgICByZXR1cm4gZGF0ZVN0cmluZztcbiAgfVxuXG4gIHN0YXRpYyBnZXRBZ2VBdERhdGUoYmlydGhEYXRlLCBvdGhlckRhdGUpIHtcbiAgICBsZXQgeWVhcnMgPSBXVFNfRGF0ZS5nZXRXaG9sZVllYXJzQmV0d2VlbkRhdGVTdHJpbmdzKGJpcnRoRGF0ZSwgb3RoZXJEYXRlKTtcbiAgICByZXR1cm4geWVhcnM7XG4gIH1cblxuICBzdGF0aWMgZ2V0U3VidHJhY3RBZ2VGcm9tRGF0ZShkYXRlU3RyaW5nLCBhZ2UpIHtcbiAgICBsZXQgcGFyc2VkRGF0ZSA9IFdUU19EYXRlLnBhcnNlRGF0ZVN0cmluZyhkYXRlU3RyaW5nKTtcbiAgICBpZiAoIXBhcnNlZERhdGUuaXNWYWxpZCkge1xuICAgICAgcmV0dXJuIGRhdGVTdHJpbmc7XG4gICAgfVxuXG4gICAgcGFyc2VkRGF0ZS55ZWFyTnVtIC09IGFnZTtcblxuICAgIHJldHVybiBXVFNfRGF0ZS5nZXRTdGRTaG9ydEZvcm1EYXRlU3RyaW5nKHBhcnNlZERhdGUpO1xuICB9XG5cbiAgc3RhdGljIGdldFN1YnRyYWN0QWdlRnJvbURhdGVZZWFyKGRhdGVZZWFyLCBhZ2UpIHtcbiAgICByZXR1cm4gZGF0ZVllYXIgLSBhZ2U7XG4gIH1cblxuICBleHRyYWN0TmFtZVBhcnRzRnJvbUZvcmVOYW1lcyhuYW1lUGFydHMpIHtcbiAgICAvLyB3ZSBhc3N1bWUgdGhhdCB0aGUgZnVsbCBuYW1lIGhhcyBhbGwgd2hpdGUgc3BhY2UgcmVwbGFjZWQgd2l0aCBzaW5nbGUgc3BhY2VzIGFuZCBpcyB0cmltbWVkXG4gICAgbGV0IGZpcnN0U3BhY2VJbmRleCA9IG5hbWVQYXJ0cy5mb3JlbmFtZXMuaW5kZXhPZihcIiBcIik7XG4gICAgaWYgKGZpcnN0U3BhY2VJbmRleCA9PSAtMSkge1xuICAgICAgLy8gbm8gc3BhY2VzLFxuICAgICAgbmFtZVBhcnRzLmZpcnN0TmFtZSA9IG5hbWVQYXJ0cy5mb3JlbmFtZXM7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgbmFtZVBhcnRzLmZpcnN0TmFtZSA9IG5hbWVQYXJ0cy5mb3JlbmFtZXMuc3Vic3RyaW5nKDAsIGZpcnN0U3BhY2VJbmRleCk7XG4gICAgbmFtZVBhcnRzLm1pZGRsZU5hbWVzID0gbmFtZVBhcnRzLmZvcmVuYW1lcy5zdWJzdHJpbmcoZmlyc3RTcGFjZUluZGV4ICsgMSk7XG5cbiAgICBmaXJzdFNwYWNlSW5kZXggPSBuYW1lUGFydHMubWlkZGxlTmFtZXMuaW5kZXhPZihcIiBcIik7XG4gICAgaWYgKGZpcnN0U3BhY2VJbmRleCAhPSAtMSkge1xuICAgICAgLy8gbm8gc3BhY2VzLFxuICAgICAgbmFtZVBhcnRzLm1pZGRsZU5hbWUgPSBuYW1lUGFydHMubWlkZGxlTmFtZXMuc3Vic3RyaW5nKDAsIGZpcnN0U3BhY2VJbmRleCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIG5hbWVQYXJ0cy5taWRkbGVOYW1lID0gbmFtZVBhcnRzLm1pZGRsZU5hbWVzO1xuICAgIH1cbiAgfVxuXG4gIGV4dHJhY3ROYW1lUGFydHNGcm9tRnVsbE5hbWUobmFtZVBhcnRzKSB7XG4gICAgaWYgKCFuYW1lUGFydHMuZnVsbE5hbWUpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyB3ZSBhc3N1bWUgdGhhdCB0aGUgZnVsbCBuYW1lIGhhcyBhbGwgd2hpdGUgc3BhY2UgcmVwbGFjZWQgd2l0aCBzaW5nbGUgc3BhY2VzIGFuZCBpcyB0cmltbWVkXG4gICAgbGV0IGxhc3RTcGFjZUluZGV4ID0gbmFtZVBhcnRzLmZ1bGxOYW1lLmxhc3RJbmRleE9mKFwiIFwiKTtcbiAgICBpZiAobGFzdFNwYWNlSW5kZXggPT0gLTEpIHtcbiAgICAgIC8vIG5vIHNwYWNlcyxcbiAgICAgIG5hbWVQYXJ0cy5sYXN0TmFtZSA9IG5hbWVQYXJ0cy5mdWxsTmFtZTtcbiAgICAgIHJldHVybiBuYW1lUGFydHM7XG4gICAgfVxuXG4gICAgbmFtZVBhcnRzLmZvcmVuYW1lcyA9IG5hbWVQYXJ0cy5mdWxsTmFtZS5zdWJzdHJpbmcoMCwgbGFzdFNwYWNlSW5kZXgpO1xuICAgIG5hbWVQYXJ0cy5sYXN0TmFtZSA9IG5hbWVQYXJ0cy5mdWxsTmFtZS5zdWJzdHJpbmcobGFzdFNwYWNlSW5kZXggKyAxKTtcblxuICAgIHRoaXMuZXh0cmFjdE5hbWVQYXJ0c0Zyb21Gb3JlTmFtZXMobmFtZVBhcnRzKTtcblxuICAgIHJldHVybjtcbiAgfVxuXG4gIGV4dHJhY3ROYW1lc0Zyb21Gb3JlTmFtZXMoKSB7XG4gICAgdGhpcy5leHRyYWN0TmFtZVBhcnRzRnJvbUZvcmVOYW1lcyh0aGlzLm5hbWUpO1xuICB9XG5cbiAgZXh0cmFjdE5hbWVzRnJvbUZ1bGxOYW1lKCkge1xuICAgIHRoaXMuZXh0cmFjdE5hbWVQYXJ0c0Zyb21GdWxsTmFtZSh0aGlzLm5hbWUpO1xuICAgIHRoaXMuZXZlbnRMYXN0TmFtZSA9IHRoaXMubGFzdE5hbWU7XG4gICAgZGVsZXRlIHRoaXMubGFzdE5hbWU7IC8vIGZvciB0aGUgR2VuZXJhbGl6ZWREYXRhIGl0c2VsZiB3ZSB1c2UgZXZlbnRMYXN0TmFtZSByYXRoZXIgdGhhbiBsYXN0TmFtZVxuICB9XG5cbiAgY3JlYXRlTmFtZUlmTmVlZGVkKCkge1xuICAgIGlmICghdGhpcy5uYW1lKSB7XG4gICAgICB0aGlzLm5hbWUgPSBuZXcgV3RzTmFtZSgpO1xuICAgIH1cbiAgfVxuXG4gIHNldEZ1bGxOYW1lKHN0cmluZykge1xuICAgIGlmIChzdHJpbmcpIHtcbiAgICAgIHRoaXMuY3JlYXRlTmFtZUlmTmVlZGVkKCk7XG4gICAgICB0aGlzLm5hbWUuc2V0RnVsbE5hbWUoc3RyaW5nKTtcbiAgICB9XG4gIH1cblxuICBzZXRMYXN0TmFtZUFuZEZvcmVOYW1lcyhsYXN0TmFtZSwgZm9yZW5hbWVzKSB7XG4gICAgaWYgKGxhc3ROYW1lKSB7XG4gICAgICB0aGlzLmNyZWF0ZU5hbWVJZk5lZWRlZCgpO1xuICAgICAgdGhpcy5uYW1lLnNldExhc3ROYW1lKGxhc3ROYW1lKTtcbiAgICB9XG4gICAgaWYgKGZvcmVuYW1lcykge1xuICAgICAgdGhpcy5jcmVhdGVOYW1lSWZOZWVkZWQoKTtcbiAgICAgIHRoaXMubmFtZS5zZXRGb3JlTmFtZXMoZm9yZW5hbWVzKTtcbiAgICB9XG4gIH1cblxuICBpc1VzYWJsZURhdGVTdHJpbmcoc3RyaW5nKSB7XG4gICAgaWYgKHN0cmluZykge1xuICAgICAgbGV0IGxjU3RyaW5nID0gc3RyaW5nLnRvTG93ZXJDYXNlKCkudHJpbSgpO1xuICAgICAgaWYgKGxjU3RyaW5nICE9IFwidW5rbm93blwiKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBjcmVhdGVCaXJ0aERhdGVJZk5lZWRlZCgpIHtcbiAgICBpZiAoIXRoaXMuYmlydGhEYXRlKSB7XG4gICAgICB0aGlzLmJpcnRoRGF0ZSA9IG5ldyBXdHNEYXRlKCk7XG4gICAgfVxuICB9XG5cbiAgc2V0QmlydGhEYXRlKHN0cmluZykge1xuICAgIGlmICh0aGlzLmlzVXNhYmxlRGF0ZVN0cmluZyhzdHJpbmcpKSB7XG4gICAgICB0aGlzLmNyZWF0ZUJpcnRoRGF0ZUlmTmVlZGVkKCk7XG4gICAgICB0aGlzLmJpcnRoRGF0ZS5zZXREYXRlQW5kUXVhbGlmaWVyRnJvbVN0cmluZyhzdHJpbmcpO1xuICAgIH1cbiAgfVxuXG4gIHNldEJpcnRoWWVhcihzdHJpbmcpIHtcbiAgICBpZiAodGhpcy5pc1VzYWJsZURhdGVTdHJpbmcoc3RyaW5nKSkge1xuICAgICAgdGhpcy5jcmVhdGVCaXJ0aERhdGVJZk5lZWRlZCgpO1xuICAgICAgdGhpcy5iaXJ0aERhdGUuc2V0RGF0ZUFuZFF1YWxpZmllckZyb21TdHJpbmcoc3RyaW5nLCB0cnVlKTtcbiAgICB9XG4gIH1cblxuICBzZXRCaXJ0aERhdGVGcm9tWWVhck1vbnRoRGF5KHllYXIsIG1vbnRoLCBkYXkpIHtcbiAgICBsZXQgZGF0ZVN0cmluZyA9IFdUU19EYXRlLmdldERhdGVTdHJpbmdGcm9tWWVhck1vbnRoRGF5KHllYXIsIG1vbnRoLCBkYXkpO1xuXG4gICAgaWYgKGRhdGVTdHJpbmcpIHtcbiAgICAgIHRoaXMuY3JlYXRlQmlydGhEYXRlSWZOZWVkZWQoKTtcbiAgICAgIHRoaXMuYmlydGhEYXRlLmRhdGVTdHJpbmcgPSBkYXRlU3RyaW5nO1xuICAgIH1cbiAgfVxuXG4gIGNyZWF0ZUJpcnRoUGxhY2VJZk5lZWRlZCgpIHtcbiAgICBpZiAoIXRoaXMuYmlydGhQbGFjZSkge1xuICAgICAgdGhpcy5iaXJ0aFBsYWNlID0gbmV3IFd0c1BsYWNlKCk7XG4gICAgfVxuICB9XG5cbiAgc2V0QmlydGhQbGFjZSh2YWx1ZSkge1xuICAgIGlmICh2YWx1ZSkge1xuICAgICAgdGhpcy5jcmVhdGVCaXJ0aFBsYWNlSWZOZWVkZWQoKTtcbiAgICAgIHRoaXMuYmlydGhQbGFjZS5wbGFjZVN0cmluZyA9IHZhbHVlO1xuICAgIH1cbiAgfVxuXG4gIGNyZWF0ZURlYXRoRGF0ZUlmTmVlZGVkKCkge1xuICAgIGlmICghdGhpcy5kZWF0aERhdGUpIHtcbiAgICAgIHRoaXMuZGVhdGhEYXRlID0gbmV3IFd0c0RhdGUoKTtcbiAgICB9XG4gIH1cblxuICBzZXREZWF0aERhdGUoc3RyaW5nKSB7XG4gICAgaWYgKHRoaXMuaXNVc2FibGVEYXRlU3RyaW5nKHN0cmluZykpIHtcbiAgICAgIHRoaXMuY3JlYXRlRGVhdGhEYXRlSWZOZWVkZWQoKTtcbiAgICAgIHRoaXMuZGVhdGhEYXRlLnNldERhdGVBbmRRdWFsaWZpZXJGcm9tU3RyaW5nKHN0cmluZyk7XG4gICAgfVxuICB9XG5cbiAgc2V0RGVhdGhZZWFyKHN0cmluZykge1xuICAgIGlmICh0aGlzLmlzVXNhYmxlRGF0ZVN0cmluZyhzdHJpbmcpKSB7XG4gICAgICB0aGlzLmNyZWF0ZURlYXRoRGF0ZUlmTmVlZGVkKCk7XG4gICAgICB0aGlzLmRlYXRoRGF0ZS5zZXREYXRlQW5kUXVhbGlmaWVyRnJvbVN0cmluZyhzdHJpbmcsIHRydWUpO1xuICAgIH1cbiAgfVxuXG4gIGNyZWF0ZURlYXRoUGxhY2VJZk5lZWRlZCgpIHtcbiAgICBpZiAoIXRoaXMuZGVhdGhQbGFjZSkge1xuICAgICAgdGhpcy5kZWF0aFBsYWNlID0gbmV3IFd0c1BsYWNlKCk7XG4gICAgfVxuICB9XG5cbiAgc2V0RGVhdGhQbGFjZSh2YWx1ZSkge1xuICAgIGlmICh2YWx1ZSkge1xuICAgICAgdGhpcy5jcmVhdGVEZWF0aFBsYWNlSWZOZWVkZWQoKTtcbiAgICAgIHRoaXMuZGVhdGhQbGFjZS5wbGFjZVN0cmluZyA9IHZhbHVlO1xuICAgIH1cbiAgfVxuXG4gIGNyZWF0ZUV2ZW50RGF0ZUlmTmVlZGVkKCkge1xuICAgIGlmICghdGhpcy5ldmVudERhdGUpIHtcbiAgICAgIHRoaXMuZXZlbnREYXRlID0gbmV3IFd0c0RhdGUoKTtcbiAgICB9XG4gIH1cblxuICBzZXRFdmVudERhdGUoc3RyaW5nKSB7XG4gICAgaWYgKHRoaXMuaXNVc2FibGVEYXRlU3RyaW5nKHN0cmluZykpIHtcbiAgICAgIHRoaXMuY3JlYXRlRXZlbnREYXRlSWZOZWVkZWQoKTtcbiAgICAgIHRoaXMuZXZlbnREYXRlLmRhdGVTdHJpbmcgPSBzdHJpbmc7XG4gICAgfVxuICB9XG5cbiAgc2V0RXZlbnRZZWFyKHN0cmluZykge1xuICAgIGlmICh0aGlzLmlzVXNhYmxlRGF0ZVN0cmluZyhzdHJpbmcpKSB7XG4gICAgICB0aGlzLmNyZWF0ZUV2ZW50RGF0ZUlmTmVlZGVkKCk7XG4gICAgICB0aGlzLmV2ZW50RGF0ZS55ZWFyU3RyaW5nID0gc3RyaW5nO1xuICAgIH1cbiAgfVxuXG4gIHNldEV2ZW50UXVhcnRlcih2YWx1ZSkge1xuICAgIGlmICh0eXBlb2YgdmFsdWUgIT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgIHRoaXMuY3JlYXRlRXZlbnREYXRlSWZOZWVkZWQoKTtcbiAgICAgIHRoaXMuZXZlbnREYXRlLnF1YXJ0ZXIgPSB2YWx1ZTtcbiAgICB9XG4gIH1cblxuICBjcmVhdGVFdmVudFBsYWNlSWZOZWVkZWQoKSB7XG4gICAgaWYgKCF0aGlzLmV2ZW50UGxhY2UpIHtcbiAgICAgIHRoaXMuZXZlbnRQbGFjZSA9IG5ldyBXdHNQbGFjZSgpO1xuICAgIH1cbiAgfVxuXG4gIHNldEV2ZW50UGxhY2UodmFsdWUpIHtcbiAgICBpZiAodmFsdWUpIHtcbiAgICAgIHRoaXMuY3JlYXRlRXZlbnRQbGFjZUlmTmVlZGVkKCk7XG4gICAgICB0aGlzLmV2ZW50UGxhY2UucGxhY2VTdHJpbmcgPSB2YWx1ZTtcbiAgICB9XG4gIH1cblxuICBzZXRFdmVudENvdW50cnkodmFsdWUpIHtcbiAgICBpZiAodmFsdWUpIHtcbiAgICAgIHRoaXMuY3JlYXRlRXZlbnRQbGFjZUlmTmVlZGVkKCk7XG4gICAgICB0aGlzLmV2ZW50UGxhY2UuY291bnRyeSA9IHZhbHVlO1xuICAgIH1cbiAgfVxuXG4gIHNldEV2ZW50Q291bnR5KHZhbHVlKSB7XG4gICAgaWYgKHZhbHVlKSB7XG4gICAgICB0aGlzLmNyZWF0ZUV2ZW50UGxhY2VJZk5lZWRlZCgpO1xuICAgICAgdGhpcy5ldmVudFBsYWNlLmNvdW50eSA9IHZhbHVlO1xuICAgIH1cbiAgfVxuXG4gIGNyZWF0ZVJlc2lkZW5jZVBsYWNlSWZOZWVkZWQoKSB7XG4gICAgaWYgKCF0aGlzLnJlc2lkZW5jZVBsYWNlKSB7XG4gICAgICB0aGlzLnJlc2lkZW5jZVBsYWNlID0gbmV3IFd0c1BsYWNlKCk7XG4gICAgfVxuICB9XG5cbiAgc2V0UmVzaWRlbmNlUGxhY2UodmFsdWUpIHtcbiAgICBpZiAodmFsdWUpIHtcbiAgICAgIHRoaXMuY3JlYXRlUmVzaWRlbmNlUGxhY2VJZk5lZWRlZCgpO1xuICAgICAgdGhpcy5yZXNpZGVuY2VQbGFjZS5wbGFjZVN0cmluZyA9IHZhbHVlO1xuICAgIH1cbiAgfVxuXG4gIHNldEZpZWxkSWZWYWx1ZUV4aXN0cyhmaWVsZE5hbWUsIHZhbHVlKSB7XG4gICAgaWYgKGZpZWxkTmFtZSAmJiB2YWx1ZSkge1xuICAgICAgdGhpc1tmaWVsZE5hbWVdID0gdmFsdWU7XG4gICAgfVxuICB9XG5cbiAgc2V0UGVyc29uR2VuZGVyKHZhbHVlKSB7XG4gICAgdmFsdWUgPSBHRC5zdGFuZGFyZGl6ZUdlbmRlcih2YWx1ZSk7XG4gICAgaWYgKHZhbHVlKSB7XG4gICAgICB0aGlzLnBlcnNvbkdlbmRlciA9IHZhbHVlO1xuICAgIH1cbiAgfVxuXG4gIHNldE1hcml0YWxTdGF0dXModmFsdWUpIHtcbiAgICB2YWx1ZSA9IEdELnN0YW5kYXJkaXplTWFyaXRhbFN0YXR1cyh2YWx1ZSk7XG4gICAgaWYgKHZhbHVlKSB7XG4gICAgICB0aGlzLm1hcml0YWxTdGF0dXMgPSB2YWx1ZTtcbiAgICB9XG4gIH1cblxuICBzZXRSZWxhdGlvbnNoaXBUb0hlYWQodmFsdWUpIHtcbiAgICB2YWx1ZSA9IEdELnN0YW5kYXJkaXplUmVsYXRpb25zaGlwVG9IZWFkKHZhbHVlKTtcbiAgICBpZiAodmFsdWUpIHtcbiAgICAgIHRoaXMucmVsYXRpb25zaGlwVG9IZWFkID0gdmFsdWU7XG4gICAgfVxuICB9XG5cbiAgc2V0T2NjdXBhdGlvbih2YWx1ZSkge1xuICAgIHZhbHVlID0gR0Quc3RhbmRhcmRpemVPY2N1cGF0aW9uKHZhbHVlKTtcbiAgICBpZiAodmFsdWUpIHtcbiAgICAgIHRoaXMub2NjdXBhdGlvbiA9IHZhbHVlO1xuICAgIH1cbiAgfVxuXG4gIGFkZFNwb3VzZSgpIHtcbiAgICBpZiAodGhpcy5zcG91c2VzID09IHVuZGVmaW5lZCkge1xuICAgICAgdGhpcy5zcG91c2VzID0gW107XG4gICAgfVxuXG4gICAgbGV0IHNwb3VzZSA9IHt9O1xuICAgIHNwb3VzZS5uYW1lID0gbmV3IFd0c05hbWUoKTtcbiAgICBzcG91c2UubWFycmlhZ2VEYXRlID0gbmV3IFd0c0RhdGUoKTtcbiAgICBzcG91c2UubWFycmlhZ2VQbGFjZSA9IG5ldyBXdHNQbGFjZSgpO1xuXG4gICAgdGhpcy5zcG91c2VzLnB1c2goc3BvdXNlKTtcblxuICAgIHJldHVybiBzcG91c2U7XG4gIH1cblxuICBhZGRNb3RoZXIoKSB7XG4gICAgaWYgKHRoaXMucGFyZW50cyA9PSB1bmRlZmluZWQpIHtcbiAgICAgIHRoaXMucGFyZW50cyA9IHt9O1xuICAgIH1cblxuICAgIGlmICh0aGlzLnBhcmVudHMubW90aGVyID09IHVuZGVmaW5lZCkge1xuICAgICAgdGhpcy5wYXJlbnRzLm1vdGhlciA9IHt9O1xuICAgIH1cblxuICAgIGlmICh0aGlzLnBhcmVudHMubW90aGVyLm5hbWUgPT0gdW5kZWZpbmVkKSB7XG4gICAgICB0aGlzLnBhcmVudHMubW90aGVyLm5hbWUgPSBuZXcgV3RzTmFtZSgpO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLnBhcmVudHMubW90aGVyO1xuICB9XG5cbiAgYWRkRmF0aGVyKCkge1xuICAgIGlmICh0aGlzLnBhcmVudHMgPT0gdW5kZWZpbmVkKSB7XG4gICAgICB0aGlzLnBhcmVudHMgPSB7fTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5wYXJlbnRzLmZhdGhlciA9PSB1bmRlZmluZWQpIHtcbiAgICAgIHRoaXMucGFyZW50cy5mYXRoZXIgPSB7fTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5wYXJlbnRzLmZhdGhlci5uYW1lID09IHVuZGVmaW5lZCkge1xuICAgICAgdGhpcy5wYXJlbnRzLmZhdGhlci5uYW1lID0gbmV3IFd0c05hbWUoKTtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5wYXJlbnRzLmZhdGhlcjtcbiAgfVxuXG4gIGFkZFNwb3VzZU9yUGFyZW50c0ZvclNlbGVjdGVkSG91c2Vob2xkTWVtYmVyKCkge1xuICAgIGxldCBtZW1iZXJzID0gdGhpcy5ob3VzZWhvbGRBcnJheTtcbiAgICBpZiAoIW1lbWJlcnMgfHwgbWVtYmVycy5sZW5ndGggPD0gMSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGxldCBnZCA9IHRoaXM7XG5cbiAgICBmdW5jdGlvbiBmaW5kSG91c2Vob2xkTWVtYmVyQnlSZWxhdGlvbnNoaXAocmVsYXRpb25zaGlwKSB7XG4gICAgICBmb3IgKGxldCBtZW1iZXIgb2YgbWVtYmVycykge1xuICAgICAgICBpZiAobWVtYmVyLnJlbGF0aW9uc2hpcCA9PSByZWxhdGlvbnNoaXApIHtcbiAgICAgICAgICByZXR1cm4gbWVtYmVyO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGFkZFBhcmVudFdpdGhSZWxhdGlvbnNoaXAocmVsYXRpb25zaGlwLCBhZGRQYXJlbnQpIHtcbiAgICAgIGxldCBtZW1iZXIgPSBmaW5kSG91c2Vob2xkTWVtYmVyQnlSZWxhdGlvbnNoaXAocmVsYXRpb25zaGlwKTtcbiAgICAgIGlmIChtZW1iZXIpIHtcbiAgICAgICAgbGV0IHBhcmVudCA9IGFkZFBhcmVudCgpO1xuICAgICAgICBwYXJlbnQubmFtZS5zZXRGdWxsTmFtZShtZW1iZXIubmFtZSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gYWRkRmF0aGVyKCkge1xuICAgICAgcmV0dXJuIGdkLmFkZEZhdGhlcigpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGFkZE1vdGhlcigpIHtcbiAgICAgIHJldHVybiBnZC5hZGRNb3RoZXIoKTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5yZWxhdGlvbnNoaXBUb0hlYWQpIHtcbiAgICAgIGlmICh0aGlzLnJlbGF0aW9uc2hpcFRvSGVhZCA9PSBcImhlYWRcIikge1xuICAgICAgICAvLyBsb29rIGZvciBzcG91c2VcbiAgICAgICAgaWYgKCF0aGlzLm1hcml0YWxTdGF0dXMgfHwgdGhpcy5tYXJpdGFsU3RhdHVzID09IFwibWFycmllZFwiKSB7XG4gICAgICAgICAgbGV0IHdpZmUgPSBmaW5kSG91c2Vob2xkTWVtYmVyQnlSZWxhdGlvbnNoaXAoXCJ3aWZlXCIpO1xuICAgICAgICAgIGlmICh3aWZlKSB7XG4gICAgICAgICAgICAvLyBjb3VsZCB0aGVyZSBiZSBtb3JlIHRoYW4gb25lIG1lbWJlciB3aXRoIHJlbGF0aW9uc2hpcCBvZiB3aWZlP1xuICAgICAgICAgICAgLy8gc2VlbXMgbGlrZSBhbiBlcnJvciBidXQgY291bGQgaGFwcGVuLiBNaWdodCBiZSBzYWZlc3QgdG8gY2hlY2sgdGhpcyB3aWZlIG1lbWJlciBjb21lc1xuICAgICAgICAgICAgLy8gaW1tZWRpYXRlbHkgYWZ0ZXIgdGhpcyBwZXJzb24uXG4gICAgICAgICAgICBsZXQgdGhpc0luZGV4ID0gdGhpcy5ob3VzZWhvbGRBcnJheS5maW5kSW5kZXgoZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnQuaXNTZWxlY3RlZDtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgbGV0IHdpZmVJbmRleCA9IHRoaXMuaG91c2Vob2xkQXJyYXkuaW5kZXhPZih3aWZlKTtcblxuICAgICAgICAgICAgaWYgKHRoaXNJbmRleCAhPSAtMSAmJiB3aWZlSW5kZXggPT0gdGhpc0luZGV4ICsgMSkge1xuICAgICAgICAgICAgICAvLyBhZGQgYSBzcG91c2VcbiAgICAgICAgICAgICAgbGV0IHNwb3VzZSA9IHRoaXMuYWRkU3BvdXNlKCk7XG4gICAgICAgICAgICAgIHNwb3VzZS5uYW1lLnNldEZ1bGxOYW1lKHdpZmUubmFtZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgYWRkUGFyZW50V2l0aFJlbGF0aW9uc2hpcChcImZhdGhlclwiLCBhZGRGYXRoZXIpO1xuICAgICAgICBhZGRQYXJlbnRXaXRoUmVsYXRpb25zaGlwKFwibW90aGVyXCIsIGFkZE1vdGhlcik7XG4gICAgICB9IGVsc2UgaWYgKHRoaXMucmVsYXRpb25zaGlwVG9IZWFkID09IFwid2lmZVwiKSB7XG4gICAgICAgIC8vIGxvb2sgZm9yIHNwb3VzZVxuICAgICAgICBpZiAoIXRoaXMubWFyaXRhbFN0YXR1cyB8fCB0aGlzLm1hcml0YWxTdGF0dXMgPT0gXCJtYXJyaWVkXCIpIHtcbiAgICAgICAgICBsZXQgaGVhZCA9IGZpbmRIb3VzZWhvbGRNZW1iZXJCeVJlbGF0aW9uc2hpcChcImhlYWRcIik7XG4gICAgICAgICAgaWYgKGhlYWQpIHtcbiAgICAgICAgICAgIC8vIGNvdWxkIHRoZXJlIGJlIG1vcmUgdGhhbiBvbmUgbWVtYmVyIHdpdGggcmVsYXRpb25zaGlwIG9mIGhlYWQgb3Igd2lmZT9cbiAgICAgICAgICAgIC8vIHNlZW1zIGxpa2UgYW4gZXJyb3IgYnV0IGNvdWxkIGhhcHBlbi4gTWlnaHQgYmUgc2FmZXN0IHRvIGNoZWNrIHRoaXMgd2lmZSBtZW1iZXIgY29tZXNcbiAgICAgICAgICAgIC8vIGltbWVkaWF0ZWx5IGFmdGVyIHRoZSBoZWFkIHBlcnNvbi5cbiAgICAgICAgICAgIGxldCB0aGlzSW5kZXggPSB0aGlzLmhvdXNlaG9sZEFycmF5LmZpbmRJbmRleChmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgICAgICAgICByZXR1cm4gZWxlbWVudC5pc1NlbGVjdGVkO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBsZXQgaGVhZEluZGV4ID0gdGhpcy5ob3VzZWhvbGRBcnJheS5pbmRleE9mKGhlYWQpO1xuXG4gICAgICAgICAgICBpZiAoaGVhZEluZGV4ICE9IC0xICYmIHRoaXNJbmRleCA9PSBoZWFkSW5kZXggKyAxKSB7XG4gICAgICAgICAgICAgIC8vIGFkZCBhIHNwb3VzZVxuICAgICAgICAgICAgICBsZXQgc3BvdXNlID0gdGhpcy5hZGRTcG91c2UoKTtcbiAgICAgICAgICAgICAgc3BvdXNlLm5hbWUuc2V0RnVsbE5hbWUoaGVhZC5uYW1lKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBhZGRQYXJlbnRXaXRoUmVsYXRpb25zaGlwKFwiZmF0aGVyLWluLWxhd1wiLCBhZGRGYXRoZXIpO1xuICAgICAgICBhZGRQYXJlbnRXaXRoUmVsYXRpb25zaGlwKFwibW90aGVyLWluLWxhd1wiLCBhZGRNb3RoZXIpO1xuICAgICAgfSBlbHNlIGlmICh0aGlzLnJlbGF0aW9uc2hpcFRvSGVhZCA9PSBcInNvblwiIHx8IHRoaXMucmVsYXRpb25zaGlwVG9IZWFkID09IFwiZGF1Z2h0ZXJcIikge1xuICAgICAgICAvLyB3ZSBoYXZlIHRvIGJlIGNhcmVmdWwsIHNlZSBodHRwczovL3d3dy5maW5kbXlwYXN0LmNvLnVrL3RyYW5zY3JpcHQ/aWQ9R0JDLzE4NTEvMDAxNjk0MjUxOCZleHBhbmQ9dHJ1ZVxuICAgICAgICAvLyBmb3IgYW4gZXhhbXBsZSBvZiBhIGRhdWdodGVyIHdobyBpcyBub3QgcmVsYXRlZCB0byB0aGUgaGVhZFxuICAgICAgICAvLyBJZiB0aGVyZSBhcmUgYW55IG5vbi1mYW1pbHkgbWVtYmVycyBiZWZvcmUgdGhpcyBwZXJzb24gaW4gdGhlIGhvdXNlaG9sZCB0aGVuIGRvbid0IGFkZCBwYXJlbnRzLlxuICAgICAgICAvLyBGb3Igbm93IGJlIHN1cGVyIHJlc3RyaWNpdmUuIElmIHRoZXJlIGlzIGFueSBtZW1iZXIgd2hvIGlzIG5vdCBhIGhlYWQsIHdpZmUsIHNvbiBvciBkYXVnaHRlclxuICAgICAgICAvLyBiZWZvcmUgdGhlIHNlbGVjdGVkIHBlcnNvbiB0aGVuIGRvIG5vdCBhc3N1bWUgaGVhZCBpcyBhIHBhcmVudC5cbiAgICAgICAgbGV0IGNsb3NlRmFtaWx5UmVsYXRpb25zaGlwcyA9IFtcImhlYWRcIiwgXCJ3aWZlXCIsIFwic29uXCIsIFwiZGF1Z2h0ZXJcIl07XG4gICAgICAgIGxldCBpc0ZhbWlseU1lbWJlciA9IHRydWU7XG4gICAgICAgIGZvciAobGV0IG1lbWJlciBvZiBtZW1iZXJzKSB7XG4gICAgICAgICAgaWYgKG1lbWJlci5pc1NlbGVjdGVkKSB7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKCFjbG9zZUZhbWlseVJlbGF0aW9uc2hpcHMuaW5jbHVkZXMobWVtYmVyLnJlbGF0aW9uc2hpcCkpIHtcbiAgICAgICAgICAgIGlzRmFtaWx5TWVtYmVyID0gZmFsc2U7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoaXNGYW1pbHlNZW1iZXIpIHtcbiAgICAgICAgICBsZXQgaGVhZCA9IGZpbmRIb3VzZWhvbGRNZW1iZXJCeVJlbGF0aW9uc2hpcChcImhlYWRcIik7XG4gICAgICAgICAgaWYgKGhlYWQpIHtcbiAgICAgICAgICAgIGlmIChoZWFkLmdlbmRlciA9PSBcIm1hbGVcIikge1xuICAgICAgICAgICAgICBhZGRQYXJlbnRXaXRoUmVsYXRpb25zaGlwKFwiaGVhZFwiLCBhZGRGYXRoZXIpO1xuXG4gICAgICAgICAgICAgIGxldCBoZWFkSW5kZXggPSB0aGlzLmhvdXNlaG9sZEFycmF5LmZpbmRJbmRleChmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBlbGVtZW50LnJlbGF0aW9uc2hpcCA9PSBcImhlYWRcIjtcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIGxldCB3aWZlSW5kZXggPSB0aGlzLmhvdXNlaG9sZEFycmF5LmZpbmRJbmRleChmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBlbGVtZW50LnJlbGF0aW9uc2hpcCA9PSBcIndpZmVcIjtcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIGlmICh3aWZlSW5kZXggIT0gLTEgJiYgd2lmZUluZGV4ID09IGhlYWRJbmRleCArIDEpIHtcbiAgICAgICAgICAgICAgICBhZGRQYXJlbnRXaXRoUmVsYXRpb25zaGlwKFwid2lmZVwiLCBhZGRNb3RoZXIpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGhlYWQuZ2VuZGVyID09IFwiZmVtYWxlXCIpIHtcbiAgICAgICAgICAgICAgYWRkUGFyZW50V2l0aFJlbGF0aW9uc2hpcChcImhlYWRcIiwgYWRkTW90aGVyKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIC8vIHNvbWUgY2Vuc3VzIHRyYW5zY3JpcHRpb25zIChlLmcuIEFuY2VzdHJ5KSBkbyBub3QgaGF2ZSB0aGUgZ2VuZGVyLlxuICAgICAgICAgICAgICAvLyBJbiBob3VzZWhvbGQgdGFibGVzIGl0IGRpZ3MgZGVlcGVyIHRvIGdldCB0aGlzLlxuICAgICAgICAgICAgICAvLyBXZSBjYW4ndCBhc3N1bWUgd2hpY2ggdGhlIGhlYWQgaXMgLSBmYXRoZXIgb3IgbW90aGVyIC0gdW5sZXNzIHRoZXJlIGlzIGEgd2lmZS5cbiAgICAgICAgICAgICAgbGV0IGhlYWRJbmRleCA9IHRoaXMuaG91c2Vob2xkQXJyYXkuZmluZEluZGV4KGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnQucmVsYXRpb25zaGlwID09IFwiaGVhZFwiO1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgbGV0IHdpZmVJbmRleCA9IHRoaXMuaG91c2Vob2xkQXJyYXkuZmluZEluZGV4KGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnQucmVsYXRpb25zaGlwID09IFwid2lmZVwiO1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgaWYgKHdpZmVJbmRleCAhPSAtMSAmJiB3aWZlSW5kZXggPT0gaGVhZEluZGV4ICsgMSkge1xuICAgICAgICAgICAgICAgIGFkZFBhcmVudFdpdGhSZWxhdGlvbnNoaXAoXCJoZWFkXCIsIGFkZEZhdGhlcik7XG4gICAgICAgICAgICAgICAgYWRkUGFyZW50V2l0aFJlbGF0aW9uc2hpcChcIndpZmVcIiwgYWRkTW90aGVyKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmICh0aGlzLnJlbGF0aW9uc2hpcFRvSGVhZCA9PSBcIndpZmUncyBzb25cIiB8fCB0aGlzLnJlbGF0aW9uc2hpcFRvSGVhZCA9PSBcIndpZmUncyBkYXVnaHRlclwiKSB7XG4gICAgICAgIGxldCBjbG9zZUZhbWlseVJlbGF0aW9uc2hpcHMgPSBbXCJoZWFkXCIsIFwid2lmZVwiLCBcInNvblwiLCBcImRhdWdodGVyXCIsIFwid2lmZSdzIHNvblwiLCBcIndpZmUncyBkYXVnaHRlclwiXTtcbiAgICAgICAgbGV0IGlzRmFtaWx5TWVtYmVyID0gdHJ1ZTtcbiAgICAgICAgZm9yIChsZXQgbWVtYmVyIG9mIG1lbWJlcnMpIHtcbiAgICAgICAgICBpZiAobWVtYmVyLmlzU2VsZWN0ZWQpIHtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoIWNsb3NlRmFtaWx5UmVsYXRpb25zaGlwcy5pbmNsdWRlcyhtZW1iZXIucmVsYXRpb25zaGlwKSkge1xuICAgICAgICAgICAgaXNGYW1pbHlNZW1iZXIgPSBmYWxzZTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChpc0ZhbWlseU1lbWJlcikge1xuICAgICAgICAgIGxldCBoZWFkID0gZmluZEhvdXNlaG9sZE1lbWJlckJ5UmVsYXRpb25zaGlwKFwiaGVhZFwiKTtcbiAgICAgICAgICBpZiAoaGVhZCAmJiBoZWFkLmdlbmRlciA9PSBcIm1hbGVcIikge1xuICAgICAgICAgICAgbGV0IGhlYWRJbmRleCA9IHRoaXMuaG91c2Vob2xkQXJyYXkuZmluZEluZGV4KGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgICAgICAgICAgIHJldHVybiBlbGVtZW50LnJlbGF0aW9uc2hpcCA9PSBcImhlYWRcIjtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgbGV0IHdpZmVJbmRleCA9IHRoaXMuaG91c2Vob2xkQXJyYXkuZmluZEluZGV4KGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgICAgICAgICAgIHJldHVybiBlbGVtZW50LnJlbGF0aW9uc2hpcCA9PSBcIndpZmVcIjtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgaWYgKHdpZmVJbmRleCAhPSAtMSAmJiB3aWZlSW5kZXggPT0gaGVhZEluZGV4ICsgMSkge1xuICAgICAgICAgICAgICBhZGRQYXJlbnRXaXRoUmVsYXRpb25zaGlwKFwid2lmZVwiLCBhZGRNb3RoZXIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8vIHJldHVybiBhbiBhcnJheSBvZiBsYXN0IG5hbWVzXG4gIGluZmVyUGVyc29uTGFzdE5hbWVzQXJyYXkocGVyc29uKSB7XG4gICAgdmFyIGxhc3ROYW1lcyA9IFtdO1xuXG4gICAgaWYgKHBlcnNvbi5sYXN0TmFtZUF0QmlydGgpIHtcbiAgICAgIGxhc3ROYW1lcy5wdXNoKHBlcnNvbi5sYXN0TmFtZUF0QmlydGgpO1xuICAgIH1cbiAgICBpZiAocGVyc29uLmxhc3ROYW1lQXREZWF0aCkge1xuICAgICAgaWYgKHBlcnNvbi5sYXN0TmFtZUF0RGVhdGggIT0gcGVyc29uLmxhc3ROYW1lQXRCaXJ0aCkge1xuICAgICAgICBsYXN0TmFtZXMucHVzaChwZXJzb24ubGFzdE5hbWVBdERlYXRoKTtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKHBlcnNvbi5uYW1lKSB7XG4gICAgICBsZXQgbGFzdE5hbWUgPSBwZXJzb24ubmFtZS5pbmZlckxhc3ROYW1lKCk7XG4gICAgICBpZiAobGFzdE5hbWUgJiYgIWxhc3ROYW1lcy5pbmNsdWRlcyhsYXN0TmFtZSkpIHtcbiAgICAgICAgbGFzdE5hbWVzLnB1c2gobGFzdE5hbWUpO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAocGVyc29uLnNwb3VzZXMgJiYgcGVyc29uLnBlcnNvbkdlbmRlciA9PSBcImZlbWFsZVwiKSB7XG4gICAgICBmb3IgKGxldCBzcG91c2Ugb2YgcGVyc29uLnNwb3VzZXMpIHtcbiAgICAgICAgaWYgKHNwb3VzZS5uYW1lKSB7XG4gICAgICAgICAgbGV0IGxhc3ROYW1lID0gc3BvdXNlLm5hbWUuaW5mZXJMYXN0TmFtZSgpO1xuICAgICAgICAgIGlmIChsYXN0TmFtZSAmJiAhbGFzdE5hbWVzLmluY2x1ZGVzKGxhc3ROYW1lKSkge1xuICAgICAgICAgICAgbGFzdE5hbWVzLnB1c2gobGFzdE5hbWUpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBsYXN0TmFtZXM7XG4gIH1cblxuICBpbmZlckxhc3ROYW1lcygpIHtcbiAgICByZXR1cm4gdGhpcy5pbmZlclBlcnNvbkxhc3ROYW1lcyh0aGlzKTtcbiAgfVxuXG4gIGluZmVyUGVyc29uTGFzdE5hbWVzKHBlcnNvbikge1xuICAgIGxldCBsYXN0TmFtZXMgPSBcIlwiO1xuICAgIGxldCBsYXN0TmFtZXNBcnJheSA9IHRoaXMuaW5mZXJQZXJzb25MYXN0TmFtZXNBcnJheShwZXJzb24pO1xuICAgIGlmIChsYXN0TmFtZXNBcnJheS5sZW5ndGggPiAwKSB7XG4gICAgICBmb3IgKGxldCBuYW1lIG9mIGxhc3ROYW1lc0FycmF5KSB7XG4gICAgICAgIGlmIChsYXN0TmFtZXMgIT0gXCJcIikge1xuICAgICAgICAgIGxhc3ROYW1lcyArPSBcIiBcIjtcbiAgICAgICAgfVxuICAgICAgICBsYXN0TmFtZXMgKz0gbmFtZTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGxhc3ROYW1lcztcbiAgfVxuXG4gIC8vIHJldHVybiBhIHN0cmluZyBvZiBzcGFjZSBzZXBhcmF0ZWQgZm9yZW5hbWVzXG4gIGluZmVyRm9yZW5hbWVzKCkge1xuICAgIGxldCBmb3JlbmFtZXMgPSBcIlwiO1xuXG4gICAgaWYgKHRoaXMubmFtZSkge1xuICAgICAgZm9yZW5hbWVzID0gdGhpcy5uYW1lLmluZmVyRm9yZW5hbWVzKCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGZvcmVuYW1lcztcbiAgfVxuXG4gIGluZmVyRnVsbE5hbWUoKSB7XG4gICAgbGV0IGZ1bGxOYW1lID0gXCJcIjtcblxuICAgIGlmICh0aGlzLm5hbWUpIHtcbiAgICAgIGZ1bGxOYW1lID0gdGhpcy5uYW1lLmluZmVyRnVsbE5hbWUoKTtcbiAgICB9XG5cbiAgICByZXR1cm4gZnVsbE5hbWU7XG4gIH1cblxuICBpbmZlckZpcnN0TmFtZSgpIHtcbiAgICBsZXQgZmlyc3ROYW1lID0gXCJcIjtcblxuICAgIGlmICh0aGlzLm5hbWUpIHtcbiAgICAgIGZpcnN0TmFtZSA9IHRoaXMubmFtZS5pbmZlckZpcnN0TmFtZSgpO1xuICAgIH1cblxuICAgIHJldHVybiBmaXJzdE5hbWU7XG4gIH1cblxuICBpbmZlclNlY29uZEZvcmVuYW1lKCkge1xuICAgIGxldCBzZWNvbmRGb3JlbmFtZSA9IFwiXCI7XG5cbiAgICBpZiAodGhpcy5uYW1lKSB7XG4gICAgICBzZWNvbmRGb3JlbmFtZSA9IHRoaXMubmFtZS5pbmZlclNlY29uZEZvcmVuYW1lKCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHNlY29uZEZvcmVuYW1lO1xuICB9XG5cbiAgaW5mZXJNaWRkbGVOYW1lKCkge1xuICAgIGxldCBtaWRkbGVOYW1lID0gXCJcIjtcblxuICAgIGlmICh0aGlzLm5hbWUpIHtcbiAgICAgIG1pZGRsZU5hbWUgPSB0aGlzLm5hbWUuaW5mZXJNaWRkbGVOYW1lKCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIG1pZGRsZU5hbWU7XG4gIH1cblxuICBpbmZlck1pZGRsZU5hbWVzKCkge1xuICAgIGxldCBtaWRkbGVOYW1lcyA9IFwiXCI7XG5cbiAgICBpZiAodGhpcy5uYW1lKSB7XG4gICAgICBtaWRkbGVOYW1lcyA9IHRoaXMubmFtZS5pbmZlck1pZGRsZU5hbWVzKCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIG1pZGRsZU5hbWVzO1xuICB9XG5cbiAgaW5mZXJMYXN0TmFtZSgpIHtcbiAgICBsZXQgbGFzdE5hbWUgPSBcIlwiO1xuXG4gICAgaWYgKHRoaXMubmFtZSkge1xuICAgICAgcmV0dXJuIHRoaXMubmFtZS5pbmZlckxhc3ROYW1lKCk7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMubGFzdE5hbWVBdEJpcnRoKSB7XG4gICAgICByZXR1cm4gdGhpcy5sYXN0TmFtZUF0QmlydGg7XG4gICAgfVxuICAgIGlmICh0aGlzLmxhc3ROYW1lQXREZWF0aCkge1xuICAgICAgcmV0dXJuIHRoaXMubGFzdE5hbWVBdERlYXRoO1xuICAgIH1cblxuICAgIHJldHVybiBsYXN0TmFtZTtcbiAgfVxuXG4gIGluZmVyTGFzdE5hbWVBdEJpcnRoKCkge1xuICAgIGlmICh0aGlzLmxhc3ROYW1lQXRCaXJ0aCkge1xuICAgICAgcmV0dXJuIHRoaXMubGFzdE5hbWVBdEJpcnRoO1xuICAgIH1cblxuICAgIGlmICh0aGlzLm5hbWUpIHtcbiAgICAgIHJldHVybiB0aGlzLm5hbWUuaW5mZXJMYXN0TmFtZSgpO1xuICAgIH1cblxuICAgIHJldHVybiBcIlwiO1xuICB9XG5cbiAgaW5mZXJMYXN0TmFtZUF0RGVhdGgoKSB7XG4gICAgZnVuY3Rpb24gZ2V0U3BvdXNlTG5hYihzcG91c2UpIHtcbiAgICAgIGlmIChzcG91c2UubGFzdE5hbWVBdEJpcnRoKSB7XG4gICAgICAgIHJldHVybiBzcG91c2UubGFzdE5hbWVBdEJpcnRoO1xuICAgICAgfVxuICAgICAgaWYgKHNwb3VzZS5uYW1lKSB7XG4gICAgICAgIHJldHVybiBzcG91c2UubmFtZS5pbmZlckxhc3ROYW1lKCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gdGhpcyBpcyBhIHdvbWFuIGFuZCBoYWQgc3BvdXNlcyBpdCBtYXkgYmUgdGhhdCB0aGUgQ0xOIGhhcyBub3QgYmVlbiBzZXQgdG8gaHVzYmFuZCdzIG5hbWVcbiAgICBsZXQgbG5hYkFuZExuYWRQcmVzZW50QW5kRGlmZmVyZW50ID0gZmFsc2U7XG4gICAgaWYgKHRoaXMubGFzdE5hbWVBdERlYXRoICYmIHRoaXMubGFzdE5hbWVBdEJpcnRoICYmIHRoaXMubGFzdE5hbWVBdERlYXRoICE9IHRoaXMubGFzdE5hbWVBdEJpcnRoKSB7XG4gICAgICBsbmFiQW5kTG5hZFByZXNlbnRBbmREaWZmZXJlbnQgPSB0cnVlO1xuICAgIH1cblxuICAgIGlmICh0aGlzLnBlcnNvbkdlbmRlciA9PSBcImZlbWFsZVwiICYmIHRoaXMuc3BvdXNlcyAmJiAhbG5hYkFuZExuYWRQcmVzZW50QW5kRGlmZmVyZW50KSB7XG4gICAgICBsZXQgbGFzdFNwb3VzZUxhc3ROYW1lID0gXCJcIjtcbiAgICAgIGxldCBsYXN0TWFycmlhZ2VEYXRlID0gdW5kZWZpbmVkO1xuICAgICAgZm9yIChsZXQgc3BvdXNlIG9mIHRoaXMuc3BvdXNlcykge1xuICAgICAgICBpZiAoc3BvdXNlLm1hcnJpYWdlRGF0ZSkge1xuICAgICAgICAgIGxldCBtYXJyaWFnZURhdGUgPSBzcG91c2UubWFycmlhZ2VEYXRlLmdldERhdGVTdHJpbmcoKTtcbiAgICAgICAgICBsZXQgbWFycmlhZ2VQYXJzZWREYXRlID0gV1RTX0RhdGUucGFyc2VEYXRlU3RyaW5nKG1hcnJpYWdlRGF0ZSk7XG4gICAgICAgICAgaWYgKG1hcnJpYWdlUGFyc2VkRGF0ZS5pc1ZhbGlkKSB7XG4gICAgICAgICAgICBpZiAoIWxhc3RNYXJyaWFnZURhdGUpIHtcbiAgICAgICAgICAgICAgbGFzdE1hcnJpYWdlRGF0ZSA9IG1hcnJpYWdlUGFyc2VkRGF0ZTtcbiAgICAgICAgICAgICAgbGFzdFNwb3VzZUxhc3ROYW1lID0gZ2V0U3BvdXNlTG5hYihzcG91c2UpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgbGV0IGRpZmYgPSBXVFNfRGF0ZS5nZXREYXlzQmV0d2VlblBhcnNlZERhdGVzKGxhc3RNYXJyaWFnZURhdGUsIG1hcnJpYWdlUGFyc2VkRGF0ZSk7XG4gICAgICAgICAgICAgIGlmIChkaWZmID4gMCkge1xuICAgICAgICAgICAgICAgIGxhc3RNYXJyaWFnZURhdGUgPSBtYXJyaWFnZVBhcnNlZERhdGU7XG4gICAgICAgICAgICAgICAgbGV0IHNwb3VzZUxuYWIgPSBnZXRTcG91c2VMbmFiKHNwb3VzZSk7XG4gICAgICAgICAgICAgICAgaWYgKHNwb3VzZUxuYWIpIHtcbiAgICAgICAgICAgICAgICAgIGxhc3RTcG91c2VMYXN0TmFtZSA9IHNwb3VzZUxuYWI7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgIC8vIHNvbWV0aW1lcyBhbiBBbmNlc3RyeSBwcm9maWxlIG1pZ2h0IGhhdmUgbXVsdGlwbGUgbWFycmlhZ2VzLCBzb21lIHdpdGggbm8gc3BvdXNlIG5hbWVcbiAgICAgICAgICAgICAgICAgIC8vIElmIHRoaXMgaXMgY2xvc2UgdG8gbGFzdCBtYXJyaWFnZSBpZ25vcmUgaXQgYXMgaXQgcHJvYmFibHkgcmVmZXJlcyB0byB0aGUgc2FtZSBvbmVcbiAgICAgICAgICAgICAgICAgIC8vIChpZiBjb3VsZCBiZSBnZW5lcmF0ZWQgZnJvbSB0aGUgXCJ5ZWFycyBtYXJyaWVkXCIgaW4gdGhlIDE5MTEgY2Vuc3VzIGZvciBleGFtcGxlKVxuICAgICAgICAgICAgICAgICAgLy8gT3RoZXJ3aXNlIGNvdW50IGl0IGFuZCBzZXQgbmFtZSB0byBibGFua1xuICAgICAgICAgICAgICAgICAgaWYgKGRpZmYgPiAzODApIHtcbiAgICAgICAgICAgICAgICAgICAgbGFzdFNwb3VzZUxhc3ROYW1lID0gXCJcIjtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgaWYgKGxhc3RTcG91c2VMYXN0TmFtZSkge1xuICAgICAgICByZXR1cm4gbGFzdFNwb3VzZUxhc3ROYW1lO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmICh0aGlzLmxhc3ROYW1lQXREZWF0aCkge1xuICAgICAgcmV0dXJuIHRoaXMubGFzdE5hbWVBdERlYXRoO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLmluZmVyTGFzdE5hbWUoKTtcbiAgfVxuXG4gIGluZmVyUHJlZml4KCkge1xuICAgIGxldCBwcmVmaXggPSBcIlwiO1xuXG4gICAgaWYgKHRoaXMubmFtZSkge1xuICAgICAgcHJlZml4ID0gdGhpcy5uYW1lLmluZmVyUHJlZml4KCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHByZWZpeDtcbiAgfVxuXG4gIGluZmVyU3VmZml4KCkge1xuICAgIGxldCBzdWZmaXggPSBcIlwiO1xuXG4gICAgaWYgKHRoaXMubmFtZSkge1xuICAgICAgc3VmZml4ID0gdGhpcy5uYW1lLmluZmVyU3VmZml4KCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHN1ZmZpeDtcbiAgfVxuXG4gIGluZmVyQmlydGhEYXRlT2JqKCkge1xuICAgIGlmICh0aGlzLmJpcnRoRGF0ZSkge1xuICAgICAgcmV0dXJuIHRoaXMuYmlydGhEYXRlO1xuICAgIH1cbiAgICBpZiAodGhpcy5kZWF0aERhdGUpIHtcbiAgICAgIGlmICh0aGlzLmFnZUF0RGVhdGgpIHtcbiAgICAgICAgbGV0IGRlYXRoRGF0ZVN0cmluZyA9IHRoaXMuZGVhdGhEYXRlLmdldERhdGVTdHJpbmcoKTtcblxuICAgICAgICBsZXQgZGF0ZVN0cmluZyA9IEdlbmVyYWxpemVkRGF0YS5nZXRTdWJ0cmFjdEFnZUZyb21EYXRlKGRlYXRoRGF0ZVN0cmluZywgdGhpcy5hZ2VBdERlYXRoKTtcbiAgICAgICAgbGV0IHllYXJTdHJpbmcgPSBXVFNfU3RyaW5nLmdldExhc3RXb3JkKGRhdGVTdHJpbmcpO1xuICAgICAgICBsZXQgZGF0ZU9iaiA9IG5ldyBXdHNEYXRlKCk7XG4gICAgICAgIGRhdGVPYmoueWVhclN0cmluZyA9IHllYXJTdHJpbmc7XG4gICAgICAgIGRhdGVPYmoucXVhbGlmaWVyID0gZGF0ZVF1YWxpZmllcnMuQUJPVVQ7XG4gICAgICAgIHJldHVybiBkYXRlT2JqO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAodGhpcy5ldmVudERhdGUgJiYgIXRoaXMucm9sZSkge1xuICAgICAgaWYgKHRoaXMucmVjb3JkVHlwZSA9PSBSVC5CaXJ0aFJlZ2lzdHJhdGlvbiB8fCB0aGlzLnJlY29yZFR5cGUgPT0gUlQuQmlydGgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZXZlbnREYXRlO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAodGhpcy5ldmVudERhdGUgJiYgdGhpcy5hZ2VBdEV2ZW50KSB7XG4gICAgICBsZXQgZXZlbnREYXRlU3RyaW5nID0gdGhpcy5ldmVudERhdGUuZ2V0RGF0ZVN0cmluZygpO1xuICAgICAgbGV0IGRhdGVTdHJpbmcgPSBHZW5lcmFsaXplZERhdGEuZ2V0U3VidHJhY3RBZ2VGcm9tRGF0ZShldmVudERhdGVTdHJpbmcsIHRoaXMuYWdlQXRFdmVudCk7XG4gICAgICBsZXQgeWVhclN0cmluZyA9IFdUU19TdHJpbmcuZ2V0TGFzdFdvcmQoZGF0ZVN0cmluZyk7XG4gICAgICBsZXQgZGF0ZU9iaiA9IG5ldyBXdHNEYXRlKCk7XG4gICAgICBkYXRlT2JqLnllYXJTdHJpbmcgPSB5ZWFyU3RyaW5nO1xuICAgICAgZGF0ZU9iai5xdWFsaWZpZXIgPSBkYXRlUXVhbGlmaWVycy5BQk9VVDtcbiAgICAgIHJldHVybiBkYXRlT2JqO1xuICAgIH1cbiAgfVxuXG4gIGluZmVyQmlydGhZZWFyKCkge1xuICAgIGxldCBkYXRlT2JqID0gdGhpcy5pbmZlckJpcnRoRGF0ZU9iaigpO1xuICAgIGlmIChkYXRlT2JqKSB7XG4gICAgICByZXR1cm4gZGF0ZU9iai5nZXRZZWFyU3RyaW5nKCk7XG4gICAgfVxuICB9XG5cbiAgaW5mZXJCaXJ0aERhdGUoKSB7XG4gICAgbGV0IGRhdGVPYmogPSB0aGlzLmluZmVyQmlydGhEYXRlT2JqKCk7XG4gICAgaWYgKGRhdGVPYmopIHtcbiAgICAgIHJldHVybiBkYXRlT2JqLmdldERhdGVTdHJpbmcoKTtcbiAgICB9XG4gIH1cblxuICBpbmZlckJpcnRoRGF0ZVF1YWxpZmllcigpIHtcbiAgICBsZXQgZGF0ZU9iaiA9IHRoaXMuaW5mZXJCaXJ0aERhdGVPYmooKTtcbiAgICBpZiAoZGF0ZU9iaikge1xuICAgICAgcmV0dXJuIGRhdGVPYmoucXVhbGlmaWVyO1xuICAgIH1cbiAgfVxuXG4gIGluZmVyRGVhdGhEYXRlT2JqKCkge1xuICAgIGlmICh0aGlzLmRlYXRoRGF0ZSkge1xuICAgICAgcmV0dXJuIHRoaXMuZGVhdGhEYXRlO1xuICAgIH1cbiAgICBpZiAodGhpcy5ldmVudERhdGUgJiYgIXRoaXMucm9sZSkge1xuICAgICAgaWYgKHRoaXMucmVjb3JkVHlwZSA9PSBSVC5EZWF0aCB8fCB0aGlzLnJlY29yZFR5cGUgPT0gUlQuRGVhdGhSZWdpc3RyYXRpb24pIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZXZlbnREYXRlO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGluZmVyRGVhdGhZZWFyKCkge1xuICAgIGxldCBkYXRlT2JqID0gdGhpcy5pbmZlckRlYXRoRGF0ZU9iaigpO1xuICAgIGlmIChkYXRlT2JqKSB7XG4gICAgICByZXR1cm4gZGF0ZU9iai5nZXRZZWFyU3RyaW5nKCk7XG4gICAgfVxuICB9XG5cbiAgaW5mZXJEZWF0aERhdGUoKSB7XG4gICAgbGV0IGRhdGVPYmogPSB0aGlzLmluZmVyRGVhdGhEYXRlT2JqKCk7XG4gICAgaWYgKGRhdGVPYmopIHtcbiAgICAgIHJldHVybiBkYXRlT2JqLmdldERhdGVTdHJpbmcoKTtcbiAgICB9XG4gIH1cblxuICBpbmZlckRlYXRoRGF0ZVF1YWxpZmllcigpIHtcbiAgICBsZXQgZGF0ZU9iaiA9IHRoaXMuaW5mZXJEZWF0aERhdGVPYmooKTtcbiAgICBpZiAoZGF0ZU9iaikge1xuICAgICAgcmV0dXJuIGRhdGVPYmoucXVhbGlmaWVyO1xuICAgIH1cbiAgfVxuXG4gIGluZmVyQmlydGhQbGFjZSgpIHtcbiAgICBpZiAodGhpcy5iaXJ0aFBsYWNlKSB7XG4gICAgICByZXR1cm4gdGhpcy5iaXJ0aFBsYWNlLnBsYWNlU3RyaW5nO1xuICAgIH0gZWxzZSBpZiAodGhpcy5yZWNvcmRUeXBlID09IFJULkJpcnRoUmVnaXN0cmF0aW9uKSB7XG4gICAgICAvLyBBbiBldmVudFBsYWNlIGNhbiBjb250YWluIHRoZSBjb3VudHkvY291bnRyeSBzbyBpcyBwcmVmZXJlZCB0byBhIHJlZ2lzdHJhdGlvbkRpc3RyaWN0XG4gICAgICBpZiAodGhpcy5ldmVudFBsYWNlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmV2ZW50UGxhY2UucGxhY2VTdHJpbmc7XG4gICAgICB9IGVsc2UgaWYgKHRoaXMucmVnaXN0cmF0aW9uRGlzdHJpY3QpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucmVnaXN0cmF0aW9uRGlzdHJpY3Q7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmICh0aGlzLnJlY29yZFR5cGUgPT0gUlQuQmFwdGlzbSB8fCB0aGlzLnJlY29yZFR5cGUgPT0gUlQuQmlydGgpIHtcbiAgICAgIGlmICh0aGlzLmV2ZW50UGxhY2UgJiYgIXRoaXMucm9sZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5ldmVudFBsYWNlLnBsYWNlU3RyaW5nO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGluZmVyQmlydGhDb3VudHkoKSB7XG4gICAgbGV0IGJpcnRoUGxhY2UgPSB1bmRlZmluZWQ7XG4gICAgaWYgKHRoaXMuYmlydGhQbGFjZSkge1xuICAgICAgYmlydGhQbGFjZSA9IHRoaXMuYmlydGhQbGFjZTtcbiAgICB9IGVsc2UgaWYgKFxuICAgICAgdGhpcy5yZWNvcmRUeXBlID09IFJULkJpcnRoUmVnaXN0cmF0aW9uIHx8XG4gICAgICB0aGlzLnJlY29yZFR5cGUgPT0gUlQuQmFwdGlzbSB8fFxuICAgICAgdGhpcy5yZWNvcmRUeXBlID09IFJULkJpcnRoXG4gICAgKSB7XG4gICAgICBpZiAodGhpcy5ldmVudFBsYWNlICYmICF0aGlzLnJvbGUpIHtcbiAgICAgICAgYmlydGhQbGFjZSA9IHRoaXMuZXZlbnRQbGFjZTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoYmlydGhQbGFjZSkge1xuICAgICAgcmV0dXJuIGJpcnRoUGxhY2UuaW5mZXJDb3VudHkoKTtcbiAgICB9XG5cbiAgICByZXR1cm4gdW5kZWZpbmVkO1xuICB9XG5cbiAgaW5mZXJEZWF0aFBsYWNlKCkge1xuICAgIGlmICh0aGlzLmRlYXRoUGxhY2UpIHtcbiAgICAgIHJldHVybiB0aGlzLmRlYXRoUGxhY2UucGxhY2VTdHJpbmc7XG4gICAgfSBlbHNlIGlmICh0aGlzLnJlY29yZFR5cGUgPT0gUlQuRGVhdGggfHwgdGhpcy5yZWNvcmRUeXBlID09IFJULkRlYXRoUmVnaXN0cmF0aW9uKSB7XG4gICAgICAvLyBBbiBldmVudFBsYWNlIGNhbiBjb250YWluIHRoZSBjb3VudHkvY291bnRyeSBzbyBpcyBwcmVmZXJlZCB0byBhIHJlZ2lzdHJhdGlvbkRpc3RyaWN0XG4gICAgICBpZiAodGhpcy5ldmVudFBsYWNlICYmICF0aGlzLnJvbGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZXZlbnRQbGFjZS5wbGFjZVN0cmluZztcbiAgICAgIH0gZWxzZSBpZiAodGhpcy5yZWdpc3RyYXRpb25EaXN0cmljdCkge1xuICAgICAgICByZXR1cm4gdGhpcy5yZWdpc3RyYXRpb25EaXN0cmljdDtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBpbmZlckRlYXRoQ291bnR5KCkge1xuICAgIGxldCBkZWF0aFBsYWNlID0gdW5kZWZpbmVkO1xuICAgIGlmICh0aGlzLmRlYXRoUGxhY2UpIHtcbiAgICAgIGRlYXRoUGxhY2UgPSB0aGlzLmRlYXRoUGxhY2U7XG4gICAgfSBlbHNlIGlmICh0aGlzLnJlY29yZFR5cGUgPT0gUlQuRGVhdGhSZWdpc3RyYXRpb24gfHwgdGhpcy5yZWNvcmRUeXBlID09IFJULkJ1cmlhbCB8fCB0aGlzLnJlY29yZFR5cGUgPT0gUlQuRGVhdGgpIHtcbiAgICAgIGlmICh0aGlzLmV2ZW50UGxhY2UgJiYgIXRoaXMucm9sZSkge1xuICAgICAgICBkZWF0aFBsYWNlID0gdGhpcy5ldmVudFBsYWNlO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChkZWF0aFBsYWNlKSB7XG4gICAgICByZXR1cm4gZGVhdGhQbGFjZS5pbmZlckNvdW50eSgpO1xuICAgIH1cblxuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH1cblxuICBpbmZlckRlYXRoQ291bnRyeSgpIHtcbiAgICBsZXQgcGxhY2VOYW1lcyA9IFtdO1xuXG4gICAgbGV0IGRlYXRoUGxhY2UgPSB0aGlzLmluZmVyRGVhdGhQbGFjZSgpO1xuICAgIGlmIChkZWF0aFBsYWNlKSB7XG4gICAgICBwbGFjZU5hbWVzLnB1c2goZGVhdGhQbGFjZSk7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMucmVjb3JkVHlwZSA9PSBSVC5EZWF0aFJlZ2lzdHJhdGlvbiB8fCB0aGlzLnJlY29yZFR5cGUgPT0gUlQuQnVyaWFsIHx8IHRoaXMucmVjb3JkVHlwZSA9PSBSVC5EZWF0aCkge1xuICAgICAgaWYgKHRoaXMuZXZlbnRQbGFjZSAmJiAhdGhpcy5yb2xlKSB7XG4gICAgICAgIHBsYWNlTmFtZXMucHVzaCh0aGlzLmV2ZW50UGxhY2UpO1xuICAgICAgfVxuXG4gICAgICAvLyBDb2xsZWN0aW9uXG4gICAgICBpZiAodGhpcy5jb2xsZWN0aW9uRGF0YSkge1xuICAgICAgICBsZXQgY29sbGVjdGlvbiA9IFJDLmZpbmRDb2xsZWN0aW9uKHRoaXMuc291cmNlT2ZEYXRhLCB0aGlzLmNvbGxlY3Rpb25EYXRhLmlkKTtcbiAgICAgICAgbGV0IGNvdW50cnkgPSBSQy5nZXRDb3VudHJ5RnJvbUNvbGxlY3Rpb24oY29sbGVjdGlvbik7XG4gICAgICAgIGlmIChjb3VudHJ5KSB7XG4gICAgICAgICAgcGxhY2VOYW1lcy5wdXNoKGNvdW50cnkpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXMuaW5mZXJDb3VudHJ5RnJvbVBsYWNlTmFtZXMocGxhY2VOYW1lcyk7XG4gIH1cblxuICBpbmZlclJlc2lkZW5jZVBsYWNlKCkge1xuICAgIGlmICh0aGlzLnJlc2lkZW5jZVBsYWNlKSB7XG4gICAgICByZXR1cm4gdGhpcy5yZXNpZGVuY2VQbGFjZS5wbGFjZVN0cmluZztcbiAgICB9XG4gIH1cblxuICBpbmZlclJlc2lkZW5jZUNvdW50eSgpIHtcbiAgICBpZiAodGhpcy5yZXNpZGVuY2VQbGFjZSkge1xuICAgICAgcmV0dXJuIHRoaXMucmVzaWRlbmNlUGxhY2UuaW5mZXJDb3VudHkoKTtcbiAgICB9XG5cbiAgICByZXR1cm4gdW5kZWZpbmVkO1xuICB9XG5cbiAgaW5mZXJHZW5lcmFsUGxhY2UoKSB7XG4gICAgaWYgKHRoaXMuc291cmNlVHlwZSA9PSBcInJlY29yZFwiKSB7XG4gICAgICByZXR1cm4gdGhpcy5pbmZlckV2ZW50UGxhY2UoKTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5kZWF0aFBsYWNlICYmIHRoaXMuYmlydGhQbGFjZSkge1xuICAgICAgcmV0dXJuIHRoaXMuYmlydGhQbGFjZS5nZXRDb21tb25QbGFjZSh0aGlzLmRlYXRoUGxhY2UpO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmJpcnRoUGxhY2UpIHtcbiAgICAgIHJldHVybiB0aGlzLmJpcnRoUGxhY2UucGxhY2VTdHJpbmc7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuZGVhdGhQbGFjZSkge1xuICAgICAgcmV0dXJuIHRoaXMuZGVhdGhQbGFjZS5wbGFjZVN0cmluZztcbiAgICB9XG5cbiAgICBpZiAodGhpcy5yZXNpZGVuY2VQbGFjZSkge1xuICAgICAgcmV0dXJuIHRoaXMucmVzaWRlbmNlUGxhY2UucGxhY2VTdHJpbmc7XG4gICAgfVxuXG4gICAgcmV0dXJuIFwiXCI7XG4gIH1cblxuICBpbmZlckV2ZW50RGF0ZU9iaigpIHtcbiAgICBpZiAodGhpcy5ldmVudERhdGUpIHtcbiAgICAgIHJldHVybiB0aGlzLmV2ZW50RGF0ZTtcbiAgICB9XG4gIH1cblxuICBpbmZlckV2ZW50RGF0ZSgpIHtcbiAgICBpZiAodGhpcy5ldmVudERhdGUpIHtcbiAgICAgIHJldHVybiB0aGlzLmV2ZW50RGF0ZS5nZXREYXRlU3RyaW5nKCk7XG4gICAgfVxuICB9XG5cbiAgaW5mZXJFdmVudFllYXIoKSB7XG4gICAgaWYgKHRoaXMuZXZlbnREYXRlKSB7XG4gICAgICByZXR1cm4gdGhpcy5ldmVudERhdGUuZ2V0WWVhclN0cmluZygpO1xuICAgIH1cbiAgfVxuXG4gIGluZmVyRXZlbnREYXRlUXVhbGlmaWVyKCkge1xuICAgIGlmICh0aGlzLmV2ZW50RGF0ZSkge1xuICAgICAgcmV0dXJuIHRoaXMuZXZlbnREYXRlLnF1YWxpZmllcjtcbiAgICB9XG4gIH1cblxuICBpbmZlckV2ZW50UXVhcnRlcigpIHtcbiAgICBpZiAodGhpcy5ldmVudERhdGUpIHtcbiAgICAgIHJldHVybiB0aGlzLmV2ZW50RGF0ZS5xdWFydGVyO1xuICAgIH1cbiAgfVxuXG4gIGluZmVyRXZlbnRQbGFjZSgpIHtcbiAgICBpZiAodGhpcy5ldmVudFBsYWNlKSB7XG4gICAgICByZXR1cm4gdGhpcy5ldmVudFBsYWNlLnBsYWNlU3RyaW5nO1xuICAgIH1cbiAgfVxuXG4gIGluZmVyRnVsbEV2ZW50UGxhY2UoKSB7XG4gICAgaWYgKHRoaXMuZXZlbnRQbGFjZSkge1xuICAgICAgbGV0IHBsYWNlID0gdGhpcy5ldmVudFBsYWNlLnBsYWNlU3RyaW5nO1xuICAgICAgbGV0IHN0cmVldEFkZHJlc3MgPSB0aGlzLmV2ZW50UGxhY2Uuc3RyZWV0QWRkcmVzcztcbiAgICAgIGlmIChzdHJlZXRBZGRyZXNzICYmIHBsYWNlICYmICFwbGFjZS50b0xvd2VyQ2FzZSgpLnN0YXJ0c1dpdGgoc3RyZWV0QWRkcmVzcy50b0xvd2VyQ2FzZSgpKSkge1xuICAgICAgICBwbGFjZSA9IHN0cmVldEFkZHJlc3MgKyBcIiwgXCIgKyBwbGFjZTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBwbGFjZTtcbiAgICB9XG4gIH1cblxuICBpbmZlckFnZUF0RGVhdGgoKSB7XG4gICAgaWYgKHRoaXMuYWdlQXREZWF0aCkge1xuICAgICAgcmV0dXJuIHRoaXMuYWdlQXREZWF0aDtcbiAgICB9XG5cbiAgICBsZXQgYmlydGhEYXRlU3RyaW5nID0gdGhpcy5pbmZlckJpcnRoRGF0ZSgpO1xuICAgIGxldCBkZWF0aERhdGVTdHJpbmcgPSB0aGlzLmluZmVyRGVhdGhEYXRlKCk7XG5cbiAgICBpZiAoYmlydGhEYXRlU3RyaW5nICYmIGRlYXRoRGF0ZVN0cmluZykge1xuICAgICAgcmV0dXJuIEdlbmVyYWxpemVkRGF0YS5nZXRBZ2VBdERhdGUoYmlydGhEYXRlU3RyaW5nLCBkZWF0aERhdGVTdHJpbmcpO1xuICAgIH1cblxuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH1cblxuICBpbmZlckFnZUF0RXZlbnQoKSB7XG4gICAgaWYgKHRoaXMuYWdlQXRFdmVudCkge1xuICAgICAgcmV0dXJuIHRoaXMuYWdlQXRFdmVudDtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5yZWNvcmRUeXBlID09IFJULkRlYXRoIHx8IHRoaXMucmVjb3JkVHlwZSA9PSBSVC5EZWF0aFJlZ2lzdHJhdGlvbikge1xuICAgICAgaWYgKHRoaXMuYWdlQXREZWF0aCkge1xuICAgICAgICByZXR1cm4gdGhpcy5hZ2VBdERlYXRoO1xuICAgICAgfVxuXG4gICAgICBsZXQgYmlydGhEYXRlU3RyaW5nID0gdGhpcy5pbmZlckJpcnRoRGF0ZSgpO1xuICAgICAgbGV0IGRlYXRoRGF0ZVN0cmluZyA9IHRoaXMuaW5mZXJEZWF0aERhdGUoKTtcblxuICAgICAgaWYgKGJpcnRoRGF0ZVN0cmluZyAmJiBkZWF0aERhdGVTdHJpbmcpIHtcbiAgICAgICAgcmV0dXJuIEdlbmVyYWxpemVkRGF0YS5nZXRBZ2VBdERhdGUoYmlydGhEYXRlU3RyaW5nLCBkZWF0aERhdGVTdHJpbmcpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH1cblxuICBpbmZlckNvdW50cmllcygpIHtcbiAgICAvL2NvbnNvbGUubG9nKFwiaW5mZXJDb3VudHJpZXMsIHRoaXMgaXM6XCIpO1xuICAgIC8vY29uc29sZS5sb2codGhpcyk7XG5cbiAgICBsZXQgcGxhY2VOYW1lcyA9IFtdO1xuXG4gICAgbGV0IGJpcnRoUGxhY2UgPSB0aGlzLmluZmVyQmlydGhQbGFjZSgpO1xuICAgIGlmIChiaXJ0aFBsYWNlKSB7XG4gICAgICBwbGFjZU5hbWVzLnB1c2goYmlydGhQbGFjZSk7XG4gICAgfVxuXG4gICAgbGV0IGRlYXRoUGxhY2UgPSB0aGlzLmluZmVyRGVhdGhQbGFjZSgpO1xuICAgIGlmIChkZWF0aFBsYWNlKSB7XG4gICAgICBwbGFjZU5hbWVzLnB1c2goZGVhdGhQbGFjZSk7XG4gICAgfVxuXG4gICAgbGV0IGV2ZW50UGxhY2UgPSB0aGlzLmluZmVyRXZlbnRQbGFjZSgpO1xuICAgIGlmIChldmVudFBsYWNlKSB7XG4gICAgICBwbGFjZU5hbWVzLnB1c2goZXZlbnRQbGFjZSk7XG4gICAgfVxuXG4gICAgbGV0IHJlc2lkZW5jZVBsYWNlID0gdGhpcy5pbmZlclJlc2lkZW5jZVBsYWNlKCk7XG4gICAgaWYgKHJlc2lkZW5jZVBsYWNlKSB7XG4gICAgICBwbGFjZU5hbWVzLnB1c2gocmVzaWRlbmNlUGxhY2UpO1xuICAgIH1cblxuICAgIC8vIENvbGxlY3Rpb25cbiAgICBpZiAodGhpcy5jb2xsZWN0aW9uRGF0YSkge1xuICAgICAgbGV0IGNvbGxlY3Rpb24gPSBSQy5maW5kQ29sbGVjdGlvbih0aGlzLnNvdXJjZU9mRGF0YSwgdGhpcy5jb2xsZWN0aW9uRGF0YS5pZCk7XG4gICAgICBsZXQgY291bnRyeSA9IFJDLmdldENvdW50cnlGcm9tQ29sbGVjdGlvbihjb2xsZWN0aW9uKTtcbiAgICAgIGlmIChjb3VudHJ5KSB7XG4gICAgICAgIHBsYWNlTmFtZXMucHVzaChjb3VudHJ5KTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBhZGQgbWFycmlhZ2UgcGxhY2VzXG4gICAgaWYgKHRoaXMuc291cmNlVHlwZSA9PSBcInByb2ZpbGVcIiAmJiB0aGlzLnNwb3VzZXMpIHtcbiAgICAgIGZvciAobGV0IHNwb3VzZSBvZiB0aGlzLnNwb3VzZXMpIHtcbiAgICAgICAgaWYgKHNwb3VzZS5tYXJyaWFnZVBsYWNlICYmIHNwb3VzZS5tYXJyaWFnZVBsYWNlLnBsYWNlU3RyaW5nKSB7XG4gICAgICAgICAgcGxhY2VOYW1lcy5wdXNoKHNwb3VzZS5tYXJyaWFnZVBsYWNlLnBsYWNlU3RyaW5nKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIC8vIGRldGVybWluZSB0aGUgY291bnRyeSBvciBjb3VudHJpZXMgZnJvbSBwbGFjZU5hbWVzIGFycmF5XG4gICAgaWYgKHBsYWNlTmFtZXMubGVuZ3RoID4gMCkge1xuICAgICAgbGV0IGNvdW50cnlBcnJheSA9IENELmJ1aWxkQ291bnRyeUFycmF5RnJvbVBsYWNlQXJyYXkocGxhY2VOYW1lcyk7XG4gICAgICBpZiAoY291bnRyeUFycmF5KSB7XG4gICAgICAgIHJldHVybiBjb3VudHJ5QXJyYXk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIFtdO1xuICB9XG5cbiAgaW5mZXJDb3VudHJ5RnJvbVBsYWNlTmFtZXMocGxhY2VOYW1lcykge1xuICAgIC8vIGRldGVybWluZSB0aGUgY291bnRyeSBmcm9tIHBsYWNlTmFtZXMgYXJyYXlcbiAgICBpZiAocGxhY2VOYW1lcy5sZW5ndGggPiAwKSB7XG4gICAgICBsZXQgY291bnRyeUFycmF5ID0gQ0QuYnVpbGRDb3VudHJ5QXJyYXlGcm9tUGxhY2VBcnJheShwbGFjZU5hbWVzKTtcbiAgICAgIGlmIChjb3VudHJ5QXJyYXkgJiYgY291bnRyeUFycmF5Lmxlbmd0aCA+IDApIHtcbiAgICAgICAgaWYgKGNvdW50cnlBcnJheS5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgLy9jb25zb2xlLmxvZyhcImluZmVyQ291bnRyeUZyb21QbGFjZU5hbWVzLCB0aGVyZSBhcmUgXCIgKyBjb3VudHJ5QXJyYXkubGVuZ3RoICsgXCIgY291bnRyaWVzIVwiKTtcbiAgICAgICAgICAvL2NvbnNvbGUubG9nKGNvdW50cnlBcnJheSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGNvdW50cnlBcnJheVswXTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gdW5kZWZpbmVkO1xuICB9XG5cbiAgaW5mZXJDb3VudHJpZXNGcm9tUGxhY2VOYW1lcyhwbGFjZU5hbWVzKSB7XG4gICAgLy8gZGV0ZXJtaW5lIHRoZSBjb3VudHJ5IGZyb20gcGxhY2VOYW1lcyBhcnJheVxuICAgIGlmIChwbGFjZU5hbWVzLmxlbmd0aCA+IDApIHtcbiAgICAgIGxldCBjb3VudHJ5QXJyYXkgPSBDRC5idWlsZENvdW50cnlBcnJheUZyb21QbGFjZUFycmF5KHBsYWNlTmFtZXMpO1xuICAgICAgaWYgKGNvdW50cnlBcnJheSAmJiBjb3VudHJ5QXJyYXkubGVuZ3RoID4gMCkge1xuICAgICAgICByZXR1cm4gY291bnRyeUFycmF5O1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH1cblxuICBpbmZlckV2ZW50Q291bnRyeSgpIHtcbiAgICBsZXQgcGxhY2VOYW1lcyA9IFtdO1xuXG4gICAgbGV0IGV2ZW50UGxhY2UgPSB0aGlzLmluZmVyRXZlbnRQbGFjZSgpO1xuICAgIGlmIChldmVudFBsYWNlKSB7XG4gICAgICBwbGFjZU5hbWVzLnB1c2goZXZlbnRQbGFjZSk7XG4gICAgfVxuXG4gICAgLy8gQ29sbGVjdGlvblxuICAgIGlmICh0aGlzLmNvbGxlY3Rpb25EYXRhKSB7XG4gICAgICBsZXQgY29sbGVjdGlvbiA9IFJDLmZpbmRDb2xsZWN0aW9uKHRoaXMuc291cmNlT2ZEYXRhLCB0aGlzLmNvbGxlY3Rpb25EYXRhLmlkKTtcbiAgICAgIGxldCBjb3VudHJ5ID0gUkMuZ2V0Q291bnRyeUZyb21Db2xsZWN0aW9uKGNvbGxlY3Rpb24pO1xuICAgICAgaWYgKGNvdW50cnkpIHtcbiAgICAgICAgcGxhY2VOYW1lcy5wdXNoKGNvdW50cnkpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB0aGlzLmluZmVyQ291bnRyeUZyb21QbGFjZU5hbWVzKHBsYWNlTmFtZXMpO1xuICB9XG5cbiAgaW5mZXJFdmVudENvdW50eSgpIHtcbiAgICBsZXQgZXZlbnRDb3VudHkgPSBcIlwiO1xuXG4gICAgaWYgKHRoaXMuZXZlbnRQbGFjZSkge1xuICAgICAgZXZlbnRDb3VudHkgPSB0aGlzLmV2ZW50UGxhY2UuaW5mZXJDb3VudHkoKTtcbiAgICB9XG5cbiAgICByZXR1cm4gZXZlbnRDb3VudHk7XG4gIH1cblxuICBpbmZlckxhc3ROYW1lR2l2ZW5QYXJhbWV0ZXJzQW5kQ29sbGVjdGlvbihwYXJhbWV0ZXJzLCBjb2xsZWN0aW9uLCBhbGxvd011bHRpcGxlID0gZmFsc2UpIHtcbiAgICBsZXQgbGFzdE5hbWVzQXJyYXkgPSB0aGlzLmluZmVyUGVyc29uTGFzdE5hbWVzQXJyYXkodGhpcyk7XG4gICAgaWYgKGxhc3ROYW1lc0FycmF5Lmxlbmd0aCA8IDEpIHtcbiAgICAgIHJldHVybiBcIlwiO1xuICAgIH1cbiAgICBpZiAobGFzdE5hbWVzQXJyYXkubGVuZ3RoID09IDEpIHtcbiAgICAgIHJldHVybiBsYXN0TmFtZXNBcnJheVswXTtcbiAgICB9XG5cbiAgICBpZiAocGFyYW1ldGVycyAmJiBsYXN0TmFtZXNBcnJheS5sZW5ndGggPiBwYXJhbWV0ZXJzLmxhc3ROYW1lSW5kZXgpIHtcbiAgICAgIHJldHVybiBsYXN0TmFtZXNBcnJheVtwYXJhbWV0ZXJzLmxhc3ROYW1lSW5kZXhdO1xuICAgIH1cblxuICAgIGlmIChjb2xsZWN0aW9uKSB7XG4gICAgICBpZiAoY29sbGVjdGlvbi5pc0RlYXRoICYmIHRoaXMubGFzdE5hbWVBdERlYXRoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmxhc3ROYW1lQXREZWF0aDtcbiAgICAgIH0gZWxzZSBpZiAoY29sbGVjdGlvbi5pc0JpcnRoICYmIHRoaXMubGFzdE5hbWVBdEJpcnRoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmxhc3ROYW1lQXRCaXJ0aDtcbiAgICAgIH1cblxuICAgICAgaWYgKGNvbGxlY3Rpb24uZGF0ZXMgJiYgKGNvbGxlY3Rpb24uZGF0ZXMueWVhciB8fCBjb2xsZWN0aW9uLmRhdGVzLmV4YWN0RGF0ZSkpIHtcbiAgICAgICAgLy8gdGhpcyBjb2xsZWN0aW9uIGlzIGZvciBhIHNwZWNpZmljIHllYXJcbiAgICAgICAgaWYgKHRoaXMucGVyc29uR2VuZGVyID09IFwiZmVtYWxlXCIgJiYgdGhpcy5zcG91c2VzKSB7XG4gICAgICAgICAgbGV0IHRhcmdldERhdGUgPSBjb2xsZWN0aW9uLmRhdGVzLmV4YWN0RGF0ZTtcbiAgICAgICAgICBpZiAoIXRhcmdldERhdGUpIHtcbiAgICAgICAgICAgIHRhcmdldERhdGUgPSBjb2xsZWN0aW9uLmRhdGVzLnllYXIudG9TdHJpbmcoKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgbGV0IHRhcmdldFBhcnNlZERhdGUgPSBXVFNfRGF0ZS5wYXJzZURhdGVTdHJpbmcodGFyZ2V0RGF0ZSk7XG4gICAgICAgICAgbGV0IGJlc3RNYXRjaE5hbWUgPSBcIlwiO1xuICAgICAgICAgIGxldCBob3dDbG9zZUlzQmVzdE1hdGNoID0gLTE7XG4gICAgICAgICAgZm9yIChsZXQgc3BvdXNlIG9mIHRoaXMuc3BvdXNlcykge1xuICAgICAgICAgICAgaWYgKHNwb3VzZS5tYXJyaWFnZURhdGUpIHtcbiAgICAgICAgICAgICAgbGV0IG1hcnJpYWdlRGF0ZSA9IHNwb3VzZS5tYXJyaWFnZURhdGUuZ2V0RGF0ZVN0cmluZygpO1xuICAgICAgICAgICAgICBsZXQgbWFycmlhZ2VQYXJzZWREYXRlID0gV1RTX0RhdGUucGFyc2VEYXRlU3RyaW5nKG1hcnJpYWdlRGF0ZSk7XG4gICAgICAgICAgICAgIGxldCBkaWZmID0gV1RTX0RhdGUuZ2V0RGF5c0JldHdlZW5QYXJzZWREYXRlcyhtYXJyaWFnZVBhcnNlZERhdGUsIHRhcmdldFBhcnNlZERhdGUpO1xuICAgICAgICAgICAgICBpZiAoZGlmZiA+PSAwKSB7XG4gICAgICAgICAgICAgICAgbGV0IGhvd0Nsb3NlID0gZGlmZjtcbiAgICAgICAgICAgICAgICBpZiAoIWJlc3RNYXRjaE5hbWUgfHwgaG93Q2xvc2UgPD0gaG93Q2xvc2VJc0Jlc3RNYXRjaCkge1xuICAgICAgICAgICAgICAgICAgYmVzdE1hdGNoTmFtZSA9IHNwb3VzZS5sYXN0TmFtZUF0QmlydGg7XG4gICAgICAgICAgICAgICAgICBob3dDbG9zZUlzQmVzdE1hdGNoID0gaG93Q2xvc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgaWYgKGJlc3RNYXRjaE5hbWUpIHtcbiAgICAgICAgICAgIHJldHVybiBiZXN0TWF0Y2hOYW1lO1xuICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5sYXN0TmFtZUF0QmlydGgpIHtcbiAgICAgICAgICAgIC8vIHRoZXJlIGFyZSBzb21lIG1hcnJpYWdlcyBhbmQgdGhpcyBjb2xsZWN0aW9uIHNlZW1zIHRvIGJlIGJlZm9yZSBhbGwgb2YgdGhlbVxuICAgICAgICAgICAgcmV0dXJuIHRoaXMubGFzdE5hbWVBdEJpcnRoO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChhbGxvd011bHRpcGxlKSB7XG4gICAgICByZXR1cm4gdGhpcy5pbmZlckxhc3ROYW1lcygpO1xuICAgIH1cblxuICAgIHJldHVybiBsYXN0TmFtZXNBcnJheVswXTtcbiAgfVxuXG4gIGluZmVyTGFzdE5hbWVzQXJyYXlHaXZlblBhcmFtZXRlcnNBbmRDb2xsZWN0aW9uKHBhcmFtZXRlcnMsIGNvbGxlY3Rpb24pIHtcbiAgICBsZXQgbGFzdE5hbWVzQXJyYXkgPSB0aGlzLmluZmVyUGVyc29uTGFzdE5hbWVzQXJyYXkodGhpcyk7XG4gICAgaWYgKGxhc3ROYW1lc0FycmF5Lmxlbmd0aCA8IDEpIHtcbiAgICAgIHJldHVybiBbXTtcbiAgICB9XG4gICAgaWYgKGxhc3ROYW1lc0FycmF5Lmxlbmd0aCA9PSAxKSB7XG4gICAgICByZXR1cm4gbGFzdE5hbWVzQXJyYXk7XG4gICAgfVxuXG4gICAgaWYgKHBhcmFtZXRlcnMgJiYgbGFzdE5hbWVzQXJyYXkubGVuZ3RoID4gcGFyYW1ldGVycy5sYXN0TmFtZUluZGV4KSB7XG4gICAgICByZXR1cm4gW2xhc3ROYW1lc0FycmF5W3BhcmFtZXRlcnMubGFzdE5hbWVJbmRleF1dO1xuICAgIH1cblxuICAgIGlmIChjb2xsZWN0aW9uKSB7XG4gICAgICBpZiAoY29sbGVjdGlvbi5pc0RlYXRoICYmIHRoaXMubGFzdE5hbWVBdERlYXRoKSB7XG4gICAgICAgIHJldHVybiBbdGhpcy5sYXN0TmFtZUF0RGVhdGhdO1xuICAgICAgfSBlbHNlIGlmIChjb2xsZWN0aW9uLmlzQmlydGggJiYgdGhpcy5sYXN0TmFtZUF0QmlydGgpIHtcbiAgICAgICAgcmV0dXJuIFt0aGlzLmxhc3ROYW1lQXRCaXJ0aF07XG4gICAgICB9XG5cbiAgICAgIGlmIChjb2xsZWN0aW9uLmRhdGVzICYmIChjb2xsZWN0aW9uLmRhdGVzLnllYXIgfHwgY29sbGVjdGlvbi5kYXRlcy5leGFjdERhdGUpKSB7XG4gICAgICAgIC8vIHRoaXMgY29sbGVjdGlvbiBpcyBmb3IgYSBzcGVjaWZpYyB5ZWFyXG4gICAgICAgIGlmICh0aGlzLnBlcnNvbkdlbmRlciA9PSBcImZlbWFsZVwiICYmIHRoaXMuc3BvdXNlcykge1xuICAgICAgICAgIGxldCB0YXJnZXREYXRlID0gY29sbGVjdGlvbi5kYXRlcy5leGFjdERhdGU7XG4gICAgICAgICAgaWYgKCF0YXJnZXREYXRlKSB7XG4gICAgICAgICAgICB0YXJnZXREYXRlID0gY29sbGVjdGlvbi5kYXRlcy55ZWFyLnRvU3RyaW5nKCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGxldCB0YXJnZXRQYXJzZWREYXRlID0gV1RTX0RhdGUucGFyc2VEYXRlU3RyaW5nKHRhcmdldERhdGUpO1xuICAgICAgICAgIGxldCBiZXN0TWF0Y2hOYW1lID0gXCJcIjtcbiAgICAgICAgICBsZXQgaG93Q2xvc2VJc0Jlc3RNYXRjaCA9IC0xO1xuICAgICAgICAgIGZvciAobGV0IHNwb3VzZSBvZiB0aGlzLnNwb3VzZXMpIHtcbiAgICAgICAgICAgIGlmIChzcG91c2UubWFycmlhZ2VEYXRlKSB7XG4gICAgICAgICAgICAgIGxldCBtYXJyaWFnZURhdGUgPSBzcG91c2UubWFycmlhZ2VEYXRlLmdldERhdGVTdHJpbmcoKTtcbiAgICAgICAgICAgICAgbGV0IG1hcnJpYWdlUGFyc2VkRGF0ZSA9IFdUU19EYXRlLnBhcnNlRGF0ZVN0cmluZyhtYXJyaWFnZURhdGUpO1xuICAgICAgICAgICAgICBsZXQgZGlmZiA9IFdUU19EYXRlLmdldERheXNCZXR3ZWVuUGFyc2VkRGF0ZXMobWFycmlhZ2VQYXJzZWREYXRlLCB0YXJnZXRQYXJzZWREYXRlKTtcbiAgICAgICAgICAgICAgaWYgKGRpZmYgPj0gMCkge1xuICAgICAgICAgICAgICAgIGxldCBob3dDbG9zZSA9IGRpZmY7XG4gICAgICAgICAgICAgICAgaWYgKCFiZXN0TWF0Y2hOYW1lIHx8IGhvd0Nsb3NlIDw9IGhvd0Nsb3NlSXNCZXN0TWF0Y2gpIHtcbiAgICAgICAgICAgICAgICAgIGJlc3RNYXRjaE5hbWUgPSBzcG91c2UubGFzdE5hbWVBdEJpcnRoO1xuICAgICAgICAgICAgICAgICAgaG93Q2xvc2VJc0Jlc3RNYXRjaCA9IGhvd0Nsb3NlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cblxuICAgICAgICAgIGlmIChiZXN0TWF0Y2hOYW1lKSB7XG4gICAgICAgICAgICByZXR1cm4gW2Jlc3RNYXRjaE5hbWVdO1xuICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5sYXN0TmFtZUF0QmlydGgpIHtcbiAgICAgICAgICAgIC8vIHRoZXJlIGFyZSBzb21lIG1hcnJpYWdlcyBhbmQgdGhpcyBjb2xsZWN0aW9uIHNlZW1zIHRvIGJlIGJlZm9yZSBhbGwgb2YgdGhlbVxuICAgICAgICAgICAgcmV0dXJuIFt0aGlzLmxhc3ROYW1lQXRCaXJ0aF07XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIGxhc3ROYW1lc0FycmF5O1xuICB9XG5cbiAgZ2V0UmVsYXRpb25zaGlwT2ZQcmltYXJ5UGVyc29uVG9UaGlzUGVyc29uKCkge1xuICAgIGxldCByZWxhdGlvbnNoaXAgPSBcIlwiO1xuICAgIGlmICh0aGlzLnJvbGUpIHtcbiAgICAgIGlmICh0aGlzLnJvbGUgPT0gUm9sZS5QYXJlbnQpIHtcbiAgICAgICAgcmVsYXRpb25zaGlwID0gXCJjaGlsZFwiO1xuICAgICAgICBpZiAodGhpcy5wcmltYXJ5UGVyc29uR2VuZGVyKSB7XG4gICAgICAgICAgaWYgKHRoaXMucHJpbWFyeVBlcnNvbkdlbmRlciA9PSBcIm1hbGVcIikge1xuICAgICAgICAgICAgcmVsYXRpb25zaGlwID0gXCJzb25cIjtcbiAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMucHJpbWFyeVBlcnNvbkdlbmRlciA9PSBcImZlbWFsZVwiKSB7XG4gICAgICAgICAgICByZWxhdGlvbnNoaXAgPSBcImRhdWdodGVyXCI7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKHRoaXMucm9sZSA9PSBSb2xlLkNoaWxkKSB7XG4gICAgICAgIHJlbGF0aW9uc2hpcCA9IFwicGFyZW50XCI7XG4gICAgICAgIGlmICh0aGlzLnByaW1hcnlQZXJzb25HZW5kZXIpIHtcbiAgICAgICAgICBpZiAodGhpcy5wcmltYXJ5UGVyc29uR2VuZGVyID09IFwibWFsZVwiKSB7XG4gICAgICAgICAgICByZWxhdGlvbnNoaXAgPSBcImZhdGhlclwiO1xuICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5wcmltYXJ5UGVyc29uR2VuZGVyID09IFwiZmVtYWxlXCIpIHtcbiAgICAgICAgICAgIHJlbGF0aW9uc2hpcCA9IFwibW90aGVyXCI7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKHRoaXMucm9sZSA9PSBSb2xlLlNwb3VzZSkge1xuICAgICAgICByZWxhdGlvbnNoaXAgPSBcInNwb3VzZVwiO1xuICAgICAgICBpZiAodGhpcy5wcmltYXJ5UGVyc29uR2VuZGVyKSB7XG4gICAgICAgICAgaWYgKHRoaXMucHJpbWFyeVBlcnNvbkdlbmRlciA9PSBcIm1hbGVcIikge1xuICAgICAgICAgICAgcmVsYXRpb25zaGlwID0gXCJodXNiYW5kXCI7XG4gICAgICAgICAgfSBlbHNlIGlmICh0aGlzLnByaW1hcnlQZXJzb25HZW5kZXIgPT0gXCJmZW1hbGVcIikge1xuICAgICAgICAgICAgcmVsYXRpb25zaGlwID0gXCJ3aWZlXCI7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKHRoaXMucm9sZSA9PSBSb2xlLlNpYmxpbmcpIHtcbiAgICAgICAgcmVsYXRpb25zaGlwID0gXCJzaWJsaW5nXCI7XG4gICAgICAgIGlmICh0aGlzLnByaW1hcnlQZXJzb25HZW5kZXIpIHtcbiAgICAgICAgICBpZiAodGhpcy5wcmltYXJ5UGVyc29uR2VuZGVyID09IFwibWFsZVwiKSB7XG4gICAgICAgICAgICByZWxhdGlvbnNoaXAgPSBcImJyb3RoZXJcIjtcbiAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMucHJpbWFyeVBlcnNvbkdlbmRlciA9PSBcImZlbWFsZVwiKSB7XG4gICAgICAgICAgICByZWxhdGlvbnNoaXAgPSBcInNpc3RlclwiO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gcmVsYXRpb25zaGlwO1xuICB9XG5cbiAgZ2V0UmVmVGl0bGUoY29sbGVjdGlvblRpdGxlLCBvdmVycmlkZVRhYmxlKSB7XG4gICAgLy9jb25zb2xlLmxvZyhcImdlbmVyYWxpc2VkX2RhdGFfdXRpbHMgZ2V0UmVmVGl0bGUsIHRoaXMgaXM6XCIpO1xuICAgIC8vY29uc29sZS5sb2codGhpcyk7XG5cbiAgICBjb25zdCBkZWZhdWx0VGFibGUgPSBbXG4gICAgICB7XG4gICAgICAgIHR5cGU6IHVuZGVmaW5lZCxcbiAgICAgICAgZGVmYXVsdFRpdGxlOiBcIlVuY2xhc3NpZmllZFwiLFxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgdHlwZTogUlQuVW5jbGFzc2lmaWVkLFxuICAgICAgICBkZWZhdWx0VGl0bGU6IFwiVW5jbGFzc2lmaWVkXCIsXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICB0eXBlOiBSVC5CaXJ0aFJlZ2lzdHJhdGlvbixcbiAgICAgICAgZGVmYXVsdFRpdGxlOiBcIkJpcnRoIFJlZ2lzdHJhdGlvblwiLFxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgdHlwZTogUlQuQmlydGgsXG4gICAgICAgIGRlZmF1bHRUaXRsZTogXCJCaXJ0aFwiLFxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgdHlwZTogUlQuTWFycmlhZ2VSZWdpc3RyYXRpb24sXG4gICAgICAgIGRlZmF1bHRUaXRsZTogXCJNYXJyaWFnZSBSZWdpc3RyYXRpb25cIixcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIHR5cGU6IFJULkRlYXRoLFxuICAgICAgICBkZWZhdWx0VGl0bGU6IFwiRGVhdGhcIixcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIHR5cGU6IFJULkRlYXRoUmVnaXN0cmF0aW9uLFxuICAgICAgICBkZWZhdWx0VGl0bGU6IFwiRGVhdGggUmVnaXN0cmF0aW9uXCIsXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICB0eXBlOiBSVC5CYXB0aXNtLFxuICAgICAgICBkZWZhdWx0VGl0bGU6IFwiQmFwdGlzbVwiLFxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgdHlwZTogUlQuQnVyaWFsLFxuICAgICAgICBkZWZhdWx0VGl0bGU6IFwiQnVyaWFsXCIsXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICB0eXBlOiBSVC5DZXJ0aWZpY2F0ZSxcbiAgICAgICAgZGVmYXVsdFRpdGxlOiBcIkNlcnRpZmljYXRlXCIsXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICB0eXBlOiBSVC5DcmVtYXRpb24sXG4gICAgICAgIGRlZmF1bHRUaXRsZTogXCJDcmVtYXRpb25cIixcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIHR5cGU6IFJULk1hcnJpYWdlLFxuICAgICAgICBkZWZhdWx0VGl0bGU6IFwiTWFycmlhZ2VcIixcbiAgICAgICAgdGl0bGVNYXRjaGVzOiBbXG4gICAgICAgICAgeyB0aXRsZTogXCJNYXJyaWFnZSBCYW5uc1wiLCBtYXRjaGVzOiBbXCJNYXJyaWFnZSBCYW5uc1wiXSB9LFxuICAgICAgICAgIHsgdGl0bGU6IFwiTWFycmlhZ2UgQm9uZFwiLCBtYXRjaGVzOiBbXCJNYXJyaWFnZSBCb25kXCJdIH0sXG4gICAgICAgIF0sXG4gICAgICAgIHN1YnR5cGVzOiBbeyB0aXRsZTogXCJNYXJyaWFnZSBCYW5uc1wiLCBzdWJ0eXBlOiBSZWNvcmRTdWJ0eXBlLkJhbm5zIH1dLFxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgdHlwZTogUlQuQmlydGhPckJhcHRpc20sXG4gICAgICAgIGRlZmF1bHRUaXRsZTogXCJCaXJ0aCBvciBCYXB0aXNtXCIsXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICB0eXBlOiBSVC5EZWF0aE9yQnVyaWFsLFxuICAgICAgICBkZWZhdWx0VGl0bGU6IFwiRGVhdGggb3IgQnVyaWFsXCIsXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICB0eXBlOiBSVC5DZW5zdXMsXG4gICAgICAgIGRlZmF1bHRUaXRsZTogXCJDZW5zdXNcIixcbiAgICAgICAgYWRkWWVhcjogdHJ1ZSxcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIHR5cGU6IFJULk5vbnBvcHVsYXRpb25DZW5zdXMsXG4gICAgICAgIGRlZmF1bHRUaXRsZTogXCJOb24tcG9wdWxhdGlvbiBDZW5zdXNcIixcbiAgICAgICAgYWRkWWVhcjogdHJ1ZSxcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIHR5cGU6IFJULkVsZWN0b3JhbFJlZ2lzdGVyLFxuICAgICAgICBkZWZhdWx0VGl0bGU6IFwiRWxlY3RvcmFsIFJlZ2lzdGVyXCIsXG4gICAgICAgIGFkZFllYXI6IHRydWUsXG4gICAgICAgIHRpdGxlTWF0Y2hlczogW3sgdGl0bGU6IFwiVm90ZXIgUmVnaXN0ZXJcIiwgbWF0Y2hlczogW1wiVm90ZXIgUmVnaXN0ZXJcIl0gfV0sXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICB0eXBlOiBSVC5Qcm9iYXRlLFxuICAgICAgICBkZWZhdWx0VGl0bGU6IFwiUHJvYmF0ZVwiLFxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgdHlwZTogUlQuV2lsbCxcbiAgICAgICAgZGVmYXVsdFRpdGxlOiBcIldpbGxcIixcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIHR5cGU6IFJULkRpdm9yY2UsXG4gICAgICAgIGRlZmF1bHRUaXRsZTogXCJEaXZvcmNlXCIsXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICB0eXBlOiBSVC5NZW1vcmlhbCxcbiAgICAgICAgZGVmYXVsdFRpdGxlOiBcIk1lbW9yaWFsXCIsXG4gICAgICB9LFxuXG4gICAgICB7XG4gICAgICAgIHR5cGU6IFJULkNyaW1pbmFsUmVnaXN0ZXIsXG4gICAgICAgIGRlZmF1bHRUaXRsZTogXCJDcmltaW5hbCBSZWdpc3RlclwiLFxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgdHlwZTogUlQuRnJlZW1hc29uTWVtYmVyc2hpcCxcbiAgICAgICAgZGVmYXVsdFRpdGxlOiBcIkZyZWVtYXNvbiBNZW1iZXJzaGlwXCIsXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICB0eXBlOiBSVC5EaXJlY3RvcnksXG4gICAgICAgIGRlZmF1bHRUaXRsZTogXCJEaXJlY3RvcnlcIixcbiAgICAgICAgYWRkWWVhcjogdHJ1ZSxcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIHR5cGU6IFJULkVtcGxveW1lbnQsXG4gICAgICAgIGRlZmF1bHRUaXRsZTogXCJFbXBsb3ltZW50XCIsXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICB0eXBlOiBSVC5Xb3JraG91c2VSZWNvcmQsXG4gICAgICAgIGRlZmF1bHRUaXRsZTogXCJXb3JraG91c2UgUmVjb3JkXCIsXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICB0eXBlOiBSVC5DcmV3TGlzdCxcbiAgICAgICAgZGVmYXVsdFRpdGxlOiBcIkNyZXcgTGlzdFwiLFxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgdHlwZTogUlQuUGFzc2VuZ2VyTGlzdCxcbiAgICAgICAgZGVmYXVsdFRpdGxlOiBcIlBhc3NlbmdlciBMaXN0XCIsXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICB0eXBlOiBSVC5Db252aWN0VHJhbnNwb3J0YXRpb24sXG4gICAgICAgIGRlZmF1bHRUaXRsZTogXCJDb252aWN0IFRyYW5zcG9ydGF0aW9uXCIsXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICB0eXBlOiBSVC5NaWxpdGFyeSxcbiAgICAgICAgZGVmYXVsdFRpdGxlOiBcIk1pbGl0YXJ5XCIsXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICB0eXBlOiBSVC5NZWRpY2FsUGF0aWVudCxcbiAgICAgICAgZGVmYXVsdFRpdGxlOiBcIk1lZGljYWwgUGF0aWVudFwiLFxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgdHlwZTogUlQuUXVhcnRlclNlc3Npb24sXG4gICAgICAgIGRlZmF1bHRUaXRsZTogXCJRdWFydGVyIFNlc3Npb25cIixcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIHR5cGU6IFJULkxhbmRUYXgsXG4gICAgICAgIGRlZmF1bHRUaXRsZTogXCJMYW5kIFRheFwiLFxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgdHlwZTogUlQuVGF4LFxuICAgICAgICBkZWZhdWx0VGl0bGU6IFwiVGF4IFJlY29yZFwiLFxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgdHlwZTogUlQuVmFsdWF0aW9uUm9sbCxcbiAgICAgICAgZGVmYXVsdFRpdGxlOiBcIlZhbHVhdGlvbiBSb2xsXCIsXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICB0eXBlOiBSVC5BcHByZW50aWNlc2hpcCxcbiAgICAgICAgZGVmYXVsdFRpdGxlOiBcIkFwcHJlbnRpY2VzaGlwXCIsXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICB0eXBlOiBSVC5Tb2NpYWxTZWN1cml0eSxcbiAgICAgICAgZGVmYXVsdFRpdGxlOiBcIlNvY2lhbCBTZWN1cml0eVwiLFxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgdHlwZTogUlQuU2Nob29sUmVjb3JkcyxcbiAgICAgICAgZGVmYXVsdFRpdGxlOiBcIlNjaG9vbCBSZWNvcmRzXCIsXG4gICAgICAgIGFkZFllYXI6IHRydWUsXG4gICAgICAgIHRpdGxlTWF0Y2hlczogW3sgdGl0bGU6IFwiU2Nob29sIFllYXJib29rXCIsIG1hdGNoZXM6IFtcIlNjaG9vbCBZZWFyYm9va1wiXSB9XSxcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIHR5cGU6IFJULlJlc2lkZW5jZSxcbiAgICAgICAgZGVmYXVsdFRpdGxlOiBcIlJlc2lkZW5jZVwiLFxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgdHlwZTogUlQuT2JpdHVhcnksXG4gICAgICAgIGRlZmF1bHRUaXRsZTogXCJPYml0dWFyeVwiLFxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgdHlwZTogUlQuSW1taWdyYXRpb24sXG4gICAgICAgIGRlZmF1bHRUaXRsZTogXCJJbW1pZ3JhdGlvblwiLFxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgdHlwZTogUlQuUGVuc2lvbixcbiAgICAgICAgZGVmYXVsdFRpdGxlOiBcIlBlbnNpb25cIixcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIHR5cGU6IFJULlBhc3Nwb3J0QXBwbGljYXRpb24sXG4gICAgICAgIGRlZmF1bHRUaXRsZTogXCJQYXNzcG9ydCBBcHBsaWNhdGlvblwiLFxuICAgICAgICBhZGRZZWFyOiB0cnVlLFxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgdHlwZTogUlQuTmV3c3BhcGVyLFxuICAgICAgICBhZGRZZWFyOiB0cnVlLFxuICAgICAgICBkZWZhdWx0VGl0bGU6IFwiTmV3c3BhcGVyXCIsXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICB0eXBlOiBSVC5MZWdhbFJlY29yZCxcbiAgICAgICAgYWRkWWVhcjogdHJ1ZSxcbiAgICAgICAgZGVmYXVsdFRpdGxlOiBcIkxlZ2FsIFJlY29yZFwiLFxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgdHlwZTogUlQuUmF0ZUJvb2ssXG4gICAgICAgIGFkZFllYXI6IHRydWUsXG4gICAgICAgIGRlZmF1bHRUaXRsZTogXCJSYXRlIEJvb2tcIixcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIHR5cGU6IFJULkZhbUhpc3RPclBlZGlncmVlLFxuICAgICAgICBkZWZhdWx0VGl0bGU6IFwiRmFtaWx5IEhpc3Rvcnkgb3IgUGVkaWdyZWVcIixcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIHR5cGU6IFJULkhlcmFsZHJ5LFxuICAgICAgICBkZWZhdWx0VGl0bGU6IFwiSGVyYWxkaWMgUmVjb3JkXCIsXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICB0eXBlOiBSVC5PdGhlckNodXJjaEV2ZW50LFxuICAgICAgICBkZWZhdWx0VGl0bGU6IFwiT3RoZXIgQ2h1cmNoIEV2ZW50XCIsXG4gICAgICB9LFxuICAgIF07XG5cbiAgICBmdW5jdGlvbiBsb29rdXAoZ2QsIGNvbGxlY3Rpb25UaXRsZSwgdGFibGUpIHtcbiAgICAgIGZvciAobGV0IG9iaiBvZiB0YWJsZSkge1xuICAgICAgICBpZiAoZ2QucmVjb3JkVHlwZSA9PSBvYmoudHlwZSkge1xuICAgICAgICAgIGlmIChvYmouc3VidHlwZXMpIHtcbiAgICAgICAgICAgIGZvciAobGV0IHN1YnR5cGUgb2Ygb2JqLnN1YnR5cGVzKSB7XG4gICAgICAgICAgICAgIGlmIChnZC5yZWNvcmRTdWJ0eXBlICYmIGdkLnJlY29yZFN1YnR5cGUgPT0gc3VidHlwZS5zdWJ0eXBlKSB7XG4gICAgICAgICAgICAgICAgbGV0IHRpdGxlID0gc3VidHlwZS50aXRsZTtcbiAgICAgICAgICAgICAgICAvLyBpZiB3ZSB3b3VsZCBsaWtlIHRvIGFkZCBhIHllYXIgdG8gdGhpcyB0aXRsZVxuICAgICAgICAgICAgICAgIGlmIChvYmouYWRkWWVhcikge1xuICAgICAgICAgICAgICAgICAgbGV0IHllYXIgPSBnZC5pbmZlckV2ZW50WWVhcigpO1xuICAgICAgICAgICAgICAgICAgaWYgKHllYXIpIHtcbiAgICAgICAgICAgICAgICAgICAgdGl0bGUgPSB5ZWFyICsgXCIgXCIgKyB0aXRsZTtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRpdGxlO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChvYmoudGl0bGVNYXRjaGVzKSB7XG4gICAgICAgICAgICBmb3IgKGxldCB0aXRsZU1hdGNoIG9mIG9iai50aXRsZU1hdGNoZXMpIHtcbiAgICAgICAgICAgICAgZm9yIChsZXQgbWF0Y2ggb2YgdGl0bGVNYXRjaC5tYXRjaGVzKSB7XG4gICAgICAgICAgICAgICAgaWYgKGNvbGxlY3Rpb25UaXRsZSAmJiBjb2xsZWN0aW9uVGl0bGUuaW5jbHVkZXMobWF0Y2gpKSB7XG4gICAgICAgICAgICAgICAgICBsZXQgdGl0bGUgPSB0aXRsZU1hdGNoLnRpdGxlO1xuICAgICAgICAgICAgICAgICAgLy8gaWYgd2Ugd291bGQgbGlrZSB0byBhZGQgYSB5ZWFyIHRvIHRoaXMgdGl0bGVcbiAgICAgICAgICAgICAgICAgIGlmIChvYmouYWRkWWVhcikge1xuICAgICAgICAgICAgICAgICAgICBsZXQgeWVhciA9IGdkLmluZmVyRXZlbnRZZWFyKCk7XG4gICAgICAgICAgICAgICAgICAgIGlmICh5ZWFyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgdGl0bGUgPSB5ZWFyICsgXCIgXCIgKyB0aXRsZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgcmV0dXJuIHRpdGxlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICBsZXQgdGl0bGUgPSBvYmouZGVmYXVsdFRpdGxlO1xuICAgICAgICAgIC8vIGlmIHdlIHdvdWxkIGxpa2UgdG8gYWRkIGEgeWVhciB0byB0aGlzIHRpdGxlXG4gICAgICAgICAgaWYgKHRpdGxlKSB7XG4gICAgICAgICAgICBpZiAob2JqLmFkZFllYXIpIHtcbiAgICAgICAgICAgICAgbGV0IHllYXIgPSBnZC5pbmZlckV2ZW50WWVhcigpO1xuICAgICAgICAgICAgICBpZiAoeWVhcikge1xuICAgICAgICAgICAgICAgIHRpdGxlID0geWVhciArIFwiIFwiICsgdGl0bGU7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB0aXRsZTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICBsZXQgcmVmVGl0bGUgPSB1bmRlZmluZWQ7XG5cbiAgICBpZiAodGhpcy5vdmVycmlkZVJlZlRpdGxlKSB7XG4gICAgICByZWZUaXRsZSA9IHRoaXMub3ZlcnJpZGVSZWZUaXRsZTtcbiAgICB9XG5cbiAgICBpZiAoIXJlZlRpdGxlICYmIG92ZXJyaWRlVGFibGUpIHtcbiAgICAgIHJlZlRpdGxlID0gbG9va3VwKHRoaXMsIGNvbGxlY3Rpb25UaXRsZSwgb3ZlcnJpZGVUYWJsZSk7XG4gICAgfVxuXG4gICAgaWYgKCFyZWZUaXRsZSkge1xuICAgICAgcmVmVGl0bGUgPSBsb29rdXAodGhpcywgY29sbGVjdGlvblRpdGxlLCBkZWZhdWx0VGFibGUpO1xuICAgIH1cblxuICAgIGlmICh0aGlzLnJvbGUpIHtcbiAgICAgIGxldCByZWxhdGlvbnNoaXAgPSB0aGlzLmdldFJlbGF0aW9uc2hpcE9mUHJpbWFyeVBlcnNvblRvVGhpc1BlcnNvbigpO1xuICAgICAgaWYgKHJlZlRpdGxlID09IFwiVW5jbGFzc2lmaWVkXCIgfHwgIXJlZlRpdGxlKSB7XG4gICAgICAgIHJlZlRpdGxlID0gXCJSZWNvcmRcIjtcbiAgICAgIH1cblxuICAgICAgcmVmVGl0bGUgKz0gXCIgb2YgXCIgKyByZWxhdGlvbnNoaXA7XG4gICAgICBpZiAodGhpcy5wcmltYXJ5UGVyc29uKSB7XG4gICAgICAgIHJlZlRpdGxlICs9IFwiIFwiICsgdGhpcy5wcmltYXJ5UGVyc29uO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiByZWZUaXRsZTtcbiAgfVxuXG4gIGlzUmVjb3JkSW5Db3VudHJ5KHN0ZENvdW50cnlOYW1lKSB7XG4gICAgbGV0IGNvdW50cnkgPSB0aGlzLmluZmVyRXZlbnRDb3VudHJ5KCk7XG4gICAgaWYgKGNvdW50cnkpIHtcbiAgICAgIGlmIChjb3VudHJ5ID09IHN0ZENvdW50cnlOYW1lIHx8IENELmlzUGFydE9mKGNvdW50cnksIHN0ZENvdW50cnlOYW1lKSkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBpbmZlclBhcmVudE5hbWVzRm9yRGF0YVN0cmluZygpIHtcbiAgICAvLyB3ZSB1c2VkIHRvIG9ubHkgdXNlIHRoZSBmb3JlbmFtZXMgaWYgdGhlIGxhc3QgbmFtZXMgd2VyZSB0aGUgc2FtZSwgdGhpcyBjYW4gYmUgY29uZnVzaW5nIGZvciBhbiBleGFtcGxlXG4gICAgLy8gbGlrZTogaHR0cHM6Ly93d3cuYW5jZXN0cnkuY29tL2Rpc2NvdmVyeXVpLWNvbnRlbnQvdmlldy8xMjk0NjU5NTo2MDE0M1xuICAgIC8vIFdoZXJlIHRoZSBtb3RoZXIgaGFzIGEgbWlkZGxlIG5hbWUgKHBvc3NpYmx5IG1haWRlbiBuYW1lKSB0aGF0IGxvb2tzIGxpa2UgYSBzdXJuYW1lLlxuICAgIC8vIEFsc28sIHVzZXIncyBtYXkgd2FudCB0byBtYWtlIHRoZSBwYXJlbnQgbGlua3MgdG8gdGhlaXIgcHJvZmlsZXMgc28gYSBmdWxsIG5hbWUgaXMgYmV0dGVyIGZvciB0aGF0LlxuXG4gICAgbGV0IGZhdGhlck5hbWUgPSBcIlwiO1xuICAgIGxldCBtb3RoZXJOYW1lID0gXCJcIjtcblxuICAgIGlmICh0aGlzLnBhcmVudHMpIHtcbiAgICAgIGlmICh0aGlzLnBhcmVudHMuZmF0aGVyICYmIHRoaXMucGFyZW50cy5mYXRoZXIubmFtZSkge1xuICAgICAgICBmYXRoZXJOYW1lID0gdGhpcy5wYXJlbnRzLmZhdGhlci5uYW1lLmluZmVyRnVsbE5hbWUoKTtcbiAgICAgIH1cbiAgICAgIGlmICh0aGlzLnBhcmVudHMubW90aGVyICYmIHRoaXMucGFyZW50cy5tb3RoZXIubmFtZSkge1xuICAgICAgICBtb3RoZXJOYW1lID0gdGhpcy5wYXJlbnRzLm1vdGhlci5uYW1lLmluZmVyRnVsbE5hbWUoKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4geyBmYXRoZXJOYW1lOiBmYXRoZXJOYW1lLCBtb3RoZXJOYW1lOiBtb3RoZXJOYW1lIH07XG4gIH1cblxuICBzZXREYXRlc1VzaW5nUXVhbGlmaWVyQW5kWWVhck51bShkYXRlcywgeWVhck51bSwgZGF0ZVF1YWxpZmllcikge1xuICAgIGlmICgheWVhck51bSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHZhciBmcm9tWWVhciA9IHllYXJOdW07XG4gICAgdmFyIHRvWWVhciA9IHllYXJOdW07XG5cbiAgICBzd2l0Y2ggKGRhdGVRdWFsaWZpZXIpIHtcbiAgICAgIGNhc2UgZGF0ZVF1YWxpZmllcnMuTk9ORTpcbiAgICAgICAgZnJvbVllYXIgPSB5ZWFyTnVtIC0gMjtcbiAgICAgICAgdG9ZZWFyID0geWVhck51bSArIDI7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBkYXRlUXVhbGlmaWVycy5FWEFDVDpcbiAgICAgICAgZnJvbVllYXIgPSB5ZWFyTnVtO1xuICAgICAgICB0b1llYXIgPSB5ZWFyTnVtO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgZGF0ZVF1YWxpZmllcnMuQUJPVVQ6XG4gICAgICAgIGZyb21ZZWFyID0geWVhck51bSAtIDU7XG4gICAgICAgIHRvWWVhciA9IHllYXJOdW0gKyA1O1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgZGF0ZVF1YWxpZmllcnMuQkVGT1JFOlxuICAgICAgICBmcm9tWWVhciA9IHllYXJOdW0gLSA1O1xuICAgICAgICB0b1llYXIgPSB5ZWFyTnVtO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgZGF0ZVF1YWxpZmllcnMuQUZURVI6XG4gICAgICAgIGZyb21ZZWFyID0geWVhck51bTtcbiAgICAgICAgdG9ZZWFyID0geWVhck51bSArIDU7XG4gICAgICAgIGJyZWFrO1xuICAgIH1cblxuICAgIC8vIGFkZCBhbiBleHRyYSAxIHllYXIgZWl0aGVyIHNpZGUgYmVjYXVzZSB0aGUgdGFyZ2V0IHJlY29yZHMgdGhhdCB3ZSBhcmUgc2VhcmNoaW5nIGZvclxuICAgIC8vIGNhbiBoYXZlIGluYWNjdXJhY2llc1xuICAgIGZyb21ZZWFyID0gZnJvbVllYXIgLSAxO1xuICAgIHRvWWVhciA9IHRvWWVhciArIDE7XG5cbiAgICBkYXRlcy5zdGFydFllYXIgPSBmcm9tWWVhcjtcbiAgICBkYXRlcy5lbmRZZWFyID0gdG9ZZWFyO1xuICB9XG5cbiAgc2V0RGF0ZXNVc2luZ1F1YWxpZmllcihkYXRlcywgeWVhclN0cmluZywgZGF0ZVF1YWxpZmllcikge1xuICAgIGlmICgheWVhclN0cmluZyB8fCB5ZWFyU3RyaW5nID09IFwiXCIpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBsZXQgeWVhck51bSA9IFdUU19EYXRlLmdldFllYXJOdW1Gcm9tWWVhclN0cmluZyh5ZWFyU3RyaW5nKTtcbiAgICBpZiAoIXllYXJOdW0pIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB2YXIgZnJvbVllYXIgPSB5ZWFyTnVtO1xuICAgIHZhciB0b1llYXIgPSB5ZWFyTnVtO1xuXG4gICAgc3dpdGNoIChkYXRlUXVhbGlmaWVyKSB7XG4gICAgICBjYXNlIGRhdGVRdWFsaWZpZXJzLk5PTkU6XG4gICAgICAgIGZyb21ZZWFyID0geWVhck51bSAtIDI7XG4gICAgICAgIHRvWWVhciA9IHllYXJOdW0gKyAyO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgZGF0ZVF1YWxpZmllcnMuRVhBQ1Q6XG4gICAgICAgIGZyb21ZZWFyID0geWVhck51bTtcbiAgICAgICAgdG9ZZWFyID0geWVhck51bTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIGRhdGVRdWFsaWZpZXJzLkFCT1VUOlxuICAgICAgICBmcm9tWWVhciA9IHllYXJOdW0gLSA1O1xuICAgICAgICB0b1llYXIgPSB5ZWFyTnVtICsgNTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIGRhdGVRdWFsaWZpZXJzLkJFRk9SRTpcbiAgICAgICAgZnJvbVllYXIgPSB5ZWFyTnVtIC0gNTtcbiAgICAgICAgdG9ZZWFyID0geWVhck51bTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIGRhdGVRdWFsaWZpZXJzLkFGVEVSOlxuICAgICAgICBmcm9tWWVhciA9IHllYXJOdW07XG4gICAgICAgIHRvWWVhciA9IHllYXJOdW0gKyA1O1xuICAgICAgICBicmVhaztcbiAgICB9XG5cbiAgICAvLyBhZGQgYW4gZXh0cmEgMSB5ZWFyIGVpdGhlciBzaWRlIGJlY2F1c2UgdGhlIHRhcmdldCByZWNvcmRzIHRoYXQgd2UgYXJlIHNlYXJjaGluZyBmb3JcbiAgICAvLyBjYW4gaGF2ZSBpbmFjY3VyYWNpZXNcbiAgICBmcm9tWWVhciA9IGZyb21ZZWFyIC0gMTtcbiAgICB0b1llYXIgPSB0b1llYXIgKyAxO1xuXG4gICAgZGF0ZXMuc3RhcnRZZWFyID0gZnJvbVllYXI7XG4gICAgZGF0ZXMuZW5kWWVhciA9IHRvWWVhcjtcbiAgfVxuXG4gIGNvdWxkUGVyc29uSGF2ZUJlZW5Cb3JuSW5EYXRlUmFuZ2Uoc3RhcnRZZWFyLCBlbmRZZWFyLCBtYXhMaWZlU3BhbiA9IHBvc3NpYmxlTGlmZVNwYW4pIHtcbiAgICBpZiAoIXN0YXJ0WWVhcikge1xuICAgICAgc3RhcnRZZWFyID0gMDtcbiAgICB9XG4gICAgaWYgKCFlbmRZZWFyKSB7XG4gICAgICBlbmRZZWFyID0gMzAwMDtcbiAgICB9XG5cbiAgICBsZXQgYmlydGhZZWFyTnVtID0gV1RTX0RhdGUuZ2V0WWVhck51bUZyb21ZZWFyU3RyaW5nKHRoaXMuaW5mZXJCaXJ0aFllYXIoKSk7XG4gICAgaWYgKGJpcnRoWWVhck51bSkge1xuICAgICAgcmV0dXJuIGJpcnRoWWVhck51bSA+PSBzdGFydFllYXIgJiYgYmlydGhZZWFyTnVtIDw9IGVuZFllYXI7XG4gICAgfVxuXG4gICAgbGV0IGRlYXRoWWVhck51bSA9IFdUU19EYXRlLmdldFllYXJOdW1Gcm9tWWVhclN0cmluZyh0aGlzLmluZmVyRGVhdGhZZWFyKCkpO1xuICAgIGlmIChkZWF0aFllYXJOdW0pIHtcbiAgICAgIGxldCBsYXN0ZXN0QmlydGhZZWFyTnVtID0gZGVhdGhZZWFyTnVtO1xuICAgICAgbGV0IGVhcmxpZXN0QmlydGhZZWFyTnVtID0gZGVhdGhZZWFyTnVtIC0gbWF4TGlmZVNwYW47XG4gICAgICByZXR1cm4gbGFzdGVzdEJpcnRoWWVhck51bSA+PSBzdGFydFllYXIgJiYgZWFybGllc3RCaXJ0aFllYXJOdW0gPD0gZW5kWWVhcjtcbiAgICB9XG5cbiAgICBsZXQgZXZlbnRZZWFyTnVtID0gV1RTX0RhdGUuZ2V0WWVhck51bUZyb21ZZWFyU3RyaW5nKHRoaXMuaW5mZXJFdmVudFllYXIoKSk7XG4gICAgaWYgKGV2ZW50WWVhck51bSkge1xuICAgICAgbGV0IGxhc3Rlc3RCaXJ0aFllYXJOdW0gPSBldmVudFllYXJOdW0gKyBtYXhMaWZlU3BhbjtcbiAgICAgIGxldCBlYXJsaWVzdEJpcnRoWWVhck51bSA9IGV2ZW50WWVhck51bSAtIG1heExpZmVTcGFuO1xuICAgICAgcmV0dXJuIGxhc3Rlc3RCaXJ0aFllYXJOdW0gPj0gc3RhcnRZZWFyICYmIGVhcmxpZXN0QmlydGhZZWFyTnVtIDw9IGVuZFllYXI7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRydWU7IC8vIGlmIHdlIGRvbid0IGtub3cgdGhlIGJpcnRoIHllYXIgdGhlbiBpdCBjb3VsZCBiZSBpbiByYW5nZVxuICB9XG5cbiAgY291bGRQZXJzb25IYXZlTWFycmllZEluRGF0ZVJhbmdlKHN0YXJ0WWVhciwgZW5kWWVhciwgbWF4TGlmZVNwYW4gPSBwb3NzaWJsZUxpZmVTcGFuKSB7XG4gICAgaWYgKCFzdGFydFllYXIpIHtcbiAgICAgIHN0YXJ0WWVhciA9IDA7XG4gICAgfVxuICAgIGlmICghZW5kWWVhcikge1xuICAgICAgZW5kWWVhciA9IDMwMDA7XG4gICAgfVxuXG4gICAgbGV0IGJpcnRoWWVhck51bSA9IFdUU19EYXRlLmdldFllYXJOdW1Gcm9tWWVhclN0cmluZyh0aGlzLmluZmVyQmlydGhZZWFyKCkpO1xuICAgIGxldCBkZWF0aFllYXJOdW0gPSBXVFNfRGF0ZS5nZXRZZWFyTnVtRnJvbVllYXJTdHJpbmcodGhpcy5pbmZlckRlYXRoWWVhcigpKTtcbiAgICBsZXQgYWdlQXREZWF0aCA9IHRoaXMuaW5mZXJBZ2VBdERlYXRoKCk7XG5cbiAgICAvL2NvbnNvbGUubG9nKFwiY291bGRQZXJzb25IYXZlTWFycmllZEluRGF0ZVJhbmdlOiBiaXJ0aFllYXJOdW0gaXM6IFwiICsgYmlydGhZZWFyTnVtICsgXCIsIGRlYXRoWWVhck51bSBpczogXCIgKyBkZWF0aFllYXJOdW0pO1xuICAgIC8vY29uc29sZS5sb2coXCJjb3VsZFBlcnNvbkhhdmVNYXJyaWVkSW5EYXRlUmFuZ2U6IGFnZUF0RGVhdGggaXM6IFwiICsgYWdlQXREZWF0aCk7XG4gICAgLy9jb25zb2xlLmxvZyhcImNvdWxkUGVyc29uSGF2ZU1hcnJpZWRJbkRhdGVSYW5nZTogc3RhcnRZZWFyIGlzOiBcIiArIHN0YXJ0WWVhciArIFwiLCBlbmRZZWFyIGlzOiBcIiArIGVuZFllYXIpO1xuXG4gICAgaWYgKGFnZUF0RGVhdGggJiYgYWdlQXREZWF0aCA8IDE0KSB7XG4gICAgICAvL2NvbnNvbGUubG9nKFwiY291bGRQZXJzb25IYXZlTWFycmllZEluRGF0ZVJhbmdlOiBhZ2VBdERlYXRoIDwgMTRcIik7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgaWYgKGJpcnRoWWVhck51bSAmJiBkZWF0aFllYXJOdW0pIHtcbiAgICAgIHJldHVybiBkZWF0aFllYXJOdW0gPj0gc3RhcnRZZWFyICsgMTYgJiYgYmlydGhZZWFyTnVtIDw9IGVuZFllYXIgLSAxNjtcbiAgICB9IGVsc2UgaWYgKGJpcnRoWWVhck51bSkge1xuICAgICAgcmV0dXJuIGJpcnRoWWVhck51bSA8PSBlbmRZZWFyIC0gMTY7XG4gICAgfSBlbHNlIGlmIChkZWF0aFllYXJOdW0pIHtcbiAgICAgIHJldHVybiBkZWF0aFllYXJOdW0gPj0gc3RhcnRZZWFyICsgMTY7XG4gICAgfVxuXG4gICAgbGV0IGV2ZW50WWVhck51bSA9IFdUU19EYXRlLmdldFllYXJOdW1Gcm9tWWVhclN0cmluZyh0aGlzLmluZmVyRXZlbnRZZWFyKCkpO1xuICAgIC8vY29uc29sZS5sb2coXCJjb3VsZFBlcnNvbkhhdmVNYXJyaWVkSW5EYXRlUmFuZ2U6IGV2ZW50WWVhck51bSBpczogXCIgKyBldmVudFllYXJOdW0pO1xuXG4gICAgaWYgKGV2ZW50WWVhck51bSkge1xuICAgICAgbGV0IGxhc3Rlc3REZWF0aFllYXJOdW0gPSBldmVudFllYXJOdW0gKyBtYXhMaWZlU3BhbjtcbiAgICAgIGxldCBlYXJsaWVzdEJpcnRoWWVhck51bSA9IGV2ZW50WWVhck51bSAtIG1heExpZmVTcGFuO1xuICAgICAgcmV0dXJuIGxhc3Rlc3REZWF0aFllYXJOdW0gPj0gc3RhcnRZZWFyICYmIGVhcmxpZXN0QmlydGhZZWFyTnVtIDw9IGVuZFllYXI7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRydWU7IC8vIGlmIHdlIGRvbid0IGtub3cgdGhlIGJpcnRoIG9yIGRlYXRoIHllYXIgdGhlbiBpdCBjb3VsZCBiZSBpbiByYW5nZVxuICB9XG5cbiAgY291bGRQZXJzb25IYXZlRGllZEluRGF0ZVJhbmdlKHN0YXJ0WWVhciwgZW5kWWVhciwgbWF4TGlmZXNwYW4gPSBwb3NzaWJsZUxpZmVTcGFuKSB7XG4gICAgaWYgKCFzdGFydFllYXIpIHtcbiAgICAgIHN0YXJ0WWVhciA9IDA7XG4gICAgfVxuICAgIGlmICghZW5kWWVhcikge1xuICAgICAgZW5kWWVhciA9IDMwMDA7XG4gICAgfVxuXG4gICAgbGV0IGRlYXRoWWVhck51bSA9IFdUU19EYXRlLmdldFllYXJOdW1Gcm9tWWVhclN0cmluZyh0aGlzLmluZmVyRGVhdGhZZWFyKCkpO1xuICAgIGlmIChkZWF0aFllYXJOdW0pIHtcbiAgICAgIHJldHVybiBkZWF0aFllYXJOdW0gPj0gc3RhcnRZZWFyICYmIGRlYXRoWWVhck51bSA8PSBlbmRZZWFyO1xuICAgIH1cblxuICAgIGxldCBiaXJ0aFllYXJOdW0gPSBXVFNfRGF0ZS5nZXRZZWFyTnVtRnJvbVllYXJTdHJpbmcodGhpcy5pbmZlckJpcnRoWWVhcigpKTtcbiAgICBpZiAoYmlydGhZZWFyTnVtKSB7XG4gICAgICBsZXQgbGFzdGVzdERlYXRoWWVhck51bSA9IGJpcnRoWWVhck51bSArIG1heExpZmVzcGFuO1xuICAgICAgbGV0IGVhcmxpZXN0RGVhdGhZZWFyTnVtID0gYmlydGhZZWFyTnVtO1xuICAgICAgcmV0dXJuIGxhc3Rlc3REZWF0aFllYXJOdW0gPj0gc3RhcnRZZWFyICYmIGVhcmxpZXN0RGVhdGhZZWFyTnVtIDw9IGVuZFllYXI7XG4gICAgfVxuXG4gICAgbGV0IGV2ZW50WWVhck51bSA9IFdUU19EYXRlLmdldFllYXJOdW1Gcm9tWWVhclN0cmluZyh0aGlzLmluZmVyRXZlbnRZZWFyKCkpO1xuICAgIGlmIChldmVudFllYXJOdW0pIHtcbiAgICAgIGxldCBsYXN0ZXN0RGVhdGhZZWFyTnVtID0gZXZlbnRZZWFyTnVtICsgbWF4TGlmZXNwYW47XG4gICAgICBsZXQgZWFybGllc3REZWF0aFllYXJOdW0gPSBldmVudFllYXJOdW0gLSBtYXhMaWZlc3BhbjtcbiAgICAgIHJldHVybiBsYXN0ZXN0RGVhdGhZZWFyTnVtID49IHN0YXJ0WWVhciAmJiBlYXJsaWVzdERlYXRoWWVhck51bSA8PSBlbmRZZWFyO1xuICAgIH1cblxuICAgIHJldHVybiB0cnVlOyAvLyBpZiB3ZSBkb24ndCBrbm93IHRoZSBkZWF0aCB5ZWFyIHRoZW4gaXQgY291bGQgYmUgaW4gcmFuZ2VcbiAgfVxuXG4gIGNvdWxkUGVyc29uSGF2ZUxpdmVkSW5EYXRlUmFuZ2Uoc3RhcnRZZWFyLCBlbmRZZWFyLCBtYXhMaWZlc3BhbiA9IHBvc3NpYmxlTGlmZVNwYW4pIHtcbiAgICBpZiAoIXN0YXJ0WWVhcikge1xuICAgICAgc3RhcnRZZWFyID0gMDtcbiAgICB9XG4gICAgaWYgKCFlbmRZZWFyKSB7XG4gICAgICBlbmRZZWFyID0gMzAwMDtcbiAgICB9XG5cbiAgICBsZXQgYmlydGhZZWFyTnVtID0gV1RTX0RhdGUuZ2V0WWVhck51bUZyb21ZZWFyU3RyaW5nKHRoaXMuaW5mZXJCaXJ0aFllYXIoKSk7XG4gICAgbGV0IGRlYXRoWWVhck51bSA9IFdUU19EYXRlLmdldFllYXJOdW1Gcm9tWWVhclN0cmluZyh0aGlzLmluZmVyRGVhdGhZZWFyKCkpO1xuXG4gICAgLy9jb25zb2xlLmxvZyhcImNvdWxkUGVyc29uSGF2ZUxpdmVkSW5EYXRlUmFuZ2U6IGJpcnRoWWVhck51bSBpczogXCIgKyBiaXJ0aFllYXJOdW0gKyBcIiwgZGVhdGhZZWFyTnVtIGlzOiBcIiArIGRlYXRoWWVhck51bSk7XG4gICAgLy9jb25zb2xlLmxvZyhcImNvdWxkUGVyc29uSGF2ZUxpdmVkSW5EYXRlUmFuZ2U6IHN0YXJ0WWVhciBpczogXCIgKyBzdGFydFllYXIgKyBcIiwgZW5kWWVhciBpczogXCIgKyBlbmRZZWFyKTtcblxuICAgIGlmIChiaXJ0aFllYXJOdW0gJiYgZGVhdGhZZWFyTnVtKSB7XG4gICAgICByZXR1cm4gZGVhdGhZZWFyTnVtID49IHN0YXJ0WWVhciAmJiBiaXJ0aFllYXJOdW0gPD0gZW5kWWVhcjtcbiAgICB9IGVsc2UgaWYgKGJpcnRoWWVhck51bSkge1xuICAgICAgcmV0dXJuIGJpcnRoWWVhck51bSA8PSBlbmRZZWFyO1xuICAgIH0gZWxzZSBpZiAoZGVhdGhZZWFyTnVtKSB7XG4gICAgICByZXR1cm4gZGVhdGhZZWFyTnVtID49IHN0YXJ0WWVhcjtcbiAgICB9XG5cbiAgICBsZXQgZXZlbnRZZWFyTnVtID0gV1RTX0RhdGUuZ2V0WWVhck51bUZyb21ZZWFyU3RyaW5nKHRoaXMuaW5mZXJFdmVudFllYXIoKSk7XG4gICAgLy9jb25zb2xlLmxvZyhcImNvdWxkUGVyc29uSGF2ZUxpdmVkSW5EYXRlUmFuZ2U6IGV2ZW50WWVhck51bSBpczogXCIgKyBldmVudFllYXJOdW0pO1xuXG4gICAgaWYgKGV2ZW50WWVhck51bSkge1xuICAgICAgbGV0IGxhc3Rlc3REZWF0aFllYXJOdW0gPSBldmVudFllYXJOdW0gKyBtYXhMaWZlc3BhbjtcbiAgICAgIGxldCBlYXJsaWVzdEJpcnRoWWVhck51bSA9IGV2ZW50WWVhck51bSAtIG1heExpZmVzcGFuO1xuICAgICAgcmV0dXJuIGxhc3Rlc3REZWF0aFllYXJOdW0gPj0gc3RhcnRZZWFyICYmIGVhcmxpZXN0QmlydGhZZWFyTnVtIDw9IGVuZFllYXI7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRydWU7IC8vIGlmIHdlIGRvbid0IGtub3cgdGhlIGJpcnRoIG9yIGRlYXRoIHllYXIgdGhlbiBpdCBjb3VsZCBiZSBpbiByYW5nZVxuICB9XG5cbiAgaW5mZXJQb3NzaWJsZUxpZmVZZWFyUmFuZ2UobWF4TGlmZXNwYW4gPSBwb3NzaWJsZUxpZmVTcGFuKSB7XG4gICAgbGV0IGJpcnRoWWVhciA9IHRoaXMuaW5mZXJCaXJ0aFllYXIoKTtcbiAgICBsZXQgZGVhdGhZZWFyID0gdGhpcy5pbmZlckRlYXRoWWVhcigpO1xuICAgIGxldCBldmVudFllYXIgPSB0aGlzLmluZmVyRXZlbnRZZWFyKCk7XG5cbiAgICBsZXQgY3VycmVudERhdGUgPSBuZXcgRGF0ZSgpO1xuICAgIGxldCBjdXJyZW50WWVhciA9IGN1cnJlbnREYXRlLmdldEZ1bGxZZWFyKCk7XG5cbiAgICBsZXQgYmlydGhZZWFyTnVtID0gV1RTX0RhdGUuZ2V0WWVhck51bUZyb21ZZWFyU3RyaW5nKGJpcnRoWWVhcik7XG4gICAgbGV0IGRlYXRoWWVhck51bSA9IFdUU19EYXRlLmdldFllYXJOdW1Gcm9tWWVhclN0cmluZyhkZWF0aFllYXIpO1xuICAgIGxldCBldmVudFllYXJOdW0gPSBXVFNfRGF0ZS5nZXRZZWFyTnVtRnJvbVllYXJTdHJpbmcoZXZlbnRZZWFyKTtcblxuICAgIGxldCByYW5nZSA9IHtcbiAgICAgIHN0YXJ0WWVhcjogdW5kZWZpbmVkLFxuICAgICAgZW5kWWVhcjogdW5kZWZpbmVkLFxuICAgIH07XG5cbiAgICBpZiAoYmlydGhZZWFyTnVtKSB7XG4gICAgICByYW5nZS5zdGFydFllYXIgPSBiaXJ0aFllYXJOdW07XG5cbiAgICAgIGlmIChkZWF0aFllYXJOdW0pIHtcbiAgICAgICAgcmFuZ2UuZW5kWWVhciA9IGRlYXRoWWVhck51bTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJhbmdlLmVuZFllYXIgPSBiaXJ0aFllYXJOdW0gKyBtYXhMaWZlc3BhbjtcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKGRlYXRoWWVhck51bSAmJiBkZWF0aFllYXJOdW0gPiBtYXhMaWZlc3Bhbikge1xuICAgICAgcmFuZ2Uuc3RhcnRZZWFyID0gZGVhdGhZZWFyTnVtIC0gbWF4TGlmZXNwYW47XG4gICAgICByYW5nZS5lbmRZZWFyID0gZGVhdGhZZWFyTnVtO1xuICAgIH0gZWxzZSBpZiAoZXZlbnRZZWFyTnVtKSB7XG4gICAgICByYW5nZS5zdGFydFllYXIgPSBldmVudFllYXJOdW0gLSBtYXhMaWZlc3BhbjtcbiAgICAgIHJhbmdlLmVuZFllYXIgPSBldmVudFllYXJOdW0gKyBtYXhMaWZlc3BhbjtcbiAgICB9XG5cbiAgICBpZiAocmFuZ2UuZW5kWWVhciA+IGN1cnJlbnRZZWFyKSB7XG4gICAgICByYW5nZS5lbmRZZWFyID0gY3VycmVudFllYXI7XG4gICAgfVxuXG4gICAgcmV0dXJuIHJhbmdlO1xuICB9XG5cbiAgZGlkUGVyc29uTGl2ZUluQ291bnRyeUxpc3Qoc2VhcmNoQ291bnRyeUFycmF5KSB7XG4gICAgbGV0IGNvdW50cnlBcnJheSA9IHRoaXMuaW5mZXJDb3VudHJpZXMoKTtcblxuICAgIC8vY29uc29sZS5sb2coXCJkaWRQZXJzb25MaXZlSW5Db3VudHJ5TGlzdDogc2VhcmNoQ291bnRyeUFycmF5IGlzOiBcIik7XG4gICAgLy9jb25zb2xlLmxvZyhzZWFyY2hDb3VudHJ5QXJyYXkpO1xuICAgIC8vY29uc29sZS5sb2coXCJkaWRQZXJzb25MaXZlSW5Db3VudHJ5TGlzdDogY291bnRyeUFycmF5IGlzOiBcIik7XG4gICAgLy9jb25zb2xlLmxvZyhjb3VudHJ5QXJyYXkpO1xuXG4gICAgaWYgKGNvdW50cnlBcnJheS5sZW5ndGggPiAwKSB7XG4gICAgICBmb3IgKGxldCBjb3VudHJ5IG9mIGNvdW50cnlBcnJheSkge1xuICAgICAgICBmb3IgKGxldCBzZWFyY2hDb3VudHJ5IG9mIHNlYXJjaENvdW50cnlBcnJheSkge1xuICAgICAgICAgIGlmIChjb3VudHJ5ID09IHNlYXJjaENvdW50cnkgfHwgQ0QuaXNQYXJ0T2YoY291bnRyeSwgc2VhcmNoQ291bnRyeSkpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIGdldFRlcm1Gb3JVbm1hcnJpZWQoKSB7XG4gICAgbGV0IHRlcm0gPSBcInNpbmdsZVwiO1xuICAgIGlmICh0aGlzLmlzUmVjb3JkSW5Db3VudHJ5KFwiVW5pdGVkIEtpbmdkb21cIikpIHtcbiAgICAgIGxldCBldmVudFllYXIgPSB0aGlzLmluZmVyRXZlbnRZZWFyKCk7XG4gICAgICBsZXQgeWVhck51bSA9IHBhcnNlSW50KGV2ZW50WWVhcik7XG4gICAgICBpZiAoIWlzTmFOKHllYXJOdW0pICYmIHllYXJOdW0gPCAxODkxKSB7XG4gICAgICAgIC8vIEluIFVLIHRoZSB0ZXJtIFVubWFycmllZCB3YXMgdXNlZCB1bnRpbCBpdCB3YXMgcmVwbGFjZSB3aXRoIHNpbmdsZSBpbiAxODkxXG4gICAgICAgIHRlcm0gPSBcInVubWFycmllZFwiO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAodGhpcy5pc1JlY29yZEluQ291bnRyeShcIlVuaXRlZCBTdGF0ZXNcIikpIHtcbiAgICAgIGxldCBldmVudFllYXIgPSB0aGlzLmluZmVyRXZlbnRZZWFyKCk7XG4gICAgICBsZXQgeWVhck51bSA9IHBhcnNlSW50KGV2ZW50WWVhcik7XG4gICAgICBpZiAoIWlzTmFOKHllYXJOdW0pICYmIHllYXJOdW0gPT0gMTk1MCkge1xuICAgICAgICAvLyBJbiBVUyAxOTUwIGNlbnN1cyB0aGUgdGVybSBOZXYgKGZvciBOZXZlciBNYXJyaWVkKSB3YXMgdXNlZCAoYXMgd2FzIFwiU2VwYXJhdGVkXCIpXG4gICAgICAgIHRlcm0gPSBcIm5ldmVyIG1hcnJpZWRcIjtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHRlcm07XG4gIH1cblxuICBoYXNIb3VzZWhvbGRUYWJsZSgpIHtcbiAgICBsZXQgZmllbGROYW1lcyA9IHRoaXMuaG91c2Vob2xkQXJyYXlGaWVsZHM7XG4gICAgbGV0IG9iamVjdEFycmF5ID0gdGhpcy5ob3VzZWhvbGRBcnJheTtcblxuICAgIGlmIChmaWVsZE5hbWVzICYmIG9iamVjdEFycmF5KSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBnZXROYXJyYXRpdmVEYXRlRm9ybWF0KGRhdGVPYmosIGZvcm1hdCwgaGlnaGxpZ2h0T3B0aW9uLCBhZGRQcmVwb3NpdGlvbiwgcHJlcFN1ZmZpeCA9IFwiXCIpIHtcbiAgICBsZXQgbmV3Rm9ybWF0ID0gZm9ybWF0O1xuICAgIGlmIChmb3JtYXQgPT0gXCJjb3VudHJ5XCIgfHwgZm9ybWF0ID09IFwiY291bnRyeU50aFwiKSB7XG4gICAgICBsZXQgY291bnRyeUFycmF5ID0gdGhpcy5pbmZlckNvdW50cmllcygpO1xuICAgICAgaWYgKGNvdW50cnlBcnJheS5sZW5ndGggPT0gMSAmJiBjb3VudHJ5QXJyYXlbMF0gPT0gXCJVbml0ZWQgU3RhdGVzXCIpIHtcbiAgICAgICAgaWYgKGZvcm1hdCA9PSBcImNvdW50cnlcIikge1xuICAgICAgICAgIG5ld0Zvcm1hdCA9IFwibW9udGhDb21tYVwiO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIG5ld0Zvcm1hdCA9IFwibW9udGhDb21tYU50aFwiO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoZm9ybWF0ID09IFwiY291bnRyeVwiKSB7XG4gICAgICAgICAgbmV3Rm9ybWF0ID0gXCJsb25nXCI7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgbmV3Rm9ybWF0ID0gXCJ0aGVOdGhcIjtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBkYXRlT2JqLmdldE5hcnJhdGl2ZUZvcm1hdChuZXdGb3JtYXQsIGhpZ2hsaWdodE9wdGlvbiwgYWRkUHJlcG9zaXRpb24sIHByZXBTdWZmaXgpO1xuICB9XG59XG5cbmV4cG9ydCB7IEdlbmVyYWxpemVkRGF0YSwgR0QsIFd0c05hbWUsIFd0c0RhdGUsIFd0c1BsYWNlLCBkYXRlUXVhbGlmaWVycywgUlQgfTtcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./extension/base/core/generalize_data_utils.mjs\n");

/***/ }),

/***/ "./extension/base/core/narrative_builder.mjs":
/*!***************************************************!*\
  !*** ./extension/base/core/narrative_builder.mjs ***!
  \***************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"NarrativeBuilder\": () => (/* binding */ NarrativeBuilder),\n/* harmony export */   \"buildNarrative\": () => (/* binding */ buildNarrative)\n/* harmony export */ });\n/* harmony import */ var _record_type_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./record_type.mjs */ \"./extension/base/core/record_type.mjs\");\n/* harmony import */ var _generalize_data_utils_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./generalize_data_utils.mjs */ \"./extension/base/core/generalize_data_utils.mjs\");\n/* harmony import */ var _wts_string_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./wts_string.mjs */ \"./extension/base/core/wts_string.mjs\");\n/* harmony import */ var _wts_date_mjs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./wts_date.mjs */ \"./extension/base/core/wts_date.mjs\");\n/* harmony import */ var _narrative_or_sentence_utils_mjs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./narrative_or_sentence_utils.mjs */ \"./extension/base/core/narrative_or_sentence_utils.mjs\");\n/* harmony import */ var _record_collections_mjs__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./record_collections.mjs */ \"./extension/base/core/record_collections.mjs\");\n/*\nMIT License\n\nCopyright (c) 2020 Robert M Pavey\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.\n*/\n\n\n\n\n\n\n\n\n\nclass NarrativeBuilder {\n  constructor(options) {\n    this.options = options;\n\n    this.recordType = _record_type_mjs__WEBPACK_IMPORTED_MODULE_0__.RT.Unclassified;\n\n    this.eventDate = \"\";\n    this.eventPlace = \"\";\n  }\n\n  getOptions() {\n    return this.options;\n  }\n\n  getSubcatOption(leafOptionName, subsectionOverride) {\n    let value = undefined;\n    if (this.optionsSubcategory) {\n      let subsection = subsectionOverride;\n      if (!subsection) {\n        subsection = this.optionsSubsection;\n      }\n      if (subsection) {\n        value = this.options[\"narrative_\" + this.optionsSubcategory + subsection + \"_\" + leafOptionName];\n      }\n      if (value == undefined) {\n        value = this.options[\"narrative_\" + this.optionsSubcategory + \"_\" + leafOptionName];\n      }\n    }\n    if (value == undefined || value == \"default\") {\n      value = this.options[\"narrative_general_\" + leafOptionName];\n    }\n    return value;\n  }\n\n  getCollection() {\n    let gd = this.eventGd;\n    let collection = undefined;\n    if (gd.collectionData && gd.collectionData.id) {\n      collection = _record_collections_mjs__WEBPACK_IMPORTED_MODULE_5__.RC.findCollection(gd.sourceOfData, gd.collectionData.id);\n    }\n    return collection;\n  }\n\n  getNarrativeAgeString(ageString) {\n    let result = \"\";\n    if (ageString) {\n      result = ageString.replace(/years?/i, \"\").trim();\n      if (/^\\d+\\/12$/.test(result)) {\n        result = result.replace(/\\/12/, \"\").trim();\n        if (result == \"1\") {\n          result += \" month\";\n        } else {\n          result += \" months\";\n        }\n      }\n    }\n    return result;\n  }\n\n  improveAndAbbreviatePlaceString(placeString) {\n    let gd = this.eventGd;\n    let options = this.options;\n\n    const countryStrings = [\n      [\", England\", \", England, United Kingdom\"],\n      [\", Wales\", \", Wales, United Kingdom\"],\n      [\", Scotland\", \", Scotland, United Kingdom\"],\n      [\n        \", Jersey\",\n        \", Jersey, United Kingdom\",\n        \", Jersey, Channel Islands\",\n        \", Jersey, Channel Islands, United Kingdom\",\n      ],\n      [\n        \", Guernsey\",\n        \", Guernsey, United Kingdom\",\n        \", Guernsey, Channel Islands\",\n        \", Guernsey, Channel Islands, United Kingdom\",\n      ],\n      [\", United Kingdom\", \"UK\"], // must come after the above countires that make up the UK\n      [\", Ireland\"],\n      [\", United States\", \", United States of America\", \", USA\"],\n      [\", Canada\"],\n      [\", New Zealand\"],\n      [\", Australia\"],\n      [\", France\"],\n      [\", Germany\"],\n      [\", Austria\"],\n      [\", Italy\"],\n      [\", Spain\"],\n      [\", Switzerland\"],\n      [\", Netherlands\"],\n      [\", Sweden\"],\n      [\", Norway\"],\n      [\", Denmark\"],\n      [\", Czech Republic\"],\n      [\", Hungary\"],\n      [\", Mexico\"],\n      [\", Peru\"],\n      [\", China\"],\n      [\", Japan\"],\n      [\", Thailand\"],\n      [\", Vietnam\"],\n      [\", Taiwan\"],\n      [\", French Polynesia\"],\n      [\", South Africa\"],\n      [\", Zimbabwe\"],\n    ];\n\n    // remove trailing . or spaces\n    while (placeString[placeString.length - 1] == \".\" || placeString[placeString.length - 1] == \" \") {\n      if (placeString.length > 1) {\n        placeString = placeString.substring(0, placeString.length - 1);\n      }\n    }\n\n    // if there is a word character immediately after a comma then add a space\n    placeString = placeString.replace(/,(\\w)/g, \", $1\");\n\n    // optionally remove, abbreviate or standardize country\n    if (options.narrative_general_country != \"full\") {\n      var countryIndex = -1;\n      var countryString = null;\n      var stdCountryString = null;\n      for (var country = 0; country < countryStrings.length; country++) {\n        let firstVariant = true;\n        let firstVariantName = null;\n        for (var variant of countryStrings[country]) {\n          if (firstVariant) {\n            firstVariant = false;\n            firstVariantName = variant;\n          }\n\n          if (placeString.endsWith(variant)) {\n            countryIndex = country;\n            countryString = variant;\n            if (firstVariantName && firstVariantName != variant) {\n              stdCountryString = firstVariantName;\n            }\n            break;\n          }\n        }\n        if (countryIndex != -1) {\n          break;\n        }\n      }\n      if (countryIndex != -1) {\n        // we found a country, decide whether to remove it\n        var removeCountry = false;\n\n        if (options.narrative_general_country == \"none\") {\n          removeCountry = true;\n        }\n\n        if (removeCountry) {\n          placeString = placeString.substring(0, placeString.length - countryString.length);\n        } else if (options.narrative_general_country == \"standard\" && stdCountryString) {\n          placeString = placeString.substring(0, placeString.length - countryString.length);\n          placeString += stdCountryString;\n        }\n      }\n    }\n\n    if (options.narrative_general_placeChurchFirst == \"yes\") {\n      const recordTypesWithChurchNames = [_record_type_mjs__WEBPACK_IMPORTED_MODULE_0__.RT.Baptism, _record_type_mjs__WEBPACK_IMPORTED_MODULE_0__.RT.Marriage, _record_type_mjs__WEBPACK_IMPORTED_MODULE_0__.RT.Burial];\n      const siteNamesWhereChurchCanBeAfterTown = [\"ancestry\"];\n\n      if (\n        recordTypesWithChurchNames.includes(gd.recordType) &&\n        siteNamesWhereChurchCanBeAfterTown.includes(gd.sourceOfData)\n      ) {\n        // attempt to change \"Huddersfield, St Peter,\" to \"St. Peter's church, Huddersfield,\"\n        let firstCommaIndex = placeString.indexOf(\",\");\n        if (firstCommaIndex != -1 && placeString.length > firstCommaIndex + 2) {\n          let secondCommaIndex = placeString.indexOf(\",\", firstCommaIndex + 1);\n          if (secondCommaIndex != -1) {\n            let churchName = placeString.substring(firstCommaIndex + 1, secondCommaIndex).trim();\n            let placeNoChurch =\n              placeString.substring(0, firstCommaIndex) + \", \" + placeString.substring(secondCommaIndex + 1).trim();\n\n            if (/^St[ \\.]+/.test(churchName) || /^All Saints/i.test(churchName)) {\n              if (churchName.endsWith(\"s\")) {\n                churchName += \"'\";\n              } else {\n                churchName += \"'s\";\n              }\n              churchName += \" church\";\n              placeString = churchName + \", \" + placeNoChurch;\n            }\n          }\n        }\n      }\n    }\n\n    return placeString;\n  }\n\n  getPlaceWithPreposition(placeString) {\n    if (!placeString) {\n      return placeString;\n    }\n\n    placeString = this.improveAndAbbreviatePlaceString(placeString);\n    let preposition = _wts_string_mjs__WEBPACK_IMPORTED_MODULE_2__.WTS_String.getPrepositionForPlaceString(placeString);\n    return preposition + \" \" + placeString;\n  }\n\n  getNameOrPronounOption() {\n    return this.getSubcatOption(\"nameOrPronoun\");\n  }\n\n  getPersonNameOrPronounWithFlag(isMidSentence = false) {\n    let gd = this.eventGd;\n\n    let nameOption = this.getNameOrPronounOption();\n    let result = { isValid: false };\n    result.isPronoun = false;\n\n    function tryFirstName() {\n      let name = gd.inferFirstName();\n      if (name) {\n        result.nameOrPronoun = name;\n        return true;\n      }\n      return false;\n    }\n\n    function tryForenames() {\n      let name = gd.inferForenames();\n      if (name) {\n        result.nameOrPronoun = name;\n        return true;\n      }\n      return false;\n    }\n\n    function tryFullName() {\n      let name = gd.inferFullName();\n      if (name) {\n        result.nameOrPronoun = name;\n        return true;\n      }\n      return false;\n    }\n\n    function tryPronoun() {\n      let gender = gd.personGender;\n      if (gender == \"male\") {\n        result.nameOrPronoun = \"He\";\n        result.isPronoun = true;\n        return true;\n      } else if (gender == \"female\") {\n        result.nameOrPronoun = \"She\";\n        result.isPronoun = true;\n        return true;\n      }\n      return false;\n    }\n\n    if (nameOption == \"firstName\") {\n      if (!tryFirstName()) {\n        if (!tryFullName()) {\n          tryPronoun();\n        }\n      }\n    } else if (nameOption == \"forenames\") {\n      if (!tryForenames()) {\n        if (!tryFullName()) {\n          tryPronoun();\n        }\n      }\n    } else if (nameOption == \"fullName\") {\n      if (!tryFullName()) {\n        tryPronoun();\n      }\n    } else if (nameOption == \"pronoun\") {\n      if (!tryPronoun()) {\n        if (!tryFirstName()) {\n          tryFullName();\n        }\n      }\n    }\n\n    if (!result.nameOrPronoun) {\n      return result;\n    }\n\n    if (result.isPronoun) {\n      if (isMidSentence) {\n        result.nameOrPronoun = result.nameOrPronoun.toLowerCase();\n      }\n    } else {\n      // In narrative we always want names in initial caps (note might need special case\n      // for mixed cased names like McLeod or MacLeod, the prefname can be a surname if no known first name)\n      // However, sometimes the generalize has already done a better job of this so it should not be done again\n      // NOTE: we could perhaps centralise the code in scotp that does name casing.\n      if (gd.sourceOfData != \"scotp\") {\n        result.nameOrPronoun = _wts_string_mjs__WEBPACK_IMPORTED_MODULE_2__.WTS_String.toInitialCapsEachWord(result.nameOrPronoun, true);\n      }\n    }\n\n    result.isValid = true;\n    return result;\n  }\n\n  getPersonNameOrPronoun(isMidSentence = false) {\n    let nameOrPronounObj = this.getPersonNameOrPronounWithFlag(isMidSentence);\n    if (nameOrPronounObj.isValid) {\n      return nameOrPronounObj.nameOrPronoun;\n    }\n    if (isMidSentence) {\n      return \"unknown\";\n    } else {\n      return \"Unknown\";\n    }\n  }\n\n  getPossessiveName(isMidSentence = false) {\n    const gd = this.eventGd;\n    let nameOrPronounObj = this.getPersonNameOrPronounWithFlag(isMidSentence);\n    if (nameOrPronounObj.isValid) {\n      if (nameOrPronounObj.isPronoun) {\n        let gender = gd.personGender;\n        if (gender == \"male\") {\n          return isMidSentence ? \"his\" : \"His\";\n        } else if (gender == \"female\") {\n          return isMidSentence ? \"her\" : \"Her\";\n        }\n      }\n      // http://www.sussex.ac.uk/informatics/punctuation/apostrophe/possessives\n      return nameOrPronounObj.nameOrPronoun + \"'s\";\n    }\n    return isMidSentence ? \"their\" : \"Their\";\n  }\n\n  getPossessiveNamePlusChild(isMidSentence = false) {\n    const gd = this.eventGd;\n    let string = this.getPossessiveName(isMidSentence);\n    string += \" \" + (0,_narrative_or_sentence_utils_mjs__WEBPACK_IMPORTED_MODULE_4__.getPrimaryPersonChildTerm)(gd);\n    if (gd.primaryPerson) {\n      string += \" \" + gd.primaryPerson;\n    }\n    return string;\n  }\n\n  getPossessiveNamePlusSpouse(isMidSentence = false) {\n    const gd = this.eventGd;\n    let string = this.getPossessiveName(isMidSentence);\n    string += \" \" + (0,_narrative_or_sentence_utils_mjs__WEBPACK_IMPORTED_MODULE_4__.getPrimaryPersonSpouseTerm)(gd);\n    if (gd.primaryPerson) {\n      string += \" \" + gd.primaryPerson;\n    }\n    return string;\n  }\n\n  getPronounInitialCaps() {\n    if (this.personGender == \"male\") {\n      return \"He\";\n    } else if (this.personGender == \"female\") {\n      return \"She\";\n    } else {\n      return \"They\";\n    }\n  }\n\n  getPronounAndPastTenseInitialCaps() {\n    if (this.personGender == \"male\") {\n      return \"He was\";\n    } else if (this.personGender == \"female\") {\n      return \"She was\";\n    } else {\n      return \"They were\";\n    }\n  }\n\n  getPossessivePronounForGenderInitialCaps(gender) {\n    if (gender == \"male\") {\n      return \"His\";\n    } else if (gender == \"female\") {\n      return \"Her\";\n    } else {\n      return \"Their\";\n    }\n  }\n\n  getPossessivePronounInitialCaps() {\n    return this.getPossessivePronounForGenderInitialCaps(this.personGender);\n  }\n\n  getPersonPronounOrNameIfNoGender(isMidSentence = false) {\n    let result = this.getPronounInitialCaps();\n\n    if (result == \"They\") {\n      const gd = this.eventGd;\n      let name = gd.inferFirstName();\n      if (name) {\n        return name;\n      }\n      name = gd.inferForenames();\n      if (name) {\n        return name;\n      }\n      name = gd.inferFullName();\n      if (name) {\n        return name;\n      }\n    }\n\n    if (isMidSentence) {\n      result = result.toLowerCase();\n    }\n\n    return result;\n  }\n\n  highlightDate(dateString) {\n    return _wts_string_mjs__WEBPACK_IMPORTED_MODULE_2__.WTS_String.highlightString(dateString, this.options.narrative_general_dateHighlight);\n  }\n\n  getParentSeparator() {\n    if (this.options.narrative_general_parentsUseAmpOrAnd == \"amp\") {\n      return \" & \";\n    } else {\n      return \" and \";\n    }\n  }\n\n  addParentageForMainSentence() {\n    let includeParentage = this.getSubcatOption(\"includeParentage\");\n    let parentageFormat = this.getSubcatOption(\"parentageFormat\");\n\n    if (includeParentage == \"inMainSentence\") {\n      let parentNames = this.eventGd.inferParentNamesForDataString();\n\n      if (parentNames.fatherName || parentNames.motherName) {\n        if (!this.narrative.endsWith(\",\")) {\n          this.narrative += \",\";\n        }\n        this.narrative += \" \";\n        if (parentageFormat == \"theTwoCommas\") {\n          this.narrative += \"the \";\n        }\n        this.narrative += (0,_narrative_or_sentence_utils_mjs__WEBPACK_IMPORTED_MODULE_4__.getChildTerm)(this.eventGd.personGender) + \" of \";\n        if (parentNames.fatherName) {\n          this.narrative += parentNames.fatherName;\n        }\n        if (parentNames.motherName) {\n          if (parentNames.fatherName) {\n            this.narrative += this.getParentSeparator();\n          }\n          this.narrative += parentNames.motherName;\n        }\n        this.narrative += \",\";\n      }\n    }\n  }\n\n  addParentageAsSeparateSentence() {\n    let includeParentage = this.getSubcatOption(\"includeParentage\");\n\n    if (includeParentage == \"inSeparateSentence\") {\n      let parentNames = this.eventGd.inferParentNamesForDataString();\n\n      if (parentNames.fatherName || parentNames.motherName) {\n        this.narrative += \" \" + this.getPronounAndPastTenseInitialCaps() + \" the \";\n        this.narrative += (0,_narrative_or_sentence_utils_mjs__WEBPACK_IMPORTED_MODULE_4__.getChildTerm)(this.eventGd.personGender) + \" of \";\n        if (parentNames.fatherName) {\n          this.narrative += parentNames.fatherName;\n        }\n        if (parentNames.motherName) {\n          if (parentNames.fatherName) {\n            this.narrative += this.getParentSeparator();\n          }\n          this.narrative += parentNames.motherName;\n        }\n        this.narrative += \".\";\n      }\n    }\n  }\n\n  formatDate(dateString, addPreposition, prepSuffix = \"\") {\n    // for cases where we don't have a date object\n    let dateObj = new _generalize_data_utils_mjs__WEBPACK_IMPORTED_MODULE_1__.WtsDate();\n    dateObj.dateString = dateString;\n    let format = this.options.narrative_general_dateFormat;\n    let highlight = this.options.narrative_general_dateHighlight;\n    return this.eventGd.getNarrativeDateFormat(dateObj, format, highlight, addPreposition, prepSuffix);\n  }\n\n  formatDateObj(dateObj, addPreposition, prepSuffix = \"\") {\n    if (dateObj) {\n      let format = this.options.narrative_general_dateFormat;\n      let highlight = this.options.narrative_general_dateHighlight;\n      return this.eventGd.getNarrativeDateFormat(dateObj, format, highlight, addPreposition, prepSuffix);\n    }\n    return \"\";\n  }\n\n  getQuarterName(quarterNumber) {\n    const quarterNames = [\"Jan-Feb-Mar\", \"Apr-May-Jun\", \"Jul-Aug-Sep\", \"Oct-Nov-Dec\"];\n    if (quarterNumber != undefined && quarterNumber >= 1 && quarterNumber <= 4) {\n      return quarterNames[quarterNumber - 1];\n    }\n\n    return \"\";\n  }\n\n  ////////////////////////////////////////////////////////////////////////////////////////////////////\n  // Age\n  ////////////////////////////////////////////////////////////////////////////////////////////////////\n\n  addAgePartForMainSentence(age) {\n    if (age) {\n      let includeAgeText = true;\n      if (typeof age == \"string\" && age.toLowerCase().indexOf(\"age\") != -1) {\n        // it could be something like \"of Full Age\"\n        includeAgeText = false;\n        age = age.toLowerCase();\n      }\n\n      let format = this.getSubcatOption(\"ageFormat\");\n      if (includeAgeText) {\n        if (format == \"parensAge\") {\n          this.narrative += \" (age \" + age + \")\";\n        } else if (format == \"commasAge\") {\n          if (!this.narrative.endsWith(\",\")) {\n            this.narrative += \",\";\n          }\n          this.narrative += \" age \" + age + \",\";\n        } else if (format == \"plainAge\") {\n          this.narrative += \" age \" + age;\n        } else if (format == \"parensAged\") {\n          this.narrative += \" (aged \" + age + \")\";\n        } else if (format == \"commasAged\") {\n          if (!this.narrative.endsWith(\",\")) {\n            this.narrative += \",\";\n          }\n          this.narrative += \" aged \" + age + \",\";\n        } else if (format == \"plainAged\") {\n          this.narrative += \" aged \" + age;\n        }\n      } else {\n        if (format == \"parensAge\" || format == \"parensAged\") {\n          this.narrative += \" (\" + age + \")\";\n        } else if (format == \"commasAge\" || format == \"commasAged\") {\n          if (!this.narrative.endsWith(\",\")) {\n            this.narrative += \",\";\n          }\n          this.narrative += \" \" + age + \",\";\n        } else if (format == \"plainAge\" || format == \"plainAged\") {\n          this.narrative += \" \" + age;\n        }\n      }\n    }\n  }\n\n  addAgeForMainSentence(age) {\n    if (this.getSubcatOption(\"includeAge\") == \"inMainSentence\") {\n      this.addAgePartForMainSentence(age);\n    }\n  }\n\n  addAgeAsSeparateSentence(age) {\n    if (this.getSubcatOption(\"includeAge\") == \"inSeparateSentence\") {\n      if (age) {\n        this.narrative += \" \" + this.getPronounAndPastTenseInitialCaps() + \" \";\n\n        if (age.search(/[^0-9]/) != -1) {\n          // the age has non numerical characters, it could be something like \"of Full Age\"\n          let lcAge = age.toLowerCase();\n          this.narrative += lcAge;\n        } else {\n          this.narrative += age + \" years old\";\n        }\n\n        this.narrative += \".\";\n      }\n    }\n  }\n\n  ////////////////////////////////////////////////////////////////////////////////////////////////////\n  // Occupation helpers\n  ////////////////////////////////////////////////////////////////////////////////////////////////////\n\n  getCleanOccupation() {\n    let occupation = this.eventGd.occupation;\n    if (occupation) {\n      let lcOccupation = occupation.toLowerCase();\n      if (lcOccupation == \"none\" || lcOccupation == \"no occupation\") {\n        occupation = \"\";\n      }\n    }\n    return occupation;\n  }\n\n  getOccupationPart(occupation) {\n    let occupationText = occupation;\n    if (this.options.narrative_general_occupationFormat == \"lowerCase\") {\n      occupationText = occupationText.toLowerCase();\n    } else if (this.options.narrative_general_occupationFormat == \"titleCase\") {\n      // Sometimes there are parens like this: \"Pattern Maker (Artz)\"\n      // toInitialCapsEachWord keeps that OK now\n      occupationText = _wts_string_mjs__WEBPACK_IMPORTED_MODULE_2__.WTS_String.toInitialCapsEachWord(occupationText);\n    }\n\n    return occupationText;\n  }\n\n  addOccupationForMainSentence(occupation, optionsSubcategory) {\n    let includeOption = this.getSubcatOption(\"includeOccupation\");\n\n    if (occupation && includeOption == \"inMainSentence\") {\n      let occupationText = this.getOccupationPart(occupation);\n      if (occupationText) {\n        if (!this.narrative.endsWith(\",\")) {\n          this.narrative += \",\";\n        }\n        this.narrative += \" \" + occupationText + \",\";\n      }\n    }\n  }\n\n  addOccupationAsSeparateSentence(occupation, relationship) {\n    let gd = this.eventGd;\n    let occupationText = \"\";\n    let headRelation = \"\";\n\n    let includeOption = this.getSubcatOption(\"includeOccupation\");\n\n    if (includeOption == \"inSeparateSentence\") {\n      if (occupation) {\n        occupationText = this.getOccupationPart(occupation);\n      }\n    } else if (includeOption == \"inSeparateSentenceHead\") {\n      if (occupation) {\n        occupationText = this.getOccupationPart(occupation);\n      } else if (relationship && gd.householdArray) {\n        // try to get parent occupation\n        const childRelationships = [\"son\", \"daughter\"];\n        if (childRelationships.includes(relationship)) {\n          for (let member of gd.householdArray) {\n            if (member.relationship && member.relationship.includes(\"head\")) {\n              if (member.gender == \"male\") {\n                headRelation = \"father\";\n              }\n              if (member.gender == \"female\") {\n                headRelation = \"mother\";\n              }\n              occupationText = this.getOccupationPart(member.occupation);\n              break;\n            }\n          }\n        } else if (relationship == \"wife\") {\n          for (let member of gd.householdArray) {\n            if (member.relationship && member.relationship.includes(\"head\")) {\n              headRelation = \"husband\";\n              occupationText = this.getOccupationPart(member.occupation);\n              break;\n            }\n          }\n        }\n      }\n    }\n\n    if (occupationText) {\n      if (headRelation) {\n        this.narrative += \" \" + this.getPossessivePronounInitialCaps() + \" \" + headRelation + \" was \";\n        this.narrative += _wts_string_mjs__WEBPACK_IMPORTED_MODULE_2__.WTS_String.getIndefiniteArticle(occupationText);\n        this.narrative += \" \" + occupationText;\n        this.narrative += \".\";\n      } else {\n        this.narrative += \" \" + this.getPronounInitialCaps() + \" was \";\n        this.narrative += _wts_string_mjs__WEBPACK_IMPORTED_MODULE_2__.WTS_String.getIndefiniteArticle(occupationText);\n        this.narrative += \" \" + occupationText;\n        this.narrative += \".\";\n      }\n    }\n  }\n\n  ////////////////////////////////////////////////////////////////////////////////////////////////////\n  // Functions to build narrative for each record type\n  ////////////////////////////////////////////////////////////////////////////////////////////////////\n\n  buildRegistrationStringOfType(typeString) {\n    let quarter = this.getQuarterName(this.eventGd.inferEventQuarter());\n\n    let year = this.eventGd.inferEventYear();\n    let dateObj = this.eventGd.inferEventDateObj();\n    let dateString = this.eventGd.inferEventDate();\n    let registrationDistrict = this.eventGd.registrationDistrict;\n    let eventPlace = this.eventGd.inferFullEventPlace();\n\n    let ageAtEvent = this.eventGd.inferAgeAtEvent();\n\n    let gd = this.eventGd;\n\n    this.optionsSubcategory = typeString + \"Reg\";\n\n    // Note - we may need a better way to distinguish between the date being the birth/marriage/death date and\n    // it being the registration date/quarter.\n    // It might require either a separate record type or a flag in the GD\n    let isDateTheRegistrationDate = false;\n    if (registrationDistrict && (this.eventGd.isRecordInCountry(\"United Kingdom\") || !eventPlace)) {\n      isDateTheRegistrationDate = true;\n    } else if ((quarter || year == dateString) && year) {\n      isDateTheRegistrationDate = true;\n    }\n\n    if (!isDateTheRegistrationDate) {\n      // sometimes there is no event date but there is a marriage date\n      if (!dateObj) {\n        if (typeString == \"marriage\" && this.eventGd.marriageDate) {\n          dateObj = new _generalize_data_utils_mjs__WEBPACK_IMPORTED_MODULE_1__.WtsDate();\n          dateObj.dateString = this.eventGd.marriageDate;\n          dateString = this.eventGd.marriageDate;\n          year = dateObj.getYearString();\n        }\n      }\n    }\n\n    let spouseName = \"\";\n    let spouseAge = \"\";\n    if (this.eventGd.spouses && this.eventGd.spouses.length == 1) {\n      let spouse = this.eventGd.spouses[0];\n      if (spouse.name) {\n        spouseName = spouse.name.inferFullName();\n      }\n      if (spouse.age) {\n        spouseAge = spouse.age;\n      }\n    }\n    const toPast = { birth: \"was born\", marriage: \"married\", death: \"died\" };\n\n    if (isDateTheRegistrationDate) {\n      this.optionsSubsection = \"Reg\";\n      let sentenceStructure = this.getSubcatOption(\"sentenceStructure\");\n\n      if (sentenceStructure == \"oneSentence\") {\n        // One sentence format\n        if (gd.role && gd.role == _record_type_mjs__WEBPACK_IMPORTED_MODULE_0__.Role.Parent) {\n          this.narrative += \"The \" + typeString + \" of \" + this.getPossessiveNamePlusChild();\n        } else if (gd.role && gd.role == _record_type_mjs__WEBPACK_IMPORTED_MODULE_0__.Role.Spouse) {\n          this.narrative += \"The \" + typeString + \" of \" + this.getPossessiveNamePlusSpouse();\n        } else {\n          let possessiveName = this.getPossessiveName();\n          this.narrative += possessiveName + \" \" + typeString;\n          this.addAgeForMainSentence(ageAtEvent);\n        }\n\n        if (spouseName) {\n          this.narrative += \" to \" + spouseName;\n          this.addAgeForMainSentence(spouseAge);\n        }\n      } else {\n        // Two sentence format\n        let pastTense = toPast[typeString];\n        if (gd.role && gd.role == _record_type_mjs__WEBPACK_IMPORTED_MODULE_0__.Role.Parent) {\n          this.narrative += this.getPossessiveNamePlusChild();\n        } else if (gd.role && gd.role == _record_type_mjs__WEBPACK_IMPORTED_MODULE_0__.Role.Spouse) {\n          this.narrative += this.getPossessiveNamePlusSpouse();\n        } else {\n          this.narrative += this.getPersonNameOrPronoun();\n          this.addAgeForMainSentence(ageAtEvent);\n        }\n\n        this.narrative += \" \" + pastTense;\n        if (spouseName) {\n          this.narrative += \" \" + spouseName;\n          this.addAgeForMainSentence(spouseAge);\n        }\n        let year = this.eventGd.inferEventYear();\n        if (year) {\n          if (quarter == \"Jan-Feb-Mar\") {\n            let yearNum = _wts_date_mjs__WEBPACK_IMPORTED_MODULE_3__.WTS_Date.getYearNumFromYearString(year);\n            if (yearNum) {\n              yearNum -= 1;\n              this.narrative += \" in late \" + yearNum + \"/early \" + year;\n            } else {\n              this.narrative += \" in \" + year;\n            }\n          } else {\n            this.narrative += \" in \" + year;\n          }\n        }\n        this.narrative += \". \";\n        let pronoun = \"Their\";\n        if (!spouseName) {\n          if (this.eventGd.role) {\n            pronoun = this.getPossessivePronounForGenderInitialCaps(this.eventGd.primaryPersonGender);\n          } else {\n            pronoun = this.getPossessivePronounInitialCaps();\n          }\n          if (pronoun == \"Their\") {\n            pronoun = \"The\";\n          }\n        }\n        this.narrative += pronoun + \" \" + typeString;\n      }\n\n      this.narrative += \" was registered\";\n\n      if (sentenceStructure == \"oneSentence\" || sentenceStructure == \"twoSentencesDate\") {\n        if (quarter) {\n          this.narrative += \" in the \" + quarter + \" quarter of \" + this.highlightDate(year);\n        } else {\n          this.narrative += \" in \" + this.highlightDate(year);\n        }\n      }\n    } else {\n      this.optionsSubsection = \"Evt\";\n\n      let pastTense = toPast[typeString];\n\n      if (gd.role && gd.role == _record_type_mjs__WEBPACK_IMPORTED_MODULE_0__.Role.Parent) {\n        this.narrative += this.getPossessiveNamePlusChild();\n        this.narrative += \" \" + pastTense;\n      } else if (gd.role && gd.role == _record_type_mjs__WEBPACK_IMPORTED_MODULE_0__.Role.Spouse) {\n        this.narrative += this.getPossessiveNamePlusSpouse();\n        this.narrative += \" \" + pastTense;\n      } else {\n        this.narrative += this.getPersonNameOrPronoun();\n        this.addParentageForMainSentence();\n\n        if (ageAtEvent && typeString == \"marriage\") {\n          this.addAgeForMainSentence(ageAtEvent);\n        }\n        this.narrative += \" \" + pastTense;\n        if (ageAtEvent && typeString != \"marriage\") {\n          this.addAgeForMainSentence(ageAtEvent);\n        }\n      }\n\n      if (typeString == \"marriage\") {\n        if (spouseName) {\n          this.narrative += \" \" + spouseName;\n          this.addAgeForMainSentence(spouseAge);\n        }\n      }\n\n      if (dateObj) {\n        this.narrative += \" \" + this.formatDateObj(dateObj, true);\n      }\n    }\n\n    if (isDateTheRegistrationDate && registrationDistrict) {\n      let districtFormat = this.getSubcatOption(\"regDistrictFormat\", \"Reg\");\n\n      if (districtFormat == \"theDistrict\") {\n        this.narrative += \" in the \" + registrationDistrict + \" district\";\n      } else if (districtFormat == \"districtName\") {\n        this.narrative += \" in \" + registrationDistrict;\n      } else if (districtFormat == \"districtCounty\") {\n        this.narrative += \" in \" + registrationDistrict;\n        let county = this.eventGd.inferEventCounty();\n        if (county) {\n          this.narrative += \", \" + county;\n        }\n      }\n    } else if (eventPlace) {\n      this.narrative += \" \" + this.getPlaceWithPreposition(eventPlace);\n    }\n\n    this.narrative += \".\";\n\n    this.addParentageAsSeparateSentence();\n    this.addAgeAsSeparateSentence(ageAtEvent);\n  }\n\n  buildBirthRegistrationString() {\n    this.buildRegistrationStringOfType(\"birth\");\n  }\n\n  buildDeathRegistrationString() {\n    this.buildRegistrationStringOfType(\"death\");\n  }\n\n  buildMarriageRegistrationString() {\n    this.buildRegistrationStringOfType(\"marriage\");\n  }\n\n  buildBirthString() {\n    let gd = this.eventGd;\n    let dateObj = gd.inferBirthDateObj();\n    let place = gd.inferBirthPlace();\n    this.optionsSubcategory = \"birth\";\n\n    this.narrative = this.getPersonNameOrPronoun();\n\n    if (gd.role && gd.role == _record_type_mjs__WEBPACK_IMPORTED_MODULE_0__.Role.Parent && gd.primaryPerson) {\n      // This is a record for one of the parents\n      // \"X and X's child Z\"\n      if (gd.spouses && gd.spouses[0] && gd.spouses[0].name && gd.spouses[0].name.name) {\n        this.narrative += \" and \" + gd.spouses[0].name.name;\n      }\n      this.narrative += \"'s \" + (0,_narrative_or_sentence_utils_mjs__WEBPACK_IMPORTED_MODULE_4__.getPrimaryPersonChildTerm)(gd) + \" \" + gd.primaryPerson;\n      // inferBirthDate will not return the date of the primary person's birth\n      dateObj = gd.inferEventDateObj();\n      place = gd.inferEventPlace();\n    } else {\n      this.addParentageForMainSentence();\n    }\n\n    this.narrative += \" was born\"; // \"was\" is OK because we never use \"They\" at start\n\n    if (dateObj) {\n      this.narrative += \" \" + this.formatDateObj(dateObj, true);\n    }\n    if (place) {\n      this.narrative += \" \" + this.getPlaceWithPreposition(place);\n    }\n    this.narrative += \".\";\n\n    this.addParentageAsSeparateSentence();\n  }\n\n  buildDeathString() {\n    let gd = this.eventGd;\n    let dateObj = gd.inferDeathDateObj();\n    let place = gd.inferDeathPlace();\n    this.optionsSubcategory = \"death\";\n\n    if (gd.role && gd.role == _record_type_mjs__WEBPACK_IMPORTED_MODULE_0__.Role.Parent) {\n      this.narrative += this.getPossessiveNamePlusChild();\n      // inferDeathDate will not return the date of the primary person's death\n      dateObj = gd.inferEventDateObj();\n      place = gd.inferEventPlace();\n    } else if (gd.role && gd.role == _record_type_mjs__WEBPACK_IMPORTED_MODULE_0__.Role.Spouse) {\n      this.narrative += this.getPossessiveNamePlusSpouse();\n      // inferDeathDate will not return the date of the primary person's death\n      dateObj = gd.inferEventDateObj();\n      place = gd.inferEventPlace();\n    } else {\n      this.narrative += this.getPersonNameOrPronoun();\n      this.addParentageForMainSentence();\n    }\n\n    this.narrative += \" died\";\n\n    let ageAtEvent = this.eventGd.inferAgeAtEvent();\n    this.addAgeForMainSentence(ageAtEvent);\n\n    if (dateObj) {\n      this.narrative += \" \" + this.formatDateObj(dateObj, true);\n    }\n    if (place) {\n      this.narrative += \" \" + this.getPlaceWithPreposition(place);\n    } else {\n      let residencePlace = this.eventGd.inferResidencePlace();\n      if (residencePlace) {\n        this.narrative += \" residing \" + this.getPlaceWithPreposition(residencePlace);\n      }\n    }\n    this.narrative += \".\";\n\n    this.addAgeAsSeparateSentence(ageAtEvent);\n    this.addParentageAsSeparateSentence();\n  }\n\n  buildBaptismString() {\n    let gd = this.eventGd;\n    let dateObj = gd.inferEventDateObj();\n    let place = gd.inferFullEventPlace();\n    this.optionsSubcategory = \"baptism\";\n\n    let baptisedString = \"baptised\";\n    if (this.options.narrative_general_spelling == \"en_us\") {\n      baptisedString = \"baptized\";\n    }\n\n    if (gd.role && gd.role == _record_type_mjs__WEBPACK_IMPORTED_MODULE_0__.Role.Parent) {\n      this.narrative += this.getPossessiveNamePlusChild();\n      this.narrative += \" was \";\n    } else {\n      this.narrative += this.getPersonNameOrPronoun();\n      this.addParentageForMainSentence();\n      this.narrative += \" was \";\n    }\n\n    if (gd.birthDate && this.options.narrative_baptism_includeBirthDate) {\n      this.narrative += \"born \" + this.formatDateObj(gd.birthDate, true);\n      if (this.options.narrative_baptism_sentenceStructure == \"parentsBornAndBap\") {\n        this.narrative += \" and \";\n      } else {\n        this.narrative += \"; \";\n      }\n    }\n\n    this.narrative += baptisedString;\n\n    if (dateObj) {\n      this.narrative += \" \" + this.formatDateObj(dateObj, true);\n    }\n    if (place) {\n      this.narrative += \" \" + this.getPlaceWithPreposition(place);\n    }\n\n    // sometimes a baptism has a death date. (e.g. germany_baptism_1840_johanna_hartmann)\n    if (this.options.narrative_baptism_includeDeathDate) {\n      let deathDateObj = gd.inferDeathDateObj();\n      if (deathDateObj) {\n        this.narrative += \" and died \" + this.formatDateObj(deathDateObj, true);\n      }\n    }\n\n    this.narrative += \".\";\n\n    this.addParentageAsSeparateSentence();\n  }\n\n  buildMarriageString() {\n    let gd = this.eventGd;\n    let dateObj = this.eventGd.inferEventDateObj();\n    let place = this.eventGd.inferFullEventPlace();\n    let ageAtEvent = this.eventGd.inferAgeAtEvent();\n\n    this.optionsSubcategory = \"marriage\";\n\n    let spouseName = \"\";\n    let spouseAge = \"\";\n    if (this.eventGd.spouses && gd.spouses.length == 1) {\n      let spouse = gd.spouses[0];\n      if (spouse.name) {\n        spouseName = spouse.name.inferFullName();\n      }\n      if (spouse.age) {\n        spouseAge = spouse.age;\n      }\n    }\n\n    if (gd.role && gd.role == _record_type_mjs__WEBPACK_IMPORTED_MODULE_0__.Role.Parent) {\n      this.narrative += this.getPossessiveNamePlusChild();\n      this.narrative += \" married\";\n    } else {\n      this.narrative += this.getPersonNameOrPronoun();\n      this.addAgeForMainSentence(ageAtEvent);\n      this.addParentageForMainSentence();\n      this.narrative += \" married\";\n    }\n\n    if (spouseName) {\n      spouseName = _wts_string_mjs__WEBPACK_IMPORTED_MODULE_2__.WTS_String.toInitialCapsEachWord(spouseName, true);\n      this.narrative += \" \" + spouseName;\n      this.addAgeForMainSentence(spouseAge);\n    }\n\n    if (gd.recordSubtype && gd.recordSubtype == _record_type_mjs__WEBPACK_IMPORTED_MODULE_0__.RecordSubtype.Banns && (dateObj || place)) {\n      this.narrative += \". The banns were read\";\n    }\n\n    if (this.eventGd.marriageDate) {\n      // sometimes there is a specific marriage date\n      dateObj = new _generalize_data_utils_mjs__WEBPACK_IMPORTED_MODULE_1__.WtsDate();\n      dateObj.dateString = this.eventGd.marriageDate;\n      this.narrative += \" \" + this.formatDateObj(dateObj, true);\n    } else if (dateObj) {\n      let prepSuffix = \"\";\n      if (gd.recordSubtype && gd.recordSubtype == _record_type_mjs__WEBPACK_IMPORTED_MODULE_0__.RecordSubtype.MarriageOrBanns) {\n        prepSuffix = \"or after\";\n      }\n      this.narrative += \" \" + this.formatDateObj(dateObj, true, prepSuffix);\n    }\n    if (place) {\n      this.narrative += \" \" + this.getPlaceWithPreposition(place);\n    }\n    this.narrative += \".\";\n\n    this.addAgeAsSeparateSentence(ageAtEvent);\n    this.addParentageAsSeparateSentence();\n  }\n\n  buildBurialString() {\n    let gd = this.eventGd;\n    this.optionsSubcategory = \"burial\";\n\n    let burialDate = gd.eventDate;\n    let deathDate = gd.deathDate;\n\n    let place = gd.inferFullEventPlace();\n\n    if (gd.role && gd.role == _record_type_mjs__WEBPACK_IMPORTED_MODULE_0__.Role.Parent) {\n      this.narrative += this.getPossessiveNamePlusChild();\n    } else {\n      this.narrative += this.getPersonNameOrPronoun();\n    }\n\n    let age = this.eventGd.ageAtDeath;\n    if (!age) {\n      age = this.eventGd.ageAtEvent;\n    }\n    this.addAgeForMainSentence(age);\n\n    if (!gd.role) {\n      this.addParentageForMainSentence();\n    }\n\n    if (deathDate && burialDate && deathDate.dateString != burialDate.dateString) {\n      this.narrative += \" died\";\n      this.narrative += \" \" + this.formatDateObj(deathDate, true);\n      this.narrative += \" and was buried\";\n      this.narrative += \" \" + this.formatDateObj(burialDate, true);\n    } else if (gd.recordType == _record_type_mjs__WEBPACK_IMPORTED_MODULE_0__.RT.DeathOrBurial) {\n      this.narrative += \" died or was buried\";\n      this.narrative += \" \" + this.formatDateObj(burialDate, true);\n    } else if (burialDate) {\n      this.narrative += \" was buried\";\n      this.narrative += \" \" + this.formatDateObj(burialDate, true);\n    } else if (deathDate) {\n      this.narrative += \" died\";\n      this.narrative += \" \" + this.formatDateObj(deathDate, true);\n      this.narrative += \" and was buried\";\n    } else {\n      this.narrative += \" was buried\";\n    }\n\n    if (place) {\n      this.narrative += \" \" + this.getPlaceWithPreposition(place);\n    }\n    this.narrative += \".\";\n\n    this.addAgeAsSeparateSentence(age);\n    this.addParentageAsSeparateSentence();\n  }\n\n  buildCremationString() {\n    let cremationDate = this.eventGd.eventDate;\n    let deathDate = this.eventGd.deathDate;\n    this.optionsSubcategory = \"cremation\";\n\n    let place = this.eventGd.inferFullEventPlace();\n\n    this.narrative = this.getPersonNameOrPronoun();\n\n    if (deathDate && cremationDate) {\n      this.narrative += \" died\";\n      this.narrative += \" \" + this.formatDateObj(deathDate, true);\n      this.narrative += \" and was cremated\";\n      this.narrative += \" \" + this.formatDateObj(cremationDate, true);\n    } else if (cremationDate) {\n      this.narrative += \" was cremated\";\n      this.narrative += \" \" + this.formatDateObj(cremationDate, true);\n    } else if (deathDate) {\n      this.narrative += \" died\";\n      this.narrative += \" \" + this.formatDateObj(deathDate, true);\n      this.narrative += \" and was cremated\";\n    } else {\n      this.narrative += \" was cremated\";\n    }\n\n    if (place) {\n      this.narrative += \" \" + this.getPlaceWithPreposition(place);\n    }\n    this.narrative += \".\";\n  }\n\n  buildMemorialString() {\n    let gd = this.eventGd;\n    this.optionsSubcategory = \"memorial\";\n\n    let place = gd.inferFullEventPlace();\n\n    let deathDate = gd.inferDeathDate();\n\n    this.narrative += this.getPersonNameOrPronoun();\n    this.narrative += \" was mentioned on a memorial\";\n\n    if (place) {\n      this.narrative += \" \" + this.getPlaceWithPreposition(place);\n    }\n    if (deathDate) {\n      this.narrative += \" with a death date of \" + this.formatDate(deathDate, false);\n    }\n    this.narrative += \".\";\n  }\n\n  buildObituaryString() {\n    let gd = this.eventGd;\n    this.optionsSubcategory = \"obituary\";\n\n    let eventPlace = gd.inferFullEventPlace();\n    let eventDateObj = gd.inferEventDateObj();\n    let deathDateObj = gd.inferDeathDateObj();\n    let deathPlace = gd.inferDeathPlace();\n    let age = \"\";\n\n    this.narrative += this.getPersonNameOrPronoun();\n    this.addParentageForMainSentence();\n\n    if (gd.role) {\n      let relationship = gd.getRelationshipOfPrimaryPersonToThisPerson();\n      let otherName = gd.primaryPerson;\n      if (relationship || otherName) {\n        this.narrative += \" was mentioned in the obituary of\";\n\n        if (relationship) {\n          let pronoun = this.getPossessivePronounInitialCaps().toLowerCase();\n          this.narrative += \" \" + pronoun + \" \" + relationship;\n        }\n\n        if (otherName) {\n          this.narrative += \" \" + otherName;\n        }\n      } else {\n        this.narrative += \" was mentioned in an obituary\";\n      }\n    } else {\n      this.narrative += \" was in an obituary\";\n    }\n\n    if (eventDateObj && (!deathDateObj || eventDateObj.getDateString() != deathDateObj.getDateString())) {\n      this.narrative += \" \" + this.formatDateObj(eventDateObj, true);\n    }\n    if (eventPlace && eventPlace != deathPlace) {\n      this.narrative += \" \" + this.getPlaceWithPreposition(eventPlace);\n    }\n\n    if (deathDateObj) {\n      this.narrative += \". \" + this.getPersonPronounOrNameIfNoGender() + \" died\";\n\n      age = this.eventGd.ageAtDeath;\n      if (!age) {\n        age = this.eventGd.ageAtEvent;\n      }\n      this.addAgeForMainSentence(age);\n\n      this.narrative += \" \" + this.formatDateObj(deathDateObj, true);\n\n      if (deathPlace) {\n        this.narrative += \" \" + this.getPlaceWithPreposition(deathPlace);\n      }\n    }\n    this.narrative += \".\";\n\n    this.addAgeAsSeparateSentence(age);\n    this.addParentageAsSeparateSentence();\n  }\n\n  buildBirthOrBaptismString() {\n    // This can happen in Ancestry, especially for child births or baptisms\n    let gd = this.eventGd;\n    let dateObj = gd.inferEventDateObj();\n    let place = gd.inferFullEventPlace();\n    this.optionsSubcategory = \"birthOrBaptism\";\n\n    let baptisedString = \"baptised\";\n    if (this.options.narrative_general_spelling == \"en_us\") {\n      baptisedString = \"baptized\";\n    }\n\n    if (gd.role && gd.role == _record_type_mjs__WEBPACK_IMPORTED_MODULE_0__.Role.Parent) {\n      this.narrative += this.getPossessiveNamePlusChild();\n      this.narrative += \" was born or \" + baptisedString;\n    } else {\n      this.narrative += this.getPersonNameOrPronoun();\n      this.addParentageForMainSentence();\n      this.narrative += \" was born or \" + baptisedString;\n    }\n\n    if (dateObj) {\n      this.narrative += \" \" + this.formatDateObj(dateObj, true);\n    }\n    if (place) {\n      this.narrative += \" \" + this.getPlaceWithPreposition(place);\n    }\n\n    // sometimes a baptism has a death date. (e.g. germany_baptism_1840_johanna_hartmann)\n    if (gd.deathDate) {\n      this.narrative += \" and died \" + this.formatDateObj(gd.inferDeathDateObj(), true);\n    }\n\n    this.narrative += \".\";\n\n    this.addParentageAsSeparateSentence();\n  }\n\n  buildCensusString() {\n    let gd = this.eventGd;\n    let options = this.options;\n    let builder = this;\n    let collection = this.getCollection();\n    this.optionsSubcategory = \"census\";\n\n    function getHeadOfHouseholdMemberIfNotSelected(household) {\n      let hasRelationships = false;\n      if (household && household.length > 1) {\n        for (let member of household) {\n          if (!member.isSelected && member.relationship) {\n            hasRelationships = true; // the selected person can have a relationship when the rest do not\n          }\n          if (!member.isSelected && member.relationship == \"head\") {\n            return member;\n          }\n        }\n\n        if (hasRelationships) {\n          // There is no head (this should not be called if this person is the head)\n          // Occasionally the first person of the household has a relationship of \"wife\" or \"widow\"\n          if (!household[0].isSelected) {\n            if (household[0].relationship == \"wife\" || household[0].relationship == \"widow\") {\n              return household[0];\n            }\n          }\n        } else {\n          if (!household[0].isSelected) {\n            return household[0];\n          }\n        }\n      }\n      return undefined;\n    }\n\n    function getHeadOfHouseholdNameIfNotSelected(household) {\n      let member = getHeadOfHouseholdMemberIfNotSelected(household);\n      if (member) {\n        return member.name;\n      }\n      return \"\";\n    }\n\n    function getCensusDatePart(year) {\n      let part1Option = options.narrative_census_censusDatePartFormat;\n      let result = \"\";\n      if (part1Option == \"inCensusTitle\") {\n        if (collection && collection.title) {\n          result = \"In the \" + collection.title;\n        } else {\n          result = \"In the \" + builder.highlightDate(year);\n          if (year == \"1939\") {\n            result += \" register\";\n          } else {\n            result += \" census\";\n          }\n        }\n      } else if (part1Option == \"inYearCensus\") {\n        result = \"In the \" + builder.highlightDate(year);\n        if (year == \"1939\") {\n          result += \" register\";\n        } else {\n          result += \" census\";\n        }\n      } else if (part1Option == \"inYear\") {\n        result = \"In \" + builder.highlightDate(year);\n      } else if (part1Option == \"onDate\") {\n        let date = \"\";\n        if (collection && collection.dates && collection.dates.exactDate) {\n          date = collection.dates.exactDate;\n        } else {\n          date = gd.inferEventDate();\n        }\n        if (date) {\n          let dateString = builder.formatDate(date, true);\n          // want to start with an upper cae letter\n          if (dateString && dateString.length > 1) {\n            dateString = dateString[0].toUpperCase() + dateString.substring(1);\n          }\n          result = dateString;\n        }\n      }\n      return result;\n    }\n\n    function getHouseholdPart() {\n      let result = \"\";\n      if (options.narrative_census_householdPartFormat == \"relationship\") {\n        if (relationship && maritalStatus) {\n          if (relationship.includes(\"head\")) {\n            result += \" the \" + maritalStatus + \" head of household\";\n          } else {\n            let headName = getHeadOfHouseholdNameIfNotSelected(gd.householdArray);\n            if (headName) {\n              if (relationship.includes(\"wife\")) {\n                result += \" the \" + relationship + \" of \" + headName;\n              } else {\n                result += \" the \" + maritalStatus + \" \" + relationship + \" of \" + headName;\n              }\n            } else {\n              result += \" a \" + maritalStatus + \" \" + relationship;\n            }\n          }\n        } else if (relationship) {\n          if (relationship.includes(\"head\")) {\n            result += \" the head of household\";\n          } else {\n            let headName = getHeadOfHouseholdNameIfNotSelected(gd.householdArray);\n            if (headName) {\n              result += \" the \" + relationship + \" of \" + headName;\n            } else {\n              result += \" a \" + relationship;\n            }\n          }\n        } else if (maritalStatus) {\n          result += \" recorded as \" + maritalStatus;\n        }\n      } else {\n        let listParts = [];\n\n        if (relationship && gd.householdArray) {\n          let hasWife = false;\n          let hasHusband = false;\n          let childCount = 0;\n          let childType = \"none\";\n          let childMaritalStatus = \"none\";\n          let siblingCount = 0;\n          let firstSiblingType = \"\";\n          let hasFather = false;\n          let hasMother = false;\n          let isHeadOrWife = false;\n\n          let headMember = getHeadOfHouseholdMemberIfNotSelected(gd.householdArray);\n\n          if (relationship.includes(\"head\") || relationship == \"wife\") {\n            isHeadOrWife = true;\n\n            for (let member of gd.householdArray) {\n              if (member.isSelected) continue;\n              let thisMemberIsHead = false;\n              if ((member.relationship && member.relationship.includes(\"head\")) || member == headMember) {\n                thisMemberIsHead = true;\n              }\n\n              if (relationship == \"wife\") {\n                if (thisMemberIsHead) {\n                  hasHusband = true;\n                } else if (member.relationship == \"father-in-law\") {\n                  hasFather = true;\n                } else if (member.relationship == \"mother-in-law\") {\n                  hasMother = true;\n                }\n              } else {\n                if (member.relationship == \"wife\") {\n                  hasWife = true;\n                } else if (member.relationship == \"father\") {\n                  hasFather = true;\n                } else if (member.relationship == \"mother\") {\n                  hasMother = true;\n                }\n              }\n\n              if (member.relationship == \"son\" || member.relationship == \"daughter\") {\n                childCount++;\n                if (childType == \"none\") {\n                  childType = member.relationship;\n                } else if (childType != member.relationship) {\n                  childType = \"mixed\"; // not all children are sons or daughters\n                }\n\n                if (member.maritalStatus) {\n                  if (childMaritalStatus == \"none\") {\n                    childMaritalStatus = member.maritalStatus;\n                  } else if (childMaritalStatus != member.maritalStatus) {\n                    childMaritalStatus = \"mixed\";\n                  }\n                } else {\n                  if (childMaritalStatus != \"none\") {\n                    childMaritalStatus = \"mixed\";\n                  }\n                }\n              }\n            }\n          } else if (relationship == \"son\" || relationship == \"daughter\") {\n            for (let member of gd.householdArray) {\n              if (member.isSelected) continue;\n              let thisMemberIsHead = false;\n              if ((member.relationship && member.relationship.includes(\"head\")) || member == headMember) {\n                thisMemberIsHead = true;\n              }\n\n              if (thisMemberIsHead) {\n                if (member.gender == \"male\") {\n                  hasFather = true;\n                } else if (member.gender == \"female\") {\n                  hasMother = true;\n                }\n              } else if (member.relationship == \"wife\") {\n                hasMother = true;\n              } else if (member.relationship == \"son\") {\n                if (!firstSiblingType) {\n                  firstSiblingType = \"brother\";\n                }\n                siblingCount++;\n              } else if (member.relationship == \"daughter\") {\n                if (!firstSiblingType) {\n                  firstSiblingType = \"sister\";\n                }\n                siblingCount++;\n              }\n            }\n          }\n\n          if (isHeadOrWife) {\n            if (hasWife) {\n              listParts.push(\"wife\");\n            }\n            if (hasHusband) {\n              listParts.push(\"husband\");\n            }\n          } else {\n            if (hasFather && hasMother) {\n              listParts.push(\"parents\");\n            } else if (hasFather) {\n              listParts.push(\"father\");\n            } else if (hasMother) {\n              listParts.push(\"mother\");\n            }\n          }\n          if (childCount) {\n            if (childMaritalStatus == \"single\") {\n              childMaritalStatus = \"unmarried\"; // \"with her unmarried son\" is clearer than \"with her single son\"\n            }\n            if (childCount == 1) {\n              let text = \"\";\n              if (childMaritalStatus != \"none\" && childMaritalStatus != \"mixed\") {\n                text += childMaritalStatus + \" \";\n              }\n              if (childType != \"none\" && childType != \"mixed\") {\n                text += childType;\n              } else {\n                text += \"child\";\n              }\n              listParts.push(text);\n            } else {\n              let text = \"\" + childCount;\n\n              if (childMaritalStatus != \"none\" && childMaritalStatus != \"mixed\") {\n                text += \" \" + childMaritalStatus;\n              }\n\n              if (childType != \"none\" && childType != \"mixed\") {\n                text += \" \" + childType + \"s\";\n              } else {\n                text += \" children\";\n              }\n              listParts.push(text);\n            }\n          }\n          if (siblingCount) {\n            if (siblingCount == 1) {\n              listParts.push(firstSiblingType);\n            } else {\n              listParts.push(siblingCount + \" \" + \"siblings\");\n            }\n          }\n          if (isHeadOrWife) {\n            if (hasFather && hasMother) {\n              listParts.push(\"parents\");\n            } else if (hasFather) {\n              listParts.push(\"father\");\n            } else if (hasMother) {\n              listParts.push(\"mother\");\n            }\n          }\n\n          let numParts = listParts.length;\n          if (numParts > 0) {\n            let pronoun = builder.getPossessivePronounInitialCaps().toLowerCase();\n            result += \" with \" + pronoun + \" \";\n            if (numParts == 1) {\n              result += listParts[0];\n            } else {\n              for (let partIndex = 0; partIndex < numParts; partIndex++) {\n                if (partIndex == numParts - 1) {\n                  result += \" and \";\n                } else if (partIndex > 0) {\n                  result += \", \";\n                }\n                result += listParts[partIndex];\n              }\n            }\n          } else if (relationship) {\n            // fall back to \"a visitor in the household of ...\"\n            if (options.narrative_census_wasPartFormat != \"was\") {\n              result += \" as\";\n            }\n\n            let headName = getHeadOfHouseholdNameIfNotSelected(gd.householdArray);\n\n            if (relationship.includes(\"head\")) {\n              result += \" the head of household\";\n            } else if (headName) {\n              result += \" a \" + relationship + \" in the household of \" + headName;\n            } else {\n              result += \" a \" + relationship;\n            }\n          }\n        }\n      }\n\n      return result;\n    }\n\n    function addHouseholdPartForMainSentence() {\n      if (options.narrative_census_includeHousehold == \"inMainSentence\") {\n        if (\n          options.narrative_census_wasPartFormat != \"was\" &&\n          options.narrative_census_householdPartFormat == \"relationship\"\n        ) {\n          builder.narrative += \" as\";\n        }\n\n        builder.narrative += getHouseholdPart();\n      }\n    }\n\n    function addHouseholdPartAsSeparateSentence() {\n      if (options.narrative_census_includeHousehold == \"inSeparateSentence\") {\n        builder.narrative += \" \" + builder.getPronounInitialCaps() + \" was\";\n        builder.narrative += getHouseholdPart();\n        builder.narrative += \".\";\n      }\n    }\n\n    let year = this.eventGd.inferEventYear();\n    let place = this.eventGd.inferFullEventPlace();\n\n    if (!place) {\n      place = this.eventGd.registrationDistrict;\n    }\n\n    if (!year || !place) {\n      this.narrative = \"\";\n      return; // do default generate\n    }\n\n    this.narrative = getCensusDatePart(year);\n    if (options.narrative_census_sentenceStructure == \"comma\") {\n      this.narrative += \",\";\n    }\n    this.narrative += \" \";\n\n    this.narrative += this.getPersonNameOrPronoun(true);\n\n    let ageNum = undefined;\n    let ageAtEvent = \"\";\n    if (year == \"1939\" && this.eventGd.birthDate && this.eventGd.birthDate.dateString) {\n      // 1939 register was taken on 29 September 1939 (could store this in collections)\n      ageNum = _generalize_data_utils_mjs__WEBPACK_IMPORTED_MODULE_1__.GeneralizedData.getAgeAtDate(this.eventGd.birthDate.dateString, \"9 September 1939\");\n      if (ageNum != undefined && ageNum != NaN) {\n        ageAtEvent = ageNum.toString();\n      }\n    } else {\n      ageAtEvent = this.getNarrativeAgeString(this.eventGd.ageAtEvent);\n      if (ageAtEvent) {\n        if (/^\\d+$/.test(ageAtEvent)) {\n          ageNum = parseInt(ageAtEvent);\n        } else {\n          ageNum = 0; // could be \"1/12\" for example or \"1 month\"\n        }\n      }\n    }\n\n    let occupation = this.getCleanOccupation();\n\n    let relationship = this.eventGd.relationshipToHead;\n    if (relationship) {\n      relationship = relationship.toLowerCase();\n    }\n\n    let maritalStatus = this.eventGd.maritalStatus;\n    if (maritalStatus == \"widow\") {\n      maritalStatus = \"widowed\";\n    } else if (maritalStatus == \"single\") {\n      maritalStatus = this.eventGd.getTermForUnmarried();\n\n      if (ageNum != undefined && ageNum != NaN && ageNum <= 14) {\n        // if less than marriageble age it seems odd to describe them as single\n        maritalStatus = \"\";\n      }\n    }\n\n    this.addAgeForMainSentence(ageAtEvent);\n    this.addOccupationForMainSentence(occupation);\n\n    this.narrative += \" was\";\n    if (options.narrative_census_wasPartFormat == \"wasEnumerated\") {\n      this.narrative += \" enumerated\";\n    } else if (options.narrative_census_wasPartFormat == \"wasRecorded\") {\n      this.narrative += \" recorded\";\n    }\n\n    addHouseholdPartForMainSentence();\n\n    this.narrative += \" \" + this.getPlaceWithPreposition(place) + \".\";\n\n    addHouseholdPartAsSeparateSentence();\n    this.addAgeAsSeparateSentence(ageAtEvent);\n    this.addOccupationAsSeparateSentence(occupation, relationship);\n  }\n\n  buildProbateString() {\n    let eventDateObj = this.eventGd.inferEventDateObj();\n    let deathDateObj = this.eventGd.inferDeathDateObj();\n    let eventPlace = this.eventGd.inferFullEventPlace();\n    let deathPlace = this.eventGd.inferDeathPlace();\n    let residencePlace = this.eventGd.inferResidencePlace();\n\n    let possessiveName = this.getPossessiveName();\n\n    if (deathDateObj && eventDateObj) {\n      let pronoun = this.getPossessivePronounInitialCaps().toLowerCase();\n      this.narrative += this.getPersonNameOrPronoun() + \" died \" + this.formatDateObj(deathDateObj, true);\n      if (deathPlace) {\n        this.narrative += \" \" + this.getPlaceWithPreposition(deathPlace);\n      } else if (residencePlace) {\n        this.narrative += \" residing \" + this.getPlaceWithPreposition(residencePlace);\n      }\n      this.narrative += \" and \" + pronoun + \" estate passed probate\";\n      if (eventDateObj) {\n        this.narrative += \" \" + this.formatDateObj(eventDateObj, true);\n      }\n      if (eventPlace) {\n        this.narrative += \" \" + this.getPlaceWithPreposition(eventPlace);\n      }\n    } else if (deathDateObj) {\n      this.narrative += this.getPersonNameOrPronoun() + \" died\";\n      if (deathDateObj) {\n        this.narrative += \" \" + this.formatDateObj(deathDateObj, true);\n      }\n      if (deathPlace) {\n        this.narrative += \" \" + this.getPlaceWithPreposition(deathPlace);\n      } else if (residencePlace) {\n        this.narrative += \" residing \" + this.getPlaceWithPreposition(residencePlace);\n      }\n    } else {\n      this.narrative += possessiveName + \" estate passed probate\";\n      if (eventDateObj) {\n        this.narrative += \" \" + this.formatDateObj(eventDateObj, true);\n      }\n      if (eventPlace) {\n        this.narrative += \" \" + this.getPlaceWithPreposition(eventPlace);\n      } else if (residencePlace) {\n        this.narrative += \". \" + this.getPossessivePronounInitialCaps() + \" last residence was \" + residencePlace;\n      }\n    }\n\n    this.narrative += \".\";\n  }\n\n  buildScottishWillString() {\n    let gd = this.eventGd;\n    let dateObj = gd.inferEventDateObj();\n    let place = gd.inferFullEventPlace();\n\n    let possessiveName = this.getPossessiveName();\n\n    let role = gd.role;\n\n    if (!gd.recordSubtype || gd.recordSubtype == \"Probate\") {\n      if (role && role != _record_type_mjs__WEBPACK_IMPORTED_MODULE_0__.Role.Primary) {\n        if (role == _record_type_mjs__WEBPACK_IMPORTED_MODULE_0__.Role.Child) {\n          this.narrative = possessiveName + \" parent's will passed probate\";\n        } else if (role == _record_type_mjs__WEBPACK_IMPORTED_MODULE_0__.Role.Parent) {\n          this.narrative = possessiveName + \" child's will passed probate\";\n        } else if (role == _record_type_mjs__WEBPACK_IMPORTED_MODULE_0__.Role.Spouse) {\n          this.narrative = possessiveName + \" spouse's will passed probate\";\n        } else if (role == _record_type_mjs__WEBPACK_IMPORTED_MODULE_0__.Role.Witness) {\n          this.narrative = this.getPersonNameOrPronoun() + \" witnessed a will that passed probate\";\n        }\n      } else {\n        if (gd.courtName && gd.courtName != \"non-Scottish Court\") {\n          this.narrative = \"Probate of \" + possessiveName + \" estate endorsed\";\n        } else {\n          this.narrative = \"Probate of \" + possessiveName + \" estate recorded\";\n        }\n      }\n    } else if (gd.recordSubtype == \"Testament\") {\n      if (gd.originalConfirmationGrantedDate) {\n        this.narrative = \"Confirmation was originally granted on \" + possessiveName + \" estate\";\n        this.narrative += \" \" + this.formatDate(gd.originalConfirmationGrantedDate, true);\n        this.narrative += \" and an additional confirmation was granted\";\n      } else {\n        this.narrative = \"Confirmation was granted on \" + possessiveName + \" estate\";\n      }\n    } else if (gd.recordSubtype == \"Inventory\" || gd.recordSubtype == \"AdditionalInventory\") {\n      this.narrative = \"Confirmation was granted on \" + possessiveName + \" estate\";\n      if (gd.originalConfirmationGrantedDate) {\n        this.narrative += \" \" + this.formatDate(gd.originalConfirmationGrantedDate, true);\n        this.narrative += \" and an additional inventory was granted\";\n      }\n    } else {\n      this.narrative = \"Confirmation was granted on \" + possessiveName + \" estate\";\n    }\n\n    if (dateObj) {\n      this.narrative += \" \" + this.formatDateObj(dateObj, true);\n    }\n\n    if (gd.recordSubtype == \"AdditionalInventory\") {\n      if (gd.grantedDate) {\n        this.narrative += \", additional inventory granted on \" + this.formatDate(gd.grantedDate, false);\n      } else if (gd.givenUpDate) {\n        this.narrative += \", additional inventory given up on \" + this.formatDate(gd.givenUpDate, false);\n      }\n    }\n\n    if (gd.courtName) {\n      if (gd.courtName.startsWith(\"non-Scot\")) {\n        this.narrative += \" at a non-Scottish court\";\n      } else {\n        this.narrative += \" at \" + gd.courtName;\n      }\n    } else if (place) {\n      this.narrative += \" \" + this.getPlaceWithPreposition(place);\n    }\n\n    this.narrative += \".\";\n  }\n\n  buildWillString() {\n    let gd = this.eventGd;\n    this.optionsSubcategory = \"will\";\n\n    if (gd.inferEventCountry() == \"Scotland\" || (gd.courtName && gd.courtName.startsWith(\"non-Scot\"))) {\n      this.buildScottishWillString();\n      return;\n    }\n\n    let dateObj = gd.inferEventDateObj();\n    let deathDateObj = gd.inferDeathDateObj();\n    let place = gd.inferFullEventPlace();\n    let residencePlace = gd.inferResidencePlace();\n\n    let possessiveName = this.getPossessiveName();\n\n    let role = gd.role;\n\n    if (deathDateObj) {\n      if (role && role != _record_type_mjs__WEBPACK_IMPORTED_MODULE_0__.Role.Primary) {\n        if (role == _record_type_mjs__WEBPACK_IMPORTED_MODULE_0__.Role.Child) {\n          this.narrative = possessiveName + \" parent died\";\n        } else if (role == _record_type_mjs__WEBPACK_IMPORTED_MODULE_0__.Role.Parent) {\n          this.narrative = possessiveName + \" child died\";\n        } else if (role == _record_type_mjs__WEBPACK_IMPORTED_MODULE_0__.Role.Spouse) {\n          this.narrative = possessiveName + \" spouse died\";\n        }\n      } else {\n        this.narrative += this.getPersonNameOrPronoun(true);\n        this.narrative += \" died\";\n      }\n\n      let hasProbateDate = false;\n      if (dateObj) {\n        if (dateObj.getDateString() != deathDateObj.getDateString()) {\n          // there is a probate date (probably)\n          hasProbateDate = true;\n        }\n      }\n\n      this.narrative += \" \" + this.formatDateObj(deathDateObj, true);\n\n      let deathPlace = gd.inferDeathPlace();\n\n      if (deathPlace) {\n        this.narrative += \" \" + this.getPlaceWithPreposition(deathPlace);\n      } else if (residencePlace) {\n        this.narrative += \" residing \" + this.getPlaceWithPreposition(residencePlace);\n      } else if (place && !hasProbateDate) {\n        this.narrative += \" \" + this.getPlaceWithPreposition(place);\n      }\n\n      if (hasProbateDate) {\n        this.narrative += \". \" + this.getPossessivePronounInitialCaps() + \" will passed probate\";\n\n        if (dateObj) {\n          this.narrative += \" \" + this.formatDateObj(dateObj, true);\n        }\n        if (place) {\n          this.narrative += \" \" + this.getPlaceWithPreposition(place);\n        }\n      }\n    } else {\n      if (role && role != _record_type_mjs__WEBPACK_IMPORTED_MODULE_0__.Role.Primary) {\n        if (role == _record_type_mjs__WEBPACK_IMPORTED_MODULE_0__.Role.Child) {\n          this.narrative = possessiveName + \" parent's will passed probate\";\n        } else if (role == _record_type_mjs__WEBPACK_IMPORTED_MODULE_0__.Role.Parent) {\n          this.narrative = possessiveName + \" child's will passed probate\";\n        } else if (role == _record_type_mjs__WEBPACK_IMPORTED_MODULE_0__.Role.Spouse) {\n          this.narrative = possessiveName + \" spouse's will passed probate\";\n        } else if (role == _record_type_mjs__WEBPACK_IMPORTED_MODULE_0__.Role.Witness) {\n          this.narrative = this.getPersonNameOrPronoun() + \" witnessed a will that passed probate\";\n        }\n      } else {\n        this.narrative = possessiveName + \" will passed probate\";\n      }\n\n      if (dateObj) {\n        this.narrative += \" \" + this.formatDateObj(dateObj, true);\n      }\n      if (place) {\n        this.narrative += \" \" + this.getPlaceWithPreposition(place);\n      }\n    }\n\n    this.narrative += \".\";\n  }\n\n  buildDivorceString() {\n    let dateObj = this.eventGd.inferEventDateObj();\n    let place = this.eventGd.inferFullEventPlace();\n\n    this.narrative = this.getPersonNameOrPronoun();\n\n    let spouseName = \"\";\n    if (this.eventGd.spouses && this.eventGd.spouses.length == 1) {\n      let spouse = this.eventGd.spouses[0];\n      if (spouse.name) {\n        spouseName = spouse.name.inferFullName();\n      }\n    }\n\n    if (spouseName) {\n      spouseName = _wts_string_mjs__WEBPACK_IMPORTED_MODULE_2__.WTS_String.toInitialCapsEachWord(spouseName, true);\n\n      this.narrative += \" was divorced from \" + spouseName;\n    } else {\n      this.narrative += \" was in a divorce record\";\n    }\n\n    if (dateObj) {\n      this.narrative += \" \" + this.formatDateObj(dateObj, true);\n    }\n    if (place) {\n      this.narrative += \" \" + this.getPlaceWithPreposition(place);\n    }\n    this.narrative += \".\";\n  }\n\n  buildMilitaryString() {\n    let eventDate = this.eventGd.inferEventDate();\n    let deathDate = this.eventGd.inferDeathDate();\n    let place = this.eventGd.inferFullEventPlace();\n    this.optionsSubcategory = \"military\";\n\n    this.narrative = this.getPersonNameOrPronoun();\n    if (deathDate) {\n      let branch = this.eventGd.militaryBranch;\n      if (!branch) {\n        if (this.eventGd.militaryRegiment) {\n          branch = this.eventGd.militaryRegiment;\n        } else {\n          branch = \"military\";\n        }\n      } else {\n        branch = branch.toLowerCase();\n      }\n      this.narrative += \" was in the \" + branch + \" and died\";\n      this.narrative += \" \" + this.formatDate(deathDate, true);\n\n      let deathPlace = this.eventGd.inferDeathPlace();\n      if (deathPlace) {\n        place = deathPlace;\n      }\n    } else {\n      this.narrative += \" was in a military record\";\n      if (eventDate) {\n        this.narrative += \" \" + this.formatDate(eventDate, true);\n      }\n    }\n\n    if (place) {\n      this.narrative += \" \" + this.getPlaceWithPreposition(place);\n    }\n    this.narrative += \".\";\n\n    let number = this.eventGd.serviceNumber;\n    let unit = this.eventGd.unit;\n    if (unit) {\n      this.narrative += \" \" + this.getPronounAndPastTenseInitialCaps() + \" in the \" + unit;\n      if (number) {\n        this.narrative += \" (service number \" + number + \")\";\n      }\n      this.narrative += \".\";\n    } else if (number) {\n      this.narrative += \" \" + this.getPossessivePronounInitialCaps() + \" service number was \" + number + \".\";\n    }\n  }\n\n  buildPassengerListString() {\n    this.optionsSubcategory = \"passengerList\";\n\n    let eventDate = this.eventGd.inferEventDate();\n    let eventPlace = this.eventGd.inferFullEventPlace();\n\n    let arrivalDate = this.eventGd.arrivalDate;\n    let arrivalPlace = this.eventGd.arrivalPlace;\n    let departureDate = this.eventGd.departureDate;\n    let departurePlace = this.eventGd.departurePlace;\n\n    let isArrival = false;\n    let isDeparture = false;\n    if (eventDate) {\n      if (arrivalDate && arrivalDate == eventDate) {\n        isArrival = true;\n      } else if (departureDate && departureDate == eventDate) {\n        isDeparture = true;\n      }\n    }\n\n    if (isArrival) {\n      this.narrative = this.getPersonNameOrPronoun() + \" arrived\";\n\n      if (this.eventGd.shipName) {\n        this.narrative += \" on the ship \" + this.eventGd.shipName;\n      }\n\n      if (arrivalDate) {\n        this.narrative += \" \" + this.formatDate(arrivalDate, true);\n      }\n\n      if (arrivalPlace) {\n        this.narrative += \" \" + this.getPlaceWithPreposition(arrivalPlace);\n      }\n\n      if (departurePlace) {\n        this.narrative += \" having departed from \" + departurePlace;\n        if (departureDate) {\n          this.narrative += \" \" + this.formatDate(departureDate, true);\n        }\n      }\n    } else if (isDeparture) {\n      this.narrative = this.getPersonNameOrPronoun() + \" departed\";\n\n      if (departurePlace) {\n        this.narrative += \" from \" + departurePlace;\n      }\n\n      if (this.eventGd.shipName) {\n        this.narrative += \" on the ship \" + this.eventGd.shipName;\n      }\n\n      if (departureDate) {\n        this.narrative += \" \" + this.formatDate(departureDate, true);\n      }\n    } else {\n      this.narrative = this.getPersonNameOrPronoun() + \" was a passenger\";\n\n      if (this.eventGd.shipName) {\n        this.narrative += \" on the ship \" + this.eventGd.shipName;\n      }\n\n      if (eventDate) {\n        this.narrative += \" \" + this.formatDate(eventDate, true);\n      }\n\n      if (eventPlace) {\n        this.narrative += \" \" + this.getPlaceWithPreposition(eventPlace);\n      }\n    }\n  }\n\n  buildDefaultString() {\n    const narratives = [\n      {\n        recordType: _record_type_mjs__WEBPACK_IMPORTED_MODULE_0__.RT.NonpopulationCensus,\n        string: \"was enumerated in a non-population schedule\",\n      },\n      { recordType: _record_type_mjs__WEBPACK_IMPORTED_MODULE_0__.RT.ElectoralRegister, string: \"was registered to vote\" },\n      { recordType: _record_type_mjs__WEBPACK_IMPORTED_MODULE_0__.RT.CriminalRegister, string: \"was in a criminal register\" },\n      { recordType: _record_type_mjs__WEBPACK_IMPORTED_MODULE_0__.RT.FreemasonMembership, string: \"was a freemason\" },\n      { recordType: _record_type_mjs__WEBPACK_IMPORTED_MODULE_0__.RT.Certificate, string: \"was issued a certificate\" },\n      { recordType: _record_type_mjs__WEBPACK_IMPORTED_MODULE_0__.RT.Directory, string: \"was in a directory\" },\n      { recordType: _record_type_mjs__WEBPACK_IMPORTED_MODULE_0__.RT.Employment, string: \"was employed\" },\n      { recordType: _record_type_mjs__WEBPACK_IMPORTED_MODULE_0__.RT.WorkhouseRecord, string: \"was in a workhouse record\" },\n      { recordType: _record_type_mjs__WEBPACK_IMPORTED_MODULE_0__.RT.CrewList, string: \"was in a crew\" },\n      { recordType: _record_type_mjs__WEBPACK_IMPORTED_MODULE_0__.RT.ConvictTransportation, string: \"was transported\" },\n      { recordType: _record_type_mjs__WEBPACK_IMPORTED_MODULE_0__.RT.MedicalPatient, string: \"was a patient\" },\n      { recordType: _record_type_mjs__WEBPACK_IMPORTED_MODULE_0__.RT.QuarterSession, string: \"was in quarter session\" },\n      { recordType: _record_type_mjs__WEBPACK_IMPORTED_MODULE_0__.RT.Tax, string: \"was in a tax record\" },\n      { recordType: _record_type_mjs__WEBPACK_IMPORTED_MODULE_0__.RT.ValuationRoll, string: \"was in a valuation roll\" },\n      { recordType: _record_type_mjs__WEBPACK_IMPORTED_MODULE_0__.RT.LandTax, string: \"was in a land tax record\" },\n      { recordType: _record_type_mjs__WEBPACK_IMPORTED_MODULE_0__.RT.Apprenticeship, string: \"was a master or apprentice\" },\n      {\n        recordType: _record_type_mjs__WEBPACK_IMPORTED_MODULE_0__.RT.SocialSecurity,\n        string: \"was in a Social Security record\",\n      },\n      { recordType: _record_type_mjs__WEBPACK_IMPORTED_MODULE_0__.RT.SchoolRecords, string: \"was at school\" },\n      { recordType: _record_type_mjs__WEBPACK_IMPORTED_MODULE_0__.RT.Residence, string: \"was recorded as a resident\" },\n      { recordType: _record_type_mjs__WEBPACK_IMPORTED_MODULE_0__.RT.Immigration, string: \"immigrated\" },\n      { recordType: _record_type_mjs__WEBPACK_IMPORTED_MODULE_0__.RT.Emigration, string: \"emigrated\" },\n      { recordType: _record_type_mjs__WEBPACK_IMPORTED_MODULE_0__.RT.Pension, string: \"was in a pension record\" },\n      { recordType: _record_type_mjs__WEBPACK_IMPORTED_MODULE_0__.RT.PassportApplication, string: \"applied for a passport\" },\n      { recordType: _record_type_mjs__WEBPACK_IMPORTED_MODULE_0__.RT.Newspaper, string: \"was in a newspaper\" },\n      { recordType: _record_type_mjs__WEBPACK_IMPORTED_MODULE_0__.RT.LegalRecord, string: \"was in a legal record\" },\n      { recordType: _record_type_mjs__WEBPACK_IMPORTED_MODULE_0__.RT.RateBook, string: \"was in a rate book\" },\n      {\n        recordType: _record_type_mjs__WEBPACK_IMPORTED_MODULE_0__.RT.FamHistOrPedigree,\n        string: \"was in a family history or pedigree\",\n      },\n      {\n        recordType: _record_type_mjs__WEBPACK_IMPORTED_MODULE_0__.RT.Naturalization,\n        string: \"was in a naturalization record\",\n      },\n      {\n        recordType: _record_type_mjs__WEBPACK_IMPORTED_MODULE_0__.RT.OtherChurchEvent,\n        string: \"was recorded in a church event\",\n      },\n      { recordType: _record_type_mjs__WEBPACK_IMPORTED_MODULE_0__.RT.Heraldry, string: \"was in a heraldic record\" },\n    ];\n\n    let gd = this.eventGd;\n\n    let narrativeCore = \"was in a record\";\n    for (let entry of narratives) {\n      if (entry.recordType == gd.recordType) {\n        narrativeCore = entry.string;\n        break;\n      }\n    }\n\n    let dateObj = gd.inferEventDateObj();\n    let place = gd.inferFullEventPlace();\n\n    if (gd.role && gd.role == _record_type_mjs__WEBPACK_IMPORTED_MODULE_0__.Role.Parent) {\n      this.narrative += this.getPossessiveNamePlusChild();\n    } else {\n      this.narrative += this.getPersonNameOrPronoun();\n    }\n\n    this.narrative += \" \" + narrativeCore;\n    if (dateObj) {\n      let formattedDate = this.formatDateObj(dateObj, true);\n      if (formattedDate) {\n        this.narrative += \" \" + formattedDate;\n      }\n    }\n\n    if (place) {\n      this.narrative += \" \" + this.getPlaceWithPreposition(place);\n    }\n\n    this.narrative += \".\";\n  }\n\n  buildNarrativeString() {\n    // The problem with using apostrophe after the name is that there are rules for when the name\n    // ends in s. If we are going to substitute the pref name on insertion then we do not know whether\n    // it ends in s. There could be a special code like {prefName} vs {prefNamePossessive}\n\n    this.narrative = \"\";\n\n    switch (this.eventGd.recordType) {\n      case _record_type_mjs__WEBPACK_IMPORTED_MODULE_0__.RT.BirthRegistration: {\n        this.buildBirthRegistrationString();\n        break;\n      }\n      case _record_type_mjs__WEBPACK_IMPORTED_MODULE_0__.RT.Birth: {\n        this.buildBirthString();\n        break;\n      }\n      case _record_type_mjs__WEBPACK_IMPORTED_MODULE_0__.RT.DeathRegistration: {\n        this.buildDeathRegistrationString();\n        break;\n      }\n      case _record_type_mjs__WEBPACK_IMPORTED_MODULE_0__.RT.Death: {\n        this.buildDeathString();\n        break;\n      }\n      case _record_type_mjs__WEBPACK_IMPORTED_MODULE_0__.RT.MarriageRegistration: {\n        this.buildMarriageRegistrationString();\n        break;\n      }\n      case _record_type_mjs__WEBPACK_IMPORTED_MODULE_0__.RT.Baptism: {\n        this.buildBaptismString();\n        break;\n      }\n      case _record_type_mjs__WEBPACK_IMPORTED_MODULE_0__.RT.Marriage: {\n        this.buildMarriageString();\n        break;\n      }\n      case _record_type_mjs__WEBPACK_IMPORTED_MODULE_0__.RT.Burial:\n      case _record_type_mjs__WEBPACK_IMPORTED_MODULE_0__.RT.DeathOrBurial: {\n        this.buildBurialString();\n        break;\n      }\n      case _record_type_mjs__WEBPACK_IMPORTED_MODULE_0__.RT.Cremation: {\n        this.buildCremationString();\n        break;\n      }\n      case _record_type_mjs__WEBPACK_IMPORTED_MODULE_0__.RT.Memorial: {\n        this.buildMemorialString();\n        break;\n      }\n      case _record_type_mjs__WEBPACK_IMPORTED_MODULE_0__.RT.Obituary: {\n        this.buildObituaryString();\n        break;\n      }\n      case _record_type_mjs__WEBPACK_IMPORTED_MODULE_0__.RT.BirthOrBaptism: {\n        this.buildBirthOrBaptismString();\n        break;\n      }\n      case _record_type_mjs__WEBPACK_IMPORTED_MODULE_0__.RT.Census: {\n        this.buildCensusString();\n        break;\n      }\n      case _record_type_mjs__WEBPACK_IMPORTED_MODULE_0__.RT.Probate: {\n        this.buildProbateString();\n        break;\n      }\n      case _record_type_mjs__WEBPACK_IMPORTED_MODULE_0__.RT.Will: {\n        this.buildWillString();\n        break;\n      }\n      case _record_type_mjs__WEBPACK_IMPORTED_MODULE_0__.RT.Divorce: {\n        this.buildDivorceString();\n        break;\n      }\n      case _record_type_mjs__WEBPACK_IMPORTED_MODULE_0__.RT.Military: {\n        this.buildMilitaryString();\n        break;\n      }\n      case _record_type_mjs__WEBPACK_IMPORTED_MODULE_0__.RT.PassengerList: {\n        this.buildPassengerListString();\n        break;\n      }\n    }\n\n    if (!this.narrative) {\n      this.buildDefaultString();\n    }\n  }\n}\n\nfunction buildNarrative(input) {\n  if (!input || !input.eventGeneralizedData) {\n    return \"\";\n  }\n\n  let eventGd = input.eventGeneralizedData;\n  let options = input.options;\n\n  //console.log(\"buildNarrative: eventGd is\");\n  //console.log(eventGd);\n\n  let eventGeneralizedData = _generalize_data_utils_mjs__WEBPACK_IMPORTED_MODULE_1__.GeneralizedData.createFromPlainObject(eventGd);\n  let wtGeneralizedData = _generalize_data_utils_mjs__WEBPACK_IMPORTED_MODULE_1__.GeneralizedData.createFromPlainObject(input.wtGeneralizedData);\n\n  let builder = new NarrativeBuilder(options);\n  builder.profileGd = wtGeneralizedData;\n  builder.eventGd = eventGeneralizedData;\n\n  if (wtGeneralizedData && wtGeneralizedData.personGender) {\n    builder.personGender = wtGeneralizedData.personGender;\n  } else if (eventGeneralizedData.personGender) {\n    builder.personGender = eventGeneralizedData.personGender;\n  }\n\n  builder.buildNarrativeString();\n\n  return builder.narrative;\n}\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9leHRlbnNpb24vYmFzZS9jb3JlL25hcnJhdGl2ZV9idWlsZGVyLm1qcy5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQUFBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFc0Q7QUFDaUI7QUFDOUI7QUFDSztBQUNKO0FBQzhFO0FBQzFFOztBQUU5QztBQUNBO0FBQ0E7O0FBRUEsc0JBQXNCLDZEQUFlOztBQUVyQztBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUJBQW1CLHNFQUFpQjtBQUNwQztBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVU7QUFDVjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNEJBQTRCLGlDQUFpQztBQUM3RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7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QTs7QUFFQTtBQUNBO0FBQ0Esc0JBQXNCLCtEQUFPO0FBQzdCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVO0FBQ1Y7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVO0FBQ1Y7QUFDQSxVQUFVO0FBQ1Y7QUFDQSxVQUFVO0FBQ1Y7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVO0FBQ1Y7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0EsVUFBVTtBQUNWO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVTtBQUNWO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVU7QUFDVjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0EsdUJBQXVCLDZFQUFnQztBQUN2RDs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVO0FBQ1Y7QUFDQTtBQUNB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QTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsOEJBQThCLHlEQUFXO0FBQ3pDO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQ0FBcUM7QUFDckM7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVTtBQUNWO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVU7QUFDVjtBQUNBO0FBQ0E7QUFDQSxZQUFZO0FBQ1o7QUFDQTtBQUNBO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7QUFDQTtBQUNBLFVBQVU7QUFDVjtBQUNBO0FBQ0EsUUFBUTtBQUNSO0FB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O0FBQ3RCO0FBQ0E7QUFDQTtBQUNBLFdBQVcsK0RBQWlCO0FBQzVCO0FBQ0E7QUFDQTtBQUNBLFdBQVcsdURBQVM7QUFDcEI7QUFDQTtBQUNBO0FBQ0EsV0FBVyx3REFBVTtBQUNyQjtBQUNBO0FBQ0E7QUFDQSxXQUFXLHFEQUFPO0FBQ2xCO0FBQ0E7QUFDQTtBQUNBLFdBQVcsd0RBQVU7QUFDckI7QUFDQTtBQUNBO0FBQ0EsV0FBVyx5REFBVztBQUN0QjtBQUNBO0FBQ0E7QUFDQSxXQUFXLDhEQUFnQjtBQUMzQjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQSw2QkFBNkIsNkZBQXFDO0FBQ2xFLDBCQUEwQiw2RkFBcUM7O0FBRS9EO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFNEMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9DaXRhdGlvbkV4dHJhY3Rvci8uL2V4dGVuc2lvbi9iYXNlL2NvcmUvbmFycmF0aXZlX2J1aWxkZXIubWpzPzdhMTciXSwic291cmNlc0NvbnRlbnQiOlsiLypcbk1JVCBMaWNlbnNlXG5cbkNvcHlyaWdodCAoYykgMjAyMCBSb2JlcnQgTSBQYXZleVxuXG5QZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYSBjb3B5XG5vZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSBcIlNvZnR3YXJlXCIpLCB0byBkZWFsXG5pbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzXG50byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsXG5jb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXNcbmZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6XG5cblRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkIGluIGFsbFxuY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS5cblxuVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEIFwiQVMgSVNcIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUlxuSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksXG5GSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEVcbkFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVJcbkxJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sXG5PVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOIFRIRVxuU09GVFdBUkUuXG4qL1xuXG5pbXBvcnQgeyBSVCwgUmVjb3JkU3VidHlwZSB9IGZyb20gXCIuL3JlY29yZF90eXBlLm1qc1wiO1xuaW1wb3J0IHsgR2VuZXJhbGl6ZWREYXRhLCBXdHNEYXRlIH0gZnJvbSBcIi4vZ2VuZXJhbGl6ZV9kYXRhX3V0aWxzLm1qc1wiO1xuaW1wb3J0IHsgUm9sZSB9IGZyb20gXCIuL3JlY29yZF90eXBlLm1qc1wiO1xuaW1wb3J0IHsgV1RTX1N0cmluZyB9IGZyb20gXCIuL3d0c19zdHJpbmcubWpzXCI7XG5pbXBvcnQgeyBXVFNfRGF0ZSB9IGZyb20gXCIuL3d0c19kYXRlLm1qc1wiO1xuaW1wb3J0IHsgZ2V0Q2hpbGRUZXJtLCBnZXRQcmltYXJ5UGVyc29uQ2hpbGRUZXJtLCBnZXRQcmltYXJ5UGVyc29uU3BvdXNlVGVybSB9IGZyb20gXCIuL25hcnJhdGl2ZV9vcl9zZW50ZW5jZV91dGlscy5tanNcIjtcbmltcG9ydCB7IFJDIH0gZnJvbSBcIi4vcmVjb3JkX2NvbGxlY3Rpb25zLm1qc1wiO1xuXG5jbGFzcyBOYXJyYXRpdmVCdWlsZGVyIHtcbiAgY29uc3RydWN0b3Iob3B0aW9ucykge1xuICAgIHRoaXMub3B0aW9ucyA9IG9wdGlvbnM7XG5cbiAgICB0aGlzLnJlY29yZFR5cGUgPSBSVC5VbmNsYXNzaWZpZWQ7XG5cbiAgICB0aGlzLmV2ZW50RGF0ZSA9IFwiXCI7XG4gICAgdGhpcy5ldmVudFBsYWNlID0gXCJcIjtcbiAgfVxuXG4gIGdldE9wdGlvbnMoKSB7XG4gICAgcmV0dXJuIHRoaXMub3B0aW9ucztcbiAgfVxuXG4gIGdldFN1YmNhdE9wdGlvbihsZWFmT3B0aW9uTmFtZSwgc3Vic2VjdGlvbk92ZXJyaWRlKSB7XG4gICAgbGV0IHZhbHVlID0gdW5kZWZpbmVkO1xuICAgIGlmICh0aGlzLm9wdGlvbnNTdWJjYXRlZ29yeSkge1xuICAgICAgbGV0IHN1YnNlY3Rpb24gPSBzdWJzZWN0aW9uT3ZlcnJpZGU7XG4gICAgICBpZiAoIXN1YnNlY3Rpb24pIHtcbiAgICAgICAgc3Vic2VjdGlvbiA9IHRoaXMub3B0aW9uc1N1YnNlY3Rpb247XG4gICAgICB9XG4gICAgICBpZiAoc3Vic2VjdGlvbikge1xuICAgICAgICB2YWx1ZSA9IHRoaXMub3B0aW9uc1tcIm5hcnJhdGl2ZV9cIiArIHRoaXMub3B0aW9uc1N1YmNhdGVnb3J5ICsgc3Vic2VjdGlvbiArIFwiX1wiICsgbGVhZk9wdGlvbk5hbWVdO1xuICAgICAgfVxuICAgICAgaWYgKHZhbHVlID09IHVuZGVmaW5lZCkge1xuICAgICAgICB2YWx1ZSA9IHRoaXMub3B0aW9uc1tcIm5hcnJhdGl2ZV9cIiArIHRoaXMub3B0aW9uc1N1YmNhdGVnb3J5ICsgXCJfXCIgKyBsZWFmT3B0aW9uTmFtZV07XG4gICAgICB9XG4gICAgfVxuICAgIGlmICh2YWx1ZSA9PSB1bmRlZmluZWQgfHwgdmFsdWUgPT0gXCJkZWZhdWx0XCIpIHtcbiAgICAgIHZhbHVlID0gdGhpcy5vcHRpb25zW1wibmFycmF0aXZlX2dlbmVyYWxfXCIgKyBsZWFmT3B0aW9uTmFtZV07XG4gICAgfVxuICAgIHJldHVybiB2YWx1ZTtcbiAgfVxuXG4gIGdldENvbGxlY3Rpb24oKSB7XG4gICAgbGV0IGdkID0gdGhpcy5ldmVudEdkO1xuICAgIGxldCBjb2xsZWN0aW9uID0gdW5kZWZpbmVkO1xuICAgIGlmIChnZC5jb2xsZWN0aW9uRGF0YSAmJiBnZC5jb2xsZWN0aW9uRGF0YS5pZCkge1xuICAgICAgY29sbGVjdGlvbiA9IFJDLmZpbmRDb2xsZWN0aW9uKGdkLnNvdXJjZU9mRGF0YSwgZ2QuY29sbGVjdGlvbkRhdGEuaWQpO1xuICAgIH1cbiAgICByZXR1cm4gY29sbGVjdGlvbjtcbiAgfVxuXG4gIGdldE5hcnJhdGl2ZUFnZVN0cmluZyhhZ2VTdHJpbmcpIHtcbiAgICBsZXQgcmVzdWx0ID0gXCJcIjtcbiAgICBpZiAoYWdlU3RyaW5nKSB7XG4gICAgICByZXN1bHQgPSBhZ2VTdHJpbmcucmVwbGFjZSgveWVhcnM/L2ksIFwiXCIpLnRyaW0oKTtcbiAgICAgIGlmICgvXlxcZCtcXC8xMiQvLnRlc3QocmVzdWx0KSkge1xuICAgICAgICByZXN1bHQgPSByZXN1bHQucmVwbGFjZSgvXFwvMTIvLCBcIlwiKS50cmltKCk7XG4gICAgICAgIGlmIChyZXN1bHQgPT0gXCIxXCIpIHtcbiAgICAgICAgICByZXN1bHQgKz0gXCIgbW9udGhcIjtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXN1bHQgKz0gXCIgbW9udGhzXCI7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIGltcHJvdmVBbmRBYmJyZXZpYXRlUGxhY2VTdHJpbmcocGxhY2VTdHJpbmcpIHtcbiAgICBsZXQgZ2QgPSB0aGlzLmV2ZW50R2Q7XG4gICAgbGV0IG9wdGlvbnMgPSB0aGlzLm9wdGlvbnM7XG5cbiAgICBjb25zdCBjb3VudHJ5U3RyaW5ncyA9IFtcbiAgICAgIFtcIiwgRW5nbGFuZFwiLCBcIiwgRW5nbGFuZCwgVW5pdGVkIEtpbmdkb21cIl0sXG4gICAgICBbXCIsIFdhbGVzXCIsIFwiLCBXYWxlcywgVW5pdGVkIEtpbmdkb21cIl0sXG4gICAgICBbXCIsIFNjb3RsYW5kXCIsIFwiLCBTY290bGFuZCwgVW5pdGVkIEtpbmdkb21cIl0sXG4gICAgICBbXG4gICAgICAgIFwiLCBKZXJzZXlcIixcbiAgICAgICAgXCIsIEplcnNleSwgVW5pdGVkIEtpbmdkb21cIixcbiAgICAgICAgXCIsIEplcnNleSwgQ2hhbm5lbCBJc2xhbmRzXCIsXG4gICAgICAgIFwiLCBKZXJzZXksIENoYW5uZWwgSXNsYW5kcywgVW5pdGVkIEtpbmdkb21cIixcbiAgICAgIF0sXG4gICAgICBbXG4gICAgICAgIFwiLCBHdWVybnNleVwiLFxuICAgICAgICBcIiwgR3Vlcm5zZXksIFVuaXRlZCBLaW5nZG9tXCIsXG4gICAgICAgIFwiLCBHdWVybnNleSwgQ2hhbm5lbCBJc2xhbmRzXCIsXG4gICAgICAgIFwiLCBHdWVybnNleSwgQ2hhbm5lbCBJc2xhbmRzLCBVbml0ZWQgS2luZ2RvbVwiLFxuICAgICAgXSxcbiAgICAgIFtcIiwgVW5pdGVkIEtpbmdkb21cIiwgXCJVS1wiXSwgLy8gbXVzdCBjb21lIGFmdGVyIHRoZSBhYm92ZSBjb3VudGlyZXMgdGhhdCBtYWtlIHVwIHRoZSBVS1xuICAgICAgW1wiLCBJcmVsYW5kXCJdLFxuICAgICAgW1wiLCBVbml0ZWQgU3RhdGVzXCIsIFwiLCBVbml0ZWQgU3RhdGVzIG9mIEFtZXJpY2FcIiwgXCIsIFVTQVwiXSxcbiAgICAgIFtcIiwgQ2FuYWRhXCJdLFxuICAgICAgW1wiLCBOZXcgWmVhbGFuZFwiXSxcbiAgICAgIFtcIiwgQXVzdHJhbGlhXCJdLFxuICAgICAgW1wiLCBGcmFuY2VcIl0sXG4gICAgICBbXCIsIEdlcm1hbnlcIl0sXG4gICAgICBbXCIsIEF1c3RyaWFcIl0sXG4gICAgICBbXCIsIEl0YWx5XCJdLFxuICAgICAgW1wiLCBTcGFpblwiXSxcbiAgICAgIFtcIiwgU3dpdHplcmxhbmRcIl0sXG4gICAgICBbXCIsIE5ldGhlcmxhbmRzXCJdLFxuICAgICAgW1wiLCBTd2VkZW5cIl0sXG4gICAgICBbXCIsIE5vcndheVwiXSxcbiAgICAgIFtcIiwgRGVubWFya1wiXSxcbiAgICAgIFtcIiwgQ3plY2ggUmVwdWJsaWNcIl0sXG4gICAgICBbXCIsIEh1bmdhcnlcIl0sXG4gICAgICBbXCIsIE1leGljb1wiXSxcbiAgICAgIFtcIiwgUGVydVwiXSxcbiAgICAgIFtcIiwgQ2hpbmFcIl0sXG4gICAgICBbXCIsIEphcGFuXCJdLFxuICAgICAgW1wiLCBUaGFpbGFuZFwiXSxcbiAgICAgIFtcIiwgVmlldG5hbVwiXSxcbiAgICAgIFtcIiwgVGFpd2FuXCJdLFxuICAgICAgW1wiLCBGcmVuY2ggUG9seW5lc2lhXCJdLFxuICAgICAgW1wiLCBTb3V0aCBBZnJpY2FcIl0sXG4gICAgICBbXCIsIFppbWJhYndlXCJdLFxuICAgIF07XG5cbiAgICAvLyByZW1vdmUgdHJhaWxpbmcgLiBvciBzcGFjZXNcbiAgICB3aGlsZSAocGxhY2VTdHJpbmdbcGxhY2VTdHJpbmcubGVuZ3RoIC0gMV0gPT0gXCIuXCIgfHwgcGxhY2VTdHJpbmdbcGxhY2VTdHJpbmcubGVuZ3RoIC0gMV0gPT0gXCIgXCIpIHtcbiAgICAgIGlmIChwbGFjZVN0cmluZy5sZW5ndGggPiAxKSB7XG4gICAgICAgIHBsYWNlU3RyaW5nID0gcGxhY2VTdHJpbmcuc3Vic3RyaW5nKDAsIHBsYWNlU3RyaW5nLmxlbmd0aCAtIDEpO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIGlmIHRoZXJlIGlzIGEgd29yZCBjaGFyYWN0ZXIgaW1tZWRpYXRlbHkgYWZ0ZXIgYSBjb21tYSB0aGVuIGFkZCBhIHNwYWNlXG4gICAgcGxhY2VTdHJpbmcgPSBwbGFjZVN0cmluZy5yZXBsYWNlKC8sKFxcdykvZywgXCIsICQxXCIpO1xuXG4gICAgLy8gb3B0aW9uYWxseSByZW1vdmUsIGFiYnJldmlhdGUgb3Igc3RhbmRhcmRpemUgY291bnRyeVxuICAgIGlmIChvcHRpb25zLm5hcnJhdGl2ZV9nZW5lcmFsX2NvdW50cnkgIT0gXCJmdWxsXCIpIHtcbiAgICAgIHZhciBjb3VudHJ5SW5kZXggPSAtMTtcbiAgICAgIHZhciBjb3VudHJ5U3RyaW5nID0gbnVsbDtcbiAgICAgIHZhciBzdGRDb3VudHJ5U3RyaW5nID0gbnVsbDtcbiAgICAgIGZvciAodmFyIGNvdW50cnkgPSAwOyBjb3VudHJ5IDwgY291bnRyeVN0cmluZ3MubGVuZ3RoOyBjb3VudHJ5KyspIHtcbiAgICAgICAgbGV0IGZpcnN0VmFyaWFudCA9IHRydWU7XG4gICAgICAgIGxldCBmaXJzdFZhcmlhbnROYW1lID0gbnVsbDtcbiAgICAgICAgZm9yICh2YXIgdmFyaWFudCBvZiBjb3VudHJ5U3RyaW5nc1tjb3VudHJ5XSkge1xuICAgICAgICAgIGlmIChmaXJzdFZhcmlhbnQpIHtcbiAgICAgICAgICAgIGZpcnN0VmFyaWFudCA9IGZhbHNlO1xuICAgICAgICAgICAgZmlyc3RWYXJpYW50TmFtZSA9IHZhcmlhbnQ7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgaWYgKHBsYWNlU3RyaW5nLmVuZHNXaXRoKHZhcmlhbnQpKSB7XG4gICAgICAgICAgICBjb3VudHJ5SW5kZXggPSBjb3VudHJ5O1xuICAgICAgICAgICAgY291bnRyeVN0cmluZyA9IHZhcmlhbnQ7XG4gICAgICAgICAgICBpZiAoZmlyc3RWYXJpYW50TmFtZSAmJiBmaXJzdFZhcmlhbnROYW1lICE9IHZhcmlhbnQpIHtcbiAgICAgICAgICAgICAgc3RkQ291bnRyeVN0cmluZyA9IGZpcnN0VmFyaWFudE5hbWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNvdW50cnlJbmRleCAhPSAtMSkge1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBpZiAoY291bnRyeUluZGV4ICE9IC0xKSB7XG4gICAgICAgIC8vIHdlIGZvdW5kIGEgY291bnRyeSwgZGVjaWRlIHdoZXRoZXIgdG8gcmVtb3ZlIGl0XG4gICAgICAgIHZhciByZW1vdmVDb3VudHJ5ID0gZmFsc2U7XG5cbiAgICAgICAgaWYgKG9wdGlvbnMubmFycmF0aXZlX2dlbmVyYWxfY291bnRyeSA9PSBcIm5vbmVcIikge1xuICAgICAgICAgIHJlbW92ZUNvdW50cnkgPSB0cnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHJlbW92ZUNvdW50cnkpIHtcbiAgICAgICAgICBwbGFjZVN0cmluZyA9IHBsYWNlU3RyaW5nLnN1YnN0cmluZygwLCBwbGFjZVN0cmluZy5sZW5ndGggLSBjb3VudHJ5U3RyaW5nLmxlbmd0aCk7XG4gICAgICAgIH0gZWxzZSBpZiAob3B0aW9ucy5uYXJyYXRpdmVfZ2VuZXJhbF9jb3VudHJ5ID09IFwic3RhbmRhcmRcIiAmJiBzdGRDb3VudHJ5U3RyaW5nKSB7XG4gICAgICAgICAgcGxhY2VTdHJpbmcgPSBwbGFjZVN0cmluZy5zdWJzdHJpbmcoMCwgcGxhY2VTdHJpbmcubGVuZ3RoIC0gY291bnRyeVN0cmluZy5sZW5ndGgpO1xuICAgICAgICAgIHBsYWNlU3RyaW5nICs9IHN0ZENvdW50cnlTdHJpbmc7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAob3B0aW9ucy5uYXJyYXRpdmVfZ2VuZXJhbF9wbGFjZUNodXJjaEZpcnN0ID09IFwieWVzXCIpIHtcbiAgICAgIGNvbnN0IHJlY29yZFR5cGVzV2l0aENodXJjaE5hbWVzID0gW1JULkJhcHRpc20sIFJULk1hcnJpYWdlLCBSVC5CdXJpYWxdO1xuICAgICAgY29uc3Qgc2l0ZU5hbWVzV2hlcmVDaHVyY2hDYW5CZUFmdGVyVG93biA9IFtcImFuY2VzdHJ5XCJdO1xuXG4gICAgICBpZiAoXG4gICAgICAgIHJlY29yZFR5cGVzV2l0aENodXJjaE5hbWVzLmluY2x1ZGVzKGdkLnJlY29yZFR5cGUpICYmXG4gICAgICAgIHNpdGVOYW1lc1doZXJlQ2h1cmNoQ2FuQmVBZnRlclRvd24uaW5jbHVkZXMoZ2Quc291cmNlT2ZEYXRhKVxuICAgICAgKSB7XG4gICAgICAgIC8vIGF0dGVtcHQgdG8gY2hhbmdlIFwiSHVkZGVyc2ZpZWxkLCBTdCBQZXRlcixcIiB0byBcIlN0LiBQZXRlcidzIGNodXJjaCwgSHVkZGVyc2ZpZWxkLFwiXG4gICAgICAgIGxldCBmaXJzdENvbW1hSW5kZXggPSBwbGFjZVN0cmluZy5pbmRleE9mKFwiLFwiKTtcbiAgICAgICAgaWYgKGZpcnN0Q29tbWFJbmRleCAhPSAtMSAmJiBwbGFjZVN0cmluZy5sZW5ndGggPiBmaXJzdENvbW1hSW5kZXggKyAyKSB7XG4gICAgICAgICAgbGV0IHNlY29uZENvbW1hSW5kZXggPSBwbGFjZVN0cmluZy5pbmRleE9mKFwiLFwiLCBmaXJzdENvbW1hSW5kZXggKyAxKTtcbiAgICAgICAgICBpZiAoc2Vjb25kQ29tbWFJbmRleCAhPSAtMSkge1xuICAgICAgICAgICAgbGV0IGNodXJjaE5hbWUgPSBwbGFjZVN0cmluZy5zdWJzdHJpbmcoZmlyc3RDb21tYUluZGV4ICsgMSwgc2Vjb25kQ29tbWFJbmRleCkudHJpbSgpO1xuICAgICAgICAgICAgbGV0IHBsYWNlTm9DaHVyY2ggPVxuICAgICAgICAgICAgICBwbGFjZVN0cmluZy5zdWJzdHJpbmcoMCwgZmlyc3RDb21tYUluZGV4KSArIFwiLCBcIiArIHBsYWNlU3RyaW5nLnN1YnN0cmluZyhzZWNvbmRDb21tYUluZGV4ICsgMSkudHJpbSgpO1xuXG4gICAgICAgICAgICBpZiAoL15TdFsgXFwuXSsvLnRlc3QoY2h1cmNoTmFtZSkgfHwgL15BbGwgU2FpbnRzL2kudGVzdChjaHVyY2hOYW1lKSkge1xuICAgICAgICAgICAgICBpZiAoY2h1cmNoTmFtZS5lbmRzV2l0aChcInNcIikpIHtcbiAgICAgICAgICAgICAgICBjaHVyY2hOYW1lICs9IFwiJ1wiO1xuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNodXJjaE5hbWUgKz0gXCInc1wiO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGNodXJjaE5hbWUgKz0gXCIgY2h1cmNoXCI7XG4gICAgICAgICAgICAgIHBsYWNlU3RyaW5nID0gY2h1cmNoTmFtZSArIFwiLCBcIiArIHBsYWNlTm9DaHVyY2g7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHBsYWNlU3RyaW5nO1xuICB9XG5cbiAgZ2V0UGxhY2VXaXRoUHJlcG9zaXRpb24ocGxhY2VTdHJpbmcpIHtcbiAgICBpZiAoIXBsYWNlU3RyaW5nKSB7XG4gICAgICByZXR1cm4gcGxhY2VTdHJpbmc7XG4gICAgfVxuXG4gICAgcGxhY2VTdHJpbmcgPSB0aGlzLmltcHJvdmVBbmRBYmJyZXZpYXRlUGxhY2VTdHJpbmcocGxhY2VTdHJpbmcpO1xuICAgIGxldCBwcmVwb3NpdGlvbiA9IFdUU19TdHJpbmcuZ2V0UHJlcG9zaXRpb25Gb3JQbGFjZVN0cmluZyhwbGFjZVN0cmluZyk7XG4gICAgcmV0dXJuIHByZXBvc2l0aW9uICsgXCIgXCIgKyBwbGFjZVN0cmluZztcbiAgfVxuXG4gIGdldE5hbWVPclByb25vdW5PcHRpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0U3ViY2F0T3B0aW9uKFwibmFtZU9yUHJvbm91blwiKTtcbiAgfVxuXG4gIGdldFBlcnNvbk5hbWVPclByb25vdW5XaXRoRmxhZyhpc01pZFNlbnRlbmNlID0gZmFsc2UpIHtcbiAgICBsZXQgZ2QgPSB0aGlzLmV2ZW50R2Q7XG5cbiAgICBsZXQgbmFtZU9wdGlvbiA9IHRoaXMuZ2V0TmFtZU9yUHJvbm91bk9wdGlvbigpO1xuICAgIGxldCByZXN1bHQgPSB7IGlzVmFsaWQ6IGZhbHNlIH07XG4gICAgcmVzdWx0LmlzUHJvbm91biA9IGZhbHNlO1xuXG4gICAgZnVuY3Rpb24gdHJ5Rmlyc3ROYW1lKCkge1xuICAgICAgbGV0IG5hbWUgPSBnZC5pbmZlckZpcnN0TmFtZSgpO1xuICAgICAgaWYgKG5hbWUpIHtcbiAgICAgICAgcmVzdWx0Lm5hbWVPclByb25vdW4gPSBuYW1lO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiB0cnlGb3JlbmFtZXMoKSB7XG4gICAgICBsZXQgbmFtZSA9IGdkLmluZmVyRm9yZW5hbWVzKCk7XG4gICAgICBpZiAobmFtZSkge1xuICAgICAgICByZXN1bHQubmFtZU9yUHJvbm91biA9IG5hbWU7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHRyeUZ1bGxOYW1lKCkge1xuICAgICAgbGV0IG5hbWUgPSBnZC5pbmZlckZ1bGxOYW1lKCk7XG4gICAgICBpZiAobmFtZSkge1xuICAgICAgICByZXN1bHQubmFtZU9yUHJvbm91biA9IG5hbWU7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHRyeVByb25vdW4oKSB7XG4gICAgICBsZXQgZ2VuZGVyID0gZ2QucGVyc29uR2VuZGVyO1xuICAgICAgaWYgKGdlbmRlciA9PSBcIm1hbGVcIikge1xuICAgICAgICByZXN1bHQubmFtZU9yUHJvbm91biA9IFwiSGVcIjtcbiAgICAgICAgcmVzdWx0LmlzUHJvbm91biA9IHRydWU7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfSBlbHNlIGlmIChnZW5kZXIgPT0gXCJmZW1hbGVcIikge1xuICAgICAgICByZXN1bHQubmFtZU9yUHJvbm91biA9IFwiU2hlXCI7XG4gICAgICAgIHJlc3VsdC5pc1Byb25vdW4gPSB0cnVlO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBpZiAobmFtZU9wdGlvbiA9PSBcImZpcnN0TmFtZVwiKSB7XG4gICAgICBpZiAoIXRyeUZpcnN0TmFtZSgpKSB7XG4gICAgICAgIGlmICghdHJ5RnVsbE5hbWUoKSkge1xuICAgICAgICAgIHRyeVByb25vdW4oKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0gZWxzZSBpZiAobmFtZU9wdGlvbiA9PSBcImZvcmVuYW1lc1wiKSB7XG4gICAgICBpZiAoIXRyeUZvcmVuYW1lcygpKSB7XG4gICAgICAgIGlmICghdHJ5RnVsbE5hbWUoKSkge1xuICAgICAgICAgIHRyeVByb25vdW4oKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0gZWxzZSBpZiAobmFtZU9wdGlvbiA9PSBcImZ1bGxOYW1lXCIpIHtcbiAgICAgIGlmICghdHJ5RnVsbE5hbWUoKSkge1xuICAgICAgICB0cnlQcm9ub3VuKCk7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmIChuYW1lT3B0aW9uID09IFwicHJvbm91blwiKSB7XG4gICAgICBpZiAoIXRyeVByb25vdW4oKSkge1xuICAgICAgICBpZiAoIXRyeUZpcnN0TmFtZSgpKSB7XG4gICAgICAgICAgdHJ5RnVsbE5hbWUoKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIGlmICghcmVzdWx0Lm5hbWVPclByb25vdW4pIHtcbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxuXG4gICAgaWYgKHJlc3VsdC5pc1Byb25vdW4pIHtcbiAgICAgIGlmIChpc01pZFNlbnRlbmNlKSB7XG4gICAgICAgIHJlc3VsdC5uYW1lT3JQcm9ub3VuID0gcmVzdWx0Lm5hbWVPclByb25vdW4udG9Mb3dlckNhc2UoKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgLy8gSW4gbmFycmF0aXZlIHdlIGFsd2F5cyB3YW50IG5hbWVzIGluIGluaXRpYWwgY2FwcyAobm90ZSBtaWdodCBuZWVkIHNwZWNpYWwgY2FzZVxuICAgICAgLy8gZm9yIG1peGVkIGNhc2VkIG5hbWVzIGxpa2UgTWNMZW9kIG9yIE1hY0xlb2QsIHRoZSBwcmVmbmFtZSBjYW4gYmUgYSBzdXJuYW1lIGlmIG5vIGtub3duIGZpcnN0IG5hbWUpXG4gICAgICAvLyBIb3dldmVyLCBzb21ldGltZXMgdGhlIGdlbmVyYWxpemUgaGFzIGFscmVhZHkgZG9uZSBhIGJldHRlciBqb2Igb2YgdGhpcyBzbyBpdCBzaG91bGQgbm90IGJlIGRvbmUgYWdhaW5cbiAgICAgIC8vIE5PVEU6IHdlIGNvdWxkIHBlcmhhcHMgY2VudHJhbGlzZSB0aGUgY29kZSBpbiBzY290cCB0aGF0IGRvZXMgbmFtZSBjYXNpbmcuXG4gICAgICBpZiAoZ2Quc291cmNlT2ZEYXRhICE9IFwic2NvdHBcIikge1xuICAgICAgICByZXN1bHQubmFtZU9yUHJvbm91biA9IFdUU19TdHJpbmcudG9Jbml0aWFsQ2Fwc0VhY2hXb3JkKHJlc3VsdC5uYW1lT3JQcm9ub3VuLCB0cnVlKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXN1bHQuaXNWYWxpZCA9IHRydWU7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIGdldFBlcnNvbk5hbWVPclByb25vdW4oaXNNaWRTZW50ZW5jZSA9IGZhbHNlKSB7XG4gICAgbGV0IG5hbWVPclByb25vdW5PYmogPSB0aGlzLmdldFBlcnNvbk5hbWVPclByb25vdW5XaXRoRmxhZyhpc01pZFNlbnRlbmNlKTtcbiAgICBpZiAobmFtZU9yUHJvbm91bk9iai5pc1ZhbGlkKSB7XG4gICAgICByZXR1cm4gbmFtZU9yUHJvbm91bk9iai5uYW1lT3JQcm9ub3VuO1xuICAgIH1cbiAgICBpZiAoaXNNaWRTZW50ZW5jZSkge1xuICAgICAgcmV0dXJuIFwidW5rbm93blwiO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gXCJVbmtub3duXCI7XG4gICAgfVxuICB9XG5cbiAgZ2V0UG9zc2Vzc2l2ZU5hbWUoaXNNaWRTZW50ZW5jZSA9IGZhbHNlKSB7XG4gICAgY29uc3QgZ2QgPSB0aGlzLmV2ZW50R2Q7XG4gICAgbGV0IG5hbWVPclByb25vdW5PYmogPSB0aGlzLmdldFBlcnNvbk5hbWVPclByb25vdW5XaXRoRmxhZyhpc01pZFNlbnRlbmNlKTtcbiAgICBpZiAobmFtZU9yUHJvbm91bk9iai5pc1ZhbGlkKSB7XG4gICAgICBpZiAobmFtZU9yUHJvbm91bk9iai5pc1Byb25vdW4pIHtcbiAgICAgICAgbGV0IGdlbmRlciA9IGdkLnBlcnNvbkdlbmRlcjtcbiAgICAgICAgaWYgKGdlbmRlciA9PSBcIm1hbGVcIikge1xuICAgICAgICAgIHJldHVybiBpc01pZFNlbnRlbmNlID8gXCJoaXNcIiA6IFwiSGlzXCI7XG4gICAgICAgIH0gZWxzZSBpZiAoZ2VuZGVyID09IFwiZmVtYWxlXCIpIHtcbiAgICAgICAgICByZXR1cm4gaXNNaWRTZW50ZW5jZSA/IFwiaGVyXCIgOiBcIkhlclwiO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICAvLyBodHRwOi8vd3d3LnN1c3NleC5hYy51ay9pbmZvcm1hdGljcy9wdW5jdHVhdGlvbi9hcG9zdHJvcGhlL3Bvc3Nlc3NpdmVzXG4gICAgICByZXR1cm4gbmFtZU9yUHJvbm91bk9iai5uYW1lT3JQcm9ub3VuICsgXCInc1wiO1xuICAgIH1cbiAgICByZXR1cm4gaXNNaWRTZW50ZW5jZSA/IFwidGhlaXJcIiA6IFwiVGhlaXJcIjtcbiAgfVxuXG4gIGdldFBvc3Nlc3NpdmVOYW1lUGx1c0NoaWxkKGlzTWlkU2VudGVuY2UgPSBmYWxzZSkge1xuICAgIGNvbnN0IGdkID0gdGhpcy5ldmVudEdkO1xuICAgIGxldCBzdHJpbmcgPSB0aGlzLmdldFBvc3Nlc3NpdmVOYW1lKGlzTWlkU2VudGVuY2UpO1xuICAgIHN0cmluZyArPSBcIiBcIiArIGdldFByaW1hcnlQZXJzb25DaGlsZFRlcm0oZ2QpO1xuICAgIGlmIChnZC5wcmltYXJ5UGVyc29uKSB7XG4gICAgICBzdHJpbmcgKz0gXCIgXCIgKyBnZC5wcmltYXJ5UGVyc29uO1xuICAgIH1cbiAgICByZXR1cm4gc3RyaW5nO1xuICB9XG5cbiAgZ2V0UG9zc2Vzc2l2ZU5hbWVQbHVzU3BvdXNlKGlzTWlkU2VudGVuY2UgPSBmYWxzZSkge1xuICAgIGNvbnN0IGdkID0gdGhpcy5ldmVudEdkO1xuICAgIGxldCBzdHJpbmcgPSB0aGlzLmdldFBvc3Nlc3NpdmVOYW1lKGlzTWlkU2VudGVuY2UpO1xuICAgIHN0cmluZyArPSBcIiBcIiArIGdldFByaW1hcnlQZXJzb25TcG91c2VUZXJtKGdkKTtcbiAgICBpZiAoZ2QucHJpbWFyeVBlcnNvbikge1xuICAgICAgc3RyaW5nICs9IFwiIFwiICsgZ2QucHJpbWFyeVBlcnNvbjtcbiAgICB9XG4gICAgcmV0dXJuIHN0cmluZztcbiAgfVxuXG4gIGdldFByb25vdW5Jbml0aWFsQ2FwcygpIHtcbiAgICBpZiAodGhpcy5wZXJzb25HZW5kZXIgPT0gXCJtYWxlXCIpIHtcbiAgICAgIHJldHVybiBcIkhlXCI7XG4gICAgfSBlbHNlIGlmICh0aGlzLnBlcnNvbkdlbmRlciA9PSBcImZlbWFsZVwiKSB7XG4gICAgICByZXR1cm4gXCJTaGVcIjtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIFwiVGhleVwiO1xuICAgIH1cbiAgfVxuXG4gIGdldFByb25vdW5BbmRQYXN0VGVuc2VJbml0aWFsQ2FwcygpIHtcbiAgICBpZiAodGhpcy5wZXJzb25HZW5kZXIgPT0gXCJtYWxlXCIpIHtcbiAgICAgIHJldHVybiBcIkhlIHdhc1wiO1xuICAgIH0gZWxzZSBpZiAodGhpcy5wZXJzb25HZW5kZXIgPT0gXCJmZW1hbGVcIikge1xuICAgICAgcmV0dXJuIFwiU2hlIHdhc1wiO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gXCJUaGV5IHdlcmVcIjtcbiAgICB9XG4gIH1cblxuICBnZXRQb3NzZXNzaXZlUHJvbm91bkZvckdlbmRlckluaXRpYWxDYXBzKGdlbmRlcikge1xuICAgIGlmIChnZW5kZXIgPT0gXCJtYWxlXCIpIHtcbiAgICAgIHJldHVybiBcIkhpc1wiO1xuICAgIH0gZWxzZSBpZiAoZ2VuZGVyID09IFwiZmVtYWxlXCIpIHtcbiAgICAgIHJldHVybiBcIkhlclwiO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gXCJUaGVpclwiO1xuICAgIH1cbiAgfVxuXG4gIGdldFBvc3Nlc3NpdmVQcm9ub3VuSW5pdGlhbENhcHMoKSB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0UG9zc2Vzc2l2ZVByb25vdW5Gb3JHZW5kZXJJbml0aWFsQ2Fwcyh0aGlzLnBlcnNvbkdlbmRlcik7XG4gIH1cblxuICBnZXRQZXJzb25Qcm9ub3VuT3JOYW1lSWZOb0dlbmRlcihpc01pZFNlbnRlbmNlID0gZmFsc2UpIHtcbiAgICBsZXQgcmVzdWx0ID0gdGhpcy5nZXRQcm9ub3VuSW5pdGlhbENhcHMoKTtcblxuICAgIGlmIChyZXN1bHQgPT0gXCJUaGV5XCIpIHtcbiAgICAgIGNvbnN0IGdkID0gdGhpcy5ldmVudEdkO1xuICAgICAgbGV0IG5hbWUgPSBnZC5pbmZlckZpcnN0TmFtZSgpO1xuICAgICAgaWYgKG5hbWUpIHtcbiAgICAgICAgcmV0dXJuIG5hbWU7XG4gICAgICB9XG4gICAgICBuYW1lID0gZ2QuaW5mZXJGb3JlbmFtZXMoKTtcbiAgICAgIGlmIChuYW1lKSB7XG4gICAgICAgIHJldHVybiBuYW1lO1xuICAgICAgfVxuICAgICAgbmFtZSA9IGdkLmluZmVyRnVsbE5hbWUoKTtcbiAgICAgIGlmIChuYW1lKSB7XG4gICAgICAgIHJldHVybiBuYW1lO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChpc01pZFNlbnRlbmNlKSB7XG4gICAgICByZXN1bHQgPSByZXN1bHQudG9Mb3dlckNhc2UoKTtcbiAgICB9XG5cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgaGlnaGxpZ2h0RGF0ZShkYXRlU3RyaW5nKSB7XG4gICAgcmV0dXJuIFdUU19TdHJpbmcuaGlnaGxpZ2h0U3RyaW5nKGRhdGVTdHJpbmcsIHRoaXMub3B0aW9ucy5uYXJyYXRpdmVfZ2VuZXJhbF9kYXRlSGlnaGxpZ2h0KTtcbiAgfVxuXG4gIGdldFBhcmVudFNlcGFyYXRvcigpIHtcbiAgICBpZiAodGhpcy5vcHRpb25zLm5hcnJhdGl2ZV9nZW5lcmFsX3BhcmVudHNVc2VBbXBPckFuZCA9PSBcImFtcFwiKSB7XG4gICAgICByZXR1cm4gXCIgJiBcIjtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIFwiIGFuZCBcIjtcbiAgICB9XG4gIH1cblxuICBhZGRQYXJlbnRhZ2VGb3JNYWluU2VudGVuY2UoKSB7XG4gICAgbGV0IGluY2x1ZGVQYXJlbnRhZ2UgPSB0aGlzLmdldFN1YmNhdE9wdGlvbihcImluY2x1ZGVQYXJlbnRhZ2VcIik7XG4gICAgbGV0IHBhcmVudGFnZUZvcm1hdCA9IHRoaXMuZ2V0U3ViY2F0T3B0aW9uKFwicGFyZW50YWdlRm9ybWF0XCIpO1xuXG4gICAgaWYgKGluY2x1ZGVQYXJlbnRhZ2UgPT0gXCJpbk1haW5TZW50ZW5jZVwiKSB7XG4gICAgICBsZXQgcGFyZW50TmFtZXMgPSB0aGlzLmV2ZW50R2QuaW5mZXJQYXJlbnROYW1lc0ZvckRhdGFTdHJpbmcoKTtcblxuICAgICAgaWYgKHBhcmVudE5hbWVzLmZhdGhlck5hbWUgfHwgcGFyZW50TmFtZXMubW90aGVyTmFtZSkge1xuICAgICAgICBpZiAoIXRoaXMubmFycmF0aXZlLmVuZHNXaXRoKFwiLFwiKSkge1xuICAgICAgICAgIHRoaXMubmFycmF0aXZlICs9IFwiLFwiO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMubmFycmF0aXZlICs9IFwiIFwiO1xuICAgICAgICBpZiAocGFyZW50YWdlRm9ybWF0ID09IFwidGhlVHdvQ29tbWFzXCIpIHtcbiAgICAgICAgICB0aGlzLm5hcnJhdGl2ZSArPSBcInRoZSBcIjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLm5hcnJhdGl2ZSArPSBnZXRDaGlsZFRlcm0odGhpcy5ldmVudEdkLnBlcnNvbkdlbmRlcikgKyBcIiBvZiBcIjtcbiAgICAgICAgaWYgKHBhcmVudE5hbWVzLmZhdGhlck5hbWUpIHtcbiAgICAgICAgICB0aGlzLm5hcnJhdGl2ZSArPSBwYXJlbnROYW1lcy5mYXRoZXJOYW1lO1xuICAgICAgICB9XG4gICAgICAgIGlmIChwYXJlbnROYW1lcy5tb3RoZXJOYW1lKSB7XG4gICAgICAgICAgaWYgKHBhcmVudE5hbWVzLmZhdGhlck5hbWUpIHtcbiAgICAgICAgICAgIHRoaXMubmFycmF0aXZlICs9IHRoaXMuZ2V0UGFyZW50U2VwYXJhdG9yKCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHRoaXMubmFycmF0aXZlICs9IHBhcmVudE5hbWVzLm1vdGhlck5hbWU7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5uYXJyYXRpdmUgKz0gXCIsXCI7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgYWRkUGFyZW50YWdlQXNTZXBhcmF0ZVNlbnRlbmNlKCkge1xuICAgIGxldCBpbmNsdWRlUGFyZW50YWdlID0gdGhpcy5nZXRTdWJjYXRPcHRpb24oXCJpbmNsdWRlUGFyZW50YWdlXCIpO1xuXG4gICAgaWYgKGluY2x1ZGVQYXJlbnRhZ2UgPT0gXCJpblNlcGFyYXRlU2VudGVuY2VcIikge1xuICAgICAgbGV0IHBhcmVudE5hbWVzID0gdGhpcy5ldmVudEdkLmluZmVyUGFyZW50TmFtZXNGb3JEYXRhU3RyaW5nKCk7XG5cbiAgICAgIGlmIChwYXJlbnROYW1lcy5mYXRoZXJOYW1lIHx8IHBhcmVudE5hbWVzLm1vdGhlck5hbWUpIHtcbiAgICAgICAgdGhpcy5uYXJyYXRpdmUgKz0gXCIgXCIgKyB0aGlzLmdldFByb25vdW5BbmRQYXN0VGVuc2VJbml0aWFsQ2FwcygpICsgXCIgdGhlIFwiO1xuICAgICAgICB0aGlzLm5hcnJhdGl2ZSArPSBnZXRDaGlsZFRlcm0odGhpcy5ldmVudEdkLnBlcnNvbkdlbmRlcikgKyBcIiBvZiBcIjtcbiAgICAgICAgaWYgKHBhcmVudE5hbWVzLmZhdGhlck5hbWUpIHtcbiAgICAgICAgICB0aGlzLm5hcnJhdGl2ZSArPSBwYXJlbnROYW1lcy5mYXRoZXJOYW1lO1xuICAgICAgICB9XG4gICAgICAgIGlmIChwYXJlbnROYW1lcy5tb3RoZXJOYW1lKSB7XG4gICAgICAgICAgaWYgKHBhcmVudE5hbWVzLmZhdGhlck5hbWUpIHtcbiAgICAgICAgICAgIHRoaXMubmFycmF0aXZlICs9IHRoaXMuZ2V0UGFyZW50U2VwYXJhdG9yKCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHRoaXMubmFycmF0aXZlICs9IHBhcmVudE5hbWVzLm1vdGhlck5hbWU7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5uYXJyYXRpdmUgKz0gXCIuXCI7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgZm9ybWF0RGF0ZShkYXRlU3RyaW5nLCBhZGRQcmVwb3NpdGlvbiwgcHJlcFN1ZmZpeCA9IFwiXCIpIHtcbiAgICAvLyBmb3IgY2FzZXMgd2hlcmUgd2UgZG9uJ3QgaGF2ZSBhIGRhdGUgb2JqZWN0XG4gICAgbGV0IGRhdGVPYmogPSBuZXcgV3RzRGF0ZSgpO1xuICAgIGRhdGVPYmouZGF0ZVN0cmluZyA9IGRhdGVTdHJpbmc7XG4gICAgbGV0IGZvcm1hdCA9IHRoaXMub3B0aW9ucy5uYXJyYXRpdmVfZ2VuZXJhbF9kYXRlRm9ybWF0O1xuICAgIGxldCBoaWdobGlnaHQgPSB0aGlzLm9wdGlvbnMubmFycmF0aXZlX2dlbmVyYWxfZGF0ZUhpZ2hsaWdodDtcbiAgICByZXR1cm4gdGhpcy5ldmVudEdkLmdldE5hcnJhdGl2ZURhdGVGb3JtYXQoZGF0ZU9iaiwgZm9ybWF0LCBoaWdobGlnaHQsIGFkZFByZXBvc2l0aW9uLCBwcmVwU3VmZml4KTtcbiAgfVxuXG4gIGZvcm1hdERhdGVPYmooZGF0ZU9iaiwgYWRkUHJlcG9zaXRpb24sIHByZXBTdWZmaXggPSBcIlwiKSB7XG4gICAgaWYgKGRhdGVPYmopIHtcbiAgICAgIGxldCBmb3JtYXQgPSB0aGlzLm9wdGlvbnMubmFycmF0aXZlX2dlbmVyYWxfZGF0ZUZvcm1hdDtcbiAgICAgIGxldCBoaWdobGlnaHQgPSB0aGlzLm9wdGlvbnMubmFycmF0aXZlX2dlbmVyYWxfZGF0ZUhpZ2hsaWdodDtcbiAgICAgIHJldHVybiB0aGlzLmV2ZW50R2QuZ2V0TmFycmF0aXZlRGF0ZUZvcm1hdChkYXRlT2JqLCBmb3JtYXQsIGhpZ2hsaWdodCwgYWRkUHJlcG9zaXRpb24sIHByZXBTdWZmaXgpO1xuICAgIH1cbiAgICByZXR1cm4gXCJcIjtcbiAgfVxuXG4gIGdldFF1YXJ0ZXJOYW1lKHF1YXJ0ZXJOdW1iZXIpIHtcbiAgICBjb25zdCBxdWFydGVyTmFtZXMgPSBbXCJKYW4tRmViLU1hclwiLCBcIkFwci1NYXktSnVuXCIsIFwiSnVsLUF1Zy1TZXBcIiwgXCJPY3QtTm92LURlY1wiXTtcbiAgICBpZiAocXVhcnRlck51bWJlciAhPSB1bmRlZmluZWQgJiYgcXVhcnRlck51bWJlciA+PSAxICYmIHF1YXJ0ZXJOdW1iZXIgPD0gNCkge1xuICAgICAgcmV0dXJuIHF1YXJ0ZXJOYW1lc1txdWFydGVyTnVtYmVyIC0gMV07XG4gICAgfVxuXG4gICAgcmV0dXJuIFwiXCI7XG4gIH1cblxuICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG4gIC8vIEFnZVxuICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cbiAgYWRkQWdlUGFydEZvck1haW5TZW50ZW5jZShhZ2UpIHtcbiAgICBpZiAoYWdlKSB7XG4gICAgICBsZXQgaW5jbHVkZUFnZVRleHQgPSB0cnVlO1xuICAgICAgaWYgKHR5cGVvZiBhZ2UgPT0gXCJzdHJpbmdcIiAmJiBhZ2UudG9Mb3dlckNhc2UoKS5pbmRleE9mKFwiYWdlXCIpICE9IC0xKSB7XG4gICAgICAgIC8vIGl0IGNvdWxkIGJlIHNvbWV0aGluZyBsaWtlIFwib2YgRnVsbCBBZ2VcIlxuICAgICAgICBpbmNsdWRlQWdlVGV4dCA9IGZhbHNlO1xuICAgICAgICBhZ2UgPSBhZ2UudG9Mb3dlckNhc2UoKTtcbiAgICAgIH1cblxuICAgICAgbGV0IGZvcm1hdCA9IHRoaXMuZ2V0U3ViY2F0T3B0aW9uKFwiYWdlRm9ybWF0XCIpO1xuICAgICAgaWYgKGluY2x1ZGVBZ2VUZXh0KSB7XG4gICAgICAgIGlmIChmb3JtYXQgPT0gXCJwYXJlbnNBZ2VcIikge1xuICAgICAgICAgIHRoaXMubmFycmF0aXZlICs9IFwiIChhZ2UgXCIgKyBhZ2UgKyBcIilcIjtcbiAgICAgICAgfSBlbHNlIGlmIChmb3JtYXQgPT0gXCJjb21tYXNBZ2VcIikge1xuICAgICAgICAgIGlmICghdGhpcy5uYXJyYXRpdmUuZW5kc1dpdGgoXCIsXCIpKSB7XG4gICAgICAgICAgICB0aGlzLm5hcnJhdGl2ZSArPSBcIixcIjtcbiAgICAgICAgICB9XG4gICAgICAgICAgdGhpcy5uYXJyYXRpdmUgKz0gXCIgYWdlIFwiICsgYWdlICsgXCIsXCI7XG4gICAgICAgIH0gZWxzZSBpZiAoZm9ybWF0ID09IFwicGxhaW5BZ2VcIikge1xuICAgICAgICAgIHRoaXMubmFycmF0aXZlICs9IFwiIGFnZSBcIiArIGFnZTtcbiAgICAgICAgfSBlbHNlIGlmIChmb3JtYXQgPT0gXCJwYXJlbnNBZ2VkXCIpIHtcbiAgICAgICAgICB0aGlzLm5hcnJhdGl2ZSArPSBcIiAoYWdlZCBcIiArIGFnZSArIFwiKVwiO1xuICAgICAgICB9IGVsc2UgaWYgKGZvcm1hdCA9PSBcImNvbW1hc0FnZWRcIikge1xuICAgICAgICAgIGlmICghdGhpcy5uYXJyYXRpdmUuZW5kc1dpdGgoXCIsXCIpKSB7XG4gICAgICAgICAgICB0aGlzLm5hcnJhdGl2ZSArPSBcIixcIjtcbiAgICAgICAgICB9XG4gICAgICAgICAgdGhpcy5uYXJyYXRpdmUgKz0gXCIgYWdlZCBcIiArIGFnZSArIFwiLFwiO1xuICAgICAgICB9IGVsc2UgaWYgKGZvcm1hdCA9PSBcInBsYWluQWdlZFwiKSB7XG4gICAgICAgICAgdGhpcy5uYXJyYXRpdmUgKz0gXCIgYWdlZCBcIiArIGFnZTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKGZvcm1hdCA9PSBcInBhcmVuc0FnZVwiIHx8IGZvcm1hdCA9PSBcInBhcmVuc0FnZWRcIikge1xuICAgICAgICAgIHRoaXMubmFycmF0aXZlICs9IFwiIChcIiArIGFnZSArIFwiKVwiO1xuICAgICAgICB9IGVsc2UgaWYgKGZvcm1hdCA9PSBcImNvbW1hc0FnZVwiIHx8IGZvcm1hdCA9PSBcImNvbW1hc0FnZWRcIikge1xuICAgICAgICAgIGlmICghdGhpcy5uYXJyYXRpdmUuZW5kc1dpdGgoXCIsXCIpKSB7XG4gICAgICAgICAgICB0aGlzLm5hcnJhdGl2ZSArPSBcIixcIjtcbiAgICAgICAgICB9XG4gICAgICAgICAgdGhpcy5uYXJyYXRpdmUgKz0gXCIgXCIgKyBhZ2UgKyBcIixcIjtcbiAgICAgICAgfSBlbHNlIGlmIChmb3JtYXQgPT0gXCJwbGFpbkFnZVwiIHx8IGZvcm1hdCA9PSBcInBsYWluQWdlZFwiKSB7XG4gICAgICAgICAgdGhpcy5uYXJyYXRpdmUgKz0gXCIgXCIgKyBhZ2U7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBhZGRBZ2VGb3JNYWluU2VudGVuY2UoYWdlKSB7XG4gICAgaWYgKHRoaXMuZ2V0U3ViY2F0T3B0aW9uKFwiaW5jbHVkZUFnZVwiKSA9PSBcImluTWFpblNlbnRlbmNlXCIpIHtcbiAgICAgIHRoaXMuYWRkQWdlUGFydEZvck1haW5TZW50ZW5jZShhZ2UpO1xuICAgIH1cbiAgfVxuXG4gIGFkZEFnZUFzU2VwYXJhdGVTZW50ZW5jZShhZ2UpIHtcbiAgICBpZiAodGhpcy5nZXRTdWJjYXRPcHRpb24oXCJpbmNsdWRlQWdlXCIpID09IFwiaW5TZXBhcmF0ZVNlbnRlbmNlXCIpIHtcbiAgICAgIGlmIChhZ2UpIHtcbiAgICAgICAgdGhpcy5uYXJyYXRpdmUgKz0gXCIgXCIgKyB0aGlzLmdldFByb25vdW5BbmRQYXN0VGVuc2VJbml0aWFsQ2FwcygpICsgXCIgXCI7XG5cbiAgICAgICAgaWYgKGFnZS5zZWFyY2goL1teMC05XS8pICE9IC0xKSB7XG4gICAgICAgICAgLy8gdGhlIGFnZSBoYXMgbm9uIG51bWVyaWNhbCBjaGFyYWN0ZXJzLCBpdCBjb3VsZCBiZSBzb21ldGhpbmcgbGlrZSBcIm9mIEZ1bGwgQWdlXCJcbiAgICAgICAgICBsZXQgbGNBZ2UgPSBhZ2UudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICB0aGlzLm5hcnJhdGl2ZSArPSBsY0FnZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLm5hcnJhdGl2ZSArPSBhZ2UgKyBcIiB5ZWFycyBvbGRcIjtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMubmFycmF0aXZlICs9IFwiLlwiO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cbiAgLy8gT2NjdXBhdGlvbiBoZWxwZXJzXG4gIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxuICBnZXRDbGVhbk9jY3VwYXRpb24oKSB7XG4gICAgbGV0IG9jY3VwYXRpb24gPSB0aGlzLmV2ZW50R2Qub2NjdXBhdGlvbjtcbiAgICBpZiAob2NjdXBhdGlvbikge1xuICAgICAgbGV0IGxjT2NjdXBhdGlvbiA9IG9jY3VwYXRpb24udG9Mb3dlckNhc2UoKTtcbiAgICAgIGlmIChsY09jY3VwYXRpb24gPT0gXCJub25lXCIgfHwgbGNPY2N1cGF0aW9uID09IFwibm8gb2NjdXBhdGlvblwiKSB7XG4gICAgICAgIG9jY3VwYXRpb24gPSBcIlwiO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gb2NjdXBhdGlvbjtcbiAgfVxuXG4gIGdldE9jY3VwYXRpb25QYXJ0KG9jY3VwYXRpb24pIHtcbiAgICBsZXQgb2NjdXBhdGlvblRleHQgPSBvY2N1cGF0aW9uO1xuICAgIGlmICh0aGlzLm9wdGlvbnMubmFycmF0aXZlX2dlbmVyYWxfb2NjdXBhdGlvbkZvcm1hdCA9PSBcImxvd2VyQ2FzZVwiKSB7XG4gICAgICBvY2N1cGF0aW9uVGV4dCA9IG9jY3VwYXRpb25UZXh0LnRvTG93ZXJDYXNlKCk7XG4gICAgfSBlbHNlIGlmICh0aGlzLm9wdGlvbnMubmFycmF0aXZlX2dlbmVyYWxfb2NjdXBhdGlvbkZvcm1hdCA9PSBcInRpdGxlQ2FzZVwiKSB7XG4gICAgICAvLyBTb21ldGltZXMgdGhlcmUgYXJlIHBhcmVucyBsaWtlIHRoaXM6IFwiUGF0dGVybiBNYWtlciAoQXJ0eilcIlxuICAgICAgLy8gdG9Jbml0aWFsQ2Fwc0VhY2hXb3JkIGtlZXBzIHRoYXQgT0sgbm93XG4gICAgICBvY2N1cGF0aW9uVGV4dCA9IFdUU19TdHJpbmcudG9Jbml0aWFsQ2Fwc0VhY2hXb3JkKG9jY3VwYXRpb25UZXh0KTtcbiAgICB9XG5cbiAgICByZXR1cm4gb2NjdXBhdGlvblRleHQ7XG4gIH1cblxuICBhZGRPY2N1cGF0aW9uRm9yTWFpblNlbnRlbmNlKG9jY3VwYXRpb24sIG9wdGlvbnNTdWJjYXRlZ29yeSkge1xuICAgIGxldCBpbmNsdWRlT3B0aW9uID0gdGhpcy5nZXRTdWJjYXRPcHRpb24oXCJpbmNsdWRlT2NjdXBhdGlvblwiKTtcblxuICAgIGlmIChvY2N1cGF0aW9uICYmIGluY2x1ZGVPcHRpb24gPT0gXCJpbk1haW5TZW50ZW5jZVwiKSB7XG4gICAgICBsZXQgb2NjdXBhdGlvblRleHQgPSB0aGlzLmdldE9jY3VwYXRpb25QYXJ0KG9jY3VwYXRpb24pO1xuICAgICAgaWYgKG9jY3VwYXRpb25UZXh0KSB7XG4gICAgICAgIGlmICghdGhpcy5uYXJyYXRpdmUuZW5kc1dpdGgoXCIsXCIpKSB7XG4gICAgICAgICAgdGhpcy5uYXJyYXRpdmUgKz0gXCIsXCI7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5uYXJyYXRpdmUgKz0gXCIgXCIgKyBvY2N1cGF0aW9uVGV4dCArIFwiLFwiO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGFkZE9jY3VwYXRpb25Bc1NlcGFyYXRlU2VudGVuY2Uob2NjdXBhdGlvbiwgcmVsYXRpb25zaGlwKSB7XG4gICAgbGV0IGdkID0gdGhpcy5ldmVudEdkO1xuICAgIGxldCBvY2N1cGF0aW9uVGV4dCA9IFwiXCI7XG4gICAgbGV0IGhlYWRSZWxhdGlvbiA9IFwiXCI7XG5cbiAgICBsZXQgaW5jbHVkZU9wdGlvbiA9IHRoaXMuZ2V0U3ViY2F0T3B0aW9uKFwiaW5jbHVkZU9jY3VwYXRpb25cIik7XG5cbiAgICBpZiAoaW5jbHVkZU9wdGlvbiA9PSBcImluU2VwYXJhdGVTZW50ZW5jZVwiKSB7XG4gICAgICBpZiAob2NjdXBhdGlvbikge1xuICAgICAgICBvY2N1cGF0aW9uVGV4dCA9IHRoaXMuZ2V0T2NjdXBhdGlvblBhcnQob2NjdXBhdGlvbik7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmIChpbmNsdWRlT3B0aW9uID09IFwiaW5TZXBhcmF0ZVNlbnRlbmNlSGVhZFwiKSB7XG4gICAgICBpZiAob2NjdXBhdGlvbikge1xuICAgICAgICBvY2N1cGF0aW9uVGV4dCA9IHRoaXMuZ2V0T2NjdXBhdGlvblBhcnQob2NjdXBhdGlvbik7XG4gICAgICB9IGVsc2UgaWYgKHJlbGF0aW9uc2hpcCAmJiBnZC5ob3VzZWhvbGRBcnJheSkge1xuICAgICAgICAvLyB0cnkgdG8gZ2V0IHBhcmVudCBvY2N1cGF0aW9uXG4gICAgICAgIGNvbnN0IGNoaWxkUmVsYXRpb25zaGlwcyA9IFtcInNvblwiLCBcImRhdWdodGVyXCJdO1xuICAgICAgICBpZiAoY2hpbGRSZWxhdGlvbnNoaXBzLmluY2x1ZGVzKHJlbGF0aW9uc2hpcCkpIHtcbiAgICAgICAgICBmb3IgKGxldCBtZW1iZXIgb2YgZ2QuaG91c2Vob2xkQXJyYXkpIHtcbiAgICAgICAgICAgIGlmIChtZW1iZXIucmVsYXRpb25zaGlwICYmIG1lbWJlci5yZWxhdGlvbnNoaXAuaW5jbHVkZXMoXCJoZWFkXCIpKSB7XG4gICAgICAgICAgICAgIGlmIChtZW1iZXIuZ2VuZGVyID09IFwibWFsZVwiKSB7XG4gICAgICAgICAgICAgICAgaGVhZFJlbGF0aW9uID0gXCJmYXRoZXJcIjtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBpZiAobWVtYmVyLmdlbmRlciA9PSBcImZlbWFsZVwiKSB7XG4gICAgICAgICAgICAgICAgaGVhZFJlbGF0aW9uID0gXCJtb3RoZXJcIjtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBvY2N1cGF0aW9uVGV4dCA9IHRoaXMuZ2V0T2NjdXBhdGlvblBhcnQobWVtYmVyLm9jY3VwYXRpb24pO1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAocmVsYXRpb25zaGlwID09IFwid2lmZVwiKSB7XG4gICAgICAgICAgZm9yIChsZXQgbWVtYmVyIG9mIGdkLmhvdXNlaG9sZEFycmF5KSB7XG4gICAgICAgICAgICBpZiAobWVtYmVyLnJlbGF0aW9uc2hpcCAmJiBtZW1iZXIucmVsYXRpb25zaGlwLmluY2x1ZGVzKFwiaGVhZFwiKSkge1xuICAgICAgICAgICAgICBoZWFkUmVsYXRpb24gPSBcImh1c2JhbmRcIjtcbiAgICAgICAgICAgICAgb2NjdXBhdGlvblRleHQgPSB0aGlzLmdldE9jY3VwYXRpb25QYXJ0KG1lbWJlci5vY2N1cGF0aW9uKTtcbiAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKG9jY3VwYXRpb25UZXh0KSB7XG4gICAgICBpZiAoaGVhZFJlbGF0aW9uKSB7XG4gICAgICAgIHRoaXMubmFycmF0aXZlICs9IFwiIFwiICsgdGhpcy5nZXRQb3NzZXNzaXZlUHJvbm91bkluaXRpYWxDYXBzKCkgKyBcIiBcIiArIGhlYWRSZWxhdGlvbiArIFwiIHdhcyBcIjtcbiAgICAgICAgdGhpcy5uYXJyYXRpdmUgKz0gV1RTX1N0cmluZy5nZXRJbmRlZmluaXRlQXJ0aWNsZShvY2N1cGF0aW9uVGV4dCk7XG4gICAgICAgIHRoaXMubmFycmF0aXZlICs9IFwiIFwiICsgb2NjdXBhdGlvblRleHQ7XG4gICAgICAgIHRoaXMubmFycmF0aXZlICs9IFwiLlwiO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5uYXJyYXRpdmUgKz0gXCIgXCIgKyB0aGlzLmdldFByb25vdW5Jbml0aWFsQ2FwcygpICsgXCIgd2FzIFwiO1xuICAgICAgICB0aGlzLm5hcnJhdGl2ZSArPSBXVFNfU3RyaW5nLmdldEluZGVmaW5pdGVBcnRpY2xlKG9jY3VwYXRpb25UZXh0KTtcbiAgICAgICAgdGhpcy5uYXJyYXRpdmUgKz0gXCIgXCIgKyBvY2N1cGF0aW9uVGV4dDtcbiAgICAgICAgdGhpcy5uYXJyYXRpdmUgKz0gXCIuXCI7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuICAvLyBGdW5jdGlvbnMgdG8gYnVpbGQgbmFycmF0aXZlIGZvciBlYWNoIHJlY29yZCB0eXBlXG4gIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxuICBidWlsZFJlZ2lzdHJhdGlvblN0cmluZ09mVHlwZSh0eXBlU3RyaW5nKSB7XG4gICAgbGV0IHF1YXJ0ZXIgPSB0aGlzLmdldFF1YXJ0ZXJOYW1lKHRoaXMuZXZlbnRHZC5pbmZlckV2ZW50UXVhcnRlcigpKTtcblxuICAgIGxldCB5ZWFyID0gdGhpcy5ldmVudEdkLmluZmVyRXZlbnRZZWFyKCk7XG4gICAgbGV0IGRhdGVPYmogPSB0aGlzLmV2ZW50R2QuaW5mZXJFdmVudERhdGVPYmooKTtcbiAgICBsZXQgZGF0ZVN0cmluZyA9IHRoaXMuZXZlbnRHZC5pbmZlckV2ZW50RGF0ZSgpO1xuICAgIGxldCByZWdpc3RyYXRpb25EaXN0cmljdCA9IHRoaXMuZXZlbnRHZC5yZWdpc3RyYXRpb25EaXN0cmljdDtcbiAgICBsZXQgZXZlbnRQbGFjZSA9IHRoaXMuZXZlbnRHZC5pbmZlckZ1bGxFdmVudFBsYWNlKCk7XG5cbiAgICBsZXQgYWdlQXRFdmVudCA9IHRoaXMuZXZlbnRHZC5pbmZlckFnZUF0RXZlbnQoKTtcblxuICAgIGxldCBnZCA9IHRoaXMuZXZlbnRHZDtcblxuICAgIHRoaXMub3B0aW9uc1N1YmNhdGVnb3J5ID0gdHlwZVN0cmluZyArIFwiUmVnXCI7XG5cbiAgICAvLyBOb3RlIC0gd2UgbWF5IG5lZWQgYSBiZXR0ZXIgd2F5IHRvIGRpc3Rpbmd1aXNoIGJldHdlZW4gdGhlIGRhdGUgYmVpbmcgdGhlIGJpcnRoL21hcnJpYWdlL2RlYXRoIGRhdGUgYW5kXG4gICAgLy8gaXQgYmVpbmcgdGhlIHJlZ2lzdHJhdGlvbiBkYXRlL3F1YXJ0ZXIuXG4gICAgLy8gSXQgbWlnaHQgcmVxdWlyZSBlaXRoZXIgYSBzZXBhcmF0ZSByZWNvcmQgdHlwZSBvciBhIGZsYWcgaW4gdGhlIEdEXG4gICAgbGV0IGlzRGF0ZVRoZVJlZ2lzdHJhdGlvbkRhdGUgPSBmYWxzZTtcbiAgICBpZiAocmVnaXN0cmF0aW9uRGlzdHJpY3QgJiYgKHRoaXMuZXZlbnRHZC5pc1JlY29yZEluQ291bnRyeShcIlVuaXRlZCBLaW5nZG9tXCIpIHx8ICFldmVudFBsYWNlKSkge1xuICAgICAgaXNEYXRlVGhlUmVnaXN0cmF0aW9uRGF0ZSA9IHRydWU7XG4gICAgfSBlbHNlIGlmICgocXVhcnRlciB8fCB5ZWFyID09IGRhdGVTdHJpbmcpICYmIHllYXIpIHtcbiAgICAgIGlzRGF0ZVRoZVJlZ2lzdHJhdGlvbkRhdGUgPSB0cnVlO1xuICAgIH1cblxuICAgIGlmICghaXNEYXRlVGhlUmVnaXN0cmF0aW9uRGF0ZSkge1xuICAgICAgLy8gc29tZXRpbWVzIHRoZXJlIGlzIG5vIGV2ZW50IGRhdGUgYnV0IHRoZXJlIGlzIGEgbWFycmlhZ2UgZGF0ZVxuICAgICAgaWYgKCFkYXRlT2JqKSB7XG4gICAgICAgIGlmICh0eXBlU3RyaW5nID09IFwibWFycmlhZ2VcIiAmJiB0aGlzLmV2ZW50R2QubWFycmlhZ2VEYXRlKSB7XG4gICAgICAgICAgZGF0ZU9iaiA9IG5ldyBXdHNEYXRlKCk7XG4gICAgICAgICAgZGF0ZU9iai5kYXRlU3RyaW5nID0gdGhpcy5ldmVudEdkLm1hcnJpYWdlRGF0ZTtcbiAgICAgICAgICBkYXRlU3RyaW5nID0gdGhpcy5ldmVudEdkLm1hcnJpYWdlRGF0ZTtcbiAgICAgICAgICB5ZWFyID0gZGF0ZU9iai5nZXRZZWFyU3RyaW5nKCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICBsZXQgc3BvdXNlTmFtZSA9IFwiXCI7XG4gICAgbGV0IHNwb3VzZUFnZSA9IFwiXCI7XG4gICAgaWYgKHRoaXMuZXZlbnRHZC5zcG91c2VzICYmIHRoaXMuZXZlbnRHZC5zcG91c2VzLmxlbmd0aCA9PSAxKSB7XG4gICAgICBsZXQgc3BvdXNlID0gdGhpcy5ldmVudEdkLnNwb3VzZXNbMF07XG4gICAgICBpZiAoc3BvdXNlLm5hbWUpIHtcbiAgICAgICAgc3BvdXNlTmFtZSA9IHNwb3VzZS5uYW1lLmluZmVyRnVsbE5hbWUoKTtcbiAgICAgIH1cbiAgICAgIGlmIChzcG91c2UuYWdlKSB7XG4gICAgICAgIHNwb3VzZUFnZSA9IHNwb3VzZS5hZ2U7XG4gICAgICB9XG4gICAgfVxuICAgIGNvbnN0IHRvUGFzdCA9IHsgYmlydGg6IFwid2FzIGJvcm5cIiwgbWFycmlhZ2U6IFwibWFycmllZFwiLCBkZWF0aDogXCJkaWVkXCIgfTtcblxuICAgIGlmIChpc0RhdGVUaGVSZWdpc3RyYXRpb25EYXRlKSB7XG4gICAgICB0aGlzLm9wdGlvbnNTdWJzZWN0aW9uID0gXCJSZWdcIjtcbiAgICAgIGxldCBzZW50ZW5jZVN0cnVjdHVyZSA9IHRoaXMuZ2V0U3ViY2F0T3B0aW9uKFwic2VudGVuY2VTdHJ1Y3R1cmVcIik7XG5cbiAgICAgIGlmIChzZW50ZW5jZVN0cnVjdHVyZSA9PSBcIm9uZVNlbnRlbmNlXCIpIHtcbiAgICAgICAgLy8gT25lIHNlbnRlbmNlIGZvcm1hdFxuICAgICAgICBpZiAoZ2Qucm9sZSAmJiBnZC5yb2xlID09IFJvbGUuUGFyZW50KSB7XG4gICAgICAgICAgdGhpcy5uYXJyYXRpdmUgKz0gXCJUaGUgXCIgKyB0eXBlU3RyaW5nICsgXCIgb2YgXCIgKyB0aGlzLmdldFBvc3Nlc3NpdmVOYW1lUGx1c0NoaWxkKCk7XG4gICAgICAgIH0gZWxzZSBpZiAoZ2Qucm9sZSAmJiBnZC5yb2xlID09IFJvbGUuU3BvdXNlKSB7XG4gICAgICAgICAgdGhpcy5uYXJyYXRpdmUgKz0gXCJUaGUgXCIgKyB0eXBlU3RyaW5nICsgXCIgb2YgXCIgKyB0aGlzLmdldFBvc3Nlc3NpdmVOYW1lUGx1c1Nwb3VzZSgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGxldCBwb3NzZXNzaXZlTmFtZSA9IHRoaXMuZ2V0UG9zc2Vzc2l2ZU5hbWUoKTtcbiAgICAgICAgICB0aGlzLm5hcnJhdGl2ZSArPSBwb3NzZXNzaXZlTmFtZSArIFwiIFwiICsgdHlwZVN0cmluZztcbiAgICAgICAgICB0aGlzLmFkZEFnZUZvck1haW5TZW50ZW5jZShhZ2VBdEV2ZW50KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChzcG91c2VOYW1lKSB7XG4gICAgICAgICAgdGhpcy5uYXJyYXRpdmUgKz0gXCIgdG8gXCIgKyBzcG91c2VOYW1lO1xuICAgICAgICAgIHRoaXMuYWRkQWdlRm9yTWFpblNlbnRlbmNlKHNwb3VzZUFnZSk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIFR3byBzZW50ZW5jZSBmb3JtYXRcbiAgICAgICAgbGV0IHBhc3RUZW5zZSA9IHRvUGFzdFt0eXBlU3RyaW5nXTtcbiAgICAgICAgaWYgKGdkLnJvbGUgJiYgZ2Qucm9sZSA9PSBSb2xlLlBhcmVudCkge1xuICAgICAgICAgIHRoaXMubmFycmF0aXZlICs9IHRoaXMuZ2V0UG9zc2Vzc2l2ZU5hbWVQbHVzQ2hpbGQoKTtcbiAgICAgICAgfSBlbHNlIGlmIChnZC5yb2xlICYmIGdkLnJvbGUgPT0gUm9sZS5TcG91c2UpIHtcbiAgICAgICAgICB0aGlzLm5hcnJhdGl2ZSArPSB0aGlzLmdldFBvc3Nlc3NpdmVOYW1lUGx1c1Nwb3VzZSgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRoaXMubmFycmF0aXZlICs9IHRoaXMuZ2V0UGVyc29uTmFtZU9yUHJvbm91bigpO1xuICAgICAgICAgIHRoaXMuYWRkQWdlRm9yTWFpblNlbnRlbmNlKGFnZUF0RXZlbnQpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5uYXJyYXRpdmUgKz0gXCIgXCIgKyBwYXN0VGVuc2U7XG4gICAgICAgIGlmIChzcG91c2VOYW1lKSB7XG4gICAgICAgICAgdGhpcy5uYXJyYXRpdmUgKz0gXCIgXCIgKyBzcG91c2VOYW1lO1xuICAgICAgICAgIHRoaXMuYWRkQWdlRm9yTWFpblNlbnRlbmNlKHNwb3VzZUFnZSk7XG4gICAgICAgIH1cbiAgICAgICAgbGV0IHllYXIgPSB0aGlzLmV2ZW50R2QuaW5mZXJFdmVudFllYXIoKTtcbiAgICAgICAgaWYgKHllYXIpIHtcbiAgICAgICAgICBpZiAocXVhcnRlciA9PSBcIkphbi1GZWItTWFyXCIpIHtcbiAgICAgICAgICAgIGxldCB5ZWFyTnVtID0gV1RTX0RhdGUuZ2V0WWVhck51bUZyb21ZZWFyU3RyaW5nKHllYXIpO1xuICAgICAgICAgICAgaWYgKHllYXJOdW0pIHtcbiAgICAgICAgICAgICAgeWVhck51bSAtPSAxO1xuICAgICAgICAgICAgICB0aGlzLm5hcnJhdGl2ZSArPSBcIiBpbiBsYXRlIFwiICsgeWVhck51bSArIFwiL2Vhcmx5IFwiICsgeWVhcjtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHRoaXMubmFycmF0aXZlICs9IFwiIGluIFwiICsgeWVhcjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5uYXJyYXRpdmUgKz0gXCIgaW4gXCIgKyB5ZWFyO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aGlzLm5hcnJhdGl2ZSArPSBcIi4gXCI7XG4gICAgICAgIGxldCBwcm9ub3VuID0gXCJUaGVpclwiO1xuICAgICAgICBpZiAoIXNwb3VzZU5hbWUpIHtcbiAgICAgICAgICBpZiAodGhpcy5ldmVudEdkLnJvbGUpIHtcbiAgICAgICAgICAgIHByb25vdW4gPSB0aGlzLmdldFBvc3Nlc3NpdmVQcm9ub3VuRm9yR2VuZGVySW5pdGlhbENhcHModGhpcy5ldmVudEdkLnByaW1hcnlQZXJzb25HZW5kZXIpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBwcm9ub3VuID0gdGhpcy5nZXRQb3NzZXNzaXZlUHJvbm91bkluaXRpYWxDYXBzKCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChwcm9ub3VuID09IFwiVGhlaXJcIikge1xuICAgICAgICAgICAgcHJvbm91biA9IFwiVGhlXCI7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRoaXMubmFycmF0aXZlICs9IHByb25vdW4gKyBcIiBcIiArIHR5cGVTdHJpbmc7XG4gICAgICB9XG5cbiAgICAgIHRoaXMubmFycmF0aXZlICs9IFwiIHdhcyByZWdpc3RlcmVkXCI7XG5cbiAgICAgIGlmIChzZW50ZW5jZVN0cnVjdHVyZSA9PSBcIm9uZVNlbnRlbmNlXCIgfHwgc2VudGVuY2VTdHJ1Y3R1cmUgPT0gXCJ0d29TZW50ZW5jZXNEYXRlXCIpIHtcbiAgICAgICAgaWYgKHF1YXJ0ZXIpIHtcbiAgICAgICAgICB0aGlzLm5hcnJhdGl2ZSArPSBcIiBpbiB0aGUgXCIgKyBxdWFydGVyICsgXCIgcXVhcnRlciBvZiBcIiArIHRoaXMuaGlnaGxpZ2h0RGF0ZSh5ZWFyKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLm5hcnJhdGl2ZSArPSBcIiBpbiBcIiArIHRoaXMuaGlnaGxpZ2h0RGF0ZSh5ZWFyKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLm9wdGlvbnNTdWJzZWN0aW9uID0gXCJFdnRcIjtcblxuICAgICAgbGV0IHBhc3RUZW5zZSA9IHRvUGFzdFt0eXBlU3RyaW5nXTtcblxuICAgICAgaWYgKGdkLnJvbGUgJiYgZ2Qucm9sZSA9PSBSb2xlLlBhcmVudCkge1xuICAgICAgICB0aGlzLm5hcnJhdGl2ZSArPSB0aGlzLmdldFBvc3Nlc3NpdmVOYW1lUGx1c0NoaWxkKCk7XG4gICAgICAgIHRoaXMubmFycmF0aXZlICs9IFwiIFwiICsgcGFzdFRlbnNlO1xuICAgICAgfSBlbHNlIGlmIChnZC5yb2xlICYmIGdkLnJvbGUgPT0gUm9sZS5TcG91c2UpIHtcbiAgICAgICAgdGhpcy5uYXJyYXRpdmUgKz0gdGhpcy5nZXRQb3NzZXNzaXZlTmFtZVBsdXNTcG91c2UoKTtcbiAgICAgICAgdGhpcy5uYXJyYXRpdmUgKz0gXCIgXCIgKyBwYXN0VGVuc2U7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLm5hcnJhdGl2ZSArPSB0aGlzLmdldFBlcnNvbk5hbWVPclByb25vdW4oKTtcbiAgICAgICAgdGhpcy5hZGRQYXJlbnRhZ2VGb3JNYWluU2VudGVuY2UoKTtcblxuICAgICAgICBpZiAoYWdlQXRFdmVudCAmJiB0eXBlU3RyaW5nID09IFwibWFycmlhZ2VcIikge1xuICAgICAgICAgIHRoaXMuYWRkQWdlRm9yTWFpblNlbnRlbmNlKGFnZUF0RXZlbnQpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMubmFycmF0aXZlICs9IFwiIFwiICsgcGFzdFRlbnNlO1xuICAgICAgICBpZiAoYWdlQXRFdmVudCAmJiB0eXBlU3RyaW5nICE9IFwibWFycmlhZ2VcIikge1xuICAgICAgICAgIHRoaXMuYWRkQWdlRm9yTWFpblNlbnRlbmNlKGFnZUF0RXZlbnQpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGlmICh0eXBlU3RyaW5nID09IFwibWFycmlhZ2VcIikge1xuICAgICAgICBpZiAoc3BvdXNlTmFtZSkge1xuICAgICAgICAgIHRoaXMubmFycmF0aXZlICs9IFwiIFwiICsgc3BvdXNlTmFtZTtcbiAgICAgICAgICB0aGlzLmFkZEFnZUZvck1haW5TZW50ZW5jZShzcG91c2VBZ2UpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGlmIChkYXRlT2JqKSB7XG4gICAgICAgIHRoaXMubmFycmF0aXZlICs9IFwiIFwiICsgdGhpcy5mb3JtYXREYXRlT2JqKGRhdGVPYmosIHRydWUpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChpc0RhdGVUaGVSZWdpc3RyYXRpb25EYXRlICYmIHJlZ2lzdHJhdGlvbkRpc3RyaWN0KSB7XG4gICAgICBsZXQgZGlzdHJpY3RGb3JtYXQgPSB0aGlzLmdldFN1YmNhdE9wdGlvbihcInJlZ0Rpc3RyaWN0Rm9ybWF0XCIsIFwiUmVnXCIpO1xuXG4gICAgICBpZiAoZGlzdHJpY3RGb3JtYXQgPT0gXCJ0aGVEaXN0cmljdFwiKSB7XG4gICAgICAgIHRoaXMubmFycmF0aXZlICs9IFwiIGluIHRoZSBcIiArIHJlZ2lzdHJhdGlvbkRpc3RyaWN0ICsgXCIgZGlzdHJpY3RcIjtcbiAgICAgIH0gZWxzZSBpZiAoZGlzdHJpY3RGb3JtYXQgPT0gXCJkaXN0cmljdE5hbWVcIikge1xuICAgICAgICB0aGlzLm5hcnJhdGl2ZSArPSBcIiBpbiBcIiArIHJlZ2lzdHJhdGlvbkRpc3RyaWN0O1xuICAgICAgfSBlbHNlIGlmIChkaXN0cmljdEZvcm1hdCA9PSBcImRpc3RyaWN0Q291bnR5XCIpIHtcbiAgICAgICAgdGhpcy5uYXJyYXRpdmUgKz0gXCIgaW4gXCIgKyByZWdpc3RyYXRpb25EaXN0cmljdDtcbiAgICAgICAgbGV0IGNvdW50eSA9IHRoaXMuZXZlbnRHZC5pbmZlckV2ZW50Q291bnR5KCk7XG4gICAgICAgIGlmIChjb3VudHkpIHtcbiAgICAgICAgICB0aGlzLm5hcnJhdGl2ZSArPSBcIiwgXCIgKyBjb3VudHk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKGV2ZW50UGxhY2UpIHtcbiAgICAgIHRoaXMubmFycmF0aXZlICs9IFwiIFwiICsgdGhpcy5nZXRQbGFjZVdpdGhQcmVwb3NpdGlvbihldmVudFBsYWNlKTtcbiAgICB9XG5cbiAgICB0aGlzLm5hcnJhdGl2ZSArPSBcIi5cIjtcblxuICAgIHRoaXMuYWRkUGFyZW50YWdlQXNTZXBhcmF0ZVNlbnRlbmNlKCk7XG4gICAgdGhpcy5hZGRBZ2VBc1NlcGFyYXRlU2VudGVuY2UoYWdlQXRFdmVudCk7XG4gIH1cblxuICBidWlsZEJpcnRoUmVnaXN0cmF0aW9uU3RyaW5nKCkge1xuICAgIHRoaXMuYnVpbGRSZWdpc3RyYXRpb25TdHJpbmdPZlR5cGUoXCJiaXJ0aFwiKTtcbiAgfVxuXG4gIGJ1aWxkRGVhdGhSZWdpc3RyYXRpb25TdHJpbmcoKSB7XG4gICAgdGhpcy5idWlsZFJlZ2lzdHJhdGlvblN0cmluZ09mVHlwZShcImRlYXRoXCIpO1xuICB9XG5cbiAgYnVpbGRNYXJyaWFnZVJlZ2lzdHJhdGlvblN0cmluZygpIHtcbiAgICB0aGlzLmJ1aWxkUmVnaXN0cmF0aW9uU3RyaW5nT2ZUeXBlKFwibWFycmlhZ2VcIik7XG4gIH1cblxuICBidWlsZEJpcnRoU3RyaW5nKCkge1xuICAgIGxldCBnZCA9IHRoaXMuZXZlbnRHZDtcbiAgICBsZXQgZGF0ZU9iaiA9IGdkLmluZmVyQmlydGhEYXRlT2JqKCk7XG4gICAgbGV0IHBsYWNlID0gZ2QuaW5mZXJCaXJ0aFBsYWNlKCk7XG4gICAgdGhpcy5vcHRpb25zU3ViY2F0ZWdvcnkgPSBcImJpcnRoXCI7XG5cbiAgICB0aGlzLm5hcnJhdGl2ZSA9IHRoaXMuZ2V0UGVyc29uTmFtZU9yUHJvbm91bigpO1xuXG4gICAgaWYgKGdkLnJvbGUgJiYgZ2Qucm9sZSA9PSBSb2xlLlBhcmVudCAmJiBnZC5wcmltYXJ5UGVyc29uKSB7XG4gICAgICAvLyBUaGlzIGlzIGEgcmVjb3JkIGZvciBvbmUgb2YgdGhlIHBhcmVudHNcbiAgICAgIC8vIFwiWCBhbmQgWCdzIGNoaWxkIFpcIlxuICAgICAgaWYgKGdkLnNwb3VzZXMgJiYgZ2Quc3BvdXNlc1swXSAmJiBnZC5zcG91c2VzWzBdLm5hbWUgJiYgZ2Quc3BvdXNlc1swXS5uYW1lLm5hbWUpIHtcbiAgICAgICAgdGhpcy5uYXJyYXRpdmUgKz0gXCIgYW5kIFwiICsgZ2Quc3BvdXNlc1swXS5uYW1lLm5hbWU7XG4gICAgICB9XG4gICAgICB0aGlzLm5hcnJhdGl2ZSArPSBcIidzIFwiICsgZ2V0UHJpbWFyeVBlcnNvbkNoaWxkVGVybShnZCkgKyBcIiBcIiArIGdkLnByaW1hcnlQZXJzb247XG4gICAgICAvLyBpbmZlckJpcnRoRGF0ZSB3aWxsIG5vdCByZXR1cm4gdGhlIGRhdGUgb2YgdGhlIHByaW1hcnkgcGVyc29uJ3MgYmlydGhcbiAgICAgIGRhdGVPYmogPSBnZC5pbmZlckV2ZW50RGF0ZU9iaigpO1xuICAgICAgcGxhY2UgPSBnZC5pbmZlckV2ZW50UGxhY2UoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5hZGRQYXJlbnRhZ2VGb3JNYWluU2VudGVuY2UoKTtcbiAgICB9XG5cbiAgICB0aGlzLm5hcnJhdGl2ZSArPSBcIiB3YXMgYm9yblwiOyAvLyBcIndhc1wiIGlzIE9LIGJlY2F1c2Ugd2UgbmV2ZXIgdXNlIFwiVGhleVwiIGF0IHN0YXJ0XG5cbiAgICBpZiAoZGF0ZU9iaikge1xuICAgICAgdGhpcy5uYXJyYXRpdmUgKz0gXCIgXCIgKyB0aGlzLmZvcm1hdERhdGVPYmooZGF0ZU9iaiwgdHJ1ZSk7XG4gICAgfVxuICAgIGlmIChwbGFjZSkge1xuICAgICAgdGhpcy5uYXJyYXRpdmUgKz0gXCIgXCIgKyB0aGlzLmdldFBsYWNlV2l0aFByZXBvc2l0aW9uKHBsYWNlKTtcbiAgICB9XG4gICAgdGhpcy5uYXJyYXRpdmUgKz0gXCIuXCI7XG5cbiAgICB0aGlzLmFkZFBhcmVudGFnZUFzU2VwYXJhdGVTZW50ZW5jZSgpO1xuICB9XG5cbiAgYnVpbGREZWF0aFN0cmluZygpIHtcbiAgICBsZXQgZ2QgPSB0aGlzLmV2ZW50R2Q7XG4gICAgbGV0IGRhdGVPYmogPSBnZC5pbmZlckRlYXRoRGF0ZU9iaigpO1xuICAgIGxldCBwbGFjZSA9IGdkLmluZmVyRGVhdGhQbGFjZSgpO1xuICAgIHRoaXMub3B0aW9uc1N1YmNhdGVnb3J5ID0gXCJkZWF0aFwiO1xuXG4gICAgaWYgKGdkLnJvbGUgJiYgZ2Qucm9sZSA9PSBSb2xlLlBhcmVudCkge1xuICAgICAgdGhpcy5uYXJyYXRpdmUgKz0gdGhpcy5nZXRQb3NzZXNzaXZlTmFtZVBsdXNDaGlsZCgpO1xuICAgICAgLy8gaW5mZXJEZWF0aERhdGUgd2lsbCBub3QgcmV0dXJuIHRoZSBkYXRlIG9mIHRoZSBwcmltYXJ5IHBlcnNvbidzIGRlYXRoXG4gICAgICBkYXRlT2JqID0gZ2QuaW5mZXJFdmVudERhdGVPYmooKTtcbiAgICAgIHBsYWNlID0gZ2QuaW5mZXJFdmVudFBsYWNlKCk7XG4gICAgfSBlbHNlIGlmIChnZC5yb2xlICYmIGdkLnJvbGUgPT0gUm9sZS5TcG91c2UpIHtcbiAgICAgIHRoaXMubmFycmF0aXZlICs9IHRoaXMuZ2V0UG9zc2Vzc2l2ZU5hbWVQbHVzU3BvdXNlKCk7XG4gICAgICAvLyBpbmZlckRlYXRoRGF0ZSB3aWxsIG5vdCByZXR1cm4gdGhlIGRhdGUgb2YgdGhlIHByaW1hcnkgcGVyc29uJ3MgZGVhdGhcbiAgICAgIGRhdGVPYmogPSBnZC5pbmZlckV2ZW50RGF0ZU9iaigpO1xuICAgICAgcGxhY2UgPSBnZC5pbmZlckV2ZW50UGxhY2UoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5uYXJyYXRpdmUgKz0gdGhpcy5nZXRQZXJzb25OYW1lT3JQcm9ub3VuKCk7XG4gICAgICB0aGlzLmFkZFBhcmVudGFnZUZvck1haW5TZW50ZW5jZSgpO1xuICAgIH1cblxuICAgIHRoaXMubmFycmF0aXZlICs9IFwiIGRpZWRcIjtcblxuICAgIGxldCBhZ2VBdEV2ZW50ID0gdGhpcy5ldmVudEdkLmluZmVyQWdlQXRFdmVudCgpO1xuICAgIHRoaXMuYWRkQWdlRm9yTWFpblNlbnRlbmNlKGFnZUF0RXZlbnQpO1xuXG4gICAgaWYgKGRhdGVPYmopIHtcbiAgICAgIHRoaXMubmFycmF0aXZlICs9IFwiIFwiICsgdGhpcy5mb3JtYXREYXRlT2JqKGRhdGVPYmosIHRydWUpO1xuICAgIH1cbiAgICBpZiAocGxhY2UpIHtcbiAgICAgIHRoaXMubmFycmF0aXZlICs9IFwiIFwiICsgdGhpcy5nZXRQbGFjZVdpdGhQcmVwb3NpdGlvbihwbGFjZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGxldCByZXNpZGVuY2VQbGFjZSA9IHRoaXMuZXZlbnRHZC5pbmZlclJlc2lkZW5jZVBsYWNlKCk7XG4gICAgICBpZiAocmVzaWRlbmNlUGxhY2UpIHtcbiAgICAgICAgdGhpcy5uYXJyYXRpdmUgKz0gXCIgcmVzaWRpbmcgXCIgKyB0aGlzLmdldFBsYWNlV2l0aFByZXBvc2l0aW9uKHJlc2lkZW5jZVBsYWNlKTtcbiAgICAgIH1cbiAgICB9XG4gICAgdGhpcy5uYXJyYXRpdmUgKz0gXCIuXCI7XG5cbiAgICB0aGlzLmFkZEFnZUFzU2VwYXJhdGVTZW50ZW5jZShhZ2VBdEV2ZW50KTtcbiAgICB0aGlzLmFkZFBhcmVudGFnZUFzU2VwYXJhdGVTZW50ZW5jZSgpO1xuICB9XG5cbiAgYnVpbGRCYXB0aXNtU3RyaW5nKCkge1xuICAgIGxldCBnZCA9IHRoaXMuZXZlbnRHZDtcbiAgICBsZXQgZGF0ZU9iaiA9IGdkLmluZmVyRXZlbnREYXRlT2JqKCk7XG4gICAgbGV0IHBsYWNlID0gZ2QuaW5mZXJGdWxsRXZlbnRQbGFjZSgpO1xuICAgIHRoaXMub3B0aW9uc1N1YmNhdGVnb3J5ID0gXCJiYXB0aXNtXCI7XG5cbiAgICBsZXQgYmFwdGlzZWRTdHJpbmcgPSBcImJhcHRpc2VkXCI7XG4gICAgaWYgKHRoaXMub3B0aW9ucy5uYXJyYXRpdmVfZ2VuZXJhbF9zcGVsbGluZyA9PSBcImVuX3VzXCIpIHtcbiAgICAgIGJhcHRpc2VkU3RyaW5nID0gXCJiYXB0aXplZFwiO1xuICAgIH1cblxuICAgIGlmIChnZC5yb2xlICYmIGdkLnJvbGUgPT0gUm9sZS5QYXJlbnQpIHtcbiAgICAgIHRoaXMubmFycmF0aXZlICs9IHRoaXMuZ2V0UG9zc2Vzc2l2ZU5hbWVQbHVzQ2hpbGQoKTtcbiAgICAgIHRoaXMubmFycmF0aXZlICs9IFwiIHdhcyBcIjtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5uYXJyYXRpdmUgKz0gdGhpcy5nZXRQZXJzb25OYW1lT3JQcm9ub3VuKCk7XG4gICAgICB0aGlzLmFkZFBhcmVudGFnZUZvck1haW5TZW50ZW5jZSgpO1xuICAgICAgdGhpcy5uYXJyYXRpdmUgKz0gXCIgd2FzIFwiO1xuICAgIH1cblxuICAgIGlmIChnZC5iaXJ0aERhdGUgJiYgdGhpcy5vcHRpb25zLm5hcnJhdGl2ZV9iYXB0aXNtX2luY2x1ZGVCaXJ0aERhdGUpIHtcbiAgICAgIHRoaXMubmFycmF0aXZlICs9IFwiYm9ybiBcIiArIHRoaXMuZm9ybWF0RGF0ZU9iaihnZC5iaXJ0aERhdGUsIHRydWUpO1xuICAgICAgaWYgKHRoaXMub3B0aW9ucy5uYXJyYXRpdmVfYmFwdGlzbV9zZW50ZW5jZVN0cnVjdHVyZSA9PSBcInBhcmVudHNCb3JuQW5kQmFwXCIpIHtcbiAgICAgICAgdGhpcy5uYXJyYXRpdmUgKz0gXCIgYW5kIFwiO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5uYXJyYXRpdmUgKz0gXCI7IFwiO1xuICAgICAgfVxuICAgIH1cblxuICAgIHRoaXMubmFycmF0aXZlICs9IGJhcHRpc2VkU3RyaW5nO1xuXG4gICAgaWYgKGRhdGVPYmopIHtcbiAgICAgIHRoaXMubmFycmF0aXZlICs9IFwiIFwiICsgdGhpcy5mb3JtYXREYXRlT2JqKGRhdGVPYmosIHRydWUpO1xuICAgIH1cbiAgICBpZiAocGxhY2UpIHtcbiAgICAgIHRoaXMubmFycmF0aXZlICs9IFwiIFwiICsgdGhpcy5nZXRQbGFjZVdpdGhQcmVwb3NpdGlvbihwbGFjZSk7XG4gICAgfVxuXG4gICAgLy8gc29tZXRpbWVzIGEgYmFwdGlzbSBoYXMgYSBkZWF0aCBkYXRlLiAoZS5nLiBnZXJtYW55X2JhcHRpc21fMTg0MF9qb2hhbm5hX2hhcnRtYW5uKVxuICAgIGlmICh0aGlzLm9wdGlvbnMubmFycmF0aXZlX2JhcHRpc21faW5jbHVkZURlYXRoRGF0ZSkge1xuICAgICAgbGV0IGRlYXRoRGF0ZU9iaiA9IGdkLmluZmVyRGVhdGhEYXRlT2JqKCk7XG4gICAgICBpZiAoZGVhdGhEYXRlT2JqKSB7XG4gICAgICAgIHRoaXMubmFycmF0aXZlICs9IFwiIGFuZCBkaWVkIFwiICsgdGhpcy5mb3JtYXREYXRlT2JqKGRlYXRoRGF0ZU9iaiwgdHJ1ZSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgdGhpcy5uYXJyYXRpdmUgKz0gXCIuXCI7XG5cbiAgICB0aGlzLmFkZFBhcmVudGFnZUFzU2VwYXJhdGVTZW50ZW5jZSgpO1xuICB9XG5cbiAgYnVpbGRNYXJyaWFnZVN0cmluZygpIHtcbiAgICBsZXQgZ2QgPSB0aGlzLmV2ZW50R2Q7XG4gICAgbGV0IGRhdGVPYmogPSB0aGlzLmV2ZW50R2QuaW5mZXJFdmVudERhdGVPYmooKTtcbiAgICBsZXQgcGxhY2UgPSB0aGlzLmV2ZW50R2QuaW5mZXJGdWxsRXZlbnRQbGFjZSgpO1xuICAgIGxldCBhZ2VBdEV2ZW50ID0gdGhpcy5ldmVudEdkLmluZmVyQWdlQXRFdmVudCgpO1xuXG4gICAgdGhpcy5vcHRpb25zU3ViY2F0ZWdvcnkgPSBcIm1hcnJpYWdlXCI7XG5cbiAgICBsZXQgc3BvdXNlTmFtZSA9IFwiXCI7XG4gICAgbGV0IHNwb3VzZUFnZSA9IFwiXCI7XG4gICAgaWYgKHRoaXMuZXZlbnRHZC5zcG91c2VzICYmIGdkLnNwb3VzZXMubGVuZ3RoID09IDEpIHtcbiAgICAgIGxldCBzcG91c2UgPSBnZC5zcG91c2VzWzBdO1xuICAgICAgaWYgKHNwb3VzZS5uYW1lKSB7XG4gICAgICAgIHNwb3VzZU5hbWUgPSBzcG91c2UubmFtZS5pbmZlckZ1bGxOYW1lKCk7XG4gICAgICB9XG4gICAgICBpZiAoc3BvdXNlLmFnZSkge1xuICAgICAgICBzcG91c2VBZ2UgPSBzcG91c2UuYWdlO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChnZC5yb2xlICYmIGdkLnJvbGUgPT0gUm9sZS5QYXJlbnQpIHtcbiAgICAgIHRoaXMubmFycmF0aXZlICs9IHRoaXMuZ2V0UG9zc2Vzc2l2ZU5hbWVQbHVzQ2hpbGQoKTtcbiAgICAgIHRoaXMubmFycmF0aXZlICs9IFwiIG1hcnJpZWRcIjtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5uYXJyYXRpdmUgKz0gdGhpcy5nZXRQZXJzb25OYW1lT3JQcm9ub3VuKCk7XG4gICAgICB0aGlzLmFkZEFnZUZvck1haW5TZW50ZW5jZShhZ2VBdEV2ZW50KTtcbiAgICAgIHRoaXMuYWRkUGFyZW50YWdlRm9yTWFpblNlbnRlbmNlKCk7XG4gICAgICB0aGlzLm5hcnJhdGl2ZSArPSBcIiBtYXJyaWVkXCI7XG4gICAgfVxuXG4gICAgaWYgKHNwb3VzZU5hbWUpIHtcbiAgICAgIHNwb3VzZU5hbWUgPSBXVFNfU3RyaW5nLnRvSW5pdGlhbENhcHNFYWNoV29yZChzcG91c2VOYW1lLCB0cnVlKTtcbiAgICAgIHRoaXMubmFycmF0aXZlICs9IFwiIFwiICsgc3BvdXNlTmFtZTtcbiAgICAgIHRoaXMuYWRkQWdlRm9yTWFpblNlbnRlbmNlKHNwb3VzZUFnZSk7XG4gICAgfVxuXG4gICAgaWYgKGdkLnJlY29yZFN1YnR5cGUgJiYgZ2QucmVjb3JkU3VidHlwZSA9PSBSZWNvcmRTdWJ0eXBlLkJhbm5zICYmIChkYXRlT2JqIHx8IHBsYWNlKSkge1xuICAgICAgdGhpcy5uYXJyYXRpdmUgKz0gXCIuIFRoZSBiYW5ucyB3ZXJlIHJlYWRcIjtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5ldmVudEdkLm1hcnJpYWdlRGF0ZSkge1xuICAgICAgLy8gc29tZXRpbWVzIHRoZXJlIGlzIGEgc3BlY2lmaWMgbWFycmlhZ2UgZGF0ZVxuICAgICAgZGF0ZU9iaiA9IG5ldyBXdHNEYXRlKCk7XG4gICAgICBkYXRlT2JqLmRhdGVTdHJpbmcgPSB0aGlzLmV2ZW50R2QubWFycmlhZ2VEYXRlO1xuICAgICAgdGhpcy5uYXJyYXRpdmUgKz0gXCIgXCIgKyB0aGlzLmZvcm1hdERhdGVPYmooZGF0ZU9iaiwgdHJ1ZSk7XG4gICAgfSBlbHNlIGlmIChkYXRlT2JqKSB7XG4gICAgICBsZXQgcHJlcFN1ZmZpeCA9IFwiXCI7XG4gICAgICBpZiAoZ2QucmVjb3JkU3VidHlwZSAmJiBnZC5yZWNvcmRTdWJ0eXBlID09IFJlY29yZFN1YnR5cGUuTWFycmlhZ2VPckJhbm5zKSB7XG4gICAgICAgIHByZXBTdWZmaXggPSBcIm9yIGFmdGVyXCI7XG4gICAgICB9XG4gICAgICB0aGlzLm5hcnJhdGl2ZSArPSBcIiBcIiArIHRoaXMuZm9ybWF0RGF0ZU9iaihkYXRlT2JqLCB0cnVlLCBwcmVwU3VmZml4KTtcbiAgICB9XG4gICAgaWYgKHBsYWNlKSB7XG4gICAgICB0aGlzLm5hcnJhdGl2ZSArPSBcIiBcIiArIHRoaXMuZ2V0UGxhY2VXaXRoUHJlcG9zaXRpb24ocGxhY2UpO1xuICAgIH1cbiAgICB0aGlzLm5hcnJhdGl2ZSArPSBcIi5cIjtcblxuICAgIHRoaXMuYWRkQWdlQXNTZXBhcmF0ZVNlbnRlbmNlKGFnZUF0RXZlbnQpO1xuICAgIHRoaXMuYWRkUGFyZW50YWdlQXNTZXBhcmF0ZVNlbnRlbmNlKCk7XG4gIH1cblxuICBidWlsZEJ1cmlhbFN0cmluZygpIHtcbiAgICBsZXQgZ2QgPSB0aGlzLmV2ZW50R2Q7XG4gICAgdGhpcy5vcHRpb25zU3ViY2F0ZWdvcnkgPSBcImJ1cmlhbFwiO1xuXG4gICAgbGV0IGJ1cmlhbERhdGUgPSBnZC5ldmVudERhdGU7XG4gICAgbGV0IGRlYXRoRGF0ZSA9IGdkLmRlYXRoRGF0ZTtcblxuICAgIGxldCBwbGFjZSA9IGdkLmluZmVyRnVsbEV2ZW50UGxhY2UoKTtcblxuICAgIGlmIChnZC5yb2xlICYmIGdkLnJvbGUgPT0gUm9sZS5QYXJlbnQpIHtcbiAgICAgIHRoaXMubmFycmF0aXZlICs9IHRoaXMuZ2V0UG9zc2Vzc2l2ZU5hbWVQbHVzQ2hpbGQoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5uYXJyYXRpdmUgKz0gdGhpcy5nZXRQZXJzb25OYW1lT3JQcm9ub3VuKCk7XG4gICAgfVxuXG4gICAgbGV0IGFnZSA9IHRoaXMuZXZlbnRHZC5hZ2VBdERlYXRoO1xuICAgIGlmICghYWdlKSB7XG4gICAgICBhZ2UgPSB0aGlzLmV2ZW50R2QuYWdlQXRFdmVudDtcbiAgICB9XG4gICAgdGhpcy5hZGRBZ2VGb3JNYWluU2VudGVuY2UoYWdlKTtcblxuICAgIGlmICghZ2Qucm9sZSkge1xuICAgICAgdGhpcy5hZGRQYXJlbnRhZ2VGb3JNYWluU2VudGVuY2UoKTtcbiAgICB9XG5cbiAgICBpZiAoZGVhdGhEYXRlICYmIGJ1cmlhbERhdGUgJiYgZGVhdGhEYXRlLmRhdGVTdHJpbmcgIT0gYnVyaWFsRGF0ZS5kYXRlU3RyaW5nKSB7XG4gICAgICB0aGlzLm5hcnJhdGl2ZSArPSBcIiBkaWVkXCI7XG4gICAgICB0aGlzLm5hcnJhdGl2ZSArPSBcIiBcIiArIHRoaXMuZm9ybWF0RGF0ZU9iaihkZWF0aERhdGUsIHRydWUpO1xuICAgICAgdGhpcy5uYXJyYXRpdmUgKz0gXCIgYW5kIHdhcyBidXJpZWRcIjtcbiAgICAgIHRoaXMubmFycmF0aXZlICs9IFwiIFwiICsgdGhpcy5mb3JtYXREYXRlT2JqKGJ1cmlhbERhdGUsIHRydWUpO1xuICAgIH0gZWxzZSBpZiAoZ2QucmVjb3JkVHlwZSA9PSBSVC5EZWF0aE9yQnVyaWFsKSB7XG4gICAgICB0aGlzLm5hcnJhdGl2ZSArPSBcIiBkaWVkIG9yIHdhcyBidXJpZWRcIjtcbiAgICAgIHRoaXMubmFycmF0aXZlICs9IFwiIFwiICsgdGhpcy5mb3JtYXREYXRlT2JqKGJ1cmlhbERhdGUsIHRydWUpO1xuICAgIH0gZWxzZSBpZiAoYnVyaWFsRGF0ZSkge1xuICAgICAgdGhpcy5uYXJyYXRpdmUgKz0gXCIgd2FzIGJ1cmllZFwiO1xuICAgICAgdGhpcy5uYXJyYXRpdmUgKz0gXCIgXCIgKyB0aGlzLmZvcm1hdERhdGVPYmooYnVyaWFsRGF0ZSwgdHJ1ZSk7XG4gICAgfSBlbHNlIGlmIChkZWF0aERhdGUpIHtcbiAgICAgIHRoaXMubmFycmF0aXZlICs9IFwiIGRpZWRcIjtcbiAgICAgIHRoaXMubmFycmF0aXZlICs9IFwiIFwiICsgdGhpcy5mb3JtYXREYXRlT2JqKGRlYXRoRGF0ZSwgdHJ1ZSk7XG4gICAgICB0aGlzLm5hcnJhdGl2ZSArPSBcIiBhbmQgd2FzIGJ1cmllZFwiO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLm5hcnJhdGl2ZSArPSBcIiB3YXMgYnVyaWVkXCI7XG4gICAgfVxuXG4gICAgaWYgKHBsYWNlKSB7XG4gICAgICB0aGlzLm5hcnJhdGl2ZSArPSBcIiBcIiArIHRoaXMuZ2V0UGxhY2VXaXRoUHJlcG9zaXRpb24ocGxhY2UpO1xuICAgIH1cbiAgICB0aGlzLm5hcnJhdGl2ZSArPSBcIi5cIjtcblxuICAgIHRoaXMuYWRkQWdlQXNTZXBhcmF0ZVNlbnRlbmNlKGFnZSk7XG4gICAgdGhpcy5hZGRQYXJlbnRhZ2VBc1NlcGFyYXRlU2VudGVuY2UoKTtcbiAgfVxuXG4gIGJ1aWxkQ3JlbWF0aW9uU3RyaW5nKCkge1xuICAgIGxldCBjcmVtYXRpb25EYXRlID0gdGhpcy5ldmVudEdkLmV2ZW50RGF0ZTtcbiAgICBsZXQgZGVhdGhEYXRlID0gdGhpcy5ldmVudEdkLmRlYXRoRGF0ZTtcbiAgICB0aGlzLm9wdGlvbnNTdWJjYXRlZ29yeSA9IFwiY3JlbWF0aW9uXCI7XG5cbiAgICBsZXQgcGxhY2UgPSB0aGlzLmV2ZW50R2QuaW5mZXJGdWxsRXZlbnRQbGFjZSgpO1xuXG4gICAgdGhpcy5uYXJyYXRpdmUgPSB0aGlzLmdldFBlcnNvbk5hbWVPclByb25vdW4oKTtcblxuICAgIGlmIChkZWF0aERhdGUgJiYgY3JlbWF0aW9uRGF0ZSkge1xuICAgICAgdGhpcy5uYXJyYXRpdmUgKz0gXCIgZGllZFwiO1xuICAgICAgdGhpcy5uYXJyYXRpdmUgKz0gXCIgXCIgKyB0aGlzLmZvcm1hdERhdGVPYmooZGVhdGhEYXRlLCB0cnVlKTtcbiAgICAgIHRoaXMubmFycmF0aXZlICs9IFwiIGFuZCB3YXMgY3JlbWF0ZWRcIjtcbiAgICAgIHRoaXMubmFycmF0aXZlICs9IFwiIFwiICsgdGhpcy5mb3JtYXREYXRlT2JqKGNyZW1hdGlvbkRhdGUsIHRydWUpO1xuICAgIH0gZWxzZSBpZiAoY3JlbWF0aW9uRGF0ZSkge1xuICAgICAgdGhpcy5uYXJyYXRpdmUgKz0gXCIgd2FzIGNyZW1hdGVkXCI7XG4gICAgICB0aGlzLm5hcnJhdGl2ZSArPSBcIiBcIiArIHRoaXMuZm9ybWF0RGF0ZU9iaihjcmVtYXRpb25EYXRlLCB0cnVlKTtcbiAgICB9IGVsc2UgaWYgKGRlYXRoRGF0ZSkge1xuICAgICAgdGhpcy5uYXJyYXRpdmUgKz0gXCIgZGllZFwiO1xuICAgICAgdGhpcy5uYXJyYXRpdmUgKz0gXCIgXCIgKyB0aGlzLmZvcm1hdERhdGVPYmooZGVhdGhEYXRlLCB0cnVlKTtcbiAgICAgIHRoaXMubmFycmF0aXZlICs9IFwiIGFuZCB3YXMgY3JlbWF0ZWRcIjtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5uYXJyYXRpdmUgKz0gXCIgd2FzIGNyZW1hdGVkXCI7XG4gICAgfVxuXG4gICAgaWYgKHBsYWNlKSB7XG4gICAgICB0aGlzLm5hcnJhdGl2ZSArPSBcIiBcIiArIHRoaXMuZ2V0UGxhY2VXaXRoUHJlcG9zaXRpb24ocGxhY2UpO1xuICAgIH1cbiAgICB0aGlzLm5hcnJhdGl2ZSArPSBcIi5cIjtcbiAgfVxuXG4gIGJ1aWxkTWVtb3JpYWxTdHJpbmcoKSB7XG4gICAgbGV0IGdkID0gdGhpcy5ldmVudEdkO1xuICAgIHRoaXMub3B0aW9uc1N1YmNhdGVnb3J5ID0gXCJtZW1vcmlhbFwiO1xuXG4gICAgbGV0IHBsYWNlID0gZ2QuaW5mZXJGdWxsRXZlbnRQbGFjZSgpO1xuXG4gICAgbGV0IGRlYXRoRGF0ZSA9IGdkLmluZmVyRGVhdGhEYXRlKCk7XG5cbiAgICB0aGlzLm5hcnJhdGl2ZSArPSB0aGlzLmdldFBlcnNvbk5hbWVPclByb25vdW4oKTtcbiAgICB0aGlzLm5hcnJhdGl2ZSArPSBcIiB3YXMgbWVudGlvbmVkIG9uIGEgbWVtb3JpYWxcIjtcblxuICAgIGlmIChwbGFjZSkge1xuICAgICAgdGhpcy5uYXJyYXRpdmUgKz0gXCIgXCIgKyB0aGlzLmdldFBsYWNlV2l0aFByZXBvc2l0aW9uKHBsYWNlKTtcbiAgICB9XG4gICAgaWYgKGRlYXRoRGF0ZSkge1xuICAgICAgdGhpcy5uYXJyYXRpdmUgKz0gXCIgd2l0aCBhIGRlYXRoIGRhdGUgb2YgXCIgKyB0aGlzLmZvcm1hdERhdGUoZGVhdGhEYXRlLCBmYWxzZSk7XG4gICAgfVxuICAgIHRoaXMubmFycmF0aXZlICs9IFwiLlwiO1xuICB9XG5cbiAgYnVpbGRPYml0dWFyeVN0cmluZygpIHtcbiAgICBsZXQgZ2QgPSB0aGlzLmV2ZW50R2Q7XG4gICAgdGhpcy5vcHRpb25zU3ViY2F0ZWdvcnkgPSBcIm9iaXR1YXJ5XCI7XG5cbiAgICBsZXQgZXZlbnRQbGFjZSA9IGdkLmluZmVyRnVsbEV2ZW50UGxhY2UoKTtcbiAgICBsZXQgZXZlbnREYXRlT2JqID0gZ2QuaW5mZXJFdmVudERhdGVPYmooKTtcbiAgICBsZXQgZGVhdGhEYXRlT2JqID0gZ2QuaW5mZXJEZWF0aERhdGVPYmooKTtcbiAgICBsZXQgZGVhdGhQbGFjZSA9IGdkLmluZmVyRGVhdGhQbGFjZSgpO1xuICAgIGxldCBhZ2UgPSBcIlwiO1xuXG4gICAgdGhpcy5uYXJyYXRpdmUgKz0gdGhpcy5nZXRQZXJzb25OYW1lT3JQcm9ub3VuKCk7XG4gICAgdGhpcy5hZGRQYXJlbnRhZ2VGb3JNYWluU2VudGVuY2UoKTtcblxuICAgIGlmIChnZC5yb2xlKSB7XG4gICAgICBsZXQgcmVsYXRpb25zaGlwID0gZ2QuZ2V0UmVsYXRpb25zaGlwT2ZQcmltYXJ5UGVyc29uVG9UaGlzUGVyc29uKCk7XG4gICAgICBsZXQgb3RoZXJOYW1lID0gZ2QucHJpbWFyeVBlcnNvbjtcbiAgICAgIGlmIChyZWxhdGlvbnNoaXAgfHwgb3RoZXJOYW1lKSB7XG4gICAgICAgIHRoaXMubmFycmF0aXZlICs9IFwiIHdhcyBtZW50aW9uZWQgaW4gdGhlIG9iaXR1YXJ5IG9mXCI7XG5cbiAgICAgICAgaWYgKHJlbGF0aW9uc2hpcCkge1xuICAgICAgICAgIGxldCBwcm9ub3VuID0gdGhpcy5nZXRQb3NzZXNzaXZlUHJvbm91bkluaXRpYWxDYXBzKCkudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICB0aGlzLm5hcnJhdGl2ZSArPSBcIiBcIiArIHByb25vdW4gKyBcIiBcIiArIHJlbGF0aW9uc2hpcDtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChvdGhlck5hbWUpIHtcbiAgICAgICAgICB0aGlzLm5hcnJhdGl2ZSArPSBcIiBcIiArIG90aGVyTmFtZTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5uYXJyYXRpdmUgKz0gXCIgd2FzIG1lbnRpb25lZCBpbiBhbiBvYml0dWFyeVwiO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLm5hcnJhdGl2ZSArPSBcIiB3YXMgaW4gYW4gb2JpdHVhcnlcIjtcbiAgICB9XG5cbiAgICBpZiAoZXZlbnREYXRlT2JqICYmICghZGVhdGhEYXRlT2JqIHx8IGV2ZW50RGF0ZU9iai5nZXREYXRlU3RyaW5nKCkgIT0gZGVhdGhEYXRlT2JqLmdldERhdGVTdHJpbmcoKSkpIHtcbiAgICAgIHRoaXMubmFycmF0aXZlICs9IFwiIFwiICsgdGhpcy5mb3JtYXREYXRlT2JqKGV2ZW50RGF0ZU9iaiwgdHJ1ZSk7XG4gICAgfVxuICAgIGlmIChldmVudFBsYWNlICYmIGV2ZW50UGxhY2UgIT0gZGVhdGhQbGFjZSkge1xuICAgICAgdGhpcy5uYXJyYXRpdmUgKz0gXCIgXCIgKyB0aGlzLmdldFBsYWNlV2l0aFByZXBvc2l0aW9uKGV2ZW50UGxhY2UpO1xuICAgIH1cblxuICAgIGlmIChkZWF0aERhdGVPYmopIHtcbiAgICAgIHRoaXMubmFycmF0aXZlICs9IFwiLiBcIiArIHRoaXMuZ2V0UGVyc29uUHJvbm91bk9yTmFtZUlmTm9HZW5kZXIoKSArIFwiIGRpZWRcIjtcblxuICAgICAgYWdlID0gdGhpcy5ldmVudEdkLmFnZUF0RGVhdGg7XG4gICAgICBpZiAoIWFnZSkge1xuICAgICAgICBhZ2UgPSB0aGlzLmV2ZW50R2QuYWdlQXRFdmVudDtcbiAgICAgIH1cbiAgICAgIHRoaXMuYWRkQWdlRm9yTWFpblNlbnRlbmNlKGFnZSk7XG5cbiAgICAgIHRoaXMubmFycmF0aXZlICs9IFwiIFwiICsgdGhpcy5mb3JtYXREYXRlT2JqKGRlYXRoRGF0ZU9iaiwgdHJ1ZSk7XG5cbiAgICAgIGlmIChkZWF0aFBsYWNlKSB7XG4gICAgICAgIHRoaXMubmFycmF0aXZlICs9IFwiIFwiICsgdGhpcy5nZXRQbGFjZVdpdGhQcmVwb3NpdGlvbihkZWF0aFBsYWNlKTtcbiAgICAgIH1cbiAgICB9XG4gICAgdGhpcy5uYXJyYXRpdmUgKz0gXCIuXCI7XG5cbiAgICB0aGlzLmFkZEFnZUFzU2VwYXJhdGVTZW50ZW5jZShhZ2UpO1xuICAgIHRoaXMuYWRkUGFyZW50YWdlQXNTZXBhcmF0ZVNlbnRlbmNlKCk7XG4gIH1cblxuICBidWlsZEJpcnRoT3JCYXB0aXNtU3RyaW5nKCkge1xuICAgIC8vIFRoaXMgY2FuIGhhcHBlbiBpbiBBbmNlc3RyeSwgZXNwZWNpYWxseSBmb3IgY2hpbGQgYmlydGhzIG9yIGJhcHRpc21zXG4gICAgbGV0IGdkID0gdGhpcy5ldmVudEdkO1xuICAgIGxldCBkYXRlT2JqID0gZ2QuaW5mZXJFdmVudERhdGVPYmooKTtcbiAgICBsZXQgcGxhY2UgPSBnZC5pbmZlckZ1bGxFdmVudFBsYWNlKCk7XG4gICAgdGhpcy5vcHRpb25zU3ViY2F0ZWdvcnkgPSBcImJpcnRoT3JCYXB0aXNtXCI7XG5cbiAgICBsZXQgYmFwdGlzZWRTdHJpbmcgPSBcImJhcHRpc2VkXCI7XG4gICAgaWYgKHRoaXMub3B0aW9ucy5uYXJyYXRpdmVfZ2VuZXJhbF9zcGVsbGluZyA9PSBcImVuX3VzXCIpIHtcbiAgICAgIGJhcHRpc2VkU3RyaW5nID0gXCJiYXB0aXplZFwiO1xuICAgIH1cblxuICAgIGlmIChnZC5yb2xlICYmIGdkLnJvbGUgPT0gUm9sZS5QYXJlbnQpIHtcbiAgICAgIHRoaXMubmFycmF0aXZlICs9IHRoaXMuZ2V0UG9zc2Vzc2l2ZU5hbWVQbHVzQ2hpbGQoKTtcbiAgICAgIHRoaXMubmFycmF0aXZlICs9IFwiIHdhcyBib3JuIG9yIFwiICsgYmFwdGlzZWRTdHJpbmc7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMubmFycmF0aXZlICs9IHRoaXMuZ2V0UGVyc29uTmFtZU9yUHJvbm91bigpO1xuICAgICAgdGhpcy5hZGRQYXJlbnRhZ2VGb3JNYWluU2VudGVuY2UoKTtcbiAgICAgIHRoaXMubmFycmF0aXZlICs9IFwiIHdhcyBib3JuIG9yIFwiICsgYmFwdGlzZWRTdHJpbmc7XG4gICAgfVxuXG4gICAgaWYgKGRhdGVPYmopIHtcbiAgICAgIHRoaXMubmFycmF0aXZlICs9IFwiIFwiICsgdGhpcy5mb3JtYXREYXRlT2JqKGRhdGVPYmosIHRydWUpO1xuICAgIH1cbiAgICBpZiAocGxhY2UpIHtcbiAgICAgIHRoaXMubmFycmF0aXZlICs9IFwiIFwiICsgdGhpcy5nZXRQbGFjZVdpdGhQcmVwb3NpdGlvbihwbGFjZSk7XG4gICAgfVxuXG4gICAgLy8gc29tZXRpbWVzIGEgYmFwdGlzbSBoYXMgYSBkZWF0aCBkYXRlLiAoZS5nLiBnZXJtYW55X2JhcHRpc21fMTg0MF9qb2hhbm5hX2hhcnRtYW5uKVxuICAgIGlmIChnZC5kZWF0aERhdGUpIHtcbiAgICAgIHRoaXMubmFycmF0aXZlICs9IFwiIGFuZCBkaWVkIFwiICsgdGhpcy5mb3JtYXREYXRlT2JqKGdkLmluZmVyRGVhdGhEYXRlT2JqKCksIHRydWUpO1xuICAgIH1cblxuICAgIHRoaXMubmFycmF0aXZlICs9IFwiLlwiO1xuXG4gICAgdGhpcy5hZGRQYXJlbnRhZ2VBc1NlcGFyYXRlU2VudGVuY2UoKTtcbiAgfVxuXG4gIGJ1aWxkQ2Vuc3VzU3RyaW5nKCkge1xuICAgIGxldCBnZCA9IHRoaXMuZXZlbnRHZDtcbiAgICBsZXQgb3B0aW9ucyA9IHRoaXMub3B0aW9ucztcbiAgICBsZXQgYnVpbGRlciA9IHRoaXM7XG4gICAgbGV0IGNvbGxlY3Rpb24gPSB0aGlzLmdldENvbGxlY3Rpb24oKTtcbiAgICB0aGlzLm9wdGlvbnNTdWJjYXRlZ29yeSA9IFwiY2Vuc3VzXCI7XG5cbiAgICBmdW5jdGlvbiBnZXRIZWFkT2ZIb3VzZWhvbGRNZW1iZXJJZk5vdFNlbGVjdGVkKGhvdXNlaG9sZCkge1xuICAgICAgbGV0IGhhc1JlbGF0aW9uc2hpcHMgPSBmYWxzZTtcbiAgICAgIGlmIChob3VzZWhvbGQgJiYgaG91c2Vob2xkLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgZm9yIChsZXQgbWVtYmVyIG9mIGhvdXNlaG9sZCkge1xuICAgICAgICAgIGlmICghbWVtYmVyLmlzU2VsZWN0ZWQgJiYgbWVtYmVyLnJlbGF0aW9uc2hpcCkge1xuICAgICAgICAgICAgaGFzUmVsYXRpb25zaGlwcyA9IHRydWU7IC8vIHRoZSBzZWxlY3RlZCBwZXJzb24gY2FuIGhhdmUgYSByZWxhdGlvbnNoaXAgd2hlbiB0aGUgcmVzdCBkbyBub3RcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKCFtZW1iZXIuaXNTZWxlY3RlZCAmJiBtZW1iZXIucmVsYXRpb25zaGlwID09IFwiaGVhZFwiKSB7XG4gICAgICAgICAgICByZXR1cm4gbWVtYmVyO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChoYXNSZWxhdGlvbnNoaXBzKSB7XG4gICAgICAgICAgLy8gVGhlcmUgaXMgbm8gaGVhZCAodGhpcyBzaG91bGQgbm90IGJlIGNhbGxlZCBpZiB0aGlzIHBlcnNvbiBpcyB0aGUgaGVhZClcbiAgICAgICAgICAvLyBPY2Nhc2lvbmFsbHkgdGhlIGZpcnN0IHBlcnNvbiBvZiB0aGUgaG91c2Vob2xkIGhhcyBhIHJlbGF0aW9uc2hpcCBvZiBcIndpZmVcIiBvciBcIndpZG93XCJcbiAgICAgICAgICBpZiAoIWhvdXNlaG9sZFswXS5pc1NlbGVjdGVkKSB7XG4gICAgICAgICAgICBpZiAoaG91c2Vob2xkWzBdLnJlbGF0aW9uc2hpcCA9PSBcIndpZmVcIiB8fCBob3VzZWhvbGRbMF0ucmVsYXRpb25zaGlwID09IFwid2lkb3dcIikge1xuICAgICAgICAgICAgICByZXR1cm4gaG91c2Vob2xkWzBdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBpZiAoIWhvdXNlaG9sZFswXS5pc1NlbGVjdGVkKSB7XG4gICAgICAgICAgICByZXR1cm4gaG91c2Vob2xkWzBdO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBnZXRIZWFkT2ZIb3VzZWhvbGROYW1lSWZOb3RTZWxlY3RlZChob3VzZWhvbGQpIHtcbiAgICAgIGxldCBtZW1iZXIgPSBnZXRIZWFkT2ZIb3VzZWhvbGRNZW1iZXJJZk5vdFNlbGVjdGVkKGhvdXNlaG9sZCk7XG4gICAgICBpZiAobWVtYmVyKSB7XG4gICAgICAgIHJldHVybiBtZW1iZXIubmFtZTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBcIlwiO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGdldENlbnN1c0RhdGVQYXJ0KHllYXIpIHtcbiAgICAgIGxldCBwYXJ0MU9wdGlvbiA9IG9wdGlvbnMubmFycmF0aXZlX2NlbnN1c19jZW5zdXNEYXRlUGFydEZvcm1hdDtcbiAgICAgIGxldCByZXN1bHQgPSBcIlwiO1xuICAgICAgaWYgKHBhcnQxT3B0aW9uID09IFwiaW5DZW5zdXNUaXRsZVwiKSB7XG4gICAgICAgIGlmIChjb2xsZWN0aW9uICYmIGNvbGxlY3Rpb24udGl0bGUpIHtcbiAgICAgICAgICByZXN1bHQgPSBcIkluIHRoZSBcIiArIGNvbGxlY3Rpb24udGl0bGU7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmVzdWx0ID0gXCJJbiB0aGUgXCIgKyBidWlsZGVyLmhpZ2hsaWdodERhdGUoeWVhcik7XG4gICAgICAgICAgaWYgKHllYXIgPT0gXCIxOTM5XCIpIHtcbiAgICAgICAgICAgIHJlc3VsdCArPSBcIiByZWdpc3RlclwiO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXN1bHQgKz0gXCIgY2Vuc3VzXCI7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKHBhcnQxT3B0aW9uID09IFwiaW5ZZWFyQ2Vuc3VzXCIpIHtcbiAgICAgICAgcmVzdWx0ID0gXCJJbiB0aGUgXCIgKyBidWlsZGVyLmhpZ2hsaWdodERhdGUoeWVhcik7XG4gICAgICAgIGlmICh5ZWFyID09IFwiMTkzOVwiKSB7XG4gICAgICAgICAgcmVzdWx0ICs9IFwiIHJlZ2lzdGVyXCI7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmVzdWx0ICs9IFwiIGNlbnN1c1wiO1xuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKHBhcnQxT3B0aW9uID09IFwiaW5ZZWFyXCIpIHtcbiAgICAgICAgcmVzdWx0ID0gXCJJbiBcIiArIGJ1aWxkZXIuaGlnaGxpZ2h0RGF0ZSh5ZWFyKTtcbiAgICAgIH0gZWxzZSBpZiAocGFydDFPcHRpb24gPT0gXCJvbkRhdGVcIikge1xuICAgICAgICBsZXQgZGF0ZSA9IFwiXCI7XG4gICAgICAgIGlmIChjb2xsZWN0aW9uICYmIGNvbGxlY3Rpb24uZGF0ZXMgJiYgY29sbGVjdGlvbi5kYXRlcy5leGFjdERhdGUpIHtcbiAgICAgICAgICBkYXRlID0gY29sbGVjdGlvbi5kYXRlcy5leGFjdERhdGU7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgZGF0ZSA9IGdkLmluZmVyRXZlbnREYXRlKCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGRhdGUpIHtcbiAgICAgICAgICBsZXQgZGF0ZVN0cmluZyA9IGJ1aWxkZXIuZm9ybWF0RGF0ZShkYXRlLCB0cnVlKTtcbiAgICAgICAgICAvLyB3YW50IHRvIHN0YXJ0IHdpdGggYW4gdXBwZXIgY2FlIGxldHRlclxuICAgICAgICAgIGlmIChkYXRlU3RyaW5nICYmIGRhdGVTdHJpbmcubGVuZ3RoID4gMSkge1xuICAgICAgICAgICAgZGF0ZVN0cmluZyA9IGRhdGVTdHJpbmdbMF0udG9VcHBlckNhc2UoKSArIGRhdGVTdHJpbmcuc3Vic3RyaW5nKDEpO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXN1bHQgPSBkYXRlU3RyaW5nO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGdldEhvdXNlaG9sZFBhcnQoKSB7XG4gICAgICBsZXQgcmVzdWx0ID0gXCJcIjtcbiAgICAgIGlmIChvcHRpb25zLm5hcnJhdGl2ZV9jZW5zdXNfaG91c2Vob2xkUGFydEZvcm1hdCA9PSBcInJlbGF0aW9uc2hpcFwiKSB7XG4gICAgICAgIGlmIChyZWxhdGlvbnNoaXAgJiYgbWFyaXRhbFN0YXR1cykge1xuICAgICAgICAgIGlmIChyZWxhdGlvbnNoaXAuaW5jbHVkZXMoXCJoZWFkXCIpKSB7XG4gICAgICAgICAgICByZXN1bHQgKz0gXCIgdGhlIFwiICsgbWFyaXRhbFN0YXR1cyArIFwiIGhlYWQgb2YgaG91c2Vob2xkXCI7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGxldCBoZWFkTmFtZSA9IGdldEhlYWRPZkhvdXNlaG9sZE5hbWVJZk5vdFNlbGVjdGVkKGdkLmhvdXNlaG9sZEFycmF5KTtcbiAgICAgICAgICAgIGlmIChoZWFkTmFtZSkge1xuICAgICAgICAgICAgICBpZiAocmVsYXRpb25zaGlwLmluY2x1ZGVzKFwid2lmZVwiKSkge1xuICAgICAgICAgICAgICAgIHJlc3VsdCArPSBcIiB0aGUgXCIgKyByZWxhdGlvbnNoaXAgKyBcIiBvZiBcIiArIGhlYWROYW1lO1xuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJlc3VsdCArPSBcIiB0aGUgXCIgKyBtYXJpdGFsU3RhdHVzICsgXCIgXCIgKyByZWxhdGlvbnNoaXAgKyBcIiBvZiBcIiArIGhlYWROYW1lO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICByZXN1bHQgKz0gXCIgYSBcIiArIG1hcml0YWxTdGF0dXMgKyBcIiBcIiArIHJlbGF0aW9uc2hpcDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAocmVsYXRpb25zaGlwKSB7XG4gICAgICAgICAgaWYgKHJlbGF0aW9uc2hpcC5pbmNsdWRlcyhcImhlYWRcIikpIHtcbiAgICAgICAgICAgIHJlc3VsdCArPSBcIiB0aGUgaGVhZCBvZiBob3VzZWhvbGRcIjtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgbGV0IGhlYWROYW1lID0gZ2V0SGVhZE9mSG91c2Vob2xkTmFtZUlmTm90U2VsZWN0ZWQoZ2QuaG91c2Vob2xkQXJyYXkpO1xuICAgICAgICAgICAgaWYgKGhlYWROYW1lKSB7XG4gICAgICAgICAgICAgIHJlc3VsdCArPSBcIiB0aGUgXCIgKyByZWxhdGlvbnNoaXAgKyBcIiBvZiBcIiArIGhlYWROYW1lO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgcmVzdWx0ICs9IFwiIGEgXCIgKyByZWxhdGlvbnNoaXA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKG1hcml0YWxTdGF0dXMpIHtcbiAgICAgICAgICByZXN1bHQgKz0gXCIgcmVjb3JkZWQgYXMgXCIgKyBtYXJpdGFsU3RhdHVzO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBsZXQgbGlzdFBhcnRzID0gW107XG5cbiAgICAgICAgaWYgKHJlbGF0aW9uc2hpcCAmJiBnZC5ob3VzZWhvbGRBcnJheSkge1xuICAgICAgICAgIGxldCBoYXNXaWZlID0gZmFsc2U7XG4gICAgICAgICAgbGV0IGhhc0h1c2JhbmQgPSBmYWxzZTtcbiAgICAgICAgICBsZXQgY2hpbGRDb3VudCA9IDA7XG4gICAgICAgICAgbGV0IGNoaWxkVHlwZSA9IFwibm9uZVwiO1xuICAgICAgICAgIGxldCBjaGlsZE1hcml0YWxTdGF0dXMgPSBcIm5vbmVcIjtcbiAgICAgICAgICBsZXQgc2libGluZ0NvdW50ID0gMDtcbiAgICAgICAgICBsZXQgZmlyc3RTaWJsaW5nVHlwZSA9IFwiXCI7XG4gICAgICAgICAgbGV0IGhhc0ZhdGhlciA9IGZhbHNlO1xuICAgICAgICAgIGxldCBoYXNNb3RoZXIgPSBmYWxzZTtcbiAgICAgICAgICBsZXQgaXNIZWFkT3JXaWZlID0gZmFsc2U7XG5cbiAgICAgICAgICBsZXQgaGVhZE1lbWJlciA9IGdldEhlYWRPZkhvdXNlaG9sZE1lbWJlcklmTm90U2VsZWN0ZWQoZ2QuaG91c2Vob2xkQXJyYXkpO1xuXG4gICAgICAgICAgaWYgKHJlbGF0aW9uc2hpcC5pbmNsdWRlcyhcImhlYWRcIikgfHwgcmVsYXRpb25zaGlwID09IFwid2lmZVwiKSB7XG4gICAgICAgICAgICBpc0hlYWRPcldpZmUgPSB0cnVlO1xuXG4gICAgICAgICAgICBmb3IgKGxldCBtZW1iZXIgb2YgZ2QuaG91c2Vob2xkQXJyYXkpIHtcbiAgICAgICAgICAgICAgaWYgKG1lbWJlci5pc1NlbGVjdGVkKSBjb250aW51ZTtcbiAgICAgICAgICAgICAgbGV0IHRoaXNNZW1iZXJJc0hlYWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgaWYgKChtZW1iZXIucmVsYXRpb25zaGlwICYmIG1lbWJlci5yZWxhdGlvbnNoaXAuaW5jbHVkZXMoXCJoZWFkXCIpKSB8fCBtZW1iZXIgPT0gaGVhZE1lbWJlcikge1xuICAgICAgICAgICAgICAgIHRoaXNNZW1iZXJJc0hlYWQgPSB0cnVlO1xuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgaWYgKHJlbGF0aW9uc2hpcCA9PSBcIndpZmVcIikge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzTWVtYmVySXNIZWFkKSB7XG4gICAgICAgICAgICAgICAgICBoYXNIdXNiYW5kID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG1lbWJlci5yZWxhdGlvbnNoaXAgPT0gXCJmYXRoZXItaW4tbGF3XCIpIHtcbiAgICAgICAgICAgICAgICAgIGhhc0ZhdGhlciA9IHRydWU7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChtZW1iZXIucmVsYXRpb25zaGlwID09IFwibW90aGVyLWluLWxhd1wiKSB7XG4gICAgICAgICAgICAgICAgICBoYXNNb3RoZXIgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAobWVtYmVyLnJlbGF0aW9uc2hpcCA9PSBcIndpZmVcIikge1xuICAgICAgICAgICAgICAgICAgaGFzV2lmZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChtZW1iZXIucmVsYXRpb25zaGlwID09IFwiZmF0aGVyXCIpIHtcbiAgICAgICAgICAgICAgICAgIGhhc0ZhdGhlciA9IHRydWU7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChtZW1iZXIucmVsYXRpb25zaGlwID09IFwibW90aGVyXCIpIHtcbiAgICAgICAgICAgICAgICAgIGhhc01vdGhlciA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgaWYgKG1lbWJlci5yZWxhdGlvbnNoaXAgPT0gXCJzb25cIiB8fCBtZW1iZXIucmVsYXRpb25zaGlwID09IFwiZGF1Z2h0ZXJcIikge1xuICAgICAgICAgICAgICAgIGNoaWxkQ291bnQrKztcbiAgICAgICAgICAgICAgICBpZiAoY2hpbGRUeXBlID09IFwibm9uZVwiKSB7XG4gICAgICAgICAgICAgICAgICBjaGlsZFR5cGUgPSBtZW1iZXIucmVsYXRpb25zaGlwO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoY2hpbGRUeXBlICE9IG1lbWJlci5yZWxhdGlvbnNoaXApIHtcbiAgICAgICAgICAgICAgICAgIGNoaWxkVHlwZSA9IFwibWl4ZWRcIjsgLy8gbm90IGFsbCBjaGlsZHJlbiBhcmUgc29ucyBvciBkYXVnaHRlcnNcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAobWVtYmVyLm1hcml0YWxTdGF0dXMpIHtcbiAgICAgICAgICAgICAgICAgIGlmIChjaGlsZE1hcml0YWxTdGF0dXMgPT0gXCJub25lXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgY2hpbGRNYXJpdGFsU3RhdHVzID0gbWVtYmVyLm1hcml0YWxTdGF0dXM7XG4gICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGNoaWxkTWFyaXRhbFN0YXR1cyAhPSBtZW1iZXIubWFyaXRhbFN0YXR1cykge1xuICAgICAgICAgICAgICAgICAgICBjaGlsZE1hcml0YWxTdGF0dXMgPSBcIm1peGVkXCI7XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgIGlmIChjaGlsZE1hcml0YWxTdGF0dXMgIT0gXCJub25lXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgY2hpbGRNYXJpdGFsU3RhdHVzID0gXCJtaXhlZFwiO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gZWxzZSBpZiAocmVsYXRpb25zaGlwID09IFwic29uXCIgfHwgcmVsYXRpb25zaGlwID09IFwiZGF1Z2h0ZXJcIikge1xuICAgICAgICAgICAgZm9yIChsZXQgbWVtYmVyIG9mIGdkLmhvdXNlaG9sZEFycmF5KSB7XG4gICAgICAgICAgICAgIGlmIChtZW1iZXIuaXNTZWxlY3RlZCkgY29udGludWU7XG4gICAgICAgICAgICAgIGxldCB0aGlzTWVtYmVySXNIZWFkID0gZmFsc2U7XG4gICAgICAgICAgICAgIGlmICgobWVtYmVyLnJlbGF0aW9uc2hpcCAmJiBtZW1iZXIucmVsYXRpb25zaGlwLmluY2x1ZGVzKFwiaGVhZFwiKSkgfHwgbWVtYmVyID09IGhlYWRNZW1iZXIpIHtcbiAgICAgICAgICAgICAgICB0aGlzTWVtYmVySXNIZWFkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIGlmICh0aGlzTWVtYmVySXNIZWFkKSB7XG4gICAgICAgICAgICAgICAgaWYgKG1lbWJlci5nZW5kZXIgPT0gXCJtYWxlXCIpIHtcbiAgICAgICAgICAgICAgICAgIGhhc0ZhdGhlciA9IHRydWU7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChtZW1iZXIuZ2VuZGVyID09IFwiZmVtYWxlXCIpIHtcbiAgICAgICAgICAgICAgICAgIGhhc01vdGhlciA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9IGVsc2UgaWYgKG1lbWJlci5yZWxhdGlvbnNoaXAgPT0gXCJ3aWZlXCIpIHtcbiAgICAgICAgICAgICAgICBoYXNNb3RoZXIgPSB0cnVlO1xuICAgICAgICAgICAgICB9IGVsc2UgaWYgKG1lbWJlci5yZWxhdGlvbnNoaXAgPT0gXCJzb25cIikge1xuICAgICAgICAgICAgICAgIGlmICghZmlyc3RTaWJsaW5nVHlwZSkge1xuICAgICAgICAgICAgICAgICAgZmlyc3RTaWJsaW5nVHlwZSA9IFwiYnJvdGhlclwiO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBzaWJsaW5nQ291bnQrKztcbiAgICAgICAgICAgICAgfSBlbHNlIGlmIChtZW1iZXIucmVsYXRpb25zaGlwID09IFwiZGF1Z2h0ZXJcIikge1xuICAgICAgICAgICAgICAgIGlmICghZmlyc3RTaWJsaW5nVHlwZSkge1xuICAgICAgICAgICAgICAgICAgZmlyc3RTaWJsaW5nVHlwZSA9IFwic2lzdGVyXCI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHNpYmxpbmdDb3VudCsrO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgaWYgKGlzSGVhZE9yV2lmZSkge1xuICAgICAgICAgICAgaWYgKGhhc1dpZmUpIHtcbiAgICAgICAgICAgICAgbGlzdFBhcnRzLnB1c2goXCJ3aWZlXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGhhc0h1c2JhbmQpIHtcbiAgICAgICAgICAgICAgbGlzdFBhcnRzLnB1c2goXCJodXNiYW5kXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpZiAoaGFzRmF0aGVyICYmIGhhc01vdGhlcikge1xuICAgICAgICAgICAgICBsaXN0UGFydHMucHVzaChcInBhcmVudHNcIik7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGhhc0ZhdGhlcikge1xuICAgICAgICAgICAgICBsaXN0UGFydHMucHVzaChcImZhdGhlclwiKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoaGFzTW90aGVyKSB7XG4gICAgICAgICAgICAgIGxpc3RQYXJ0cy5wdXNoKFwibW90aGVyXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoY2hpbGRDb3VudCkge1xuICAgICAgICAgICAgaWYgKGNoaWxkTWFyaXRhbFN0YXR1cyA9PSBcInNpbmdsZVwiKSB7XG4gICAgICAgICAgICAgIGNoaWxkTWFyaXRhbFN0YXR1cyA9IFwidW5tYXJyaWVkXCI7IC8vIFwid2l0aCBoZXIgdW5tYXJyaWVkIHNvblwiIGlzIGNsZWFyZXIgdGhhbiBcIndpdGggaGVyIHNpbmdsZSBzb25cIlxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGNoaWxkQ291bnQgPT0gMSkge1xuICAgICAgICAgICAgICBsZXQgdGV4dCA9IFwiXCI7XG4gICAgICAgICAgICAgIGlmIChjaGlsZE1hcml0YWxTdGF0dXMgIT0gXCJub25lXCIgJiYgY2hpbGRNYXJpdGFsU3RhdHVzICE9IFwibWl4ZWRcIikge1xuICAgICAgICAgICAgICAgIHRleHQgKz0gY2hpbGRNYXJpdGFsU3RhdHVzICsgXCIgXCI7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgaWYgKGNoaWxkVHlwZSAhPSBcIm5vbmVcIiAmJiBjaGlsZFR5cGUgIT0gXCJtaXhlZFwiKSB7XG4gICAgICAgICAgICAgICAgdGV4dCArPSBjaGlsZFR5cGU7XG4gICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGV4dCArPSBcImNoaWxkXCI7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgbGlzdFBhcnRzLnB1c2godGV4dCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBsZXQgdGV4dCA9IFwiXCIgKyBjaGlsZENvdW50O1xuXG4gICAgICAgICAgICAgIGlmIChjaGlsZE1hcml0YWxTdGF0dXMgIT0gXCJub25lXCIgJiYgY2hpbGRNYXJpdGFsU3RhdHVzICE9IFwibWl4ZWRcIikge1xuICAgICAgICAgICAgICAgIHRleHQgKz0gXCIgXCIgKyBjaGlsZE1hcml0YWxTdGF0dXM7XG4gICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICBpZiAoY2hpbGRUeXBlICE9IFwibm9uZVwiICYmIGNoaWxkVHlwZSAhPSBcIm1peGVkXCIpIHtcbiAgICAgICAgICAgICAgICB0ZXh0ICs9IFwiIFwiICsgY2hpbGRUeXBlICsgXCJzXCI7XG4gICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGV4dCArPSBcIiBjaGlsZHJlblwiO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGxpc3RQYXJ0cy5wdXNoKHRleHQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoc2libGluZ0NvdW50KSB7XG4gICAgICAgICAgICBpZiAoc2libGluZ0NvdW50ID09IDEpIHtcbiAgICAgICAgICAgICAgbGlzdFBhcnRzLnB1c2goZmlyc3RTaWJsaW5nVHlwZSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBsaXN0UGFydHMucHVzaChzaWJsaW5nQ291bnQgKyBcIiBcIiArIFwic2libGluZ3NcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChpc0hlYWRPcldpZmUpIHtcbiAgICAgICAgICAgIGlmIChoYXNGYXRoZXIgJiYgaGFzTW90aGVyKSB7XG4gICAgICAgICAgICAgIGxpc3RQYXJ0cy5wdXNoKFwicGFyZW50c1wiKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoaGFzRmF0aGVyKSB7XG4gICAgICAgICAgICAgIGxpc3RQYXJ0cy5wdXNoKFwiZmF0aGVyXCIpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChoYXNNb3RoZXIpIHtcbiAgICAgICAgICAgICAgbGlzdFBhcnRzLnB1c2goXCJtb3RoZXJcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgbGV0IG51bVBhcnRzID0gbGlzdFBhcnRzLmxlbmd0aDtcbiAgICAgICAgICBpZiAobnVtUGFydHMgPiAwKSB7XG4gICAgICAgICAgICBsZXQgcHJvbm91biA9IGJ1aWxkZXIuZ2V0UG9zc2Vzc2l2ZVByb25vdW5Jbml0aWFsQ2FwcygpLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgICByZXN1bHQgKz0gXCIgd2l0aCBcIiArIHByb25vdW4gKyBcIiBcIjtcbiAgICAgICAgICAgIGlmIChudW1QYXJ0cyA9PSAxKSB7XG4gICAgICAgICAgICAgIHJlc3VsdCArPSBsaXN0UGFydHNbMF07XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBmb3IgKGxldCBwYXJ0SW5kZXggPSAwOyBwYXJ0SW5kZXggPCBudW1QYXJ0czsgcGFydEluZGV4KyspIHtcbiAgICAgICAgICAgICAgICBpZiAocGFydEluZGV4ID09IG51bVBhcnRzIC0gMSkge1xuICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IFwiIGFuZCBcIjtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHBhcnRJbmRleCA+IDApIHtcbiAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSBcIiwgXCI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJlc3VsdCArPSBsaXN0UGFydHNbcGFydEluZGV4XTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gZWxzZSBpZiAocmVsYXRpb25zaGlwKSB7XG4gICAgICAgICAgICAvLyBmYWxsIGJhY2sgdG8gXCJhIHZpc2l0b3IgaW4gdGhlIGhvdXNlaG9sZCBvZiAuLi5cIlxuICAgICAgICAgICAgaWYgKG9wdGlvbnMubmFycmF0aXZlX2NlbnN1c193YXNQYXJ0Rm9ybWF0ICE9IFwid2FzXCIpIHtcbiAgICAgICAgICAgICAgcmVzdWx0ICs9IFwiIGFzXCI7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGxldCBoZWFkTmFtZSA9IGdldEhlYWRPZkhvdXNlaG9sZE5hbWVJZk5vdFNlbGVjdGVkKGdkLmhvdXNlaG9sZEFycmF5KTtcblxuICAgICAgICAgICAgaWYgKHJlbGF0aW9uc2hpcC5pbmNsdWRlcyhcImhlYWRcIikpIHtcbiAgICAgICAgICAgICAgcmVzdWx0ICs9IFwiIHRoZSBoZWFkIG9mIGhvdXNlaG9sZFwiO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChoZWFkTmFtZSkge1xuICAgICAgICAgICAgICByZXN1bHQgKz0gXCIgYSBcIiArIHJlbGF0aW9uc2hpcCArIFwiIGluIHRoZSBob3VzZWhvbGQgb2YgXCIgKyBoZWFkTmFtZTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHJlc3VsdCArPSBcIiBhIFwiICsgcmVsYXRpb25zaGlwO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGFkZEhvdXNlaG9sZFBhcnRGb3JNYWluU2VudGVuY2UoKSB7XG4gICAgICBpZiAob3B0aW9ucy5uYXJyYXRpdmVfY2Vuc3VzX2luY2x1ZGVIb3VzZWhvbGQgPT0gXCJpbk1haW5TZW50ZW5jZVwiKSB7XG4gICAgICAgIGlmIChcbiAgICAgICAgICBvcHRpb25zLm5hcnJhdGl2ZV9jZW5zdXNfd2FzUGFydEZvcm1hdCAhPSBcIndhc1wiICYmXG4gICAgICAgICAgb3B0aW9ucy5uYXJyYXRpdmVfY2Vuc3VzX2hvdXNlaG9sZFBhcnRGb3JtYXQgPT0gXCJyZWxhdGlvbnNoaXBcIlxuICAgICAgICApIHtcbiAgICAgICAgICBidWlsZGVyLm5hcnJhdGl2ZSArPSBcIiBhc1wiO1xuICAgICAgICB9XG5cbiAgICAgICAgYnVpbGRlci5uYXJyYXRpdmUgKz0gZ2V0SG91c2Vob2xkUGFydCgpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGFkZEhvdXNlaG9sZFBhcnRBc1NlcGFyYXRlU2VudGVuY2UoKSB7XG4gICAgICBpZiAob3B0aW9ucy5uYXJyYXRpdmVfY2Vuc3VzX2luY2x1ZGVIb3VzZWhvbGQgPT0gXCJpblNlcGFyYXRlU2VudGVuY2VcIikge1xuICAgICAgICBidWlsZGVyLm5hcnJhdGl2ZSArPSBcIiBcIiArIGJ1aWxkZXIuZ2V0UHJvbm91bkluaXRpYWxDYXBzKCkgKyBcIiB3YXNcIjtcbiAgICAgICAgYnVpbGRlci5uYXJyYXRpdmUgKz0gZ2V0SG91c2Vob2xkUGFydCgpO1xuICAgICAgICBidWlsZGVyLm5hcnJhdGl2ZSArPSBcIi5cIjtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBsZXQgeWVhciA9IHRoaXMuZXZlbnRHZC5pbmZlckV2ZW50WWVhcigpO1xuICAgIGxldCBwbGFjZSA9IHRoaXMuZXZlbnRHZC5pbmZlckZ1bGxFdmVudFBsYWNlKCk7XG5cbiAgICBpZiAoIXBsYWNlKSB7XG4gICAgICBwbGFjZSA9IHRoaXMuZXZlbnRHZC5yZWdpc3RyYXRpb25EaXN0cmljdDtcbiAgICB9XG5cbiAgICBpZiAoIXllYXIgfHwgIXBsYWNlKSB7XG4gICAgICB0aGlzLm5hcnJhdGl2ZSA9IFwiXCI7XG4gICAgICByZXR1cm47IC8vIGRvIGRlZmF1bHQgZ2VuZXJhdGVcbiAgICB9XG5cbiAgICB0aGlzLm5hcnJhdGl2ZSA9IGdldENlbnN1c0RhdGVQYXJ0KHllYXIpO1xuICAgIGlmIChvcHRpb25zLm5hcnJhdGl2ZV9jZW5zdXNfc2VudGVuY2VTdHJ1Y3R1cmUgPT0gXCJjb21tYVwiKSB7XG4gICAgICB0aGlzLm5hcnJhdGl2ZSArPSBcIixcIjtcbiAgICB9XG4gICAgdGhpcy5uYXJyYXRpdmUgKz0gXCIgXCI7XG5cbiAgICB0aGlzLm5hcnJhdGl2ZSArPSB0aGlzLmdldFBlcnNvbk5hbWVPclByb25vdW4odHJ1ZSk7XG5cbiAgICBsZXQgYWdlTnVtID0gdW5kZWZpbmVkO1xuICAgIGxldCBhZ2VBdEV2ZW50ID0gXCJcIjtcbiAgICBpZiAoeWVhciA9PSBcIjE5MzlcIiAmJiB0aGlzLmV2ZW50R2QuYmlydGhEYXRlICYmIHRoaXMuZXZlbnRHZC5iaXJ0aERhdGUuZGF0ZVN0cmluZykge1xuICAgICAgLy8gMTkzOSByZWdpc3RlciB3YXMgdGFrZW4gb24gMjkgU2VwdGVtYmVyIDE5MzkgKGNvdWxkIHN0b3JlIHRoaXMgaW4gY29sbGVjdGlvbnMpXG4gICAgICBhZ2VOdW0gPSBHZW5lcmFsaXplZERhdGEuZ2V0QWdlQXREYXRlKHRoaXMuZXZlbnRHZC5iaXJ0aERhdGUuZGF0ZVN0cmluZywgXCI5IFNlcHRlbWJlciAxOTM5XCIpO1xuICAgICAgaWYgKGFnZU51bSAhPSB1bmRlZmluZWQgJiYgYWdlTnVtICE9IE5hTikge1xuICAgICAgICBhZ2VBdEV2ZW50ID0gYWdlTnVtLnRvU3RyaW5nKCk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGFnZUF0RXZlbnQgPSB0aGlzLmdldE5hcnJhdGl2ZUFnZVN0cmluZyh0aGlzLmV2ZW50R2QuYWdlQXRFdmVudCk7XG4gICAgICBpZiAoYWdlQXRFdmVudCkge1xuICAgICAgICBpZiAoL15cXGQrJC8udGVzdChhZ2VBdEV2ZW50KSkge1xuICAgICAgICAgIGFnZU51bSA9IHBhcnNlSW50KGFnZUF0RXZlbnQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGFnZU51bSA9IDA7IC8vIGNvdWxkIGJlIFwiMS8xMlwiIGZvciBleGFtcGxlIG9yIFwiMSBtb250aFwiXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICBsZXQgb2NjdXBhdGlvbiA9IHRoaXMuZ2V0Q2xlYW5PY2N1cGF0aW9uKCk7XG5cbiAgICBsZXQgcmVsYXRpb25zaGlwID0gdGhpcy5ldmVudEdkLnJlbGF0aW9uc2hpcFRvSGVhZDtcbiAgICBpZiAocmVsYXRpb25zaGlwKSB7XG4gICAgICByZWxhdGlvbnNoaXAgPSByZWxhdGlvbnNoaXAudG9Mb3dlckNhc2UoKTtcbiAgICB9XG5cbiAgICBsZXQgbWFyaXRhbFN0YXR1cyA9IHRoaXMuZXZlbnRHZC5tYXJpdGFsU3RhdHVzO1xuICAgIGlmIChtYXJpdGFsU3RhdHVzID09IFwid2lkb3dcIikge1xuICAgICAgbWFyaXRhbFN0YXR1cyA9IFwid2lkb3dlZFwiO1xuICAgIH0gZWxzZSBpZiAobWFyaXRhbFN0YXR1cyA9PSBcInNpbmdsZVwiKSB7XG4gICAgICBtYXJpdGFsU3RhdHVzID0gdGhpcy5ldmVudEdkLmdldFRlcm1Gb3JVbm1hcnJpZWQoKTtcblxuICAgICAgaWYgKGFnZU51bSAhPSB1bmRlZmluZWQgJiYgYWdlTnVtICE9IE5hTiAmJiBhZ2VOdW0gPD0gMTQpIHtcbiAgICAgICAgLy8gaWYgbGVzcyB0aGFuIG1hcnJpYWdlYmxlIGFnZSBpdCBzZWVtcyBvZGQgdG8gZGVzY3JpYmUgdGhlbSBhcyBzaW5nbGVcbiAgICAgICAgbWFyaXRhbFN0YXR1cyA9IFwiXCI7XG4gICAgICB9XG4gICAgfVxuXG4gICAgdGhpcy5hZGRBZ2VGb3JNYWluU2VudGVuY2UoYWdlQXRFdmVudCk7XG4gICAgdGhpcy5hZGRPY2N1cGF0aW9uRm9yTWFpblNlbnRlbmNlKG9jY3VwYXRpb24pO1xuXG4gICAgdGhpcy5uYXJyYXRpdmUgKz0gXCIgd2FzXCI7XG4gICAgaWYgKG9wdGlvbnMubmFycmF0aXZlX2NlbnN1c193YXNQYXJ0Rm9ybWF0ID09IFwid2FzRW51bWVyYXRlZFwiKSB7XG4gICAgICB0aGlzLm5hcnJhdGl2ZSArPSBcIiBlbnVtZXJhdGVkXCI7XG4gICAgfSBlbHNlIGlmIChvcHRpb25zLm5hcnJhdGl2ZV9jZW5zdXNfd2FzUGFydEZvcm1hdCA9PSBcIndhc1JlY29yZGVkXCIpIHtcbiAgICAgIHRoaXMubmFycmF0aXZlICs9IFwiIHJlY29yZGVkXCI7XG4gICAgfVxuXG4gICAgYWRkSG91c2Vob2xkUGFydEZvck1haW5TZW50ZW5jZSgpO1xuXG4gICAgdGhpcy5uYXJyYXRpdmUgKz0gXCIgXCIgKyB0aGlzLmdldFBsYWNlV2l0aFByZXBvc2l0aW9uKHBsYWNlKSArIFwiLlwiO1xuXG4gICAgYWRkSG91c2Vob2xkUGFydEFzU2VwYXJhdGVTZW50ZW5jZSgpO1xuICAgIHRoaXMuYWRkQWdlQXNTZXBhcmF0ZVNlbnRlbmNlKGFnZUF0RXZlbnQpO1xuICAgIHRoaXMuYWRkT2NjdXBhdGlvbkFzU2VwYXJhdGVTZW50ZW5jZShvY2N1cGF0aW9uLCByZWxhdGlvbnNoaXApO1xuICB9XG5cbiAgYnVpbGRQcm9iYXRlU3RyaW5nKCkge1xuICAgIGxldCBldmVudERhdGVPYmogPSB0aGlzLmV2ZW50R2QuaW5mZXJFdmVudERhdGVPYmooKTtcbiAgICBsZXQgZGVhdGhEYXRlT2JqID0gdGhpcy5ldmVudEdkLmluZmVyRGVhdGhEYXRlT2JqKCk7XG4gICAgbGV0IGV2ZW50UGxhY2UgPSB0aGlzLmV2ZW50R2QuaW5mZXJGdWxsRXZlbnRQbGFjZSgpO1xuICAgIGxldCBkZWF0aFBsYWNlID0gdGhpcy5ldmVudEdkLmluZmVyRGVhdGhQbGFjZSgpO1xuICAgIGxldCByZXNpZGVuY2VQbGFjZSA9IHRoaXMuZXZlbnRHZC5pbmZlclJlc2lkZW5jZVBsYWNlKCk7XG5cbiAgICBsZXQgcG9zc2Vzc2l2ZU5hbWUgPSB0aGlzLmdldFBvc3Nlc3NpdmVOYW1lKCk7XG5cbiAgICBpZiAoZGVhdGhEYXRlT2JqICYmIGV2ZW50RGF0ZU9iaikge1xuICAgICAgbGV0IHByb25vdW4gPSB0aGlzLmdldFBvc3Nlc3NpdmVQcm9ub3VuSW5pdGlhbENhcHMoKS50b0xvd2VyQ2FzZSgpO1xuICAgICAgdGhpcy5uYXJyYXRpdmUgKz0gdGhpcy5nZXRQZXJzb25OYW1lT3JQcm9ub3VuKCkgKyBcIiBkaWVkIFwiICsgdGhpcy5mb3JtYXREYXRlT2JqKGRlYXRoRGF0ZU9iaiwgdHJ1ZSk7XG4gICAgICBpZiAoZGVhdGhQbGFjZSkge1xuICAgICAgICB0aGlzLm5hcnJhdGl2ZSArPSBcIiBcIiArIHRoaXMuZ2V0UGxhY2VXaXRoUHJlcG9zaXRpb24oZGVhdGhQbGFjZSk7XG4gICAgICB9IGVsc2UgaWYgKHJlc2lkZW5jZVBsYWNlKSB7XG4gICAgICAgIHRoaXMubmFycmF0aXZlICs9IFwiIHJlc2lkaW5nIFwiICsgdGhpcy5nZXRQbGFjZVdpdGhQcmVwb3NpdGlvbihyZXNpZGVuY2VQbGFjZSk7XG4gICAgICB9XG4gICAgICB0aGlzLm5hcnJhdGl2ZSArPSBcIiBhbmQgXCIgKyBwcm9ub3VuICsgXCIgZXN0YXRlIHBhc3NlZCBwcm9iYXRlXCI7XG4gICAgICBpZiAoZXZlbnREYXRlT2JqKSB7XG4gICAgICAgIHRoaXMubmFycmF0aXZlICs9IFwiIFwiICsgdGhpcy5mb3JtYXREYXRlT2JqKGV2ZW50RGF0ZU9iaiwgdHJ1ZSk7XG4gICAgICB9XG4gICAgICBpZiAoZXZlbnRQbGFjZSkge1xuICAgICAgICB0aGlzLm5hcnJhdGl2ZSArPSBcIiBcIiArIHRoaXMuZ2V0UGxhY2VXaXRoUHJlcG9zaXRpb24oZXZlbnRQbGFjZSk7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmIChkZWF0aERhdGVPYmopIHtcbiAgICAgIHRoaXMubmFycmF0aXZlICs9IHRoaXMuZ2V0UGVyc29uTmFtZU9yUHJvbm91bigpICsgXCIgZGllZFwiO1xuICAgICAgaWYgKGRlYXRoRGF0ZU9iaikge1xuICAgICAgICB0aGlzLm5hcnJhdGl2ZSArPSBcIiBcIiArIHRoaXMuZm9ybWF0RGF0ZU9iaihkZWF0aERhdGVPYmosIHRydWUpO1xuICAgICAgfVxuICAgICAgaWYgKGRlYXRoUGxhY2UpIHtcbiAgICAgICAgdGhpcy5uYXJyYXRpdmUgKz0gXCIgXCIgKyB0aGlzLmdldFBsYWNlV2l0aFByZXBvc2l0aW9uKGRlYXRoUGxhY2UpO1xuICAgICAgfSBlbHNlIGlmIChyZXNpZGVuY2VQbGFjZSkge1xuICAgICAgICB0aGlzLm5hcnJhdGl2ZSArPSBcIiByZXNpZGluZyBcIiArIHRoaXMuZ2V0UGxhY2VXaXRoUHJlcG9zaXRpb24ocmVzaWRlbmNlUGxhY2UpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLm5hcnJhdGl2ZSArPSBwb3NzZXNzaXZlTmFtZSArIFwiIGVzdGF0ZSBwYXNzZWQgcHJvYmF0ZVwiO1xuICAgICAgaWYgKGV2ZW50RGF0ZU9iaikge1xuICAgICAgICB0aGlzLm5hcnJhdGl2ZSArPSBcIiBcIiArIHRoaXMuZm9ybWF0RGF0ZU9iaihldmVudERhdGVPYmosIHRydWUpO1xuICAgICAgfVxuICAgICAgaWYgKGV2ZW50UGxhY2UpIHtcbiAgICAgICAgdGhpcy5uYXJyYXRpdmUgKz0gXCIgXCIgKyB0aGlzLmdldFBsYWNlV2l0aFByZXBvc2l0aW9uKGV2ZW50UGxhY2UpO1xuICAgICAgfSBlbHNlIGlmIChyZXNpZGVuY2VQbGFjZSkge1xuICAgICAgICB0aGlzLm5hcnJhdGl2ZSArPSBcIi4gXCIgKyB0aGlzLmdldFBvc3Nlc3NpdmVQcm9ub3VuSW5pdGlhbENhcHMoKSArIFwiIGxhc3QgcmVzaWRlbmNlIHdhcyBcIiArIHJlc2lkZW5jZVBsYWNlO1xuICAgICAgfVxuICAgIH1cblxuICAgIHRoaXMubmFycmF0aXZlICs9IFwiLlwiO1xuICB9XG5cbiAgYnVpbGRTY290dGlzaFdpbGxTdHJpbmcoKSB7XG4gICAgbGV0IGdkID0gdGhpcy5ldmVudEdkO1xuICAgIGxldCBkYXRlT2JqID0gZ2QuaW5mZXJFdmVudERhdGVPYmooKTtcbiAgICBsZXQgcGxhY2UgPSBnZC5pbmZlckZ1bGxFdmVudFBsYWNlKCk7XG5cbiAgICBsZXQgcG9zc2Vzc2l2ZU5hbWUgPSB0aGlzLmdldFBvc3Nlc3NpdmVOYW1lKCk7XG5cbiAgICBsZXQgcm9sZSA9IGdkLnJvbGU7XG5cbiAgICBpZiAoIWdkLnJlY29yZFN1YnR5cGUgfHwgZ2QucmVjb3JkU3VidHlwZSA9PSBcIlByb2JhdGVcIikge1xuICAgICAgaWYgKHJvbGUgJiYgcm9sZSAhPSBSb2xlLlByaW1hcnkpIHtcbiAgICAgICAgaWYgKHJvbGUgPT0gUm9sZS5DaGlsZCkge1xuICAgICAgICAgIHRoaXMubmFycmF0aXZlID0gcG9zc2Vzc2l2ZU5hbWUgKyBcIiBwYXJlbnQncyB3aWxsIHBhc3NlZCBwcm9iYXRlXCI7XG4gICAgICAgIH0gZWxzZSBpZiAocm9sZSA9PSBSb2xlLlBhcmVudCkge1xuICAgICAgICAgIHRoaXMubmFycmF0aXZlID0gcG9zc2Vzc2l2ZU5hbWUgKyBcIiBjaGlsZCdzIHdpbGwgcGFzc2VkIHByb2JhdGVcIjtcbiAgICAgICAgfSBlbHNlIGlmIChyb2xlID09IFJvbGUuU3BvdXNlKSB7XG4gICAgICAgICAgdGhpcy5uYXJyYXRpdmUgPSBwb3NzZXNzaXZlTmFtZSArIFwiIHNwb3VzZSdzIHdpbGwgcGFzc2VkIHByb2JhdGVcIjtcbiAgICAgICAgfSBlbHNlIGlmIChyb2xlID09IFJvbGUuV2l0bmVzcykge1xuICAgICAgICAgIHRoaXMubmFycmF0aXZlID0gdGhpcy5nZXRQZXJzb25OYW1lT3JQcm9ub3VuKCkgKyBcIiB3aXRuZXNzZWQgYSB3aWxsIHRoYXQgcGFzc2VkIHByb2JhdGVcIjtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKGdkLmNvdXJ0TmFtZSAmJiBnZC5jb3VydE5hbWUgIT0gXCJub24tU2NvdHRpc2ggQ291cnRcIikge1xuICAgICAgICAgIHRoaXMubmFycmF0aXZlID0gXCJQcm9iYXRlIG9mIFwiICsgcG9zc2Vzc2l2ZU5hbWUgKyBcIiBlc3RhdGUgZW5kb3JzZWRcIjtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLm5hcnJhdGl2ZSA9IFwiUHJvYmF0ZSBvZiBcIiArIHBvc3Nlc3NpdmVOYW1lICsgXCIgZXN0YXRlIHJlY29yZGVkXCI7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKGdkLnJlY29yZFN1YnR5cGUgPT0gXCJUZXN0YW1lbnRcIikge1xuICAgICAgaWYgKGdkLm9yaWdpbmFsQ29uZmlybWF0aW9uR3JhbnRlZERhdGUpIHtcbiAgICAgICAgdGhpcy5uYXJyYXRpdmUgPSBcIkNvbmZpcm1hdGlvbiB3YXMgb3JpZ2luYWxseSBncmFudGVkIG9uIFwiICsgcG9zc2Vzc2l2ZU5hbWUgKyBcIiBlc3RhdGVcIjtcbiAgICAgICAgdGhpcy5uYXJyYXRpdmUgKz0gXCIgXCIgKyB0aGlzLmZvcm1hdERhdGUoZ2Qub3JpZ2luYWxDb25maXJtYXRpb25HcmFudGVkRGF0ZSwgdHJ1ZSk7XG4gICAgICAgIHRoaXMubmFycmF0aXZlICs9IFwiIGFuZCBhbiBhZGRpdGlvbmFsIGNvbmZpcm1hdGlvbiB3YXMgZ3JhbnRlZFwiO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5uYXJyYXRpdmUgPSBcIkNvbmZpcm1hdGlvbiB3YXMgZ3JhbnRlZCBvbiBcIiArIHBvc3Nlc3NpdmVOYW1lICsgXCIgZXN0YXRlXCI7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmIChnZC5yZWNvcmRTdWJ0eXBlID09IFwiSW52ZW50b3J5XCIgfHwgZ2QucmVjb3JkU3VidHlwZSA9PSBcIkFkZGl0aW9uYWxJbnZlbnRvcnlcIikge1xuICAgICAgdGhpcy5uYXJyYXRpdmUgPSBcIkNvbmZpcm1hdGlvbiB3YXMgZ3JhbnRlZCBvbiBcIiArIHBvc3Nlc3NpdmVOYW1lICsgXCIgZXN0YXRlXCI7XG4gICAgICBpZiAoZ2Qub3JpZ2luYWxDb25maXJtYXRpb25HcmFudGVkRGF0ZSkge1xuICAgICAgICB0aGlzLm5hcnJhdGl2ZSArPSBcIiBcIiArIHRoaXMuZm9ybWF0RGF0ZShnZC5vcmlnaW5hbENvbmZpcm1hdGlvbkdyYW50ZWREYXRlLCB0cnVlKTtcbiAgICAgICAgdGhpcy5uYXJyYXRpdmUgKz0gXCIgYW5kIGFuIGFkZGl0aW9uYWwgaW52ZW50b3J5IHdhcyBncmFudGVkXCI7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMubmFycmF0aXZlID0gXCJDb25maXJtYXRpb24gd2FzIGdyYW50ZWQgb24gXCIgKyBwb3NzZXNzaXZlTmFtZSArIFwiIGVzdGF0ZVwiO1xuICAgIH1cblxuICAgIGlmIChkYXRlT2JqKSB7XG4gICAgICB0aGlzLm5hcnJhdGl2ZSArPSBcIiBcIiArIHRoaXMuZm9ybWF0RGF0ZU9iaihkYXRlT2JqLCB0cnVlKTtcbiAgICB9XG5cbiAgICBpZiAoZ2QucmVjb3JkU3VidHlwZSA9PSBcIkFkZGl0aW9uYWxJbnZlbnRvcnlcIikge1xuICAgICAgaWYgKGdkLmdyYW50ZWREYXRlKSB7XG4gICAgICAgIHRoaXMubmFycmF0aXZlICs9IFwiLCBhZGRpdGlvbmFsIGludmVudG9yeSBncmFudGVkIG9uIFwiICsgdGhpcy5mb3JtYXREYXRlKGdkLmdyYW50ZWREYXRlLCBmYWxzZSk7XG4gICAgICB9IGVsc2UgaWYgKGdkLmdpdmVuVXBEYXRlKSB7XG4gICAgICAgIHRoaXMubmFycmF0aXZlICs9IFwiLCBhZGRpdGlvbmFsIGludmVudG9yeSBnaXZlbiB1cCBvbiBcIiArIHRoaXMuZm9ybWF0RGF0ZShnZC5naXZlblVwRGF0ZSwgZmFsc2UpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChnZC5jb3VydE5hbWUpIHtcbiAgICAgIGlmIChnZC5jb3VydE5hbWUuc3RhcnRzV2l0aChcIm5vbi1TY290XCIpKSB7XG4gICAgICAgIHRoaXMubmFycmF0aXZlICs9IFwiIGF0IGEgbm9uLVNjb3R0aXNoIGNvdXJ0XCI7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLm5hcnJhdGl2ZSArPSBcIiBhdCBcIiArIGdkLmNvdXJ0TmFtZTtcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKHBsYWNlKSB7XG4gICAgICB0aGlzLm5hcnJhdGl2ZSArPSBcIiBcIiArIHRoaXMuZ2V0UGxhY2VXaXRoUHJlcG9zaXRpb24ocGxhY2UpO1xuICAgIH1cblxuICAgIHRoaXMubmFycmF0aXZlICs9IFwiLlwiO1xuICB9XG5cbiAgYnVpbGRXaWxsU3RyaW5nKCkge1xuICAgIGxldCBnZCA9IHRoaXMuZXZlbnRHZDtcbiAgICB0aGlzLm9wdGlvbnNTdWJjYXRlZ29yeSA9IFwid2lsbFwiO1xuXG4gICAgaWYgKGdkLmluZmVyRXZlbnRDb3VudHJ5KCkgPT0gXCJTY290bGFuZFwiIHx8IChnZC5jb3VydE5hbWUgJiYgZ2QuY291cnROYW1lLnN0YXJ0c1dpdGgoXCJub24tU2NvdFwiKSkpIHtcbiAgICAgIHRoaXMuYnVpbGRTY290dGlzaFdpbGxTdHJpbmcoKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBsZXQgZGF0ZU9iaiA9IGdkLmluZmVyRXZlbnREYXRlT2JqKCk7XG4gICAgbGV0IGRlYXRoRGF0ZU9iaiA9IGdkLmluZmVyRGVhdGhEYXRlT2JqKCk7XG4gICAgbGV0IHBsYWNlID0gZ2QuaW5mZXJGdWxsRXZlbnRQbGFjZSgpO1xuICAgIGxldCByZXNpZGVuY2VQbGFjZSA9IGdkLmluZmVyUmVzaWRlbmNlUGxhY2UoKTtcblxuICAgIGxldCBwb3NzZXNzaXZlTmFtZSA9IHRoaXMuZ2V0UG9zc2Vzc2l2ZU5hbWUoKTtcblxuICAgIGxldCByb2xlID0gZ2Qucm9sZTtcblxuICAgIGlmIChkZWF0aERhdGVPYmopIHtcbiAgICAgIGlmIChyb2xlICYmIHJvbGUgIT0gUm9sZS5QcmltYXJ5KSB7XG4gICAgICAgIGlmIChyb2xlID09IFJvbGUuQ2hpbGQpIHtcbiAgICAgICAgICB0aGlzLm5hcnJhdGl2ZSA9IHBvc3Nlc3NpdmVOYW1lICsgXCIgcGFyZW50IGRpZWRcIjtcbiAgICAgICAgfSBlbHNlIGlmIChyb2xlID09IFJvbGUuUGFyZW50KSB7XG4gICAgICAgICAgdGhpcy5uYXJyYXRpdmUgPSBwb3NzZXNzaXZlTmFtZSArIFwiIGNoaWxkIGRpZWRcIjtcbiAgICAgICAgfSBlbHNlIGlmIChyb2xlID09IFJvbGUuU3BvdXNlKSB7XG4gICAgICAgICAgdGhpcy5uYXJyYXRpdmUgPSBwb3NzZXNzaXZlTmFtZSArIFwiIHNwb3VzZSBkaWVkXCI7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMubmFycmF0aXZlICs9IHRoaXMuZ2V0UGVyc29uTmFtZU9yUHJvbm91bih0cnVlKTtcbiAgICAgICAgdGhpcy5uYXJyYXRpdmUgKz0gXCIgZGllZFwiO1xuICAgICAgfVxuXG4gICAgICBsZXQgaGFzUHJvYmF0ZURhdGUgPSBmYWxzZTtcbiAgICAgIGlmIChkYXRlT2JqKSB7XG4gICAgICAgIGlmIChkYXRlT2JqLmdldERhdGVTdHJpbmcoKSAhPSBkZWF0aERhdGVPYmouZ2V0RGF0ZVN0cmluZygpKSB7XG4gICAgICAgICAgLy8gdGhlcmUgaXMgYSBwcm9iYXRlIGRhdGUgKHByb2JhYmx5KVxuICAgICAgICAgIGhhc1Byb2JhdGVEYXRlID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICB0aGlzLm5hcnJhdGl2ZSArPSBcIiBcIiArIHRoaXMuZm9ybWF0RGF0ZU9iaihkZWF0aERhdGVPYmosIHRydWUpO1xuXG4gICAgICBsZXQgZGVhdGhQbGFjZSA9IGdkLmluZmVyRGVhdGhQbGFjZSgpO1xuXG4gICAgICBpZiAoZGVhdGhQbGFjZSkge1xuICAgICAgICB0aGlzLm5hcnJhdGl2ZSArPSBcIiBcIiArIHRoaXMuZ2V0UGxhY2VXaXRoUHJlcG9zaXRpb24oZGVhdGhQbGFjZSk7XG4gICAgICB9IGVsc2UgaWYgKHJlc2lkZW5jZVBsYWNlKSB7XG4gICAgICAgIHRoaXMubmFycmF0aXZlICs9IFwiIHJlc2lkaW5nIFwiICsgdGhpcy5nZXRQbGFjZVdpdGhQcmVwb3NpdGlvbihyZXNpZGVuY2VQbGFjZSk7XG4gICAgICB9IGVsc2UgaWYgKHBsYWNlICYmICFoYXNQcm9iYXRlRGF0ZSkge1xuICAgICAgICB0aGlzLm5hcnJhdGl2ZSArPSBcIiBcIiArIHRoaXMuZ2V0UGxhY2VXaXRoUHJlcG9zaXRpb24ocGxhY2UpO1xuICAgICAgfVxuXG4gICAgICBpZiAoaGFzUHJvYmF0ZURhdGUpIHtcbiAgICAgICAgdGhpcy5uYXJyYXRpdmUgKz0gXCIuIFwiICsgdGhpcy5nZXRQb3NzZXNzaXZlUHJvbm91bkluaXRpYWxDYXBzKCkgKyBcIiB3aWxsIHBhc3NlZCBwcm9iYXRlXCI7XG5cbiAgICAgICAgaWYgKGRhdGVPYmopIHtcbiAgICAgICAgICB0aGlzLm5hcnJhdGl2ZSArPSBcIiBcIiArIHRoaXMuZm9ybWF0RGF0ZU9iaihkYXRlT2JqLCB0cnVlKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAocGxhY2UpIHtcbiAgICAgICAgICB0aGlzLm5hcnJhdGl2ZSArPSBcIiBcIiArIHRoaXMuZ2V0UGxhY2VXaXRoUHJlcG9zaXRpb24ocGxhY2UpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmIChyb2xlICYmIHJvbGUgIT0gUm9sZS5QcmltYXJ5KSB7XG4gICAgICAgIGlmIChyb2xlID09IFJvbGUuQ2hpbGQpIHtcbiAgICAgICAgICB0aGlzLm5hcnJhdGl2ZSA9IHBvc3Nlc3NpdmVOYW1lICsgXCIgcGFyZW50J3Mgd2lsbCBwYXNzZWQgcHJvYmF0ZVwiO1xuICAgICAgICB9IGVsc2UgaWYgKHJvbGUgPT0gUm9sZS5QYXJlbnQpIHtcbiAgICAgICAgICB0aGlzLm5hcnJhdGl2ZSA9IHBvc3Nlc3NpdmVOYW1lICsgXCIgY2hpbGQncyB3aWxsIHBhc3NlZCBwcm9iYXRlXCI7XG4gICAgICAgIH0gZWxzZSBpZiAocm9sZSA9PSBSb2xlLlNwb3VzZSkge1xuICAgICAgICAgIHRoaXMubmFycmF0aXZlID0gcG9zc2Vzc2l2ZU5hbWUgKyBcIiBzcG91c2UncyB3aWxsIHBhc3NlZCBwcm9iYXRlXCI7XG4gICAgICAgIH0gZWxzZSBpZiAocm9sZSA9PSBSb2xlLldpdG5lc3MpIHtcbiAgICAgICAgICB0aGlzLm5hcnJhdGl2ZSA9IHRoaXMuZ2V0UGVyc29uTmFtZU9yUHJvbm91bigpICsgXCIgd2l0bmVzc2VkIGEgd2lsbCB0aGF0IHBhc3NlZCBwcm9iYXRlXCI7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMubmFycmF0aXZlID0gcG9zc2Vzc2l2ZU5hbWUgKyBcIiB3aWxsIHBhc3NlZCBwcm9iYXRlXCI7XG4gICAgICB9XG5cbiAgICAgIGlmIChkYXRlT2JqKSB7XG4gICAgICAgIHRoaXMubmFycmF0aXZlICs9IFwiIFwiICsgdGhpcy5mb3JtYXREYXRlT2JqKGRhdGVPYmosIHRydWUpO1xuICAgICAgfVxuICAgICAgaWYgKHBsYWNlKSB7XG4gICAgICAgIHRoaXMubmFycmF0aXZlICs9IFwiIFwiICsgdGhpcy5nZXRQbGFjZVdpdGhQcmVwb3NpdGlvbihwbGFjZSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgdGhpcy5uYXJyYXRpdmUgKz0gXCIuXCI7XG4gIH1cblxuICBidWlsZERpdm9yY2VTdHJpbmcoKSB7XG4gICAgbGV0IGRhdGVPYmogPSB0aGlzLmV2ZW50R2QuaW5mZXJFdmVudERhdGVPYmooKTtcbiAgICBsZXQgcGxhY2UgPSB0aGlzLmV2ZW50R2QuaW5mZXJGdWxsRXZlbnRQbGFjZSgpO1xuXG4gICAgdGhpcy5uYXJyYXRpdmUgPSB0aGlzLmdldFBlcnNvbk5hbWVPclByb25vdW4oKTtcblxuICAgIGxldCBzcG91c2VOYW1lID0gXCJcIjtcbiAgICBpZiAodGhpcy5ldmVudEdkLnNwb3VzZXMgJiYgdGhpcy5ldmVudEdkLnNwb3VzZXMubGVuZ3RoID09IDEpIHtcbiAgICAgIGxldCBzcG91c2UgPSB0aGlzLmV2ZW50R2Quc3BvdXNlc1swXTtcbiAgICAgIGlmIChzcG91c2UubmFtZSkge1xuICAgICAgICBzcG91c2VOYW1lID0gc3BvdXNlLm5hbWUuaW5mZXJGdWxsTmFtZSgpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChzcG91c2VOYW1lKSB7XG4gICAgICBzcG91c2VOYW1lID0gV1RTX1N0cmluZy50b0luaXRpYWxDYXBzRWFjaFdvcmQoc3BvdXNlTmFtZSwgdHJ1ZSk7XG5cbiAgICAgIHRoaXMubmFycmF0aXZlICs9IFwiIHdhcyBkaXZvcmNlZCBmcm9tIFwiICsgc3BvdXNlTmFtZTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5uYXJyYXRpdmUgKz0gXCIgd2FzIGluIGEgZGl2b3JjZSByZWNvcmRcIjtcbiAgICB9XG5cbiAgICBpZiAoZGF0ZU9iaikge1xuICAgICAgdGhpcy5uYXJyYXRpdmUgKz0gXCIgXCIgKyB0aGlzLmZvcm1hdERhdGVPYmooZGF0ZU9iaiwgdHJ1ZSk7XG4gICAgfVxuICAgIGlmIChwbGFjZSkge1xuICAgICAgdGhpcy5uYXJyYXRpdmUgKz0gXCIgXCIgKyB0aGlzLmdldFBsYWNlV2l0aFByZXBvc2l0aW9uKHBsYWNlKTtcbiAgICB9XG4gICAgdGhpcy5uYXJyYXRpdmUgKz0gXCIuXCI7XG4gIH1cblxuICBidWlsZE1pbGl0YXJ5U3RyaW5nKCkge1xuICAgIGxldCBldmVudERhdGUgPSB0aGlzLmV2ZW50R2QuaW5mZXJFdmVudERhdGUoKTtcbiAgICBsZXQgZGVhdGhEYXRlID0gdGhpcy5ldmVudEdkLmluZmVyRGVhdGhEYXRlKCk7XG4gICAgbGV0IHBsYWNlID0gdGhpcy5ldmVudEdkLmluZmVyRnVsbEV2ZW50UGxhY2UoKTtcbiAgICB0aGlzLm9wdGlvbnNTdWJjYXRlZ29yeSA9IFwibWlsaXRhcnlcIjtcblxuICAgIHRoaXMubmFycmF0aXZlID0gdGhpcy5nZXRQZXJzb25OYW1lT3JQcm9ub3VuKCk7XG4gICAgaWYgKGRlYXRoRGF0ZSkge1xuICAgICAgbGV0IGJyYW5jaCA9IHRoaXMuZXZlbnRHZC5taWxpdGFyeUJyYW5jaDtcbiAgICAgIGlmICghYnJhbmNoKSB7XG4gICAgICAgIGlmICh0aGlzLmV2ZW50R2QubWlsaXRhcnlSZWdpbWVudCkge1xuICAgICAgICAgIGJyYW5jaCA9IHRoaXMuZXZlbnRHZC5taWxpdGFyeVJlZ2ltZW50O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGJyYW5jaCA9IFwibWlsaXRhcnlcIjtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgYnJhbmNoID0gYnJhbmNoLnRvTG93ZXJDYXNlKCk7XG4gICAgICB9XG4gICAgICB0aGlzLm5hcnJhdGl2ZSArPSBcIiB3YXMgaW4gdGhlIFwiICsgYnJhbmNoICsgXCIgYW5kIGRpZWRcIjtcbiAgICAgIHRoaXMubmFycmF0aXZlICs9IFwiIFwiICsgdGhpcy5mb3JtYXREYXRlKGRlYXRoRGF0ZSwgdHJ1ZSk7XG5cbiAgICAgIGxldCBkZWF0aFBsYWNlID0gdGhpcy5ldmVudEdkLmluZmVyRGVhdGhQbGFjZSgpO1xuICAgICAgaWYgKGRlYXRoUGxhY2UpIHtcbiAgICAgICAgcGxhY2UgPSBkZWF0aFBsYWNlO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLm5hcnJhdGl2ZSArPSBcIiB3YXMgaW4gYSBtaWxpdGFyeSByZWNvcmRcIjtcbiAgICAgIGlmIChldmVudERhdGUpIHtcbiAgICAgICAgdGhpcy5uYXJyYXRpdmUgKz0gXCIgXCIgKyB0aGlzLmZvcm1hdERhdGUoZXZlbnREYXRlLCB0cnVlKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAocGxhY2UpIHtcbiAgICAgIHRoaXMubmFycmF0aXZlICs9IFwiIFwiICsgdGhpcy5nZXRQbGFjZVdpdGhQcmVwb3NpdGlvbihwbGFjZSk7XG4gICAgfVxuICAgIHRoaXMubmFycmF0aXZlICs9IFwiLlwiO1xuXG4gICAgbGV0IG51bWJlciA9IHRoaXMuZXZlbnRHZC5zZXJ2aWNlTnVtYmVyO1xuICAgIGxldCB1bml0ID0gdGhpcy5ldmVudEdkLnVuaXQ7XG4gICAgaWYgKHVuaXQpIHtcbiAgICAgIHRoaXMubmFycmF0aXZlICs9IFwiIFwiICsgdGhpcy5nZXRQcm9ub3VuQW5kUGFzdFRlbnNlSW5pdGlhbENhcHMoKSArIFwiIGluIHRoZSBcIiArIHVuaXQ7XG4gICAgICBpZiAobnVtYmVyKSB7XG4gICAgICAgIHRoaXMubmFycmF0aXZlICs9IFwiIChzZXJ2aWNlIG51bWJlciBcIiArIG51bWJlciArIFwiKVwiO1xuICAgICAgfVxuICAgICAgdGhpcy5uYXJyYXRpdmUgKz0gXCIuXCI7XG4gICAgfSBlbHNlIGlmIChudW1iZXIpIHtcbiAgICAgIHRoaXMubmFycmF0aXZlICs9IFwiIFwiICsgdGhpcy5nZXRQb3NzZXNzaXZlUHJvbm91bkluaXRpYWxDYXBzKCkgKyBcIiBzZXJ2aWNlIG51bWJlciB3YXMgXCIgKyBudW1iZXIgKyBcIi5cIjtcbiAgICB9XG4gIH1cblxuICBidWlsZFBhc3Nlbmdlckxpc3RTdHJpbmcoKSB7XG4gICAgdGhpcy5vcHRpb25zU3ViY2F0ZWdvcnkgPSBcInBhc3Nlbmdlckxpc3RcIjtcblxuICAgIGxldCBldmVudERhdGUgPSB0aGlzLmV2ZW50R2QuaW5mZXJFdmVudERhdGUoKTtcbiAgICBsZXQgZXZlbnRQbGFjZSA9IHRoaXMuZXZlbnRHZC5pbmZlckZ1bGxFdmVudFBsYWNlKCk7XG5cbiAgICBsZXQgYXJyaXZhbERhdGUgPSB0aGlzLmV2ZW50R2QuYXJyaXZhbERhdGU7XG4gICAgbGV0IGFycml2YWxQbGFjZSA9IHRoaXMuZXZlbnRHZC5hcnJpdmFsUGxhY2U7XG4gICAgbGV0IGRlcGFydHVyZURhdGUgPSB0aGlzLmV2ZW50R2QuZGVwYXJ0dXJlRGF0ZTtcbiAgICBsZXQgZGVwYXJ0dXJlUGxhY2UgPSB0aGlzLmV2ZW50R2QuZGVwYXJ0dXJlUGxhY2U7XG5cbiAgICBsZXQgaXNBcnJpdmFsID0gZmFsc2U7XG4gICAgbGV0IGlzRGVwYXJ0dXJlID0gZmFsc2U7XG4gICAgaWYgKGV2ZW50RGF0ZSkge1xuICAgICAgaWYgKGFycml2YWxEYXRlICYmIGFycml2YWxEYXRlID09IGV2ZW50RGF0ZSkge1xuICAgICAgICBpc0Fycml2YWwgPSB0cnVlO1xuICAgICAgfSBlbHNlIGlmIChkZXBhcnR1cmVEYXRlICYmIGRlcGFydHVyZURhdGUgPT0gZXZlbnREYXRlKSB7XG4gICAgICAgIGlzRGVwYXJ0dXJlID0gdHJ1ZTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoaXNBcnJpdmFsKSB7XG4gICAgICB0aGlzLm5hcnJhdGl2ZSA9IHRoaXMuZ2V0UGVyc29uTmFtZU9yUHJvbm91bigpICsgXCIgYXJyaXZlZFwiO1xuXG4gICAgICBpZiAodGhpcy5ldmVudEdkLnNoaXBOYW1lKSB7XG4gICAgICAgIHRoaXMubmFycmF0aXZlICs9IFwiIG9uIHRoZSBzaGlwIFwiICsgdGhpcy5ldmVudEdkLnNoaXBOYW1lO1xuICAgICAgfVxuXG4gICAgICBpZiAoYXJyaXZhbERhdGUpIHtcbiAgICAgICAgdGhpcy5uYXJyYXRpdmUgKz0gXCIgXCIgKyB0aGlzLmZvcm1hdERhdGUoYXJyaXZhbERhdGUsIHRydWUpO1xuICAgICAgfVxuXG4gICAgICBpZiAoYXJyaXZhbFBsYWNlKSB7XG4gICAgICAgIHRoaXMubmFycmF0aXZlICs9IFwiIFwiICsgdGhpcy5nZXRQbGFjZVdpdGhQcmVwb3NpdGlvbihhcnJpdmFsUGxhY2UpO1xuICAgICAgfVxuXG4gICAgICBpZiAoZGVwYXJ0dXJlUGxhY2UpIHtcbiAgICAgICAgdGhpcy5uYXJyYXRpdmUgKz0gXCIgaGF2aW5nIGRlcGFydGVkIGZyb20gXCIgKyBkZXBhcnR1cmVQbGFjZTtcbiAgICAgICAgaWYgKGRlcGFydHVyZURhdGUpIHtcbiAgICAgICAgICB0aGlzLm5hcnJhdGl2ZSArPSBcIiBcIiArIHRoaXMuZm9ybWF0RGF0ZShkZXBhcnR1cmVEYXRlLCB0cnVlKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoaXNEZXBhcnR1cmUpIHtcbiAgICAgIHRoaXMubmFycmF0aXZlID0gdGhpcy5nZXRQZXJzb25OYW1lT3JQcm9ub3VuKCkgKyBcIiBkZXBhcnRlZFwiO1xuXG4gICAgICBpZiAoZGVwYXJ0dXJlUGxhY2UpIHtcbiAgICAgICAgdGhpcy5uYXJyYXRpdmUgKz0gXCIgZnJvbSBcIiArIGRlcGFydHVyZVBsYWNlO1xuICAgICAgfVxuXG4gICAgICBpZiAodGhpcy5ldmVudEdkLnNoaXBOYW1lKSB7XG4gICAgICAgIHRoaXMubmFycmF0aXZlICs9IFwiIG9uIHRoZSBzaGlwIFwiICsgdGhpcy5ldmVudEdkLnNoaXBOYW1lO1xuICAgICAgfVxuXG4gICAgICBpZiAoZGVwYXJ0dXJlRGF0ZSkge1xuICAgICAgICB0aGlzLm5hcnJhdGl2ZSArPSBcIiBcIiArIHRoaXMuZm9ybWF0RGF0ZShkZXBhcnR1cmVEYXRlLCB0cnVlKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5uYXJyYXRpdmUgPSB0aGlzLmdldFBlcnNvbk5hbWVPclByb25vdW4oKSArIFwiIHdhcyBhIHBhc3NlbmdlclwiO1xuXG4gICAgICBpZiAodGhpcy5ldmVudEdkLnNoaXBOYW1lKSB7XG4gICAgICAgIHRoaXMubmFycmF0aXZlICs9IFwiIG9uIHRoZSBzaGlwIFwiICsgdGhpcy5ldmVudEdkLnNoaXBOYW1lO1xuICAgICAgfVxuXG4gICAgICBpZiAoZXZlbnREYXRlKSB7XG4gICAgICAgIHRoaXMubmFycmF0aXZlICs9IFwiIFwiICsgdGhpcy5mb3JtYXREYXRlKGV2ZW50RGF0ZSwgdHJ1ZSk7XG4gICAgICB9XG5cbiAgICAgIGlmIChldmVudFBsYWNlKSB7XG4gICAgICAgIHRoaXMubmFycmF0aXZlICs9IFwiIFwiICsgdGhpcy5nZXRQbGFjZVdpdGhQcmVwb3NpdGlvbihldmVudFBsYWNlKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBidWlsZERlZmF1bHRTdHJpbmcoKSB7XG4gICAgY29uc3QgbmFycmF0aXZlcyA9IFtcbiAgICAgIHtcbiAgICAgICAgcmVjb3JkVHlwZTogUlQuTm9ucG9wdWxhdGlvbkNlbnN1cyxcbiAgICAgICAgc3RyaW5nOiBcIndhcyBlbnVtZXJhdGVkIGluIGEgbm9uLXBvcHVsYXRpb24gc2NoZWR1bGVcIixcbiAgICAgIH0sXG4gICAgICB7IHJlY29yZFR5cGU6IFJULkVsZWN0b3JhbFJlZ2lzdGVyLCBzdHJpbmc6IFwid2FzIHJlZ2lzdGVyZWQgdG8gdm90ZVwiIH0sXG4gICAgICB7IHJlY29yZFR5cGU6IFJULkNyaW1pbmFsUmVnaXN0ZXIsIHN0cmluZzogXCJ3YXMgaW4gYSBjcmltaW5hbCByZWdpc3RlclwiIH0sXG4gICAgICB7IHJlY29yZFR5cGU6IFJULkZyZWVtYXNvbk1lbWJlcnNoaXAsIHN0cmluZzogXCJ3YXMgYSBmcmVlbWFzb25cIiB9LFxuICAgICAgeyByZWNvcmRUeXBlOiBSVC5DZXJ0aWZpY2F0ZSwgc3RyaW5nOiBcIndhcyBpc3N1ZWQgYSBjZXJ0aWZpY2F0ZVwiIH0sXG4gICAgICB7IHJlY29yZFR5cGU6IFJULkRpcmVjdG9yeSwgc3RyaW5nOiBcIndhcyBpbiBhIGRpcmVjdG9yeVwiIH0sXG4gICAgICB7IHJlY29yZFR5cGU6IFJULkVtcGxveW1lbnQsIHN0cmluZzogXCJ3YXMgZW1wbG95ZWRcIiB9LFxuICAgICAgeyByZWNvcmRUeXBlOiBSVC5Xb3JraG91c2VSZWNvcmQsIHN0cmluZzogXCJ3YXMgaW4gYSB3b3JraG91c2UgcmVjb3JkXCIgfSxcbiAgICAgIHsgcmVjb3JkVHlwZTogUlQuQ3Jld0xpc3QsIHN0cmluZzogXCJ3YXMgaW4gYSBjcmV3XCIgfSxcbiAgICAgIHsgcmVjb3JkVHlwZTogUlQuQ29udmljdFRyYW5zcG9ydGF0aW9uLCBzdHJpbmc6IFwid2FzIHRyYW5zcG9ydGVkXCIgfSxcbiAgICAgIHsgcmVjb3JkVHlwZTogUlQuTWVkaWNhbFBhdGllbnQsIHN0cmluZzogXCJ3YXMgYSBwYXRpZW50XCIgfSxcbiAgICAgIHsgcmVjb3JkVHlwZTogUlQuUXVhcnRlclNlc3Npb24sIHN0cmluZzogXCJ3YXMgaW4gcXVhcnRlciBzZXNzaW9uXCIgfSxcbiAgICAgIHsgcmVjb3JkVHlwZTogUlQuVGF4LCBzdHJpbmc6IFwid2FzIGluIGEgdGF4IHJlY29yZFwiIH0sXG4gICAgICB7IHJlY29yZFR5cGU6IFJULlZhbHVhdGlvblJvbGwsIHN0cmluZzogXCJ3YXMgaW4gYSB2YWx1YXRpb24gcm9sbFwiIH0sXG4gICAgICB7IHJlY29yZFR5cGU6IFJULkxhbmRUYXgsIHN0cmluZzogXCJ3YXMgaW4gYSBsYW5kIHRheCByZWNvcmRcIiB9LFxuICAgICAgeyByZWNvcmRUeXBlOiBSVC5BcHByZW50aWNlc2hpcCwgc3RyaW5nOiBcIndhcyBhIG1hc3RlciBvciBhcHByZW50aWNlXCIgfSxcbiAgICAgIHtcbiAgICAgICAgcmVjb3JkVHlwZTogUlQuU29jaWFsU2VjdXJpdHksXG4gICAgICAgIHN0cmluZzogXCJ3YXMgaW4gYSBTb2NpYWwgU2VjdXJpdHkgcmVjb3JkXCIsXG4gICAgICB9LFxuICAgICAgeyByZWNvcmRUeXBlOiBSVC5TY2hvb2xSZWNvcmRzLCBzdHJpbmc6IFwid2FzIGF0IHNjaG9vbFwiIH0sXG4gICAgICB7IHJlY29yZFR5cGU6IFJULlJlc2lkZW5jZSwgc3RyaW5nOiBcIndhcyByZWNvcmRlZCBhcyBhIHJlc2lkZW50XCIgfSxcbiAgICAgIHsgcmVjb3JkVHlwZTogUlQuSW1taWdyYXRpb24sIHN0cmluZzogXCJpbW1pZ3JhdGVkXCIgfSxcbiAgICAgIHsgcmVjb3JkVHlwZTogUlQuRW1pZ3JhdGlvbiwgc3RyaW5nOiBcImVtaWdyYXRlZFwiIH0sXG4gICAgICB7IHJlY29yZFR5cGU6IFJULlBlbnNpb24sIHN0cmluZzogXCJ3YXMgaW4gYSBwZW5zaW9uIHJlY29yZFwiIH0sXG4gICAgICB7IHJlY29yZFR5cGU6IFJULlBhc3Nwb3J0QXBwbGljYXRpb24sIHN0cmluZzogXCJhcHBsaWVkIGZvciBhIHBhc3Nwb3J0XCIgfSxcbiAgICAgIHsgcmVjb3JkVHlwZTogUlQuTmV3c3BhcGVyLCBzdHJpbmc6IFwid2FzIGluIGEgbmV3c3BhcGVyXCIgfSxcbiAgICAgIHsgcmVjb3JkVHlwZTogUlQuTGVnYWxSZWNvcmQsIHN0cmluZzogXCJ3YXMgaW4gYSBsZWdhbCByZWNvcmRcIiB9LFxuICAgICAgeyByZWNvcmRUeXBlOiBSVC5SYXRlQm9vaywgc3RyaW5nOiBcIndhcyBpbiBhIHJhdGUgYm9va1wiIH0sXG4gICAgICB7XG4gICAgICAgIHJlY29yZFR5cGU6IFJULkZhbUhpc3RPclBlZGlncmVlLFxuICAgICAgICBzdHJpbmc6IFwid2FzIGluIGEgZmFtaWx5IGhpc3Rvcnkgb3IgcGVkaWdyZWVcIixcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIHJlY29yZFR5cGU6IFJULk5hdHVyYWxpemF0aW9uLFxuICAgICAgICBzdHJpbmc6IFwid2FzIGluIGEgbmF0dXJhbGl6YXRpb24gcmVjb3JkXCIsXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICByZWNvcmRUeXBlOiBSVC5PdGhlckNodXJjaEV2ZW50LFxuICAgICAgICBzdHJpbmc6IFwid2FzIHJlY29yZGVkIGluIGEgY2h1cmNoIGV2ZW50XCIsXG4gICAgICB9LFxuICAgICAgeyByZWNvcmRUeXBlOiBSVC5IZXJhbGRyeSwgc3RyaW5nOiBcIndhcyBpbiBhIGhlcmFsZGljIHJlY29yZFwiIH0sXG4gICAgXTtcblxuICAgIGxldCBnZCA9IHRoaXMuZXZlbnRHZDtcblxuICAgIGxldCBuYXJyYXRpdmVDb3JlID0gXCJ3YXMgaW4gYSByZWNvcmRcIjtcbiAgICBmb3IgKGxldCBlbnRyeSBvZiBuYXJyYXRpdmVzKSB7XG4gICAgICBpZiAoZW50cnkucmVjb3JkVHlwZSA9PSBnZC5yZWNvcmRUeXBlKSB7XG4gICAgICAgIG5hcnJhdGl2ZUNvcmUgPSBlbnRyeS5zdHJpbmc7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH1cblxuICAgIGxldCBkYXRlT2JqID0gZ2QuaW5mZXJFdmVudERhdGVPYmooKTtcbiAgICBsZXQgcGxhY2UgPSBnZC5pbmZlckZ1bGxFdmVudFBsYWNlKCk7XG5cbiAgICBpZiAoZ2Qucm9sZSAmJiBnZC5yb2xlID09IFJvbGUuUGFyZW50KSB7XG4gICAgICB0aGlzLm5hcnJhdGl2ZSArPSB0aGlzLmdldFBvc3Nlc3NpdmVOYW1lUGx1c0NoaWxkKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMubmFycmF0aXZlICs9IHRoaXMuZ2V0UGVyc29uTmFtZU9yUHJvbm91bigpO1xuICAgIH1cblxuICAgIHRoaXMubmFycmF0aXZlICs9IFwiIFwiICsgbmFycmF0aXZlQ29yZTtcbiAgICBpZiAoZGF0ZU9iaikge1xuICAgICAgbGV0IGZvcm1hdHRlZERhdGUgPSB0aGlzLmZvcm1hdERhdGVPYmooZGF0ZU9iaiwgdHJ1ZSk7XG4gICAgICBpZiAoZm9ybWF0dGVkRGF0ZSkge1xuICAgICAgICB0aGlzLm5hcnJhdGl2ZSArPSBcIiBcIiArIGZvcm1hdHRlZERhdGU7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKHBsYWNlKSB7XG4gICAgICB0aGlzLm5hcnJhdGl2ZSArPSBcIiBcIiArIHRoaXMuZ2V0UGxhY2VXaXRoUHJlcG9zaXRpb24ocGxhY2UpO1xuICAgIH1cblxuICAgIHRoaXMubmFycmF0aXZlICs9IFwiLlwiO1xuICB9XG5cbiAgYnVpbGROYXJyYXRpdmVTdHJpbmcoKSB7XG4gICAgLy8gVGhlIHByb2JsZW0gd2l0aCB1c2luZyBhcG9zdHJvcGhlIGFmdGVyIHRoZSBuYW1lIGlzIHRoYXQgdGhlcmUgYXJlIHJ1bGVzIGZvciB3aGVuIHRoZSBuYW1lXG4gICAgLy8gZW5kcyBpbiBzLiBJZiB3ZSBhcmUgZ29pbmcgdG8gc3Vic3RpdHV0ZSB0aGUgcHJlZiBuYW1lIG9uIGluc2VydGlvbiB0aGVuIHdlIGRvIG5vdCBrbm93IHdoZXRoZXJcbiAgICAvLyBpdCBlbmRzIGluIHMuIFRoZXJlIGNvdWxkIGJlIGEgc3BlY2lhbCBjb2RlIGxpa2Uge3ByZWZOYW1lfSB2cyB7cHJlZk5hbWVQb3NzZXNzaXZlfVxuXG4gICAgdGhpcy5uYXJyYXRpdmUgPSBcIlwiO1xuXG4gICAgc3dpdGNoICh0aGlzLmV2ZW50R2QucmVjb3JkVHlwZSkge1xuICAgICAgY2FzZSBSVC5CaXJ0aFJlZ2lzdHJhdGlvbjoge1xuICAgICAgICB0aGlzLmJ1aWxkQmlydGhSZWdpc3RyYXRpb25TdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBjYXNlIFJULkJpcnRoOiB7XG4gICAgICAgIHRoaXMuYnVpbGRCaXJ0aFN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIGNhc2UgUlQuRGVhdGhSZWdpc3RyYXRpb246IHtcbiAgICAgICAgdGhpcy5idWlsZERlYXRoUmVnaXN0cmF0aW9uU3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgY2FzZSBSVC5EZWF0aDoge1xuICAgICAgICB0aGlzLmJ1aWxkRGVhdGhTdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBjYXNlIFJULk1hcnJpYWdlUmVnaXN0cmF0aW9uOiB7XG4gICAgICAgIHRoaXMuYnVpbGRNYXJyaWFnZVJlZ2lzdHJhdGlvblN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIGNhc2UgUlQuQmFwdGlzbToge1xuICAgICAgICB0aGlzLmJ1aWxkQmFwdGlzbVN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIGNhc2UgUlQuTWFycmlhZ2U6IHtcbiAgICAgICAgdGhpcy5idWlsZE1hcnJpYWdlU3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgY2FzZSBSVC5CdXJpYWw6XG4gICAgICBjYXNlIFJULkRlYXRoT3JCdXJpYWw6IHtcbiAgICAgICAgdGhpcy5idWlsZEJ1cmlhbFN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIGNhc2UgUlQuQ3JlbWF0aW9uOiB7XG4gICAgICAgIHRoaXMuYnVpbGRDcmVtYXRpb25TdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBjYXNlIFJULk1lbW9yaWFsOiB7XG4gICAgICAgIHRoaXMuYnVpbGRNZW1vcmlhbFN0cmluZygpO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIGNhc2UgUlQuT2JpdHVhcnk6IHtcbiAgICAgICAgdGhpcy5idWlsZE9iaXR1YXJ5U3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgY2FzZSBSVC5CaXJ0aE9yQmFwdGlzbToge1xuICAgICAgICB0aGlzLmJ1aWxkQmlydGhPckJhcHRpc21TdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBjYXNlIFJULkNlbnN1czoge1xuICAgICAgICB0aGlzLmJ1aWxkQ2Vuc3VzU3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgY2FzZSBSVC5Qcm9iYXRlOiB7XG4gICAgICAgIHRoaXMuYnVpbGRQcm9iYXRlU3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgY2FzZSBSVC5XaWxsOiB7XG4gICAgICAgIHRoaXMuYnVpbGRXaWxsU3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgY2FzZSBSVC5EaXZvcmNlOiB7XG4gICAgICAgIHRoaXMuYnVpbGREaXZvcmNlU3RyaW5nKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgY2FzZSBSVC5NaWxpdGFyeToge1xuICAgICAgICB0aGlzLmJ1aWxkTWlsaXRhcnlTdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBjYXNlIFJULlBhc3Nlbmdlckxpc3Q6IHtcbiAgICAgICAgdGhpcy5idWlsZFBhc3Nlbmdlckxpc3RTdHJpbmcoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKCF0aGlzLm5hcnJhdGl2ZSkge1xuICAgICAgdGhpcy5idWlsZERlZmF1bHRTdHJpbmcoKTtcbiAgICB9XG4gIH1cbn1cblxuZnVuY3Rpb24gYnVpbGROYXJyYXRpdmUoaW5wdXQpIHtcbiAgaWYgKCFpbnB1dCB8fCAhaW5wdXQuZXZlbnRHZW5lcmFsaXplZERhdGEpIHtcbiAgICByZXR1cm4gXCJcIjtcbiAgfVxuXG4gIGxldCBldmVudEdkID0gaW5wdXQuZXZlbnRHZW5lcmFsaXplZERhdGE7XG4gIGxldCBvcHRpb25zID0gaW5wdXQub3B0aW9ucztcblxuICAvL2NvbnNvbGUubG9nKFwiYnVpbGROYXJyYXRpdmU6IGV2ZW50R2QgaXNcIik7XG4gIC8vY29uc29sZS5sb2coZXZlbnRHZCk7XG5cbiAgbGV0IGV2ZW50R2VuZXJhbGl6ZWREYXRhID0gR2VuZXJhbGl6ZWREYXRhLmNyZWF0ZUZyb21QbGFpbk9iamVjdChldmVudEdkKTtcbiAgbGV0IHd0R2VuZXJhbGl6ZWREYXRhID0gR2VuZXJhbGl6ZWREYXRhLmNyZWF0ZUZyb21QbGFpbk9iamVjdChpbnB1dC53dEdlbmVyYWxpemVkRGF0YSk7XG5cbiAgbGV0IGJ1aWxkZXIgPSBuZXcgTmFycmF0aXZlQnVpbGRlcihvcHRpb25zKTtcbiAgYnVpbGRlci5wcm9maWxlR2QgPSB3dEdlbmVyYWxpemVkRGF0YTtcbiAgYnVpbGRlci5ldmVudEdkID0gZXZlbnRHZW5lcmFsaXplZERhdGE7XG5cbiAgaWYgKHd0R2VuZXJhbGl6ZWREYXRhICYmIHd0R2VuZXJhbGl6ZWREYXRhLnBlcnNvbkdlbmRlcikge1xuICAgIGJ1aWxkZXIucGVyc29uR2VuZGVyID0gd3RHZW5lcmFsaXplZERhdGEucGVyc29uR2VuZGVyO1xuICB9IGVsc2UgaWYgKGV2ZW50R2VuZXJhbGl6ZWREYXRhLnBlcnNvbkdlbmRlcikge1xuICAgIGJ1aWxkZXIucGVyc29uR2VuZGVyID0gZXZlbnRHZW5lcmFsaXplZERhdGEucGVyc29uR2VuZGVyO1xuICB9XG5cbiAgYnVpbGRlci5idWlsZE5hcnJhdGl2ZVN0cmluZygpO1xuXG4gIHJldHVybiBidWlsZGVyLm5hcnJhdGl2ZTtcbn1cblxuZXhwb3J0IHsgTmFycmF0aXZlQnVpbGRlciwgYnVpbGROYXJyYXRpdmUgfTtcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./extension/base/core/narrative_builder.mjs\n");

/***/ }),

/***/ "./extension/base/core/narrative_or_sentence_utils.mjs":
/*!*************************************************************!*\
  !*** ./extension/base/core/narrative_or_sentence_utils.mjs ***!
  \*************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"getChildTerm\": () => (/* binding */ getChildTerm),\n/* harmony export */   \"getParentTerm\": () => (/* binding */ getParentTerm),\n/* harmony export */   \"getPrimaryPersonChildTerm\": () => (/* binding */ getPrimaryPersonChildTerm),\n/* harmony export */   \"getPrimaryPersonParentTerm\": () => (/* binding */ getPrimaryPersonParentTerm),\n/* harmony export */   \"getPrimaryPersonSpouseTerm\": () => (/* binding */ getPrimaryPersonSpouseTerm),\n/* harmony export */   \"getSpouseTerm\": () => (/* binding */ getSpouseTerm)\n/* harmony export */ });\n/*\nMIT License\n\nCopyright (c) 2020 Robert M Pavey\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.\n*/\n\nfunction getChildTerm(gender) {\n  if (!gender) {\n    return \"child\";\n  } else if (gender == \"male\") {\n    return \"son\";\n  } else if (gender == \"female\") {\n    return \"daughter\";\n  }\n}\n\nfunction getPrimaryPersonChildTerm(gd) {\n  return getChildTerm(gd.primaryPersonGender);\n}\n\nfunction getParentTerm(gender) {\n  if (!gender) {\n    return \"parent\";\n  } else if (gender == \"male\") {\n    return \"father\";\n  } else if (gender == \"female\") {\n    return \"mother\";\n  }\n}\n\nfunction getPrimaryPersonParentTerm(gd) {\n  return getParentTerm(gd.primaryPersonGender);\n}\n\nfunction getSpouseTerm(gender) {\n  if (!gender) {\n    return \"spouse\";\n  } else if (gender == \"male\") {\n    return \"husband\";\n  } else if (gender == \"female\") {\n    return \"wife\";\n  }\n}\n\nfunction getPrimaryPersonSpouseTerm(gd) {\n  return getSpouseTerm(gd.primaryPersonGender);\n}\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9leHRlbnNpb24vYmFzZS9jb3JlL25hcnJhdGl2ZV9vcl9zZW50ZW5jZV91dGlscy5tanMuanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQVNFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vQ2l0YXRpb25FeHRyYWN0b3IvLi9leHRlbnNpb24vYmFzZS9jb3JlL25hcnJhdGl2ZV9vcl9zZW50ZW5jZV91dGlscy5tanM/YzZhOSJdLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuTUlUIExpY2Vuc2VcblxuQ29weXJpZ2h0IChjKSAyMDIwIFJvYmVydCBNIFBhdmV5XG5cblBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHlcbm9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlIFwiU29mdHdhcmVcIiksIHRvIGRlYWxcbmluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHNcbnRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGxcbmNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQgcGVyc29ucyB0byB3aG9tIHRoZSBTb2Z0d2FyZSBpc1xuZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczpcblxuVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW4gYWxsXG5jb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLlxuXG5USEUgU09GVFdBUkUgSVMgUFJPVklERUQgXCJBUyBJU1wiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SXG5JTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSxcbkZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRVxuQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUlxuTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSxcbk9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4gVEhFXG5TT0ZUV0FSRS5cbiovXG5cbmZ1bmN0aW9uIGdldENoaWxkVGVybShnZW5kZXIpIHtcbiAgaWYgKCFnZW5kZXIpIHtcbiAgICByZXR1cm4gXCJjaGlsZFwiO1xuICB9IGVsc2UgaWYgKGdlbmRlciA9PSBcIm1hbGVcIikge1xuICAgIHJldHVybiBcInNvblwiO1xuICB9IGVsc2UgaWYgKGdlbmRlciA9PSBcImZlbWFsZVwiKSB7XG4gICAgcmV0dXJuIFwiZGF1Z2h0ZXJcIjtcbiAgfVxufVxuXG5mdW5jdGlvbiBnZXRQcmltYXJ5UGVyc29uQ2hpbGRUZXJtKGdkKSB7XG4gIHJldHVybiBnZXRDaGlsZFRlcm0oZ2QucHJpbWFyeVBlcnNvbkdlbmRlcik7XG59XG5cbmZ1bmN0aW9uIGdldFBhcmVudFRlcm0oZ2VuZGVyKSB7XG4gIGlmICghZ2VuZGVyKSB7XG4gICAgcmV0dXJuIFwicGFyZW50XCI7XG4gIH0gZWxzZSBpZiAoZ2VuZGVyID09IFwibWFsZVwiKSB7XG4gICAgcmV0dXJuIFwiZmF0aGVyXCI7XG4gIH0gZWxzZSBpZiAoZ2VuZGVyID09IFwiZmVtYWxlXCIpIHtcbiAgICByZXR1cm4gXCJtb3RoZXJcIjtcbiAgfVxufVxuXG5mdW5jdGlvbiBnZXRQcmltYXJ5UGVyc29uUGFyZW50VGVybShnZCkge1xuICByZXR1cm4gZ2V0UGFyZW50VGVybShnZC5wcmltYXJ5UGVyc29uR2VuZGVyKTtcbn1cblxuZnVuY3Rpb24gZ2V0U3BvdXNlVGVybShnZW5kZXIpIHtcbiAgaWYgKCFnZW5kZXIpIHtcbiAgICByZXR1cm4gXCJzcG91c2VcIjtcbiAgfSBlbHNlIGlmIChnZW5kZXIgPT0gXCJtYWxlXCIpIHtcbiAgICByZXR1cm4gXCJodXNiYW5kXCI7XG4gIH0gZWxzZSBpZiAoZ2VuZGVyID09IFwiZmVtYWxlXCIpIHtcbiAgICByZXR1cm4gXCJ3aWZlXCI7XG4gIH1cbn1cblxuZnVuY3Rpb24gZ2V0UHJpbWFyeVBlcnNvblNwb3VzZVRlcm0oZ2QpIHtcbiAgcmV0dXJuIGdldFNwb3VzZVRlcm0oZ2QucHJpbWFyeVBlcnNvbkdlbmRlcik7XG59XG5cbmV4cG9ydCB7XG4gIGdldENoaWxkVGVybSxcbiAgZ2V0UHJpbWFyeVBlcnNvbkNoaWxkVGVybSxcbiAgZ2V0UGFyZW50VGVybSxcbiAgZ2V0UHJpbWFyeVBlcnNvblBhcmVudFRlcm0sXG4gIGdldFNwb3VzZVRlcm0sXG4gIGdldFByaW1hcnlQZXJzb25TcG91c2VUZXJtLFxufTtcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./extension/base/core/narrative_or_sentence_utils.mjs\n");

/***/ }),

/***/ "./extension/base/core/options/options_database.mjs":
/*!**********************************************************!*\
  !*** ./extension/base/core/options/options_database.mjs ***!
  \**********************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"getDefaultOptions\": () => (/* binding */ getDefaultOptions),\n/* harmony export */   \"getUnitTestOptions\": () => (/* binding */ getUnitTestOptions),\n/* harmony export */   \"optionsRegistry\": () => (/* reexport safe */ _options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.optionsRegistry)\n/* harmony export */ });\n/* harmony import */ var _options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./options_registry.mjs */ \"./extension/base/core/options/options_registry.mjs\");\n/* harmony import */ var _register_base_options_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./register_base_options.mjs */ \"./extension/base/core/options/register_base_options.mjs\");\n/* harmony import */ var _site_all_core_register_site_options_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../site/all/core/register_site_options.mjs */ \"./extension/site/all/core/register_site_options.mjs\");\n/*\nMIT License\n\nCopyright (c) 2020 Robert M Pavey\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.\n*/\n\n\n\n\n\nfunction getDefaultOptions() {\n  // build the options structure from the optionsRegistry\n\n  let defaultOptions = {};\n\n  defaultOptions.options_version = 6;\n\n  for (let optionsGroup of _options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.optionsRegistry.optionsGroups) {\n    let optionNamePrefix = optionsGroup.category + \"_\" + optionsGroup.subcategory + \"_\";\n\n    for (let option of optionsGroup.options) {\n      let fullOptionName = optionNamePrefix + option.optionName;\n      defaultOptions[fullOptionName] = option.defaultValue;\n    }\n  }\n\n  return defaultOptions;\n}\n\nfunction getUnitTestOptions() {\n  // build the options structure from the optionsRegistry\n\n  let unitTestOptions = {};\n\n  unitTestOptions.options_version = 5;\n\n  for (let optionsGroup of _options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.optionsRegistry.optionsGroups) {\n    let optionNamePrefix = optionsGroup.category + \"_\" + optionsGroup.subcategory + \"_\";\n\n    for (let option of optionsGroup.options) {\n      let fullOptionName = optionNamePrefix + option.optionName;\n      let value = undefined;\n      if (typeof option.unitTestValue === \"undefined\") {\n        value = option.defaultValue;\n      } else {\n        value = option.unitTestValue;\n      }\n      unitTestOptions[fullOptionName] = value;\n    }\n  }\n\n  return unitTestOptions;\n}\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9leHRlbnNpb24vYmFzZS9jb3JlL29wdGlvbnMvb3B0aW9uc19kYXRhYmFzZS5tanMuanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUV5RDtBQUNwQjtBQUNxQjs7QUFFMUQ7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQSwyQkFBMkIsZ0ZBQTZCO0FBQ3hEOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBLDJCQUEyQixnRkFBNkI7QUFDeEQ7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRWtFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vQ2l0YXRpb25FeHRyYWN0b3IvLi9leHRlbnNpb24vYmFzZS9jb3JlL29wdGlvbnMvb3B0aW9uc19kYXRhYmFzZS5tanM/ZGZiNyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuTUlUIExpY2Vuc2VcblxuQ29weXJpZ2h0IChjKSAyMDIwIFJvYmVydCBNIFBhdmV5XG5cblBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHlcbm9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlIFwiU29mdHdhcmVcIiksIHRvIGRlYWxcbmluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHNcbnRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGxcbmNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQgcGVyc29ucyB0byB3aG9tIHRoZSBTb2Z0d2FyZSBpc1xuZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczpcblxuVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW4gYWxsXG5jb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLlxuXG5USEUgU09GVFdBUkUgSVMgUFJPVklERUQgXCJBUyBJU1wiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SXG5JTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSxcbkZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRVxuQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUlxuTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSxcbk9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4gVEhFXG5TT0ZUV0FSRS5cbiovXG5cbmltcG9ydCB7IG9wdGlvbnNSZWdpc3RyeSB9IGZyb20gXCIuL29wdGlvbnNfcmVnaXN0cnkubWpzXCI7XG5pbXBvcnQgXCIuL3JlZ2lzdGVyX2Jhc2Vfb3B0aW9ucy5tanNcIjtcbmltcG9ydCBcIi4uLy4uLy4uL3NpdGUvYWxsL2NvcmUvcmVnaXN0ZXJfc2l0ZV9vcHRpb25zLm1qc1wiO1xuXG5mdW5jdGlvbiBnZXREZWZhdWx0T3B0aW9ucygpIHtcbiAgLy8gYnVpbGQgdGhlIG9wdGlvbnMgc3RydWN0dXJlIGZyb20gdGhlIG9wdGlvbnNSZWdpc3RyeVxuXG4gIGxldCBkZWZhdWx0T3B0aW9ucyA9IHt9O1xuXG4gIGRlZmF1bHRPcHRpb25zLm9wdGlvbnNfdmVyc2lvbiA9IDY7XG5cbiAgZm9yIChsZXQgb3B0aW9uc0dyb3VwIG9mIG9wdGlvbnNSZWdpc3RyeS5vcHRpb25zR3JvdXBzKSB7XG4gICAgbGV0IG9wdGlvbk5hbWVQcmVmaXggPSBvcHRpb25zR3JvdXAuY2F0ZWdvcnkgKyBcIl9cIiArIG9wdGlvbnNHcm91cC5zdWJjYXRlZ29yeSArIFwiX1wiO1xuXG4gICAgZm9yIChsZXQgb3B0aW9uIG9mIG9wdGlvbnNHcm91cC5vcHRpb25zKSB7XG4gICAgICBsZXQgZnVsbE9wdGlvbk5hbWUgPSBvcHRpb25OYW1lUHJlZml4ICsgb3B0aW9uLm9wdGlvbk5hbWU7XG4gICAgICBkZWZhdWx0T3B0aW9uc1tmdWxsT3B0aW9uTmFtZV0gPSBvcHRpb24uZGVmYXVsdFZhbHVlO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiBkZWZhdWx0T3B0aW9ucztcbn1cblxuZnVuY3Rpb24gZ2V0VW5pdFRlc3RPcHRpb25zKCkge1xuICAvLyBidWlsZCB0aGUgb3B0aW9ucyBzdHJ1Y3R1cmUgZnJvbSB0aGUgb3B0aW9uc1JlZ2lzdHJ5XG5cbiAgbGV0IHVuaXRUZXN0T3B0aW9ucyA9IHt9O1xuXG4gIHVuaXRUZXN0T3B0aW9ucy5vcHRpb25zX3ZlcnNpb24gPSA1O1xuXG4gIGZvciAobGV0IG9wdGlvbnNHcm91cCBvZiBvcHRpb25zUmVnaXN0cnkub3B0aW9uc0dyb3Vwcykge1xuICAgIGxldCBvcHRpb25OYW1lUHJlZml4ID0gb3B0aW9uc0dyb3VwLmNhdGVnb3J5ICsgXCJfXCIgKyBvcHRpb25zR3JvdXAuc3ViY2F0ZWdvcnkgKyBcIl9cIjtcblxuICAgIGZvciAobGV0IG9wdGlvbiBvZiBvcHRpb25zR3JvdXAub3B0aW9ucykge1xuICAgICAgbGV0IGZ1bGxPcHRpb25OYW1lID0gb3B0aW9uTmFtZVByZWZpeCArIG9wdGlvbi5vcHRpb25OYW1lO1xuICAgICAgbGV0IHZhbHVlID0gdW5kZWZpbmVkO1xuICAgICAgaWYgKHR5cGVvZiBvcHRpb24udW5pdFRlc3RWYWx1ZSA9PT0gXCJ1bmRlZmluZWRcIikge1xuICAgICAgICB2YWx1ZSA9IG9wdGlvbi5kZWZhdWx0VmFsdWU7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2YWx1ZSA9IG9wdGlvbi51bml0VGVzdFZhbHVlO1xuICAgICAgfVxuICAgICAgdW5pdFRlc3RPcHRpb25zW2Z1bGxPcHRpb25OYW1lXSA9IHZhbHVlO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiB1bml0VGVzdE9wdGlvbnM7XG59XG5cbmV4cG9ydCB7IGdldERlZmF1bHRPcHRpb25zLCBnZXRVbml0VGVzdE9wdGlvbnMsIG9wdGlvbnNSZWdpc3RyeSB9O1xuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./extension/base/core/options/options_database.mjs\n");

/***/ }),

/***/ "./extension/base/core/options/options_registry.mjs":
/*!**********************************************************!*\
  !*** ./extension/base/core/options/options_registry.mjs ***!
  \**********************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"optionsRegistry\": () => (/* binding */ optionsRegistry),\n/* harmony export */   \"registerOptionsGroup\": () => (/* binding */ registerOptionsGroup),\n/* harmony export */   \"registerSiteSearchPopupOptionsGroup\": () => (/* binding */ registerSiteSearchPopupOptionsGroup),\n/* harmony export */   \"registerSubheadingForOptions\": () => (/* binding */ registerSubheadingForOptions),\n/* harmony export */   \"registerSubsectionForOptions\": () => (/* binding */ registerSubsectionForOptions)\n/* harmony export */ });\n/*\nMIT License\n\nCopyright (c) 2020 Robert M Pavey\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.\n*/\n\nvar optionsRegistry = {\n  tabs: [\n    { name: \"search\", label: \"Search\", subsections: [] },\n    { name: \"citation\", label: \"Citation\", subsections: [] },\n    {\n      name: \"narrative\",\n      label: \"Narrative\",\n      subsections: [],\n      comment:\n        \"These options apply to the narrative sentence that is generated before \" +\n        'the inline citation by the \"Build Narrative with Citation\" menu option.',\n    },\n    {\n      name: \"table\",\n      label: \"Household Table\",\n      subsections: [],\n      comment:\n        \"These options apply to Household Tables. \" +\n        \"A Household Table can be generated when you are on a census record. \" +\n        \"It is separate from the citation.\",\n    },\n    {\n      name: \"addMerge\",\n      label: \"Add/Merge\",\n      subsections: [],\n      comment:\n        \"These options apply to filling fields in the Add Person screen or the Merge/Edit screen \" +\n        \"from person data or a citation.\\n\" +\n        \"Person data can be saved when you are on a person page in Ancestry, FamilySearch, etc. \" +\n        \"It is separate from the citation.\",\n    },\n  ],\n  optionsGroups: [],\n};\n\nfunction registerSubsectionForOptions(tabName, name, label) {\n  //console.log(\"registerSubsectionForOptions: tabName is: \" + tabName + \", name is: \" + name + \", label is: \" + label);\n\n  let tab = undefined;\n  for (let thisTab of optionsRegistry.tabs) {\n    if (thisTab.name == tabName) {\n      tab = thisTab;\n    }\n  }\n  //console.log(\"registerSubsectionForOptions: tab is: \");\n  //console.log(tab);\n\n  if (tab) {\n    let existingSubsection = undefined;\n    for (let subsection of tab.subsections) {\n      if (subsection.name == name) {\n        existingSubsection = subsection;\n      }\n    }\n\n    if (existingSubsection) {\n      console.log(\"registerSubsectionForOptions, subsection already exists: \" + name);\n      return;\n    }\n\n    tab.subsections.push({ name: name, label: label, subheadings: [] });\n  }\n}\n\nfunction registerSubheadingForOptions(tabName, subsectionName, name, label) {\n  //console.log(\"registerSubheadingForOptions: tabName is: \" + tabName + \", name is: \" + name + \", label is: \" + label);\n\n  let tab = undefined;\n  for (let thisTab of optionsRegistry.tabs) {\n    if (thisTab.name == tabName) {\n      tab = thisTab;\n    }\n  }\n  //console.log(\"registerSubheadingForOptions: tab is: \");\n  //console.log(tab);\n\n  if (tab) {\n    let existingSubsection = undefined;\n    for (let subsection of tab.subsections) {\n      if (subsection.name == subsectionName) {\n        existingSubsection = subsection;\n      }\n    }\n\n    if (existingSubsection) {\n      let existingSubheading = undefined;\n      for (let subheading of existingSubsection.subheadings) {\n        if (subheading.name == name) {\n          existingSubheading = subsection;\n        }\n      }\n\n      if (existingSubheading) {\n        console.log(\"registerSubheadingForOptions, subheading already exists: \" + name);\n        return;\n      }\n\n      existingSubsection.subheadings.push({ name: name, label: label });\n    }\n  }\n}\n\nfunction registerOptionsGroup(optionsGroup) {\n  optionsRegistry.optionsGroups.push(optionsGroup);\n}\n\nfunction registerSiteSearchPopupOptionsGroup(siteName, topMenuPriority, subMenuPriority) {\n  const optionsGroup = {\n    category: \"search\",\n    subcategory: siteName,\n    tab: \"search\",\n    subsection: siteName,\n    subheading: \"popup\",\n    options: [\n      {\n        optionName: \"popup_priorityOnTopMenu\",\n        type: \"number\",\n        label: \"Priority of the search menu item for this site on the top-level popup menu\",\n        defaultValue: topMenuPriority,\n      },\n      {\n        optionName: \"popup_priorityOnSubMenu\",\n        type: \"number\",\n        label: \"Priority of the search menu item for this site on the search submenu\",\n        defaultValue: subMenuPriority,\n        comment: \"NOTE: One is highest priority. A priority of zero or less means never show this menu item.\",\n      },\n    ],\n  };\n\n  registerSubheadingForOptions(\"search\", siteName, \"popup\", \"Popup Menu\");\n  registerOptionsGroup(optionsGroup);\n}\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9leHRlbnNpb24vYmFzZS9jb3JlL29wdGlvbnMvb3B0aW9uc19yZWdpc3RyeS5tanMuanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLE1BQU0sa0RBQWtEO0FBQ3hELE1BQU0sc0RBQXNEO0FBQzVEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsMkJBQTJCLDJDQUEyQztBQUN0RTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSw0Q0FBNEMsMEJBQTBCO0FBQ3RFO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPO0FBQ1A7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQVFFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vQ2l0YXRpb25FeHRyYWN0b3IvLi9leHRlbnNpb24vYmFzZS9jb3JlL29wdGlvbnMvb3B0aW9uc19yZWdpc3RyeS5tanM/MDRjYSJdLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuTUlUIExpY2Vuc2VcblxuQ29weXJpZ2h0IChjKSAyMDIwIFJvYmVydCBNIFBhdmV5XG5cblBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHlcbm9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlIFwiU29mdHdhcmVcIiksIHRvIGRlYWxcbmluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHNcbnRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGxcbmNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQgcGVyc29ucyB0byB3aG9tIHRoZSBTb2Z0d2FyZSBpc1xuZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczpcblxuVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW4gYWxsXG5jb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLlxuXG5USEUgU09GVFdBUkUgSVMgUFJPVklERUQgXCJBUyBJU1wiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SXG5JTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSxcbkZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRVxuQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUlxuTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSxcbk9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4gVEhFXG5TT0ZUV0FSRS5cbiovXG5cbnZhciBvcHRpb25zUmVnaXN0cnkgPSB7XG4gIHRhYnM6IFtcbiAgICB7IG5hbWU6IFwic2VhcmNoXCIsIGxhYmVsOiBcIlNlYXJjaFwiLCBzdWJzZWN0aW9uczogW10gfSxcbiAgICB7IG5hbWU6IFwiY2l0YXRpb25cIiwgbGFiZWw6IFwiQ2l0YXRpb25cIiwgc3Vic2VjdGlvbnM6IFtdIH0sXG4gICAge1xuICAgICAgbmFtZTogXCJuYXJyYXRpdmVcIixcbiAgICAgIGxhYmVsOiBcIk5hcnJhdGl2ZVwiLFxuICAgICAgc3Vic2VjdGlvbnM6IFtdLFxuICAgICAgY29tbWVudDpcbiAgICAgICAgXCJUaGVzZSBvcHRpb25zIGFwcGx5IHRvIHRoZSBuYXJyYXRpdmUgc2VudGVuY2UgdGhhdCBpcyBnZW5lcmF0ZWQgYmVmb3JlIFwiICtcbiAgICAgICAgJ3RoZSBpbmxpbmUgY2l0YXRpb24gYnkgdGhlIFwiQnVpbGQgTmFycmF0aXZlIHdpdGggQ2l0YXRpb25cIiBtZW51IG9wdGlvbi4nLFxuICAgIH0sXG4gICAge1xuICAgICAgbmFtZTogXCJ0YWJsZVwiLFxuICAgICAgbGFiZWw6IFwiSG91c2Vob2xkIFRhYmxlXCIsXG4gICAgICBzdWJzZWN0aW9uczogW10sXG4gICAgICBjb21tZW50OlxuICAgICAgICBcIlRoZXNlIG9wdGlvbnMgYXBwbHkgdG8gSG91c2Vob2xkIFRhYmxlcy4gXCIgK1xuICAgICAgICBcIkEgSG91c2Vob2xkIFRhYmxlIGNhbiBiZSBnZW5lcmF0ZWQgd2hlbiB5b3UgYXJlIG9uIGEgY2Vuc3VzIHJlY29yZC4gXCIgK1xuICAgICAgICBcIkl0IGlzIHNlcGFyYXRlIGZyb20gdGhlIGNpdGF0aW9uLlwiLFxuICAgIH0sXG4gICAge1xuICAgICAgbmFtZTogXCJhZGRNZXJnZVwiLFxuICAgICAgbGFiZWw6IFwiQWRkL01lcmdlXCIsXG4gICAgICBzdWJzZWN0aW9uczogW10sXG4gICAgICBjb21tZW50OlxuICAgICAgICBcIlRoZXNlIG9wdGlvbnMgYXBwbHkgdG8gZmlsbGluZyBmaWVsZHMgaW4gdGhlIEFkZCBQZXJzb24gc2NyZWVuIG9yIHRoZSBNZXJnZS9FZGl0IHNjcmVlbiBcIiArXG4gICAgICAgIFwiZnJvbSBwZXJzb24gZGF0YSBvciBhIGNpdGF0aW9uLlxcblwiICtcbiAgICAgICAgXCJQZXJzb24gZGF0YSBjYW4gYmUgc2F2ZWQgd2hlbiB5b3UgYXJlIG9uIGEgcGVyc29uIHBhZ2UgaW4gQW5jZXN0cnksIEZhbWlseVNlYXJjaCwgZXRjLiBcIiArXG4gICAgICAgIFwiSXQgaXMgc2VwYXJhdGUgZnJvbSB0aGUgY2l0YXRpb24uXCIsXG4gICAgfSxcbiAgXSxcbiAgb3B0aW9uc0dyb3VwczogW10sXG59O1xuXG5mdW5jdGlvbiByZWdpc3RlclN1YnNlY3Rpb25Gb3JPcHRpb25zKHRhYk5hbWUsIG5hbWUsIGxhYmVsKSB7XG4gIC8vY29uc29sZS5sb2coXCJyZWdpc3RlclN1YnNlY3Rpb25Gb3JPcHRpb25zOiB0YWJOYW1lIGlzOiBcIiArIHRhYk5hbWUgKyBcIiwgbmFtZSBpczogXCIgKyBuYW1lICsgXCIsIGxhYmVsIGlzOiBcIiArIGxhYmVsKTtcblxuICBsZXQgdGFiID0gdW5kZWZpbmVkO1xuICBmb3IgKGxldCB0aGlzVGFiIG9mIG9wdGlvbnNSZWdpc3RyeS50YWJzKSB7XG4gICAgaWYgKHRoaXNUYWIubmFtZSA9PSB0YWJOYW1lKSB7XG4gICAgICB0YWIgPSB0aGlzVGFiO1xuICAgIH1cbiAgfVxuICAvL2NvbnNvbGUubG9nKFwicmVnaXN0ZXJTdWJzZWN0aW9uRm9yT3B0aW9uczogdGFiIGlzOiBcIik7XG4gIC8vY29uc29sZS5sb2codGFiKTtcblxuICBpZiAodGFiKSB7XG4gICAgbGV0IGV4aXN0aW5nU3Vic2VjdGlvbiA9IHVuZGVmaW5lZDtcbiAgICBmb3IgKGxldCBzdWJzZWN0aW9uIG9mIHRhYi5zdWJzZWN0aW9ucykge1xuICAgICAgaWYgKHN1YnNlY3Rpb24ubmFtZSA9PSBuYW1lKSB7XG4gICAgICAgIGV4aXN0aW5nU3Vic2VjdGlvbiA9IHN1YnNlY3Rpb247XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKGV4aXN0aW5nU3Vic2VjdGlvbikge1xuICAgICAgY29uc29sZS5sb2coXCJyZWdpc3RlclN1YnNlY3Rpb25Gb3JPcHRpb25zLCBzdWJzZWN0aW9uIGFscmVhZHkgZXhpc3RzOiBcIiArIG5hbWUpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRhYi5zdWJzZWN0aW9ucy5wdXNoKHsgbmFtZTogbmFtZSwgbGFiZWw6IGxhYmVsLCBzdWJoZWFkaW5nczogW10gfSk7XG4gIH1cbn1cblxuZnVuY3Rpb24gcmVnaXN0ZXJTdWJoZWFkaW5nRm9yT3B0aW9ucyh0YWJOYW1lLCBzdWJzZWN0aW9uTmFtZSwgbmFtZSwgbGFiZWwpIHtcbiAgLy9jb25zb2xlLmxvZyhcInJlZ2lzdGVyU3ViaGVhZGluZ0Zvck9wdGlvbnM6IHRhYk5hbWUgaXM6IFwiICsgdGFiTmFtZSArIFwiLCBuYW1lIGlzOiBcIiArIG5hbWUgKyBcIiwgbGFiZWwgaXM6IFwiICsgbGFiZWwpO1xuXG4gIGxldCB0YWIgPSB1bmRlZmluZWQ7XG4gIGZvciAobGV0IHRoaXNUYWIgb2Ygb3B0aW9uc1JlZ2lzdHJ5LnRhYnMpIHtcbiAgICBpZiAodGhpc1RhYi5uYW1lID09IHRhYk5hbWUpIHtcbiAgICAgIHRhYiA9IHRoaXNUYWI7XG4gICAgfVxuICB9XG4gIC8vY29uc29sZS5sb2coXCJyZWdpc3RlclN1YmhlYWRpbmdGb3JPcHRpb25zOiB0YWIgaXM6IFwiKTtcbiAgLy9jb25zb2xlLmxvZyh0YWIpO1xuXG4gIGlmICh0YWIpIHtcbiAgICBsZXQgZXhpc3RpbmdTdWJzZWN0aW9uID0gdW5kZWZpbmVkO1xuICAgIGZvciAobGV0IHN1YnNlY3Rpb24gb2YgdGFiLnN1YnNlY3Rpb25zKSB7XG4gICAgICBpZiAoc3Vic2VjdGlvbi5uYW1lID09IHN1YnNlY3Rpb25OYW1lKSB7XG4gICAgICAgIGV4aXN0aW5nU3Vic2VjdGlvbiA9IHN1YnNlY3Rpb247XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKGV4aXN0aW5nU3Vic2VjdGlvbikge1xuICAgICAgbGV0IGV4aXN0aW5nU3ViaGVhZGluZyA9IHVuZGVmaW5lZDtcbiAgICAgIGZvciAobGV0IHN1YmhlYWRpbmcgb2YgZXhpc3RpbmdTdWJzZWN0aW9uLnN1YmhlYWRpbmdzKSB7XG4gICAgICAgIGlmIChzdWJoZWFkaW5nLm5hbWUgPT0gbmFtZSkge1xuICAgICAgICAgIGV4aXN0aW5nU3ViaGVhZGluZyA9IHN1YnNlY3Rpb247XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgaWYgKGV4aXN0aW5nU3ViaGVhZGluZykge1xuICAgICAgICBjb25zb2xlLmxvZyhcInJlZ2lzdGVyU3ViaGVhZGluZ0Zvck9wdGlvbnMsIHN1YmhlYWRpbmcgYWxyZWFkeSBleGlzdHM6IFwiICsgbmFtZSk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgZXhpc3RpbmdTdWJzZWN0aW9uLnN1YmhlYWRpbmdzLnB1c2goeyBuYW1lOiBuYW1lLCBsYWJlbDogbGFiZWwgfSk7XG4gICAgfVxuICB9XG59XG5cbmZ1bmN0aW9uIHJlZ2lzdGVyT3B0aW9uc0dyb3VwKG9wdGlvbnNHcm91cCkge1xuICBvcHRpb25zUmVnaXN0cnkub3B0aW9uc0dyb3Vwcy5wdXNoKG9wdGlvbnNHcm91cCk7XG59XG5cbmZ1bmN0aW9uIHJlZ2lzdGVyU2l0ZVNlYXJjaFBvcHVwT3B0aW9uc0dyb3VwKHNpdGVOYW1lLCB0b3BNZW51UHJpb3JpdHksIHN1Yk1lbnVQcmlvcml0eSkge1xuICBjb25zdCBvcHRpb25zR3JvdXAgPSB7XG4gICAgY2F0ZWdvcnk6IFwic2VhcmNoXCIsXG4gICAgc3ViY2F0ZWdvcnk6IHNpdGVOYW1lLFxuICAgIHRhYjogXCJzZWFyY2hcIixcbiAgICBzdWJzZWN0aW9uOiBzaXRlTmFtZSxcbiAgICBzdWJoZWFkaW5nOiBcInBvcHVwXCIsXG4gICAgb3B0aW9uczogW1xuICAgICAge1xuICAgICAgICBvcHRpb25OYW1lOiBcInBvcHVwX3ByaW9yaXR5T25Ub3BNZW51XCIsXG4gICAgICAgIHR5cGU6IFwibnVtYmVyXCIsXG4gICAgICAgIGxhYmVsOiBcIlByaW9yaXR5IG9mIHRoZSBzZWFyY2ggbWVudSBpdGVtIGZvciB0aGlzIHNpdGUgb24gdGhlIHRvcC1sZXZlbCBwb3B1cCBtZW51XCIsXG4gICAgICAgIGRlZmF1bHRWYWx1ZTogdG9wTWVudVByaW9yaXR5LFxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgb3B0aW9uTmFtZTogXCJwb3B1cF9wcmlvcml0eU9uU3ViTWVudVwiLFxuICAgICAgICB0eXBlOiBcIm51bWJlclwiLFxuICAgICAgICBsYWJlbDogXCJQcmlvcml0eSBvZiB0aGUgc2VhcmNoIG1lbnUgaXRlbSBmb3IgdGhpcyBzaXRlIG9uIHRoZSBzZWFyY2ggc3VibWVudVwiLFxuICAgICAgICBkZWZhdWx0VmFsdWU6IHN1Yk1lbnVQcmlvcml0eSxcbiAgICAgICAgY29tbWVudDogXCJOT1RFOiBPbmUgaXMgaGlnaGVzdCBwcmlvcml0eS4gQSBwcmlvcml0eSBvZiB6ZXJvIG9yIGxlc3MgbWVhbnMgbmV2ZXIgc2hvdyB0aGlzIG1lbnUgaXRlbS5cIixcbiAgICAgIH0sXG4gICAgXSxcbiAgfTtcblxuICByZWdpc3RlclN1YmhlYWRpbmdGb3JPcHRpb25zKFwic2VhcmNoXCIsIHNpdGVOYW1lLCBcInBvcHVwXCIsIFwiUG9wdXAgTWVudVwiKTtcbiAgcmVnaXN0ZXJPcHRpb25zR3JvdXAob3B0aW9uc0dyb3VwKTtcbn1cblxuZXhwb3J0IHtcbiAgcmVnaXN0ZXJPcHRpb25zR3JvdXAsXG4gIHJlZ2lzdGVyU3Vic2VjdGlvbkZvck9wdGlvbnMsXG4gIHJlZ2lzdGVyU3ViaGVhZGluZ0Zvck9wdGlvbnMsXG4gIHJlZ2lzdGVyU2l0ZVNlYXJjaFBvcHVwT3B0aW9uc0dyb3VwLFxuICBvcHRpb25zUmVnaXN0cnksXG59O1xuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./extension/base/core/options/options_registry.mjs\n");

/***/ }),

/***/ "./extension/base/core/options/register_base_options.mjs":
/*!***************************************************************!*\
  !*** ./extension/base/core/options/register_base_options.mjs ***!
  \***************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./options_registry.mjs */ \"./extension/base/core/options/options_registry.mjs\");\n/*\nMIT License\n\nCopyright (c) 2020 Robert M Pavey\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.\n*/\n\n\n\n////////////////////////////////////////////////////////////////////////////////////////////////////\n// Search options groups\n////////////////////////////////////////////////////////////////////////////////////////////////////\n\nconst searchOptionsGroup = {\n  category: \"search\",\n  subcategory: \"general\",\n  tab: \"search\",\n  subsection: \"general\",\n  options: [\n    {\n      optionName: \"new_window\",\n      type: \"checkbox\",\n      label: \"Open search results in a new window rather than a new tab\",\n      defaultValue: false,\n    },\n    {\n      optionName: \"popup_showSameSite\",\n      type: \"checkbox\",\n      label: \"On the popup show a search menu item for the site that you are currently on\",\n      defaultValue: true,\n    },\n    {\n      optionName: \"popup_maxSearchItemsInTopMenu\",\n      type: \"number\",\n      label: \"Maximum number of search menu items to show on top-level popup (0 means just show search submenu)\",\n      defaultValue: 8,\n    },\n    {\n      optionName: \"maxLifespan\",\n      type: \"number\",\n      label: \"Maximum lifespan to consider when building search date/age ranges\",\n      defaultValue: 120,\n    },\n  ],\n};\n\n////////////////////////////////////////////////////////////////////////////////////////////////////\n// Citation options groups\n////////////////////////////////////////////////////////////////////////////////////////////////////\n\nconst citationOptionsGroup = {\n  category: \"citation\",\n  subcategory: \"general\",\n  tab: \"citation\",\n  subsection: \"general\",\n  options: [\n    {\n      optionName: \"meaningfulNames\",\n      type: \"select\",\n      label: 'Add a label at the start of each reference (this shows up in the \"Sources\" section)',\n      values: [\n        { value: \"none\", text: \"None\" },\n        { value: \"normal\", text: \"In normal text\" },\n        { value: \"bold\", text: \"In bold text\" },\n        { value: \"italic\", text: \"In italic text\" },\n      ],\n      defaultValue: \"bold\",\n    },\n    {\n      optionName: \"commaInsideQuotes\",\n      type: \"checkbox\",\n      label: \"Put commas inside quotation marks (old US typographical convention) [EE style]\",\n      defaultValue: false,\n    },\n    {\n      optionName: \"addEeItemType\",\n      type: \"checkbox\",\n      label: 'Add \"database\" or \"database with images\" after the database/collection title [EE style]',\n      defaultValue: false,\n    },\n    {\n      optionName: \"referencePosition\",\n      type: \"select\",\n      label: \"Place the source reference data\",\n      values: [\n        {\n          value: \"afterSourceTitle\",\n          text: \"After the database/collection title\",\n        },\n        {\n          value: \"atEnd\",\n          text: \"At the end of the citation (disables data table) [EE Style]\",\n        },\n      ],\n      defaultValue: \"afterSourceTitle\",\n    },\n    {\n      optionName: \"addAccessedDate\",\n      type: \"select\",\n      label: \"Add an accessed date to citation\",\n      values: [\n        { value: \"none\", text: \"None\" },\n        {\n          value: \"parenAfterLink\",\n          text: \"In form '<link> (accessed 15 June 2022)'\",\n        },\n        {\n          value: \"parenBeforeLink\",\n          text: \"In form '(<link> : accessed 15 June 2022)' [EE style]\",\n        },\n      ],\n      defaultValue: \"parenAfterLink\",\n    },\n    {\n      optionName: \"sourceReferenceSeparator\",\n      type: \"select\",\n      label: \"Separators to use between parts of the source reference data\",\n      values: [\n        {\n          value: \"semicolon\",\n          text: \"Semi-colon (and colon if key/value pair) (; Page: 2)\",\n        },\n        {\n          value: \"commaColon\",\n          text: \"Comma and (and colon if key/value pair) (, Page: 2)\",\n        },\n        { value: \"commaSpace\", text: \"Comma only (, Page 2) [EE style?]\" },\n        {\n          value: \"siteStyle\",\n          text: \"Follow the style of the site being cited (if any, else semi-colon)\",\n        },\n      ],\n      defaultValue: \"semicolon\",\n    },\n    {\n      optionName: \"dataListSeparator\",\n      type: \"select\",\n      label: \"Separators to use for key/value pairs in data list (if list used rather than sentence or table)\",\n      values: [\n        { value: \"semicolon\", text: \"Semi-colon and colon (; Age: 20)\" },\n        { value: \"commaColon\", text: \"Comma and colon (, Age: 20)\" },\n        { value: \"commaSpace\", text: \"Comma only (, Age 20) [EE style?]\" },\n      ],\n      defaultValue: \"semicolon\",\n    },\n    {\n      optionName: \"addNewlinesWithinRefs\",\n      type: \"checkbox\",\n      label:\n        \"Add newlines after the <ref> and before the </ref> (for readability in edit mode, no effect in read mode)\",\n      defaultValue: true,\n    },\n    {\n      optionName: \"addNewlinesWithinBody\",\n      type: \"checkbox\",\n      label: \"Add newlines within the citation between sections (for readability in edit mode, no effect in read mode)\",\n      defaultValue: true,\n    },\n    {\n      optionName: \"addBreaksWithinBody\",\n      type: \"checkbox\",\n      label: \"Add <br/>s within the citation between sections (for readability in read mode)\",\n      defaultValue: true,\n    },\n  ],\n};\n\n////////////////////////////////////////////////////////////////////////////////////////////////////\n// Narrative options groups\n////////////////////////////////////////////////////////////////////////////////////////////////////\n\nconst narrativeOptionsGroup = {\n  category: \"narrative\",\n  subcategory: \"general\",\n  tab: \"narrative\",\n  subsection: \"general\",\n  options: [\n    {\n      optionName: \"spelling\",\n      type: \"select\",\n      label: \"Spelling\",\n      values: [\n        { value: \"en_uk\", text: \"UK English\" },\n        { value: \"en_us\", text: \"US English\" },\n      ],\n      defaultValue: \"en_uk\",\n    },\n    {\n      optionName: \"nameOrPronoun\",\n      type: \"select\",\n      label: \"Name/pronoun to use in narrative events\",\n      values: [\n        {\n          value: \"firstName\",\n          text: \"First name (single word), if not known use last name\",\n        },\n        { value: \"forenames\", text: \"Forenames, if not known use last name\" },\n        { value: \"fullName\", text: \"Full name\" },\n        {\n          value: \"pronoun\",\n          text: \"Pronoun (he/she), if not known use first name\",\n        },\n      ],\n      defaultValue: \"firstName\",\n    },\n    {\n      optionName: \"country\",\n      type: \"select\",\n      label: \"Include country in place names in narrative events (if known)\",\n      values: [\n        { value: \"full\", text: \"Include country as recorded in record\" },\n        { value: \"standard\", text: \"Use standardized or abbreviated country\" },\n        { value: \"none\", text: \"Omit country from place name\" },\n      ],\n      defaultValue: \"standard\",\n      unitTestValue: \"full\",\n    },\n    {\n      optionName: \"dateFormat\",\n      type: \"select\",\n      label: \"Date format in narrative string\",\n      values: [\n        { value: \"long\", text: \"dd Month yyyy (e.g. '12 September 1845')\" },\n        { value: \"short\", text: \"dd Mmm yyyy (e.g. '12 Sep 1845')\" },\n        {\n          value: \"theNth\",\n          text: \"the ddth of Month yyyy (e.g. 'the 12th of September 1845')\",\n        },\n        {\n          value: \"monthComma\",\n          text: \"Month dd, yyyy (e.g. 'September 12, 1845')\",\n        },\n        {\n          value: \"monthCommaNth\",\n          text: \"Month ddth, yyyy (e.g. 'September 12th, 1845')\",\n        },\n        {\n          value: \"country\",\n          text: \"Country specific (e.g. 'September 12, 1845' in US, '12 September 1845' elsewhere)\",\n        },\n        {\n          value: \"countryNth\",\n          text: \"Country specific, long (e.g. 'September 12th, 1845' in US, 'the 12th of September 1845' elsewhere)\",\n        },\n      ],\n      defaultValue: \"long\",\n    },\n    {\n      optionName: \"dateHighlight\",\n      type: \"select\",\n      label: \"Highlight the date in a narrative string\",\n      values: [\n        { value: \"none\", text: \"No highlight\" },\n        { value: \"bold\", text: \"Bold\" },\n        { value: \"italic\", text: \"Italic\" },\n      ],\n      defaultValue: \"none\",\n    },\n    {\n      optionName: \"parentsUseAmpOrAnd\",\n      type: \"select\",\n      label: \"Separator to use between parents\",\n      values: [\n        { value: \"amp\", text: \" & \" },\n        { value: \"and\", text: \" and \" },\n      ],\n      defaultValue: \"amp\",\n    },\n    {\n      optionName: \"occupationFormat\",\n      type: \"select\",\n      label: \"Case/format to use for occupations\",\n      values: [\n        {\n          value: \"keepCase\",\n          text: \"Keep case from record (with some cleanup)\",\n        },\n        { value: \"titleCase\", text: \"Title Case (e.g. 'Coal Miner')\" },\n        { value: \"lowerCase\", text: \"Lower Case (e.g. 'coal miner')\" },\n      ],\n      defaultValue: \"keepCase\",\n    },\n    {\n      optionName: \"placeChurchFirst\",\n      type: \"select\",\n      label: \"Attempt to put church name before town name (for certain sites and countries)\",\n      values: [\n        { value: \"no\", text: \"No\" },\n        { value: \"yes\", text: \"Yes\" },\n      ],\n      defaultValue: \"no\",\n    },\n  ],\n};\n\nconst narrativeRecordTypeNameOrPronounOption = {\n  optionName: \"nameOrPronoun\",\n  type: \"select\",\n  label: \"Name/pronoun to use in narrative events\",\n  values: [\n    {\n      value: \"default\",\n      text: \"Use default specified in the 'General' subsection\",\n    },\n    {\n      value: \"firstName\",\n      text: \"First name (single word), if not known use last name\",\n    },\n    { value: \"forenames\", text: \"Forenames, if not known use last name\" },\n    { value: \"fullName\", text: \"Full name\" },\n    {\n      value: \"pronoun\",\n      text: \"Pronoun (he/she), if gender not known use first name\",\n    },\n  ],\n  defaultValue: \"default\",\n};\n\nconst narrativeIncludeParentageOption = {\n  optionName: \"includeParentage\",\n  type: \"select\",\n  label: \"Include parentage if known\",\n  values: [\n    { value: \"no\", text: \"No\" },\n    { value: \"inMainSentence\", text: \"In the main sentence\" },\n    { value: \"inSeparateSentence\", text: \"In a separate following sentence\" },\n  ],\n  defaultValue: \"inMainSentence\",\n};\n\nconst narrativeParentageFormatOption = {\n  optionName: \"parentageFormat\",\n  type: \"select\",\n  label: \"Parentage format if in main sentence\",\n  values: [\n    {\n      value: \"twoCommas\",\n      text: \", <son/daughter/child> of <parentName1>[ & <parentName2>],\",\n    },\n    {\n      value: \"theTwoCommas\",\n      text: \", the <son/daughter/child> of <parentName1>[ & <parentName2>],\",\n    },\n  ],\n  defaultValue: \"twoCommas\",\n  comment:\n    \"NOTE: [square brackets] in options above denote optional parts that are only present if that data is known.\",\n};\n\nconst narrativeRegistrationDistrictFormatOption = {\n  optionName: \"regDistrictFormat\",\n  type: \"select\",\n  label: \"Registration district format\",\n  values: [\n    { value: \"theDistrict\", text: \"the <district name> district\" },\n    { value: \"districtName\", text: \"<district name>\" },\n    { value: \"districtCounty\", text: \"<district name>[, <county name>]\" },\n  ],\n  defaultValue: \"theDistrict\",\n};\n\nconst narrativeIncludeAgeOption = {\n  optionName: \"includeAge\",\n  type: \"select\",\n  label: \"Include age if known\",\n  values: [\n    { value: \"no\", text: \"No\" },\n    { value: \"inMainSentence\", text: \"In the main sentence\" },\n    { value: \"inSeparateSentence\", text: \"In a separate following sentence\" },\n  ],\n  defaultValue: \"inMainSentence\",\n};\n\nconst narrativeAgeFormatOption = {\n  optionName: \"ageFormat\",\n  type: \"select\",\n  label: \"Age format\",\n  values: [\n    { value: \"parensAge\", text: \"(age <age>)\" },\n    { value: \"commasAge\", text: \", age <age>,\" },\n    { value: \"plainAge\", text: \" age <age>\" },\n    { value: \"parensAged\", text: \"(aged <age>)\" },\n    { value: \"commasAged\", text: \", aged <age>,\" },\n    { value: \"plainAged\", text: \" aged <age>\" },\n  ],\n  defaultValue: \"parensAge\",\n};\n\n////////////////////////////////////////////////////////////////////////////////////////////////////\n// Record type specific narrative options groups\n////////////////////////////////////////////////////////////////////////////////////////////////////\nconst narrativeBirthOptionsGroup = {\n  category: \"narrative\",\n  subcategory: \"birth\",\n  tab: \"narrative\",\n  subsection: \"birth\",\n  options: [narrativeRecordTypeNameOrPronounOption, narrativeIncludeParentageOption, narrativeParentageFormatOption],\n};\n\nconst narrativeBirthRegOptionsGroup = {\n  category: \"narrative\",\n  subcategory: \"birthReg\",\n  tab: \"narrative\",\n  subsection: \"birthReg\",\n  options: [narrativeRecordTypeNameOrPronounOption],\n};\n\nconst narrativeBirthRegEvtOptionsGroup = {\n  category: \"narrative\",\n  subcategory: \"birthRegEvt\",\n  tab: \"narrative\",\n  subsection: \"birthReg\",\n  subheading: \"evt\",\n  options: [\n    {\n      optionName: \"sentenceStructure\",\n      type: \"select\",\n      label: \"Sentence structure\",\n      values: [\n        {\n          value: \"oneSentence\",\n          text: \"<name/pronoun> was born <date> <place>.\",\n        },\n      ],\n      defaultValue: \"oneSentence\",\n    },\n    narrativeIncludeParentageOption,\n    narrativeParentageFormatOption,\n  ],\n};\n\nconst narrativeBirthRegRegOptionsGroup = {\n  category: \"narrative\",\n  subcategory: \"birthRegReg\",\n  tab: \"narrative\",\n  subsection: \"birthReg\",\n  subheading: \"reg\",\n  options: [\n    {\n      optionName: \"sentenceStructure\",\n      type: \"select\",\n      label: \"Sentence structure\",\n      values: [\n        {\n          value: \"oneSentence\",\n          text: \"<possessive name/pronoun> birth was registered <date> in <place>.\",\n        },\n        {\n          value: \"twoSentences\",\n          text: \"<name/pronoun> was born <date>. <possessive pronoun> birth was registered in <place>.\",\n        },\n        {\n          value: \"twoSentencesDate\",\n          text: \"<name/pronoun> was born <date>. <possessive pronoun> birth was registered <date> in <place>.\",\n        },\n      ],\n      defaultValue: \"oneSentence\",\n    },\n    narrativeRegistrationDistrictFormatOption,\n  ],\n};\n\nconst narrativeBaptismOptionsGroup = {\n  category: \"narrative\",\n  subcategory: \"baptism\",\n  tab: \"narrative\",\n  subsection: \"baptism\",\n  options: [\n    narrativeRecordTypeNameOrPronounOption,\n    {\n      optionName: \"sentenceStructure\",\n      type: \"select\",\n      label: \"Sentence structure\",\n      values: [\n        {\n          value: \"parentsBornAndBap\",\n          text: \"<name/pronoun>[<parentage>] was[ born on <date> and] baptised on <date> in <place>.\",\n        },\n        {\n          value: \"parentsBornSemiBap\",\n          text: \"<name/pronoun>[<parentage>] was[ born on <date>;] baptised on <date> in <place>.\",\n        },\n      ],\n      defaultValue: \"parentsBornAndBap\",\n    },\n    narrativeIncludeParentageOption,\n    narrativeParentageFormatOption,\n    {\n      optionName: \"includeBirthDate\",\n      type: \"checkbox\",\n      label: \"Include birth date if known\",\n      defaultValue: true,\n    },\n    {\n      optionName: \"includeDeathDate\",\n      type: \"checkbox\",\n      label: \"Include death date if known\",\n      defaultValue: true,\n    },\n  ],\n};\n\nconst narrativeBirthOrBaptismOptionsGroup = {\n  category: \"narrative\",\n  subcategory: \"birthOrBaptism\",\n  tab: \"narrative\",\n  subsection: \"birthOrBaptism\",\n  options: [narrativeRecordTypeNameOrPronounOption, narrativeIncludeParentageOption, narrativeParentageFormatOption],\n};\n\nconst narrativeMarriageOptionsGroup = {\n  category: \"narrative\",\n  subcategory: \"marriage\",\n  tab: \"narrative\",\n  subsection: \"marriage\",\n  options: [\n    narrativeRecordTypeNameOrPronounOption,\n    narrativeIncludeParentageOption,\n    narrativeParentageFormatOption,\n    narrativeIncludeAgeOption,\n    narrativeAgeFormatOption,\n  ],\n};\n\nconst narrativeMarriageRegOptionsGroup = {\n  category: \"narrative\",\n  subcategory: \"marriageReg\",\n  tab: \"narrative\",\n  subsection: \"marriageReg\",\n  options: [\n    narrativeRecordTypeNameOrPronounOption,\n    narrativeIncludeParentageOption,\n    narrativeParentageFormatOption,\n    narrativeIncludeAgeOption,\n    narrativeAgeFormatOption,\n  ],\n};\n\nconst narrativeMarriageRegEvtOptionsGroup = {\n  category: \"narrative\",\n  subcategory: \"marriageRegEvt\",\n  tab: \"narrative\",\n  subsection: \"marriageReg\",\n  subheading: \"evt\",\n  options: [\n    {\n      optionName: \"sentenceStructure\",\n      type: \"select\",\n      label: \"Sentence structure\",\n      values: [\n        {\n          value: \"oneSentence\",\n          text: \"<name/pronoun> married[ <spouse>] <date> <place>.\",\n        },\n      ],\n      defaultValue: \"oneSentence\",\n    },\n  ],\n};\n\nconst narrativeMarriageRegRegOptionsGroup = {\n  category: \"narrative\",\n  subcategory: \"marriageRegReg\",\n  tab: \"narrative\",\n  subsection: \"marriageReg\",\n  subheading: \"reg\",\n  options: [\n    {\n      optionName: \"sentenceStructure\",\n      type: \"select\",\n      label: \"Sentence structure\",\n      values: [\n        {\n          value: \"oneSentence\",\n          text: \"<name/pronoun> marriage[ to <spouse>] was registered <date> in <place>.\",\n        },\n        {\n          value: \"twoSentences\",\n          text: \"<name/pronoun> married[ <spouse>] <year(s)>. Their marriage was registered in <place>.\",\n        },\n        {\n          value: \"twoSentencesDate\",\n          text: \"<name/pronoun> married[ <spouse>] <year(s)>. Their marriage was registered <date> in <place>.\",\n        },\n      ],\n      defaultValue: \"oneSentence\",\n    },\n    narrativeRegistrationDistrictFormatOption,\n  ],\n};\n\nconst narrativeDeathOptionsGroup = {\n  category: \"narrative\",\n  subcategory: \"death\",\n  tab: \"narrative\",\n  subsection: \"death\",\n  options: [\n    narrativeRecordTypeNameOrPronounOption,\n    narrativeIncludeParentageOption,\n    narrativeParentageFormatOption,\n    narrativeIncludeAgeOption,\n    narrativeAgeFormatOption,\n  ],\n};\n\nconst narrativeDeathRegOptionsGroup = {\n  category: \"narrative\",\n  subcategory: \"deathReg\", // abbreviated to keep storage size of options down\n  tab: \"narrative\",\n  subsection: \"deathReg\",\n  options: [narrativeRecordTypeNameOrPronounOption, narrativeIncludeAgeOption, narrativeAgeFormatOption],\n};\n\nconst narrativeDeathRegEvtOptionsGroup = {\n  category: \"narrative\",\n  subcategory: \"deathRegEvt\", // abbreviated to keep storage size of options down\n  tab: \"narrative\",\n  subsection: \"deathReg\",\n  subheading: \"evt\",\n  options: [\n    {\n      optionName: \"sentenceStructure\",\n      type: \"select\",\n      label: \"Sentence structure\",\n      values: [{ value: \"oneSentence\", text: \"<name/pronoun> died <date> <place>.\" }],\n      defaultValue: \"oneSentence\",\n    },\n    narrativeIncludeParentageOption,\n    narrativeParentageFormatOption,\n  ],\n};\n\nconst narrativeDeathRegRegOptionsGroup = {\n  category: \"narrative\",\n  subcategory: \"deathRegReg\", // abbreviated to keep storage size of options down\n  tab: \"narrative\",\n  subsection: \"deathReg\",\n  subheading: \"reg\",\n  options: [\n    {\n      optionName: \"sentenceStructure\",\n      type: \"select\",\n      label: \"Sentence structure\",\n      values: [\n        {\n          value: \"oneSentence\",\n          text: \"<possessive name/pronoun> death was registered <date> in <place>.\",\n        },\n        {\n          value: \"twoSentences\",\n          text: \"<name/pronoun> died <date>. <possessive pronoun> death was registered in <place>.\",\n        },\n        {\n          value: \"twoSentencesDate\",\n          text: \"<name/pronoun> died <date>. <possessive pronoun> death was registered <date> in <place>.\",\n        },\n      ],\n      defaultValue: \"oneSentence\",\n    },\n    narrativeRegistrationDistrictFormatOption,\n  ],\n};\n\nconst narrativeBurialOptionsGroup = {\n  category: \"narrative\",\n  subcategory: \"burial\",\n  tab: \"narrative\",\n  subsection: \"burial\",\n  options: [\n    narrativeRecordTypeNameOrPronounOption,\n    narrativeIncludeParentageOption,\n    narrativeParentageFormatOption,\n    narrativeIncludeAgeOption,\n    narrativeAgeFormatOption,\n  ],\n};\n\nconst narrativeObituaryOptionsGroup = {\n  category: \"narrative\",\n  subcategory: \"obituary\",\n  tab: \"narrative\",\n  subsection: \"obituary\",\n  options: [\n    narrativeRecordTypeNameOrPronounOption,\n    narrativeIncludeParentageOption,\n    narrativeParentageFormatOption,\n    narrativeIncludeAgeOption,\n    narrativeAgeFormatOption,\n  ],\n};\n\nconst narrativeCensusOptionsGroup = {\n  category: \"narrative\",\n  subcategory: \"census\",\n  tab: \"narrative\",\n  subsection: \"census\",\n  options: [\n    narrativeRecordTypeNameOrPronounOption,\n    {\n      optionName: \"sentenceStructure\",\n      type: \"select\",\n      label: \"Main sentence structure\",\n      values: [\n        {\n          value: \"noComma\",\n          text: \"<census/date part> <name/pronoun>[ <agePart>][, <occupation>,] <was part> [<household part>] <in/on/at> <place>\",\n        },\n        {\n          value: \"comma\",\n          text: \"<census/date part>, <name/pronoun>[ <agePart>][, <occupation>,] <was part> [<household part>] <in/on/at> <place>\",\n        },\n      ],\n      defaultValue: \"noComma\",\n    },\n    {\n      optionName: \"censusDatePartFormat\",\n      type: \"select\",\n      label: \"Census/date part format\",\n      values: [\n        { value: \"inCensusTitle\", text: \"In the <census title>\" },\n        { value: \"inYearCensus\", text: \"In the <year> census\" },\n        { value: \"inYear\", text: \"In <year>\" },\n        { value: \"onDate\", text: \"On <date>\" },\n      ],\n      defaultValue: \"inYearCensus\",\n    },\n    narrativeIncludeAgeOption,\n    narrativeAgeFormatOption,\n    {\n      optionName: \"includeOccupation\",\n      type: \"select\",\n      label: \"Include occupation if known\",\n      values: [\n        { value: \"no\", text: \"No\" },\n        { value: \"inMainSentence\", text: \"In the main sentence\" },\n        {\n          value: \"inSeparateSentence\",\n          text: \"In a separate following sentence\",\n        },\n        {\n          value: \"inSeparateSentenceHead\",\n          text: \"In a separate following sentence. If no occupation give head's\",\n        },\n      ],\n      defaultValue: \"inMainSentence\",\n    },\n    {\n      optionName: \"wasPartFormat\",\n      type: \"select\",\n      label: \"Was part format\",\n      values: [\n        { value: \"was\", text: \"was\" },\n        { value: \"wasEnumerated\", text: \"was enumerated\" },\n        { value: \"wasRecorded\", text: \"was recorded\" },\n      ],\n      defaultValue: \"was\",\n    },\n    {\n      optionName: \"includeHousehold\",\n      type: \"select\",\n      label: \"Include household part in narrative\",\n      values: [\n        { value: \"no\", text: \"No\" },\n        { value: \"inMainSentence\", text: \"In the main sentence\" },\n        {\n          value: \"inSeparateSentence\",\n          text: \"In a separate following sentence\",\n        },\n      ],\n      defaultValue: \"inMainSentence\",\n    },\n    {\n      optionName: \"householdPartFormat\",\n      type: \"select\",\n      label: \"Household part format\",\n      values: [\n        { value: \"relationship\", text: \"the <relationship> of <name of head>\" },\n        { value: \"withFamily\", text: \"[with <describe close family members>]\" },\n      ],\n      defaultValue: \"relationship\",\n    },\n  ],\n};\n\n////////////////////////////////////////////////////////////////////////////////////////////////////\n// Household Table options groups\n////////////////////////////////////////////////////////////////////////////////////////////////////\n\nconst tableGeneralOptionsGroup = {\n  category: \"table\",\n  subcategory: \"general\",\n  tab: \"table\",\n  subsection: \"general\",\n  options: [\n    {\n      optionName: \"autoGenerate\",\n      type: \"select\",\n      label: \"Automatically add household table in census citations\",\n      values: [\n        { value: \"none\", text: \"No\" },\n        {\n          value: \"afterRef\",\n          text: \"After the ref (so it shows up in the biography)\",\n        },\n        {\n          value: \"afterRefBlankLine\",\n          text: \"After the ref with a blank line preceding it (so it shows up in the biography)\",\n        },\n        {\n          value: \"withinRefOrSource\",\n          text: \"Within the ref or source (so it shows up in sources section)\",\n        },\n        {\n          value: \"citationInTableCaption\",\n          text: \"Instead include the citation ref in the household table caption (requires caption option)\",\n        },\n      ],\n      defaultValue: \"none\",\n    },\n    {\n      optionName: \"format\",\n      type: \"select\",\n      label: \"How to layout the household data\",\n      values: [\n        { value: \"table\", text: \"Table\" },\n        { value: \"list\", text: \"List\" },\n        { value: \"sentence\", text: \"Sentence\" },\n      ],\n      defaultValue: \"table\",\n    },\n  ],\n};\n\nconst tableTableOptionsGroup = {\n  category: \"table\",\n  subcategory: \"table\",\n  tab: \"table\",\n  subsection: \"general\",\n  subheading: \"table\",\n  options: [\n    {\n      optionName: \"heading\",\n      type: \"select\",\n      label: \"Heading row\",\n      values: [\n        { value: \"none\", text: \"No heading row\" },\n        { value: \"plain\", text: \"Heading row with no highlight\" },\n        {\n          value: \"bgGreen\",\n          text: \"Heading row with *heading* background color\",\n        },\n        { value: \"boldCentered\", text: \"Heading row with bold centered text\" },\n        {\n          value: \"bgGreenBoldCentered\",\n          text: \"Heading row with *heading* background color and bold centered text\",\n        },\n      ],\n      defaultValue: \"bgGreen\",\n    },\n    {\n      optionName: \"selectedPerson\",\n      type: \"select\",\n      label: \"Selected person row\",\n      values: [\n        { value: \"plain\", text: \"No highlight for selected person\" },\n        { value: \"boldRow\", text: \"Selected person row in bold text\" },\n        {\n          value: \"boldCenteredRow\",\n          text: \"Selected person row in bold centered text\",\n        },\n        { value: \"boldName\", text: \"Selected person name in bold text\" },\n        {\n          value: \"bgYellowRow\",\n          text: \"Selected person row with *selected* background color\",\n        },\n        {\n          value: \"bgYellowBoldRow\",\n          text: \"Selected person row with *selected* background color and bold text\",\n        },\n        {\n          value: \"bgYellowBoldCenteredRow\",\n          text: \"Selected person row with *selected* background color and bold centered text\",\n        },\n        {\n          value: \"bgYellowBoldName\",\n          text: \"Selected person row with *selected* background color and name in bold text\",\n        },\n      ],\n      defaultValue: \"boldRow\",\n    },\n    {\n      optionName: \"headingColor\",\n      type: \"color\",\n      label: \"Background color for heading row (if chosen above)\",\n      defaultValue: \"#E1F0B4\",\n    },\n    {\n      optionName: \"selectedColor\",\n      type: \"color\",\n      label: \"Background color for selected person row (if chosen above)\",\n      defaultValue: \"#ffffb3\",\n    },\n    {\n      optionName: \"closedColor\",\n      type: \"color\",\n      label: \"Background color for closed record row\",\n      defaultValue: \"#d0d0d0\",\n    },\n    {\n      optionName: \"border\",\n      type: \"checkbox\",\n      label: \"Include a border around the table\",\n      defaultValue: true,\n    },\n    {\n      optionName: \"padding\",\n      type: \"checkbox\",\n      label: \"Include padding in the table cells\",\n      defaultValue: true,\n      unitTestValue: false,\n    },\n    {\n      optionName: \"caption\",\n      type: \"select\",\n      label: \"Add a caption above the table\",\n      values: [\n        { value: \"none\", text: \"No caption\" },\n        { value: \"titlePlace\", text: \"<collection title>: <full place>\" },\n        {\n          value: \"titlePlaceNoCountry\",\n          text: \"<collection title>: <full place without country>\",\n        },\n        { value: \"datePlace\", text: \"<date of event>: <full place>\" },\n        {\n          value: \"datePlaceNoCountry\",\n          text: \"<date of event>: <full place without country>\",\n        },\n      ],\n      defaultValue: \"none\",\n    },\n  ],\n};\n\nconst tableListOptionsGroup = {\n  category: \"table\",\n  subcategory: \"list\",\n  tab: \"table\",\n  subsection: \"general\",\n  subheading: \"list\",\n  options: [\n    {\n      optionName: \"type\",\n      type: \"select\",\n      label: \"Type of list\",\n      values: [\n        { value: \"bullet\", text: \"Bulleted list (*)\" },\n        { value: \"bullet2\", text: \"Bulleted inner list (**)\" },\n        { value: \"number\", text: \"Numbered list (#)\" },\n        { value: \"bulletNumber\", text: \"Numbered inner list (*#)\" },\n        { value: \"indented1\", text: \"Indented lines (:)\" },\n        { value: \"indented2\", text: \"Twice indented lines (::)\" },\n      ],\n      defaultValue: \"indented2\",\n    },\n  ],\n};\n\nconst tableSentenceOptionsGroup = {\n  category: \"table\",\n  subcategory: \"sentence\",\n  tab: \"table\",\n  subsection: \"general\",\n  subheading: \"sentence\",\n  options: [\n    {\n      optionName: \"preamble\",\n      type: \"select\",\n      label: \"Preamble\",\n      values: [\n        { value: \"none\", text: \"None\" },\n        { value: \"included\", text: \"The household included\" },\n        { value: \"consisted\", text: \"The household consisted of\" },\n        { value: \"enumerated\", text: \"The household was enumerated as\" },\n      ],\n      defaultValue: \"none\",\n    },\n    {\n      optionName: \"includeRelationship\",\n      type: \"checkbox\",\n      label: \"Include relationship for each person (if known)\",\n      defaultValue: true,\n      unitTestValue: true,\n    },\n    {\n      optionName: \"includeAge\",\n      type: \"checkbox\",\n      label: \"Include age for each person (if known)\",\n      defaultValue: true,\n      unitTestValue: true,\n    },\n    {\n      optionName: \"lastItemPunctuation\",\n      type: \"select\",\n      label: \"Last member punctuation\",\n      values: [\n        { value: \"comma\", text: \"', '\" },\n        { value: \"and\", text: \"' and '\" },\n        { value: \"commaAnd\", text: \"', and '\" },\n      ],\n      defaultValue: \"comma\",\n    },\n  ],\n};\n\n////////////////////////////////////////////////////////////////////////////////////////////////////\n// Add/Merge options groups\n////////////////////////////////////////////////////////////////////////////////////////////////////\n\nconst addMergeGeneralOptionsGroup = {\n  category: \"addMerge\",\n  subcategory: \"general\",\n  tab: \"addMerge\",\n  subsection: \"general\",\n  options: [\n    {\n      optionName: \"splitForenames\",\n      type: \"select\",\n      label: \"Separate forenames into a first name and middle names\",\n      values: [\n        { value: \"never\", text: \"Never\" },\n        { value: \"always\", text: \"Always\" },\n        { value: \"countrySpecific\", text: \"Only for certain countries\" },\n      ],\n      defaultValue: \"countrySpecific\",\n    },\n  ],\n};\n\nconst addMergeAddPersonOptionsGroup = {\n  category: \"addMerge\",\n  subcategory: \"addPerson\",\n  tab: \"addMerge\",\n  subsection: \"addPerson\",\n  options: [\n    {\n      optionName: \"includeCitation\",\n      type: \"checkbox\",\n      label: \"Fill citation in appropriate field if filling from a citation\",\n      defaultValue: false,\n      unitTestValue: false,\n    },\n    {\n      optionName: \"includeProfileLink\",\n      type: \"checkbox\",\n      label: \"Add a link/template to the source profile in sources if filling from a profile\",\n      defaultValue: false,\n      unitTestValue: false,\n    },\n    {\n      optionName: \"generateIntro\",\n      type: \"select\",\n      label: \"Create an intro in the biography (Notes) field\",\n      values: [\n        { value: \"none\", text: \"No\" },\n        {\n          value: \"fromSavedData\",\n          text: \"Yes, with parent info based on the saved data only\",\n        },\n        {\n          value: \"fromPageData\",\n          text: \"Yes, with parent info based on the links on Edit Family page only\",\n        },\n        {\n          value: \"fromBoth\",\n          text: \"Yes, with parent info based on all available information\",\n        },\n      ],\n      defaultValue: \"none\",\n    },\n    {\n      optionName: \"includeLinks\",\n      type: \"checkbox\",\n      label: \"Include WikiTree person links in intro if available\",\n      defaultValue: false,\n      unitTestValue: false,\n    },\n    {\n      optionName: \"addDiedYoung\",\n      type: \"checkbox\",\n      label: \"Include Died Young sticker if person died aged 15 or less and no known spouse\",\n      defaultValue: false,\n      unitTestValue: false,\n    },\n  ],\n};\n\nconst addMergeMergeEditOptionsGroup = {\n  category: \"addMerge\",\n  subcategory: \"mergeEdit\",\n  tab: \"addMerge\",\n  subsection: \"mergeEdit\",\n  options: [\n    {\n      optionName: \"includeCitation\",\n      type: \"checkbox\",\n      label: \"Put citation text in biography if merging from a citation.\",\n      defaultValue: false,\n      unitTestValue: false,\n    },\n    {\n      optionName: \"includeProfileLink\",\n      type: \"checkbox\",\n      label: \"Add a link/template to the biography if merging from a profile\",\n      defaultValue: false,\n      unitTestValue: false,\n    },\n  ],\n};\n\n(0,_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerSubsectionForOptions)(\"search\", \"general\", \"General\");\n\n(0,_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerSubsectionForOptions)(\"citation\", \"general\", \"General\");\n\n(0,_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerSubsectionForOptions)(\"narrative\", \"general\", \"General\");\n(0,_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerSubsectionForOptions)(\"narrative\", \"baptism\", \"Baptism\");\n(0,_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerSubsectionForOptions)(\"narrative\", \"birth\", \"Birth\");\n(0,_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerSubsectionForOptions)(\"narrative\", \"birthOrBaptism\", \"Birth or Baptism\");\n(0,_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerSubsectionForOptions)(\"narrative\", \"birthReg\", \"Birth Registration\");\n(0,_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerSubheadingForOptions)(\"narrative\", \"birthReg\", \"evt\", \"When date and place are for birth event\");\n(0,_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerSubheadingForOptions)(\"narrative\", \"birthReg\", \"reg\", \"When date and place are for registration, not birth\");\n(0,_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerSubsectionForOptions)(\"narrative\", \"burial\", \"Burial\");\n(0,_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerSubsectionForOptions)(\"narrative\", \"census\", \"Census\");\n(0,_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerSubsectionForOptions)(\"narrative\", \"death\", \"Death\");\n(0,_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerSubsectionForOptions)(\"narrative\", \"deathReg\", \"Death Registration\");\n(0,_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerSubheadingForOptions)(\"narrative\", \"deathReg\", \"evt\", \"When date and place are for death event\");\n(0,_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerSubheadingForOptions)(\"narrative\", \"deathReg\", \"reg\", \"When date and place are for registration, not death\");\n(0,_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerSubsectionForOptions)(\"narrative\", \"marriage\", \"Marriage\");\n(0,_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerSubsectionForOptions)(\"narrative\", \"marriageReg\", \"Marriage Registration\");\n(0,_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerSubheadingForOptions)(\"narrative\", \"marriageReg\", \"evt\", \"When date and place are for marriage event\");\n(0,_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerSubheadingForOptions)(\n  \"narrative\",\n  \"marriageReg\",\n  \"reg\",\n  \"When date and place are for registration, not marriage\"\n);\n(0,_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerSubsectionForOptions)(\"narrative\", \"obituary\", \"Obituary\");\n\n(0,_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerSubsectionForOptions)(\"table\", \"general\", \"General\");\n(0,_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerSubheadingForOptions)(\"table\", \"general\", \"table\", \"When using a table\");\n(0,_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerSubheadingForOptions)(\"table\", \"general\", \"list\", \"When using a list\");\n(0,_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerSubheadingForOptions)(\"table\", \"general\", \"sentence\", \"When using a sentence\");\n\n(0,_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerSubsectionForOptions)(\"addMerge\", \"general\", \"General\");\n(0,_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerSubsectionForOptions)(\"addMerge\", \"addPerson\", \"Add Person\");\n(0,_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerSubsectionForOptions)(\"addMerge\", \"mergeEdit\", \"Merge/Edit\");\n\n(0,_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerOptionsGroup)(searchOptionsGroup);\n(0,_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerOptionsGroup)(citationOptionsGroup);\n\n(0,_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerOptionsGroup)(narrativeOptionsGroup);\n(0,_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerOptionsGroup)(narrativeBaptismOptionsGroup);\n(0,_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerOptionsGroup)(narrativeBirthOptionsGroup);\n(0,_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerOptionsGroup)(narrativeBirthOrBaptismOptionsGroup);\n(0,_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerOptionsGroup)(narrativeBirthRegOptionsGroup);\n(0,_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerOptionsGroup)(narrativeBirthRegEvtOptionsGroup);\n(0,_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerOptionsGroup)(narrativeBirthRegRegOptionsGroup);\n(0,_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerOptionsGroup)(narrativeBurialOptionsGroup);\n(0,_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerOptionsGroup)(narrativeCensusOptionsGroup);\n(0,_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerOptionsGroup)(narrativeDeathOptionsGroup);\n(0,_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerOptionsGroup)(narrativeDeathRegOptionsGroup);\n(0,_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerOptionsGroup)(narrativeDeathRegEvtOptionsGroup);\n(0,_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerOptionsGroup)(narrativeDeathRegRegOptionsGroup);\n(0,_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerOptionsGroup)(narrativeMarriageOptionsGroup);\n(0,_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerOptionsGroup)(narrativeMarriageRegOptionsGroup);\n(0,_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerOptionsGroup)(narrativeMarriageRegEvtOptionsGroup);\n(0,_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerOptionsGroup)(narrativeMarriageRegRegOptionsGroup);\n(0,_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerOptionsGroup)(narrativeObituaryOptionsGroup);\n\n(0,_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerOptionsGroup)(tableGeneralOptionsGroup);\n(0,_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerOptionsGroup)(tableTableOptionsGroup);\n(0,_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerOptionsGroup)(tableListOptionsGroup);\n(0,_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerOptionsGroup)(tableSentenceOptionsGroup);\n\n(0,_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerOptionsGroup)(addMergeGeneralOptionsGroup);\n(0,_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerOptionsGroup)(addMergeAddPersonOptionsGroup);\n(0,_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerOptionsGroup)(addMergeMergeEditOptionsGroup);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9leHRlbnNpb24vYmFzZS9jb3JlL29wdGlvbnMvcmVnaXN0ZXJfYmFzZV9vcHRpb25zLm1qcy5qcyIsIm1hcHBpbmdzIjoiOztBQUFBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFNZ0M7O0FBRWhDO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVLDZCQUE2QjtBQUN2QyxVQUFVLHlDQUF5QztBQUNuRCxVQUFVLHFDQUFxQztBQUMvQyxVQUFVLHlDQUF5QztBQUNuRDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVLDZCQUE2QjtBQUN2QztBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2REFBNkQ7QUFDN0QsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVCxVQUFVLGdFQUFnRTtBQUMxRTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVSxtREFBbUQsV0FBVztBQUN4RSxVQUFVLDBEQUEwRDtBQUNwRSxVQUFVLGdFQUFnRTtBQUMxRTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVUsb0NBQW9DO0FBQzlDLFVBQVUsb0NBQW9DO0FBQzlDO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVCxVQUFVLG1FQUFtRTtBQUM3RSxVQUFVLHNDQUFzQztBQUNoRDtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVSw4REFBOEQ7QUFDeEUsVUFBVSxvRUFBb0U7QUFDOUUsVUFBVSxxREFBcUQ7QUFDL0Q7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVLGlFQUFpRTtBQUMzRSxVQUFVLDBEQUEwRDtBQUNwRTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVUscUNBQXFDO0FBQy9DLFVBQVUsNkJBQTZCO0FBQ3ZDLFVBQVUsaUNBQWlDO0FBQzNDO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVUsMkJBQTJCO0FBQ3JDLFVBQVUsNkJBQTZCO0FBQ3ZDO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVCxVQUFVLDREQUE0RDtBQUN0RSxVQUFVLDREQUE0RDtBQUN0RTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVLHlCQUF5QjtBQUNuQyxVQUFVLDJCQUEyQjtBQUNyQztBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsTUFBTSxtRUFBbUU7QUFDekUsTUFBTSxzQ0FBc0M7QUFDNUM7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTSx5QkFBeUI7QUFDL0IsTUFBTSx1REFBdUQ7QUFDN0QsTUFBTSx1RUFBdUU7QUFDN0U7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU0sNERBQTREO0FBQ2xFLE1BQU0sZ0RBQWdEO0FBQ3RELE1BQU0sbUVBQW1FO0FBQ3pFO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTSx5QkFBeUI7QUFDL0IsTUFBTSx1REFBdUQ7QUFDN0QsTUFBTSx1RUFBdUU7QUFDN0U7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNLHlDQUF5QztBQUMvQyxNQUFNLDBDQUEwQztBQUNoRCxNQUFNLHVDQUF1QztBQUM3QyxNQUFNLDJDQUEyQztBQUNqRCxNQUFNLDRDQUE0QztBQUNsRCxNQUFNLHlDQUF5QztBQUMvQztBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxpRUFBaUU7QUFDakUsU0FBUztBQUNUO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQixtRUFBbUU7QUFDcEY7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVLHVEQUF1RDtBQUNqRSxVQUFVLHFEQUFxRDtBQUMvRCxVQUFVLG9DQUFvQztBQUM5QyxVQUFVLG9DQUFvQztBQUM5QztBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVSx5QkFBeUI7QUFDbkMsVUFBVSx1REFBdUQ7QUFDakU7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVLDJCQUEyQjtBQUNyQyxVQUFVLGdEQUFnRDtBQUMxRCxVQUFVLDRDQUE0QztBQUN0RDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVLHlCQUF5QjtBQUNuQyxVQUFVLHVEQUF1RDtBQUNqRTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVSxxRUFBcUU7QUFDL0UsVUFBVSxxRUFBcUU7QUFDL0U7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVSwyQkFBMkI7QUFDckM7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVUsK0JBQStCO0FBQ3pDLFVBQVUsNkJBQTZCO0FBQ3ZDLFVBQVUscUNBQXFDO0FBQy9DO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVLHVDQUF1QztBQUNqRCxVQUFVLHVEQUF1RDtBQUNqRTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1QsVUFBVSxvRUFBb0U7QUFDOUU7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVUsMERBQTBEO0FBQ3BFLFVBQVUsNERBQTREO0FBQ3RFO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVCxVQUFVLDhEQUE4RDtBQUN4RTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVSxtQ0FBbUM7QUFDN0MsVUFBVSwrREFBK0Q7QUFDekU7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNULFVBQVUsMkRBQTJEO0FBQ3JFO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVSw0Q0FBNEM7QUFDdEQsVUFBVSxvREFBb0Q7QUFDOUQsVUFBVSw0Q0FBNEM7QUFDdEQs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aW9uRXh0cmFjdG9yLy4vZXh0ZW5zaW9uL2Jhc2UvY29yZS9vcHRpb25zL3JlZ2lzdGVyX2Jhc2Vfb3B0aW9ucy5tanM/NmZmZCJdLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuTUlUIExpY2Vuc2VcblxuQ29weXJpZ2h0IChjKSAyMDIwIFJvYmVydCBNIFBhdmV5XG5cblBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHlcbm9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlIFwiU29mdHdhcmVcIiksIHRvIGRlYWxcbmluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHNcbnRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGxcbmNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQgcGVyc29ucyB0byB3aG9tIHRoZSBTb2Z0d2FyZSBpc1xuZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczpcblxuVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW4gYWxsXG5jb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLlxuXG5USEUgU09GVFdBUkUgSVMgUFJPVklERUQgXCJBUyBJU1wiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SXG5JTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSxcbkZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRVxuQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUlxuTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSxcbk9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4gVEhFXG5TT0ZUV0FSRS5cbiovXG5cbmltcG9ydCB7XG4gIHJlZ2lzdGVyU3Vic2VjdGlvbkZvck9wdGlvbnMsXG4gIHJlZ2lzdGVyU3ViaGVhZGluZ0Zvck9wdGlvbnMsXG4gIHJlZ2lzdGVyT3B0aW9uc0dyb3VwLFxufSBmcm9tIFwiLi9vcHRpb25zX3JlZ2lzdHJ5Lm1qc1wiO1xuXG4vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBTZWFyY2ggb3B0aW9ucyBncm91cHNcbi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxuY29uc3Qgc2VhcmNoT3B0aW9uc0dyb3VwID0ge1xuICBjYXRlZ29yeTogXCJzZWFyY2hcIixcbiAgc3ViY2F0ZWdvcnk6IFwiZ2VuZXJhbFwiLFxuICB0YWI6IFwic2VhcmNoXCIsXG4gIHN1YnNlY3Rpb246IFwiZ2VuZXJhbFwiLFxuICBvcHRpb25zOiBbXG4gICAge1xuICAgICAgb3B0aW9uTmFtZTogXCJuZXdfd2luZG93XCIsXG4gICAgICB0eXBlOiBcImNoZWNrYm94XCIsXG4gICAgICBsYWJlbDogXCJPcGVuIHNlYXJjaCByZXN1bHRzIGluIGEgbmV3IHdpbmRvdyByYXRoZXIgdGhhbiBhIG5ldyB0YWJcIixcbiAgICAgIGRlZmF1bHRWYWx1ZTogZmFsc2UsXG4gICAgfSxcbiAgICB7XG4gICAgICBvcHRpb25OYW1lOiBcInBvcHVwX3Nob3dTYW1lU2l0ZVwiLFxuICAgICAgdHlwZTogXCJjaGVja2JveFwiLFxuICAgICAgbGFiZWw6IFwiT24gdGhlIHBvcHVwIHNob3cgYSBzZWFyY2ggbWVudSBpdGVtIGZvciB0aGUgc2l0ZSB0aGF0IHlvdSBhcmUgY3VycmVudGx5IG9uXCIsXG4gICAgICBkZWZhdWx0VmFsdWU6IHRydWUsXG4gICAgfSxcbiAgICB7XG4gICAgICBvcHRpb25OYW1lOiBcInBvcHVwX21heFNlYXJjaEl0ZW1zSW5Ub3BNZW51XCIsXG4gICAgICB0eXBlOiBcIm51bWJlclwiLFxuICAgICAgbGFiZWw6IFwiTWF4aW11bSBudW1iZXIgb2Ygc2VhcmNoIG1lbnUgaXRlbXMgdG8gc2hvdyBvbiB0b3AtbGV2ZWwgcG9wdXAgKDAgbWVhbnMganVzdCBzaG93IHNlYXJjaCBzdWJtZW51KVwiLFxuICAgICAgZGVmYXVsdFZhbHVlOiA4LFxuICAgIH0sXG4gICAge1xuICAgICAgb3B0aW9uTmFtZTogXCJtYXhMaWZlc3BhblwiLFxuICAgICAgdHlwZTogXCJudW1iZXJcIixcbiAgICAgIGxhYmVsOiBcIk1heGltdW0gbGlmZXNwYW4gdG8gY29uc2lkZXIgd2hlbiBidWlsZGluZyBzZWFyY2ggZGF0ZS9hZ2UgcmFuZ2VzXCIsXG4gICAgICBkZWZhdWx0VmFsdWU6IDEyMCxcbiAgICB9LFxuICBdLFxufTtcblxuLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gQ2l0YXRpb24gb3B0aW9ucyBncm91cHNcbi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxuY29uc3QgY2l0YXRpb25PcHRpb25zR3JvdXAgPSB7XG4gIGNhdGVnb3J5OiBcImNpdGF0aW9uXCIsXG4gIHN1YmNhdGVnb3J5OiBcImdlbmVyYWxcIixcbiAgdGFiOiBcImNpdGF0aW9uXCIsXG4gIHN1YnNlY3Rpb246IFwiZ2VuZXJhbFwiLFxuICBvcHRpb25zOiBbXG4gICAge1xuICAgICAgb3B0aW9uTmFtZTogXCJtZWFuaW5nZnVsTmFtZXNcIixcbiAgICAgIHR5cGU6IFwic2VsZWN0XCIsXG4gICAgICBsYWJlbDogJ0FkZCBhIGxhYmVsIGF0IHRoZSBzdGFydCBvZiBlYWNoIHJlZmVyZW5jZSAodGhpcyBzaG93cyB1cCBpbiB0aGUgXCJTb3VyY2VzXCIgc2VjdGlvbiknLFxuICAgICAgdmFsdWVzOiBbXG4gICAgICAgIHsgdmFsdWU6IFwibm9uZVwiLCB0ZXh0OiBcIk5vbmVcIiB9LFxuICAgICAgICB7IHZhbHVlOiBcIm5vcm1hbFwiLCB0ZXh0OiBcIkluIG5vcm1hbCB0ZXh0XCIgfSxcbiAgICAgICAgeyB2YWx1ZTogXCJib2xkXCIsIHRleHQ6IFwiSW4gYm9sZCB0ZXh0XCIgfSxcbiAgICAgICAgeyB2YWx1ZTogXCJpdGFsaWNcIiwgdGV4dDogXCJJbiBpdGFsaWMgdGV4dFwiIH0sXG4gICAgICBdLFxuICAgICAgZGVmYXVsdFZhbHVlOiBcImJvbGRcIixcbiAgICB9LFxuICAgIHtcbiAgICAgIG9wdGlvbk5hbWU6IFwiY29tbWFJbnNpZGVRdW90ZXNcIixcbiAgICAgIHR5cGU6IFwiY2hlY2tib3hcIixcbiAgICAgIGxhYmVsOiBcIlB1dCBjb21tYXMgaW5zaWRlIHF1b3RhdGlvbiBtYXJrcyAob2xkIFVTIHR5cG9ncmFwaGljYWwgY29udmVudGlvbikgW0VFIHN0eWxlXVwiLFxuICAgICAgZGVmYXVsdFZhbHVlOiBmYWxzZSxcbiAgICB9LFxuICAgIHtcbiAgICAgIG9wdGlvbk5hbWU6IFwiYWRkRWVJdGVtVHlwZVwiLFxuICAgICAgdHlwZTogXCJjaGVja2JveFwiLFxuICAgICAgbGFiZWw6ICdBZGQgXCJkYXRhYmFzZVwiIG9yIFwiZGF0YWJhc2Ugd2l0aCBpbWFnZXNcIiBhZnRlciB0aGUgZGF0YWJhc2UvY29sbGVjdGlvbiB0aXRsZSBbRUUgc3R5bGVdJyxcbiAgICAgIGRlZmF1bHRWYWx1ZTogZmFsc2UsXG4gICAgfSxcbiAgICB7XG4gICAgICBvcHRpb25OYW1lOiBcInJlZmVyZW5jZVBvc2l0aW9uXCIsXG4gICAgICB0eXBlOiBcInNlbGVjdFwiLFxuICAgICAgbGFiZWw6IFwiUGxhY2UgdGhlIHNvdXJjZSByZWZlcmVuY2UgZGF0YVwiLFxuICAgICAgdmFsdWVzOiBbXG4gICAgICAgIHtcbiAgICAgICAgICB2YWx1ZTogXCJhZnRlclNvdXJjZVRpdGxlXCIsXG4gICAgICAgICAgdGV4dDogXCJBZnRlciB0aGUgZGF0YWJhc2UvY29sbGVjdGlvbiB0aXRsZVwiLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgdmFsdWU6IFwiYXRFbmRcIixcbiAgICAgICAgICB0ZXh0OiBcIkF0IHRoZSBlbmQgb2YgdGhlIGNpdGF0aW9uIChkaXNhYmxlcyBkYXRhIHRhYmxlKSBbRUUgU3R5bGVdXCIsXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgICAgZGVmYXVsdFZhbHVlOiBcImFmdGVyU291cmNlVGl0bGVcIixcbiAgICB9LFxuICAgIHtcbiAgICAgIG9wdGlvbk5hbWU6IFwiYWRkQWNjZXNzZWREYXRlXCIsXG4gICAgICB0eXBlOiBcInNlbGVjdFwiLFxuICAgICAgbGFiZWw6IFwiQWRkIGFuIGFjY2Vzc2VkIGRhdGUgdG8gY2l0YXRpb25cIixcbiAgICAgIHZhbHVlczogW1xuICAgICAgICB7IHZhbHVlOiBcIm5vbmVcIiwgdGV4dDogXCJOb25lXCIgfSxcbiAgICAgICAge1xuICAgICAgICAgIHZhbHVlOiBcInBhcmVuQWZ0ZXJMaW5rXCIsXG4gICAgICAgICAgdGV4dDogXCJJbiBmb3JtICc8bGluaz4gKGFjY2Vzc2VkIDE1IEp1bmUgMjAyMiknXCIsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICB2YWx1ZTogXCJwYXJlbkJlZm9yZUxpbmtcIixcbiAgICAgICAgICB0ZXh0OiBcIkluIGZvcm0gJyg8bGluaz4gOiBhY2Nlc3NlZCAxNSBKdW5lIDIwMjIpJyBbRUUgc3R5bGVdXCIsXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgICAgZGVmYXVsdFZhbHVlOiBcInBhcmVuQWZ0ZXJMaW5rXCIsXG4gICAgfSxcbiAgICB7XG4gICAgICBvcHRpb25OYW1lOiBcInNvdXJjZVJlZmVyZW5jZVNlcGFyYXRvclwiLFxuICAgICAgdHlwZTogXCJzZWxlY3RcIixcbiAgICAgIGxhYmVsOiBcIlNlcGFyYXRvcnMgdG8gdXNlIGJldHdlZW4gcGFydHMgb2YgdGhlIHNvdXJjZSByZWZlcmVuY2UgZGF0YVwiLFxuICAgICAgdmFsdWVzOiBbXG4gICAgICAgIHtcbiAgICAgICAgICB2YWx1ZTogXCJzZW1pY29sb25cIixcbiAgICAgICAgICB0ZXh0OiBcIlNlbWktY29sb24gKGFuZCBjb2xvbiBpZiBrZXkvdmFsdWUgcGFpcikgKDsgUGFnZTogMilcIixcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIHZhbHVlOiBcImNvbW1hQ29sb25cIixcbiAgICAgICAgICB0ZXh0OiBcIkNvbW1hIGFuZCAoYW5kIGNvbG9uIGlmIGtleS92YWx1ZSBwYWlyKSAoLCBQYWdlOiAyKVwiLFxuICAgICAgICB9LFxuICAgICAgICB7IHZhbHVlOiBcImNvbW1hU3BhY2VcIiwgdGV4dDogXCJDb21tYSBvbmx5ICgsIFBhZ2UgMikgW0VFIHN0eWxlP11cIiB9LFxuICAgICAgICB7XG4gICAgICAgICAgdmFsdWU6IFwic2l0ZVN0eWxlXCIsXG4gICAgICAgICAgdGV4dDogXCJGb2xsb3cgdGhlIHN0eWxlIG9mIHRoZSBzaXRlIGJlaW5nIGNpdGVkIChpZiBhbnksIGVsc2Ugc2VtaS1jb2xvbilcIixcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgICBkZWZhdWx0VmFsdWU6IFwic2VtaWNvbG9uXCIsXG4gICAgfSxcbiAgICB7XG4gICAgICBvcHRpb25OYW1lOiBcImRhdGFMaXN0U2VwYXJhdG9yXCIsXG4gICAgICB0eXBlOiBcInNlbGVjdFwiLFxuICAgICAgbGFiZWw6IFwiU2VwYXJhdG9ycyB0byB1c2UgZm9yIGtleS92YWx1ZSBwYWlycyBpbiBkYXRhIGxpc3QgKGlmIGxpc3QgdXNlZCByYXRoZXIgdGhhbiBzZW50ZW5jZSBvciB0YWJsZSlcIixcbiAgICAgIHZhbHVlczogW1xuICAgICAgICB7IHZhbHVlOiBcInNlbWljb2xvblwiLCB0ZXh0OiBcIlNlbWktY29sb24gYW5kIGNvbG9uICg7IEFnZTogMjApXCIgfSxcbiAgICAgICAgeyB2YWx1ZTogXCJjb21tYUNvbG9uXCIsIHRleHQ6IFwiQ29tbWEgYW5kIGNvbG9uICgsIEFnZTogMjApXCIgfSxcbiAgICAgICAgeyB2YWx1ZTogXCJjb21tYVNwYWNlXCIsIHRleHQ6IFwiQ29tbWEgb25seSAoLCBBZ2UgMjApIFtFRSBzdHlsZT9dXCIgfSxcbiAgICAgIF0sXG4gICAgICBkZWZhdWx0VmFsdWU6IFwic2VtaWNvbG9uXCIsXG4gICAgfSxcbiAgICB7XG4gICAgICBvcHRpb25OYW1lOiBcImFkZE5ld2xpbmVzV2l0aGluUmVmc1wiLFxuICAgICAgdHlwZTogXCJjaGVja2JveFwiLFxuICAgICAgbGFiZWw6XG4gICAgICAgIFwiQWRkIG5ld2xpbmVzIGFmdGVyIHRoZSA8cmVmPiBhbmQgYmVmb3JlIHRoZSA8L3JlZj4gKGZvciByZWFkYWJpbGl0eSBpbiBlZGl0IG1vZGUsIG5vIGVmZmVjdCBpbiByZWFkIG1vZGUpXCIsXG4gICAgICBkZWZhdWx0VmFsdWU6IHRydWUsXG4gICAgfSxcbiAgICB7XG4gICAgICBvcHRpb25OYW1lOiBcImFkZE5ld2xpbmVzV2l0aGluQm9keVwiLFxuICAgICAgdHlwZTogXCJjaGVja2JveFwiLFxuICAgICAgbGFiZWw6IFwiQWRkIG5ld2xpbmVzIHdpdGhpbiB0aGUgY2l0YXRpb24gYmV0d2VlbiBzZWN0aW9ucyAoZm9yIHJlYWRhYmlsaXR5IGluIGVkaXQgbW9kZSwgbm8gZWZmZWN0IGluIHJlYWQgbW9kZSlcIixcbiAgICAgIGRlZmF1bHRWYWx1ZTogdHJ1ZSxcbiAgICB9LFxuICAgIHtcbiAgICAgIG9wdGlvbk5hbWU6IFwiYWRkQnJlYWtzV2l0aGluQm9keVwiLFxuICAgICAgdHlwZTogXCJjaGVja2JveFwiLFxuICAgICAgbGFiZWw6IFwiQWRkIDxici8+cyB3aXRoaW4gdGhlIGNpdGF0aW9uIGJldHdlZW4gc2VjdGlvbnMgKGZvciByZWFkYWJpbGl0eSBpbiByZWFkIG1vZGUpXCIsXG4gICAgICBkZWZhdWx0VmFsdWU6IHRydWUsXG4gICAgfSxcbiAgXSxcbn07XG5cbi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIE5hcnJhdGl2ZSBvcHRpb25zIGdyb3Vwc1xuLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG5jb25zdCBuYXJyYXRpdmVPcHRpb25zR3JvdXAgPSB7XG4gIGNhdGVnb3J5OiBcIm5hcnJhdGl2ZVwiLFxuICBzdWJjYXRlZ29yeTogXCJnZW5lcmFsXCIsXG4gIHRhYjogXCJuYXJyYXRpdmVcIixcbiAgc3Vic2VjdGlvbjogXCJnZW5lcmFsXCIsXG4gIG9wdGlvbnM6IFtcbiAgICB7XG4gICAgICBvcHRpb25OYW1lOiBcInNwZWxsaW5nXCIsXG4gICAgICB0eXBlOiBcInNlbGVjdFwiLFxuICAgICAgbGFiZWw6IFwiU3BlbGxpbmdcIixcbiAgICAgIHZhbHVlczogW1xuICAgICAgICB7IHZhbHVlOiBcImVuX3VrXCIsIHRleHQ6IFwiVUsgRW5nbGlzaFwiIH0sXG4gICAgICAgIHsgdmFsdWU6IFwiZW5fdXNcIiwgdGV4dDogXCJVUyBFbmdsaXNoXCIgfSxcbiAgICAgIF0sXG4gICAgICBkZWZhdWx0VmFsdWU6IFwiZW5fdWtcIixcbiAgICB9LFxuICAgIHtcbiAgICAgIG9wdGlvbk5hbWU6IFwibmFtZU9yUHJvbm91blwiLFxuICAgICAgdHlwZTogXCJzZWxlY3RcIixcbiAgICAgIGxhYmVsOiBcIk5hbWUvcHJvbm91biB0byB1c2UgaW4gbmFycmF0aXZlIGV2ZW50c1wiLFxuICAgICAgdmFsdWVzOiBbXG4gICAgICAgIHtcbiAgICAgICAgICB2YWx1ZTogXCJmaXJzdE5hbWVcIixcbiAgICAgICAgICB0ZXh0OiBcIkZpcnN0IG5hbWUgKHNpbmdsZSB3b3JkKSwgaWYgbm90IGtub3duIHVzZSBsYXN0IG5hbWVcIixcbiAgICAgICAgfSxcbiAgICAgICAgeyB2YWx1ZTogXCJmb3JlbmFtZXNcIiwgdGV4dDogXCJGb3JlbmFtZXMsIGlmIG5vdCBrbm93biB1c2UgbGFzdCBuYW1lXCIgfSxcbiAgICAgICAgeyB2YWx1ZTogXCJmdWxsTmFtZVwiLCB0ZXh0OiBcIkZ1bGwgbmFtZVwiIH0sXG4gICAgICAgIHtcbiAgICAgICAgICB2YWx1ZTogXCJwcm9ub3VuXCIsXG4gICAgICAgICAgdGV4dDogXCJQcm9ub3VuIChoZS9zaGUpLCBpZiBub3Qga25vd24gdXNlIGZpcnN0IG5hbWVcIixcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgICBkZWZhdWx0VmFsdWU6IFwiZmlyc3ROYW1lXCIsXG4gICAgfSxcbiAgICB7XG4gICAgICBvcHRpb25OYW1lOiBcImNvdW50cnlcIixcbiAgICAgIHR5cGU6IFwic2VsZWN0XCIsXG4gICAgICBsYWJlbDogXCJJbmNsdWRlIGNvdW50cnkgaW4gcGxhY2UgbmFtZXMgaW4gbmFycmF0aXZlIGV2ZW50cyAoaWYga25vd24pXCIsXG4gICAgICB2YWx1ZXM6IFtcbiAgICAgICAgeyB2YWx1ZTogXCJmdWxsXCIsIHRleHQ6IFwiSW5jbHVkZSBjb3VudHJ5IGFzIHJlY29yZGVkIGluIHJlY29yZFwiIH0sXG4gICAgICAgIHsgdmFsdWU6IFwic3RhbmRhcmRcIiwgdGV4dDogXCJVc2Ugc3RhbmRhcmRpemVkIG9yIGFiYnJldmlhdGVkIGNvdW50cnlcIiB9LFxuICAgICAgICB7IHZhbHVlOiBcIm5vbmVcIiwgdGV4dDogXCJPbWl0IGNvdW50cnkgZnJvbSBwbGFjZSBuYW1lXCIgfSxcbiAgICAgIF0sXG4gICAgICBkZWZhdWx0VmFsdWU6IFwic3RhbmRhcmRcIixcbiAgICAgIHVuaXRUZXN0VmFsdWU6IFwiZnVsbFwiLFxuICAgIH0sXG4gICAge1xuICAgICAgb3B0aW9uTmFtZTogXCJkYXRlRm9ybWF0XCIsXG4gICAgICB0eXBlOiBcInNlbGVjdFwiLFxuICAgICAgbGFiZWw6IFwiRGF0ZSBmb3JtYXQgaW4gbmFycmF0aXZlIHN0cmluZ1wiLFxuICAgICAgdmFsdWVzOiBbXG4gICAgICAgIHsgdmFsdWU6IFwibG9uZ1wiLCB0ZXh0OiBcImRkIE1vbnRoIHl5eXkgKGUuZy4gJzEyIFNlcHRlbWJlciAxODQ1JylcIiB9LFxuICAgICAgICB7IHZhbHVlOiBcInNob3J0XCIsIHRleHQ6IFwiZGQgTW1tIHl5eXkgKGUuZy4gJzEyIFNlcCAxODQ1JylcIiB9LFxuICAgICAgICB7XG4gICAgICAgICAgdmFsdWU6IFwidGhlTnRoXCIsXG4gICAgICAgICAgdGV4dDogXCJ0aGUgZGR0aCBvZiBNb250aCB5eXl5IChlLmcuICd0aGUgMTJ0aCBvZiBTZXB0ZW1iZXIgMTg0NScpXCIsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICB2YWx1ZTogXCJtb250aENvbW1hXCIsXG4gICAgICAgICAgdGV4dDogXCJNb250aCBkZCwgeXl5eSAoZS5nLiAnU2VwdGVtYmVyIDEyLCAxODQ1JylcIixcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIHZhbHVlOiBcIm1vbnRoQ29tbWFOdGhcIixcbiAgICAgICAgICB0ZXh0OiBcIk1vbnRoIGRkdGgsIHl5eXkgKGUuZy4gJ1NlcHRlbWJlciAxMnRoLCAxODQ1JylcIixcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIHZhbHVlOiBcImNvdW50cnlcIixcbiAgICAgICAgICB0ZXh0OiBcIkNvdW50cnkgc3BlY2lmaWMgKGUuZy4gJ1NlcHRlbWJlciAxMiwgMTg0NScgaW4gVVMsICcxMiBTZXB0ZW1iZXIgMTg0NScgZWxzZXdoZXJlKVwiLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgdmFsdWU6IFwiY291bnRyeU50aFwiLFxuICAgICAgICAgIHRleHQ6IFwiQ291bnRyeSBzcGVjaWZpYywgbG9uZyAoZS5nLiAnU2VwdGVtYmVyIDEydGgsIDE4NDUnIGluIFVTLCAndGhlIDEydGggb2YgU2VwdGVtYmVyIDE4NDUnIGVsc2V3aGVyZSlcIixcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgICBkZWZhdWx0VmFsdWU6IFwibG9uZ1wiLFxuICAgIH0sXG4gICAge1xuICAgICAgb3B0aW9uTmFtZTogXCJkYXRlSGlnaGxpZ2h0XCIsXG4gICAgICB0eXBlOiBcInNlbGVjdFwiLFxuICAgICAgbGFiZWw6IFwiSGlnaGxpZ2h0IHRoZSBkYXRlIGluIGEgbmFycmF0aXZlIHN0cmluZ1wiLFxuICAgICAgdmFsdWVzOiBbXG4gICAgICAgIHsgdmFsdWU6IFwibm9uZVwiLCB0ZXh0OiBcIk5vIGhpZ2hsaWdodFwiIH0sXG4gICAgICAgIHsgdmFsdWU6IFwiYm9sZFwiLCB0ZXh0OiBcIkJvbGRcIiB9LFxuICAgICAgICB7IHZhbHVlOiBcIml0YWxpY1wiLCB0ZXh0OiBcIkl0YWxpY1wiIH0sXG4gICAgICBdLFxuICAgICAgZGVmYXVsdFZhbHVlOiBcIm5vbmVcIixcbiAgICB9LFxuICAgIHtcbiAgICAgIG9wdGlvbk5hbWU6IFwicGFyZW50c1VzZUFtcE9yQW5kXCIsXG4gICAgICB0eXBlOiBcInNlbGVjdFwiLFxuICAgICAgbGFiZWw6IFwiU2VwYXJhdG9yIHRvIHVzZSBiZXR3ZWVuIHBhcmVudHNcIixcbiAgICAgIHZhbHVlczogW1xuICAgICAgICB7IHZhbHVlOiBcImFtcFwiLCB0ZXh0OiBcIiAmIFwiIH0sXG4gICAgICAgIHsgdmFsdWU6IFwiYW5kXCIsIHRleHQ6IFwiIGFuZCBcIiB9LFxuICAgICAgXSxcbiAgICAgIGRlZmF1bHRWYWx1ZTogXCJhbXBcIixcbiAgICB9LFxuICAgIHtcbiAgICAgIG9wdGlvbk5hbWU6IFwib2NjdXBhdGlvbkZvcm1hdFwiLFxuICAgICAgdHlwZTogXCJzZWxlY3RcIixcbiAgICAgIGxhYmVsOiBcIkNhc2UvZm9ybWF0IHRvIHVzZSBmb3Igb2NjdXBhdGlvbnNcIixcbiAgICAgIHZhbHVlczogW1xuICAgICAgICB7XG4gICAgICAgICAgdmFsdWU6IFwia2VlcENhc2VcIixcbiAgICAgICAgICB0ZXh0OiBcIktlZXAgY2FzZSBmcm9tIHJlY29yZCAod2l0aCBzb21lIGNsZWFudXApXCIsXG4gICAgICAgIH0sXG4gICAgICAgIHsgdmFsdWU6IFwidGl0bGVDYXNlXCIsIHRleHQ6IFwiVGl0bGUgQ2FzZSAoZS5nLiAnQ29hbCBNaW5lcicpXCIgfSxcbiAgICAgICAgeyB2YWx1ZTogXCJsb3dlckNhc2VcIiwgdGV4dDogXCJMb3dlciBDYXNlIChlLmcuICdjb2FsIG1pbmVyJylcIiB9LFxuICAgICAgXSxcbiAgICAgIGRlZmF1bHRWYWx1ZTogXCJrZWVwQ2FzZVwiLFxuICAgIH0sXG4gICAge1xuICAgICAgb3B0aW9uTmFtZTogXCJwbGFjZUNodXJjaEZpcnN0XCIsXG4gICAgICB0eXBlOiBcInNlbGVjdFwiLFxuICAgICAgbGFiZWw6IFwiQXR0ZW1wdCB0byBwdXQgY2h1cmNoIG5hbWUgYmVmb3JlIHRvd24gbmFtZSAoZm9yIGNlcnRhaW4gc2l0ZXMgYW5kIGNvdW50cmllcylcIixcbiAgICAgIHZhbHVlczogW1xuICAgICAgICB7IHZhbHVlOiBcIm5vXCIsIHRleHQ6IFwiTm9cIiB9LFxuICAgICAgICB7IHZhbHVlOiBcInllc1wiLCB0ZXh0OiBcIlllc1wiIH0sXG4gICAgICBdLFxuICAgICAgZGVmYXVsdFZhbHVlOiBcIm5vXCIsXG4gICAgfSxcbiAgXSxcbn07XG5cbmNvbnN0IG5hcnJhdGl2ZVJlY29yZFR5cGVOYW1lT3JQcm9ub3VuT3B0aW9uID0ge1xuICBvcHRpb25OYW1lOiBcIm5hbWVPclByb25vdW5cIixcbiAgdHlwZTogXCJzZWxlY3RcIixcbiAgbGFiZWw6IFwiTmFtZS9wcm9ub3VuIHRvIHVzZSBpbiBuYXJyYXRpdmUgZXZlbnRzXCIsXG4gIHZhbHVlczogW1xuICAgIHtcbiAgICAgIHZhbHVlOiBcImRlZmF1bHRcIixcbiAgICAgIHRleHQ6IFwiVXNlIGRlZmF1bHQgc3BlY2lmaWVkIGluIHRoZSAnR2VuZXJhbCcgc3Vic2VjdGlvblwiLFxuICAgIH0sXG4gICAge1xuICAgICAgdmFsdWU6IFwiZmlyc3ROYW1lXCIsXG4gICAgICB0ZXh0OiBcIkZpcnN0IG5hbWUgKHNpbmdsZSB3b3JkKSwgaWYgbm90IGtub3duIHVzZSBsYXN0IG5hbWVcIixcbiAgICB9LFxuICAgIHsgdmFsdWU6IFwiZm9yZW5hbWVzXCIsIHRleHQ6IFwiRm9yZW5hbWVzLCBpZiBub3Qga25vd24gdXNlIGxhc3QgbmFtZVwiIH0sXG4gICAgeyB2YWx1ZTogXCJmdWxsTmFtZVwiLCB0ZXh0OiBcIkZ1bGwgbmFtZVwiIH0sXG4gICAge1xuICAgICAgdmFsdWU6IFwicHJvbm91blwiLFxuICAgICAgdGV4dDogXCJQcm9ub3VuIChoZS9zaGUpLCBpZiBnZW5kZXIgbm90IGtub3duIHVzZSBmaXJzdCBuYW1lXCIsXG4gICAgfSxcbiAgXSxcbiAgZGVmYXVsdFZhbHVlOiBcImRlZmF1bHRcIixcbn07XG5cbmNvbnN0IG5hcnJhdGl2ZUluY2x1ZGVQYXJlbnRhZ2VPcHRpb24gPSB7XG4gIG9wdGlvbk5hbWU6IFwiaW5jbHVkZVBhcmVudGFnZVwiLFxuICB0eXBlOiBcInNlbGVjdFwiLFxuICBsYWJlbDogXCJJbmNsdWRlIHBhcmVudGFnZSBpZiBrbm93blwiLFxuICB2YWx1ZXM6IFtcbiAgICB7IHZhbHVlOiBcIm5vXCIsIHRleHQ6IFwiTm9cIiB9LFxuICAgIHsgdmFsdWU6IFwiaW5NYWluU2VudGVuY2VcIiwgdGV4dDogXCJJbiB0aGUgbWFpbiBzZW50ZW5jZVwiIH0sXG4gICAgeyB2YWx1ZTogXCJpblNlcGFyYXRlU2VudGVuY2VcIiwgdGV4dDogXCJJbiBhIHNlcGFyYXRlIGZvbGxvd2luZyBzZW50ZW5jZVwiIH0sXG4gIF0sXG4gIGRlZmF1bHRWYWx1ZTogXCJpbk1haW5TZW50ZW5jZVwiLFxufTtcblxuY29uc3QgbmFycmF0aXZlUGFyZW50YWdlRm9ybWF0T3B0aW9uID0ge1xuICBvcHRpb25OYW1lOiBcInBhcmVudGFnZUZvcm1hdFwiLFxuICB0eXBlOiBcInNlbGVjdFwiLFxuICBsYWJlbDogXCJQYXJlbnRhZ2UgZm9ybWF0IGlmIGluIG1haW4gc2VudGVuY2VcIixcbiAgdmFsdWVzOiBbXG4gICAge1xuICAgICAgdmFsdWU6IFwidHdvQ29tbWFzXCIsXG4gICAgICB0ZXh0OiBcIiwgPHNvbi9kYXVnaHRlci9jaGlsZD4gb2YgPHBhcmVudE5hbWUxPlsgJiA8cGFyZW50TmFtZTI+XSxcIixcbiAgICB9LFxuICAgIHtcbiAgICAgIHZhbHVlOiBcInRoZVR3b0NvbW1hc1wiLFxuICAgICAgdGV4dDogXCIsIHRoZSA8c29uL2RhdWdodGVyL2NoaWxkPiBvZiA8cGFyZW50TmFtZTE+WyAmIDxwYXJlbnROYW1lMj5dLFwiLFxuICAgIH0sXG4gIF0sXG4gIGRlZmF1bHRWYWx1ZTogXCJ0d29Db21tYXNcIixcbiAgY29tbWVudDpcbiAgICBcIk5PVEU6IFtzcXVhcmUgYnJhY2tldHNdIGluIG9wdGlvbnMgYWJvdmUgZGVub3RlIG9wdGlvbmFsIHBhcnRzIHRoYXQgYXJlIG9ubHkgcHJlc2VudCBpZiB0aGF0IGRhdGEgaXMga25vd24uXCIsXG59O1xuXG5jb25zdCBuYXJyYXRpdmVSZWdpc3RyYXRpb25EaXN0cmljdEZvcm1hdE9wdGlvbiA9IHtcbiAgb3B0aW9uTmFtZTogXCJyZWdEaXN0cmljdEZvcm1hdFwiLFxuICB0eXBlOiBcInNlbGVjdFwiLFxuICBsYWJlbDogXCJSZWdpc3RyYXRpb24gZGlzdHJpY3QgZm9ybWF0XCIsXG4gIHZhbHVlczogW1xuICAgIHsgdmFsdWU6IFwidGhlRGlzdHJpY3RcIiwgdGV4dDogXCJ0aGUgPGRpc3RyaWN0IG5hbWU+IGRpc3RyaWN0XCIgfSxcbiAgICB7IHZhbHVlOiBcImRpc3RyaWN0TmFtZVwiLCB0ZXh0OiBcIjxkaXN0cmljdCBuYW1lPlwiIH0sXG4gICAgeyB2YWx1ZTogXCJkaXN0cmljdENvdW50eVwiLCB0ZXh0OiBcIjxkaXN0cmljdCBuYW1lPlssIDxjb3VudHkgbmFtZT5dXCIgfSxcbiAgXSxcbiAgZGVmYXVsdFZhbHVlOiBcInRoZURpc3RyaWN0XCIsXG59O1xuXG5jb25zdCBuYXJyYXRpdmVJbmNsdWRlQWdlT3B0aW9uID0ge1xuICBvcHRpb25OYW1lOiBcImluY2x1ZGVBZ2VcIixcbiAgdHlwZTogXCJzZWxlY3RcIixcbiAgbGFiZWw6IFwiSW5jbHVkZSBhZ2UgaWYga25vd25cIixcbiAgdmFsdWVzOiBbXG4gICAgeyB2YWx1ZTogXCJub1wiLCB0ZXh0OiBcIk5vXCIgfSxcbiAgICB7IHZhbHVlOiBcImluTWFpblNlbnRlbmNlXCIsIHRleHQ6IFwiSW4gdGhlIG1haW4gc2VudGVuY2VcIiB9LFxuICAgIHsgdmFsdWU6IFwiaW5TZXBhcmF0ZVNlbnRlbmNlXCIsIHRleHQ6IFwiSW4gYSBzZXBhcmF0ZSBmb2xsb3dpbmcgc2VudGVuY2VcIiB9LFxuICBdLFxuICBkZWZhdWx0VmFsdWU6IFwiaW5NYWluU2VudGVuY2VcIixcbn07XG5cbmNvbnN0IG5hcnJhdGl2ZUFnZUZvcm1hdE9wdGlvbiA9IHtcbiAgb3B0aW9uTmFtZTogXCJhZ2VGb3JtYXRcIixcbiAgdHlwZTogXCJzZWxlY3RcIixcbiAgbGFiZWw6IFwiQWdlIGZvcm1hdFwiLFxuICB2YWx1ZXM6IFtcbiAgICB7IHZhbHVlOiBcInBhcmVuc0FnZVwiLCB0ZXh0OiBcIihhZ2UgPGFnZT4pXCIgfSxcbiAgICB7IHZhbHVlOiBcImNvbW1hc0FnZVwiLCB0ZXh0OiBcIiwgYWdlIDxhZ2U+LFwiIH0sXG4gICAgeyB2YWx1ZTogXCJwbGFpbkFnZVwiLCB0ZXh0OiBcIiBhZ2UgPGFnZT5cIiB9LFxuICAgIHsgdmFsdWU6IFwicGFyZW5zQWdlZFwiLCB0ZXh0OiBcIihhZ2VkIDxhZ2U+KVwiIH0sXG4gICAgeyB2YWx1ZTogXCJjb21tYXNBZ2VkXCIsIHRleHQ6IFwiLCBhZ2VkIDxhZ2U+LFwiIH0sXG4gICAgeyB2YWx1ZTogXCJwbGFpbkFnZWRcIiwgdGV4dDogXCIgYWdlZCA8YWdlPlwiIH0sXG4gIF0sXG4gIGRlZmF1bHRWYWx1ZTogXCJwYXJlbnNBZ2VcIixcbn07XG5cbi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFJlY29yZCB0eXBlIHNwZWNpZmljIG5hcnJhdGl2ZSBvcHRpb25zIGdyb3Vwc1xuLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuY29uc3QgbmFycmF0aXZlQmlydGhPcHRpb25zR3JvdXAgPSB7XG4gIGNhdGVnb3J5OiBcIm5hcnJhdGl2ZVwiLFxuICBzdWJjYXRlZ29yeTogXCJiaXJ0aFwiLFxuICB0YWI6IFwibmFycmF0aXZlXCIsXG4gIHN1YnNlY3Rpb246IFwiYmlydGhcIixcbiAgb3B0aW9uczogW25hcnJhdGl2ZVJlY29yZFR5cGVOYW1lT3JQcm9ub3VuT3B0aW9uLCBuYXJyYXRpdmVJbmNsdWRlUGFyZW50YWdlT3B0aW9uLCBuYXJyYXRpdmVQYXJlbnRhZ2VGb3JtYXRPcHRpb25dLFxufTtcblxuY29uc3QgbmFycmF0aXZlQmlydGhSZWdPcHRpb25zR3JvdXAgPSB7XG4gIGNhdGVnb3J5OiBcIm5hcnJhdGl2ZVwiLFxuICBzdWJjYXRlZ29yeTogXCJiaXJ0aFJlZ1wiLFxuICB0YWI6IFwibmFycmF0aXZlXCIsXG4gIHN1YnNlY3Rpb246IFwiYmlydGhSZWdcIixcbiAgb3B0aW9uczogW25hcnJhdGl2ZVJlY29yZFR5cGVOYW1lT3JQcm9ub3VuT3B0aW9uXSxcbn07XG5cbmNvbnN0IG5hcnJhdGl2ZUJpcnRoUmVnRXZ0T3B0aW9uc0dyb3VwID0ge1xuICBjYXRlZ29yeTogXCJuYXJyYXRpdmVcIixcbiAgc3ViY2F0ZWdvcnk6IFwiYmlydGhSZWdFdnRcIixcbiAgdGFiOiBcIm5hcnJhdGl2ZVwiLFxuICBzdWJzZWN0aW9uOiBcImJpcnRoUmVnXCIsXG4gIHN1YmhlYWRpbmc6IFwiZXZ0XCIsXG4gIG9wdGlvbnM6IFtcbiAgICB7XG4gICAgICBvcHRpb25OYW1lOiBcInNlbnRlbmNlU3RydWN0dXJlXCIsXG4gICAgICB0eXBlOiBcInNlbGVjdFwiLFxuICAgICAgbGFiZWw6IFwiU2VudGVuY2Ugc3RydWN0dXJlXCIsXG4gICAgICB2YWx1ZXM6IFtcbiAgICAgICAge1xuICAgICAgICAgIHZhbHVlOiBcIm9uZVNlbnRlbmNlXCIsXG4gICAgICAgICAgdGV4dDogXCI8bmFtZS9wcm9ub3VuPiB3YXMgYm9ybiA8ZGF0ZT4gPHBsYWNlPi5cIixcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgICBkZWZhdWx0VmFsdWU6IFwib25lU2VudGVuY2VcIixcbiAgICB9LFxuICAgIG5hcnJhdGl2ZUluY2x1ZGVQYXJlbnRhZ2VPcHRpb24sXG4gICAgbmFycmF0aXZlUGFyZW50YWdlRm9ybWF0T3B0aW9uLFxuICBdLFxufTtcblxuY29uc3QgbmFycmF0aXZlQmlydGhSZWdSZWdPcHRpb25zR3JvdXAgPSB7XG4gIGNhdGVnb3J5OiBcIm5hcnJhdGl2ZVwiLFxuICBzdWJjYXRlZ29yeTogXCJiaXJ0aFJlZ1JlZ1wiLFxuICB0YWI6IFwibmFycmF0aXZlXCIsXG4gIHN1YnNlY3Rpb246IFwiYmlydGhSZWdcIixcbiAgc3ViaGVhZGluZzogXCJyZWdcIixcbiAgb3B0aW9uczogW1xuICAgIHtcbiAgICAgIG9wdGlvbk5hbWU6IFwic2VudGVuY2VTdHJ1Y3R1cmVcIixcbiAgICAgIHR5cGU6IFwic2VsZWN0XCIsXG4gICAgICBsYWJlbDogXCJTZW50ZW5jZSBzdHJ1Y3R1cmVcIixcbiAgICAgIHZhbHVlczogW1xuICAgICAgICB7XG4gICAgICAgICAgdmFsdWU6IFwib25lU2VudGVuY2VcIixcbiAgICAgICAgICB0ZXh0OiBcIjxwb3NzZXNzaXZlIG5hbWUvcHJvbm91bj4gYmlydGggd2FzIHJlZ2lzdGVyZWQgPGRhdGU+IGluIDxwbGFjZT4uXCIsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICB2YWx1ZTogXCJ0d29TZW50ZW5jZXNcIixcbiAgICAgICAgICB0ZXh0OiBcIjxuYW1lL3Byb25vdW4+IHdhcyBib3JuIDxkYXRlPi4gPHBvc3Nlc3NpdmUgcHJvbm91bj4gYmlydGggd2FzIHJlZ2lzdGVyZWQgaW4gPHBsYWNlPi5cIixcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIHZhbHVlOiBcInR3b1NlbnRlbmNlc0RhdGVcIixcbiAgICAgICAgICB0ZXh0OiBcIjxuYW1lL3Byb25vdW4+IHdhcyBib3JuIDxkYXRlPi4gPHBvc3Nlc3NpdmUgcHJvbm91bj4gYmlydGggd2FzIHJlZ2lzdGVyZWQgPGRhdGU+IGluIDxwbGFjZT4uXCIsXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgICAgZGVmYXVsdFZhbHVlOiBcIm9uZVNlbnRlbmNlXCIsXG4gICAgfSxcbiAgICBuYXJyYXRpdmVSZWdpc3RyYXRpb25EaXN0cmljdEZvcm1hdE9wdGlvbixcbiAgXSxcbn07XG5cbmNvbnN0IG5hcnJhdGl2ZUJhcHRpc21PcHRpb25zR3JvdXAgPSB7XG4gIGNhdGVnb3J5OiBcIm5hcnJhdGl2ZVwiLFxuICBzdWJjYXRlZ29yeTogXCJiYXB0aXNtXCIsXG4gIHRhYjogXCJuYXJyYXRpdmVcIixcbiAgc3Vic2VjdGlvbjogXCJiYXB0aXNtXCIsXG4gIG9wdGlvbnM6IFtcbiAgICBuYXJyYXRpdmVSZWNvcmRUeXBlTmFtZU9yUHJvbm91bk9wdGlvbixcbiAgICB7XG4gICAgICBvcHRpb25OYW1lOiBcInNlbnRlbmNlU3RydWN0dXJlXCIsXG4gICAgICB0eXBlOiBcInNlbGVjdFwiLFxuICAgICAgbGFiZWw6IFwiU2VudGVuY2Ugc3RydWN0dXJlXCIsXG4gICAgICB2YWx1ZXM6IFtcbiAgICAgICAge1xuICAgICAgICAgIHZhbHVlOiBcInBhcmVudHNCb3JuQW5kQmFwXCIsXG4gICAgICAgICAgdGV4dDogXCI8bmFtZS9wcm9ub3VuPls8cGFyZW50YWdlPl0gd2FzWyBib3JuIG9uIDxkYXRlPiBhbmRdIGJhcHRpc2VkIG9uIDxkYXRlPiBpbiA8cGxhY2U+LlwiLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgdmFsdWU6IFwicGFyZW50c0Jvcm5TZW1pQmFwXCIsXG4gICAgICAgICAgdGV4dDogXCI8bmFtZS9wcm9ub3VuPls8cGFyZW50YWdlPl0gd2FzWyBib3JuIG9uIDxkYXRlPjtdIGJhcHRpc2VkIG9uIDxkYXRlPiBpbiA8cGxhY2U+LlwiLFxuICAgICAgICB9LFxuICAgICAgXSxcbiAgICAgIGRlZmF1bHRWYWx1ZTogXCJwYXJlbnRzQm9ybkFuZEJhcFwiLFxuICAgIH0sXG4gICAgbmFycmF0aXZlSW5jbHVkZVBhcmVudGFnZU9wdGlvbixcbiAgICBuYXJyYXRpdmVQYXJlbnRhZ2VGb3JtYXRPcHRpb24sXG4gICAge1xuICAgICAgb3B0aW9uTmFtZTogXCJpbmNsdWRlQmlydGhEYXRlXCIsXG4gICAgICB0eXBlOiBcImNoZWNrYm94XCIsXG4gICAgICBsYWJlbDogXCJJbmNsdWRlIGJpcnRoIGRhdGUgaWYga25vd25cIixcbiAgICAgIGRlZmF1bHRWYWx1ZTogdHJ1ZSxcbiAgICB9LFxuICAgIHtcbiAgICAgIG9wdGlvbk5hbWU6IFwiaW5jbHVkZURlYXRoRGF0ZVwiLFxuICAgICAgdHlwZTogXCJjaGVja2JveFwiLFxuICAgICAgbGFiZWw6IFwiSW5jbHVkZSBkZWF0aCBkYXRlIGlmIGtub3duXCIsXG4gICAgICBkZWZhdWx0VmFsdWU6IHRydWUsXG4gICAgfSxcbiAgXSxcbn07XG5cbmNvbnN0IG5hcnJhdGl2ZUJpcnRoT3JCYXB0aXNtT3B0aW9uc0dyb3VwID0ge1xuICBjYXRlZ29yeTogXCJuYXJyYXRpdmVcIixcbiAgc3ViY2F0ZWdvcnk6IFwiYmlydGhPckJhcHRpc21cIixcbiAgdGFiOiBcIm5hcnJhdGl2ZVwiLFxuICBzdWJzZWN0aW9uOiBcImJpcnRoT3JCYXB0aXNtXCIsXG4gIG9wdGlvbnM6IFtuYXJyYXRpdmVSZWNvcmRUeXBlTmFtZU9yUHJvbm91bk9wdGlvbiwgbmFycmF0aXZlSW5jbHVkZVBhcmVudGFnZU9wdGlvbiwgbmFycmF0aXZlUGFyZW50YWdlRm9ybWF0T3B0aW9uXSxcbn07XG5cbmNvbnN0IG5hcnJhdGl2ZU1hcnJpYWdlT3B0aW9uc0dyb3VwID0ge1xuICBjYXRlZ29yeTogXCJuYXJyYXRpdmVcIixcbiAgc3ViY2F0ZWdvcnk6IFwibWFycmlhZ2VcIixcbiAgdGFiOiBcIm5hcnJhdGl2ZVwiLFxuICBzdWJzZWN0aW9uOiBcIm1hcnJpYWdlXCIsXG4gIG9wdGlvbnM6IFtcbiAgICBuYXJyYXRpdmVSZWNvcmRUeXBlTmFtZU9yUHJvbm91bk9wdGlvbixcbiAgICBuYXJyYXRpdmVJbmNsdWRlUGFyZW50YWdlT3B0aW9uLFxuICAgIG5hcnJhdGl2ZVBhcmVudGFnZUZvcm1hdE9wdGlvbixcbiAgICBuYXJyYXRpdmVJbmNsdWRlQWdlT3B0aW9uLFxuICAgIG5hcnJhdGl2ZUFnZUZvcm1hdE9wdGlvbixcbiAgXSxcbn07XG5cbmNvbnN0IG5hcnJhdGl2ZU1hcnJpYWdlUmVnT3B0aW9uc0dyb3VwID0ge1xuICBjYXRlZ29yeTogXCJuYXJyYXRpdmVcIixcbiAgc3ViY2F0ZWdvcnk6IFwibWFycmlhZ2VSZWdcIixcbiAgdGFiOiBcIm5hcnJhdGl2ZVwiLFxuICBzdWJzZWN0aW9uOiBcIm1hcnJpYWdlUmVnXCIsXG4gIG9wdGlvbnM6IFtcbiAgICBuYXJyYXRpdmVSZWNvcmRUeXBlTmFtZU9yUHJvbm91bk9wdGlvbixcbiAgICBuYXJyYXRpdmVJbmNsdWRlUGFyZW50YWdlT3B0aW9uLFxuICAgIG5hcnJhdGl2ZVBhcmVudGFnZUZvcm1hdE9wdGlvbixcbiAgICBuYXJyYXRpdmVJbmNsdWRlQWdlT3B0aW9uLFxuICAgIG5hcnJhdGl2ZUFnZUZvcm1hdE9wdGlvbixcbiAgXSxcbn07XG5cbmNvbnN0IG5hcnJhdGl2ZU1hcnJpYWdlUmVnRXZ0T3B0aW9uc0dyb3VwID0ge1xuICBjYXRlZ29yeTogXCJuYXJyYXRpdmVcIixcbiAgc3ViY2F0ZWdvcnk6IFwibWFycmlhZ2VSZWdFdnRcIixcbiAgdGFiOiBcIm5hcnJhdGl2ZVwiLFxuICBzdWJzZWN0aW9uOiBcIm1hcnJpYWdlUmVnXCIsXG4gIHN1YmhlYWRpbmc6IFwiZXZ0XCIsXG4gIG9wdGlvbnM6IFtcbiAgICB7XG4gICAgICBvcHRpb25OYW1lOiBcInNlbnRlbmNlU3RydWN0dXJlXCIsXG4gICAgICB0eXBlOiBcInNlbGVjdFwiLFxuICAgICAgbGFiZWw6IFwiU2VudGVuY2Ugc3RydWN0dXJlXCIsXG4gICAgICB2YWx1ZXM6IFtcbiAgICAgICAge1xuICAgICAgICAgIHZhbHVlOiBcIm9uZVNlbnRlbmNlXCIsXG4gICAgICAgICAgdGV4dDogXCI8bmFtZS9wcm9ub3VuPiBtYXJyaWVkWyA8c3BvdXNlPl0gPGRhdGU+IDxwbGFjZT4uXCIsXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgICAgZGVmYXVsdFZhbHVlOiBcIm9uZVNlbnRlbmNlXCIsXG4gICAgfSxcbiAgXSxcbn07XG5cbmNvbnN0IG5hcnJhdGl2ZU1hcnJpYWdlUmVnUmVnT3B0aW9uc0dyb3VwID0ge1xuICBjYXRlZ29yeTogXCJuYXJyYXRpdmVcIixcbiAgc3ViY2F0ZWdvcnk6IFwibWFycmlhZ2VSZWdSZWdcIixcbiAgdGFiOiBcIm5hcnJhdGl2ZVwiLFxuICBzdWJzZWN0aW9uOiBcIm1hcnJpYWdlUmVnXCIsXG4gIHN1YmhlYWRpbmc6IFwicmVnXCIsXG4gIG9wdGlvbnM6IFtcbiAgICB7XG4gICAgICBvcHRpb25OYW1lOiBcInNlbnRlbmNlU3RydWN0dXJlXCIsXG4gICAgICB0eXBlOiBcInNlbGVjdFwiLFxuICAgICAgbGFiZWw6IFwiU2VudGVuY2Ugc3RydWN0dXJlXCIsXG4gICAgICB2YWx1ZXM6IFtcbiAgICAgICAge1xuICAgICAgICAgIHZhbHVlOiBcIm9uZVNlbnRlbmNlXCIsXG4gICAgICAgICAgdGV4dDogXCI8bmFtZS9wcm9ub3VuPiBtYXJyaWFnZVsgdG8gPHNwb3VzZT5dIHdhcyByZWdpc3RlcmVkIDxkYXRlPiBpbiA8cGxhY2U+LlwiLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgdmFsdWU6IFwidHdvU2VudGVuY2VzXCIsXG4gICAgICAgICAgdGV4dDogXCI8bmFtZS9wcm9ub3VuPiBtYXJyaWVkWyA8c3BvdXNlPl0gPHllYXIocyk+LiBUaGVpciBtYXJyaWFnZSB3YXMgcmVnaXN0ZXJlZCBpbiA8cGxhY2U+LlwiLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgdmFsdWU6IFwidHdvU2VudGVuY2VzRGF0ZVwiLFxuICAgICAgICAgIHRleHQ6IFwiPG5hbWUvcHJvbm91bj4gbWFycmllZFsgPHNwb3VzZT5dIDx5ZWFyKHMpPi4gVGhlaXIgbWFycmlhZ2Ugd2FzIHJlZ2lzdGVyZWQgPGRhdGU+IGluIDxwbGFjZT4uXCIsXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgICAgZGVmYXVsdFZhbHVlOiBcIm9uZVNlbnRlbmNlXCIsXG4gICAgfSxcbiAgICBuYXJyYXRpdmVSZWdpc3RyYXRpb25EaXN0cmljdEZvcm1hdE9wdGlvbixcbiAgXSxcbn07XG5cbmNvbnN0IG5hcnJhdGl2ZURlYXRoT3B0aW9uc0dyb3VwID0ge1xuICBjYXRlZ29yeTogXCJuYXJyYXRpdmVcIixcbiAgc3ViY2F0ZWdvcnk6IFwiZGVhdGhcIixcbiAgdGFiOiBcIm5hcnJhdGl2ZVwiLFxuICBzdWJzZWN0aW9uOiBcImRlYXRoXCIsXG4gIG9wdGlvbnM6IFtcbiAgICBuYXJyYXRpdmVSZWNvcmRUeXBlTmFtZU9yUHJvbm91bk9wdGlvbixcbiAgICBuYXJyYXRpdmVJbmNsdWRlUGFyZW50YWdlT3B0aW9uLFxuICAgIG5hcnJhdGl2ZVBhcmVudGFnZUZvcm1hdE9wdGlvbixcbiAgICBuYXJyYXRpdmVJbmNsdWRlQWdlT3B0aW9uLFxuICAgIG5hcnJhdGl2ZUFnZUZvcm1hdE9wdGlvbixcbiAgXSxcbn07XG5cbmNvbnN0IG5hcnJhdGl2ZURlYXRoUmVnT3B0aW9uc0dyb3VwID0ge1xuICBjYXRlZ29yeTogXCJuYXJyYXRpdmVcIixcbiAgc3ViY2F0ZWdvcnk6IFwiZGVhdGhSZWdcIiwgLy8gYWJicmV2aWF0ZWQgdG8ga2VlcCBzdG9yYWdlIHNpemUgb2Ygb3B0aW9ucyBkb3duXG4gIHRhYjogXCJuYXJyYXRpdmVcIixcbiAgc3Vic2VjdGlvbjogXCJkZWF0aFJlZ1wiLFxuICBvcHRpb25zOiBbbmFycmF0aXZlUmVjb3JkVHlwZU5hbWVPclByb25vdW5PcHRpb24sIG5hcnJhdGl2ZUluY2x1ZGVBZ2VPcHRpb24sIG5hcnJhdGl2ZUFnZUZvcm1hdE9wdGlvbl0sXG59O1xuXG5jb25zdCBuYXJyYXRpdmVEZWF0aFJlZ0V2dE9wdGlvbnNHcm91cCA9IHtcbiAgY2F0ZWdvcnk6IFwibmFycmF0aXZlXCIsXG4gIHN1YmNhdGVnb3J5OiBcImRlYXRoUmVnRXZ0XCIsIC8vIGFiYnJldmlhdGVkIHRvIGtlZXAgc3RvcmFnZSBzaXplIG9mIG9wdGlvbnMgZG93blxuICB0YWI6IFwibmFycmF0aXZlXCIsXG4gIHN1YnNlY3Rpb246IFwiZGVhdGhSZWdcIixcbiAgc3ViaGVhZGluZzogXCJldnRcIixcbiAgb3B0aW9uczogW1xuICAgIHtcbiAgICAgIG9wdGlvbk5hbWU6IFwic2VudGVuY2VTdHJ1Y3R1cmVcIixcbiAgICAgIHR5cGU6IFwic2VsZWN0XCIsXG4gICAgICBsYWJlbDogXCJTZW50ZW5jZSBzdHJ1Y3R1cmVcIixcbiAgICAgIHZhbHVlczogW3sgdmFsdWU6IFwib25lU2VudGVuY2VcIiwgdGV4dDogXCI8bmFtZS9wcm9ub3VuPiBkaWVkIDxkYXRlPiA8cGxhY2U+LlwiIH1dLFxuICAgICAgZGVmYXVsdFZhbHVlOiBcIm9uZVNlbnRlbmNlXCIsXG4gICAgfSxcbiAgICBuYXJyYXRpdmVJbmNsdWRlUGFyZW50YWdlT3B0aW9uLFxuICAgIG5hcnJhdGl2ZVBhcmVudGFnZUZvcm1hdE9wdGlvbixcbiAgXSxcbn07XG5cbmNvbnN0IG5hcnJhdGl2ZURlYXRoUmVnUmVnT3B0aW9uc0dyb3VwID0ge1xuICBjYXRlZ29yeTogXCJuYXJyYXRpdmVcIixcbiAgc3ViY2F0ZWdvcnk6IFwiZGVhdGhSZWdSZWdcIiwgLy8gYWJicmV2aWF0ZWQgdG8ga2VlcCBzdG9yYWdlIHNpemUgb2Ygb3B0aW9ucyBkb3duXG4gIHRhYjogXCJuYXJyYXRpdmVcIixcbiAgc3Vic2VjdGlvbjogXCJkZWF0aFJlZ1wiLFxuICBzdWJoZWFkaW5nOiBcInJlZ1wiLFxuICBvcHRpb25zOiBbXG4gICAge1xuICAgICAgb3B0aW9uTmFtZTogXCJzZW50ZW5jZVN0cnVjdHVyZVwiLFxuICAgICAgdHlwZTogXCJzZWxlY3RcIixcbiAgICAgIGxhYmVsOiBcIlNlbnRlbmNlIHN0cnVjdHVyZVwiLFxuICAgICAgdmFsdWVzOiBbXG4gICAgICAgIHtcbiAgICAgICAgICB2YWx1ZTogXCJvbmVTZW50ZW5jZVwiLFxuICAgICAgICAgIHRleHQ6IFwiPHBvc3Nlc3NpdmUgbmFtZS9wcm9ub3VuPiBkZWF0aCB3YXMgcmVnaXN0ZXJlZCA8ZGF0ZT4gaW4gPHBsYWNlPi5cIixcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIHZhbHVlOiBcInR3b1NlbnRlbmNlc1wiLFxuICAgICAgICAgIHRleHQ6IFwiPG5hbWUvcHJvbm91bj4gZGllZCA8ZGF0ZT4uIDxwb3NzZXNzaXZlIHByb25vdW4+IGRlYXRoIHdhcyByZWdpc3RlcmVkIGluIDxwbGFjZT4uXCIsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICB2YWx1ZTogXCJ0d29TZW50ZW5jZXNEYXRlXCIsXG4gICAgICAgICAgdGV4dDogXCI8bmFtZS9wcm9ub3VuPiBkaWVkIDxkYXRlPi4gPHBvc3Nlc3NpdmUgcHJvbm91bj4gZGVhdGggd2FzIHJlZ2lzdGVyZWQgPGRhdGU+IGluIDxwbGFjZT4uXCIsXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgICAgZGVmYXVsdFZhbHVlOiBcIm9uZVNlbnRlbmNlXCIsXG4gICAgfSxcbiAgICBuYXJyYXRpdmVSZWdpc3RyYXRpb25EaXN0cmljdEZvcm1hdE9wdGlvbixcbiAgXSxcbn07XG5cbmNvbnN0IG5hcnJhdGl2ZUJ1cmlhbE9wdGlvbnNHcm91cCA9IHtcbiAgY2F0ZWdvcnk6IFwibmFycmF0aXZlXCIsXG4gIHN1YmNhdGVnb3J5OiBcImJ1cmlhbFwiLFxuICB0YWI6IFwibmFycmF0aXZlXCIsXG4gIHN1YnNlY3Rpb246IFwiYnVyaWFsXCIsXG4gIG9wdGlvbnM6IFtcbiAgICBuYXJyYXRpdmVSZWNvcmRUeXBlTmFtZU9yUHJvbm91bk9wdGlvbixcbiAgICBuYXJyYXRpdmVJbmNsdWRlUGFyZW50YWdlT3B0aW9uLFxuICAgIG5hcnJhdGl2ZVBhcmVudGFnZUZvcm1hdE9wdGlvbixcbiAgICBuYXJyYXRpdmVJbmNsdWRlQWdlT3B0aW9uLFxuICAgIG5hcnJhdGl2ZUFnZUZvcm1hdE9wdGlvbixcbiAgXSxcbn07XG5cbmNvbnN0IG5hcnJhdGl2ZU9iaXR1YXJ5T3B0aW9uc0dyb3VwID0ge1xuICBjYXRlZ29yeTogXCJuYXJyYXRpdmVcIixcbiAgc3ViY2F0ZWdvcnk6IFwib2JpdHVhcnlcIixcbiAgdGFiOiBcIm5hcnJhdGl2ZVwiLFxuICBzdWJzZWN0aW9uOiBcIm9iaXR1YXJ5XCIsXG4gIG9wdGlvbnM6IFtcbiAgICBuYXJyYXRpdmVSZWNvcmRUeXBlTmFtZU9yUHJvbm91bk9wdGlvbixcbiAgICBuYXJyYXRpdmVJbmNsdWRlUGFyZW50YWdlT3B0aW9uLFxuICAgIG5hcnJhdGl2ZVBhcmVudGFnZUZvcm1hdE9wdGlvbixcbiAgICBuYXJyYXRpdmVJbmNsdWRlQWdlT3B0aW9uLFxuICAgIG5hcnJhdGl2ZUFnZUZvcm1hdE9wdGlvbixcbiAgXSxcbn07XG5cbmNvbnN0IG5hcnJhdGl2ZUNlbnN1c09wdGlvbnNHcm91cCA9IHtcbiAgY2F0ZWdvcnk6IFwibmFycmF0aXZlXCIsXG4gIHN1YmNhdGVnb3J5OiBcImNlbnN1c1wiLFxuICB0YWI6IFwibmFycmF0aXZlXCIsXG4gIHN1YnNlY3Rpb246IFwiY2Vuc3VzXCIsXG4gIG9wdGlvbnM6IFtcbiAgICBuYXJyYXRpdmVSZWNvcmRUeXBlTmFtZU9yUHJvbm91bk9wdGlvbixcbiAgICB7XG4gICAgICBvcHRpb25OYW1lOiBcInNlbnRlbmNlU3RydWN0dXJlXCIsXG4gICAgICB0eXBlOiBcInNlbGVjdFwiLFxuICAgICAgbGFiZWw6IFwiTWFpbiBzZW50ZW5jZSBzdHJ1Y3R1cmVcIixcbiAgICAgIHZhbHVlczogW1xuICAgICAgICB7XG4gICAgICAgICAgdmFsdWU6IFwibm9Db21tYVwiLFxuICAgICAgICAgIHRleHQ6IFwiPGNlbnN1cy9kYXRlIHBhcnQ+IDxuYW1lL3Byb25vdW4+WyA8YWdlUGFydD5dWywgPG9jY3VwYXRpb24+LF0gPHdhcyBwYXJ0PiBbPGhvdXNlaG9sZCBwYXJ0Pl0gPGluL29uL2F0PiA8cGxhY2U+XCIsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICB2YWx1ZTogXCJjb21tYVwiLFxuICAgICAgICAgIHRleHQ6IFwiPGNlbnN1cy9kYXRlIHBhcnQ+LCA8bmFtZS9wcm9ub3VuPlsgPGFnZVBhcnQ+XVssIDxvY2N1cGF0aW9uPixdIDx3YXMgcGFydD4gWzxob3VzZWhvbGQgcGFydD5dIDxpbi9vbi9hdD4gPHBsYWNlPlwiLFxuICAgICAgICB9LFxuICAgICAgXSxcbiAgICAgIGRlZmF1bHRWYWx1ZTogXCJub0NvbW1hXCIsXG4gICAgfSxcbiAgICB7XG4gICAgICBvcHRpb25OYW1lOiBcImNlbnN1c0RhdGVQYXJ0Rm9ybWF0XCIsXG4gICAgICB0eXBlOiBcInNlbGVjdFwiLFxuICAgICAgbGFiZWw6IFwiQ2Vuc3VzL2RhdGUgcGFydCBmb3JtYXRcIixcbiAgICAgIHZhbHVlczogW1xuICAgICAgICB7IHZhbHVlOiBcImluQ2Vuc3VzVGl0bGVcIiwgdGV4dDogXCJJbiB0aGUgPGNlbnN1cyB0aXRsZT5cIiB9LFxuICAgICAgICB7IHZhbHVlOiBcImluWWVhckNlbnN1c1wiLCB0ZXh0OiBcIkluIHRoZSA8eWVhcj4gY2Vuc3VzXCIgfSxcbiAgICAgICAgeyB2YWx1ZTogXCJpblllYXJcIiwgdGV4dDogXCJJbiA8eWVhcj5cIiB9LFxuICAgICAgICB7IHZhbHVlOiBcIm9uRGF0ZVwiLCB0ZXh0OiBcIk9uIDxkYXRlPlwiIH0sXG4gICAgICBdLFxuICAgICAgZGVmYXVsdFZhbHVlOiBcImluWWVhckNlbnN1c1wiLFxuICAgIH0sXG4gICAgbmFycmF0aXZlSW5jbHVkZUFnZU9wdGlvbixcbiAgICBuYXJyYXRpdmVBZ2VGb3JtYXRPcHRpb24sXG4gICAge1xuICAgICAgb3B0aW9uTmFtZTogXCJpbmNsdWRlT2NjdXBhdGlvblwiLFxuICAgICAgdHlwZTogXCJzZWxlY3RcIixcbiAgICAgIGxhYmVsOiBcIkluY2x1ZGUgb2NjdXBhdGlvbiBpZiBrbm93blwiLFxuICAgICAgdmFsdWVzOiBbXG4gICAgICAgIHsgdmFsdWU6IFwibm9cIiwgdGV4dDogXCJOb1wiIH0sXG4gICAgICAgIHsgdmFsdWU6IFwiaW5NYWluU2VudGVuY2VcIiwgdGV4dDogXCJJbiB0aGUgbWFpbiBzZW50ZW5jZVwiIH0sXG4gICAgICAgIHtcbiAgICAgICAgICB2YWx1ZTogXCJpblNlcGFyYXRlU2VudGVuY2VcIixcbiAgICAgICAgICB0ZXh0OiBcIkluIGEgc2VwYXJhdGUgZm9sbG93aW5nIHNlbnRlbmNlXCIsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICB2YWx1ZTogXCJpblNlcGFyYXRlU2VudGVuY2VIZWFkXCIsXG4gICAgICAgICAgdGV4dDogXCJJbiBhIHNlcGFyYXRlIGZvbGxvd2luZyBzZW50ZW5jZS4gSWYgbm8gb2NjdXBhdGlvbiBnaXZlIGhlYWQnc1wiLFxuICAgICAgICB9LFxuICAgICAgXSxcbiAgICAgIGRlZmF1bHRWYWx1ZTogXCJpbk1haW5TZW50ZW5jZVwiLFxuICAgIH0sXG4gICAge1xuICAgICAgb3B0aW9uTmFtZTogXCJ3YXNQYXJ0Rm9ybWF0XCIsXG4gICAgICB0eXBlOiBcInNlbGVjdFwiLFxuICAgICAgbGFiZWw6IFwiV2FzIHBhcnQgZm9ybWF0XCIsXG4gICAgICB2YWx1ZXM6IFtcbiAgICAgICAgeyB2YWx1ZTogXCJ3YXNcIiwgdGV4dDogXCJ3YXNcIiB9LFxuICAgICAgICB7IHZhbHVlOiBcIndhc0VudW1lcmF0ZWRcIiwgdGV4dDogXCJ3YXMgZW51bWVyYXRlZFwiIH0sXG4gICAgICAgIHsgdmFsdWU6IFwid2FzUmVjb3JkZWRcIiwgdGV4dDogXCJ3YXMgcmVjb3JkZWRcIiB9LFxuICAgICAgXSxcbiAgICAgIGRlZmF1bHRWYWx1ZTogXCJ3YXNcIixcbiAgICB9LFxuICAgIHtcbiAgICAgIG9wdGlvbk5hbWU6IFwiaW5jbHVkZUhvdXNlaG9sZFwiLFxuICAgICAgdHlwZTogXCJzZWxlY3RcIixcbiAgICAgIGxhYmVsOiBcIkluY2x1ZGUgaG91c2Vob2xkIHBhcnQgaW4gbmFycmF0aXZlXCIsXG4gICAgICB2YWx1ZXM6IFtcbiAgICAgICAgeyB2YWx1ZTogXCJub1wiLCB0ZXh0OiBcIk5vXCIgfSxcbiAgICAgICAgeyB2YWx1ZTogXCJpbk1haW5TZW50ZW5jZVwiLCB0ZXh0OiBcIkluIHRoZSBtYWluIHNlbnRlbmNlXCIgfSxcbiAgICAgICAge1xuICAgICAgICAgIHZhbHVlOiBcImluU2VwYXJhdGVTZW50ZW5jZVwiLFxuICAgICAgICAgIHRleHQ6IFwiSW4gYSBzZXBhcmF0ZSBmb2xsb3dpbmcgc2VudGVuY2VcIixcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgICBkZWZhdWx0VmFsdWU6IFwiaW5NYWluU2VudGVuY2VcIixcbiAgICB9LFxuICAgIHtcbiAgICAgIG9wdGlvbk5hbWU6IFwiaG91c2Vob2xkUGFydEZvcm1hdFwiLFxuICAgICAgdHlwZTogXCJzZWxlY3RcIixcbiAgICAgIGxhYmVsOiBcIkhvdXNlaG9sZCBwYXJ0IGZvcm1hdFwiLFxuICAgICAgdmFsdWVzOiBbXG4gICAgICAgIHsgdmFsdWU6IFwicmVsYXRpb25zaGlwXCIsIHRleHQ6IFwidGhlIDxyZWxhdGlvbnNoaXA+IG9mIDxuYW1lIG9mIGhlYWQ+XCIgfSxcbiAgICAgICAgeyB2YWx1ZTogXCJ3aXRoRmFtaWx5XCIsIHRleHQ6IFwiW3dpdGggPGRlc2NyaWJlIGNsb3NlIGZhbWlseSBtZW1iZXJzPl1cIiB9LFxuICAgICAgXSxcbiAgICAgIGRlZmF1bHRWYWx1ZTogXCJyZWxhdGlvbnNoaXBcIixcbiAgICB9LFxuICBdLFxufTtcblxuLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gSG91c2Vob2xkIFRhYmxlIG9wdGlvbnMgZ3JvdXBzXG4vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cbmNvbnN0IHRhYmxlR2VuZXJhbE9wdGlvbnNHcm91cCA9IHtcbiAgY2F0ZWdvcnk6IFwidGFibGVcIixcbiAgc3ViY2F0ZWdvcnk6IFwiZ2VuZXJhbFwiLFxuICB0YWI6IFwidGFibGVcIixcbiAgc3Vic2VjdGlvbjogXCJnZW5lcmFsXCIsXG4gIG9wdGlvbnM6IFtcbiAgICB7XG4gICAgICBvcHRpb25OYW1lOiBcImF1dG9HZW5lcmF0ZVwiLFxuICAgICAgdHlwZTogXCJzZWxlY3RcIixcbiAgICAgIGxhYmVsOiBcIkF1dG9tYXRpY2FsbHkgYWRkIGhvdXNlaG9sZCB0YWJsZSBpbiBjZW5zdXMgY2l0YXRpb25zXCIsXG4gICAgICB2YWx1ZXM6IFtcbiAgICAgICAgeyB2YWx1ZTogXCJub25lXCIsIHRleHQ6IFwiTm9cIiB9LFxuICAgICAgICB7XG4gICAgICAgICAgdmFsdWU6IFwiYWZ0ZXJSZWZcIixcbiAgICAgICAgICB0ZXh0OiBcIkFmdGVyIHRoZSByZWYgKHNvIGl0IHNob3dzIHVwIGluIHRoZSBiaW9ncmFwaHkpXCIsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICB2YWx1ZTogXCJhZnRlclJlZkJsYW5rTGluZVwiLFxuICAgICAgICAgIHRleHQ6IFwiQWZ0ZXIgdGhlIHJlZiB3aXRoIGEgYmxhbmsgbGluZSBwcmVjZWRpbmcgaXQgKHNvIGl0IHNob3dzIHVwIGluIHRoZSBiaW9ncmFwaHkpXCIsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICB2YWx1ZTogXCJ3aXRoaW5SZWZPclNvdXJjZVwiLFxuICAgICAgICAgIHRleHQ6IFwiV2l0aGluIHRoZSByZWYgb3Igc291cmNlIChzbyBpdCBzaG93cyB1cCBpbiBzb3VyY2VzIHNlY3Rpb24pXCIsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICB2YWx1ZTogXCJjaXRhdGlvbkluVGFibGVDYXB0aW9uXCIsXG4gICAgICAgICAgdGV4dDogXCJJbnN0ZWFkIGluY2x1ZGUgdGhlIGNpdGF0aW9uIHJlZiBpbiB0aGUgaG91c2Vob2xkIHRhYmxlIGNhcHRpb24gKHJlcXVpcmVzIGNhcHRpb24gb3B0aW9uKVwiLFxuICAgICAgICB9LFxuICAgICAgXSxcbiAgICAgIGRlZmF1bHRWYWx1ZTogXCJub25lXCIsXG4gICAgfSxcbiAgICB7XG4gICAgICBvcHRpb25OYW1lOiBcImZvcm1hdFwiLFxuICAgICAgdHlwZTogXCJzZWxlY3RcIixcbiAgICAgIGxhYmVsOiBcIkhvdyB0byBsYXlvdXQgdGhlIGhvdXNlaG9sZCBkYXRhXCIsXG4gICAgICB2YWx1ZXM6IFtcbiAgICAgICAgeyB2YWx1ZTogXCJ0YWJsZVwiLCB0ZXh0OiBcIlRhYmxlXCIgfSxcbiAgICAgICAgeyB2YWx1ZTogXCJsaXN0XCIsIHRleHQ6IFwiTGlzdFwiIH0sXG4gICAgICAgIHsgdmFsdWU6IFwic2VudGVuY2VcIiwgdGV4dDogXCJTZW50ZW5jZVwiIH0sXG4gICAgICBdLFxuICAgICAgZGVmYXVsdFZhbHVlOiBcInRhYmxlXCIsXG4gICAgfSxcbiAgXSxcbn07XG5cbmNvbnN0IHRhYmxlVGFibGVPcHRpb25zR3JvdXAgPSB7XG4gIGNhdGVnb3J5OiBcInRhYmxlXCIsXG4gIHN1YmNhdGVnb3J5OiBcInRhYmxlXCIsXG4gIHRhYjogXCJ0YWJsZVwiLFxuICBzdWJzZWN0aW9uOiBcImdlbmVyYWxcIixcbiAgc3ViaGVhZGluZzogXCJ0YWJsZVwiLFxuICBvcHRpb25zOiBbXG4gICAge1xuICAgICAgb3B0aW9uTmFtZTogXCJoZWFkaW5nXCIsXG4gICAgICB0eXBlOiBcInNlbGVjdFwiLFxuICAgICAgbGFiZWw6IFwiSGVhZGluZyByb3dcIixcbiAgICAgIHZhbHVlczogW1xuICAgICAgICB7IHZhbHVlOiBcIm5vbmVcIiwgdGV4dDogXCJObyBoZWFkaW5nIHJvd1wiIH0sXG4gICAgICAgIHsgdmFsdWU6IFwicGxhaW5cIiwgdGV4dDogXCJIZWFkaW5nIHJvdyB3aXRoIG5vIGhpZ2hsaWdodFwiIH0sXG4gICAgICAgIHtcbiAgICAgICAgICB2YWx1ZTogXCJiZ0dyZWVuXCIsXG4gICAgICAgICAgdGV4dDogXCJIZWFkaW5nIHJvdyB3aXRoICpoZWFkaW5nKiBiYWNrZ3JvdW5kIGNvbG9yXCIsXG4gICAgICAgIH0sXG4gICAgICAgIHsgdmFsdWU6IFwiYm9sZENlbnRlcmVkXCIsIHRleHQ6IFwiSGVhZGluZyByb3cgd2l0aCBib2xkIGNlbnRlcmVkIHRleHRcIiB9LFxuICAgICAgICB7XG4gICAgICAgICAgdmFsdWU6IFwiYmdHcmVlbkJvbGRDZW50ZXJlZFwiLFxuICAgICAgICAgIHRleHQ6IFwiSGVhZGluZyByb3cgd2l0aCAqaGVhZGluZyogYmFja2dyb3VuZCBjb2xvciBhbmQgYm9sZCBjZW50ZXJlZCB0ZXh0XCIsXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgICAgZGVmYXVsdFZhbHVlOiBcImJnR3JlZW5cIixcbiAgICB9LFxuICAgIHtcbiAgICAgIG9wdGlvbk5hbWU6IFwic2VsZWN0ZWRQZXJzb25cIixcbiAgICAgIHR5cGU6IFwic2VsZWN0XCIsXG4gICAgICBsYWJlbDogXCJTZWxlY3RlZCBwZXJzb24gcm93XCIsXG4gICAgICB2YWx1ZXM6IFtcbiAgICAgICAgeyB2YWx1ZTogXCJwbGFpblwiLCB0ZXh0OiBcIk5vIGhpZ2hsaWdodCBmb3Igc2VsZWN0ZWQgcGVyc29uXCIgfSxcbiAgICAgICAgeyB2YWx1ZTogXCJib2xkUm93XCIsIHRleHQ6IFwiU2VsZWN0ZWQgcGVyc29uIHJvdyBpbiBib2xkIHRleHRcIiB9LFxuICAgICAgICB7XG4gICAgICAgICAgdmFsdWU6IFwiYm9sZENlbnRlcmVkUm93XCIsXG4gICAgICAgICAgdGV4dDogXCJTZWxlY3RlZCBwZXJzb24gcm93IGluIGJvbGQgY2VudGVyZWQgdGV4dFwiLFxuICAgICAgICB9LFxuICAgICAgICB7IHZhbHVlOiBcImJvbGROYW1lXCIsIHRleHQ6IFwiU2VsZWN0ZWQgcGVyc29uIG5hbWUgaW4gYm9sZCB0ZXh0XCIgfSxcbiAgICAgICAge1xuICAgICAgICAgIHZhbHVlOiBcImJnWWVsbG93Um93XCIsXG4gICAgICAgICAgdGV4dDogXCJTZWxlY3RlZCBwZXJzb24gcm93IHdpdGggKnNlbGVjdGVkKiBiYWNrZ3JvdW5kIGNvbG9yXCIsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICB2YWx1ZTogXCJiZ1llbGxvd0JvbGRSb3dcIixcbiAgICAgICAgICB0ZXh0OiBcIlNlbGVjdGVkIHBlcnNvbiByb3cgd2l0aCAqc2VsZWN0ZWQqIGJhY2tncm91bmQgY29sb3IgYW5kIGJvbGQgdGV4dFwiLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgdmFsdWU6IFwiYmdZZWxsb3dCb2xkQ2VudGVyZWRSb3dcIixcbiAgICAgICAgICB0ZXh0OiBcIlNlbGVjdGVkIHBlcnNvbiByb3cgd2l0aCAqc2VsZWN0ZWQqIGJhY2tncm91bmQgY29sb3IgYW5kIGJvbGQgY2VudGVyZWQgdGV4dFwiLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgdmFsdWU6IFwiYmdZZWxsb3dCb2xkTmFtZVwiLFxuICAgICAgICAgIHRleHQ6IFwiU2VsZWN0ZWQgcGVyc29uIHJvdyB3aXRoICpzZWxlY3RlZCogYmFja2dyb3VuZCBjb2xvciBhbmQgbmFtZSBpbiBib2xkIHRleHRcIixcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgICBkZWZhdWx0VmFsdWU6IFwiYm9sZFJvd1wiLFxuICAgIH0sXG4gICAge1xuICAgICAgb3B0aW9uTmFtZTogXCJoZWFkaW5nQ29sb3JcIixcbiAgICAgIHR5cGU6IFwiY29sb3JcIixcbiAgICAgIGxhYmVsOiBcIkJhY2tncm91bmQgY29sb3IgZm9yIGhlYWRpbmcgcm93IChpZiBjaG9zZW4gYWJvdmUpXCIsXG4gICAgICBkZWZhdWx0VmFsdWU6IFwiI0UxRjBCNFwiLFxuICAgIH0sXG4gICAge1xuICAgICAgb3B0aW9uTmFtZTogXCJzZWxlY3RlZENvbG9yXCIsXG4gICAgICB0eXBlOiBcImNvbG9yXCIsXG4gICAgICBsYWJlbDogXCJCYWNrZ3JvdW5kIGNvbG9yIGZvciBzZWxlY3RlZCBwZXJzb24gcm93IChpZiBjaG9zZW4gYWJvdmUpXCIsXG4gICAgICBkZWZhdWx0VmFsdWU6IFwiI2ZmZmZiM1wiLFxuICAgIH0sXG4gICAge1xuICAgICAgb3B0aW9uTmFtZTogXCJjbG9zZWRDb2xvclwiLFxuICAgICAgdHlwZTogXCJjb2xvclwiLFxuICAgICAgbGFiZWw6IFwiQmFja2dyb3VuZCBjb2xvciBmb3IgY2xvc2VkIHJlY29yZCByb3dcIixcbiAgICAgIGRlZmF1bHRWYWx1ZTogXCIjZDBkMGQwXCIsXG4gICAgfSxcbiAgICB7XG4gICAgICBvcHRpb25OYW1lOiBcImJvcmRlclwiLFxuICAgICAgdHlwZTogXCJjaGVja2JveFwiLFxuICAgICAgbGFiZWw6IFwiSW5jbHVkZSBhIGJvcmRlciBhcm91bmQgdGhlIHRhYmxlXCIsXG4gICAgICBkZWZhdWx0VmFsdWU6IHRydWUsXG4gICAgfSxcbiAgICB7XG4gICAgICBvcHRpb25OYW1lOiBcInBhZGRpbmdcIixcbiAgICAgIHR5cGU6IFwiY2hlY2tib3hcIixcbiAgICAgIGxhYmVsOiBcIkluY2x1ZGUgcGFkZGluZyBpbiB0aGUgdGFibGUgY2VsbHNcIixcbiAgICAgIGRlZmF1bHRWYWx1ZTogdHJ1ZSxcbiAgICAgIHVuaXRUZXN0VmFsdWU6IGZhbHNlLFxuICAgIH0sXG4gICAge1xuICAgICAgb3B0aW9uTmFtZTogXCJjYXB0aW9uXCIsXG4gICAgICB0eXBlOiBcInNlbGVjdFwiLFxuICAgICAgbGFiZWw6IFwiQWRkIGEgY2FwdGlvbiBhYm92ZSB0aGUgdGFibGVcIixcbiAgICAgIHZhbHVlczogW1xuICAgICAgICB7IHZhbHVlOiBcIm5vbmVcIiwgdGV4dDogXCJObyBjYXB0aW9uXCIgfSxcbiAgICAgICAgeyB2YWx1ZTogXCJ0aXRsZVBsYWNlXCIsIHRleHQ6IFwiPGNvbGxlY3Rpb24gdGl0bGU+OiA8ZnVsbCBwbGFjZT5cIiB9LFxuICAgICAgICB7XG4gICAgICAgICAgdmFsdWU6IFwidGl0bGVQbGFjZU5vQ291bnRyeVwiLFxuICAgICAgICAgIHRleHQ6IFwiPGNvbGxlY3Rpb24gdGl0bGU+OiA8ZnVsbCBwbGFjZSB3aXRob3V0IGNvdW50cnk+XCIsXG4gICAgICAgIH0sXG4gICAgICAgIHsgdmFsdWU6IFwiZGF0ZVBsYWNlXCIsIHRleHQ6IFwiPGRhdGUgb2YgZXZlbnQ+OiA8ZnVsbCBwbGFjZT5cIiB9LFxuICAgICAgICB7XG4gICAgICAgICAgdmFsdWU6IFwiZGF0ZVBsYWNlTm9Db3VudHJ5XCIsXG4gICAgICAgICAgdGV4dDogXCI8ZGF0ZSBvZiBldmVudD46IDxmdWxsIHBsYWNlIHdpdGhvdXQgY291bnRyeT5cIixcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgICBkZWZhdWx0VmFsdWU6IFwibm9uZVwiLFxuICAgIH0sXG4gIF0sXG59O1xuXG5jb25zdCB0YWJsZUxpc3RPcHRpb25zR3JvdXAgPSB7XG4gIGNhdGVnb3J5OiBcInRhYmxlXCIsXG4gIHN1YmNhdGVnb3J5OiBcImxpc3RcIixcbiAgdGFiOiBcInRhYmxlXCIsXG4gIHN1YnNlY3Rpb246IFwiZ2VuZXJhbFwiLFxuICBzdWJoZWFkaW5nOiBcImxpc3RcIixcbiAgb3B0aW9uczogW1xuICAgIHtcbiAgICAgIG9wdGlvbk5hbWU6IFwidHlwZVwiLFxuICAgICAgdHlwZTogXCJzZWxlY3RcIixcbiAgICAgIGxhYmVsOiBcIlR5cGUgb2YgbGlzdFwiLFxuICAgICAgdmFsdWVzOiBbXG4gICAgICAgIHsgdmFsdWU6IFwiYnVsbGV0XCIsIHRleHQ6IFwiQnVsbGV0ZWQgbGlzdCAoKilcIiB9LFxuICAgICAgICB7IHZhbHVlOiBcImJ1bGxldDJcIiwgdGV4dDogXCJCdWxsZXRlZCBpbm5lciBsaXN0ICgqKilcIiB9LFxuICAgICAgICB7IHZhbHVlOiBcIm51bWJlclwiLCB0ZXh0OiBcIk51bWJlcmVkIGxpc3QgKCMpXCIgfSxcbiAgICAgICAgeyB2YWx1ZTogXCJidWxsZXROdW1iZXJcIiwgdGV4dDogXCJOdW1iZXJlZCBpbm5lciBsaXN0ICgqIylcIiB9LFxuICAgICAgICB7IHZhbHVlOiBcImluZGVudGVkMVwiLCB0ZXh0OiBcIkluZGVudGVkIGxpbmVzICg6KVwiIH0sXG4gICAgICAgIHsgdmFsdWU6IFwiaW5kZW50ZWQyXCIsIHRleHQ6IFwiVHdpY2UgaW5kZW50ZWQgbGluZXMgKDo6KVwiIH0sXG4gICAgICBdLFxuICAgICAgZGVmYXVsdFZhbHVlOiBcImluZGVudGVkMlwiLFxuICAgIH0sXG4gIF0sXG59O1xuXG5jb25zdCB0YWJsZVNlbnRlbmNlT3B0aW9uc0dyb3VwID0ge1xuICBjYXRlZ29yeTogXCJ0YWJsZVwiLFxuICBzdWJjYXRlZ29yeTogXCJzZW50ZW5jZVwiLFxuICB0YWI6IFwidGFibGVcIixcbiAgc3Vic2VjdGlvbjogXCJnZW5lcmFsXCIsXG4gIHN1YmhlYWRpbmc6IFwic2VudGVuY2VcIixcbiAgb3B0aW9uczogW1xuICAgIHtcbiAgICAgIG9wdGlvbk5hbWU6IFwicHJlYW1ibGVcIixcbiAgICAgIHR5cGU6IFwic2VsZWN0XCIsXG4gICAgICBsYWJlbDogXCJQcmVhbWJsZVwiLFxuICAgICAgdmFsdWVzOiBbXG4gICAgICAgIHsgdmFsdWU6IFwibm9uZVwiLCB0ZXh0OiBcIk5vbmVcIiB9LFxuICAgICAgICB7IHZhbHVlOiBcImluY2x1ZGVkXCIsIHRleHQ6IFwiVGhlIGhvdXNlaG9sZCBpbmNsdWRlZFwiIH0sXG4gICAgICAgIHsgdmFsdWU6IFwiY29uc2lzdGVkXCIsIHRleHQ6IFwiVGhlIGhvdXNlaG9sZCBjb25zaXN0ZWQgb2ZcIiB9LFxuICAgICAgICB7IHZhbHVlOiBcImVudW1lcmF0ZWRcIiwgdGV4dDogXCJUaGUgaG91c2Vob2xkIHdhcyBlbnVtZXJhdGVkIGFzXCIgfSxcbiAgICAgIF0sXG4gICAgICBkZWZhdWx0VmFsdWU6IFwibm9uZVwiLFxuICAgIH0sXG4gICAge1xuICAgICAgb3B0aW9uTmFtZTogXCJpbmNsdWRlUmVsYXRpb25zaGlwXCIsXG4gICAgICB0eXBlOiBcImNoZWNrYm94XCIsXG4gICAgICBsYWJlbDogXCJJbmNsdWRlIHJlbGF0aW9uc2hpcCBmb3IgZWFjaCBwZXJzb24gKGlmIGtub3duKVwiLFxuICAgICAgZGVmYXVsdFZhbHVlOiB0cnVlLFxuICAgICAgdW5pdFRlc3RWYWx1ZTogdHJ1ZSxcbiAgICB9LFxuICAgIHtcbiAgICAgIG9wdGlvbk5hbWU6IFwiaW5jbHVkZUFnZVwiLFxuICAgICAgdHlwZTogXCJjaGVja2JveFwiLFxuICAgICAgbGFiZWw6IFwiSW5jbHVkZSBhZ2UgZm9yIGVhY2ggcGVyc29uIChpZiBrbm93bilcIixcbiAgICAgIGRlZmF1bHRWYWx1ZTogdHJ1ZSxcbiAgICAgIHVuaXRUZXN0VmFsdWU6IHRydWUsXG4gICAgfSxcbiAgICB7XG4gICAgICBvcHRpb25OYW1lOiBcImxhc3RJdGVtUHVuY3R1YXRpb25cIixcbiAgICAgIHR5cGU6IFwic2VsZWN0XCIsXG4gICAgICBsYWJlbDogXCJMYXN0IG1lbWJlciBwdW5jdHVhdGlvblwiLFxuICAgICAgdmFsdWVzOiBbXG4gICAgICAgIHsgdmFsdWU6IFwiY29tbWFcIiwgdGV4dDogXCInLCAnXCIgfSxcbiAgICAgICAgeyB2YWx1ZTogXCJhbmRcIiwgdGV4dDogXCInIGFuZCAnXCIgfSxcbiAgICAgICAgeyB2YWx1ZTogXCJjb21tYUFuZFwiLCB0ZXh0OiBcIicsIGFuZCAnXCIgfSxcbiAgICAgIF0sXG4gICAgICBkZWZhdWx0VmFsdWU6IFwiY29tbWFcIixcbiAgICB9LFxuICBdLFxufTtcblxuLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gQWRkL01lcmdlIG9wdGlvbnMgZ3JvdXBzXG4vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cbmNvbnN0IGFkZE1lcmdlR2VuZXJhbE9wdGlvbnNHcm91cCA9IHtcbiAgY2F0ZWdvcnk6IFwiYWRkTWVyZ2VcIixcbiAgc3ViY2F0ZWdvcnk6IFwiZ2VuZXJhbFwiLFxuICB0YWI6IFwiYWRkTWVyZ2VcIixcbiAgc3Vic2VjdGlvbjogXCJnZW5lcmFsXCIsXG4gIG9wdGlvbnM6IFtcbiAgICB7XG4gICAgICBvcHRpb25OYW1lOiBcInNwbGl0Rm9yZW5hbWVzXCIsXG4gICAgICB0eXBlOiBcInNlbGVjdFwiLFxuICAgICAgbGFiZWw6IFwiU2VwYXJhdGUgZm9yZW5hbWVzIGludG8gYSBmaXJzdCBuYW1lIGFuZCBtaWRkbGUgbmFtZXNcIixcbiAgICAgIHZhbHVlczogW1xuICAgICAgICB7IHZhbHVlOiBcIm5ldmVyXCIsIHRleHQ6IFwiTmV2ZXJcIiB9LFxuICAgICAgICB7IHZhbHVlOiBcImFsd2F5c1wiLCB0ZXh0OiBcIkFsd2F5c1wiIH0sXG4gICAgICAgIHsgdmFsdWU6IFwiY291bnRyeVNwZWNpZmljXCIsIHRleHQ6IFwiT25seSBmb3IgY2VydGFpbiBjb3VudHJpZXNcIiB9LFxuICAgICAgXSxcbiAgICAgIGRlZmF1bHRWYWx1ZTogXCJjb3VudHJ5U3BlY2lmaWNcIixcbiAgICB9LFxuICBdLFxufTtcblxuY29uc3QgYWRkTWVyZ2VBZGRQZXJzb25PcHRpb25zR3JvdXAgPSB7XG4gIGNhdGVnb3J5OiBcImFkZE1lcmdlXCIsXG4gIHN1YmNhdGVnb3J5OiBcImFkZFBlcnNvblwiLFxuICB0YWI6IFwiYWRkTWVyZ2VcIixcbiAgc3Vic2VjdGlvbjogXCJhZGRQZXJzb25cIixcbiAgb3B0aW9uczogW1xuICAgIHtcbiAgICAgIG9wdGlvbk5hbWU6IFwiaW5jbHVkZUNpdGF0aW9uXCIsXG4gICAgICB0eXBlOiBcImNoZWNrYm94XCIsXG4gICAgICBsYWJlbDogXCJGaWxsIGNpdGF0aW9uIGluIGFwcHJvcHJpYXRlIGZpZWxkIGlmIGZpbGxpbmcgZnJvbSBhIGNpdGF0aW9uXCIsXG4gICAgICBkZWZhdWx0VmFsdWU6IGZhbHNlLFxuICAgICAgdW5pdFRlc3RWYWx1ZTogZmFsc2UsXG4gICAgfSxcbiAgICB7XG4gICAgICBvcHRpb25OYW1lOiBcImluY2x1ZGVQcm9maWxlTGlua1wiLFxuICAgICAgdHlwZTogXCJjaGVja2JveFwiLFxuICAgICAgbGFiZWw6IFwiQWRkIGEgbGluay90ZW1wbGF0ZSB0byB0aGUgc291cmNlIHByb2ZpbGUgaW4gc291cmNlcyBpZiBmaWxsaW5nIGZyb20gYSBwcm9maWxlXCIsXG4gICAgICBkZWZhdWx0VmFsdWU6IGZhbHNlLFxuICAgICAgdW5pdFRlc3RWYWx1ZTogZmFsc2UsXG4gICAgfSxcbiAgICB7XG4gICAgICBvcHRpb25OYW1lOiBcImdlbmVyYXRlSW50cm9cIixcbiAgICAgIHR5cGU6IFwic2VsZWN0XCIsXG4gICAgICBsYWJlbDogXCJDcmVhdGUgYW4gaW50cm8gaW4gdGhlIGJpb2dyYXBoeSAoTm90ZXMpIGZpZWxkXCIsXG4gICAgICB2YWx1ZXM6IFtcbiAgICAgICAgeyB2YWx1ZTogXCJub25lXCIsIHRleHQ6IFwiTm9cIiB9LFxuICAgICAgICB7XG4gICAgICAgICAgdmFsdWU6IFwiZnJvbVNhdmVkRGF0YVwiLFxuICAgICAgICAgIHRleHQ6IFwiWWVzLCB3aXRoIHBhcmVudCBpbmZvIGJhc2VkIG9uIHRoZSBzYXZlZCBkYXRhIG9ubHlcIixcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIHZhbHVlOiBcImZyb21QYWdlRGF0YVwiLFxuICAgICAgICAgIHRleHQ6IFwiWWVzLCB3aXRoIHBhcmVudCBpbmZvIGJhc2VkIG9uIHRoZSBsaW5rcyBvbiBFZGl0IEZhbWlseSBwYWdlIG9ubHlcIixcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIHZhbHVlOiBcImZyb21Cb3RoXCIsXG4gICAgICAgICAgdGV4dDogXCJZZXMsIHdpdGggcGFyZW50IGluZm8gYmFzZWQgb24gYWxsIGF2YWlsYWJsZSBpbmZvcm1hdGlvblwiLFxuICAgICAgICB9LFxuICAgICAgXSxcbiAgICAgIGRlZmF1bHRWYWx1ZTogXCJub25lXCIsXG4gICAgfSxcbiAgICB7XG4gICAgICBvcHRpb25OYW1lOiBcImluY2x1ZGVMaW5rc1wiLFxuICAgICAgdHlwZTogXCJjaGVja2JveFwiLFxuICAgICAgbGFiZWw6IFwiSW5jbHVkZSBXaWtpVHJlZSBwZXJzb24gbGlua3MgaW4gaW50cm8gaWYgYXZhaWxhYmxlXCIsXG4gICAgICBkZWZhdWx0VmFsdWU6IGZhbHNlLFxuICAgICAgdW5pdFRlc3RWYWx1ZTogZmFsc2UsXG4gICAgfSxcbiAgICB7XG4gICAgICBvcHRpb25OYW1lOiBcImFkZERpZWRZb3VuZ1wiLFxuICAgICAgdHlwZTogXCJjaGVja2JveFwiLFxuICAgICAgbGFiZWw6IFwiSW5jbHVkZSBEaWVkIFlvdW5nIHN0aWNrZXIgaWYgcGVyc29uIGRpZWQgYWdlZCAxNSBvciBsZXNzIGFuZCBubyBrbm93biBzcG91c2VcIixcbiAgICAgIGRlZmF1bHRWYWx1ZTogZmFsc2UsXG4gICAgICB1bml0VGVzdFZhbHVlOiBmYWxzZSxcbiAgICB9LFxuICBdLFxufTtcblxuY29uc3QgYWRkTWVyZ2VNZXJnZUVkaXRPcHRpb25zR3JvdXAgPSB7XG4gIGNhdGVnb3J5OiBcImFkZE1lcmdlXCIsXG4gIHN1YmNhdGVnb3J5OiBcIm1lcmdlRWRpdFwiLFxuICB0YWI6IFwiYWRkTWVyZ2VcIixcbiAgc3Vic2VjdGlvbjogXCJtZXJnZUVkaXRcIixcbiAgb3B0aW9uczogW1xuICAgIHtcbiAgICAgIG9wdGlvbk5hbWU6IFwiaW5jbHVkZUNpdGF0aW9uXCIsXG4gICAgICB0eXBlOiBcImNoZWNrYm94XCIsXG4gICAgICBsYWJlbDogXCJQdXQgY2l0YXRpb24gdGV4dCBpbiBiaW9ncmFwaHkgaWYgbWVyZ2luZyBmcm9tIGEgY2l0YXRpb24uXCIsXG4gICAgICBkZWZhdWx0VmFsdWU6IGZhbHNlLFxuICAgICAgdW5pdFRlc3RWYWx1ZTogZmFsc2UsXG4gICAgfSxcbiAgICB7XG4gICAgICBvcHRpb25OYW1lOiBcImluY2x1ZGVQcm9maWxlTGlua1wiLFxuICAgICAgdHlwZTogXCJjaGVja2JveFwiLFxuICAgICAgbGFiZWw6IFwiQWRkIGEgbGluay90ZW1wbGF0ZSB0byB0aGUgYmlvZ3JhcGh5IGlmIG1lcmdpbmcgZnJvbSBhIHByb2ZpbGVcIixcbiAgICAgIGRlZmF1bHRWYWx1ZTogZmFsc2UsXG4gICAgICB1bml0VGVzdFZhbHVlOiBmYWxzZSxcbiAgICB9LFxuICBdLFxufTtcblxucmVnaXN0ZXJTdWJzZWN0aW9uRm9yT3B0aW9ucyhcInNlYXJjaFwiLCBcImdlbmVyYWxcIiwgXCJHZW5lcmFsXCIpO1xuXG5yZWdpc3RlclN1YnNlY3Rpb25Gb3JPcHRpb25zKFwiY2l0YXRpb25cIiwgXCJnZW5lcmFsXCIsIFwiR2VuZXJhbFwiKTtcblxucmVnaXN0ZXJTdWJzZWN0aW9uRm9yT3B0aW9ucyhcIm5hcnJhdGl2ZVwiLCBcImdlbmVyYWxcIiwgXCJHZW5lcmFsXCIpO1xucmVnaXN0ZXJTdWJzZWN0aW9uRm9yT3B0aW9ucyhcIm5hcnJhdGl2ZVwiLCBcImJhcHRpc21cIiwgXCJCYXB0aXNtXCIpO1xucmVnaXN0ZXJTdWJzZWN0aW9uRm9yT3B0aW9ucyhcIm5hcnJhdGl2ZVwiLCBcImJpcnRoXCIsIFwiQmlydGhcIik7XG5yZWdpc3RlclN1YnNlY3Rpb25Gb3JPcHRpb25zKFwibmFycmF0aXZlXCIsIFwiYmlydGhPckJhcHRpc21cIiwgXCJCaXJ0aCBvciBCYXB0aXNtXCIpO1xucmVnaXN0ZXJTdWJzZWN0aW9uRm9yT3B0aW9ucyhcIm5hcnJhdGl2ZVwiLCBcImJpcnRoUmVnXCIsIFwiQmlydGggUmVnaXN0cmF0aW9uXCIpO1xucmVnaXN0ZXJTdWJoZWFkaW5nRm9yT3B0aW9ucyhcIm5hcnJhdGl2ZVwiLCBcImJpcnRoUmVnXCIsIFwiZXZ0XCIsIFwiV2hlbiBkYXRlIGFuZCBwbGFjZSBhcmUgZm9yIGJpcnRoIGV2ZW50XCIpO1xucmVnaXN0ZXJTdWJoZWFkaW5nRm9yT3B0aW9ucyhcIm5hcnJhdGl2ZVwiLCBcImJpcnRoUmVnXCIsIFwicmVnXCIsIFwiV2hlbiBkYXRlIGFuZCBwbGFjZSBhcmUgZm9yIHJlZ2lzdHJhdGlvbiwgbm90IGJpcnRoXCIpO1xucmVnaXN0ZXJTdWJzZWN0aW9uRm9yT3B0aW9ucyhcIm5hcnJhdGl2ZVwiLCBcImJ1cmlhbFwiLCBcIkJ1cmlhbFwiKTtcbnJlZ2lzdGVyU3Vic2VjdGlvbkZvck9wdGlvbnMoXCJuYXJyYXRpdmVcIiwgXCJjZW5zdXNcIiwgXCJDZW5zdXNcIik7XG5yZWdpc3RlclN1YnNlY3Rpb25Gb3JPcHRpb25zKFwibmFycmF0aXZlXCIsIFwiZGVhdGhcIiwgXCJEZWF0aFwiKTtcbnJlZ2lzdGVyU3Vic2VjdGlvbkZvck9wdGlvbnMoXCJuYXJyYXRpdmVcIiwgXCJkZWF0aFJlZ1wiLCBcIkRlYXRoIFJlZ2lzdHJhdGlvblwiKTtcbnJlZ2lzdGVyU3ViaGVhZGluZ0Zvck9wdGlvbnMoXCJuYXJyYXRpdmVcIiwgXCJkZWF0aFJlZ1wiLCBcImV2dFwiLCBcIldoZW4gZGF0ZSBhbmQgcGxhY2UgYXJlIGZvciBkZWF0aCBldmVudFwiKTtcbnJlZ2lzdGVyU3ViaGVhZGluZ0Zvck9wdGlvbnMoXCJuYXJyYXRpdmVcIiwgXCJkZWF0aFJlZ1wiLCBcInJlZ1wiLCBcIldoZW4gZGF0ZSBhbmQgcGxhY2UgYXJlIGZvciByZWdpc3RyYXRpb24sIG5vdCBkZWF0aFwiKTtcbnJlZ2lzdGVyU3Vic2VjdGlvbkZvck9wdGlvbnMoXCJuYXJyYXRpdmVcIiwgXCJtYXJyaWFnZVwiLCBcIk1hcnJpYWdlXCIpO1xucmVnaXN0ZXJTdWJzZWN0aW9uRm9yT3B0aW9ucyhcIm5hcnJhdGl2ZVwiLCBcIm1hcnJpYWdlUmVnXCIsIFwiTWFycmlhZ2UgUmVnaXN0cmF0aW9uXCIpO1xucmVnaXN0ZXJTdWJoZWFkaW5nRm9yT3B0aW9ucyhcIm5hcnJhdGl2ZVwiLCBcIm1hcnJpYWdlUmVnXCIsIFwiZXZ0XCIsIFwiV2hlbiBkYXRlIGFuZCBwbGFjZSBhcmUgZm9yIG1hcnJpYWdlIGV2ZW50XCIpO1xucmVnaXN0ZXJTdWJoZWFkaW5nRm9yT3B0aW9ucyhcbiAgXCJuYXJyYXRpdmVcIixcbiAgXCJtYXJyaWFnZVJlZ1wiLFxuICBcInJlZ1wiLFxuICBcIldoZW4gZGF0ZSBhbmQgcGxhY2UgYXJlIGZvciByZWdpc3RyYXRpb24sIG5vdCBtYXJyaWFnZVwiXG4pO1xucmVnaXN0ZXJTdWJzZWN0aW9uRm9yT3B0aW9ucyhcIm5hcnJhdGl2ZVwiLCBcIm9iaXR1YXJ5XCIsIFwiT2JpdHVhcnlcIik7XG5cbnJlZ2lzdGVyU3Vic2VjdGlvbkZvck9wdGlvbnMoXCJ0YWJsZVwiLCBcImdlbmVyYWxcIiwgXCJHZW5lcmFsXCIpO1xucmVnaXN0ZXJTdWJoZWFkaW5nRm9yT3B0aW9ucyhcInRhYmxlXCIsIFwiZ2VuZXJhbFwiLCBcInRhYmxlXCIsIFwiV2hlbiB1c2luZyBhIHRhYmxlXCIpO1xucmVnaXN0ZXJTdWJoZWFkaW5nRm9yT3B0aW9ucyhcInRhYmxlXCIsIFwiZ2VuZXJhbFwiLCBcImxpc3RcIiwgXCJXaGVuIHVzaW5nIGEgbGlzdFwiKTtcbnJlZ2lzdGVyU3ViaGVhZGluZ0Zvck9wdGlvbnMoXCJ0YWJsZVwiLCBcImdlbmVyYWxcIiwgXCJzZW50ZW5jZVwiLCBcIldoZW4gdXNpbmcgYSBzZW50ZW5jZVwiKTtcblxucmVnaXN0ZXJTdWJzZWN0aW9uRm9yT3B0aW9ucyhcImFkZE1lcmdlXCIsIFwiZ2VuZXJhbFwiLCBcIkdlbmVyYWxcIik7XG5yZWdpc3RlclN1YnNlY3Rpb25Gb3JPcHRpb25zKFwiYWRkTWVyZ2VcIiwgXCJhZGRQZXJzb25cIiwgXCJBZGQgUGVyc29uXCIpO1xucmVnaXN0ZXJTdWJzZWN0aW9uRm9yT3B0aW9ucyhcImFkZE1lcmdlXCIsIFwibWVyZ2VFZGl0XCIsIFwiTWVyZ2UvRWRpdFwiKTtcblxucmVnaXN0ZXJPcHRpb25zR3JvdXAoc2VhcmNoT3B0aW9uc0dyb3VwKTtcbnJlZ2lzdGVyT3B0aW9uc0dyb3VwKGNpdGF0aW9uT3B0aW9uc0dyb3VwKTtcblxucmVnaXN0ZXJPcHRpb25zR3JvdXAobmFycmF0aXZlT3B0aW9uc0dyb3VwKTtcbnJlZ2lzdGVyT3B0aW9uc0dyb3VwKG5hcnJhdGl2ZUJhcHRpc21PcHRpb25zR3JvdXApO1xucmVnaXN0ZXJPcHRpb25zR3JvdXAobmFycmF0aXZlQmlydGhPcHRpb25zR3JvdXApO1xucmVnaXN0ZXJPcHRpb25zR3JvdXAobmFycmF0aXZlQmlydGhPckJhcHRpc21PcHRpb25zR3JvdXApO1xucmVnaXN0ZXJPcHRpb25zR3JvdXAobmFycmF0aXZlQmlydGhSZWdPcHRpb25zR3JvdXApO1xucmVnaXN0ZXJPcHRpb25zR3JvdXAobmFycmF0aXZlQmlydGhSZWdFdnRPcHRpb25zR3JvdXApO1xucmVnaXN0ZXJPcHRpb25zR3JvdXAobmFycmF0aXZlQmlydGhSZWdSZWdPcHRpb25zR3JvdXApO1xucmVnaXN0ZXJPcHRpb25zR3JvdXAobmFycmF0aXZlQnVyaWFsT3B0aW9uc0dyb3VwKTtcbnJlZ2lzdGVyT3B0aW9uc0dyb3VwKG5hcnJhdGl2ZUNlbnN1c09wdGlvbnNHcm91cCk7XG5yZWdpc3Rlck9wdGlvbnNHcm91cChuYXJyYXRpdmVEZWF0aE9wdGlvbnNHcm91cCk7XG5yZWdpc3Rlck9wdGlvbnNHcm91cChuYXJyYXRpdmVEZWF0aFJlZ09wdGlvbnNHcm91cCk7XG5yZWdpc3Rlck9wdGlvbnNHcm91cChuYXJyYXRpdmVEZWF0aFJlZ0V2dE9wdGlvbnNHcm91cCk7XG5yZWdpc3Rlck9wdGlvbnNHcm91cChuYXJyYXRpdmVEZWF0aFJlZ1JlZ09wdGlvbnNHcm91cCk7XG5yZWdpc3Rlck9wdGlvbnNHcm91cChuYXJyYXRpdmVNYXJyaWFnZU9wdGlvbnNHcm91cCk7XG5yZWdpc3Rlck9wdGlvbnNHcm91cChuYXJyYXRpdmVNYXJyaWFnZVJlZ09wdGlvbnNHcm91cCk7XG5yZWdpc3Rlck9wdGlvbnNHcm91cChuYXJyYXRpdmVNYXJyaWFnZVJlZ0V2dE9wdGlvbnNHcm91cCk7XG5yZWdpc3Rlck9wdGlvbnNHcm91cChuYXJyYXRpdmVNYXJyaWFnZVJlZ1JlZ09wdGlvbnNHcm91cCk7XG5yZWdpc3Rlck9wdGlvbnNHcm91cChuYXJyYXRpdmVPYml0dWFyeU9wdGlvbnNHcm91cCk7XG5cbnJlZ2lzdGVyT3B0aW9uc0dyb3VwKHRhYmxlR2VuZXJhbE9wdGlvbnNHcm91cCk7XG5yZWdpc3Rlck9wdGlvbnNHcm91cCh0YWJsZVRhYmxlT3B0aW9uc0dyb3VwKTtcbnJlZ2lzdGVyT3B0aW9uc0dyb3VwKHRhYmxlTGlzdE9wdGlvbnNHcm91cCk7XG5yZWdpc3Rlck9wdGlvbnNHcm91cCh0YWJsZVNlbnRlbmNlT3B0aW9uc0dyb3VwKTtcblxucmVnaXN0ZXJPcHRpb25zR3JvdXAoYWRkTWVyZ2VHZW5lcmFsT3B0aW9uc0dyb3VwKTtcbnJlZ2lzdGVyT3B0aW9uc0dyb3VwKGFkZE1lcmdlQWRkUGVyc29uT3B0aW9uc0dyb3VwKTtcbnJlZ2lzdGVyT3B0aW9uc0dyb3VwKGFkZE1lcmdlTWVyZ2VFZGl0T3B0aW9uc0dyb3VwKTtcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./extension/base/core/options/register_base_options.mjs\n");

/***/ }),

/***/ "./extension/base/core/record_collections.mjs":
/*!****************************************************!*\
  !*** ./extension/base/core/record_collections.mjs ***!
  \****************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"RC\": () => (/* binding */ RC)\n/* harmony export */ });\n/* harmony import */ var _country_data_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./country_data.mjs */ \"./extension/base/core/country_data.mjs\");\n/*\nMIT License\n\nCopyright (c) 2020 Robert M Pavey\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.\n*/\n\n\n\nconst houseTableColumnsUk1841 = [\"name\", \"gender\", \"age\", \"occupation\", \"birthPlace\"];\nconst houseTableColumnsUk1851to1911 = [\n  \"name\",\n  \"relationship\",\n  \"maritalStatus\",\n  \"gender\",\n  \"age\",\n  \"birthYear\",\n  \"occupation\",\n  \"birthPlace\",\n];\n\nconst householdTableColumnsUsFederal1850 = [\"name\", \"gender\", \"age\", \"occupation\", \"birthPlace\"];\nconst householdTableColumnsUsFederalPre1880 = [\"name\", \"gender\", \"age\", \"maritalStatus\", \"occupation\", \"birthPlace\"];\nconst householdTableColumnsUsFederalPost1880 = [\n  \"name\",\n  \"gender\",\n  \"age\",\n  \"maritalStatus\",\n  \"relationship\",\n  \"occupation\",\n  \"birthPlace\",\n];\n\nconst RecordCollectionData = [\n  // England & Wales BMD\n  {\n    wtsId: \"EnglandAndWalesBirthReg\",\n    title: \"England & Wales, Civil Registration Birth Index\",\n    country: \"England and Wales\",\n    isBirth: true,\n    sites: {\n      fs: {\n        id: \"2285338\",\n        dates: { from: 1837, to: 2008 },\n        searchTerms: { gender: false },\n      },\n      fmp: {\n        id: \"England & Wales Births 1837-2006\",\n        dates: { from: 1837, to: 2006 },\n        searchQueryFields: { volume: \"\", page: \"\" },\n      },\n      gro: { id: \"births\", dates: { from: 1837, to: 2019 } },\n      freebmd: { id: \"births\", dates: { from: 1837, to: 1992 } },\n    },\n  },\n  {\n    wtsId: \"EnglandAndWalesBirthRegEarly\",\n    partOf: [\"EnglandAndWalesBirthReg\"],\n    title: \"England & Wales, Civil Registration Birth Index 1837-1915\",\n    country: \"England and Wales\",\n    isDeath: true,\n    sites: {\n      ancestry: {\n        id: \"8912\",\n        altId: \"freebmdbirth\",\n        dates: { from: 1837, to: 1915 },\n      },\n    },\n  },\n  {\n    wtsId: \"EnglandAndWalesBirthRegLate\",\n    partOf: [\"EnglandAndWalesBirthReg\"],\n    title: \"England & Wales, Civil Registration Birth Index 1916-2007\",\n    country: \"England and Wales\",\n    isDeath: true,\n    sites: {\n      ancestry: { id: \"8782\", dates: { from: 1916, to: 2007 } },\n    },\n  },\n  {\n    wtsId: \"EnglandAndWalesMarriageReg\",\n    title: \"England & Wales, Civil Registration Marriage Index\",\n    country: \"England and Wales\",\n    isMarriage: true,\n    sites: {\n      fs: { id: \"2285732\", dates: { from: 1837, to: 2008 } },\n      fmp: {\n        id: \"England & Wales Marriages 1837-2005\",\n        dates: { from: 1837, to: 2005 },\n      },\n      freebmd: { id: \"marriages\", dates: { from: 1837, to: 1992 } },\n    },\n  },\n  {\n    wtsId: \"EnglandAndWalesMarriageRegEarly\",\n    partOf: [\"EnglandAndWalesMarriageReg\"],\n    title: \"England & Wales, Civil Registration Marriage Index 1837-1915\",\n    country: \"England and Wales\",\n    isDeath: true,\n    sites: {\n      ancestry: {\n        id: \"8913\",\n        altId: \"FreeBMDMarriage\",\n        dates: { from: 1837, to: 1915 },\n        searchQueryFields: { volume: \"f-F00056EC\", page: \"f-F0005906\" },\n      },\n    },\n  },\n  {\n    wtsId: \"EnglandAndWalesMarriageRegLate\",\n    partOf: [\"EnglandAndWalesMarriageReg\"],\n    title: \"England & Wales, Civil Registration Marriage Index 1916-2007\",\n    country: \"England and Wales\",\n    isDeath: true,\n    sites: {\n      ancestry: {\n        id: \"8753\",\n        altId: \"ONSmarriage1984\",\n        dates: { from: 1916, to: 2005 },\n      },\n    },\n  },\n  {\n    wtsId: \"EnglandAndWalesDeathReg\",\n    title: \"England & Wales, Civil Registration Death Index\",\n    country: \"England and Wales\",\n    isDeath: true,\n    sites: {\n      fs: { id: \"2285341\", dates: { from: 1837, to: 2008 } },\n      fmp: {\n        id: \"England & Wales Deaths 1837-2007\",\n        dates: { from: 1837, to: 2007 },\n        searchQueryFields: { volume: \"\", page: \"\" },\n      },\n      gro: { id: \"deaths\", dates: { from: 1837, to: 2019 } },\n      freebmd: { id: \"deaths\", dates: { from: 1837, to: 1992 } },\n    },\n  },\n  {\n    wtsId: \"EnglandAndWalesDeathRegEarly\",\n    partOf: [\"EnglandAndWalesDeathReg\"],\n    title: \"England & Wales, Civil Registration Death Index 1837-1915\",\n    country: \"England and Wales\",\n    isDeath: true,\n    sites: {\n      ancestry: {\n        id: \"8914\",\n        dates: { from: 1837, to: 1915 },\n        searchQueryFields: { volume: \"\", page: \"\" },\n      },\n    },\n  },\n  {\n    wtsId: \"EnglandAndWalesDeathRegLate\",\n    partOf: [\"EnglandAndWalesDeathReg\"],\n    title: \"England & Wales, Civil Registration Death Index 1916-2007\",\n    country: \"England and Wales\",\n    isDeath: true,\n    sites: {\n      ancestry: { id: \"7579\", dates: { from: 1916, to: 2007 } },\n    },\n  },\n\n  // England, Wales & Scotland Census\n  {\n    wtsId: \"EnglandWalesAndScotlandCensus1841\",\n    title: \"1841 Census of England, Wales & Scotland\",\n    country: \"United Kingdom\",\n    dates: { year: 1841, exactDate: \"6 Jun 1841\" },\n    householdTableColumns: houseTableColumnsUk1841,\n    sites: {\n      fmp: {\n        id: \"1841 England, Wales & Scotland Census\",\n        title: \"1841 England, Wales & Scotland Census\",\n      },\n      freecen: { id: \"1841\", title: \"1841 England, Scotland and Wales census\" },\n    },\n  },\n  {\n    wtsId: \"EnglandWalesAndScotlandCensus1851\",\n    title: \"1851 Census of England, Wales & Scotland\",\n    country: \"United Kingdom\",\n    dates: { year: 1851, exactDate: \"30 Mar 1851\" },\n    householdTableColumns: houseTableColumnsUk1851to1911,\n    sites: {\n      fmp: {\n        id: \"1851 England, Wales & Scotland Census\",\n        title: \"1851 England, Wales & Scotland Census\",\n      },\n      freecen: { id: \"1851\", title: \"1851 England, Scotland and Wales census\" },\n    },\n  },\n  {\n    wtsId: \"EnglandWalesAndScotlandCensus1861\",\n    title: \"1861 Census of England, Wales & Scotland\",\n    country: \"United Kingdom\",\n    dates: { year: 1861, exactDate: \"7 Apr 1861\" },\n    householdTableColumns: houseTableColumnsUk1851to1911,\n    sites: {\n      fmp: {\n        id: \"1861 England, Wales & Scotland Census\",\n        title: \"1861 England, Wales & Scotland Census\",\n      },\n      freecen: { id: \"1861\", title: \"1861 England, Scotland and Wales census\" },\n    },\n  },\n  {\n    wtsId: \"EnglandWalesAndScotlandCensus1871\",\n    title: \"1871 Census of England, Wales & Scotland\",\n    country: \"United Kingdom\",\n    dates: { year: 1871, exactDate: \"2 Apr 1871\" },\n    householdTableColumns: houseTableColumnsUk1851to1911,\n    sites: {\n      fmp: {\n        id: \"1871 England, Wales & Scotland Census\",\n        title: \"1871 England, Wales & Scotland Census\",\n      },\n      freecen: { id: \"1871\", title: \"1871 England, Scotland and Wales census\" },\n    },\n  },\n  {\n    wtsId: \"EnglandWalesAndScotlandCensus1881\",\n    title: \"1881 Census of England, Wales & Scotland\",\n    country: \"United Kingdom\",\n    dates: { year: 1881, exactDate: \"3 Apr 1881\" },\n    householdTableColumns: houseTableColumnsUk1851to1911,\n    sites: {\n      fmp: {\n        id: \"1881 England, Wales & Scotland Census\",\n        title: \"1881 England, Wales & Scotland Census\",\n      },\n      freecen: { id: \"1881\", title: \"1881 England, Scotland and Wales census\" },\n    },\n  },\n  {\n    wtsId: \"EnglandWalesAndScotlandCensus1891\",\n    title: \"1891 Census of England, Wales & Scotland\",\n    country: \"United Kingdom\",\n    dates: { year: 1891, exactDate: \"5 Apr 1891\" },\n    householdTableColumns: houseTableColumnsUk1851to1911,\n    sites: {\n      fmp: {\n        id: \"1891 England, Wales & Scotland Census\",\n        title: \"1891 England, Wales & Scotland Census\",\n      },\n      freecen: { id: \"1891\", title: \"1891 England, Scotland and Wales census\" },\n    },\n  },\n  {\n    wtsId: \"EnglandWalesAndScotlandCensus1901\",\n    title: \"1901 Census of England, Wales & Scotland\",\n    country: \"United Kingdom\",\n    dates: { year: 1901, exactDate: \"31 Mar 1901\" },\n    householdTableColumns: houseTableColumnsUk1851to1911,\n    sites: {\n      fmp: {\n        id: \"1901 England, Wales & Scotland Census\",\n        title: \"1901 England, Wales & Scotland Census\",\n      },\n      freecen: { id: \"1901\", title: \"1901 England, Scotland and Wales census\" },\n    },\n  },\n  {\n    wtsId: \"EnglandWalesAndScotlandCensus1911\",\n    title: \"1911 Census of England, Wales & Scotland\",\n    country: \"United Kingdom\",\n    dates: { year: 1911, exactDate: \"2 Apr 1911\" },\n    householdTableColumns: houseTableColumnsUk1851to1911,\n  },\n  // England & Wales Census\n  {\n    wtsId: \"EnglandAndWalesCensus1841\",\n    partOf: [\"EnglandWalesAndScotlandCensus1841\"],\n    title: \"1841 Census of England and Wales\",\n    country: \"England and Wales\",\n    dates: { year: 1841, exactDate: \"6 Jun 1841\" },\n    sites: {\n      fs: { id: \"1493745\", title: \"England and Wales Census, 1841\" },\n    },\n  },\n  {\n    wtsId: \"EnglandAndWalesCensus1851\",\n    partOf: [\"EnglandWalesAndScotlandCensus1851\"],\n    title: \"1851 Census of England and Wales\",\n    country: \"England and Wales\",\n    dates: { year: 1851, exactDate: \"30 Mar 1851\" },\n    sites: {\n      fs: { id: \"2563939\", title: \"England and Wales Census, 1851\" },\n    },\n  },\n  {\n    wtsId: \"EnglandAndWalesCensus1861\",\n    partOf: [\"EnglandWalesAndScotlandCensus1861\"],\n    title: \"1861 Census of England and Wales\",\n    country: \"England and Wales\",\n    dates: { year: 1861, exactDate: \"7 Apr 1861\" },\n    sites: {\n      fs: { id: \"1493747\", title: \"England and Wales Census, 1861\" },\n    },\n  },\n  {\n    wtsId: \"EnglandAndWalesCensus1871\",\n    partOf: [\"EnglandWalesAndScotlandCensus1871\"],\n    title: \"1871 Census of England and Wales\",\n    country: \"England and Wales\",\n    dates: { year: 1871, exactDate: \"2 Apr 1871\" },\n    sites: {\n      fs: { id: \"1538354\", title: \"England and Wales Census, 1871\" },\n    },\n  },\n  {\n    wtsId: \"EnglandAndWalesCensus1881\",\n    partOf: [\"EnglandWalesAndScotlandCensus1881\"],\n    title: \"1881 Census of England and Wales\",\n    country: \"England and Wales\",\n    dates: { year: 1881, exactDate: \"3 Apr 1881\" },\n    sites: {\n      fs: { id: \"2562194\", title: \"England and Wales Census, 1881\" },\n    },\n  },\n  {\n    wtsId: \"EnglandAndWalesCensus1891\",\n    partOf: [\"EnglandWalesAndScotlandCensus1891\"],\n    title: \"1891 Census of England and Wales\",\n    country: \"England and Wales\",\n    dates: { year: 1891, exactDate: \"5 Apr 1891\" },\n    sites: {\n      fs: { id: \"1865747\", title: \"England and Wales Census, 1891\" },\n    },\n  },\n  {\n    wtsId: \"EnglandAndWalesCensus1901\",\n    partOf: [\"EnglandWalesAndScotlandCensus1901\"],\n    title: \"1901 Census of England and Wales\",\n    country: \"England and Wales\",\n    dates: { year: 1901, exactDate: \"31 Mar 1901\" },\n    sites: {\n      fs: { id: \"1888129\", title: \"England and Wales Census, 1901\" },\n    },\n  },\n  {\n    wtsId: \"EnglandAndWalesCensus1911\",\n    partOf: [\"EnglandWalesAndScotlandCensus1911\"],\n    title: \"1911 Census of England and Wales\",\n    country: \"England and Wales\",\n    dates: { year: 1911, exactDate: \"2 Apr 1911\" },\n    householdTableColumns: houseTableColumnsUk1851to1911,\n    sites: {\n      fs: { id: \"1921547\", title: \"England and Wales Census, 1911\" },\n      fmp: {\n        id: \"1911 Census For England & Wales\",\n        title: \"1911 Census For England & Wales\",\n        searchQueryFields: { maritalStatus: \"condition\" },\n      },\n      freecen: { id: \"1911\", title: \"1911 England and Wales census\" },\n    },\n  },\n  {\n    wtsId: \"EnglandAndWalesCensus1921\",\n    title: \"1921 Census of England and Wales\",\n    country: \"England and Wales\",\n    dates: { year: 1921 },\n    householdTableColumns: [\n      \"name\",\n      \"relationship\",\n      \"gender\",\n      \"maritalStatus\",\n      \"age\",\n      \"birthYear\",\n      \"birthPlace\",\n      \"occupation\",\n      \"employer\",\n    ],\n    sites: {\n      fmp: {\n        id: \"1921 Census Of England & Wales\",\n        title: \"1921 Census Of England & Wales\",\n        searchQueryFields: {\n          maritalStatus: \"maritalstatus\",\n          occupation: \"occupationtext\",\n          birthPlace: \"whereborntext\",\n        },\n      },\n    },\n  },\n  // England Census\n  {\n    wtsId: \"EnglandCensus1841\",\n    partOf: [\"EnglandAndWalesCensus1841\"],\n    title: \"1841 Census of England\",\n    country: \"England\",\n    dates: { year: 1841, exactDate: \"6 Jun 1841\" },\n    sites: {\n      ancestry: {\n        id: \"8978\",\n        altId: \"uki1841\",\n        title: \"1841 England Census\",\n        searchQueryFields: {\n          piece: \"f-F0003039\",\n          folio: \"f-F000303A\",\n          page: \"f-F00032DB\",\n          book: \"f-F0002996\",\n          district: \"f-F000303D\",\n          subDistrict: \"f-F000303E\",\n        },\n      },\n    },\n  },\n  {\n    wtsId: \"EnglandCensus1851\",\n    partOf: [\"EnglandAndWalesCensus1851\"],\n    title: \"1851 Census of England\",\n    country: \"England\",\n    dates: { year: 1851, exactDate: \"30 Mar 1851\" },\n    sites: {\n      ancestry: {\n        id: \"8860\",\n        altId: \"uki1851\",\n        title: \"1851 England Census\",\n        searchQueryFields: {\n          piece: \"f-F0005C4F\",\n          folio: \"f-F0005E11\",\n          page: \"f-F0005906\",\n          schedule: \"f-F0006867\",\n          district: \"f-F0005DFD\",\n          subDistrict: \"f-F0006301\",\n          eccPar: \"f-F0005DFB\",\n          enumDistrict: \"f-F0005DFC\",\n        },\n      },\n    },\n  },\n  {\n    wtsId: \"EnglandCensus1861\",\n    partOf: [\"EnglandAndWalesCensus1861\"],\n    title: \"1861 Census of England\",\n    country: \"England\",\n    dates: { year: 1861, exactDate: \"7 Apr 1861\" },\n    sites: {\n      ancestry: {\n        id: \"8767\",\n        altId: \"uki1861\",\n        title: \"1861 England Census\",\n        searchQueryFields: {\n          piece: \"f-F0007B87\",\n          folio: \"f-F0007B88\",\n          page: \"f-F000597C\",\n        },\n      },\n    },\n  },\n  {\n    wtsId: \"EnglandCensus1871\",\n    partOf: [\"EnglandAndWalesCensus1871\"],\n    title: \"1871 Census of England\",\n    country: \"England\",\n    dates: { year: 1871, exactDate: \"2 Apr 1871\" },\n    sites: {\n      // tested and default piece, folio and page work\n      ancestry: { id: \"7619\", altId: \"uki1871\", title: \"1871 England Census\" },\n    },\n  },\n  {\n    wtsId: \"EnglandCensus1881\",\n    partOf: [\"EnglandAndWalesCensus1881\"],\n    title: \"1881 Census of England\",\n    country: \"England\",\n    dates: { year: 1881, exactDate: \"3 Apr 1881\" },\n    sites: {\n      ancestry: {\n        id: \"7572\",\n        altId: \"uki1881\",\n        title: \"1881 England Census\",\n        searchQueryFields: {\n          piece: \"f-F800686D\",\n          folio: \"f-F0005E11\",\n          page: \"f-F0005906\",\n          district: \"f-F000925D\",\n          subDistrict: \"f-F00079A7\",\n          enumDistrict: \"f-F0005DFC\",\n        },\n      },\n    },\n  },\n  {\n    wtsId: \"EnglandCensus1891\",\n    partOf: [\"EnglandAndWalesCensus1891\"],\n    title: \"1891 Census of England\",\n    country: \"England\",\n    dates: { year: 1891, exactDate: \"5 Apr 1891\" },\n    sites: {\n      ancestry: { id: \"6598\", altId: \"uki1891\", title: \"1891 England Census\" },\n    },\n  },\n  {\n    wtsId: \"EnglandCensus1901\",\n    partOf: [\"EnglandAndWalesCensus1901\"],\n    title: \"1901 Census of England\",\n    country: \"England\",\n    dates: { year: 1901, exactDate: \"31 Mar 1901\" },\n    sites: {\n      ancestry: {\n        id: \"7814\",\n        altId: \"uki1901\",\n        title: \"1901 England Census\",\n        searchQueryFields: {\n          piece: \"f-F0005C4F\",\n          folio: \"f-F0005E11\",\n          page: \"f-F0005906\",\n          schedule: \"f-F0006867\",\n          district: \"f-F0007AD6\",\n          subDistrict: \"f-F00079A7\",\n          enumDistrict: \"f-F0005DFC\",\n        },\n      },\n    },\n  },\n  {\n    wtsId: \"EnglandCensus1911\",\n    partOf: [\"EnglandAndWalesCensus1911\"],\n    title: \"1911 Census of England\",\n    country: \"England\",\n    dates: { year: 1911, exactDate: \"2 Apr 1911\" },\n    sites: {\n      ancestry: {\n        id: \"2352\",\n        altId: \"1911England\",\n        title: \"1911 England Census\",\n      },\n    },\n  },\n  // Wales Census\n  {\n    wtsId: \"WalesCensus1841\",\n    partOf: [\"EnglandAndWalesCensus1841\"],\n    title: \"1841 Census of Wales\",\n    country: \"Wales\",\n    dates: { year: 1841, exactDate: \"6 Jun 1841\" },\n    sites: {\n      ancestry: { id: \"8979\", altId: \"uki1841wales\" },\n    },\n  },\n  {\n    wtsId: \"WalesCensus1851\",\n    partOf: [\"EnglandAndWalesCensus1851\"],\n    title: \"1851 Census of Wales\",\n    country: \"Wales\",\n    dates: { year: 1851, exactDate: \"30 Mar 1851\" },\n    sites: {\n      ancestry: { id: \"8861\", altId: \"uki1851wales\" },\n    },\n  },\n  {\n    wtsId: \"WalesCensus1861\",\n    partOf: [\"EnglandAndWalesCensus1861\"],\n    title: \"1861 Census of Wales\",\n    country: \"Wales\",\n    dates: { year: 1861, exactDate: \"7 Apr 1861\" },\n    sites: {\n      ancestry: { id: \"8768\", altId: \"uki1861wales\" },\n    },\n  },\n  {\n    wtsId: \"WalesCensus1871\",\n    partOf: [\"EnglandAndWalesCensus1871\"],\n    title: \"1871 Census of Wales\",\n    country: \"Wales\",\n    dates: { year: 1871, exactDate: \"2 Apr 1871\" },\n    sites: {\n      ancestry: { id: \"7618\", altId: \"uki1871wales\" },\n    },\n  },\n  {\n    wtsId: \"WalesCensus1881\",\n    partOf: [\"EnglandAndWalesCensus1881\"],\n    title: \"1881 Census of Wales\",\n    country: \"Wales\",\n    dates: { year: 1881, exactDate: \"3 Apr 1881\" },\n    sites: {\n      ancestry: { id: \"8059\", altId: \"uki1881wales\" },\n    },\n  },\n  {\n    wtsId: \"WalesCensus1891\",\n    partOf: [\"EnglandAndWalesCensus1891\"],\n    title: \"1891 Census of Wales\",\n    country: \"Wales\",\n    dates: { year: 1891, exactDate: \"5 Apr 1891\" },\n    sites: {\n      ancestry: { id: \"6897\", altId: \"uki1891wales\" },\n    },\n  },\n  {\n    wtsId: \"WalesCensus1901\",\n    partOf: [\"EnglandAndWalesCensus1901\"],\n    title: \"1901 Census of Wales\",\n    country: \"Wales\",\n    dates: { year: 1901, exactDate: \"31 Mar 1901\" },\n    sites: {\n      ancestry: { id: \"7815\", altId: \"uki1901wales\" },\n    },\n  },\n  {\n    wtsId: \"WalesCensus1911\",\n    partOf: [\"EnglandAndWalesCensus1911\"],\n    title: \"1911 Census of Wales\",\n    country: \"Wales\",\n    dates: { year: 1911, exactDate: \"2 Apr 1911\" },\n    sites: {\n      ancestry: { id: \"2353\", altId: \"1911Wales\" },\n    },\n  },\n  // Scotland Census\n  {\n    wtsId: \"ScotlandCensus1841\",\n    partOf: [\"EnglandWalesAndScotlandCensus1841\"],\n    title: \"1841 Census of Scotland\",\n    country: \"Scotland\",\n    dates: { year: 1841, exactDate: \"6 Jun 1841\" },\n    sites: {\n      ancestry: {\n        id: \"1004\",\n        searchQueryFields: { district: \"\", registrationNumber: \"f-F0003968\" }, // no Page or ED supported\n      },\n      scotp: { id: \"census1841\" },\n    },\n  },\n  {\n    wtsId: \"ScotlandCensus1851\",\n    partOf: [\"EnglandWalesAndScotlandCensus1851\"],\n    title: \"1851 Census of Scotland\",\n    country: \"Scotland\",\n    dates: { year: 1851, exactDate: \"30 Mar 1851\" },\n    sites: {\n      ancestry: {\n        id: \"1076\",\n        searchQueryFields: {\n          district: \"\",\n          enumDistrict: \"f-F0005DFC\",\n          registrationNumber: \"f-F0007E02\",\n          page: \"f-F8007E01\",\n        },\n      },\n      scotp: { id: \"census1851\" },\n    },\n  },\n  {\n    wtsId: \"ScotlandCensus1861\",\n    partOf: [\"EnglandWalesAndScotlandCensus1861\"],\n    title: \"1861 Census of Scotland\",\n    country: \"Scotland\",\n    dates: { year: 1861, exactDate: \"7 Apr 1861\" },\n    sites: {\n      ancestry: {\n        id: \"1080\",\n        searchQueryFields: {\n          district: \"f-F0003B8A\",\n          enumDistrict: \"f-F00032ED\",\n          registrationNumber: \"f-F0003B89\",\n        },\n      },\n      scotp: { id: \"census1861\" },\n    },\n  },\n  {\n    wtsId: \"ScotlandCensus1871\",\n    partOf: [\"EnglandWalesAndScotlandCensus1871\"],\n    title: \"1871 Census of Scotland\",\n    country: \"Scotland\",\n    dates: { year: 1871, exactDate: \"2 Apr 1871\" },\n    sites: {\n      ancestry: {\n        id: \"1104\",\n        searchQueryFields: {\n          district: \"f-F0003B8A\",\n          enumDistrict: \"f-F00032ED\",\n          registrationNumber: \"f-F0003B89\",\n        },\n      },\n      scotp: { id: \"census1871\" },\n    },\n  },\n  {\n    wtsId: \"ScotlandCensus1881\",\n    partOf: [\"EnglandWalesAndScotlandCensus1881\"],\n    title: \"1881 Census of Scotland\",\n    country: \"Scotland\",\n    dates: { year: 1881, exactDate: \"3 Apr 1881\" },\n    sites: {\n      ancestry: {\n        id: \"1119\",\n        searchQueryFields: {\n          district: \"f-F0003B8A\",\n          enumDistrict: \"f-F00032ED\",\n          registrationNumber: \"f-F0003B89\",\n        },\n      },\n      scotp: { id: \"census1881\" },\n    },\n  },\n  {\n    wtsId: \"ScotlandCensus1891\",\n    partOf: [\"EnglandWalesAndScotlandCensus1891\"],\n    title: \"1891 Census of Scotland\",\n    country: \"Scotland\",\n    dates: { year: 1891, exactDate: \"5 Apr 1891\" },\n    sites: {\n      ancestry: {\n        id: \"1108\",\n        searchQueryFields: {\n          district: \"f-F0003B8A\",\n          enumDistrict: \"f-F00032ED\",\n          registrationNumber: \"f-F0003B89\",\n        },\n      },\n      scotp: { id: \"census1891\" },\n    },\n  },\n  {\n    wtsId: \"ScotlandCensus1901\",\n    partOf: [\"EnglandWalesAndScotlandCensus1901\"],\n    title: \"1901 Census of Scotland\",\n    country: \"Scotland\",\n    dates: { year: 1901, exactDate: \"31 Mar 1901\" },\n    sites: {\n      ancestry: {\n        id: \"1101\",\n        searchQueryFields: {\n          district: \"f-F0003B8A\",\n          enumDistrict: \"f-F00032ED\",\n          registrationNumber: \"f-F0003B89\",\n        },\n      },\n      scotp: { id: \"census1901\" },\n    },\n  },\n  {\n    wtsId: \"ScotlandCensus1911\",\n    partOf: [\"EnglandWalesAndScotlandCensus1911\"],\n    title: \"1901 Census of Scotland\",\n    country: \"Scotland\",\n    dates: { year: 1901, exactDate: \"31 Mar 1901\" },\n    sites: {\n      scotp: { id: \"census1911\" },\n    },\n  },\n  // 1939 Register\n  {\n    wtsId: \"EnglandAndWales1939Register\",\n    title: \"1939 England and Wales Register\",\n    country: \"England and Wales\",\n    dates: { year: 1939 },\n    householdTableColumns: [\"name\", \"maritalStatus\", \"gender\", \"birthDate\", \"occupation\"],\n    sites: {\n      ancestry: { id: \"61596\" },\n      fmp: {\n        id: \"1939 Register\",\n        searchQueryFields: { maritalStatus: \"maritalstatus\" },\n      },\n      fs: { id: \"2836130\", title: \"England and Wales National Register, 1939\" },\n    },\n  },\n  // England & Wales Probate\n  {\n    wtsId: \"EnglandAndWalesProbate\",\n    title: \"England & Wales, National Probate Calendar, 1858-1995\",\n    country: \"England and Wales\",\n    sites: {\n      ancestry: { id: \"1904\", dates: { from: 1858, to: 1995 } },\n    },\n  },\n  // British Phone Books\n  {\n    wtsId: \"BritishPhoneBooks\",\n    title: \"British Phone Books, 1880-1984\",\n    country: \"United Kingdom\",\n    sites: {\n      ancestry: { id: \"1025\", dates: { from: 1880, to: 1984 } },\n    },\n  },\n\n  ///////////////////////////////////////////////////////////////////////////////////////////////////////\n  // US\n  ///////////////////////////////////////////////////////////////////////////////////////////////////////\n\n  // United States Federal Census\n  {\n    wtsId: \"UsCensus1790\",\n    title: \"1790 United States Federal Census\",\n    country: \"United States\",\n    dates: { year: 1790, exactDate: \"2 Aug 1790\" },\n    sites: {\n      fs: { id: \"1803959\" },\n      ancestry: { id: \"5058\" },\n      fmp: { id: \"US Census 1790\" },\n    },\n  },\n  {\n    wtsId: \"UsCensus1800\",\n    title: \"1800 United States Federal Census\",\n    country: \"United States\",\n    dates: { year: 1800, exactDate: \"4 Aug 1800\" },\n    sites: {\n      fs: { id: \"1804228\" },\n      ancestry: { id: \"7590\" },\n      fmp: { id: \"US Census 1800\" },\n    },\n  },\n  {\n    wtsId: \"UsCensus1810\",\n    title: \"1810 United States Federal Census\",\n    country: \"United States\",\n    dates: { year: 1810, exactDate: \"6 Aug 1810\" },\n    sites: {\n      fs: { id: \"1803765\" },\n      ancestry: { id: \"7613\" },\n      fmp: { id: \"US Census 1810\" },\n    },\n  },\n  {\n    wtsId: \"UsCensus1820\",\n    title: \"1820 United States Federal Census\",\n    country: \"United States\",\n    dates: { year: 1820, exactDate: \"7 Aug 1820\" },\n    sites: {\n      fs: { id: \"1803955\" },\n      ancestry: { id: \"7734\" },\n      fmp: { id: \"US Census 1820\" },\n    },\n  },\n  {\n    wtsId: \"UsCensus1830\",\n    title: \"1830 United States Federal Census\",\n    country: \"United States\",\n    dates: { year: 1830, exactDate: \"1 Jun 1830\" },\n    sites: {\n      fs: { id: \"1803958\" },\n      ancestry: { id: \"8058\" },\n      fmp: { id: \"US Census 1830\" },\n    },\n  },\n  {\n    wtsId: \"UsCensus1840\",\n    title: \"1840 United States Federal Census\",\n    country: \"United States\",\n    dates: { year: 1840, exactDate: \"1 Jun 1840\" },\n    sites: {\n      fs: { id: \"1786457\" },\n      ancestry: { id: \"8057\" },\n      fmp: { id: \"US Census 1840\" },\n    },\n  },\n  {\n    wtsId: \"UsCensus1850\",\n    title: \"1850 United States Federal Census\",\n    country: \"United States\",\n    dates: { year: 1850, exactDate: \"1 Jun 1850\" },\n    householdTableColumns: householdTableColumnsUsFederal1850,\n    sites: {\n      fs: { id: \"1401638\" },\n      ancestry: { id: \"8054\" },\n      fmp: { id: \"US Census 1850\" },\n    },\n  },\n  {\n    wtsId: \"UsCensus1860\",\n    title: \"1860 United States Federal Census\",\n    country: \"United States\",\n    dates: { year: 1860, exactDate: \"1 Jun 1860\" },\n    householdTableColumns: householdTableColumnsUsFederal1850,\n    sites: {\n      fs: { id: \"1473181\" },\n      ancestry: { id: \"7667\" },\n      fmp: { id: \"US Census 1860\" },\n    },\n  },\n  {\n    wtsId: \"UsCensus1870\",\n    title: \"1870 United States Federal Census\",\n    country: \"United States\",\n    dates: { year: 1870, exactDate: \"1 Jun 1870\" },\n    householdTableColumns: householdTableColumnsUsFederal1850,\n    sites: {\n      fs: { id: \"1438024\" },\n      ancestry: { id: \"7163\" },\n      fmp: { id: \"US Census 1870\" },\n    },\n  },\n  {\n    wtsId: \"UsCensus1880\",\n    title: \"1880 United States Federal Census\",\n    country: \"United States\",\n    dates: { year: 1880, exactDate: \"1 Jun 1880\" },\n    householdTableColumns: householdTableColumnsUsFederalPost1880,\n    sites: {\n      fs: { id: \"1417683\" },\n      ancestry: { id: \"6742\" },\n      fmp: { id: \"US Census 1880\" },\n    },\n  },\n  {\n    wtsId: \"UsCensus1890\",\n    title: \"1890 United States Federal Census\",\n    country: \"United States\",\n    dates: { year: 1890, exactDate: \"2 Jun 1890\" },\n    householdTableColumns: householdTableColumnsUsFederalPost1880,\n    sites: {\n      fs: { id: \"1610551\" },\n      ancestry: {\n        id: \"5445\",\n        title: \"1890 United States Federal Census Fragment\",\n      },\n      fmp: { id: \"US Census 1890\" },\n    },\n  },\n  {\n    wtsId: \"UsCensus1900\",\n    title: \"1900 United States Federal Census\",\n    country: \"United States\",\n    dates: { year: 1900, exactDate: \"1 Jun 1900\" },\n    householdTableColumns: householdTableColumnsUsFederalPost1880,\n    sites: {\n      fs: { id: \"1325221\" },\n      ancestry: { id: \"7602\" },\n      fmp: { id: \"US Census 1900\" },\n    },\n  },\n  {\n    wtsId: \"UsCensus1910\",\n    title: \"1910 United States Federal Census\",\n    country: \"United States\",\n    dates: { year: 1910, exactDate: \"15 Apr 1910\" },\n    householdTableColumns: householdTableColumnsUsFederalPost1880,\n    sites: {\n      fs: { id: \"1727033\" },\n      ancestry: { id: \"7884\" },\n      fmp: { id: \"US Census 1910\" },\n    },\n  },\n  {\n    wtsId: \"UsCensus1920\",\n    title: \"1920 United States Federal Census\",\n    country: \"United States\",\n    dates: { year: 1920, exactDate: \"1 Jan 1920\" },\n    householdTableColumns: householdTableColumnsUsFederalPost1880,\n    sites: {\n      fs: { id: \"1488411\" },\n      ancestry: { id: \"6061\" },\n      fmp: { id: \"US Census 1920\" },\n    },\n  },\n  {\n    wtsId: \"UsCensus1930\",\n    title: \"1930 United States Federal Census\",\n    country: \"United States\",\n    dates: { year: 1930, exactDate: \"2 Apr 1930\" },\n    householdTableColumns: householdTableColumnsUsFederalPost1880,\n    sites: {\n      fs: { id: \"1810731\" },\n      ancestry: { id: \"6224\" },\n      fmp: { id: \"US Census 1930\" },\n    },\n  },\n  {\n    wtsId: \"UsCensus1940\",\n    title: \"1940 United States Federal Census\",\n    country: \"United States\",\n    dates: { year: 1940, exactDate: \"1 Apr 1940\" },\n    householdTableColumns: householdTableColumnsUsFederalPost1880,\n    sites: {\n      fs: { id: \"2000219\" },\n      ancestry: { id: \"2442\" },\n      fmp: { id: \"US Census 1940\" },\n    },\n  },\n  {\n    wtsId: \"UsCensus1950\",\n    title: \"1950 United States Federal Census\",\n    country: \"United States\",\n    dates: { year: 1950, exactDate: \"1 Apr 1950\" },\n    householdTableColumns: householdTableColumnsUsFederalPost1880,\n    sites: {\n      ancestry: { id: \"62308\" },\n      fs: { id: \"4464515\" },\n      // fmp: { id: \"US Census 1950\"}, // Not yet transcribed on FMP (as of 31 Aug 2022)\n    },\n  },\n\n  ///////////////////////////////////////////////////////////////////////////////////////////////////////\n  // Canada\n  ///////////////////////////////////////////////////////////////////////////////////////////////////////\n\n  // Canada Census\n  {\n    wtsId: \"CanadaCensus1851\",\n    title: \"1851 Census of Canada\",\n    country: \"Canada\",\n    dates: { year: 1851 },\n    sites: {\n      fs: { id: \"1325192\" },\n      ancestry: { id: \"1061\", aldId: \"1851Canada\" },\n      fmp: { id: \"Canada Census 1851\" },\n    },\n  },\n  {\n    wtsId: \"CanadaCensus1861\",\n    title: \"1861 Census of Canada\",\n    country: \"Canada\",\n    dates: { year: 1861 },\n    sites: {\n      // fs: { id: \"2143998\"}, (seems to be per state)\n      ancestry: { id: \"1570\" },\n      fmp: { id: \"Canada Census 1861\" },\n    },\n  },\n  {\n    wtsId: \"CanadaCensus1871\",\n    title: \"1871 Census of Canada\",\n    country: \"Canada\",\n    dates: { year: 1871 },\n    sites: {\n      fs: { id: \"1551612\" },\n      ancestry: { id: \"1578\" },\n      fmp: { id: \"Canada Census 1871\" },\n    },\n  },\n  {\n    wtsId: \"CanadaCensus1881\",\n    title: \"1881 Census of Canada\",\n    country: \"Canada\",\n    dates: { year: 1881 },\n    sites: {\n      fs: { id: \"1804541\" },\n      ancestry: { id: \"1577\", altId: \"1881Canada\" },\n      fmp: { id: \"Canada Census 1881\" },\n    },\n  },\n  {\n    wtsId: \"CanadaCensus1891\",\n    title: \"1891 Census of Canada\",\n    country: \"Canada\",\n    dates: { year: 1891 },\n    sites: {\n      fs: { id: \"1583536\" },\n      ancestry: { id: \"1274\" },\n      fmp: { id: \"Canada Census 1891\" },\n    },\n  },\n  {\n    wtsId: \"CanadaCensus1901\",\n    title: \"1901 Census of Canada\",\n    country: \"Canada\",\n    dates: { year: 1901 },\n    householdTableColumns: [\n      \"name\",\n      \"gender\",\n      \"age\",\n      \"relationship\",\n      \"maritalStatus\",\n      \"birthDate\",\n      \"birthPlace\",\n      \"occupation\",\n    ],\n    sites: {\n      fs: { id: \"1584557\" },\n      ancestry: { id: \"8826\" },\n      fmp: {\n        id: \"Canada Census 1901\",\n        searchQueryFields: { maritalstatus: \"maritalstatus\" },\n      },\n    },\n  },\n  {\n    wtsId: \"CanadaCensus1911\",\n    title: \"1911 Census of Canada\",\n    country: \"Canada\",\n    dates: { year: 1911 },\n    householdTableColumns: [\n      \"name\",\n      \"gender\",\n      \"age\",\n      \"relationship\",\n      \"maritalStatus\",\n      \"birthDate\",\n      \"birthPlace\",\n      \"occupation\",\n    ],\n    sites: {\n      fs: { id: \"2143998\" },\n      ancestry: { id: \"8947\" },\n      fmp: { id: \"Canada Census 1911\" },\n    },\n  },\n  {\n    wtsId: \"CanadaCensus1921\",\n    title: \"1921 Census of Canada\",\n    country: \"Canada\",\n    dates: { year: 1921 },\n    householdTableColumns: [\"name\", \"gender\", \"age\", \"relationship\", \"maritalStatus\", \"birthPlace\", \"occupation\"],\n    sites: {\n      ancestry: { id: \"8991\" },\n    },\n  },\n  // Poland\n  {\n    wtsId: \"PolandBirthReg\",\n    title: \"Poland Registration Birth Index\",\n    country: \"Poland\",\n    isBirth: true,\n    sites: {\n      geneteka: { id: \"births\" },\n    },\n  },\n  {\n    wtsId: \"PolandDeathReg\",\n    title: \"Poland Registration Death Index\",\n    country: \"Poland\",\n    isDeath: true,\n    sites: {\n      geneteka: { id: \"deaths\" },\n    },\n  },\n  {\n    wtsId: \"PolandMarriageReg\",\n    title: \"Poland Registration Marriage Index\",\n    country: \"Poland\",\n    isMarriage: true,\n    sites: {\n      geneteka: { id: \"marriages\" },\n    },\n  },\n];\n\nconst RC = {\n  findCollection: function (siteName, collectionId) {\n    for (let collection of RecordCollectionData) {\n      if (collection.sites && collection.sites[siteName] && collection.sites[siteName].id == collectionId) {\n        return collection;\n      }\n    }\n  },\n  findCollectionByAltId: function (siteName, altCollectionId) {\n    for (let collection of RecordCollectionData) {\n      if (collection.sites && collection.sites[siteName] && collection.sites[siteName].altId == altCollectionId) {\n        return collection;\n      }\n    }\n  },\n  findCollectionByWtsId: function (collectionId) {\n    for (let collection of RecordCollectionData) {\n      if (collection.wtsId == collectionId) {\n        return collection;\n      }\n    }\n  },\n  getCollectionsThatThisCollectionIsPartOf: function (collection) {\n    let result = [];\n    if (collection.partOf) {\n      for (let owningCollectionWtsId of collection.partOf) {\n        let owningCollection = RC.findCollectionByWtsId(owningCollectionWtsId);\n        if (owningCollection) {\n          result.push(owningCollection);\n\n          let parentCollections = RC.getCollectionsThatThisCollectionIsPartOf(owningCollection);\n          for (let parentCollection of parentCollections) {\n            result.push(parentCollection);\n          }\n        } else {\n          console.log(\"Error: owningCollectionWtsId of '\" + owningCollectionWtsId + \"' was not found\");\n        }\n      }\n    }\n    return result;\n  },\n  getCollectionsThatArePartOfThisCollection: function (collection) {\n    let result = [];\n\n    function doesCollectionOwnCollection(parentCollection, childCollection) {\n      let parentWtsId = parentCollection.wtsId;\n      if (childCollection.partOf) {\n        for (let owningCollectionWtsId of childCollection.partOf) {\n          if (owningCollectionWtsId == parentWtsId) {\n            return true;\n          }\n          let owningCollection = RC.findCollectionByWtsId(owningCollectionWtsId);\n          if (doesCollectionOwnCollection(parentCollection, owningCollection)) {\n            return true;\n          }\n        }\n      }\n      return false;\n    }\n\n    for (let otherCollection of RecordCollectionData) {\n      if (doesCollectionOwnCollection(collection, otherCollection)) {\n        result.push(otherCollection);\n      }\n    }\n    return result;\n  },\n  mapCollectionId: function (sourceSiteName, sourceCollectionId, targetSiteName, sourceCountry, eventYearString) {\n    let eventYear = parseInt(eventYearString);\n    if (isNaN(eventYear)) {\n      eventYear = undefined;\n    }\n\n    let sourceCollection = RC.findCollection(sourceSiteName, sourceCollectionId);\n    let targetCollectionId = RC.getSiteIdFromCollection(sourceCollection, targetSiteName);\n    if (!targetCollectionId && sourceCollection) {\n      // sometimes collections don't map exactly, the source collection could be part of a collection\n      let owningCollections = RC.getCollectionsThatThisCollectionIsPartOf(sourceCollection);\n      for (let owningCollection of owningCollections) {\n        let owningTargetCollectionId = RC.getSiteIdFromCollection(owningCollection, targetSiteName);\n        if (owningTargetCollectionId) {\n          return owningTargetCollectionId;\n        }\n      }\n      // or other collections could be part of the source collection\n      let bestMatchCollection = undefined;\n      let ownedCollections = RC.getCollectionsThatArePartOfThisCollection(sourceCollection);\n      for (let ownedCollection of ownedCollections) {\n        // Note there could be several collections that are part of this collection\n        // we should use country as a guide\n        let ownedTargetCollectionId = RC.getSiteIdFromCollection(ownedCollection, targetSiteName);\n        if (ownedTargetCollectionId) {\n          if (eventYear && ownedCollection.sites) {\n            let siteCollection = ownedCollection.sites[targetSiteName];\n            let collDates = RC.getCollectionDates(ownedCollection, siteCollection);\n\n            let isYearInRange = false;\n            if (collDates.from && collDates.to) {\n              if (eventYear >= collDates.from && eventYear <= collDates.to) {\n                isYearInRange = true;\n              }\n            } else if (collDates.year && collDates.year == eventYear) {\n              isYearInRange = true;\n            }\n\n            let isCountryOK = false;\n            if (sourceCountry) {\n              if (ownedCollection.country == sourceCountry) {\n                isCountryOK = true;\n              } else if (_country_data_mjs__WEBPACK_IMPORTED_MODULE_0__.CD.isPartOf(sourceCountry, ownedCollection.country)) {\n                isCountryOK = true;\n              } else if (_country_data_mjs__WEBPACK_IMPORTED_MODULE_0__.CD.isPartOf(ownedCollection.country, sourceCountry)) {\n                isCountryOK = true;\n              }\n            } else {\n              isCountryOK = true;\n            }\n\n            if (isYearInRange && isCountryOK) {\n              return ownedTargetCollectionId;\n            }\n          } else if (ownedCollection.country == sourceCountry) {\n            return ownedTargetCollectionId;\n          }\n\n          if (!bestMatchCollection) {\n            bestMatchCollection = ownedCollection;\n          }\n        }\n      }\n      if (bestMatchCollection) {\n        let bestMatchCollectionId = RC.getSiteIdFromCollection(bestMatchCollection, targetSiteName);\n        targetCollectionId = bestMatchCollectionId;\n      }\n    }\n    return targetCollectionId;\n  },\n  getSiteIdFromCollection: function (collection, site) {\n    if (collection && collection.sites && collection.sites[site]) {\n      return collection.sites[site].id;\n    }\n  },\n  getCountryFromCollection: function (collection) {\n    if (collection) {\n      return collection.country;\n    }\n  },\n  getCollectionDates: function (collection, siteCollection) {\n    let collDates = siteCollection.dates;\n    if (!collDates) {\n      collDates = collection.dates;\n      if (!collDates) {\n        //console.log(\"return false, no dates\");\n        return false;\n      }\n    } else if (collection.dates) {\n      // there is a dates field in both this sites collection data and in the whole collection\n      // we should combine them using the site one as priority\n      for (const [key, value] of Object.entries(collection.dates)) {\n        if (!collDates[key]) {\n          collDates[key] = value;\n        }\n      }\n    }\n\n    return collDates;\n  },\n  areSourceDatesInCollectionRange: function (sourceDates, collection, siteCollection) {\n    let lifeSpan = 120;\n    if (sourceDates.maxLifespan) {\n      lifeSpan = sourceDates.maxLifespan;\n    }\n\n    //console.log(\"areSourceDatesInCollectionRange, sourceDates and collection:\")\n    //console.log(sourceDates);\n    //console.log(collection);\n\n    let collDates = RC.getCollectionDates(collection, siteCollection);\n\n    let isBirthCollection = collection.isBirth;\n    let isDeathCollection = collection.isDeath;\n\n    let birthYear = parseInt(sourceDates.birthYear);\n    let deathYear = parseInt(sourceDates.deathYear);\n    let eventYear = parseInt(sourceDates.eventYear);\n\n    let minSourceYear = birthYear;\n    if (!minSourceYear) {\n      if (deathYear) {\n        minSourceYear = deathYear - lifeSpan;\n      } else {\n        minSourceYear = eventYear - lifeSpan;\n      }\n    }\n\n    let maxSourceYear = deathYear;\n    if (!maxSourceYear) {\n      if (birthYear) {\n        maxSourceYear = birthYear + lifeSpan;\n      } else {\n        maxSourceYear = eventYear + lifeSpan;\n      }\n    }\n\n    if (isBirthCollection && birthYear) {\n      // must have from and to years\n      let fromYear = collDates.from;\n      let toYear = collDates.to;\n      let isInRange = birthYear + 1 >= fromYear && birthYear <= toYear;\n      //console.log(\"return (a) : \" + isInRange);\n      return isInRange;\n    }\n\n    if (isDeathCollection && deathYear) {\n      // must have from and to years\n      let fromYear = collDates.from;\n      let toYear = collDates.to;\n      let isInRange = deathYear + 1 >= fromYear && deathYear <= toYear;\n      //console.log(\"return (b) : \" + isInRange);\n      return isInRange;\n    }\n\n    if (collDates.year) {\n      let collYear = collDates.year;\n      let isInRange = collYear + 2 >= minSourceYear && collYear - 2 <= maxSourceYear;\n      //console.log(\"return (c) : \" + isInRange);\n      return isInRange;\n    } else {\n      // must have from and to years\n      let fromYear = collDates.from;\n      let toYear = collDates.to;\n      let isInRange = maxSourceYear >= fromYear && minSourceYear <= toYear;\n      //console.log(\"return (d) : \" + isInRange);\n      return isInRange;\n    }\n\n    return false;\n  },\n  areAnyCountriesInCollectionRange: function (countryArray, collection) {\n    if (!countryArray) {\n      //console.log(\"areAnyCountriesInCollectionRange, no countries\")\n      return false;\n    }\n\n    //console.log(\"areAnyCountriesInCollectionRange, countryArray and collection:\")\n    //console.log(countryArray);\n    //console.log(collection);\n\n    let collCountry = collection.country;\n\n    for (let country of countryArray) {\n      if (country == collCountry || _country_data_mjs__WEBPACK_IMPORTED_MODULE_0__.CD.isPartOf(country, collCountry) || _country_data_mjs__WEBPACK_IMPORTED_MODULE_0__.CD.isPartOf(collCountry, country)) {\n        //console.log(\"return true, country = \" + country);\n        return true;\n      }\n      //console.log(\"country: \" + country + \" is not equivalent to: \" + collCountry);\n    }\n    //console.log(\"return false\");\n    return false;\n  },\n  findCollectionsForSiteWithinDateRangeAndCountries: function (siteName, dates, countryArray) {\n    let collectionArray = [];\n    for (let collection of RecordCollectionData) {\n      if (collection.sites) {\n        let siteCollection = collection.sites[siteName];\n        if (siteCollection) {\n          if (RC.areSourceDatesInCollectionRange(dates, collection, siteCollection)) {\n            if (\n              !countryArray ||\n              countryArray.length == 0 ||\n              RC.areAnyCountriesInCollectionRange(countryArray, collection)\n            ) {\n              collectionArray.push(collection);\n            }\n          }\n        }\n      }\n    }\n    return collectionArray;\n  },\n  getFieldFromCollectionOrOwningCollections: function (collection, fieldName) {\n    if (collection[fieldName] != undefined) {\n      return collection[fieldName];\n    }\n\n    if (collection.partOf && collection.partOf.length > 0) {\n      for (let owningCollectionWtsId of collection.partOf) {\n        let owningCollection = RC.findCollectionByWtsId(owningCollectionWtsId);\n        let fieldValue = RC.getFieldFromCollectionOrOwningCollections(owningCollection, fieldName);\n        if (fieldValue != undefined) {\n          return fieldValue;\n        }\n      }\n    }\n\n    return undefined;\n  },\n};\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9leHRlbnNpb24vYmFzZS9jb3JlL3JlY29yZF9jb2xsZWN0aW9ucy5tanMuanMiLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRXdDOztBQUV4QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUIsc0JBQXNCO0FBQ3ZDLHVCQUF1QixlQUFlO0FBQ3RDLE9BQU87QUFDUDtBQUNBO0FBQ0EsaUJBQWlCLHNCQUFzQjtBQUN2Qyw2QkFBNkIsc0JBQXNCO0FBQ25ELE9BQU87QUFDUCxhQUFhLHVCQUF1Qix3QkFBd0I7QUFDNUQsaUJBQWlCLHVCQUF1Qix3QkFBd0I7QUFDaEUsS0FBSztBQUNMLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQixzQkFBc0I7QUFDdkMsT0FBTztBQUNQLEtBQUs7QUFDTCxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQkFBa0IscUJBQXFCLHdCQUF3QjtBQUMvRCxLQUFLO0FBQ0wsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVksd0JBQXdCLHdCQUF3QjtBQUM1RDtBQUNBO0FBQ0EsaUJBQWlCLHNCQUFzQjtBQUN2QyxPQUFPO0FBQ1AsaUJBQWlCLDBCQUEwQix3QkFBd0I7QUFDbkUsS0FBSztBQUNMLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNB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Q0E7O0FBRUE7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQSxvQ0FBb0MsMERBQVcsMEJBQTBCLDBEQUFXO0FBQ3BGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLEdBQUc7QUFDSDs7QUFFYyIsInNvdXJjZXMiOlsid2VicGFjazovL0NpdGF0aW9uRXh0cmFjdG9yLy4vZXh0ZW5zaW9uL2Jhc2UvY29yZS9yZWNvcmRfY29sbGVjdGlvbnMubWpzP2JjNzEiXSwic291cmNlc0NvbnRlbnQiOlsiLypcbk1JVCBMaWNlbnNlXG5cbkNvcHlyaWdodCAoYykgMjAyMCBSb2JlcnQgTSBQYXZleVxuXG5QZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYSBjb3B5XG5vZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSBcIlNvZnR3YXJlXCIpLCB0byBkZWFsXG5pbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzXG50byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsXG5jb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXNcbmZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6XG5cblRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkIGluIGFsbFxuY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS5cblxuVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEIFwiQVMgSVNcIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUlxuSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksXG5GSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEVcbkFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVJcbkxJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sXG5PVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOIFRIRVxuU09GVFdBUkUuXG4qL1xuXG5pbXBvcnQgeyBDRCB9IGZyb20gXCIuL2NvdW50cnlfZGF0YS5tanNcIjtcblxuY29uc3QgaG91c2VUYWJsZUNvbHVtbnNVazE4NDEgPSBbXCJuYW1lXCIsIFwiZ2VuZGVyXCIsIFwiYWdlXCIsIFwib2NjdXBhdGlvblwiLCBcImJpcnRoUGxhY2VcIl07XG5jb25zdCBob3VzZVRhYmxlQ29sdW1uc1VrMTg1MXRvMTkxMSA9IFtcbiAgXCJuYW1lXCIsXG4gIFwicmVsYXRpb25zaGlwXCIsXG4gIFwibWFyaXRhbFN0YXR1c1wiLFxuICBcImdlbmRlclwiLFxuICBcImFnZVwiLFxuICBcImJpcnRoWWVhclwiLFxuICBcIm9jY3VwYXRpb25cIixcbiAgXCJiaXJ0aFBsYWNlXCIsXG5dO1xuXG5jb25zdCBob3VzZWhvbGRUYWJsZUNvbHVtbnNVc0ZlZGVyYWwxODUwID0gW1wibmFtZVwiLCBcImdlbmRlclwiLCBcImFnZVwiLCBcIm9jY3VwYXRpb25cIiwgXCJiaXJ0aFBsYWNlXCJdO1xuY29uc3QgaG91c2Vob2xkVGFibGVDb2x1bW5zVXNGZWRlcmFsUHJlMTg4MCA9IFtcIm5hbWVcIiwgXCJnZW5kZXJcIiwgXCJhZ2VcIiwgXCJtYXJpdGFsU3RhdHVzXCIsIFwib2NjdXBhdGlvblwiLCBcImJpcnRoUGxhY2VcIl07XG5jb25zdCBob3VzZWhvbGRUYWJsZUNvbHVtbnNVc0ZlZGVyYWxQb3N0MTg4MCA9IFtcbiAgXCJuYW1lXCIsXG4gIFwiZ2VuZGVyXCIsXG4gIFwiYWdlXCIsXG4gIFwibWFyaXRhbFN0YXR1c1wiLFxuICBcInJlbGF0aW9uc2hpcFwiLFxuICBcIm9jY3VwYXRpb25cIixcbiAgXCJiaXJ0aFBsYWNlXCIsXG5dO1xuXG5jb25zdCBSZWNvcmRDb2xsZWN0aW9uRGF0YSA9IFtcbiAgLy8gRW5nbGFuZCAmIFdhbGVzIEJNRFxuICB7XG4gICAgd3RzSWQ6IFwiRW5nbGFuZEFuZFdhbGVzQmlydGhSZWdcIixcbiAgICB0aXRsZTogXCJFbmdsYW5kICYgV2FsZXMsIENpdmlsIFJlZ2lzdHJhdGlvbiBCaXJ0aCBJbmRleFwiLFxuICAgIGNvdW50cnk6IFwiRW5nbGFuZCBhbmQgV2FsZXNcIixcbiAgICBpc0JpcnRoOiB0cnVlLFxuICAgIHNpdGVzOiB7XG4gICAgICBmczoge1xuICAgICAgICBpZDogXCIyMjg1MzM4XCIsXG4gICAgICAgIGRhdGVzOiB7IGZyb206IDE4MzcsIHRvOiAyMDA4IH0sXG4gICAgICAgIHNlYXJjaFRlcm1zOiB7IGdlbmRlcjogZmFsc2UgfSxcbiAgICAgIH0sXG4gICAgICBmbXA6IHtcbiAgICAgICAgaWQ6IFwiRW5nbGFuZCAmIFdhbGVzIEJpcnRocyAxODM3LTIwMDZcIixcbiAgICAgICAgZGF0ZXM6IHsgZnJvbTogMTgzNywgdG86IDIwMDYgfSxcbiAgICAgICAgc2VhcmNoUXVlcnlGaWVsZHM6IHsgdm9sdW1lOiBcIlwiLCBwYWdlOiBcIlwiIH0sXG4gICAgICB9LFxuICAgICAgZ3JvOiB7IGlkOiBcImJpcnRoc1wiLCBkYXRlczogeyBmcm9tOiAxODM3LCB0bzogMjAxOSB9IH0sXG4gICAgICBmcmVlYm1kOiB7IGlkOiBcImJpcnRoc1wiLCBkYXRlczogeyBmcm9tOiAxODM3LCB0bzogMTk5MiB9IH0sXG4gICAgfSxcbiAgfSxcbiAge1xuICAgIHd0c0lkOiBcIkVuZ2xhbmRBbmRXYWxlc0JpcnRoUmVnRWFybHlcIixcbiAgICBwYXJ0T2Y6IFtcIkVuZ2xhbmRBbmRXYWxlc0JpcnRoUmVnXCJdLFxuICAgIHRpdGxlOiBcIkVuZ2xhbmQgJiBXYWxlcywgQ2l2aWwgUmVnaXN0cmF0aW9uIEJpcnRoIEluZGV4IDE4MzctMTkxNVwiLFxuICAgIGNvdW50cnk6IFwiRW5nbGFuZCBhbmQgV2FsZXNcIixcbiAgICBpc0RlYXRoOiB0cnVlLFxuICAgIHNpdGVzOiB7XG4gICAgICBhbmNlc3RyeToge1xuICAgICAgICBpZDogXCI4OTEyXCIsXG4gICAgICAgIGFsdElkOiBcImZyZWVibWRiaXJ0aFwiLFxuICAgICAgICBkYXRlczogeyBmcm9tOiAxODM3LCB0bzogMTkxNSB9LFxuICAgICAgfSxcbiAgICB9LFxuICB9LFxuICB7XG4gICAgd3RzSWQ6IFwiRW5nbGFuZEFuZFdhbGVzQmlydGhSZWdMYXRlXCIsXG4gICAgcGFydE9mOiBbXCJFbmdsYW5kQW5kV2FsZXNCaXJ0aFJlZ1wiXSxcbiAgICB0aXRsZTogXCJFbmdsYW5kICYgV2FsZXMsIENpdmlsIFJlZ2lzdHJhdGlvbiBCaXJ0aCBJbmRleCAxOTE2LTIwMDdcIixcbiAgICBjb3VudHJ5OiBcIkVuZ2xhbmQgYW5kIFdhbGVzXCIsXG4gICAgaXNEZWF0aDogdHJ1ZSxcbiAgICBzaXRlczoge1xuICAgICAgYW5jZXN0cnk6IHsgaWQ6IFwiODc4MlwiLCBkYXRlczogeyBmcm9tOiAxOTE2LCB0bzogMjAwNyB9IH0sXG4gICAgfSxcbiAgfSxcbiAge1xuICAgIHd0c0lkOiBcIkVuZ2xhbmRBbmRXYWxlc01hcnJpYWdlUmVnXCIsXG4gICAgdGl0bGU6IFwiRW5nbGFuZCAmIFdhbGVzLCBDaXZpbCBSZWdpc3RyYXRpb24gTWFycmlhZ2UgSW5kZXhcIixcbiAgICBjb3VudHJ5OiBcIkVuZ2xhbmQgYW5kIFdhbGVzXCIsXG4gICAgaXNNYXJyaWFnZTogdHJ1ZSxcbiAgICBzaXRlczoge1xuICAgICAgZnM6IHsgaWQ6IFwiMjI4NTczMlwiLCBkYXRlczogeyBmcm9tOiAxODM3LCB0bzogMjAwOCB9IH0sXG4gICAgICBmbXA6IHtcbiAgICAgICAgaWQ6IFwiRW5nbGFuZCAmIFdhbGVzIE1hcnJpYWdlcyAxODM3LTIwMDVcIixcbiAgICAgICAgZGF0ZXM6IHsgZnJvbTogMTgzNywgdG86IDIwMDUgfSxcbiAgICAgIH0sXG4gICAgICBmcmVlYm1kOiB7IGlkOiBcIm1hcnJpYWdlc1wiLCBkYXRlczogeyBmcm9tOiAxODM3LCB0bzogMTk5MiB9IH0sXG4gICAgfSxcbiAgfSxcbiAge1xuICAgIHd0c0lkOiBcIkVuZ2xhbmRBbmRXYWxlc01hcnJpYWdlUmVnRWFybHlcIixcbiAgICBwYXJ0T2Y6IFtcIkVuZ2xhbmRBbmRXYWxlc01hcnJpYWdlUmVnXCJdLFxuICAgIHRpdGxlOiBcIkVuZ2xhbmQgJiBXYWxlcywgQ2l2aWwgUmVnaXN0cmF0aW9uIE1hcnJpYWdlIEluZGV4IDE4MzctMTkxNVwiLFxuICAgIGNvdW50cnk6IFwiRW5nbGFuZCBhbmQgV2FsZXNcIixcbiAgICBpc0RlYXRoOiB0cnVlLFxuICAgIHNpdGVzOiB7XG4gICAgICBhbmNlc3RyeToge1xuICAgICAgICBpZDogXCI4OTEzXCIsXG4gICAgICAgIGFsdElkOiBcIkZyZWVCTURNYXJyaWFnZVwiLFxuICAgICAgICBkYXRlczogeyBmcm9tOiAxODM3LCB0bzogMTkxNSB9LFxuICAgICAgICBzZWFyY2hRdWVyeUZpZWxkczogeyB2b2x1bWU6IFwiZi1GMDAwNTZFQ1wiLCBwYWdlOiBcImYtRjAwMDU5MDZcIiB9LFxuICAgICAgfSxcbiAgICB9LFxuICB9LFxuICB7XG4gICAgd3RzSWQ6IFwiRW5nbGFuZEFuZFdhbGVzTWFycmlhZ2VSZWdMYXRlXCIsXG4gICAgcGFydE9mOiBbXCJFbmdsYW5kQW5kV2FsZXNNYXJyaWFnZVJlZ1wiXSxcbiAgICB0aXRsZTogXCJFbmdsYW5kICYgV2FsZXMsIENpdmlsIFJlZ2lzdHJhdGlvbiBNYXJyaWFnZSBJbmRleCAxOTE2LTIwMDdcIixcbiAgICBjb3VudHJ5OiBcIkVuZ2xhbmQgYW5kIFdhbGVzXCIsXG4gICAgaXNEZWF0aDogdHJ1ZSxcbiAgICBzaXRlczoge1xuICAgICAgYW5jZXN0cnk6IHtcbiAgICAgICAgaWQ6IFwiODc1M1wiLFxuICAgICAgICBhbHRJZDogXCJPTlNtYXJyaWFnZTE5ODRcIixcbiAgICAgICAgZGF0ZXM6IHsgZnJvbTogMTkxNiwgdG86IDIwMDUgfSxcbiAgICAgIH0sXG4gICAgfSxcbiAgfSxcbiAge1xuICAgIHd0c0lkOiBcIkVuZ2xhbmRBbmRXYWxlc0RlYXRoUmVnXCIsXG4gICAgdGl0bGU6IFwiRW5nbGFuZCAmIFdhbGVzLCBDaXZpbCBSZWdpc3RyYXRpb24gRGVhdGggSW5kZXhcIixcbiAgICBjb3VudHJ5OiBcIkVuZ2xhbmQgYW5kIFdhbGVzXCIsXG4gICAgaXNEZWF0aDogdHJ1ZSxcbiAgICBzaXRlczoge1xuICAgICAgZnM6IHsgaWQ6IFwiMjI4NTM0MVwiLCBkYXRlczogeyBmcm9tOiAxODM3LCB0bzogMjAwOCB9IH0sXG4gICAgICBmbXA6IHtcbiAgICAgICAgaWQ6IFwiRW5nbGFuZCAmIFdhbGVzIERlYXRocyAxODM3LTIwMDdcIixcbiAgICAgICAgZGF0ZXM6IHsgZnJvbTogMTgzNywgdG86IDIwMDcgfSxcbiAgICAgICAgc2VhcmNoUXVlcnlGaWVsZHM6IHsgdm9sdW1lOiBcIlwiLCBwYWdlOiBcIlwiIH0sXG4gICAgICB9LFxuICAgICAgZ3JvOiB7IGlkOiBcImRlYXRoc1wiLCBkYXRlczogeyBmcm9tOiAxODM3LCB0bzogMjAxOSB9IH0sXG4gICAgICBmcmVlYm1kOiB7IGlkOiBcImRlYXRoc1wiLCBkYXRlczogeyBmcm9tOiAxODM3LCB0bzogMTk5MiB9IH0sXG4gICAgfSxcbiAgfSxcbiAge1xuICAgIHd0c0lkOiBcIkVuZ2xhbmRBbmRXYWxlc0RlYXRoUmVnRWFybHlcIixcbiAgICBwYXJ0T2Y6IFtcIkVuZ2xhbmRBbmRXYWxlc0RlYXRoUmVnXCJdLFxuICAgIHRpdGxlOiBcIkVuZ2xhbmQgJiBXYWxlcywgQ2l2aWwgUmVnaXN0cmF0aW9uIERlYXRoIEluZGV4IDE4MzctMTkxNVwiLFxuICAgIGNvdW50cnk6IFwiRW5nbGFuZCBhbmQgV2FsZXNcIixcbiAgICBpc0RlYXRoOiB0cnVlLFxuICAgIHNpdGVzOiB7XG4gICAgICBhbmNlc3RyeToge1xuICAgICAgICBpZDogXCI4OTE0XCIsXG4gICAgICAgIGRhdGVzOiB7IGZyb206IDE4MzcsIHRvOiAxOTE1IH0sXG4gICAgICAgIHNlYXJjaFF1ZXJ5RmllbGRzOiB7IHZvbHVtZTogXCJcIiwgcGFnZTogXCJcIiB9LFxuICAgICAgfSxcbiAgICB9LFxuICB9LFxuICB7XG4gICAgd3RzSWQ6IFwiRW5nbGFuZEFuZFdhbGVzRGVhdGhSZWdMYXRlXCIsXG4gICAgcGFydE9mOiBbXCJFbmdsYW5kQW5kV2FsZXNEZWF0aFJlZ1wiXSxcbiAgICB0aXRsZTogXCJFbmdsYW5kICYgV2FsZXMsIENpdmlsIFJlZ2lzdHJhdGlvbiBEZWF0aCBJbmRleCAxOTE2LTIwMDdcIixcbiAgICBjb3VudHJ5OiBcIkVuZ2xhbmQgYW5kIFdhbGVzXCIsXG4gICAgaXNEZWF0aDogdHJ1ZSxcbiAgICBzaXRlczoge1xuICAgICAgYW5jZXN0cnk6IHsgaWQ6IFwiNzU3OVwiLCBkYXRlczogeyBmcm9tOiAxOTE2LCB0bzogMjAwNyB9IH0sXG4gICAgfSxcbiAgfSxcblxuICAvLyBFbmdsYW5kLCBXYWxlcyAmIFNjb3RsYW5kIENlbnN1c1xuICB7XG4gICAgd3RzSWQ6IFwiRW5nbGFuZFdhbGVzQW5kU2NvdGxhbmRDZW5zdXMxODQxXCIsXG4gICAgdGl0bGU6IFwiMTg0MSBDZW5zdXMgb2YgRW5nbGFuZCwgV2FsZXMgJiBTY290bGFuZFwiLFxuICAgIGNvdW50cnk6IFwiVW5pdGVkIEtpbmdkb21cIixcbiAgICBkYXRlczogeyB5ZWFyOiAxODQxLCBleGFjdERhdGU6IFwiNiBKdW4gMTg0MVwiIH0sXG4gICAgaG91c2Vob2xkVGFibGVDb2x1bW5zOiBob3VzZVRhYmxlQ29sdW1uc1VrMTg0MSxcbiAgICBzaXRlczoge1xuICAgICAgZm1wOiB7XG4gICAgICAgIGlkOiBcIjE4NDEgRW5nbGFuZCwgV2FsZXMgJiBTY290bGFuZCBDZW5zdXNcIixcbiAgICAgICAgdGl0bGU6IFwiMTg0MSBFbmdsYW5kLCBXYWxlcyAmIFNjb3RsYW5kIENlbnN1c1wiLFxuICAgICAgfSxcbiAgICAgIGZyZWVjZW46IHsgaWQ6IFwiMTg0MVwiLCB0aXRsZTogXCIxODQxIEVuZ2xhbmQsIFNjb3RsYW5kIGFuZCBXYWxlcyBjZW5zdXNcIiB9LFxuICAgIH0sXG4gIH0sXG4gIHtcbiAgICB3dHNJZDogXCJFbmdsYW5kV2FsZXNBbmRTY290bGFuZENlbnN1czE4NTFcIixcbiAgICB0aXRsZTogXCIxODUxIENlbnN1cyBvZiBFbmdsYW5kLCBXYWxlcyAmIFNjb3RsYW5kXCIsXG4gICAgY291bnRyeTogXCJVbml0ZWQgS2luZ2RvbVwiLFxuICAgIGRhdGVzOiB7IHllYXI6IDE4NTEsIGV4YWN0RGF0ZTogXCIzMCBNYXIgMTg1MVwiIH0sXG4gICAgaG91c2Vob2xkVGFibGVDb2x1bW5zOiBob3VzZVRhYmxlQ29sdW1uc1VrMTg1MXRvMTkxMSxcbiAgICBzaXRlczoge1xuICAgICAgZm1wOiB7XG4gICAgICAgIGlkOiBcIjE4NTEgRW5nbGFuZCwgV2FsZXMgJiBTY290bGFuZCBDZW5zdXNcIixcbiAgICAgICAgdGl0bGU6IFwiMTg1MSBFbmdsYW5kLCBXYWxlcyAmIFNjb3RsYW5kIENlbnN1c1wiLFxuICAgICAgfSxcbiAgICAgIGZyZWVjZW46IHsgaWQ6IFwiMTg1MVwiLCB0aXRsZTogXCIxODUxIEVuZ2xhbmQsIFNjb3RsYW5kIGFuZCBXYWxlcyBjZW5zdXNcIiB9LFxuICAgIH0sXG4gIH0sXG4gIHtcbiAgICB3dHNJZDogXCJFbmdsYW5kV2FsZXNBbmRTY290bGFuZENlbnN1czE4NjFcIixcbiAgICB0aXRsZTogXCIxODYxIENlbnN1cyBvZiBFbmdsYW5kLCBXYWxlcyAmIFNjb3RsYW5kXCIsXG4gICAgY291bnRyeTogXCJVbml0ZWQgS2luZ2RvbVwiLFxuICAgIGRhdGVzOiB7IHllYXI6IDE4NjEsIGV4YWN0RGF0ZTogXCI3IEFwciAxODYxXCIgfSxcbiAgICBob3VzZWhvbGRUYWJsZUNvbHVtbnM6IGhvdXNlVGFibGVDb2x1bW5zVWsxODUxdG8xOTExLFxuICAgIHNpdGVzOiB7XG4gICAgICBmbXA6IHtcbiAgICAgICAgaWQ6IFwiMTg2MSBFbmdsYW5kLCBXYWxlcyAmIFNjb3RsYW5kIENlbnN1c1wiLFxuICAgICAgICB0aXRsZTogXCIxODYxIEVuZ2xhbmQsIFdhbGVzICYgU2NvdGxhbmQgQ2Vuc3VzXCIsXG4gICAgICB9LFxuICAgICAgZnJlZWNlbjogeyBpZDogXCIxODYxXCIsIHRpdGxlOiBcIjE4NjEgRW5nbGFuZCwgU2NvdGxhbmQgYW5kIFdhbGVzIGNlbnN1c1wiIH0sXG4gICAgfSxcbiAgfSxcbiAge1xuICAgIHd0c0lkOiBcIkVuZ2xhbmRXYWxlc0FuZFNjb3RsYW5kQ2Vuc3VzMTg3MVwiLFxuICAgIHRpdGxlOiBcIjE4NzEgQ2Vuc3VzIG9mIEVuZ2xhbmQsIFdhbGVzICYgU2NvdGxhbmRcIixcbiAgICBjb3VudHJ5OiBcIlVuaXRlZCBLaW5nZG9tXCIsXG4gICAgZGF0ZXM6IHsgeWVhcjogMTg3MSwgZXhhY3REYXRlOiBcIjIgQXByIDE4NzFcIiB9LFxuICAgIGhvdXNlaG9sZFRhYmxlQ29sdW1uczogaG91c2VUYWJsZUNvbHVtbnNVazE4NTF0bzE5MTEsXG4gICAgc2l0ZXM6IHtcbiAgICAgIGZtcDoge1xuICAgICAgICBpZDogXCIxODcxIEVuZ2xhbmQsIFdhbGVzICYgU2NvdGxhbmQgQ2Vuc3VzXCIsXG4gICAgICAgIHRpdGxlOiBcIjE4NzEgRW5nbGFuZCwgV2FsZXMgJiBTY290bGFuZCBDZW5zdXNcIixcbiAgICAgIH0sXG4gICAgICBmcmVlY2VuOiB7IGlkOiBcIjE4NzFcIiwgdGl0bGU6IFwiMTg3MSBFbmdsYW5kLCBTY290bGFuZCBhbmQgV2FsZXMgY2Vuc3VzXCIgfSxcbiAgICB9LFxuICB9LFxuICB7XG4gICAgd3RzSWQ6IFwiRW5nbGFuZFdhbGVzQW5kU2NvdGxhbmRDZW5zdXMxODgxXCIsXG4gICAgdGl0bGU6IFwiMTg4MSBDZW5zdXMgb2YgRW5nbGFuZCwgV2FsZXMgJiBTY290bGFuZFwiLFxuICAgIGNvdW50cnk6IFwiVW5pdGVkIEtpbmdkb21cIixcbiAgICBkYXRlczogeyB5ZWFyOiAxODgxLCBleGFjdERhdGU6IFwiMyBBcHIgMTg4MVwiIH0sXG4gICAgaG91c2Vob2xkVGFibGVDb2x1bW5zOiBob3VzZVRhYmxlQ29sdW1uc1VrMTg1MXRvMTkxMSxcbiAgICBzaXRlczoge1xuICAgICAgZm1wOiB7XG4gICAgICAgIGlkOiBcIjE4ODEgRW5nbGFuZCwgV2FsZXMgJiBTY290bGFuZCBDZW5zdXNcIixcbiAgICAgICAgdGl0bGU6IFwiMTg4MSBFbmdsYW5kLCBXYWxlcyAmIFNjb3RsYW5kIENlbnN1c1wiLFxuICAgICAgfSxcbiAgICAgIGZyZWVjZW46IHsgaWQ6IFwiMTg4MVwiLCB0aXRsZTogXCIxODgxIEVuZ2xhbmQsIFNjb3RsYW5kIGFuZCBXYWxlcyBjZW5zdXNcIiB9LFxuICAgIH0sXG4gIH0sXG4gIHtcbiAgICB3dHNJZDogXCJFbmdsYW5kV2FsZXNBbmRTY290bGFuZENlbnN1czE4OTFcIixcbiAgICB0aXRsZTogXCIxODkxIENlbnN1cyBvZiBFbmdsYW5kLCBXYWxlcyAmIFNjb3RsYW5kXCIsXG4gICAgY291bnRyeTogXCJVbml0ZWQgS2luZ2RvbVwiLFxuICAgIGRhdGVzOiB7IHllYXI6IDE4OTEsIGV4YWN0RGF0ZTogXCI1IEFwciAxODkxXCIgfSxcbiAgICBob3VzZWhvbGRUYWJsZUNvbHVtbnM6IGhvdXNlVGFibGVDb2x1bW5zVWsxODUxdG8xOTExLFxuICAgIHNpdGVzOiB7XG4gICAgICBmbXA6IHtcbiAgICAgICAgaWQ6IFwiMTg5MSBFbmdsYW5kLCBXYWxlcyAmIFNjb3RsYW5kIENlbnN1c1wiLFxuICAgICAgICB0aXRsZTogXCIxODkxIEVuZ2xhbmQsIFdhbGVzICYgU2NvdGxhbmQgQ2Vuc3VzXCIsXG4gICAgICB9LFxuICAgICAgZnJlZWNlbjogeyBpZDogXCIxODkxXCIsIHRpdGxlOiBcIjE4OTEgRW5nbGFuZCwgU2NvdGxhbmQgYW5kIFdhbGVzIGNlbnN1c1wiIH0sXG4gICAgfSxcbiAgfSxcbiAge1xuICAgIHd0c0lkOiBcIkVuZ2xhbmRXYWxlc0FuZFNjb3RsYW5kQ2Vuc3VzMTkwMVwiLFxuICAgIHRpdGxlOiBcIjE5MDEgQ2Vuc3VzIG9mIEVuZ2xhbmQsIFdhbGVzICYgU2NvdGxhbmRcIixcbiAgICBjb3VudHJ5OiBcIlVuaXRlZCBLaW5nZG9tXCIsXG4gICAgZGF0ZXM6IHsgeWVhcjogMTkwMSwgZXhhY3REYXRlOiBcIjMxIE1hciAxOTAxXCIgfSxcbiAgICBob3VzZWhvbGRUYWJsZUNvbHVtbnM6IGhvdXNlVGFibGVDb2x1bW5zVWsxODUxdG8xOTExLFxuICAgIHNpdGVzOiB7XG4gICAgICBmbXA6IHtcbiAgICAgICAgaWQ6IFwiMTkwMSBFbmdsYW5kLCBXYWxlcyAmIFNjb3RsYW5kIENlbnN1c1wiLFxuICAgICAgICB0aXRsZTogXCIxOTAxIEVuZ2xhbmQsIFdhbGVzICYgU2NvdGxhbmQgQ2Vuc3VzXCIsXG4gICAgICB9LFxuICAgICAgZnJlZWNlbjogeyBpZDogXCIxOTAxXCIsIHRpdGxlOiBcIjE5MDEgRW5nbGFuZCwgU2NvdGxhbmQgYW5kIFdhbGVzIGNlbnN1c1wiIH0sXG4gICAgfSxcbiAgfSxcbiAge1xuICAgIHd0c0lkOiBcIkVuZ2xhbmRXYWxlc0FuZFNjb3RsYW5kQ2Vuc3VzMTkxMVwiLFxuICAgIHRpdGxlOiBcIjE5MTEgQ2Vuc3VzIG9mIEVuZ2xhbmQsIFdhbGVzICYgU2NvdGxhbmRcIixcbiAgICBjb3VudHJ5OiBcIlVuaXRlZCBLaW5nZG9tXCIsXG4gICAgZGF0ZXM6IHsgeWVhcjogMTkxMSwgZXhhY3REYXRlOiBcIjIgQXByIDE5MTFcIiB9LFxuICAgIGhvdXNlaG9sZFRhYmxlQ29sdW1uczogaG91c2VUYWJsZUNvbHVtbnNVazE4NTF0bzE5MTEsXG4gIH0sXG4gIC8vIEVuZ2xhbmQgJiBXYWxlcyBDZW5zdXNcbiAge1xuICAgIHd0c0lkOiBcIkVuZ2xhbmRBbmRXYWxlc0NlbnN1czE4NDFcIixcbiAgICBwYXJ0T2Y6IFtcIkVuZ2xhbmRXYWxlc0FuZFNjb3RsYW5kQ2Vuc3VzMTg0MVwiXSxcbiAgICB0aXRsZTogXCIxODQxIENlbnN1cyBvZiBFbmdsYW5kIGFuZCBXYWxlc1wiLFxuICAgIGNvdW50cnk6IFwiRW5nbGFuZCBhbmQgV2FsZXNcIixcbiAgICBkYXRlczogeyB5ZWFyOiAxODQxLCBleGFjdERhdGU6IFwiNiBKdW4gMTg0MVwiIH0sXG4gICAgc2l0ZXM6IHtcbiAgICAgIGZzOiB7IGlkOiBcIjE0OTM3NDVcIiwgdGl0bGU6IFwiRW5nbGFuZCBhbmQgV2FsZXMgQ2Vuc3VzLCAxODQxXCIgfSxcbiAgICB9LFxuICB9LFxuICB7XG4gICAgd3RzSWQ6IFwiRW5nbGFuZEFuZFdhbGVzQ2Vuc3VzMTg1MVwiLFxuICAgIHBhcnRPZjogW1wiRW5nbGFuZFdhbGVzQW5kU2NvdGxhbmRDZW5zdXMxODUxXCJdLFxuICAgIHRpdGxlOiBcIjE4NTEgQ2Vuc3VzIG9mIEVuZ2xhbmQgYW5kIFdhbGVzXCIsXG4gICAgY291bnRyeTogXCJFbmdsYW5kIGFuZCBXYWxlc1wiLFxuICAgIGRhdGVzOiB7IHllYXI6IDE4NTEsIGV4YWN0RGF0ZTogXCIzMCBNYXIgMTg1MVwiIH0sXG4gICAgc2l0ZXM6IHtcbiAgICAgIGZzOiB7IGlkOiBcIjI1NjM5MzlcIiwgdGl0bGU6IFwiRW5nbGFuZCBhbmQgV2FsZXMgQ2Vuc3VzLCAxODUxXCIgfSxcbiAgICB9LFxuICB9LFxuICB7XG4gICAgd3RzSWQ6IFwiRW5nbGFuZEFuZFdhbGVzQ2Vuc3VzMTg2MVwiLFxuICAgIHBhcnRPZjogW1wiRW5nbGFuZFdhbGVzQW5kU2NvdGxhbmRDZW5zdXMxODYxXCJdLFxuICAgIHRpdGxlOiBcIjE4NjEgQ2Vuc3VzIG9mIEVuZ2xhbmQgYW5kIFdhbGVzXCIsXG4gICAgY291bnRyeTogXCJFbmdsYW5kIGFuZCBXYWxlc1wiLFxuICAgIGRhdGVzOiB7IHllYXI6IDE4NjEsIGV4YWN0RGF0ZTogXCI3IEFwciAxODYxXCIgfSxcbiAgICBzaXRlczoge1xuICAgICAgZnM6IHsgaWQ6IFwiMTQ5Mzc0N1wiLCB0aXRsZTogXCJFbmdsYW5kIGFuZCBXYWxlcyBDZW5zdXMsIDE4NjFcIiB9LFxuICAgIH0sXG4gIH0sXG4gIHtcbiAgICB3dHNJZDogXCJFbmdsYW5kQW5kV2FsZXNDZW5zdXMxODcxXCIsXG4gICAgcGFydE9mOiBbXCJFbmdsYW5kV2FsZXNBbmRTY290bGFuZENlbnN1czE4NzFcIl0sXG4gICAgdGl0bGU6IFwiMTg3MSBDZW5zdXMgb2YgRW5nbGFuZCBhbmQgV2FsZXNcIixcbiAgICBjb3VudHJ5OiBcIkVuZ2xhbmQgYW5kIFdhbGVzXCIsXG4gICAgZGF0ZXM6IHsgeWVhcjogMTg3MSwgZXhhY3REYXRlOiBcIjIgQXByIDE4NzFcIiB9LFxuICAgIHNpdGVzOiB7XG4gICAgICBmczogeyBpZDogXCIxNTM4MzU0XCIsIHRpdGxlOiBcIkVuZ2xhbmQgYW5kIFdhbGVzIENlbnN1cywgMTg3MVwiIH0sXG4gICAgfSxcbiAgfSxcbiAge1xuICAgIHd0c0lkOiBcIkVuZ2xhbmRBbmRXYWxlc0NlbnN1czE4ODFcIixcbiAgICBwYXJ0T2Y6IFtcIkVuZ2xhbmRXYWxlc0FuZFNjb3RsYW5kQ2Vuc3VzMTg4MVwiXSxcbiAgICB0aXRsZTogXCIxODgxIENlbnN1cyBvZiBFbmdsYW5kIGFuZCBXYWxlc1wiLFxuICAgIGNvdW50cnk6IFwiRW5nbGFuZCBhbmQgV2FsZXNcIixcbiAgICBkYXRlczogeyB5ZWFyOiAxODgxLCBleGFjdERhdGU6IFwiMyBBcHIgMTg4MVwiIH0sXG4gICAgc2l0ZXM6IHtcbiAgICAgIGZzOiB7IGlkOiBcIjI1NjIxOTRcIiwgdGl0bGU6IFwiRW5nbGFuZCBhbmQgV2FsZXMgQ2Vuc3VzLCAxODgxXCIgfSxcbiAgICB9LFxuICB9LFxuICB7XG4gICAgd3RzSWQ6IFwiRW5nbGFuZEFuZFdhbGVzQ2Vuc3VzMTg5MVwiLFxuICAgIHBhcnRPZjogW1wiRW5nbGFuZFdhbGVzQW5kU2NvdGxhbmRDZW5zdXMxODkxXCJdLFxuICAgIHRpdGxlOiBcIjE4OTEgQ2Vuc3VzIG9mIEVuZ2xhbmQgYW5kIFdhbGVzXCIsXG4gICAgY291bnRyeTogXCJFbmdsYW5kIGFuZCBXYWxlc1wiLFxuICAgIGRhdGVzOiB7IHllYXI6IDE4OTEsIGV4YWN0RGF0ZTogXCI1IEFwciAxODkxXCIgfSxcbiAgICBzaXRlczoge1xuICAgICAgZnM6IHsgaWQ6IFwiMTg2NTc0N1wiLCB0aXRsZTogXCJFbmdsYW5kIGFuZCBXYWxlcyBDZW5zdXMsIDE4OTFcIiB9LFxuICAgIH0sXG4gIH0sXG4gIHtcbiAgICB3dHNJZDogXCJFbmdsYW5kQW5kV2FsZXNDZW5zdXMxOTAxXCIsXG4gICAgcGFydE9mOiBbXCJFbmdsYW5kV2FsZXNBbmRTY290bGFuZENlbnN1czE5MDFcIl0sXG4gICAgdGl0bGU6IFwiMTkwMSBDZW5zdXMgb2YgRW5nbGFuZCBhbmQgV2FsZXNcIixcbiAgICBjb3VudHJ5OiBcIkVuZ2xhbmQgYW5kIFdhbGVzXCIsXG4gICAgZGF0ZXM6IHsgeWVhcjogMTkwMSwgZXhhY3REYXRlOiBcIjMxIE1hciAxOTAxXCIgfSxcbiAgICBzaXRlczoge1xuICAgICAgZnM6IHsgaWQ6IFwiMTg4ODEyOVwiLCB0aXRsZTogXCJFbmdsYW5kIGFuZCBXYWxlcyBDZW5zdXMsIDE5MDFcIiB9LFxuICAgIH0sXG4gIH0sXG4gIHtcbiAgICB3dHNJZDogXCJFbmdsYW5kQW5kV2FsZXNDZW5zdXMxOTExXCIsXG4gICAgcGFydE9mOiBbXCJFbmdsYW5kV2FsZXNBbmRTY290bGFuZENlbnN1czE5MTFcIl0sXG4gICAgdGl0bGU6IFwiMTkxMSBDZW5zdXMgb2YgRW5nbGFuZCBhbmQgV2FsZXNcIixcbiAgICBjb3VudHJ5OiBcIkVuZ2xhbmQgYW5kIFdhbGVzXCIsXG4gICAgZGF0ZXM6IHsgeWVhcjogMTkxMSwgZXhhY3REYXRlOiBcIjIgQXByIDE5MTFcIiB9LFxuICAgIGhvdXNlaG9sZFRhYmxlQ29sdW1uczogaG91c2VUYWJsZUNvbHVtbnNVazE4NTF0bzE5MTEsXG4gICAgc2l0ZXM6IHtcbiAgICAgIGZzOiB7IGlkOiBcIjE5MjE1NDdcIiwgdGl0bGU6IFwiRW5nbGFuZCBhbmQgV2FsZXMgQ2Vuc3VzLCAxOTExXCIgfSxcbiAgICAgIGZtcDoge1xuICAgICAgICBpZDogXCIxOTExIENlbnN1cyBGb3IgRW5nbGFuZCAmIFdhbGVzXCIsXG4gICAgICAgIHRpdGxlOiBcIjE5MTEgQ2Vuc3VzIEZvciBFbmdsYW5kICYgV2FsZXNcIixcbiAgICAgICAgc2VhcmNoUXVlcnlGaWVsZHM6IHsgbWFyaXRhbFN0YXR1czogXCJjb25kaXRpb25cIiB9LFxuICAgICAgfSxcbiAgICAgIGZyZWVjZW46IHsgaWQ6IFwiMTkxMVwiLCB0aXRsZTogXCIxOTExIEVuZ2xhbmQgYW5kIFdhbGVzIGNlbnN1c1wiIH0sXG4gICAgfSxcbiAgfSxcbiAge1xuICAgIHd0c0lkOiBcIkVuZ2xhbmRBbmRXYWxlc0NlbnN1czE5MjFcIixcbiAgICB0aXRsZTogXCIxOTIxIENlbnN1cyBvZiBFbmdsYW5kIGFuZCBXYWxlc1wiLFxuICAgIGNvdW50cnk6IFwiRW5nbGFuZCBhbmQgV2FsZXNcIixcbiAgICBkYXRlczogeyB5ZWFyOiAxOTIxIH0sXG4gICAgaG91c2Vob2xkVGFibGVDb2x1bW5zOiBbXG4gICAgICBcIm5hbWVcIixcbiAgICAgIFwicmVsYXRpb25zaGlwXCIsXG4gICAgICBcImdlbmRlclwiLFxuICAgICAgXCJtYXJpdGFsU3RhdHVzXCIsXG4gICAgICBcImFnZVwiLFxuICAgICAgXCJiaXJ0aFllYXJcIixcbiAgICAgIFwiYmlydGhQbGFjZVwiLFxuICAgICAgXCJvY2N1cGF0aW9uXCIsXG4gICAgICBcImVtcGxveWVyXCIsXG4gICAgXSxcbiAgICBzaXRlczoge1xuICAgICAgZm1wOiB7XG4gICAgICAgIGlkOiBcIjE5MjEgQ2Vuc3VzIE9mIEVuZ2xhbmQgJiBXYWxlc1wiLFxuICAgICAgICB0aXRsZTogXCIxOTIxIENlbnN1cyBPZiBFbmdsYW5kICYgV2FsZXNcIixcbiAgICAgICAgc2VhcmNoUXVlcnlGaWVsZHM6IHtcbiAgICAgICAgICBtYXJpdGFsU3RhdHVzOiBcIm1hcml0YWxzdGF0dXNcIixcbiAgICAgICAgICBvY2N1cGF0aW9uOiBcIm9jY3VwYXRpb250ZXh0XCIsXG4gICAgICAgICAgYmlydGhQbGFjZTogXCJ3aGVyZWJvcm50ZXh0XCIsXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0sXG4gIH0sXG4gIC8vIEVuZ2xhbmQgQ2Vuc3VzXG4gIHtcbiAgICB3dHNJZDogXCJFbmdsYW5kQ2Vuc3VzMTg0MVwiLFxuICAgIHBhcnRPZjogW1wiRW5nbGFuZEFuZFdhbGVzQ2Vuc3VzMTg0MVwiXSxcbiAgICB0aXRsZTogXCIxODQxIENlbnN1cyBvZiBFbmdsYW5kXCIsXG4gICAgY291bnRyeTogXCJFbmdsYW5kXCIsXG4gICAgZGF0ZXM6IHsgeWVhcjogMTg0MSwgZXhhY3REYXRlOiBcIjYgSnVuIDE4NDFcIiB9LFxuICAgIHNpdGVzOiB7XG4gICAgICBhbmNlc3RyeToge1xuICAgICAgICBpZDogXCI4OTc4XCIsXG4gICAgICAgIGFsdElkOiBcInVraTE4NDFcIixcbiAgICAgICAgdGl0bGU6IFwiMTg0MSBFbmdsYW5kIENlbnN1c1wiLFxuICAgICAgICBzZWFyY2hRdWVyeUZpZWxkczoge1xuICAgICAgICAgIHBpZWNlOiBcImYtRjAwMDMwMzlcIixcbiAgICAgICAgICBmb2xpbzogXCJmLUYwMDAzMDNBXCIsXG4gICAgICAgICAgcGFnZTogXCJmLUYwMDAzMkRCXCIsXG4gICAgICAgICAgYm9vazogXCJmLUYwMDAyOTk2XCIsXG4gICAgICAgICAgZGlzdHJpY3Q6IFwiZi1GMDAwMzAzRFwiLFxuICAgICAgICAgIHN1YkRpc3RyaWN0OiBcImYtRjAwMDMwM0VcIixcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSxcbiAgfSxcbiAge1xuICAgIHd0c0lkOiBcIkVuZ2xhbmRDZW5zdXMxODUxXCIsXG4gICAgcGFydE9mOiBbXCJFbmdsYW5kQW5kV2FsZXNDZW5zdXMxODUxXCJdLFxuICAgIHRpdGxlOiBcIjE4NTEgQ2Vuc3VzIG9mIEVuZ2xhbmRcIixcbiAgICBjb3VudHJ5OiBcIkVuZ2xhbmRcIixcbiAgICBkYXRlczogeyB5ZWFyOiAxODUxLCBleGFjdERhdGU6IFwiMzAgTWFyIDE4NTFcIiB9LFxuICAgIHNpdGVzOiB7XG4gICAgICBhbmNlc3RyeToge1xuICAgICAgICBpZDogXCI4ODYwXCIsXG4gICAgICAgIGFsdElkOiBcInVraTE4NTFcIixcbiAgICAgICAgdGl0bGU6IFwiMTg1MSBFbmdsYW5kIENlbnN1c1wiLFxuICAgICAgICBzZWFyY2hRdWVyeUZpZWxkczoge1xuICAgICAgICAgIHBpZWNlOiBcImYtRjAwMDVDNEZcIixcbiAgICAgICAgICBmb2xpbzogXCJmLUYwMDA1RTExXCIsXG4gICAgICAgICAgcGFnZTogXCJmLUYwMDA1OTA2XCIsXG4gICAgICAgICAgc2NoZWR1bGU6IFwiZi1GMDAwNjg2N1wiLFxuICAgICAgICAgIGRpc3RyaWN0OiBcImYtRjAwMDVERkRcIixcbiAgICAgICAgICBzdWJEaXN0cmljdDogXCJmLUYwMDA2MzAxXCIsXG4gICAgICAgICAgZWNjUGFyOiBcImYtRjAwMDVERkJcIixcbiAgICAgICAgICBlbnVtRGlzdHJpY3Q6IFwiZi1GMDAwNURGQ1wiLFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9LFxuICB9LFxuICB7XG4gICAgd3RzSWQ6IFwiRW5nbGFuZENlbnN1czE4NjFcIixcbiAgICBwYXJ0T2Y6IFtcIkVuZ2xhbmRBbmRXYWxlc0NlbnN1czE4NjFcIl0sXG4gICAgdGl0bGU6IFwiMTg2MSBDZW5zdXMgb2YgRW5nbGFuZFwiLFxuICAgIGNvdW50cnk6IFwiRW5nbGFuZFwiLFxuICAgIGRhdGVzOiB7IHllYXI6IDE4NjEsIGV4YWN0RGF0ZTogXCI3IEFwciAxODYxXCIgfSxcbiAgICBzaXRlczoge1xuICAgICAgYW5jZXN0cnk6IHtcbiAgICAgICAgaWQ6IFwiODc2N1wiLFxuICAgICAgICBhbHRJZDogXCJ1a2kxODYxXCIsXG4gICAgICAgIHRpdGxlOiBcIjE4NjEgRW5nbGFuZCBDZW5zdXNcIixcbiAgICAgICAgc2VhcmNoUXVlcnlGaWVsZHM6IHtcbiAgICAgICAgICBwaWVjZTogXCJmLUYwMDA3Qjg3XCIsXG4gICAgICAgICAgZm9saW86IFwiZi1GMDAwN0I4OFwiLFxuICAgICAgICAgIHBhZ2U6IFwiZi1GMDAwNTk3Q1wiLFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9LFxuICB9LFxuICB7XG4gICAgd3RzSWQ6IFwiRW5nbGFuZENlbnN1czE4NzFcIixcbiAgICBwYXJ0T2Y6IFtcIkVuZ2xhbmRBbmRXYWxlc0NlbnN1czE4NzFcIl0sXG4gICAgdGl0bGU6IFwiMTg3MSBDZW5zdXMgb2YgRW5nbGFuZFwiLFxuICAgIGNvdW50cnk6IFwiRW5nbGFuZFwiLFxuICAgIGRhdGVzOiB7IHllYXI6IDE4NzEsIGV4YWN0RGF0ZTogXCIyIEFwciAxODcxXCIgfSxcbiAgICBzaXRlczoge1xuICAgICAgLy8gdGVzdGVkIGFuZCBkZWZhdWx0IHBpZWNlLCBmb2xpbyBhbmQgcGFnZSB3b3JrXG4gICAgICBhbmNlc3RyeTogeyBpZDogXCI3NjE5XCIsIGFsdElkOiBcInVraTE4NzFcIiwgdGl0bGU6IFwiMTg3MSBFbmdsYW5kIENlbnN1c1wiIH0sXG4gICAgfSxcbiAgfSxcbiAge1xuICAgIHd0c0lkOiBcIkVuZ2xhbmRDZW5zdXMxODgxXCIsXG4gICAgcGFydE9mOiBbXCJFbmdsYW5kQW5kV2FsZXNDZW5zdXMxODgxXCJdLFxuICAgIHRpdGxlOiBcIjE4ODEgQ2Vuc3VzIG9mIEVuZ2xhbmRcIixcbiAgICBjb3VudHJ5OiBcIkVuZ2xhbmRcIixcbiAgICBkYXRlczogeyB5ZWFyOiAxODgxLCBleGFjdERhdGU6IFwiMyBBcHIgMTg4MVwiIH0sXG4gICAgc2l0ZXM6IHtcbiAgICAgIGFuY2VzdHJ5OiB7XG4gICAgICAgIGlkOiBcIjc1NzJcIixcbiAgICAgICAgYWx0SWQ6IFwidWtpMTg4MVwiLFxuICAgICAgICB0aXRsZTogXCIxODgxIEVuZ2xhbmQgQ2Vuc3VzXCIsXG4gICAgICAgIHNlYXJjaFF1ZXJ5RmllbGRzOiB7XG4gICAgICAgICAgcGllY2U6IFwiZi1GODAwNjg2RFwiLFxuICAgICAgICAgIGZvbGlvOiBcImYtRjAwMDVFMTFcIixcbiAgICAgICAgICBwYWdlOiBcImYtRjAwMDU5MDZcIixcbiAgICAgICAgICBkaXN0cmljdDogXCJmLUYwMDA5MjVEXCIsXG4gICAgICAgICAgc3ViRGlzdHJpY3Q6IFwiZi1GMDAwNzlBN1wiLFxuICAgICAgICAgIGVudW1EaXN0cmljdDogXCJmLUYwMDA1REZDXCIsXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0sXG4gIH0sXG4gIHtcbiAgICB3dHNJZDogXCJFbmdsYW5kQ2Vuc3VzMTg5MVwiLFxuICAgIHBhcnRPZjogW1wiRW5nbGFuZEFuZFdhbGVzQ2Vuc3VzMTg5MVwiXSxcbiAgICB0aXRsZTogXCIxODkxIENlbnN1cyBvZiBFbmdsYW5kXCIsXG4gICAgY291bnRyeTogXCJFbmdsYW5kXCIsXG4gICAgZGF0ZXM6IHsgeWVhcjogMTg5MSwgZXhhY3REYXRlOiBcIjUgQXByIDE4OTFcIiB9LFxuICAgIHNpdGVzOiB7XG4gICAgICBhbmNlc3RyeTogeyBpZDogXCI2NTk4XCIsIGFsdElkOiBcInVraTE4OTFcIiwgdGl0bGU6IFwiMTg5MSBFbmdsYW5kIENlbnN1c1wiIH0sXG4gICAgfSxcbiAgfSxcbiAge1xuICAgIHd0c0lkOiBcIkVuZ2xhbmRDZW5zdXMxOTAxXCIsXG4gICAgcGFydE9mOiBbXCJFbmdsYW5kQW5kV2FsZXNDZW5zdXMxOTAxXCJdLFxuICAgIHRpdGxlOiBcIjE5MDEgQ2Vuc3VzIG9mIEVuZ2xhbmRcIixcbiAgICBjb3VudHJ5OiBcIkVuZ2xhbmRcIixcbiAgICBkYXRlczogeyB5ZWFyOiAxOTAxLCBleGFjdERhdGU6IFwiMzEgTWFyIDE5MDFcIiB9LFxuICAgIHNpdGVzOiB7XG4gICAgICBhbmNlc3RyeToge1xuICAgICAgICBpZDogXCI3ODE0XCIsXG4gICAgICAgIGFsdElkOiBcInVraTE5MDFcIixcbiAgICAgICAgdGl0bGU6IFwiMTkwMSBFbmdsYW5kIENlbnN1c1wiLFxuICAgICAgICBzZWFyY2hRdWVyeUZpZWxkczoge1xuICAgICAgICAgIHBpZWNlOiBcImYtRjAwMDVDNEZcIixcbiAgICAgICAgICBmb2xpbzogXCJmLUYwMDA1RTExXCIsXG4gICAgICAgICAgcGFnZTogXCJmLUYwMDA1OTA2XCIsXG4gICAgICAgICAgc2NoZWR1bGU6IFwiZi1GMDAwNjg2N1wiLFxuICAgICAgICAgIGRpc3RyaWN0OiBcImYtRjAwMDdBRDZcIixcbiAgICAgICAgICBzdWJEaXN0cmljdDogXCJmLUYwMDA3OUE3XCIsXG4gICAgICAgICAgZW51bURpc3RyaWN0OiBcImYtRjAwMDVERkNcIixcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSxcbiAgfSxcbiAge1xuICAgIHd0c0lkOiBcIkVuZ2xhbmRDZW5zdXMxOTExXCIsXG4gICAgcGFydE9mOiBbXCJFbmdsYW5kQW5kV2FsZXNDZW5zdXMxOTExXCJdLFxuICAgIHRpdGxlOiBcIjE5MTEgQ2Vuc3VzIG9mIEVuZ2xhbmRcIixcbiAgICBjb3VudHJ5OiBcIkVuZ2xhbmRcIixcbiAgICBkYXRlczogeyB5ZWFyOiAxOTExLCBleGFjdERhdGU6IFwiMiBBcHIgMTkxMVwiIH0sXG4gICAgc2l0ZXM6IHtcbiAgICAgIGFuY2VzdHJ5OiB7XG4gICAgICAgIGlkOiBcIjIzNTJcIixcbiAgICAgICAgYWx0SWQ6IFwiMTkxMUVuZ2xhbmRcIixcbiAgICAgICAgdGl0bGU6IFwiMTkxMSBFbmdsYW5kIENlbnN1c1wiLFxuICAgICAgfSxcbiAgICB9LFxuICB9LFxuICAvLyBXYWxlcyBDZW5zdXNcbiAge1xuICAgIHd0c0lkOiBcIldhbGVzQ2Vuc3VzMTg0MVwiLFxuICAgIHBhcnRPZjogW1wiRW5nbGFuZEFuZFdhbGVzQ2Vuc3VzMTg0MVwiXSxcbiAgICB0aXRsZTogXCIxODQxIENlbnN1cyBvZiBXYWxlc1wiLFxuICAgIGNvdW50cnk6IFwiV2FsZXNcIixcbiAgICBkYXRlczogeyB5ZWFyOiAxODQxLCBleGFjdERhdGU6IFwiNiBKdW4gMTg0MVwiIH0sXG4gICAgc2l0ZXM6IHtcbiAgICAgIGFuY2VzdHJ5OiB7IGlkOiBcIjg5NzlcIiwgYWx0SWQ6IFwidWtpMTg0MXdhbGVzXCIgfSxcbiAgICB9LFxuICB9LFxuICB7XG4gICAgd3RzSWQ6IFwiV2FsZXNDZW5zdXMxODUxXCIsXG4gICAgcGFydE9mOiBbXCJFbmdsYW5kQW5kV2FsZXNDZW5zdXMxODUxXCJdLFxuICAgIHRpdGxlOiBcIjE4NTEgQ2Vuc3VzIG9mIFdhbGVzXCIsXG4gICAgY291bnRyeTogXCJXYWxlc1wiLFxuICAgIGRhdGVzOiB7IHllYXI6IDE4NTEsIGV4YWN0RGF0ZTogXCIzMCBNYXIgMTg1MVwiIH0sXG4gICAgc2l0ZXM6IHtcbiAgICAgIGFuY2VzdHJ5OiB7IGlkOiBcIjg4NjFcIiwgYWx0SWQ6IFwidWtpMTg1MXdhbGVzXCIgfSxcbiAgICB9LFxuICB9LFxuICB7XG4gICAgd3RzSWQ6IFwiV2FsZXNDZW5zdXMxODYxXCIsXG4gICAgcGFydE9mOiBbXCJFbmdsYW5kQW5kV2FsZXNDZW5zdXMxODYxXCJdLFxuICAgIHRpdGxlOiBcIjE4NjEgQ2Vuc3VzIG9mIFdhbGVzXCIsXG4gICAgY291bnRyeTogXCJXYWxlc1wiLFxuICAgIGRhdGVzOiB7IHllYXI6IDE4NjEsIGV4YWN0RGF0ZTogXCI3IEFwciAxODYxXCIgfSxcbiAgICBzaXRlczoge1xuICAgICAgYW5jZXN0cnk6IHsgaWQ6IFwiODc2OFwiLCBhbHRJZDogXCJ1a2kxODYxd2FsZXNcIiB9LFxuICAgIH0sXG4gIH0sXG4gIHtcbiAgICB3dHNJZDogXCJXYWxlc0NlbnN1czE4NzFcIixcbiAgICBwYXJ0T2Y6IFtcIkVuZ2xhbmRBbmRXYWxlc0NlbnN1czE4NzFcIl0sXG4gICAgdGl0bGU6IFwiMTg3MSBDZW5zdXMgb2YgV2FsZXNcIixcbiAgICBjb3VudHJ5OiBcIldhbGVzXCIsXG4gICAgZGF0ZXM6IHsgeWVhcjogMTg3MSwgZXhhY3REYXRlOiBcIjIgQXByIDE4NzFcIiB9LFxuICAgIHNpdGVzOiB7XG4gICAgICBhbmNlc3RyeTogeyBpZDogXCI3NjE4XCIsIGFsdElkOiBcInVraTE4NzF3YWxlc1wiIH0sXG4gICAgfSxcbiAgfSxcbiAge1xuICAgIHd0c0lkOiBcIldhbGVzQ2Vuc3VzMTg4MVwiLFxuICAgIHBhcnRPZjogW1wiRW5nbGFuZEFuZFdhbGVzQ2Vuc3VzMTg4MVwiXSxcbiAgICB0aXRsZTogXCIxODgxIENlbnN1cyBvZiBXYWxlc1wiLFxuICAgIGNvdW50cnk6IFwiV2FsZXNcIixcbiAgICBkYXRlczogeyB5ZWFyOiAxODgxLCBleGFjdERhdGU6IFwiMyBBcHIgMTg4MVwiIH0sXG4gICAgc2l0ZXM6IHtcbiAgICAgIGFuY2VzdHJ5OiB7IGlkOiBcIjgwNTlcIiwgYWx0SWQ6IFwidWtpMTg4MXdhbGVzXCIgfSxcbiAgICB9LFxuICB9LFxuICB7XG4gICAgd3RzSWQ6IFwiV2FsZXNDZW5zdXMxODkxXCIsXG4gICAgcGFydE9mOiBbXCJFbmdsYW5kQW5kV2FsZXNDZW5zdXMxODkxXCJdLFxuICAgIHRpdGxlOiBcIjE4OTEgQ2Vuc3VzIG9mIFdhbGVzXCIsXG4gICAgY291bnRyeTogXCJXYWxlc1wiLFxuICAgIGRhdGVzOiB7IHllYXI6IDE4OTEsIGV4YWN0RGF0ZTogXCI1IEFwciAxODkxXCIgfSxcbiAgICBzaXRlczoge1xuICAgICAgYW5jZXN0cnk6IHsgaWQ6IFwiNjg5N1wiLCBhbHRJZDogXCJ1a2kxODkxd2FsZXNcIiB9LFxuICAgIH0sXG4gIH0sXG4gIHtcbiAgICB3dHNJZDogXCJXYWxlc0NlbnN1czE5MDFcIixcbiAgICBwYXJ0T2Y6IFtcIkVuZ2xhbmRBbmRXYWxlc0NlbnN1czE5MDFcIl0sXG4gICAgdGl0bGU6IFwiMTkwMSBDZW5zdXMgb2YgV2FsZXNcIixcbiAgICBjb3VudHJ5OiBcIldhbGVzXCIsXG4gICAgZGF0ZXM6IHsgeWVhcjogMTkwMSwgZXhhY3REYXRlOiBcIjMxIE1hciAxOTAxXCIgfSxcbiAgICBzaXRlczoge1xuICAgICAgYW5jZXN0cnk6IHsgaWQ6IFwiNzgxNVwiLCBhbHRJZDogXCJ1a2kxOTAxd2FsZXNcIiB9LFxuICAgIH0sXG4gIH0sXG4gIHtcbiAgICB3dHNJZDogXCJXYWxlc0NlbnN1czE5MTFcIixcbiAgICBwYXJ0T2Y6IFtcIkVuZ2xhbmRBbmRXYWxlc0NlbnN1czE5MTFcIl0sXG4gICAgdGl0bGU6IFwiMTkxMSBDZW5zdXMgb2YgV2FsZXNcIixcbiAgICBjb3VudHJ5OiBcIldhbGVzXCIsXG4gICAgZGF0ZXM6IHsgeWVhcjogMTkxMSwgZXhhY3REYXRlOiBcIjIgQXByIDE5MTFcIiB9LFxuICAgIHNpdGVzOiB7XG4gICAgICBhbmNlc3RyeTogeyBpZDogXCIyMzUzXCIsIGFsdElkOiBcIjE5MTFXYWxlc1wiIH0sXG4gICAgfSxcbiAgfSxcbiAgLy8gU2NvdGxhbmQgQ2Vuc3VzXG4gIHtcbiAgICB3dHNJZDogXCJTY290bGFuZENlbnN1czE4NDFcIixcbiAgICBwYXJ0T2Y6IFtcIkVuZ2xhbmRXYWxlc0FuZFNjb3RsYW5kQ2Vuc3VzMTg0MVwiXSxcbiAgICB0aXRsZTogXCIxODQxIENlbnN1cyBvZiBTY290bGFuZFwiLFxuICAgIGNvdW50cnk6IFwiU2NvdGxhbmRcIixcbiAgICBkYXRlczogeyB5ZWFyOiAxODQxLCBleGFjdERhdGU6IFwiNiBKdW4gMTg0MVwiIH0sXG4gICAgc2l0ZXM6IHtcbiAgICAgIGFuY2VzdHJ5OiB7XG4gICAgICAgIGlkOiBcIjEwMDRcIixcbiAgICAgICAgc2VhcmNoUXVlcnlGaWVsZHM6IHsgZGlzdHJpY3Q6IFwiXCIsIHJlZ2lzdHJhdGlvbk51bWJlcjogXCJmLUYwMDAzOTY4XCIgfSwgLy8gbm8gUGFnZSBvciBFRCBzdXBwb3J0ZWRcbiAgICAgIH0sXG4gICAgICBzY290cDogeyBpZDogXCJjZW5zdXMxODQxXCIgfSxcbiAgICB9LFxuICB9LFxuICB7XG4gICAgd3RzSWQ6IFwiU2NvdGxhbmRDZW5zdXMxODUxXCIsXG4gICAgcGFydE9mOiBbXCJFbmdsYW5kV2FsZXNBbmRTY290bGFuZENlbnN1czE4NTFcIl0sXG4gICAgdGl0bGU6IFwiMTg1MSBDZW5zdXMgb2YgU2NvdGxhbmRcIixcbiAgICBjb3VudHJ5OiBcIlNjb3RsYW5kXCIsXG4gICAgZGF0ZXM6IHsgeWVhcjogMTg1MSwgZXhhY3REYXRlOiBcIjMwIE1hciAxODUxXCIgfSxcbiAgICBzaXRlczoge1xuICAgICAgYW5jZXN0cnk6IHtcbiAgICAgICAgaWQ6IFwiMTA3NlwiLFxuICAgICAgICBzZWFyY2hRdWVyeUZpZWxkczoge1xuICAgICAgICAgIGRpc3RyaWN0OiBcIlwiLFxuICAgICAgICAgIGVudW1EaXN0cmljdDogXCJmLUYwMDA1REZDXCIsXG4gICAgICAgICAgcmVnaXN0cmF0aW9uTnVtYmVyOiBcImYtRjAwMDdFMDJcIixcbiAgICAgICAgICBwYWdlOiBcImYtRjgwMDdFMDFcIixcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgICBzY290cDogeyBpZDogXCJjZW5zdXMxODUxXCIgfSxcbiAgICB9LFxuICB9LFxuICB7XG4gICAgd3RzSWQ6IFwiU2NvdGxhbmRDZW5zdXMxODYxXCIsXG4gICAgcGFydE9mOiBbXCJFbmdsYW5kV2FsZXNBbmRTY290bGFuZENlbnN1czE4NjFcIl0sXG4gICAgdGl0bGU6IFwiMTg2MSBDZW5zdXMgb2YgU2NvdGxhbmRcIixcbiAgICBjb3VudHJ5OiBcIlNjb3RsYW5kXCIsXG4gICAgZGF0ZXM6IHsgeWVhcjogMTg2MSwgZXhhY3REYXRlOiBcIjcgQXByIDE4NjFcIiB9LFxuICAgIHNpdGVzOiB7XG4gICAgICBhbmNlc3RyeToge1xuICAgICAgICBpZDogXCIxMDgwXCIsXG4gICAgICAgIHNlYXJjaFF1ZXJ5RmllbGRzOiB7XG4gICAgICAgICAgZGlzdHJpY3Q6IFwiZi1GMDAwM0I4QVwiLFxuICAgICAgICAgIGVudW1EaXN0cmljdDogXCJmLUYwMDAzMkVEXCIsXG4gICAgICAgICAgcmVnaXN0cmF0aW9uTnVtYmVyOiBcImYtRjAwMDNCODlcIixcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgICBzY290cDogeyBpZDogXCJjZW5zdXMxODYxXCIgfSxcbiAgICB9LFxuICB9LFxuICB7XG4gICAgd3RzSWQ6IFwiU2NvdGxhbmRDZW5zdXMxODcxXCIsXG4gICAgcGFydE9mOiBbXCJFbmdsYW5kV2FsZXNBbmRTY290bGFuZENlbnN1czE4NzFcIl0sXG4gICAgdGl0bGU6IFwiMTg3MSBDZW5zdXMgb2YgU2NvdGxhbmRcIixcbiAgICBjb3VudHJ5OiBcIlNjb3RsYW5kXCIsXG4gICAgZGF0ZXM6IHsgeWVhcjogMTg3MSwgZXhhY3REYXRlOiBcIjIgQXByIDE4NzFcIiB9LFxuICAgIHNpdGVzOiB7XG4gICAgICBhbmNlc3RyeToge1xuICAgICAgICBpZDogXCIxMTA0XCIsXG4gICAgICAgIHNlYXJjaFF1ZXJ5RmllbGRzOiB7XG4gICAgICAgICAgZGlzdHJpY3Q6IFwiZi1GMDAwM0I4QVwiLFxuICAgICAgICAgIGVudW1EaXN0cmljdDogXCJmLUYwMDAzMkVEXCIsXG4gICAgICAgICAgcmVnaXN0cmF0aW9uTnVtYmVyOiBcImYtRjAwMDNCODlcIixcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgICBzY290cDogeyBpZDogXCJjZW5zdXMxODcxXCIgfSxcbiAgICB9LFxuICB9LFxuICB7XG4gICAgd3RzSWQ6IFwiU2NvdGxhbmRDZW5zdXMxODgxXCIsXG4gICAgcGFydE9mOiBbXCJFbmdsYW5kV2FsZXNBbmRTY290bGFuZENlbnN1czE4ODFcIl0sXG4gICAgdGl0bGU6IFwiMTg4MSBDZW5zdXMgb2YgU2NvdGxhbmRcIixcbiAgICBjb3VudHJ5OiBcIlNjb3RsYW5kXCIsXG4gICAgZGF0ZXM6IHsgeWVhcjogMTg4MSwgZXhhY3REYXRlOiBcIjMgQXByIDE4ODFcIiB9LFxuICAgIHNpdGVzOiB7XG4gICAgICBhbmNlc3RyeToge1xuICAgICAgICBpZDogXCIxMTE5XCIsXG4gICAgICAgIHNlYXJjaFF1ZXJ5RmllbGRzOiB7XG4gICAgICAgICAgZGlzdHJpY3Q6IFwiZi1GMDAwM0I4QVwiLFxuICAgICAgICAgIGVudW1EaXN0cmljdDogXCJmLUYwMDAzMkVEXCIsXG4gICAgICAgICAgcmVnaXN0cmF0aW9uTnVtYmVyOiBcImYtRjAwMDNCODlcIixcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgICBzY290cDogeyBpZDogXCJjZW5zdXMxODgxXCIgfSxcbiAgICB9LFxuICB9LFxuICB7XG4gICAgd3RzSWQ6IFwiU2NvdGxhbmRDZW5zdXMxODkxXCIsXG4gICAgcGFydE9mOiBbXCJFbmdsYW5kV2FsZXNBbmRTY290bGFuZENlbnN1czE4OTFcIl0sXG4gICAgdGl0bGU6IFwiMTg5MSBDZW5zdXMgb2YgU2NvdGxhbmRcIixcbiAgICBjb3VudHJ5OiBcIlNjb3RsYW5kXCIsXG4gICAgZGF0ZXM6IHsgeWVhcjogMTg5MSwgZXhhY3REYXRlOiBcIjUgQXByIDE4OTFcIiB9LFxuICAgIHNpdGVzOiB7XG4gICAgICBhbmNlc3RyeToge1xuICAgICAgICBpZDogXCIxMTA4XCIsXG4gICAgICAgIHNlYXJjaFF1ZXJ5RmllbGRzOiB7XG4gICAgICAgICAgZGlzdHJpY3Q6IFwiZi1GMDAwM0I4QVwiLFxuICAgICAgICAgIGVudW1EaXN0cmljdDogXCJmLUYwMDAzMkVEXCIsXG4gICAgICAgICAgcmVnaXN0cmF0aW9uTnVtYmVyOiBcImYtRjAwMDNCODlcIixcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgICBzY290cDogeyBpZDogXCJjZW5zdXMxODkxXCIgfSxcbiAgICB9LFxuICB9LFxuICB7XG4gICAgd3RzSWQ6IFwiU2NvdGxhbmRDZW5zdXMxOTAxXCIsXG4gICAgcGFydE9mOiBbXCJFbmdsYW5kV2FsZXNBbmRTY290bGFuZENlbnN1czE5MDFcIl0sXG4gICAgdGl0bGU6IFwiMTkwMSBDZW5zdXMgb2YgU2NvdGxhbmRcIixcbiAgICBjb3VudHJ5OiBcIlNjb3RsYW5kXCIsXG4gICAgZGF0ZXM6IHsgeWVhcjogMTkwMSwgZXhhY3REYXRlOiBcIjMxIE1hciAxOTAxXCIgfSxcbiAgICBzaXRlczoge1xuICAgICAgYW5jZXN0cnk6IHtcbiAgICAgICAgaWQ6IFwiMTEwMVwiLFxuICAgICAgICBzZWFyY2hRdWVyeUZpZWxkczoge1xuICAgICAgICAgIGRpc3RyaWN0OiBcImYtRjAwMDNCOEFcIixcbiAgICAgICAgICBlbnVtRGlzdHJpY3Q6IFwiZi1GMDAwMzJFRFwiLFxuICAgICAgICAgIHJlZ2lzdHJhdGlvbk51bWJlcjogXCJmLUYwMDAzQjg5XCIsXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgICAgc2NvdHA6IHsgaWQ6IFwiY2Vuc3VzMTkwMVwiIH0sXG4gICAgfSxcbiAgfSxcbiAge1xuICAgIHd0c0lkOiBcIlNjb3RsYW5kQ2Vuc3VzMTkxMVwiLFxuICAgIHBhcnRPZjogW1wiRW5nbGFuZFdhbGVzQW5kU2NvdGxhbmRDZW5zdXMxOTExXCJdLFxuICAgIHRpdGxlOiBcIjE5MDEgQ2Vuc3VzIG9mIFNjb3RsYW5kXCIsXG4gICAgY291bnRyeTogXCJTY290bGFuZFwiLFxuICAgIGRhdGVzOiB7IHllYXI6IDE5MDEsIGV4YWN0RGF0ZTogXCIzMSBNYXIgMTkwMVwiIH0sXG4gICAgc2l0ZXM6IHtcbiAgICAgIHNjb3RwOiB7IGlkOiBcImNlbnN1czE5MTFcIiB9LFxuICAgIH0sXG4gIH0sXG4gIC8vIDE5MzkgUmVnaXN0ZXJcbiAge1xuICAgIHd0c0lkOiBcIkVuZ2xhbmRBbmRXYWxlczE5MzlSZWdpc3RlclwiLFxuICAgIHRpdGxlOiBcIjE5MzkgRW5nbGFuZCBhbmQgV2FsZXMgUmVnaXN0ZXJcIixcbiAgICBjb3VudHJ5OiBcIkVuZ2xhbmQgYW5kIFdhbGVzXCIsXG4gICAgZGF0ZXM6IHsgeWVhcjogMTkzOSB9LFxuICAgIGhvdXNlaG9sZFRhYmxlQ29sdW1uczogW1wibmFtZVwiLCBcIm1hcml0YWxTdGF0dXNcIiwgXCJnZW5kZXJcIiwgXCJiaXJ0aERhdGVcIiwgXCJvY2N1cGF0aW9uXCJdLFxuICAgIHNpdGVzOiB7XG4gICAgICBhbmNlc3RyeTogeyBpZDogXCI2MTU5NlwiIH0sXG4gICAgICBmbXA6IHtcbiAgICAgICAgaWQ6IFwiMTkzOSBSZWdpc3RlclwiLFxuICAgICAgICBzZWFyY2hRdWVyeUZpZWxkczogeyBtYXJpdGFsU3RhdHVzOiBcIm1hcml0YWxzdGF0dXNcIiB9LFxuICAgICAgfSxcbiAgICAgIGZzOiB7IGlkOiBcIjI4MzYxMzBcIiwgdGl0bGU6IFwiRW5nbGFuZCBhbmQgV2FsZXMgTmF0aW9uYWwgUmVnaXN0ZXIsIDE5MzlcIiB9LFxuICAgIH0sXG4gIH0sXG4gIC8vIEVuZ2xhbmQgJiBXYWxlcyBQcm9iYXRlXG4gIHtcbiAgICB3dHNJZDogXCJFbmdsYW5kQW5kV2FsZXNQcm9iYXRlXCIsXG4gICAgdGl0bGU6IFwiRW5nbGFuZCAmIFdhbGVzLCBOYXRpb25hbCBQcm9iYXRlIENhbGVuZGFyLCAxODU4LTE5OTVcIixcbiAgICBjb3VudHJ5OiBcIkVuZ2xhbmQgYW5kIFdhbGVzXCIsXG4gICAgc2l0ZXM6IHtcbiAgICAgIGFuY2VzdHJ5OiB7IGlkOiBcIjE5MDRcIiwgZGF0ZXM6IHsgZnJvbTogMTg1OCwgdG86IDE5OTUgfSB9LFxuICAgIH0sXG4gIH0sXG4gIC8vIEJyaXRpc2ggUGhvbmUgQm9va3NcbiAge1xuICAgIHd0c0lkOiBcIkJyaXRpc2hQaG9uZUJvb2tzXCIsXG4gICAgdGl0bGU6IFwiQnJpdGlzaCBQaG9uZSBCb29rcywgMTg4MC0xOTg0XCIsXG4gICAgY291bnRyeTogXCJVbml0ZWQgS2luZ2RvbVwiLFxuICAgIHNpdGVzOiB7XG4gICAgICBhbmNlc3RyeTogeyBpZDogXCIxMDI1XCIsIGRhdGVzOiB7IGZyb206IDE4ODAsIHRvOiAxOTg0IH0gfSxcbiAgICB9LFxuICB9LFxuXG4gIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cbiAgLy8gVVNcbiAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG4gIC8vIFVuaXRlZCBTdGF0ZXMgRmVkZXJhbCBDZW5zdXNcbiAge1xuICAgIHd0c0lkOiBcIlVzQ2Vuc3VzMTc5MFwiLFxuICAgIHRpdGxlOiBcIjE3OTAgVW5pdGVkIFN0YXRlcyBGZWRlcmFsIENlbnN1c1wiLFxuICAgIGNvdW50cnk6IFwiVW5pdGVkIFN0YXRlc1wiLFxuICAgIGRhdGVzOiB7IHllYXI6IDE3OTAsIGV4YWN0RGF0ZTogXCIyIEF1ZyAxNzkwXCIgfSxcbiAgICBzaXRlczoge1xuICAgICAgZnM6IHsgaWQ6IFwiMTgwMzk1OVwiIH0sXG4gICAgICBhbmNlc3RyeTogeyBpZDogXCI1MDU4XCIgfSxcbiAgICAgIGZtcDogeyBpZDogXCJVUyBDZW5zdXMgMTc5MFwiIH0sXG4gICAgfSxcbiAgfSxcbiAge1xuICAgIHd0c0lkOiBcIlVzQ2Vuc3VzMTgwMFwiLFxuICAgIHRpdGxlOiBcIjE4MDAgVW5pdGVkIFN0YXRlcyBGZWRlcmFsIENlbnN1c1wiLFxuICAgIGNvdW50cnk6IFwiVW5pdGVkIFN0YXRlc1wiLFxuICAgIGRhdGVzOiB7IHllYXI6IDE4MDAsIGV4YWN0RGF0ZTogXCI0IEF1ZyAxODAwXCIgfSxcbiAgICBzaXRlczoge1xuICAgICAgZnM6IHsgaWQ6IFwiMTgwNDIyOFwiIH0sXG4gICAgICBhbmNlc3RyeTogeyBpZDogXCI3NTkwXCIgfSxcbiAgICAgIGZtcDogeyBpZDogXCJVUyBDZW5zdXMgMTgwMFwiIH0sXG4gICAgfSxcbiAgfSxcbiAge1xuICAgIHd0c0lkOiBcIlVzQ2Vuc3VzMTgxMFwiLFxuICAgIHRpdGxlOiBcIjE4MTAgVW5pdGVkIFN0YXRlcyBGZWRlcmFsIENlbnN1c1wiLFxuICAgIGNvdW50cnk6IFwiVW5pdGVkIFN0YXRlc1wiLFxuICAgIGRhdGVzOiB7IHllYXI6IDE4MTAsIGV4YWN0RGF0ZTogXCI2IEF1ZyAxODEwXCIgfSxcbiAgICBzaXRlczoge1xuICAgICAgZnM6IHsgaWQ6IFwiMTgwMzc2NVwiIH0sXG4gICAgICBhbmNlc3RyeTogeyBpZDogXCI3NjEzXCIgfSxcbiAgICAgIGZtcDogeyBpZDogXCJVUyBDZW5zdXMgMTgxMFwiIH0sXG4gICAgfSxcbiAgfSxcbiAge1xuICAgIHd0c0lkOiBcIlVzQ2Vuc3VzMTgyMFwiLFxuICAgIHRpdGxlOiBcIjE4MjAgVW5pdGVkIFN0YXRlcyBGZWRlcmFsIENlbnN1c1wiLFxuICAgIGNvdW50cnk6IFwiVW5pdGVkIFN0YXRlc1wiLFxuICAgIGRhdGVzOiB7IHllYXI6IDE4MjAsIGV4YWN0RGF0ZTogXCI3IEF1ZyAxODIwXCIgfSxcbiAgICBzaXRlczoge1xuICAgICAgZnM6IHsgaWQ6IFwiMTgwMzk1NVwiIH0sXG4gICAgICBhbmNlc3RyeTogeyBpZDogXCI3NzM0XCIgfSxcbiAgICAgIGZtcDogeyBpZDogXCJVUyBDZW5zdXMgMTgyMFwiIH0sXG4gICAgfSxcbiAgfSxcbiAge1xuICAgIHd0c0lkOiBcIlVzQ2Vuc3VzMTgzMFwiLFxuICAgIHRpdGxlOiBcIjE4MzAgVW5pdGVkIFN0YXRlcyBGZWRlcmFsIENlbnN1c1wiLFxuICAgIGNvdW50cnk6IFwiVW5pdGVkIFN0YXRlc1wiLFxuICAgIGRhdGVzOiB7IHllYXI6IDE4MzAsIGV4YWN0RGF0ZTogXCIxIEp1biAxODMwXCIgfSxcbiAgICBzaXRlczoge1xuICAgICAgZnM6IHsgaWQ6IFwiMTgwMzk1OFwiIH0sXG4gICAgICBhbmNlc3RyeTogeyBpZDogXCI4MDU4XCIgfSxcbiAgICAgIGZtcDogeyBpZDogXCJVUyBDZW5zdXMgMTgzMFwiIH0sXG4gICAgfSxcbiAgfSxcbiAge1xuICAgIHd0c0lkOiBcIlVzQ2Vuc3VzMTg0MFwiLFxuICAgIHRpdGxlOiBcIjE4NDAgVW5pdGVkIFN0YXRlcyBGZWRlcmFsIENlbnN1c1wiLFxuICAgIGNvdW50cnk6IFwiVW5pdGVkIFN0YXRlc1wiLFxuICAgIGRhdGVzOiB7IHllYXI6IDE4NDAsIGV4YWN0RGF0ZTogXCIxIEp1biAxODQwXCIgfSxcbiAgICBzaXRlczoge1xuICAgICAgZnM6IHsgaWQ6IFwiMTc4NjQ1N1wiIH0sXG4gICAgICBhbmNlc3RyeTogeyBpZDogXCI4MDU3XCIgfSxcbiAgICAgIGZtcDogeyBpZDogXCJVUyBDZW5zdXMgMTg0MFwiIH0sXG4gICAgfSxcbiAgfSxcbiAge1xuICAgIHd0c0lkOiBcIlVzQ2Vuc3VzMTg1MFwiLFxuICAgIHRpdGxlOiBcIjE4NTAgVW5pdGVkIFN0YXRlcyBGZWRlcmFsIENlbnN1c1wiLFxuICAgIGNvdW50cnk6IFwiVW5pdGVkIFN0YXRlc1wiLFxuICAgIGRhdGVzOiB7IHllYXI6IDE4NTAsIGV4YWN0RGF0ZTogXCIxIEp1biAxODUwXCIgfSxcbiAgICBob3VzZWhvbGRUYWJsZUNvbHVtbnM6IGhvdXNlaG9sZFRhYmxlQ29sdW1uc1VzRmVkZXJhbDE4NTAsXG4gICAgc2l0ZXM6IHtcbiAgICAgIGZzOiB7IGlkOiBcIjE0MDE2MzhcIiB9LFxuICAgICAgYW5jZXN0cnk6IHsgaWQ6IFwiODA1NFwiIH0sXG4gICAgICBmbXA6IHsgaWQ6IFwiVVMgQ2Vuc3VzIDE4NTBcIiB9LFxuICAgIH0sXG4gIH0sXG4gIHtcbiAgICB3dHNJZDogXCJVc0NlbnN1czE4NjBcIixcbiAgICB0aXRsZTogXCIxODYwIFVuaXRlZCBTdGF0ZXMgRmVkZXJhbCBDZW5zdXNcIixcbiAgICBjb3VudHJ5OiBcIlVuaXRlZCBTdGF0ZXNcIixcbiAgICBkYXRlczogeyB5ZWFyOiAxODYwLCBleGFjdERhdGU6IFwiMSBKdW4gMTg2MFwiIH0sXG4gICAgaG91c2Vob2xkVGFibGVDb2x1bW5zOiBob3VzZWhvbGRUYWJsZUNvbHVtbnNVc0ZlZGVyYWwxODUwLFxuICAgIHNpdGVzOiB7XG4gICAgICBmczogeyBpZDogXCIxNDczMTgxXCIgfSxcbiAgICAgIGFuY2VzdHJ5OiB7IGlkOiBcIjc2NjdcIiB9LFxuICAgICAgZm1wOiB7IGlkOiBcIlVTIENlbnN1cyAxODYwXCIgfSxcbiAgICB9LFxuICB9LFxuICB7XG4gICAgd3RzSWQ6IFwiVXNDZW5zdXMxODcwXCIsXG4gICAgdGl0bGU6IFwiMTg3MCBVbml0ZWQgU3RhdGVzIEZlZGVyYWwgQ2Vuc3VzXCIsXG4gICAgY291bnRyeTogXCJVbml0ZWQgU3RhdGVzXCIsXG4gICAgZGF0ZXM6IHsgeWVhcjogMTg3MCwgZXhhY3REYXRlOiBcIjEgSnVuIDE4NzBcIiB9LFxuICAgIGhvdXNlaG9sZFRhYmxlQ29sdW1uczogaG91c2Vob2xkVGFibGVDb2x1bW5zVXNGZWRlcmFsMTg1MCxcbiAgICBzaXRlczoge1xuICAgICAgZnM6IHsgaWQ6IFwiMTQzODAyNFwiIH0sXG4gICAgICBhbmNlc3RyeTogeyBpZDogXCI3MTYzXCIgfSxcbiAgICAgIGZtcDogeyBpZDogXCJVUyBDZW5zdXMgMTg3MFwiIH0sXG4gICAgfSxcbiAgfSxcbiAge1xuICAgIHd0c0lkOiBcIlVzQ2Vuc3VzMTg4MFwiLFxuICAgIHRpdGxlOiBcIjE4ODAgVW5pdGVkIFN0YXRlcyBGZWRlcmFsIENlbnN1c1wiLFxuICAgIGNvdW50cnk6IFwiVW5pdGVkIFN0YXRlc1wiLFxuICAgIGRhdGVzOiB7IHllYXI6IDE4ODAsIGV4YWN0RGF0ZTogXCIxIEp1biAxODgwXCIgfSxcbiAgICBob3VzZWhvbGRUYWJsZUNvbHVtbnM6IGhvdXNlaG9sZFRhYmxlQ29sdW1uc1VzRmVkZXJhbFBvc3QxODgwLFxuICAgIHNpdGVzOiB7XG4gICAgICBmczogeyBpZDogXCIxNDE3NjgzXCIgfSxcbiAgICAgIGFuY2VzdHJ5OiB7IGlkOiBcIjY3NDJcIiB9LFxuICAgICAgZm1wOiB7IGlkOiBcIlVTIENlbnN1cyAxODgwXCIgfSxcbiAgICB9LFxuICB9LFxuICB7XG4gICAgd3RzSWQ6IFwiVXNDZW5zdXMxODkwXCIsXG4gICAgdGl0bGU6IFwiMTg5MCBVbml0ZWQgU3RhdGVzIEZlZGVyYWwgQ2Vuc3VzXCIsXG4gICAgY291bnRyeTogXCJVbml0ZWQgU3RhdGVzXCIsXG4gICAgZGF0ZXM6IHsgeWVhcjogMTg5MCwgZXhhY3REYXRlOiBcIjIgSnVuIDE4OTBcIiB9LFxuICAgIGhvdXNlaG9sZFRhYmxlQ29sdW1uczogaG91c2Vob2xkVGFibGVDb2x1bW5zVXNGZWRlcmFsUG9zdDE4ODAsXG4gICAgc2l0ZXM6IHtcbiAgICAgIGZzOiB7IGlkOiBcIjE2MTA1NTFcIiB9LFxuICAgICAgYW5jZXN0cnk6IHtcbiAgICAgICAgaWQ6IFwiNTQ0NVwiLFxuICAgICAgICB0aXRsZTogXCIxODkwIFVuaXRlZCBTdGF0ZXMgRmVkZXJhbCBDZW5zdXMgRnJhZ21lbnRcIixcbiAgICAgIH0sXG4gICAgICBmbXA6IHsgaWQ6IFwiVVMgQ2Vuc3VzIDE4OTBcIiB9LFxuICAgIH0sXG4gIH0sXG4gIHtcbiAgICB3dHNJZDogXCJVc0NlbnN1czE5MDBcIixcbiAgICB0aXRsZTogXCIxOTAwIFVuaXRlZCBTdGF0ZXMgRmVkZXJhbCBDZW5zdXNcIixcbiAgICBjb3VudHJ5OiBcIlVuaXRlZCBTdGF0ZXNcIixcbiAgICBkYXRlczogeyB5ZWFyOiAxOTAwLCBleGFjdERhdGU6IFwiMSBKdW4gMTkwMFwiIH0sXG4gICAgaG91c2Vob2xkVGFibGVDb2x1bW5zOiBob3VzZWhvbGRUYWJsZUNvbHVtbnNVc0ZlZGVyYWxQb3N0MTg4MCxcbiAgICBzaXRlczoge1xuICAgICAgZnM6IHsgaWQ6IFwiMTMyNTIyMVwiIH0sXG4gICAgICBhbmNlc3RyeTogeyBpZDogXCI3NjAyXCIgfSxcbiAgICAgIGZtcDogeyBpZDogXCJVUyBDZW5zdXMgMTkwMFwiIH0sXG4gICAgfSxcbiAgfSxcbiAge1xuICAgIHd0c0lkOiBcIlVzQ2Vuc3VzMTkxMFwiLFxuICAgIHRpdGxlOiBcIjE5MTAgVW5pdGVkIFN0YXRlcyBGZWRlcmFsIENlbnN1c1wiLFxuICAgIGNvdW50cnk6IFwiVW5pdGVkIFN0YXRlc1wiLFxuICAgIGRhdGVzOiB7IHllYXI6IDE5MTAsIGV4YWN0RGF0ZTogXCIxNSBBcHIgMTkxMFwiIH0sXG4gICAgaG91c2Vob2xkVGFibGVDb2x1bW5zOiBob3VzZWhvbGRUYWJsZUNvbHVtbnNVc0ZlZGVyYWxQb3N0MTg4MCxcbiAgICBzaXRlczoge1xuICAgICAgZnM6IHsgaWQ6IFwiMTcyNzAzM1wiIH0sXG4gICAgICBhbmNlc3RyeTogeyBpZDogXCI3ODg0XCIgfSxcbiAgICAgIGZtcDogeyBpZDogXCJVUyBDZW5zdXMgMTkxMFwiIH0sXG4gICAgfSxcbiAgfSxcbiAge1xuICAgIHd0c0lkOiBcIlVzQ2Vuc3VzMTkyMFwiLFxuICAgIHRpdGxlOiBcIjE5MjAgVW5pdGVkIFN0YXRlcyBGZWRlcmFsIENlbnN1c1wiLFxuICAgIGNvdW50cnk6IFwiVW5pdGVkIFN0YXRlc1wiLFxuICAgIGRhdGVzOiB7IHllYXI6IDE5MjAsIGV4YWN0RGF0ZTogXCIxIEphbiAxOTIwXCIgfSxcbiAgICBob3VzZWhvbGRUYWJsZUNvbHVtbnM6IGhvdXNlaG9sZFRhYmxlQ29sdW1uc1VzRmVkZXJhbFBvc3QxODgwLFxuICAgIHNpdGVzOiB7XG4gICAgICBmczogeyBpZDogXCIxNDg4NDExXCIgfSxcbiAgICAgIGFuY2VzdHJ5OiB7IGlkOiBcIjYwNjFcIiB9LFxuICAgICAgZm1wOiB7IGlkOiBcIlVTIENlbnN1cyAxOTIwXCIgfSxcbiAgICB9LFxuICB9LFxuICB7XG4gICAgd3RzSWQ6IFwiVXNDZW5zdXMxOTMwXCIsXG4gICAgdGl0bGU6IFwiMTkzMCBVbml0ZWQgU3RhdGVzIEZlZGVyYWwgQ2Vuc3VzXCIsXG4gICAgY291bnRyeTogXCJVbml0ZWQgU3RhdGVzXCIsXG4gICAgZGF0ZXM6IHsgeWVhcjogMTkzMCwgZXhhY3REYXRlOiBcIjIgQXByIDE5MzBcIiB9LFxuICAgIGhvdXNlaG9sZFRhYmxlQ29sdW1uczogaG91c2Vob2xkVGFibGVDb2x1bW5zVXNGZWRlcmFsUG9zdDE4ODAsXG4gICAgc2l0ZXM6IHtcbiAgICAgIGZzOiB7IGlkOiBcIjE4MTA3MzFcIiB9LFxuICAgICAgYW5jZXN0cnk6IHsgaWQ6IFwiNjIyNFwiIH0sXG4gICAgICBmbXA6IHsgaWQ6IFwiVVMgQ2Vuc3VzIDE5MzBcIiB9LFxuICAgIH0sXG4gIH0sXG4gIHtcbiAgICB3dHNJZDogXCJVc0NlbnN1czE5NDBcIixcbiAgICB0aXRsZTogXCIxOTQwIFVuaXRlZCBTdGF0ZXMgRmVkZXJhbCBDZW5zdXNcIixcbiAgICBjb3VudHJ5OiBcIlVuaXRlZCBTdGF0ZXNcIixcbiAgICBkYXRlczogeyB5ZWFyOiAxOTQwLCBleGFjdERhdGU6IFwiMSBBcHIgMTk0MFwiIH0sXG4gICAgaG91c2Vob2xkVGFibGVDb2x1bW5zOiBob3VzZWhvbGRUYWJsZUNvbHVtbnNVc0ZlZGVyYWxQb3N0MTg4MCxcbiAgICBzaXRlczoge1xuICAgICAgZnM6IHsgaWQ6IFwiMjAwMDIxOVwiIH0sXG4gICAgICBhbmNlc3RyeTogeyBpZDogXCIyNDQyXCIgfSxcbiAgICAgIGZtcDogeyBpZDogXCJVUyBDZW5zdXMgMTk0MFwiIH0sXG4gICAgfSxcbiAgfSxcbiAge1xuICAgIHd0c0lkOiBcIlVzQ2Vuc3VzMTk1MFwiLFxuICAgIHRpdGxlOiBcIjE5NTAgVW5pdGVkIFN0YXRlcyBGZWRlcmFsIENlbnN1c1wiLFxuICAgIGNvdW50cnk6IFwiVW5pdGVkIFN0YXRlc1wiLFxuICAgIGRhdGVzOiB7IHllYXI6IDE5NTAsIGV4YWN0RGF0ZTogXCIxIEFwciAxOTUwXCIgfSxcbiAgICBob3VzZWhvbGRUYWJsZUNvbHVtbnM6IGhvdXNlaG9sZFRhYmxlQ29sdW1uc1VzRmVkZXJhbFBvc3QxODgwLFxuICAgIHNpdGVzOiB7XG4gICAgICBhbmNlc3RyeTogeyBpZDogXCI2MjMwOFwiIH0sXG4gICAgICBmczogeyBpZDogXCI0NDY0NTE1XCIgfSxcbiAgICAgIC8vIGZtcDogeyBpZDogXCJVUyBDZW5zdXMgMTk1MFwifSwgLy8gTm90IHlldCB0cmFuc2NyaWJlZCBvbiBGTVAgKGFzIG9mIDMxIEF1ZyAyMDIyKVxuICAgIH0sXG4gIH0sXG5cbiAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuICAvLyBDYW5hZGFcbiAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG4gIC8vIENhbmFkYSBDZW5zdXNcbiAge1xuICAgIHd0c0lkOiBcIkNhbmFkYUNlbnN1czE4NTFcIixcbiAgICB0aXRsZTogXCIxODUxIENlbnN1cyBvZiBDYW5hZGFcIixcbiAgICBjb3VudHJ5OiBcIkNhbmFkYVwiLFxuICAgIGRhdGVzOiB7IHllYXI6IDE4NTEgfSxcbiAgICBzaXRlczoge1xuICAgICAgZnM6IHsgaWQ6IFwiMTMyNTE5MlwiIH0sXG4gICAgICBhbmNlc3RyeTogeyBpZDogXCIxMDYxXCIsIGFsZElkOiBcIjE4NTFDYW5hZGFcIiB9LFxuICAgICAgZm1wOiB7IGlkOiBcIkNhbmFkYSBDZW5zdXMgMTg1MVwiIH0sXG4gICAgfSxcbiAgfSxcbiAge1xuICAgIHd0c0lkOiBcIkNhbmFkYUNlbnN1czE4NjFcIixcbiAgICB0aXRsZTogXCIxODYxIENlbnN1cyBvZiBDYW5hZGFcIixcbiAgICBjb3VudHJ5OiBcIkNhbmFkYVwiLFxuICAgIGRhdGVzOiB7IHllYXI6IDE4NjEgfSxcbiAgICBzaXRlczoge1xuICAgICAgLy8gZnM6IHsgaWQ6IFwiMjE0Mzk5OFwifSwgKHNlZW1zIHRvIGJlIHBlciBzdGF0ZSlcbiAgICAgIGFuY2VzdHJ5OiB7IGlkOiBcIjE1NzBcIiB9LFxuICAgICAgZm1wOiB7IGlkOiBcIkNhbmFkYSBDZW5zdXMgMTg2MVwiIH0sXG4gICAgfSxcbiAgfSxcbiAge1xuICAgIHd0c0lkOiBcIkNhbmFkYUNlbnN1czE4NzFcIixcbiAgICB0aXRsZTogXCIxODcxIENlbnN1cyBvZiBDYW5hZGFcIixcbiAgICBjb3VudHJ5OiBcIkNhbmFkYVwiLFxuICAgIGRhdGVzOiB7IHllYXI6IDE4NzEgfSxcbiAgICBzaXRlczoge1xuICAgICAgZnM6IHsgaWQ6IFwiMTU1MTYxMlwiIH0sXG4gICAgICBhbmNlc3RyeTogeyBpZDogXCIxNTc4XCIgfSxcbiAgICAgIGZtcDogeyBpZDogXCJDYW5hZGEgQ2Vuc3VzIDE4NzFcIiB9LFxuICAgIH0sXG4gIH0sXG4gIHtcbiAgICB3dHNJZDogXCJDYW5hZGFDZW5zdXMxODgxXCIsXG4gICAgdGl0bGU6IFwiMTg4MSBDZW5zdXMgb2YgQ2FuYWRhXCIsXG4gICAgY291bnRyeTogXCJDYW5hZGFcIixcbiAgICBkYXRlczogeyB5ZWFyOiAxODgxIH0sXG4gICAgc2l0ZXM6IHtcbiAgICAgIGZzOiB7IGlkOiBcIjE4MDQ1NDFcIiB9LFxuICAgICAgYW5jZXN0cnk6IHsgaWQ6IFwiMTU3N1wiLCBhbHRJZDogXCIxODgxQ2FuYWRhXCIgfSxcbiAgICAgIGZtcDogeyBpZDogXCJDYW5hZGEgQ2Vuc3VzIDE4ODFcIiB9LFxuICAgIH0sXG4gIH0sXG4gIHtcbiAgICB3dHNJZDogXCJDYW5hZGFDZW5zdXMxODkxXCIsXG4gICAgdGl0bGU6IFwiMTg5MSBDZW5zdXMgb2YgQ2FuYWRhXCIsXG4gICAgY291bnRyeTogXCJDYW5hZGFcIixcbiAgICBkYXRlczogeyB5ZWFyOiAxODkxIH0sXG4gICAgc2l0ZXM6IHtcbiAgICAgIGZzOiB7IGlkOiBcIjE1ODM1MzZcIiB9LFxuICAgICAgYW5jZXN0cnk6IHsgaWQ6IFwiMTI3NFwiIH0sXG4gICAgICBmbXA6IHsgaWQ6IFwiQ2FuYWRhIENlbnN1cyAxODkxXCIgfSxcbiAgICB9LFxuICB9LFxuICB7XG4gICAgd3RzSWQ6IFwiQ2FuYWRhQ2Vuc3VzMTkwMVwiLFxuICAgIHRpdGxlOiBcIjE5MDEgQ2Vuc3VzIG9mIENhbmFkYVwiLFxuICAgIGNvdW50cnk6IFwiQ2FuYWRhXCIsXG4gICAgZGF0ZXM6IHsgeWVhcjogMTkwMSB9LFxuICAgIGhvdXNlaG9sZFRhYmxlQ29sdW1uczogW1xuICAgICAgXCJuYW1lXCIsXG4gICAgICBcImdlbmRlclwiLFxuICAgICAgXCJhZ2VcIixcbiAgICAgIFwicmVsYXRpb25zaGlwXCIsXG4gICAgICBcIm1hcml0YWxTdGF0dXNcIixcbiAgICAgIFwiYmlydGhEYXRlXCIsXG4gICAgICBcImJpcnRoUGxhY2VcIixcbiAgICAgIFwib2NjdXBhdGlvblwiLFxuICAgIF0sXG4gICAgc2l0ZXM6IHtcbiAgICAgIGZzOiB7IGlkOiBcIjE1ODQ1NTdcIiB9LFxuICAgICAgYW5jZXN0cnk6IHsgaWQ6IFwiODgyNlwiIH0sXG4gICAgICBmbXA6IHtcbiAgICAgICAgaWQ6IFwiQ2FuYWRhIENlbnN1cyAxOTAxXCIsXG4gICAgICAgIHNlYXJjaFF1ZXJ5RmllbGRzOiB7IG1hcml0YWxzdGF0dXM6IFwibWFyaXRhbHN0YXR1c1wiIH0sXG4gICAgICB9LFxuICAgIH0sXG4gIH0sXG4gIHtcbiAgICB3dHNJZDogXCJDYW5hZGFDZW5zdXMxOTExXCIsXG4gICAgdGl0bGU6IFwiMTkxMSBDZW5zdXMgb2YgQ2FuYWRhXCIsXG4gICAgY291bnRyeTogXCJDYW5hZGFcIixcbiAgICBkYXRlczogeyB5ZWFyOiAxOTExIH0sXG4gICAgaG91c2Vob2xkVGFibGVDb2x1bW5zOiBbXG4gICAgICBcIm5hbWVcIixcbiAgICAgIFwiZ2VuZGVyXCIsXG4gICAgICBcImFnZVwiLFxuICAgICAgXCJyZWxhdGlvbnNoaXBcIixcbiAgICAgIFwibWFyaXRhbFN0YXR1c1wiLFxuICAgICAgXCJiaXJ0aERhdGVcIixcbiAgICAgIFwiYmlydGhQbGFjZVwiLFxuICAgICAgXCJvY2N1cGF0aW9uXCIsXG4gICAgXSxcbiAgICBzaXRlczoge1xuICAgICAgZnM6IHsgaWQ6IFwiMjE0Mzk5OFwiIH0sXG4gICAgICBhbmNlc3RyeTogeyBpZDogXCI4OTQ3XCIgfSxcbiAgICAgIGZtcDogeyBpZDogXCJDYW5hZGEgQ2Vuc3VzIDE5MTFcIiB9LFxuICAgIH0sXG4gIH0sXG4gIHtcbiAgICB3dHNJZDogXCJDYW5hZGFDZW5zdXMxOTIxXCIsXG4gICAgdGl0bGU6IFwiMTkyMSBDZW5zdXMgb2YgQ2FuYWRhXCIsXG4gICAgY291bnRyeTogXCJDYW5hZGFcIixcbiAgICBkYXRlczogeyB5ZWFyOiAxOTIxIH0sXG4gICAgaG91c2Vob2xkVGFibGVDb2x1bW5zOiBbXCJuYW1lXCIsIFwiZ2VuZGVyXCIsIFwiYWdlXCIsIFwicmVsYXRpb25zaGlwXCIsIFwibWFyaXRhbFN0YXR1c1wiLCBcImJpcnRoUGxhY2VcIiwgXCJvY2N1cGF0aW9uXCJdLFxuICAgIHNpdGVzOiB7XG4gICAgICBhbmNlc3RyeTogeyBpZDogXCI4OTkxXCIgfSxcbiAgICB9LFxuICB9LFxuICAvLyBQb2xhbmRcbiAge1xuICAgIHd0c0lkOiBcIlBvbGFuZEJpcnRoUmVnXCIsXG4gICAgdGl0bGU6IFwiUG9sYW5kIFJlZ2lzdHJhdGlvbiBCaXJ0aCBJbmRleFwiLFxuICAgIGNvdW50cnk6IFwiUG9sYW5kXCIsXG4gICAgaXNCaXJ0aDogdHJ1ZSxcbiAgICBzaXRlczoge1xuICAgICAgZ2VuZXRla2E6IHsgaWQ6IFwiYmlydGhzXCIgfSxcbiAgICB9LFxuICB9LFxuICB7XG4gICAgd3RzSWQ6IFwiUG9sYW5kRGVhdGhSZWdcIixcbiAgICB0aXRsZTogXCJQb2xhbmQgUmVnaXN0cmF0aW9uIERlYXRoIEluZGV4XCIsXG4gICAgY291bnRyeTogXCJQb2xhbmRcIixcbiAgICBpc0RlYXRoOiB0cnVlLFxuICAgIHNpdGVzOiB7XG4gICAgICBnZW5ldGVrYTogeyBpZDogXCJkZWF0aHNcIiB9LFxuICAgIH0sXG4gIH0sXG4gIHtcbiAgICB3dHNJZDogXCJQb2xhbmRNYXJyaWFnZVJlZ1wiLFxuICAgIHRpdGxlOiBcIlBvbGFuZCBSZWdpc3RyYXRpb24gTWFycmlhZ2UgSW5kZXhcIixcbiAgICBjb3VudHJ5OiBcIlBvbGFuZFwiLFxuICAgIGlzTWFycmlhZ2U6IHRydWUsXG4gICAgc2l0ZXM6IHtcbiAgICAgIGdlbmV0ZWthOiB7IGlkOiBcIm1hcnJpYWdlc1wiIH0sXG4gICAgfSxcbiAgfSxcbl07XG5cbmNvbnN0IFJDID0ge1xuICBmaW5kQ29sbGVjdGlvbjogZnVuY3Rpb24gKHNpdGVOYW1lLCBjb2xsZWN0aW9uSWQpIHtcbiAgICBmb3IgKGxldCBjb2xsZWN0aW9uIG9mIFJlY29yZENvbGxlY3Rpb25EYXRhKSB7XG4gICAgICBpZiAoY29sbGVjdGlvbi5zaXRlcyAmJiBjb2xsZWN0aW9uLnNpdGVzW3NpdGVOYW1lXSAmJiBjb2xsZWN0aW9uLnNpdGVzW3NpdGVOYW1lXS5pZCA9PSBjb2xsZWN0aW9uSWQpIHtcbiAgICAgICAgcmV0dXJuIGNvbGxlY3Rpb247XG4gICAgICB9XG4gICAgfVxuICB9LFxuICBmaW5kQ29sbGVjdGlvbkJ5QWx0SWQ6IGZ1bmN0aW9uIChzaXRlTmFtZSwgYWx0Q29sbGVjdGlvbklkKSB7XG4gICAgZm9yIChsZXQgY29sbGVjdGlvbiBvZiBSZWNvcmRDb2xsZWN0aW9uRGF0YSkge1xuICAgICAgaWYgKGNvbGxlY3Rpb24uc2l0ZXMgJiYgY29sbGVjdGlvbi5zaXRlc1tzaXRlTmFtZV0gJiYgY29sbGVjdGlvbi5zaXRlc1tzaXRlTmFtZV0uYWx0SWQgPT0gYWx0Q29sbGVjdGlvbklkKSB7XG4gICAgICAgIHJldHVybiBjb2xsZWN0aW9uO1xuICAgICAgfVxuICAgIH1cbiAgfSxcbiAgZmluZENvbGxlY3Rpb25CeVd0c0lkOiBmdW5jdGlvbiAoY29sbGVjdGlvbklkKSB7XG4gICAgZm9yIChsZXQgY29sbGVjdGlvbiBvZiBSZWNvcmRDb2xsZWN0aW9uRGF0YSkge1xuICAgICAgaWYgKGNvbGxlY3Rpb24ud3RzSWQgPT0gY29sbGVjdGlvbklkKSB7XG4gICAgICAgIHJldHVybiBjb2xsZWN0aW9uO1xuICAgICAgfVxuICAgIH1cbiAgfSxcbiAgZ2V0Q29sbGVjdGlvbnNUaGF0VGhpc0NvbGxlY3Rpb25Jc1BhcnRPZjogZnVuY3Rpb24gKGNvbGxlY3Rpb24pIHtcbiAgICBsZXQgcmVzdWx0ID0gW107XG4gICAgaWYgKGNvbGxlY3Rpb24ucGFydE9mKSB7XG4gICAgICBmb3IgKGxldCBvd25pbmdDb2xsZWN0aW9uV3RzSWQgb2YgY29sbGVjdGlvbi5wYXJ0T2YpIHtcbiAgICAgICAgbGV0IG93bmluZ0NvbGxlY3Rpb24gPSBSQy5maW5kQ29sbGVjdGlvbkJ5V3RzSWQob3duaW5nQ29sbGVjdGlvbld0c0lkKTtcbiAgICAgICAgaWYgKG93bmluZ0NvbGxlY3Rpb24pIHtcbiAgICAgICAgICByZXN1bHQucHVzaChvd25pbmdDb2xsZWN0aW9uKTtcblxuICAgICAgICAgIGxldCBwYXJlbnRDb2xsZWN0aW9ucyA9IFJDLmdldENvbGxlY3Rpb25zVGhhdFRoaXNDb2xsZWN0aW9uSXNQYXJ0T2Yob3duaW5nQ29sbGVjdGlvbik7XG4gICAgICAgICAgZm9yIChsZXQgcGFyZW50Q29sbGVjdGlvbiBvZiBwYXJlbnRDb2xsZWN0aW9ucykge1xuICAgICAgICAgICAgcmVzdWx0LnB1c2gocGFyZW50Q29sbGVjdGlvbik7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNvbnNvbGUubG9nKFwiRXJyb3I6IG93bmluZ0NvbGxlY3Rpb25XdHNJZCBvZiAnXCIgKyBvd25pbmdDb2xsZWN0aW9uV3RzSWQgKyBcIicgd2FzIG5vdCBmb3VuZFwiKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9LFxuICBnZXRDb2xsZWN0aW9uc1RoYXRBcmVQYXJ0T2ZUaGlzQ29sbGVjdGlvbjogZnVuY3Rpb24gKGNvbGxlY3Rpb24pIHtcbiAgICBsZXQgcmVzdWx0ID0gW107XG5cbiAgICBmdW5jdGlvbiBkb2VzQ29sbGVjdGlvbk93bkNvbGxlY3Rpb24ocGFyZW50Q29sbGVjdGlvbiwgY2hpbGRDb2xsZWN0aW9uKSB7XG4gICAgICBsZXQgcGFyZW50V3RzSWQgPSBwYXJlbnRDb2xsZWN0aW9uLnd0c0lkO1xuICAgICAgaWYgKGNoaWxkQ29sbGVjdGlvbi5wYXJ0T2YpIHtcbiAgICAgICAgZm9yIChsZXQgb3duaW5nQ29sbGVjdGlvbld0c0lkIG9mIGNoaWxkQ29sbGVjdGlvbi5wYXJ0T2YpIHtcbiAgICAgICAgICBpZiAob3duaW5nQ29sbGVjdGlvbld0c0lkID09IHBhcmVudFd0c0lkKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICB9XG4gICAgICAgICAgbGV0IG93bmluZ0NvbGxlY3Rpb24gPSBSQy5maW5kQ29sbGVjdGlvbkJ5V3RzSWQob3duaW5nQ29sbGVjdGlvbld0c0lkKTtcbiAgICAgICAgICBpZiAoZG9lc0NvbGxlY3Rpb25Pd25Db2xsZWN0aW9uKHBhcmVudENvbGxlY3Rpb24sIG93bmluZ0NvbGxlY3Rpb24pKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBmb3IgKGxldCBvdGhlckNvbGxlY3Rpb24gb2YgUmVjb3JkQ29sbGVjdGlvbkRhdGEpIHtcbiAgICAgIGlmIChkb2VzQ29sbGVjdGlvbk93bkNvbGxlY3Rpb24oY29sbGVjdGlvbiwgb3RoZXJDb2xsZWN0aW9uKSkge1xuICAgICAgICByZXN1bHQucHVzaChvdGhlckNvbGxlY3Rpb24pO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9LFxuICBtYXBDb2xsZWN0aW9uSWQ6IGZ1bmN0aW9uIChzb3VyY2VTaXRlTmFtZSwgc291cmNlQ29sbGVjdGlvbklkLCB0YXJnZXRTaXRlTmFtZSwgc291cmNlQ291bnRyeSwgZXZlbnRZZWFyU3RyaW5nKSB7XG4gICAgbGV0IGV2ZW50WWVhciA9IHBhcnNlSW50KGV2ZW50WWVhclN0cmluZyk7XG4gICAgaWYgKGlzTmFOKGV2ZW50WWVhcikpIHtcbiAgICAgIGV2ZW50WWVhciA9IHVuZGVmaW5lZDtcbiAgICB9XG5cbiAgICBsZXQgc291cmNlQ29sbGVjdGlvbiA9IFJDLmZpbmRDb2xsZWN0aW9uKHNvdXJjZVNpdGVOYW1lLCBzb3VyY2VDb2xsZWN0aW9uSWQpO1xuICAgIGxldCB0YXJnZXRDb2xsZWN0aW9uSWQgPSBSQy5nZXRTaXRlSWRGcm9tQ29sbGVjdGlvbihzb3VyY2VDb2xsZWN0aW9uLCB0YXJnZXRTaXRlTmFtZSk7XG4gICAgaWYgKCF0YXJnZXRDb2xsZWN0aW9uSWQgJiYgc291cmNlQ29sbGVjdGlvbikge1xuICAgICAgLy8gc29tZXRpbWVzIGNvbGxlY3Rpb25zIGRvbid0IG1hcCBleGFjdGx5LCB0aGUgc291cmNlIGNvbGxlY3Rpb24gY291bGQgYmUgcGFydCBvZiBhIGNvbGxlY3Rpb25cbiAgICAgIGxldCBvd25pbmdDb2xsZWN0aW9ucyA9IFJDLmdldENvbGxlY3Rpb25zVGhhdFRoaXNDb2xsZWN0aW9uSXNQYXJ0T2Yoc291cmNlQ29sbGVjdGlvbik7XG4gICAgICBmb3IgKGxldCBvd25pbmdDb2xsZWN0aW9uIG9mIG93bmluZ0NvbGxlY3Rpb25zKSB7XG4gICAgICAgIGxldCBvd25pbmdUYXJnZXRDb2xsZWN0aW9uSWQgPSBSQy5nZXRTaXRlSWRGcm9tQ29sbGVjdGlvbihvd25pbmdDb2xsZWN0aW9uLCB0YXJnZXRTaXRlTmFtZSk7XG4gICAgICAgIGlmIChvd25pbmdUYXJnZXRDb2xsZWN0aW9uSWQpIHtcbiAgICAgICAgICByZXR1cm4gb3duaW5nVGFyZ2V0Q29sbGVjdGlvbklkO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICAvLyBvciBvdGhlciBjb2xsZWN0aW9ucyBjb3VsZCBiZSBwYXJ0IG9mIHRoZSBzb3VyY2UgY29sbGVjdGlvblxuICAgICAgbGV0IGJlc3RNYXRjaENvbGxlY3Rpb24gPSB1bmRlZmluZWQ7XG4gICAgICBsZXQgb3duZWRDb2xsZWN0aW9ucyA9IFJDLmdldENvbGxlY3Rpb25zVGhhdEFyZVBhcnRPZlRoaXNDb2xsZWN0aW9uKHNvdXJjZUNvbGxlY3Rpb24pO1xuICAgICAgZm9yIChsZXQgb3duZWRDb2xsZWN0aW9uIG9mIG93bmVkQ29sbGVjdGlvbnMpIHtcbiAgICAgICAgLy8gTm90ZSB0aGVyZSBjb3VsZCBiZSBzZXZlcmFsIGNvbGxlY3Rpb25zIHRoYXQgYXJlIHBhcnQgb2YgdGhpcyBjb2xsZWN0aW9uXG4gICAgICAgIC8vIHdlIHNob3VsZCB1c2UgY291bnRyeSBhcyBhIGd1aWRlXG4gICAgICAgIGxldCBvd25lZFRhcmdldENvbGxlY3Rpb25JZCA9IFJDLmdldFNpdGVJZEZyb21Db2xsZWN0aW9uKG93bmVkQ29sbGVjdGlvbiwgdGFyZ2V0U2l0ZU5hbWUpO1xuICAgICAgICBpZiAob3duZWRUYXJnZXRDb2xsZWN0aW9uSWQpIHtcbiAgICAgICAgICBpZiAoZXZlbnRZZWFyICYmIG93bmVkQ29sbGVjdGlvbi5zaXRlcykge1xuICAgICAgICAgICAgbGV0IHNpdGVDb2xsZWN0aW9uID0gb3duZWRDb2xsZWN0aW9uLnNpdGVzW3RhcmdldFNpdGVOYW1lXTtcbiAgICAgICAgICAgIGxldCBjb2xsRGF0ZXMgPSBSQy5nZXRDb2xsZWN0aW9uRGF0ZXMob3duZWRDb2xsZWN0aW9uLCBzaXRlQ29sbGVjdGlvbik7XG5cbiAgICAgICAgICAgIGxldCBpc1llYXJJblJhbmdlID0gZmFsc2U7XG4gICAgICAgICAgICBpZiAoY29sbERhdGVzLmZyb20gJiYgY29sbERhdGVzLnRvKSB7XG4gICAgICAgICAgICAgIGlmIChldmVudFllYXIgPj0gY29sbERhdGVzLmZyb20gJiYgZXZlbnRZZWFyIDw9IGNvbGxEYXRlcy50bykge1xuICAgICAgICAgICAgICAgIGlzWWVhckluUmFuZ2UgPSB0cnVlO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGNvbGxEYXRlcy55ZWFyICYmIGNvbGxEYXRlcy55ZWFyID09IGV2ZW50WWVhcikge1xuICAgICAgICAgICAgICBpc1llYXJJblJhbmdlID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgbGV0IGlzQ291bnRyeU9LID0gZmFsc2U7XG4gICAgICAgICAgICBpZiAoc291cmNlQ291bnRyeSkge1xuICAgICAgICAgICAgICBpZiAob3duZWRDb2xsZWN0aW9uLmNvdW50cnkgPT0gc291cmNlQ291bnRyeSkge1xuICAgICAgICAgICAgICAgIGlzQ291bnRyeU9LID0gdHJ1ZTtcbiAgICAgICAgICAgICAgfSBlbHNlIGlmIChDRC5pc1BhcnRPZihzb3VyY2VDb3VudHJ5LCBvd25lZENvbGxlY3Rpb24uY291bnRyeSkpIHtcbiAgICAgICAgICAgICAgICBpc0NvdW50cnlPSyA9IHRydWU7XG4gICAgICAgICAgICAgIH0gZWxzZSBpZiAoQ0QuaXNQYXJ0T2Yob3duZWRDb2xsZWN0aW9uLmNvdW50cnksIHNvdXJjZUNvdW50cnkpKSB7XG4gICAgICAgICAgICAgICAgaXNDb3VudHJ5T0sgPSB0cnVlO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBpc0NvdW50cnlPSyA9IHRydWU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChpc1llYXJJblJhbmdlICYmIGlzQ291bnRyeU9LKSB7XG4gICAgICAgICAgICAgIHJldHVybiBvd25lZFRhcmdldENvbGxlY3Rpb25JZDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGVsc2UgaWYgKG93bmVkQ29sbGVjdGlvbi5jb3VudHJ5ID09IHNvdXJjZUNvdW50cnkpIHtcbiAgICAgICAgICAgIHJldHVybiBvd25lZFRhcmdldENvbGxlY3Rpb25JZDtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBpZiAoIWJlc3RNYXRjaENvbGxlY3Rpb24pIHtcbiAgICAgICAgICAgIGJlc3RNYXRjaENvbGxlY3Rpb24gPSBvd25lZENvbGxlY3Rpb247XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgICBpZiAoYmVzdE1hdGNoQ29sbGVjdGlvbikge1xuICAgICAgICBsZXQgYmVzdE1hdGNoQ29sbGVjdGlvbklkID0gUkMuZ2V0U2l0ZUlkRnJvbUNvbGxlY3Rpb24oYmVzdE1hdGNoQ29sbGVjdGlvbiwgdGFyZ2V0U2l0ZU5hbWUpO1xuICAgICAgICB0YXJnZXRDb2xsZWN0aW9uSWQgPSBiZXN0TWF0Y2hDb2xsZWN0aW9uSWQ7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiB0YXJnZXRDb2xsZWN0aW9uSWQ7XG4gIH0sXG4gIGdldFNpdGVJZEZyb21Db2xsZWN0aW9uOiBmdW5jdGlvbiAoY29sbGVjdGlvbiwgc2l0ZSkge1xuICAgIGlmIChjb2xsZWN0aW9uICYmIGNvbGxlY3Rpb24uc2l0ZXMgJiYgY29sbGVjdGlvbi5zaXRlc1tzaXRlXSkge1xuICAgICAgcmV0dXJuIGNvbGxlY3Rpb24uc2l0ZXNbc2l0ZV0uaWQ7XG4gICAgfVxuICB9LFxuICBnZXRDb3VudHJ5RnJvbUNvbGxlY3Rpb246IGZ1bmN0aW9uIChjb2xsZWN0aW9uKSB7XG4gICAgaWYgKGNvbGxlY3Rpb24pIHtcbiAgICAgIHJldHVybiBjb2xsZWN0aW9uLmNvdW50cnk7XG4gICAgfVxuICB9LFxuICBnZXRDb2xsZWN0aW9uRGF0ZXM6IGZ1bmN0aW9uIChjb2xsZWN0aW9uLCBzaXRlQ29sbGVjdGlvbikge1xuICAgIGxldCBjb2xsRGF0ZXMgPSBzaXRlQ29sbGVjdGlvbi5kYXRlcztcbiAgICBpZiAoIWNvbGxEYXRlcykge1xuICAgICAgY29sbERhdGVzID0gY29sbGVjdGlvbi5kYXRlcztcbiAgICAgIGlmICghY29sbERhdGVzKSB7XG4gICAgICAgIC8vY29uc29sZS5sb2coXCJyZXR1cm4gZmFsc2UsIG5vIGRhdGVzXCIpO1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmIChjb2xsZWN0aW9uLmRhdGVzKSB7XG4gICAgICAvLyB0aGVyZSBpcyBhIGRhdGVzIGZpZWxkIGluIGJvdGggdGhpcyBzaXRlcyBjb2xsZWN0aW9uIGRhdGEgYW5kIGluIHRoZSB3aG9sZSBjb2xsZWN0aW9uXG4gICAgICAvLyB3ZSBzaG91bGQgY29tYmluZSB0aGVtIHVzaW5nIHRoZSBzaXRlIG9uZSBhcyBwcmlvcml0eVxuICAgICAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgT2JqZWN0LmVudHJpZXMoY29sbGVjdGlvbi5kYXRlcykpIHtcbiAgICAgICAgaWYgKCFjb2xsRGF0ZXNba2V5XSkge1xuICAgICAgICAgIGNvbGxEYXRlc1trZXldID0gdmFsdWU7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gY29sbERhdGVzO1xuICB9LFxuICBhcmVTb3VyY2VEYXRlc0luQ29sbGVjdGlvblJhbmdlOiBmdW5jdGlvbiAoc291cmNlRGF0ZXMsIGNvbGxlY3Rpb24sIHNpdGVDb2xsZWN0aW9uKSB7XG4gICAgbGV0IGxpZmVTcGFuID0gMTIwO1xuICAgIGlmIChzb3VyY2VEYXRlcy5tYXhMaWZlc3Bhbikge1xuICAgICAgbGlmZVNwYW4gPSBzb3VyY2VEYXRlcy5tYXhMaWZlc3BhbjtcbiAgICB9XG5cbiAgICAvL2NvbnNvbGUubG9nKFwiYXJlU291cmNlRGF0ZXNJbkNvbGxlY3Rpb25SYW5nZSwgc291cmNlRGF0ZXMgYW5kIGNvbGxlY3Rpb246XCIpXG4gICAgLy9jb25zb2xlLmxvZyhzb3VyY2VEYXRlcyk7XG4gICAgLy9jb25zb2xlLmxvZyhjb2xsZWN0aW9uKTtcblxuICAgIGxldCBjb2xsRGF0ZXMgPSBSQy5nZXRDb2xsZWN0aW9uRGF0ZXMoY29sbGVjdGlvbiwgc2l0ZUNvbGxlY3Rpb24pO1xuXG4gICAgbGV0IGlzQmlydGhDb2xsZWN0aW9uID0gY29sbGVjdGlvbi5pc0JpcnRoO1xuICAgIGxldCBpc0RlYXRoQ29sbGVjdGlvbiA9IGNvbGxlY3Rpb24uaXNEZWF0aDtcblxuICAgIGxldCBiaXJ0aFllYXIgPSBwYXJzZUludChzb3VyY2VEYXRlcy5iaXJ0aFllYXIpO1xuICAgIGxldCBkZWF0aFllYXIgPSBwYXJzZUludChzb3VyY2VEYXRlcy5kZWF0aFllYXIpO1xuICAgIGxldCBldmVudFllYXIgPSBwYXJzZUludChzb3VyY2VEYXRlcy5ldmVudFllYXIpO1xuXG4gICAgbGV0IG1pblNvdXJjZVllYXIgPSBiaXJ0aFllYXI7XG4gICAgaWYgKCFtaW5Tb3VyY2VZZWFyKSB7XG4gICAgICBpZiAoZGVhdGhZZWFyKSB7XG4gICAgICAgIG1pblNvdXJjZVllYXIgPSBkZWF0aFllYXIgLSBsaWZlU3BhbjtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG1pblNvdXJjZVllYXIgPSBldmVudFllYXIgLSBsaWZlU3BhbjtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBsZXQgbWF4U291cmNlWWVhciA9IGRlYXRoWWVhcjtcbiAgICBpZiAoIW1heFNvdXJjZVllYXIpIHtcbiAgICAgIGlmIChiaXJ0aFllYXIpIHtcbiAgICAgICAgbWF4U291cmNlWWVhciA9IGJpcnRoWWVhciArIGxpZmVTcGFuO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbWF4U291cmNlWWVhciA9IGV2ZW50WWVhciArIGxpZmVTcGFuO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChpc0JpcnRoQ29sbGVjdGlvbiAmJiBiaXJ0aFllYXIpIHtcbiAgICAgIC8vIG11c3QgaGF2ZSBmcm9tIGFuZCB0byB5ZWFyc1xuICAgICAgbGV0IGZyb21ZZWFyID0gY29sbERhdGVzLmZyb207XG4gICAgICBsZXQgdG9ZZWFyID0gY29sbERhdGVzLnRvO1xuICAgICAgbGV0IGlzSW5SYW5nZSA9IGJpcnRoWWVhciArIDEgPj0gZnJvbVllYXIgJiYgYmlydGhZZWFyIDw9IHRvWWVhcjtcbiAgICAgIC8vY29uc29sZS5sb2coXCJyZXR1cm4gKGEpIDogXCIgKyBpc0luUmFuZ2UpO1xuICAgICAgcmV0dXJuIGlzSW5SYW5nZTtcbiAgICB9XG5cbiAgICBpZiAoaXNEZWF0aENvbGxlY3Rpb24gJiYgZGVhdGhZZWFyKSB7XG4gICAgICAvLyBtdXN0IGhhdmUgZnJvbSBhbmQgdG8geWVhcnNcbiAgICAgIGxldCBmcm9tWWVhciA9IGNvbGxEYXRlcy5mcm9tO1xuICAgICAgbGV0IHRvWWVhciA9IGNvbGxEYXRlcy50bztcbiAgICAgIGxldCBpc0luUmFuZ2UgPSBkZWF0aFllYXIgKyAxID49IGZyb21ZZWFyICYmIGRlYXRoWWVhciA8PSB0b1llYXI7XG4gICAgICAvL2NvbnNvbGUubG9nKFwicmV0dXJuIChiKSA6IFwiICsgaXNJblJhbmdlKTtcbiAgICAgIHJldHVybiBpc0luUmFuZ2U7XG4gICAgfVxuXG4gICAgaWYgKGNvbGxEYXRlcy55ZWFyKSB7XG4gICAgICBsZXQgY29sbFllYXIgPSBjb2xsRGF0ZXMueWVhcjtcbiAgICAgIGxldCBpc0luUmFuZ2UgPSBjb2xsWWVhciArIDIgPj0gbWluU291cmNlWWVhciAmJiBjb2xsWWVhciAtIDIgPD0gbWF4U291cmNlWWVhcjtcbiAgICAgIC8vY29uc29sZS5sb2coXCJyZXR1cm4gKGMpIDogXCIgKyBpc0luUmFuZ2UpO1xuICAgICAgcmV0dXJuIGlzSW5SYW5nZTtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gbXVzdCBoYXZlIGZyb20gYW5kIHRvIHllYXJzXG4gICAgICBsZXQgZnJvbVllYXIgPSBjb2xsRGF0ZXMuZnJvbTtcbiAgICAgIGxldCB0b1llYXIgPSBjb2xsRGF0ZXMudG87XG4gICAgICBsZXQgaXNJblJhbmdlID0gbWF4U291cmNlWWVhciA+PSBmcm9tWWVhciAmJiBtaW5Tb3VyY2VZZWFyIDw9IHRvWWVhcjtcbiAgICAgIC8vY29uc29sZS5sb2coXCJyZXR1cm4gKGQpIDogXCIgKyBpc0luUmFuZ2UpO1xuICAgICAgcmV0dXJuIGlzSW5SYW5nZTtcbiAgICB9XG5cbiAgICByZXR1cm4gZmFsc2U7XG4gIH0sXG4gIGFyZUFueUNvdW50cmllc0luQ29sbGVjdGlvblJhbmdlOiBmdW5jdGlvbiAoY291bnRyeUFycmF5LCBjb2xsZWN0aW9uKSB7XG4gICAgaWYgKCFjb3VudHJ5QXJyYXkpIHtcbiAgICAgIC8vY29uc29sZS5sb2coXCJhcmVBbnlDb3VudHJpZXNJbkNvbGxlY3Rpb25SYW5nZSwgbm8gY291bnRyaWVzXCIpXG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgLy9jb25zb2xlLmxvZyhcImFyZUFueUNvdW50cmllc0luQ29sbGVjdGlvblJhbmdlLCBjb3VudHJ5QXJyYXkgYW5kIGNvbGxlY3Rpb246XCIpXG4gICAgLy9jb25zb2xlLmxvZyhjb3VudHJ5QXJyYXkpO1xuICAgIC8vY29uc29sZS5sb2coY29sbGVjdGlvbik7XG5cbiAgICBsZXQgY29sbENvdW50cnkgPSBjb2xsZWN0aW9uLmNvdW50cnk7XG5cbiAgICBmb3IgKGxldCBjb3VudHJ5IG9mIGNvdW50cnlBcnJheSkge1xuICAgICAgaWYgKGNvdW50cnkgPT0gY29sbENvdW50cnkgfHwgQ0QuaXNQYXJ0T2YoY291bnRyeSwgY29sbENvdW50cnkpIHx8IENELmlzUGFydE9mKGNvbGxDb3VudHJ5LCBjb3VudHJ5KSkge1xuICAgICAgICAvL2NvbnNvbGUubG9nKFwicmV0dXJuIHRydWUsIGNvdW50cnkgPSBcIiArIGNvdW50cnkpO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIC8vY29uc29sZS5sb2coXCJjb3VudHJ5OiBcIiArIGNvdW50cnkgKyBcIiBpcyBub3QgZXF1aXZhbGVudCB0bzogXCIgKyBjb2xsQ291bnRyeSk7XG4gICAgfVxuICAgIC8vY29uc29sZS5sb2coXCJyZXR1cm4gZmFsc2VcIik7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9LFxuICBmaW5kQ29sbGVjdGlvbnNGb3JTaXRlV2l0aGluRGF0ZVJhbmdlQW5kQ291bnRyaWVzOiBmdW5jdGlvbiAoc2l0ZU5hbWUsIGRhdGVzLCBjb3VudHJ5QXJyYXkpIHtcbiAgICBsZXQgY29sbGVjdGlvbkFycmF5ID0gW107XG4gICAgZm9yIChsZXQgY29sbGVjdGlvbiBvZiBSZWNvcmRDb2xsZWN0aW9uRGF0YSkge1xuICAgICAgaWYgKGNvbGxlY3Rpb24uc2l0ZXMpIHtcbiAgICAgICAgbGV0IHNpdGVDb2xsZWN0aW9uID0gY29sbGVjdGlvbi5zaXRlc1tzaXRlTmFtZV07XG4gICAgICAgIGlmIChzaXRlQ29sbGVjdGlvbikge1xuICAgICAgICAgIGlmIChSQy5hcmVTb3VyY2VEYXRlc0luQ29sbGVjdGlvblJhbmdlKGRhdGVzLCBjb2xsZWN0aW9uLCBzaXRlQ29sbGVjdGlvbikpIHtcbiAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgIWNvdW50cnlBcnJheSB8fFxuICAgICAgICAgICAgICBjb3VudHJ5QXJyYXkubGVuZ3RoID09IDAgfHxcbiAgICAgICAgICAgICAgUkMuYXJlQW55Q291bnRyaWVzSW5Db2xsZWN0aW9uUmFuZ2UoY291bnRyeUFycmF5LCBjb2xsZWN0aW9uKVxuICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgIGNvbGxlY3Rpb25BcnJheS5wdXNoKGNvbGxlY3Rpb24pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gY29sbGVjdGlvbkFycmF5O1xuICB9LFxuICBnZXRGaWVsZEZyb21Db2xsZWN0aW9uT3JPd25pbmdDb2xsZWN0aW9uczogZnVuY3Rpb24gKGNvbGxlY3Rpb24sIGZpZWxkTmFtZSkge1xuICAgIGlmIChjb2xsZWN0aW9uW2ZpZWxkTmFtZV0gIT0gdW5kZWZpbmVkKSB7XG4gICAgICByZXR1cm4gY29sbGVjdGlvbltmaWVsZE5hbWVdO1xuICAgIH1cblxuICAgIGlmIChjb2xsZWN0aW9uLnBhcnRPZiAmJiBjb2xsZWN0aW9uLnBhcnRPZi5sZW5ndGggPiAwKSB7XG4gICAgICBmb3IgKGxldCBvd25pbmdDb2xsZWN0aW9uV3RzSWQgb2YgY29sbGVjdGlvbi5wYXJ0T2YpIHtcbiAgICAgICAgbGV0IG93bmluZ0NvbGxlY3Rpb24gPSBSQy5maW5kQ29sbGVjdGlvbkJ5V3RzSWQob3duaW5nQ29sbGVjdGlvbld0c0lkKTtcbiAgICAgICAgbGV0IGZpZWxkVmFsdWUgPSBSQy5nZXRGaWVsZEZyb21Db2xsZWN0aW9uT3JPd25pbmdDb2xsZWN0aW9ucyhvd25pbmdDb2xsZWN0aW9uLCBmaWVsZE5hbWUpO1xuICAgICAgICBpZiAoZmllbGRWYWx1ZSAhPSB1bmRlZmluZWQpIHtcbiAgICAgICAgICByZXR1cm4gZmllbGRWYWx1ZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH0sXG59O1xuXG5leHBvcnQgeyBSQyB9O1xuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./extension/base/core/record_collections.mjs\n");

/***/ }),

/***/ "./extension/base/core/record_type.mjs":
/*!*********************************************!*\
  !*** ./extension/base/core/record_type.mjs ***!
  \*********************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"RT\": () => (/* binding */ RT),\n/* harmony export */   \"RecordSubtype\": () => (/* binding */ RecordSubtype),\n/* harmony export */   \"Role\": () => (/* binding */ Role)\n/* harmony export */ });\n/*\nMIT License\n\nCopyright (c) 2020 Robert M Pavey\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.\n*/\n\n// NOTE: If a new record type is added the rtToRefTitle object in popup_menu_building should also be updated\n// Also getRefTitle in generalize_data_utils\nconst RT = {\n  Unclassified: `Unclassified`,\n  BirthRegistration: `BirthRegistration`,\n  Birth: `Birth`, // not a birth registration or a baptism (could be Quaker record for example)\n  MarriageRegistration: `MarriageRegistration`,\n  DeathRegistration: `DeathRegistration`,\n  Death: `Death`,\n  Baptism: `Baptism`,\n  Marriage: `Marriage`,\n  Burial: `Burial`,\n  Cremation: `Cremation`,\n  BirthOrBaptism: `BirthOrBaptism`,\n  DeathOrBurial: `DeathOrBurial`,\n  Census: `Census`,\n  NonpopulationCensus: `NonpopulationCensus`,\n  ElectoralRegister: `ElectoralRegister`,\n  Probate: `Probate`,\n  Will: `Will`,\n  Divorce: `Divorce`,\n  Memorial: `Memorial`,\n\n  CriminalRegister: `CriminalRegister`,\n  FreemasonMembership: `FreemasonMembership`,\n  Directory: `Directory`,\n  Employment: `Employment`,\n  WorkhouseRecord: `WorkhouseRecord`,\n  CrewList: `CrewList`,\n  PassengerList: `PassengerList`,\n  ConvictTransportation: `ConvictTransportation`,\n  Military: `Military`,\n  MedicalPatient: `MedicalPatient`,\n  QuarterSession: `QuarterSession`,\n  LandTax: `LandTax`,\n  Tax: `Tax`,\n  ValuationRoll: `ValuationRoll`,\n  Apprenticeship: `Apprenticeship`,\n  Certificate: `Certificate`,\n  SocialSecurity: `SocialSecurity`,\n  SchoolRecords: `SchoolRecords`,\n  Residence: `Residence`,\n  Obituary: `Obituary`,\n  Immigration: `Immigration`,\n  Emigration: `Emigration`,\n  Naturalization: `Naturalization`,\n  Pension: `Pension`,\n  PassportApplication: `PassportApplication`,\n  Newspaper: `Newspaper`,\n  LegalRecord: `LegalRecord`,\n  RateBook: `RateBook`,\n  FamHistOrPedigree: `FamHistOrPedigree`,\n  OtherChurchEvent: `OtherChurchEvent`, // other than baptism, marriage, burial etc. e.g. Confirmation, Seat Rents\n  Heraldry: `Heraldry`,\n};\n\nconst RecordSubtype = {\n  Banns: `Banns`,\n  MarriageOrBanns: `MarriageOrBanns`,\n};\n\nconst Role = {\n  Primary: `Primary`,\n  Parent: `Parent`,\n  Child: `Child`,\n  Sibling: `Sibling`,\n  Spouse: `Spouse`,\n  Witness: `Witness`,\n};\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9leHRlbnNpb24vYmFzZS9jb3JlL3JlY29yZF90eXBlLm1qcy5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVtQyIsInNvdXJjZXMiOlsid2VicGFjazovL0NpdGF0aW9uRXh0cmFjdG9yLy4vZXh0ZW5zaW9uL2Jhc2UvY29yZS9yZWNvcmRfdHlwZS5tanM/N2M3ZCJdLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuTUlUIExpY2Vuc2VcblxuQ29weXJpZ2h0IChjKSAyMDIwIFJvYmVydCBNIFBhdmV5XG5cblBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHlcbm9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlIFwiU29mdHdhcmVcIiksIHRvIGRlYWxcbmluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHNcbnRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGxcbmNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQgcGVyc29ucyB0byB3aG9tIHRoZSBTb2Z0d2FyZSBpc1xuZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczpcblxuVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW4gYWxsXG5jb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLlxuXG5USEUgU09GVFdBUkUgSVMgUFJPVklERUQgXCJBUyBJU1wiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SXG5JTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSxcbkZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRVxuQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUlxuTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSxcbk9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4gVEhFXG5TT0ZUV0FSRS5cbiovXG5cbi8vIE5PVEU6IElmIGEgbmV3IHJlY29yZCB0eXBlIGlzIGFkZGVkIHRoZSBydFRvUmVmVGl0bGUgb2JqZWN0IGluIHBvcHVwX21lbnVfYnVpbGRpbmcgc2hvdWxkIGFsc28gYmUgdXBkYXRlZFxuLy8gQWxzbyBnZXRSZWZUaXRsZSBpbiBnZW5lcmFsaXplX2RhdGFfdXRpbHNcbmNvbnN0IFJUID0ge1xuICBVbmNsYXNzaWZpZWQ6IGBVbmNsYXNzaWZpZWRgLFxuICBCaXJ0aFJlZ2lzdHJhdGlvbjogYEJpcnRoUmVnaXN0cmF0aW9uYCxcbiAgQmlydGg6IGBCaXJ0aGAsIC8vIG5vdCBhIGJpcnRoIHJlZ2lzdHJhdGlvbiBvciBhIGJhcHRpc20gKGNvdWxkIGJlIFF1YWtlciByZWNvcmQgZm9yIGV4YW1wbGUpXG4gIE1hcnJpYWdlUmVnaXN0cmF0aW9uOiBgTWFycmlhZ2VSZWdpc3RyYXRpb25gLFxuICBEZWF0aFJlZ2lzdHJhdGlvbjogYERlYXRoUmVnaXN0cmF0aW9uYCxcbiAgRGVhdGg6IGBEZWF0aGAsXG4gIEJhcHRpc206IGBCYXB0aXNtYCxcbiAgTWFycmlhZ2U6IGBNYXJyaWFnZWAsXG4gIEJ1cmlhbDogYEJ1cmlhbGAsXG4gIENyZW1hdGlvbjogYENyZW1hdGlvbmAsXG4gIEJpcnRoT3JCYXB0aXNtOiBgQmlydGhPckJhcHRpc21gLFxuICBEZWF0aE9yQnVyaWFsOiBgRGVhdGhPckJ1cmlhbGAsXG4gIENlbnN1czogYENlbnN1c2AsXG4gIE5vbnBvcHVsYXRpb25DZW5zdXM6IGBOb25wb3B1bGF0aW9uQ2Vuc3VzYCxcbiAgRWxlY3RvcmFsUmVnaXN0ZXI6IGBFbGVjdG9yYWxSZWdpc3RlcmAsXG4gIFByb2JhdGU6IGBQcm9iYXRlYCxcbiAgV2lsbDogYFdpbGxgLFxuICBEaXZvcmNlOiBgRGl2b3JjZWAsXG4gIE1lbW9yaWFsOiBgTWVtb3JpYWxgLFxuXG4gIENyaW1pbmFsUmVnaXN0ZXI6IGBDcmltaW5hbFJlZ2lzdGVyYCxcbiAgRnJlZW1hc29uTWVtYmVyc2hpcDogYEZyZWVtYXNvbk1lbWJlcnNoaXBgLFxuICBEaXJlY3Rvcnk6IGBEaXJlY3RvcnlgLFxuICBFbXBsb3ltZW50OiBgRW1wbG95bWVudGAsXG4gIFdvcmtob3VzZVJlY29yZDogYFdvcmtob3VzZVJlY29yZGAsXG4gIENyZXdMaXN0OiBgQ3Jld0xpc3RgLFxuICBQYXNzZW5nZXJMaXN0OiBgUGFzc2VuZ2VyTGlzdGAsXG4gIENvbnZpY3RUcmFuc3BvcnRhdGlvbjogYENvbnZpY3RUcmFuc3BvcnRhdGlvbmAsXG4gIE1pbGl0YXJ5OiBgTWlsaXRhcnlgLFxuICBNZWRpY2FsUGF0aWVudDogYE1lZGljYWxQYXRpZW50YCxcbiAgUXVhcnRlclNlc3Npb246IGBRdWFydGVyU2Vzc2lvbmAsXG4gIExhbmRUYXg6IGBMYW5kVGF4YCxcbiAgVGF4OiBgVGF4YCxcbiAgVmFsdWF0aW9uUm9sbDogYFZhbHVhdGlvblJvbGxgLFxuICBBcHByZW50aWNlc2hpcDogYEFwcHJlbnRpY2VzaGlwYCxcbiAgQ2VydGlmaWNhdGU6IGBDZXJ0aWZpY2F0ZWAsXG4gIFNvY2lhbFNlY3VyaXR5OiBgU29jaWFsU2VjdXJpdHlgLFxuICBTY2hvb2xSZWNvcmRzOiBgU2Nob29sUmVjb3Jkc2AsXG4gIFJlc2lkZW5jZTogYFJlc2lkZW5jZWAsXG4gIE9iaXR1YXJ5OiBgT2JpdHVhcnlgLFxuICBJbW1pZ3JhdGlvbjogYEltbWlncmF0aW9uYCxcbiAgRW1pZ3JhdGlvbjogYEVtaWdyYXRpb25gLFxuICBOYXR1cmFsaXphdGlvbjogYE5hdHVyYWxpemF0aW9uYCxcbiAgUGVuc2lvbjogYFBlbnNpb25gLFxuICBQYXNzcG9ydEFwcGxpY2F0aW9uOiBgUGFzc3BvcnRBcHBsaWNhdGlvbmAsXG4gIE5ld3NwYXBlcjogYE5ld3NwYXBlcmAsXG4gIExlZ2FsUmVjb3JkOiBgTGVnYWxSZWNvcmRgLFxuICBSYXRlQm9vazogYFJhdGVCb29rYCxcbiAgRmFtSGlzdE9yUGVkaWdyZWU6IGBGYW1IaXN0T3JQZWRpZ3JlZWAsXG4gIE90aGVyQ2h1cmNoRXZlbnQ6IGBPdGhlckNodXJjaEV2ZW50YCwgLy8gb3RoZXIgdGhhbiBiYXB0aXNtLCBtYXJyaWFnZSwgYnVyaWFsIGV0Yy4gZS5nLiBDb25maXJtYXRpb24sIFNlYXQgUmVudHNcbiAgSGVyYWxkcnk6IGBIZXJhbGRyeWAsXG59O1xuXG5jb25zdCBSZWNvcmRTdWJ0eXBlID0ge1xuICBCYW5uczogYEJhbm5zYCxcbiAgTWFycmlhZ2VPckJhbm5zOiBgTWFycmlhZ2VPckJhbm5zYCxcbn07XG5cbmNvbnN0IFJvbGUgPSB7XG4gIFByaW1hcnk6IGBQcmltYXJ5YCxcbiAgUGFyZW50OiBgUGFyZW50YCxcbiAgQ2hpbGQ6IGBDaGlsZGAsXG4gIFNpYmxpbmc6IGBTaWJsaW5nYCxcbiAgU3BvdXNlOiBgU3BvdXNlYCxcbiAgV2l0bmVzczogYFdpdG5lc3NgLFxufTtcblxuZXhwb3J0IHsgUlQsIFJlY29yZFN1YnR5cGUsIFJvbGUgfTtcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./extension/base/core/record_type.mjs\n");

/***/ }),

/***/ "./extension/base/core/wts_date.mjs":
/*!******************************************!*\
  !*** ./extension/base/core/wts_date.mjs ***!
  \******************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"WTS_Date\": () => (/* binding */ WTS_Date)\n/* harmony export */ });\n/*\nMIT License\n\nCopyright (c) 2020 Robert M Pavey\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.\n*/\n\nconst threeLetterMonths = [\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"May\", \"Jun\", \"Jul\", \"Aug\", \"Sep\", \"Oct\", \"Nov\", \"Dec\"];\n\nconst fullMonths = [\n  \"January\",\n  \"February\",\n  \"March\",\n  \"April\",\n  \"May\",\n  \"June\",\n  \"July\",\n  \"August\",\n  \"September\",\n  \"October\",\n  \"November\",\n  \"December\",\n];\n\nconst WTS_Date = {\n  monthStringToMonthNum: function (string) {\n    if (!string || string.length < 1) {\n      return 0;\n    }\n\n    let months = fullMonths;\n    if (string.length == 3) {\n      months = threeLetterMonths;\n    }\n\n    let lcString = string.toLowerCase();\n    for (let monthIndex = 0; monthIndex < threeLetterMonths.length; monthIndex++) {\n      if (lcString == months[monthIndex].toLowerCase()) {\n        return monthIndex + 1;\n      }\n    }\n\n    return 0;\n  },\n\n  // This returns a parsed data object\n  parseDateString: function (string) {\n    let result = {\n      inputString: string,\n      dayNum: 0,\n      monthNum: 0,\n      yearNum: 0,\n      hasDay: false,\n      hasMonth: false,\n      isValid: false,\n    };\n\n    if (!string || string.length == 0) {\n      return result;\n    }\n\n    if (typeof string !== \"string\") {\n      return result;\n    }\n\n    // clean and trim the date string, this has usually been done already but being defensive\n    let cleanString = string.replace(/\\s+/g, \" \").trim();\n    if (cleanString.length == 0) {\n      return result;\n    }\n\n    result.cleanString = cleanString;\n\n    if (string.length <= 4) {\n      // it can only be a year\n      let nonDigitIndex = cleanString.search(/[^0-9]/);\n      if (nonDigitIndex == -1 && cleanString.length == 4) {\n        let yearNum = parseInt(cleanString);\n        if (!isNaN(yearNum)) {\n          result.isValid = true;\n          result.yearNum = yearNum;\n        }\n      }\n\n      return result;\n    }\n\n    // check for a year range\n    if (/^\\d\\d\\d\\d\\-\\d\\d\\d\\d$/.test(cleanString) || /^\\d\\d\\d\\d\\-\\d\\d$/.test(cleanString)) {\n      // it is a year range,\n      let startYearString = cleanString.substring(0, 4);\n      let endYearString = cleanString.substring(5);\n      if (endYearString.length == 2) {\n        endYearString = startYearString.substring(0, 2) + endYearString;\n      }\n\n      let startYearNum = parseInt(startYearString);\n      let endYearNum = parseInt(endYearString);\n      if (isNaN(startYearNum) || isNaN(endYearNum)) {\n        return result;\n      }\n\n      result.isRange = true;\n      result.isValid = true;\n      result.startYearNum = startYearNum;\n      result.endYearNum = endYearNum;\n      result.yearNum = startYearNum;\n      return result;\n    }\n\n    // it is longer than 4 digits. The most common formats would be:\n    // dd mmm yyyy\n    // mmm yyyy\n    if (/^\\d\\d? [a-zA-Z][a-zA-Z][a-zA-Z] \\d\\d\\d\\d$/.test(cleanString)) {\n      let firstSpaceIndex = cleanString.indexOf(\" \");\n      let lastSpaceIndex = cleanString.lastIndexOf(\" \");\n      let dayString = cleanString.substring(0, firstSpaceIndex);\n      let monthString = cleanString.substring(firstSpaceIndex + 1, lastSpaceIndex);\n      let yearString = cleanString.substring(lastSpaceIndex + 1);\n      let dayNum = parseInt(dayString);\n      if (isNaN(dayNum) || !dayNum) {\n        return result;\n      }\n      let yearNum = parseInt(yearString);\n      if (isNaN(yearNum) || !yearNum) {\n        return result;\n      }\n      let monthNum = WTS_Date.monthStringToMonthNum(monthString);\n      if (monthNum == 0) {\n        return result;\n      }\n      result.dayNum = dayNum;\n      result.monthNum = monthNum;\n      result.yearNum = yearNum;\n      result.hasDay = true;\n      result.hasMonth = true;\n      result.isValid = true;\n      return result;\n    } else if (/^[a-zA-Z][a-zA-Z][a-zA-Z] \\d\\d\\d\\d$/.test(cleanString)) {\n      let firstSpaceIndex = cleanString.indexOf(\" \");\n      let monthString = cleanString.substring(0, firstSpaceIndex);\n      let yearString = cleanString.substring(firstSpaceIndex + 1);\n      let yearNum = parseInt(yearString);\n      if (isNaN(yearNum) || !yearNum) {\n        return result;\n      }\n      let monthNum = WTS_Date.monthStringToMonthNum(monthString);\n      if (monthNum == 0) {\n        return result;\n      }\n      result.monthNum = monthNum;\n      result.yearNum = yearNum;\n      result.hasMonth = true;\n      result.isValid = true;\n      return result;\n    }\n\n    // Did not match the common formats, try less common ones\n    if (/^\\d\\d? [a-zA-Z]+ \\d\\d\\d\\d$/.test(cleanString)) {\n      let firstSpaceIndex = cleanString.indexOf(\" \");\n      let lastSpaceIndex = cleanString.lastIndexOf(\" \");\n      let dayString = cleanString.substring(0, firstSpaceIndex);\n      let monthString = cleanString.substring(firstSpaceIndex + 1, lastSpaceIndex);\n      let yearString = cleanString.substring(lastSpaceIndex + 1);\n      let dayNum = parseInt(dayString);\n      if (isNaN(dayNum) || !dayNum) {\n        return result;\n      }\n      let yearNum = parseInt(yearString);\n      if (isNaN(yearNum) || !yearNum) {\n        return result;\n      }\n      let monthNum = WTS_Date.monthStringToMonthNum(monthString);\n      if (monthNum == 0) {\n        return result;\n      }\n      result.dayNum = dayNum;\n      result.monthNum = monthNum;\n      result.yearNum = yearNum;\n      result.hasDay = true;\n      result.hasMonth = true;\n      result.isValid = true;\n      return result;\n    }\n\n    // Not sure the format June 12, 1960 is ever used. WikiTree docs say it can be\n    if (/^[a-zA-Z]+ \\d\\d?\\, \\d\\d\\d\\d$/.test(cleanString)) {\n      let firstSpaceIndex = cleanString.indexOf(\" \");\n      let lastSpaceIndex = cleanString.lastIndexOf(\" \");\n      let commaIndex = cleanString.indexOf(\",\");\n      let monthString = cleanString.substring(0, firstSpaceIndex);\n      let dayString = cleanString.substring(firstSpaceIndex + 1, commaIndex);\n      let yearString = cleanString.substring(lastSpaceIndex + 1);\n      let dayNum = parseInt(dayString);\n      if (isNaN(dayNum) || !dayNum) {\n        return result;\n      }\n      let yearNum = parseInt(yearString);\n      if (isNaN(yearNum) || !yearNum) {\n        return result;\n      }\n      let monthNum = WTS_Date.monthStringToMonthNum(monthString);\n      if (monthNum == 0) {\n        return result;\n      }\n      result.dayNum = dayNum;\n      result.monthNum = monthNum;\n      result.yearNum = yearNum;\n      result.hasDay = true;\n      result.hasMonth = true;\n      result.isValid = true;\n      return result;\n    }\n\n    // Sometimes we can get a date like: 27Aug1849\n    // e.g.: https://www.familysearch.org/ark:/61903/1:1:27CB-J49\n    if (/^\\d\\d?[a-zA-Z]+\\d\\d\\d\\d$/.test(cleanString)) {\n      let firstLetterIndex = cleanString.search(/[a-zA-Z]/);\n      if (firstLetterIndex == -1) {\n        return result;\n      }\n      let dayString = cleanString.substring(0, firstLetterIndex);\n      let remainder = cleanString.substring(firstLetterIndex);\n\n      let yearIndex = remainder.search(/\\d/);\n      if (yearIndex == -1) {\n        return result;\n      }\n      let monthString = remainder.substring(0, yearIndex);\n      let yearString = remainder.substring(yearIndex);\n\n      let dayNum = parseInt(dayString);\n      if (isNaN(dayNum) || !dayNum) {\n        return result;\n      }\n      let yearNum = parseInt(yearString);\n      if (isNaN(yearNum) || !yearNum) {\n        return result;\n      }\n      let monthNum = WTS_Date.monthStringToMonthNum(monthString);\n      if (monthNum == 0) {\n        return result;\n      }\n      result.dayNum = dayNum;\n      result.monthNum = monthNum;\n      result.yearNum = yearNum;\n      result.hasDay = true;\n      result.hasMonth = true;\n      result.isValid = true;\n      return result;\n    }\n    // Sometimes we can get a date like: July 1852 or Jul 1852\n    if (/[a-zA-Z]+\\s+\\d\\d\\d\\d$/.test(cleanString)) {\n      let remainder = cleanString;\n\n      let yearIndex = remainder.search(/\\d/);\n      if (yearIndex == -1) {\n        return result;\n      }\n      let monthString = remainder.substring(0, yearIndex).trim();\n      let yearString = remainder.substring(yearIndex).trim();\n\n      let yearNum = parseInt(yearString);\n      if (isNaN(yearNum) || !yearNum) {\n        return result;\n      }\n      let monthNum = WTS_Date.monthStringToMonthNum(monthString);\n      if (monthNum == 0) {\n        return result;\n      }\n      result.monthNum = monthNum;\n      result.yearNum = yearNum;\n      result.hasMonth = true;\n      result.isValid = true;\n      return result;\n    }\n\n    console.log(\"Unusual date format: \" + cleanString);\n\n    return result;\n  },\n\n  getStdDateString: function (parsedDate, monthStrings) {\n    let string = \"\";\n    if (!parsedDate.isValid) {\n      return string;\n    }\n\n    if (parsedDate.isRange) {\n      return parsedDate.startYearNum.toString() + \"-\" + parsedDate.endYearNum.toString();\n    }\n\n    if (parsedDate.hasDay) {\n      string += parsedDate.dayNum.toString() + \" \";\n    }\n    if (parsedDate.hasMonth) {\n      string += monthStrings[parsedDate.monthNum - 1] + \" \";\n    }\n    string += parsedDate.yearNum.toString();\n    return string;\n  },\n\n  getStdShortFormDateString: function (parsedDate) {\n    return WTS_Date.getStdDateString(parsedDate, threeLetterMonths);\n  },\n\n  getStdLongFormDateString: function (parsedDate) {\n    return WTS_Date.getStdDateString(parsedDate, fullMonths);\n  },\n\n  getUsLongFormDateString: function (parsedDate) {\n    if (!parsedDate.hasDay || !parsedDate.hasMonth || parsedDate.isRange) {\n      return WTS_Date.getStdDateString(parsedDate, fullMonths);\n    }\n\n    let string = fullMonths[parsedDate.monthNum - 1] + \" \" + parsedDate.dayNum.toString();\n    string += \", \" + parsedDate.yearNum.toString();\n    return string;\n  },\n\n  getDayNumberNthString: function (dayNum) {\n    let dayString = dayNum.toString();\n    if (!dayString) {\n      return \"\";\n    }\n\n    // account for 11th, 12th, 111th, 213th etc (not that dates get that big!)\n    let isTeen = false;\n    if (dayString.length >= 2) {\n      if (dayString[dayString.length - 2] == \"1\") {\n        isTeen = true;\n      }\n    }\n\n    if (isTeen) {\n      dayString += \"th\";\n    } else {\n      let lastDigit = dayString[dayString.length - 1];\n      if (lastDigit == \"1\") {\n        dayString += \"st\";\n      } else if (lastDigit == \"2\") {\n        dayString += \"nd\";\n      } else if (lastDigit == \"3\") {\n        dayString += \"rd\";\n      } else {\n        dayString += \"th\";\n      }\n    }\n\n    return dayString;\n  },\n\n  getStdNthFormDateString: function (parsedDate) {\n    if (!parsedDate.hasDay || !parsedDate.hasMonth || parsedDate.isRange) {\n      return WTS_Date.getStdDateString(parsedDate, fullMonths);\n    }\n\n    let dayString = WTS_Date.getDayNumberNthString(parsedDate.dayNum);\n    if (!dayString) {\n      return WTS_Date.getStdDateString(parsedDate, fullMonths);\n    }\n\n    let string = \"the \" + dayString + \" of \" + fullMonths[parsedDate.monthNum - 1];\n    string += \" \" + parsedDate.yearNum.toString();\n    return string;\n  },\n\n  getUsNthFormDateString: function (parsedDate) {\n    if (!parsedDate.hasDay || !parsedDate.hasMonth || parsedDate.isRange) {\n      return WTS_Date.getStdDateString(parsedDate, fullMonths);\n    }\n\n    let dayString = WTS_Date.getDayNumberNthString(parsedDate.dayNum);\n    if (!dayString) {\n      return WTS_Date.getStdDateString(parsedDate, fullMonths);\n    }\n\n    let string = fullMonths[parsedDate.monthNum - 1] + \" \" + dayString;\n    string += \", \" + parsedDate.yearNum.toString();\n    return string;\n  },\n\n  getParsedDateInDays: function (parsedDate) {\n    if (!parsedDate.isValid) {\n      return 0;\n    }\n\n    let days = parsedDate.yearNum * 365;\n    // this is very simplified - currently we don't care about num days in month or leap years\n    if (parsedDate.hasMonth) {\n      days += (parsedDate.monthNum - 1) * 30;\n    }\n    if (parsedDate.hasDay) {\n      days += parsedDate.dayNum - 1;\n    }\n\n    return days;\n  },\n\n  getWholeYearsBetweenDateStrings: function (dateString1, dateString2) {\n    let parsedDate1 = WTS_Date.parseDateString(dateString1);\n    let parsedDate2 = WTS_Date.parseDateString(dateString2);\n\n    if (!parsedDate1.isValid || !parsedDate2.isValid) {\n      return 0;\n    }\n\n    let date1Days = WTS_Date.getParsedDateInDays(parsedDate1);\n    let date2Days = WTS_Date.getParsedDateInDays(parsedDate2);\n\n    let diffInDays = date2Days - date1Days;\n    return Math.floor(diffInDays / 365);\n  },\n\n  getDaysBetweenParsedDates: function (parsedDate1, parsedDate2) {\n    if (!parsedDate1.isValid || !parsedDate2.isValid) {\n      return 0;\n    }\n\n    let date1Days = WTS_Date.getParsedDateInDays(parsedDate1);\n    let date2Days = WTS_Date.getParsedDateInDays(parsedDate2);\n\n    let diffInDays = date2Days - date1Days;\n    return diffInDays;\n  },\n\n  getDaysBetweenDateStrings: function (dateString1, dateString2) {\n    let parsedDate1 = WTS_Date.parseDateString(dateString1);\n    let parsedDate2 = WTS_Date.parseDateString(dateString2);\n\n    return WTS_Date.getDaysBetweenParsedDates(parsedDate1, parsedDate2);\n  },\n\n  getYearNumFromYearString: function (yearString) {\n    if (!yearString) {\n      return undefined;\n    }\n\n    let yearNum = parseInt(yearString);\n    if (isNaN(yearNum) || yearNum == 0) {\n      return undefined;\n    }\n\n    return yearNum;\n  },\n\n  getQuarterNumFromQuarterString: function (quarterString) {\n    if (!quarterString) {\n      return undefined;\n    }\n\n    if (!isNaN(quarterString)) {\n      return quarterString; // already a number\n    }\n\n    let quarterNum = parseInt(quarterString);\n    if (isNaN(quarterNum) || quarterNum == 0) {\n      return undefined;\n    }\n\n    return quarterNum;\n  },\n\n  getDateStringFromYearMonthDay: function (year, month, day) {\n    let dateString = \"\";\n    if (day) {\n      dateString += day;\n    }\n    if (month) {\n      let monthString = month;\n      if (/^\\d+$/.test(month)) {\n        let monthNum = parseInt(month);\n        if (!isNaN(monthNum)) {\n          if (monthNum >= 1 && monthNum <= 12) {\n            monthString = threeLetterMonths[monthNum - 1];\n          }\n        }\n      }\n\n      if (dateString) {\n        dateString += \" \";\n      }\n      dateString += monthString;\n    }\n    if (year) {\n      if (dateString) {\n        dateString += \" \";\n      }\n      dateString += year;\n    }\n\n    return dateString;\n  },\n};\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9leHRlbnNpb24vYmFzZS9jb3JlL3d0c19kYXRlLm1qcy5qcyIsIm1hcHBpbmdzIjoiOzs7O0FBQUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLDZCQUE2Qix1Q0FBdUM7QUFDcEU7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0EsUUFBUTtBQUNSO0FBQ0EsUUFBUTtBQUNSO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsNEJBQTRCO0FBQzVCOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLEdBQUc7QUFDSDs7QUFFb0IiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9DaXRhdGlvbkV4dHJhY3Rvci8uL2V4dGVuc2lvbi9iYXNlL2NvcmUvd3RzX2RhdGUubWpzPzU1NjIiXSwic291cmNlc0NvbnRlbnQiOlsiLypcbk1JVCBMaWNlbnNlXG5cbkNvcHlyaWdodCAoYykgMjAyMCBSb2JlcnQgTSBQYXZleVxuXG5QZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYSBjb3B5XG5vZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSBcIlNvZnR3YXJlXCIpLCB0byBkZWFsXG5pbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzXG50byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsXG5jb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXNcbmZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6XG5cblRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkIGluIGFsbFxuY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS5cblxuVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEIFwiQVMgSVNcIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUlxuSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksXG5GSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEVcbkFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVJcbkxJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sXG5PVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOIFRIRVxuU09GVFdBUkUuXG4qL1xuXG5jb25zdCB0aHJlZUxldHRlck1vbnRocyA9IFtcIkphblwiLCBcIkZlYlwiLCBcIk1hclwiLCBcIkFwclwiLCBcIk1heVwiLCBcIkp1blwiLCBcIkp1bFwiLCBcIkF1Z1wiLCBcIlNlcFwiLCBcIk9jdFwiLCBcIk5vdlwiLCBcIkRlY1wiXTtcblxuY29uc3QgZnVsbE1vbnRocyA9IFtcbiAgXCJKYW51YXJ5XCIsXG4gIFwiRmVicnVhcnlcIixcbiAgXCJNYXJjaFwiLFxuICBcIkFwcmlsXCIsXG4gIFwiTWF5XCIsXG4gIFwiSnVuZVwiLFxuICBcIkp1bHlcIixcbiAgXCJBdWd1c3RcIixcbiAgXCJTZXB0ZW1iZXJcIixcbiAgXCJPY3RvYmVyXCIsXG4gIFwiTm92ZW1iZXJcIixcbiAgXCJEZWNlbWJlclwiLFxuXTtcblxuY29uc3QgV1RTX0RhdGUgPSB7XG4gIG1vbnRoU3RyaW5nVG9Nb250aE51bTogZnVuY3Rpb24gKHN0cmluZykge1xuICAgIGlmICghc3RyaW5nIHx8IHN0cmluZy5sZW5ndGggPCAxKSB7XG4gICAgICByZXR1cm4gMDtcbiAgICB9XG5cbiAgICBsZXQgbW9udGhzID0gZnVsbE1vbnRocztcbiAgICBpZiAoc3RyaW5nLmxlbmd0aCA9PSAzKSB7XG4gICAgICBtb250aHMgPSB0aHJlZUxldHRlck1vbnRocztcbiAgICB9XG5cbiAgICBsZXQgbGNTdHJpbmcgPSBzdHJpbmcudG9Mb3dlckNhc2UoKTtcbiAgICBmb3IgKGxldCBtb250aEluZGV4ID0gMDsgbW9udGhJbmRleCA8IHRocmVlTGV0dGVyTW9udGhzLmxlbmd0aDsgbW9udGhJbmRleCsrKSB7XG4gICAgICBpZiAobGNTdHJpbmcgPT0gbW9udGhzW21vbnRoSW5kZXhdLnRvTG93ZXJDYXNlKCkpIHtcbiAgICAgICAgcmV0dXJuIG1vbnRoSW5kZXggKyAxO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiAwO1xuICB9LFxuXG4gIC8vIFRoaXMgcmV0dXJucyBhIHBhcnNlZCBkYXRhIG9iamVjdFxuICBwYXJzZURhdGVTdHJpbmc6IGZ1bmN0aW9uIChzdHJpbmcpIHtcbiAgICBsZXQgcmVzdWx0ID0ge1xuICAgICAgaW5wdXRTdHJpbmc6IHN0cmluZyxcbiAgICAgIGRheU51bTogMCxcbiAgICAgIG1vbnRoTnVtOiAwLFxuICAgICAgeWVhck51bTogMCxcbiAgICAgIGhhc0RheTogZmFsc2UsXG4gICAgICBoYXNNb250aDogZmFsc2UsXG4gICAgICBpc1ZhbGlkOiBmYWxzZSxcbiAgICB9O1xuXG4gICAgaWYgKCFzdHJpbmcgfHwgc3RyaW5nLmxlbmd0aCA9PSAwKSB7XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cblxuICAgIGlmICh0eXBlb2Ygc3RyaW5nICE9PSBcInN0cmluZ1wiKSB7XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cblxuICAgIC8vIGNsZWFuIGFuZCB0cmltIHRoZSBkYXRlIHN0cmluZywgdGhpcyBoYXMgdXN1YWxseSBiZWVuIGRvbmUgYWxyZWFkeSBidXQgYmVpbmcgZGVmZW5zaXZlXG4gICAgbGV0IGNsZWFuU3RyaW5nID0gc3RyaW5nLnJlcGxhY2UoL1xccysvZywgXCIgXCIpLnRyaW0oKTtcbiAgICBpZiAoY2xlYW5TdHJpbmcubGVuZ3RoID09IDApIHtcbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxuXG4gICAgcmVzdWx0LmNsZWFuU3RyaW5nID0gY2xlYW5TdHJpbmc7XG5cbiAgICBpZiAoc3RyaW5nLmxlbmd0aCA8PSA0KSB7XG4gICAgICAvLyBpdCBjYW4gb25seSBiZSBhIHllYXJcbiAgICAgIGxldCBub25EaWdpdEluZGV4ID0gY2xlYW5TdHJpbmcuc2VhcmNoKC9bXjAtOV0vKTtcbiAgICAgIGlmIChub25EaWdpdEluZGV4ID09IC0xICYmIGNsZWFuU3RyaW5nLmxlbmd0aCA9PSA0KSB7XG4gICAgICAgIGxldCB5ZWFyTnVtID0gcGFyc2VJbnQoY2xlYW5TdHJpbmcpO1xuICAgICAgICBpZiAoIWlzTmFOKHllYXJOdW0pKSB7XG4gICAgICAgICAgcmVzdWx0LmlzVmFsaWQgPSB0cnVlO1xuICAgICAgICAgIHJlc3VsdC55ZWFyTnVtID0geWVhck51bTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cblxuICAgIC8vIGNoZWNrIGZvciBhIHllYXIgcmFuZ2VcbiAgICBpZiAoL15cXGRcXGRcXGRcXGRcXC1cXGRcXGRcXGRcXGQkLy50ZXN0KGNsZWFuU3RyaW5nKSB8fCAvXlxcZFxcZFxcZFxcZFxcLVxcZFxcZCQvLnRlc3QoY2xlYW5TdHJpbmcpKSB7XG4gICAgICAvLyBpdCBpcyBhIHllYXIgcmFuZ2UsXG4gICAgICBsZXQgc3RhcnRZZWFyU3RyaW5nID0gY2xlYW5TdHJpbmcuc3Vic3RyaW5nKDAsIDQpO1xuICAgICAgbGV0IGVuZFllYXJTdHJpbmcgPSBjbGVhblN0cmluZy5zdWJzdHJpbmcoNSk7XG4gICAgICBpZiAoZW5kWWVhclN0cmluZy5sZW5ndGggPT0gMikge1xuICAgICAgICBlbmRZZWFyU3RyaW5nID0gc3RhcnRZZWFyU3RyaW5nLnN1YnN0cmluZygwLCAyKSArIGVuZFllYXJTdHJpbmc7XG4gICAgICB9XG5cbiAgICAgIGxldCBzdGFydFllYXJOdW0gPSBwYXJzZUludChzdGFydFllYXJTdHJpbmcpO1xuICAgICAgbGV0IGVuZFllYXJOdW0gPSBwYXJzZUludChlbmRZZWFyU3RyaW5nKTtcbiAgICAgIGlmIChpc05hTihzdGFydFllYXJOdW0pIHx8IGlzTmFOKGVuZFllYXJOdW0pKSB7XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICB9XG5cbiAgICAgIHJlc3VsdC5pc1JhbmdlID0gdHJ1ZTtcbiAgICAgIHJlc3VsdC5pc1ZhbGlkID0gdHJ1ZTtcbiAgICAgIHJlc3VsdC5zdGFydFllYXJOdW0gPSBzdGFydFllYXJOdW07XG4gICAgICByZXN1bHQuZW5kWWVhck51bSA9IGVuZFllYXJOdW07XG4gICAgICByZXN1bHQueWVhck51bSA9IHN0YXJ0WWVhck51bTtcbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxuXG4gICAgLy8gaXQgaXMgbG9uZ2VyIHRoYW4gNCBkaWdpdHMuIFRoZSBtb3N0IGNvbW1vbiBmb3JtYXRzIHdvdWxkIGJlOlxuICAgIC8vIGRkIG1tbSB5eXl5XG4gICAgLy8gbW1tIHl5eXlcbiAgICBpZiAoL15cXGRcXGQ/IFthLXpBLVpdW2EtekEtWl1bYS16QS1aXSBcXGRcXGRcXGRcXGQkLy50ZXN0KGNsZWFuU3RyaW5nKSkge1xuICAgICAgbGV0IGZpcnN0U3BhY2VJbmRleCA9IGNsZWFuU3RyaW5nLmluZGV4T2YoXCIgXCIpO1xuICAgICAgbGV0IGxhc3RTcGFjZUluZGV4ID0gY2xlYW5TdHJpbmcubGFzdEluZGV4T2YoXCIgXCIpO1xuICAgICAgbGV0IGRheVN0cmluZyA9IGNsZWFuU3RyaW5nLnN1YnN0cmluZygwLCBmaXJzdFNwYWNlSW5kZXgpO1xuICAgICAgbGV0IG1vbnRoU3RyaW5nID0gY2xlYW5TdHJpbmcuc3Vic3RyaW5nKGZpcnN0U3BhY2VJbmRleCArIDEsIGxhc3RTcGFjZUluZGV4KTtcbiAgICAgIGxldCB5ZWFyU3RyaW5nID0gY2xlYW5TdHJpbmcuc3Vic3RyaW5nKGxhc3RTcGFjZUluZGV4ICsgMSk7XG4gICAgICBsZXQgZGF5TnVtID0gcGFyc2VJbnQoZGF5U3RyaW5nKTtcbiAgICAgIGlmIChpc05hTihkYXlOdW0pIHx8ICFkYXlOdW0pIHtcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgIH1cbiAgICAgIGxldCB5ZWFyTnVtID0gcGFyc2VJbnQoeWVhclN0cmluZyk7XG4gICAgICBpZiAoaXNOYU4oeWVhck51bSkgfHwgIXllYXJOdW0pIHtcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgIH1cbiAgICAgIGxldCBtb250aE51bSA9IFdUU19EYXRlLm1vbnRoU3RyaW5nVG9Nb250aE51bShtb250aFN0cmluZyk7XG4gICAgICBpZiAobW9udGhOdW0gPT0gMCkge1xuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgfVxuICAgICAgcmVzdWx0LmRheU51bSA9IGRheU51bTtcbiAgICAgIHJlc3VsdC5tb250aE51bSA9IG1vbnRoTnVtO1xuICAgICAgcmVzdWx0LnllYXJOdW0gPSB5ZWFyTnVtO1xuICAgICAgcmVzdWx0Lmhhc0RheSA9IHRydWU7XG4gICAgICByZXN1bHQuaGFzTW9udGggPSB0cnVlO1xuICAgICAgcmVzdWx0LmlzVmFsaWQgPSB0cnVlO1xuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9IGVsc2UgaWYgKC9eW2EtekEtWl1bYS16QS1aXVthLXpBLVpdIFxcZFxcZFxcZFxcZCQvLnRlc3QoY2xlYW5TdHJpbmcpKSB7XG4gICAgICBsZXQgZmlyc3RTcGFjZUluZGV4ID0gY2xlYW5TdHJpbmcuaW5kZXhPZihcIiBcIik7XG4gICAgICBsZXQgbW9udGhTdHJpbmcgPSBjbGVhblN0cmluZy5zdWJzdHJpbmcoMCwgZmlyc3RTcGFjZUluZGV4KTtcbiAgICAgIGxldCB5ZWFyU3RyaW5nID0gY2xlYW5TdHJpbmcuc3Vic3RyaW5nKGZpcnN0U3BhY2VJbmRleCArIDEpO1xuICAgICAgbGV0IHllYXJOdW0gPSBwYXJzZUludCh5ZWFyU3RyaW5nKTtcbiAgICAgIGlmIChpc05hTih5ZWFyTnVtKSB8fCAheWVhck51bSkge1xuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgfVxuICAgICAgbGV0IG1vbnRoTnVtID0gV1RTX0RhdGUubW9udGhTdHJpbmdUb01vbnRoTnVtKG1vbnRoU3RyaW5nKTtcbiAgICAgIGlmIChtb250aE51bSA9PSAwKSB7XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICB9XG4gICAgICByZXN1bHQubW9udGhOdW0gPSBtb250aE51bTtcbiAgICAgIHJlc3VsdC55ZWFyTnVtID0geWVhck51bTtcbiAgICAgIHJlc3VsdC5oYXNNb250aCA9IHRydWU7XG4gICAgICByZXN1bHQuaXNWYWxpZCA9IHRydWU7XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cblxuICAgIC8vIERpZCBub3QgbWF0Y2ggdGhlIGNvbW1vbiBmb3JtYXRzLCB0cnkgbGVzcyBjb21tb24gb25lc1xuICAgIGlmICgvXlxcZFxcZD8gW2EtekEtWl0rIFxcZFxcZFxcZFxcZCQvLnRlc3QoY2xlYW5TdHJpbmcpKSB7XG4gICAgICBsZXQgZmlyc3RTcGFjZUluZGV4ID0gY2xlYW5TdHJpbmcuaW5kZXhPZihcIiBcIik7XG4gICAgICBsZXQgbGFzdFNwYWNlSW5kZXggPSBjbGVhblN0cmluZy5sYXN0SW5kZXhPZihcIiBcIik7XG4gICAgICBsZXQgZGF5U3RyaW5nID0gY2xlYW5TdHJpbmcuc3Vic3RyaW5nKDAsIGZpcnN0U3BhY2VJbmRleCk7XG4gICAgICBsZXQgbW9udGhTdHJpbmcgPSBjbGVhblN0cmluZy5zdWJzdHJpbmcoZmlyc3RTcGFjZUluZGV4ICsgMSwgbGFzdFNwYWNlSW5kZXgpO1xuICAgICAgbGV0IHllYXJTdHJpbmcgPSBjbGVhblN0cmluZy5zdWJzdHJpbmcobGFzdFNwYWNlSW5kZXggKyAxKTtcbiAgICAgIGxldCBkYXlOdW0gPSBwYXJzZUludChkYXlTdHJpbmcpO1xuICAgICAgaWYgKGlzTmFOKGRheU51bSkgfHwgIWRheU51bSkge1xuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgfVxuICAgICAgbGV0IHllYXJOdW0gPSBwYXJzZUludCh5ZWFyU3RyaW5nKTtcbiAgICAgIGlmIChpc05hTih5ZWFyTnVtKSB8fCAheWVhck51bSkge1xuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgfVxuICAgICAgbGV0IG1vbnRoTnVtID0gV1RTX0RhdGUubW9udGhTdHJpbmdUb01vbnRoTnVtKG1vbnRoU3RyaW5nKTtcbiAgICAgIGlmIChtb250aE51bSA9PSAwKSB7XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICB9XG4gICAgICByZXN1bHQuZGF5TnVtID0gZGF5TnVtO1xuICAgICAgcmVzdWx0Lm1vbnRoTnVtID0gbW9udGhOdW07XG4gICAgICByZXN1bHQueWVhck51bSA9IHllYXJOdW07XG4gICAgICByZXN1bHQuaGFzRGF5ID0gdHJ1ZTtcbiAgICAgIHJlc3VsdC5oYXNNb250aCA9IHRydWU7XG4gICAgICByZXN1bHQuaXNWYWxpZCA9IHRydWU7XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cblxuICAgIC8vIE5vdCBzdXJlIHRoZSBmb3JtYXQgSnVuZSAxMiwgMTk2MCBpcyBldmVyIHVzZWQuIFdpa2lUcmVlIGRvY3Mgc2F5IGl0IGNhbiBiZVxuICAgIGlmICgvXlthLXpBLVpdKyBcXGRcXGQ/XFwsIFxcZFxcZFxcZFxcZCQvLnRlc3QoY2xlYW5TdHJpbmcpKSB7XG4gICAgICBsZXQgZmlyc3RTcGFjZUluZGV4ID0gY2xlYW5TdHJpbmcuaW5kZXhPZihcIiBcIik7XG4gICAgICBsZXQgbGFzdFNwYWNlSW5kZXggPSBjbGVhblN0cmluZy5sYXN0SW5kZXhPZihcIiBcIik7XG4gICAgICBsZXQgY29tbWFJbmRleCA9IGNsZWFuU3RyaW5nLmluZGV4T2YoXCIsXCIpO1xuICAgICAgbGV0IG1vbnRoU3RyaW5nID0gY2xlYW5TdHJpbmcuc3Vic3RyaW5nKDAsIGZpcnN0U3BhY2VJbmRleCk7XG4gICAgICBsZXQgZGF5U3RyaW5nID0gY2xlYW5TdHJpbmcuc3Vic3RyaW5nKGZpcnN0U3BhY2VJbmRleCArIDEsIGNvbW1hSW5kZXgpO1xuICAgICAgbGV0IHllYXJTdHJpbmcgPSBjbGVhblN0cmluZy5zdWJzdHJpbmcobGFzdFNwYWNlSW5kZXggKyAxKTtcbiAgICAgIGxldCBkYXlOdW0gPSBwYXJzZUludChkYXlTdHJpbmcpO1xuICAgICAgaWYgKGlzTmFOKGRheU51bSkgfHwgIWRheU51bSkge1xuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgfVxuICAgICAgbGV0IHllYXJOdW0gPSBwYXJzZUludCh5ZWFyU3RyaW5nKTtcbiAgICAgIGlmIChpc05hTih5ZWFyTnVtKSB8fCAheWVhck51bSkge1xuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgfVxuICAgICAgbGV0IG1vbnRoTnVtID0gV1RTX0RhdGUubW9udGhTdHJpbmdUb01vbnRoTnVtKG1vbnRoU3RyaW5nKTtcbiAgICAgIGlmIChtb250aE51bSA9PSAwKSB7XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICB9XG4gICAgICByZXN1bHQuZGF5TnVtID0gZGF5TnVtO1xuICAgICAgcmVzdWx0Lm1vbnRoTnVtID0gbW9udGhOdW07XG4gICAgICByZXN1bHQueWVhck51bSA9IHllYXJOdW07XG4gICAgICByZXN1bHQuaGFzRGF5ID0gdHJ1ZTtcbiAgICAgIHJlc3VsdC5oYXNNb250aCA9IHRydWU7XG4gICAgICByZXN1bHQuaXNWYWxpZCA9IHRydWU7XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cblxuICAgIC8vIFNvbWV0aW1lcyB3ZSBjYW4gZ2V0IGEgZGF0ZSBsaWtlOiAyN0F1ZzE4NDlcbiAgICAvLyBlLmcuOiBodHRwczovL3d3dy5mYW1pbHlzZWFyY2gub3JnL2FyazovNjE5MDMvMToxOjI3Q0ItSjQ5XG4gICAgaWYgKC9eXFxkXFxkP1thLXpBLVpdK1xcZFxcZFxcZFxcZCQvLnRlc3QoY2xlYW5TdHJpbmcpKSB7XG4gICAgICBsZXQgZmlyc3RMZXR0ZXJJbmRleCA9IGNsZWFuU3RyaW5nLnNlYXJjaCgvW2EtekEtWl0vKTtcbiAgICAgIGlmIChmaXJzdExldHRlckluZGV4ID09IC0xKSB7XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICB9XG4gICAgICBsZXQgZGF5U3RyaW5nID0gY2xlYW5TdHJpbmcuc3Vic3RyaW5nKDAsIGZpcnN0TGV0dGVySW5kZXgpO1xuICAgICAgbGV0IHJlbWFpbmRlciA9IGNsZWFuU3RyaW5nLnN1YnN0cmluZyhmaXJzdExldHRlckluZGV4KTtcblxuICAgICAgbGV0IHllYXJJbmRleCA9IHJlbWFpbmRlci5zZWFyY2goL1xcZC8pO1xuICAgICAgaWYgKHllYXJJbmRleCA9PSAtMSkge1xuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgfVxuICAgICAgbGV0IG1vbnRoU3RyaW5nID0gcmVtYWluZGVyLnN1YnN0cmluZygwLCB5ZWFySW5kZXgpO1xuICAgICAgbGV0IHllYXJTdHJpbmcgPSByZW1haW5kZXIuc3Vic3RyaW5nKHllYXJJbmRleCk7XG5cbiAgICAgIGxldCBkYXlOdW0gPSBwYXJzZUludChkYXlTdHJpbmcpO1xuICAgICAgaWYgKGlzTmFOKGRheU51bSkgfHwgIWRheU51bSkge1xuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgfVxuICAgICAgbGV0IHllYXJOdW0gPSBwYXJzZUludCh5ZWFyU3RyaW5nKTtcbiAgICAgIGlmIChpc05hTih5ZWFyTnVtKSB8fCAheWVhck51bSkge1xuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgfVxuICAgICAgbGV0IG1vbnRoTnVtID0gV1RTX0RhdGUubW9udGhTdHJpbmdUb01vbnRoTnVtKG1vbnRoU3RyaW5nKTtcbiAgICAgIGlmIChtb250aE51bSA9PSAwKSB7XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICB9XG4gICAgICByZXN1bHQuZGF5TnVtID0gZGF5TnVtO1xuICAgICAgcmVzdWx0Lm1vbnRoTnVtID0gbW9udGhOdW07XG4gICAgICByZXN1bHQueWVhck51bSA9IHllYXJOdW07XG4gICAgICByZXN1bHQuaGFzRGF5ID0gdHJ1ZTtcbiAgICAgIHJlc3VsdC5oYXNNb250aCA9IHRydWU7XG4gICAgICByZXN1bHQuaXNWYWxpZCA9IHRydWU7XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cbiAgICAvLyBTb21ldGltZXMgd2UgY2FuIGdldCBhIGRhdGUgbGlrZTogSnVseSAxODUyIG9yIEp1bCAxODUyXG4gICAgaWYgKC9bYS16QS1aXStcXHMrXFxkXFxkXFxkXFxkJC8udGVzdChjbGVhblN0cmluZykpIHtcbiAgICAgIGxldCByZW1haW5kZXIgPSBjbGVhblN0cmluZztcblxuICAgICAgbGV0IHllYXJJbmRleCA9IHJlbWFpbmRlci5zZWFyY2goL1xcZC8pO1xuICAgICAgaWYgKHllYXJJbmRleCA9PSAtMSkge1xuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgfVxuICAgICAgbGV0IG1vbnRoU3RyaW5nID0gcmVtYWluZGVyLnN1YnN0cmluZygwLCB5ZWFySW5kZXgpLnRyaW0oKTtcbiAgICAgIGxldCB5ZWFyU3RyaW5nID0gcmVtYWluZGVyLnN1YnN0cmluZyh5ZWFySW5kZXgpLnRyaW0oKTtcblxuICAgICAgbGV0IHllYXJOdW0gPSBwYXJzZUludCh5ZWFyU3RyaW5nKTtcbiAgICAgIGlmIChpc05hTih5ZWFyTnVtKSB8fCAheWVhck51bSkge1xuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgfVxuICAgICAgbGV0IG1vbnRoTnVtID0gV1RTX0RhdGUubW9udGhTdHJpbmdUb01vbnRoTnVtKG1vbnRoU3RyaW5nKTtcbiAgICAgIGlmIChtb250aE51bSA9PSAwKSB7XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICB9XG4gICAgICByZXN1bHQubW9udGhOdW0gPSBtb250aE51bTtcbiAgICAgIHJlc3VsdC55ZWFyTnVtID0geWVhck51bTtcbiAgICAgIHJlc3VsdC5oYXNNb250aCA9IHRydWU7XG4gICAgICByZXN1bHQuaXNWYWxpZCA9IHRydWU7XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cblxuICAgIGNvbnNvbGUubG9nKFwiVW51c3VhbCBkYXRlIGZvcm1hdDogXCIgKyBjbGVhblN0cmluZyk7XG5cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9LFxuXG4gIGdldFN0ZERhdGVTdHJpbmc6IGZ1bmN0aW9uIChwYXJzZWREYXRlLCBtb250aFN0cmluZ3MpIHtcbiAgICBsZXQgc3RyaW5nID0gXCJcIjtcbiAgICBpZiAoIXBhcnNlZERhdGUuaXNWYWxpZCkge1xuICAgICAgcmV0dXJuIHN0cmluZztcbiAgICB9XG5cbiAgICBpZiAocGFyc2VkRGF0ZS5pc1JhbmdlKSB7XG4gICAgICByZXR1cm4gcGFyc2VkRGF0ZS5zdGFydFllYXJOdW0udG9TdHJpbmcoKSArIFwiLVwiICsgcGFyc2VkRGF0ZS5lbmRZZWFyTnVtLnRvU3RyaW5nKCk7XG4gICAgfVxuXG4gICAgaWYgKHBhcnNlZERhdGUuaGFzRGF5KSB7XG4gICAgICBzdHJpbmcgKz0gcGFyc2VkRGF0ZS5kYXlOdW0udG9TdHJpbmcoKSArIFwiIFwiO1xuICAgIH1cbiAgICBpZiAocGFyc2VkRGF0ZS5oYXNNb250aCkge1xuICAgICAgc3RyaW5nICs9IG1vbnRoU3RyaW5nc1twYXJzZWREYXRlLm1vbnRoTnVtIC0gMV0gKyBcIiBcIjtcbiAgICB9XG4gICAgc3RyaW5nICs9IHBhcnNlZERhdGUueWVhck51bS50b1N0cmluZygpO1xuICAgIHJldHVybiBzdHJpbmc7XG4gIH0sXG5cbiAgZ2V0U3RkU2hvcnRGb3JtRGF0ZVN0cmluZzogZnVuY3Rpb24gKHBhcnNlZERhdGUpIHtcbiAgICByZXR1cm4gV1RTX0RhdGUuZ2V0U3RkRGF0ZVN0cmluZyhwYXJzZWREYXRlLCB0aHJlZUxldHRlck1vbnRocyk7XG4gIH0sXG5cbiAgZ2V0U3RkTG9uZ0Zvcm1EYXRlU3RyaW5nOiBmdW5jdGlvbiAocGFyc2VkRGF0ZSkge1xuICAgIHJldHVybiBXVFNfRGF0ZS5nZXRTdGREYXRlU3RyaW5nKHBhcnNlZERhdGUsIGZ1bGxNb250aHMpO1xuICB9LFxuXG4gIGdldFVzTG9uZ0Zvcm1EYXRlU3RyaW5nOiBmdW5jdGlvbiAocGFyc2VkRGF0ZSkge1xuICAgIGlmICghcGFyc2VkRGF0ZS5oYXNEYXkgfHwgIXBhcnNlZERhdGUuaGFzTW9udGggfHwgcGFyc2VkRGF0ZS5pc1JhbmdlKSB7XG4gICAgICByZXR1cm4gV1RTX0RhdGUuZ2V0U3RkRGF0ZVN0cmluZyhwYXJzZWREYXRlLCBmdWxsTW9udGhzKTtcbiAgICB9XG5cbiAgICBsZXQgc3RyaW5nID0gZnVsbE1vbnRoc1twYXJzZWREYXRlLm1vbnRoTnVtIC0gMV0gKyBcIiBcIiArIHBhcnNlZERhdGUuZGF5TnVtLnRvU3RyaW5nKCk7XG4gICAgc3RyaW5nICs9IFwiLCBcIiArIHBhcnNlZERhdGUueWVhck51bS50b1N0cmluZygpO1xuICAgIHJldHVybiBzdHJpbmc7XG4gIH0sXG5cbiAgZ2V0RGF5TnVtYmVyTnRoU3RyaW5nOiBmdW5jdGlvbiAoZGF5TnVtKSB7XG4gICAgbGV0IGRheVN0cmluZyA9IGRheU51bS50b1N0cmluZygpO1xuICAgIGlmICghZGF5U3RyaW5nKSB7XG4gICAgICByZXR1cm4gXCJcIjtcbiAgICB9XG5cbiAgICAvLyBhY2NvdW50IGZvciAxMXRoLCAxMnRoLCAxMTF0aCwgMjEzdGggZXRjIChub3QgdGhhdCBkYXRlcyBnZXQgdGhhdCBiaWchKVxuICAgIGxldCBpc1RlZW4gPSBmYWxzZTtcbiAgICBpZiAoZGF5U3RyaW5nLmxlbmd0aCA+PSAyKSB7XG4gICAgICBpZiAoZGF5U3RyaW5nW2RheVN0cmluZy5sZW5ndGggLSAyXSA9PSBcIjFcIikge1xuICAgICAgICBpc1RlZW4gPSB0cnVlO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChpc1RlZW4pIHtcbiAgICAgIGRheVN0cmluZyArPSBcInRoXCI7XG4gICAgfSBlbHNlIHtcbiAgICAgIGxldCBsYXN0RGlnaXQgPSBkYXlTdHJpbmdbZGF5U3RyaW5nLmxlbmd0aCAtIDFdO1xuICAgICAgaWYgKGxhc3REaWdpdCA9PSBcIjFcIikge1xuICAgICAgICBkYXlTdHJpbmcgKz0gXCJzdFwiO1xuICAgICAgfSBlbHNlIGlmIChsYXN0RGlnaXQgPT0gXCIyXCIpIHtcbiAgICAgICAgZGF5U3RyaW5nICs9IFwibmRcIjtcbiAgICAgIH0gZWxzZSBpZiAobGFzdERpZ2l0ID09IFwiM1wiKSB7XG4gICAgICAgIGRheVN0cmluZyArPSBcInJkXCI7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBkYXlTdHJpbmcgKz0gXCJ0aFwiO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBkYXlTdHJpbmc7XG4gIH0sXG5cbiAgZ2V0U3RkTnRoRm9ybURhdGVTdHJpbmc6IGZ1bmN0aW9uIChwYXJzZWREYXRlKSB7XG4gICAgaWYgKCFwYXJzZWREYXRlLmhhc0RheSB8fCAhcGFyc2VkRGF0ZS5oYXNNb250aCB8fCBwYXJzZWREYXRlLmlzUmFuZ2UpIHtcbiAgICAgIHJldHVybiBXVFNfRGF0ZS5nZXRTdGREYXRlU3RyaW5nKHBhcnNlZERhdGUsIGZ1bGxNb250aHMpO1xuICAgIH1cblxuICAgIGxldCBkYXlTdHJpbmcgPSBXVFNfRGF0ZS5nZXREYXlOdW1iZXJOdGhTdHJpbmcocGFyc2VkRGF0ZS5kYXlOdW0pO1xuICAgIGlmICghZGF5U3RyaW5nKSB7XG4gICAgICByZXR1cm4gV1RTX0RhdGUuZ2V0U3RkRGF0ZVN0cmluZyhwYXJzZWREYXRlLCBmdWxsTW9udGhzKTtcbiAgICB9XG5cbiAgICBsZXQgc3RyaW5nID0gXCJ0aGUgXCIgKyBkYXlTdHJpbmcgKyBcIiBvZiBcIiArIGZ1bGxNb250aHNbcGFyc2VkRGF0ZS5tb250aE51bSAtIDFdO1xuICAgIHN0cmluZyArPSBcIiBcIiArIHBhcnNlZERhdGUueWVhck51bS50b1N0cmluZygpO1xuICAgIHJldHVybiBzdHJpbmc7XG4gIH0sXG5cbiAgZ2V0VXNOdGhGb3JtRGF0ZVN0cmluZzogZnVuY3Rpb24gKHBhcnNlZERhdGUpIHtcbiAgICBpZiAoIXBhcnNlZERhdGUuaGFzRGF5IHx8ICFwYXJzZWREYXRlLmhhc01vbnRoIHx8IHBhcnNlZERhdGUuaXNSYW5nZSkge1xuICAgICAgcmV0dXJuIFdUU19EYXRlLmdldFN0ZERhdGVTdHJpbmcocGFyc2VkRGF0ZSwgZnVsbE1vbnRocyk7XG4gICAgfVxuXG4gICAgbGV0IGRheVN0cmluZyA9IFdUU19EYXRlLmdldERheU51bWJlck50aFN0cmluZyhwYXJzZWREYXRlLmRheU51bSk7XG4gICAgaWYgKCFkYXlTdHJpbmcpIHtcbiAgICAgIHJldHVybiBXVFNfRGF0ZS5nZXRTdGREYXRlU3RyaW5nKHBhcnNlZERhdGUsIGZ1bGxNb250aHMpO1xuICAgIH1cblxuICAgIGxldCBzdHJpbmcgPSBmdWxsTW9udGhzW3BhcnNlZERhdGUubW9udGhOdW0gLSAxXSArIFwiIFwiICsgZGF5U3RyaW5nO1xuICAgIHN0cmluZyArPSBcIiwgXCIgKyBwYXJzZWREYXRlLnllYXJOdW0udG9TdHJpbmcoKTtcbiAgICByZXR1cm4gc3RyaW5nO1xuICB9LFxuXG4gIGdldFBhcnNlZERhdGVJbkRheXM6IGZ1bmN0aW9uIChwYXJzZWREYXRlKSB7XG4gICAgaWYgKCFwYXJzZWREYXRlLmlzVmFsaWQpIHtcbiAgICAgIHJldHVybiAwO1xuICAgIH1cblxuICAgIGxldCBkYXlzID0gcGFyc2VkRGF0ZS55ZWFyTnVtICogMzY1O1xuICAgIC8vIHRoaXMgaXMgdmVyeSBzaW1wbGlmaWVkIC0gY3VycmVudGx5IHdlIGRvbid0IGNhcmUgYWJvdXQgbnVtIGRheXMgaW4gbW9udGggb3IgbGVhcCB5ZWFyc1xuICAgIGlmIChwYXJzZWREYXRlLmhhc01vbnRoKSB7XG4gICAgICBkYXlzICs9IChwYXJzZWREYXRlLm1vbnRoTnVtIC0gMSkgKiAzMDtcbiAgICB9XG4gICAgaWYgKHBhcnNlZERhdGUuaGFzRGF5KSB7XG4gICAgICBkYXlzICs9IHBhcnNlZERhdGUuZGF5TnVtIC0gMTtcbiAgICB9XG5cbiAgICByZXR1cm4gZGF5cztcbiAgfSxcblxuICBnZXRXaG9sZVllYXJzQmV0d2VlbkRhdGVTdHJpbmdzOiBmdW5jdGlvbiAoZGF0ZVN0cmluZzEsIGRhdGVTdHJpbmcyKSB7XG4gICAgbGV0IHBhcnNlZERhdGUxID0gV1RTX0RhdGUucGFyc2VEYXRlU3RyaW5nKGRhdGVTdHJpbmcxKTtcbiAgICBsZXQgcGFyc2VkRGF0ZTIgPSBXVFNfRGF0ZS5wYXJzZURhdGVTdHJpbmcoZGF0ZVN0cmluZzIpO1xuXG4gICAgaWYgKCFwYXJzZWREYXRlMS5pc1ZhbGlkIHx8ICFwYXJzZWREYXRlMi5pc1ZhbGlkKSB7XG4gICAgICByZXR1cm4gMDtcbiAgICB9XG5cbiAgICBsZXQgZGF0ZTFEYXlzID0gV1RTX0RhdGUuZ2V0UGFyc2VkRGF0ZUluRGF5cyhwYXJzZWREYXRlMSk7XG4gICAgbGV0IGRhdGUyRGF5cyA9IFdUU19EYXRlLmdldFBhcnNlZERhdGVJbkRheXMocGFyc2VkRGF0ZTIpO1xuXG4gICAgbGV0IGRpZmZJbkRheXMgPSBkYXRlMkRheXMgLSBkYXRlMURheXM7XG4gICAgcmV0dXJuIE1hdGguZmxvb3IoZGlmZkluRGF5cyAvIDM2NSk7XG4gIH0sXG5cbiAgZ2V0RGF5c0JldHdlZW5QYXJzZWREYXRlczogZnVuY3Rpb24gKHBhcnNlZERhdGUxLCBwYXJzZWREYXRlMikge1xuICAgIGlmICghcGFyc2VkRGF0ZTEuaXNWYWxpZCB8fCAhcGFyc2VkRGF0ZTIuaXNWYWxpZCkge1xuICAgICAgcmV0dXJuIDA7XG4gICAgfVxuXG4gICAgbGV0IGRhdGUxRGF5cyA9IFdUU19EYXRlLmdldFBhcnNlZERhdGVJbkRheXMocGFyc2VkRGF0ZTEpO1xuICAgIGxldCBkYXRlMkRheXMgPSBXVFNfRGF0ZS5nZXRQYXJzZWREYXRlSW5EYXlzKHBhcnNlZERhdGUyKTtcblxuICAgIGxldCBkaWZmSW5EYXlzID0gZGF0ZTJEYXlzIC0gZGF0ZTFEYXlzO1xuICAgIHJldHVybiBkaWZmSW5EYXlzO1xuICB9LFxuXG4gIGdldERheXNCZXR3ZWVuRGF0ZVN0cmluZ3M6IGZ1bmN0aW9uIChkYXRlU3RyaW5nMSwgZGF0ZVN0cmluZzIpIHtcbiAgICBsZXQgcGFyc2VkRGF0ZTEgPSBXVFNfRGF0ZS5wYXJzZURhdGVTdHJpbmcoZGF0ZVN0cmluZzEpO1xuICAgIGxldCBwYXJzZWREYXRlMiA9IFdUU19EYXRlLnBhcnNlRGF0ZVN0cmluZyhkYXRlU3RyaW5nMik7XG5cbiAgICByZXR1cm4gV1RTX0RhdGUuZ2V0RGF5c0JldHdlZW5QYXJzZWREYXRlcyhwYXJzZWREYXRlMSwgcGFyc2VkRGF0ZTIpO1xuICB9LFxuXG4gIGdldFllYXJOdW1Gcm9tWWVhclN0cmluZzogZnVuY3Rpb24gKHllYXJTdHJpbmcpIHtcbiAgICBpZiAoIXllYXJTdHJpbmcpIHtcbiAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgfVxuXG4gICAgbGV0IHllYXJOdW0gPSBwYXJzZUludCh5ZWFyU3RyaW5nKTtcbiAgICBpZiAoaXNOYU4oeWVhck51bSkgfHwgeWVhck51bSA9PSAwKSB7XG4gICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgIH1cblxuICAgIHJldHVybiB5ZWFyTnVtO1xuICB9LFxuXG4gIGdldFF1YXJ0ZXJOdW1Gcm9tUXVhcnRlclN0cmluZzogZnVuY3Rpb24gKHF1YXJ0ZXJTdHJpbmcpIHtcbiAgICBpZiAoIXF1YXJ0ZXJTdHJpbmcpIHtcbiAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgfVxuXG4gICAgaWYgKCFpc05hTihxdWFydGVyU3RyaW5nKSkge1xuICAgICAgcmV0dXJuIHF1YXJ0ZXJTdHJpbmc7IC8vIGFscmVhZHkgYSBudW1iZXJcbiAgICB9XG5cbiAgICBsZXQgcXVhcnRlck51bSA9IHBhcnNlSW50KHF1YXJ0ZXJTdHJpbmcpO1xuICAgIGlmIChpc05hTihxdWFydGVyTnVtKSB8fCBxdWFydGVyTnVtID09IDApIHtcbiAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgfVxuXG4gICAgcmV0dXJuIHF1YXJ0ZXJOdW07XG4gIH0sXG5cbiAgZ2V0RGF0ZVN0cmluZ0Zyb21ZZWFyTW9udGhEYXk6IGZ1bmN0aW9uICh5ZWFyLCBtb250aCwgZGF5KSB7XG4gICAgbGV0IGRhdGVTdHJpbmcgPSBcIlwiO1xuICAgIGlmIChkYXkpIHtcbiAgICAgIGRhdGVTdHJpbmcgKz0gZGF5O1xuICAgIH1cbiAgICBpZiAobW9udGgpIHtcbiAgICAgIGxldCBtb250aFN0cmluZyA9IG1vbnRoO1xuICAgICAgaWYgKC9eXFxkKyQvLnRlc3QobW9udGgpKSB7XG4gICAgICAgIGxldCBtb250aE51bSA9IHBhcnNlSW50KG1vbnRoKTtcbiAgICAgICAgaWYgKCFpc05hTihtb250aE51bSkpIHtcbiAgICAgICAgICBpZiAobW9udGhOdW0gPj0gMSAmJiBtb250aE51bSA8PSAxMikge1xuICAgICAgICAgICAgbW9udGhTdHJpbmcgPSB0aHJlZUxldHRlck1vbnRoc1ttb250aE51bSAtIDFdO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpZiAoZGF0ZVN0cmluZykge1xuICAgICAgICBkYXRlU3RyaW5nICs9IFwiIFwiO1xuICAgICAgfVxuICAgICAgZGF0ZVN0cmluZyArPSBtb250aFN0cmluZztcbiAgICB9XG4gICAgaWYgKHllYXIpIHtcbiAgICAgIGlmIChkYXRlU3RyaW5nKSB7XG4gICAgICAgIGRhdGVTdHJpbmcgKz0gXCIgXCI7XG4gICAgICB9XG4gICAgICBkYXRlU3RyaW5nICs9IHllYXI7XG4gICAgfVxuXG4gICAgcmV0dXJuIGRhdGVTdHJpbmc7XG4gIH0sXG59O1xuXG5leHBvcnQgeyBXVFNfRGF0ZSB9O1xuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./extension/base/core/wts_date.mjs\n");

/***/ }),

/***/ "./extension/base/core/wts_string.mjs":
/*!********************************************!*\
  !*** ./extension/base/core/wts_string.mjs ***!
  \********************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"WTS_String\": () => (/* binding */ WTS_String)\n/* harmony export */ });\n/*\nMIT License\n\nCopyright (c) 2020 Robert M Pavey\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.\n*/\n\nconst WTS_String = {\n  toInitialCapsEachWord: function (string, isName = false) {\n    if (!string || string.length == 0) {\n      return;\n    }\n\n    if (string.length == 1) {\n      return string[0].toUpperCase();\n    }\n\n    string = string.toLowerCase().trim();\n\n    var index = 0;\n    do {\n      string = string.substring(0, index) + string[index].toUpperCase() + string.substring(index + 1);\n      index = string.indexOf(\" \", index);\n      if (index != -1) {\n        index++;\n      }\n      // it might not be on a letter, move to next letter\n      while (index < string.length && (string[index] < \"a\" || string[index] > \"z\")) {\n        index++;\n      }\n    } while (index != -1 && index < string.length);\n\n    // certain words should not be initial caps\n    string = string.replace(/ In /g, \" in \");\n    string = string.replace(/ Of /g, \" of \");\n    string = string.replace(/ With /g, \" with \");\n    string = string.replace(/ At /g, \" at \");\n    string = string.replace(/ The /g, \" the \");\n    string = string.replace(/ And /g, \" and \");\n\n    if (!isName) {\n      string = string.replace(/ A /g, \" a \");\n    }\n\n    return string;\n  },\n\n  toInitialCaps: function (string) {\n    if (string) {\n      if (string.length > 1) {\n        return string[0].toUpperCase() + string.substring(1).toLowerCase();\n      } else {\n        return string[0].toUpperCase();\n      }\n    } else {\n      return \"\";\n    }\n  },\n\n  removeExtendedAsciiCharacters: function (string) {\n    const extendedAsciiArray = [\n      [\"Š\", \"S\"],\n      [\"š\", \"s\"],\n      [\"Ž\", \"Z\"],\n      [\"ž\", \"z\"],\n      [\"À\", \"A\"],\n      [\"Á\", \"A\"],\n      [\"Â\", \"A\"],\n      [\"Ã\", \"A\"],\n      [\"Ä\", \"A\"],\n      [\"Å\", \"A\"],\n      [\"Æ\", \"A\"],\n      [\"Ç\", \"C\"],\n      [\"È\", \"E\"],\n      [\"É\", \"E\"],\n      [\"Ê\", \"E\"],\n      [\"Ë\", \"E\"],\n      [\"Ì\", \"I\"],\n      [\"Í\", \"I\"],\n      [\"Î\", \"I\"],\n      [\"Ï\", \"I\"],\n      [\"Ñ\", \"N\"],\n      [\"Ò\", \"O\"],\n      [\"Ó\", \"O\"],\n      [\"Ô\", \"O\"],\n      [\"Õ\", \"O\"],\n      [\"Ö\", \"O\"],\n      [\"Ø\", \"O\"],\n      [\"Ù\", \"U\"],\n      [\"Ú\", \"U\"],\n      [\"Û\", \"U\"],\n      [\"Ü\", \"U\"],\n      [\"Ý\", \"Y\"],\n      [\"Þ\", \"B\"],\n      [\"ß\", \"Ss\"],\n      [\"à\", \"a\"],\n      [\"á\", \"a\"],\n      [\"â\", \"a\"],\n      [\"ã\", \"a\"],\n      [\"ä\", \"a\"],\n      [\"å\", \"a\"],\n      [\"æ\", \"a\"],\n      [\"ç\", \"c\"],\n      [\"è\", \"e\"],\n      [\"é\", \"e\"],\n      [\"ê\", \"e\"],\n      [\"ë\", \"e\"],\n      [\"ì\", \"i\"],\n      [\"í\", \"i\"],\n      [\"î\", \"i\"],\n      [\"ï\", \"i\"],\n      [\"ð\", \"o\"],\n      [\"ñ\", \"n\"],\n      [\"ò\", \"o\"],\n      [\"ó\", \"o\"],\n      [\"ô\", \"o\"],\n      [\"õ\", \"o\"],\n      [\"ö\", \"o\"],\n      [\"ø\", \"o\"],\n      [\"ù\", \"u\"],\n      [\"ú\", \"u\"],\n      [\"û\", \"u\"],\n      [\"ý\", \"y\"],\n      [\"þ\", \"b\"],\n      [\"ÿ\", \"y\"],\n      [\"’\", \"'\"],\n      [\"”\", '\"'],\n      [\"“\", '\"'],\n      [\"●\", \"*\"],\n    ];\n    if (string == undefined || string == \"\") {\n      return \"\";\n    }\n\n    var replaceString = string;\n    for (var i = 0; i < extendedAsciiArray.length; i++) {\n      var extChar = extendedAsciiArray[i];\n      const regex = new RegExp(extChar[0], \"g\");\n      replaceString = replaceString.replace(regex, extChar[1]);\n    }\n    return replaceString;\n  },\n\n  getFirstWord: function (string) {\n    if (string == undefined || string == null) {\n      return string;\n    }\n    let spaceIndex = string.search(/\\s/);\n    if (spaceIndex == -1) {\n      return string;\n    }\n    return string.substring(0, spaceIndex);\n  },\n\n  getLastWord: function (string) {\n    if (string == undefined || string == null) {\n      return string;\n    }\n    let lastSpaceIndex = string.lastIndexOf(\" \");\n    if (lastSpaceIndex == -1) {\n      return string;\n    }\n    return string.substring(lastSpaceIndex + 1);\n  },\n\n  getSecondWord: function (string) {\n    if (string == undefined || string == null) {\n      return string;\n    }\n    let spaceIndex = string.search(/\\s/);\n    if (spaceIndex == -1) {\n      return \"\";\n    }\n\n    let secondSpaceIndex = string.indexOf(\" \", spaceIndex + 1);\n    if (secondSpaceIndex == -1) {\n      return string.substring(spaceIndex + 1);\n    }\n\n    return string.substring(spaceIndex + 1, secondSpaceIndex);\n  },\n\n  getMiddleWord: function (string) {\n    // if there are 2 spaces or more, return the word between the first and second space\n    if (string == undefined || string == null) {\n      return string;\n    }\n    let spaceIndex = string.search(/\\s/);\n    if (spaceIndex == -1) {\n      return \"\";\n    }\n\n    let secondSpaceIndex = string.indexOf(\" \", spaceIndex + 1);\n    if (secondSpaceIndex == -1) {\n      return \"\";\n    }\n\n    return string.substring(spaceIndex + 1, secondSpaceIndex).trim();\n  },\n\n  getMiddleWords: function (string) {\n    // if there are 2 spaces or more, return the word between the first and second space\n    if (string == undefined || string == null) {\n      return string;\n    }\n    let spaceIndex = string.search(/\\s/);\n    if (spaceIndex == -1) {\n      return \"\";\n    }\n\n    let lastSpaceIndex = string.lastIndexOf(\" \");\n    if (lastSpaceIndex == -1 || lastSpaceIndex == spaceIndex) {\n      return \"\";\n    }\n\n    return string.substring(spaceIndex + 1, lastSpaceIndex).trim();\n  },\n\n  getWordsAfterFirstWord: function (string) {\n    if (string == undefined || string == null) {\n      return string;\n    }\n    let spaceIndex = string.search(/\\s/);\n    if (spaceIndex == -1) {\n      return undefined;\n    }\n    return string.substring(spaceIndex + 1);\n  },\n\n  getWordsBeforeLastWord: function (string) {\n    if (string == undefined || string == null) {\n      return string;\n    }\n    let lastSpaceIndex = string.lastIndexOf(\" \");\n    if (lastSpaceIndex == -1) {\n      return undefined;\n    }\n    return string.substring(0, lastSpaceIndex);\n  },\n\n  countWords: function (string) {\n    return string.trim().split(/\\s+/).length;\n  },\n\n  getIndefiniteArticle: function (word) {\n    if (!word || !word.length) {\n      return \"\";\n    }\n    if (/[aeiou]/i.test(word[0])) {\n      return \"an\";\n    }\n    return \"a\";\n  },\n\n  getPrepositionForPlaceString: function (placeString) {\n    if (!placeString) {\n      return \"\";\n    }\n\n    let firstChar = placeString[0];\n    if (firstChar >= \"0\" && firstChar <= \"9\") {\n      return \"at\";\n    } else {\n      // if it is a town we want \"in\" but if it is a house or building then we want \"at\"\n      // so we get last word or first part and compare it to a set of strings\n      let preposition = \"in\";\n      let firstPart = placeString;\n      let firstCommaIndex = placeString.indexOf(\",\");\n      if (firstCommaIndex != -1) {\n        firstPart = placeString.substring(0, firstCommaIndex);\n      }\n      let lastSpaceIndex = firstPart.lastIndexOf(\" \");\n      if (lastSpaceIndex != -1) {\n        let lastWord = firstPart.substring(lastSpaceIndex + 1);\n        const onEndings = [\n          \"street\",\n          \"st\",\n          \"st.\",\n          \"road\",\n          \"rd\",\n          \"rd.\",\n          \"lane\",\n          \"ln\",\n          \"ln.\",\n          \"avenue\",\n          \"ave\",\n          \"ave.\",\n          \"av\",\n          \"av.\",\n        ];\n        const atEndings = [\"workhouse\", \"house\", \"manor\", \"farm\", \"church\", \"hospital\", \"apartments\", \"apts\", \"apts.\"];\n        lastWord = lastWord.toLowerCase();\n        if (onEndings.includes(lastWord)) {\n          preposition = \"on\";\n        } else if (atEndings.includes(lastWord)) {\n          preposition = \"at\";\n        }\n      }\n      return preposition;\n    }\n  },\n\n  highlightString: function (string, highlightOption) {\n    let newString = string;\n    if (highlightOption == \"bold\") {\n      newString = \"'''\" + newString + \"'''\";\n    } else if (highlightOption == \"italic\") {\n      newString = \"''\" + newString + \"''\";\n    }\n    return newString;\n  },\n};\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9leHRlbnNpb24vYmFzZS9jb3JlL3d0c19zdHJpbmcubWpzLmpzIiwibWFwcGluZ3MiOiI7Ozs7QUFBQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07O0FBRU47QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxvQkFBb0IsK0JBQStCO0FBQ25EO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVU7QUFDVjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7O0FBRXNCIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vQ2l0YXRpb25FeHRyYWN0b3IvLi9leHRlbnNpb24vYmFzZS9jb3JlL3d0c19zdHJpbmcubWpzP2FiNWMiXSwic291cmNlc0NvbnRlbnQiOlsiLypcbk1JVCBMaWNlbnNlXG5cbkNvcHlyaWdodCAoYykgMjAyMCBSb2JlcnQgTSBQYXZleVxuXG5QZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYSBjb3B5XG5vZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSBcIlNvZnR3YXJlXCIpLCB0byBkZWFsXG5pbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzXG50byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsXG5jb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXNcbmZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6XG5cblRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkIGluIGFsbFxuY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS5cblxuVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEIFwiQVMgSVNcIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUlxuSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksXG5GSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEVcbkFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVJcbkxJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sXG5PVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOIFRIRVxuU09GVFdBUkUuXG4qL1xuXG5jb25zdCBXVFNfU3RyaW5nID0ge1xuICB0b0luaXRpYWxDYXBzRWFjaFdvcmQ6IGZ1bmN0aW9uIChzdHJpbmcsIGlzTmFtZSA9IGZhbHNlKSB7XG4gICAgaWYgKCFzdHJpbmcgfHwgc3RyaW5nLmxlbmd0aCA9PSAwKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKHN0cmluZy5sZW5ndGggPT0gMSkge1xuICAgICAgcmV0dXJuIHN0cmluZ1swXS50b1VwcGVyQ2FzZSgpO1xuICAgIH1cblxuICAgIHN0cmluZyA9IHN0cmluZy50b0xvd2VyQ2FzZSgpLnRyaW0oKTtcblxuICAgIHZhciBpbmRleCA9IDA7XG4gICAgZG8ge1xuICAgICAgc3RyaW5nID0gc3RyaW5nLnN1YnN0cmluZygwLCBpbmRleCkgKyBzdHJpbmdbaW5kZXhdLnRvVXBwZXJDYXNlKCkgKyBzdHJpbmcuc3Vic3RyaW5nKGluZGV4ICsgMSk7XG4gICAgICBpbmRleCA9IHN0cmluZy5pbmRleE9mKFwiIFwiLCBpbmRleCk7XG4gICAgICBpZiAoaW5kZXggIT0gLTEpIHtcbiAgICAgICAgaW5kZXgrKztcbiAgICAgIH1cbiAgICAgIC8vIGl0IG1pZ2h0IG5vdCBiZSBvbiBhIGxldHRlciwgbW92ZSB0byBuZXh0IGxldHRlclxuICAgICAgd2hpbGUgKGluZGV4IDwgc3RyaW5nLmxlbmd0aCAmJiAoc3RyaW5nW2luZGV4XSA8IFwiYVwiIHx8IHN0cmluZ1tpbmRleF0gPiBcInpcIikpIHtcbiAgICAgICAgaW5kZXgrKztcbiAgICAgIH1cbiAgICB9IHdoaWxlIChpbmRleCAhPSAtMSAmJiBpbmRleCA8IHN0cmluZy5sZW5ndGgpO1xuXG4gICAgLy8gY2VydGFpbiB3b3JkcyBzaG91bGQgbm90IGJlIGluaXRpYWwgY2Fwc1xuICAgIHN0cmluZyA9IHN0cmluZy5yZXBsYWNlKC8gSW4gL2csIFwiIGluIFwiKTtcbiAgICBzdHJpbmcgPSBzdHJpbmcucmVwbGFjZSgvIE9mIC9nLCBcIiBvZiBcIik7XG4gICAgc3RyaW5nID0gc3RyaW5nLnJlcGxhY2UoLyBXaXRoIC9nLCBcIiB3aXRoIFwiKTtcbiAgICBzdHJpbmcgPSBzdHJpbmcucmVwbGFjZSgvIEF0IC9nLCBcIiBhdCBcIik7XG4gICAgc3RyaW5nID0gc3RyaW5nLnJlcGxhY2UoLyBUaGUgL2csIFwiIHRoZSBcIik7XG4gICAgc3RyaW5nID0gc3RyaW5nLnJlcGxhY2UoLyBBbmQgL2csIFwiIGFuZCBcIik7XG5cbiAgICBpZiAoIWlzTmFtZSkge1xuICAgICAgc3RyaW5nID0gc3RyaW5nLnJlcGxhY2UoLyBBIC9nLCBcIiBhIFwiKTtcbiAgICB9XG5cbiAgICByZXR1cm4gc3RyaW5nO1xuICB9LFxuXG4gIHRvSW5pdGlhbENhcHM6IGZ1bmN0aW9uIChzdHJpbmcpIHtcbiAgICBpZiAoc3RyaW5nKSB7XG4gICAgICBpZiAoc3RyaW5nLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgcmV0dXJuIHN0cmluZ1swXS50b1VwcGVyQ2FzZSgpICsgc3RyaW5nLnN1YnN0cmluZygxKS50b0xvd2VyQ2FzZSgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIHN0cmluZ1swXS50b1VwcGVyQ2FzZSgpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gXCJcIjtcbiAgICB9XG4gIH0sXG5cbiAgcmVtb3ZlRXh0ZW5kZWRBc2NpaUNoYXJhY3RlcnM6IGZ1bmN0aW9uIChzdHJpbmcpIHtcbiAgICBjb25zdCBleHRlbmRlZEFzY2lpQXJyYXkgPSBbXG4gICAgICBbXCLFoFwiLCBcIlNcIl0sXG4gICAgICBbXCLFoVwiLCBcInNcIl0sXG4gICAgICBbXCLFvVwiLCBcIlpcIl0sXG4gICAgICBbXCLFvlwiLCBcInpcIl0sXG4gICAgICBbXCLDgFwiLCBcIkFcIl0sXG4gICAgICBbXCLDgVwiLCBcIkFcIl0sXG4gICAgICBbXCLDglwiLCBcIkFcIl0sXG4gICAgICBbXCLDg1wiLCBcIkFcIl0sXG4gICAgICBbXCLDhFwiLCBcIkFcIl0sXG4gICAgICBbXCLDhVwiLCBcIkFcIl0sXG4gICAgICBbXCLDhlwiLCBcIkFcIl0sXG4gICAgICBbXCLDh1wiLCBcIkNcIl0sXG4gICAgICBbXCLDiFwiLCBcIkVcIl0sXG4gICAgICBbXCLDiVwiLCBcIkVcIl0sXG4gICAgICBbXCLDilwiLCBcIkVcIl0sXG4gICAgICBbXCLDi1wiLCBcIkVcIl0sXG4gICAgICBbXCLDjFwiLCBcIklcIl0sXG4gICAgICBbXCLDjVwiLCBcIklcIl0sXG4gICAgICBbXCLDjlwiLCBcIklcIl0sXG4gICAgICBbXCLDj1wiLCBcIklcIl0sXG4gICAgICBbXCLDkVwiLCBcIk5cIl0sXG4gICAgICBbXCLDklwiLCBcIk9cIl0sXG4gICAgICBbXCLDk1wiLCBcIk9cIl0sXG4gICAgICBbXCLDlFwiLCBcIk9cIl0sXG4gICAgICBbXCLDlVwiLCBcIk9cIl0sXG4gICAgICBbXCLDllwiLCBcIk9cIl0sXG4gICAgICBbXCLDmFwiLCBcIk9cIl0sXG4gICAgICBbXCLDmVwiLCBcIlVcIl0sXG4gICAgICBbXCLDmlwiLCBcIlVcIl0sXG4gICAgICBbXCLDm1wiLCBcIlVcIl0sXG4gICAgICBbXCLDnFwiLCBcIlVcIl0sXG4gICAgICBbXCLDnVwiLCBcIllcIl0sXG4gICAgICBbXCLDnlwiLCBcIkJcIl0sXG4gICAgICBbXCLDn1wiLCBcIlNzXCJdLFxuICAgICAgW1wiw6BcIiwgXCJhXCJdLFxuICAgICAgW1wiw6FcIiwgXCJhXCJdLFxuICAgICAgW1wiw6JcIiwgXCJhXCJdLFxuICAgICAgW1wiw6NcIiwgXCJhXCJdLFxuICAgICAgW1wiw6RcIiwgXCJhXCJdLFxuICAgICAgW1wiw6VcIiwgXCJhXCJdLFxuICAgICAgW1wiw6ZcIiwgXCJhXCJdLFxuICAgICAgW1wiw6dcIiwgXCJjXCJdLFxuICAgICAgW1wiw6hcIiwgXCJlXCJdLFxuICAgICAgW1wiw6lcIiwgXCJlXCJdLFxuICAgICAgW1wiw6pcIiwgXCJlXCJdLFxuICAgICAgW1wiw6tcIiwgXCJlXCJdLFxuICAgICAgW1wiw6xcIiwgXCJpXCJdLFxuICAgICAgW1wiw61cIiwgXCJpXCJdLFxuICAgICAgW1wiw65cIiwgXCJpXCJdLFxuICAgICAgW1wiw69cIiwgXCJpXCJdLFxuICAgICAgW1wiw7BcIiwgXCJvXCJdLFxuICAgICAgW1wiw7FcIiwgXCJuXCJdLFxuICAgICAgW1wiw7JcIiwgXCJvXCJdLFxuICAgICAgW1wiw7NcIiwgXCJvXCJdLFxuICAgICAgW1wiw7RcIiwgXCJvXCJdLFxuICAgICAgW1wiw7VcIiwgXCJvXCJdLFxuICAgICAgW1wiw7ZcIiwgXCJvXCJdLFxuICAgICAgW1wiw7hcIiwgXCJvXCJdLFxuICAgICAgW1wiw7lcIiwgXCJ1XCJdLFxuICAgICAgW1wiw7pcIiwgXCJ1XCJdLFxuICAgICAgW1wiw7tcIiwgXCJ1XCJdLFxuICAgICAgW1wiw71cIiwgXCJ5XCJdLFxuICAgICAgW1wiw75cIiwgXCJiXCJdLFxuICAgICAgW1wiw79cIiwgXCJ5XCJdLFxuICAgICAgW1wi4oCZXCIsIFwiJ1wiXSxcbiAgICAgIFtcIuKAnVwiLCAnXCInXSxcbiAgICAgIFtcIuKAnFwiLCAnXCInXSxcbiAgICAgIFtcIuKXj1wiLCBcIipcIl0sXG4gICAgXTtcbiAgICBpZiAoc3RyaW5nID09IHVuZGVmaW5lZCB8fCBzdHJpbmcgPT0gXCJcIikge1xuICAgICAgcmV0dXJuIFwiXCI7XG4gICAgfVxuXG4gICAgdmFyIHJlcGxhY2VTdHJpbmcgPSBzdHJpbmc7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBleHRlbmRlZEFzY2lpQXJyYXkubGVuZ3RoOyBpKyspIHtcbiAgICAgIHZhciBleHRDaGFyID0gZXh0ZW5kZWRBc2NpaUFycmF5W2ldO1xuICAgICAgY29uc3QgcmVnZXggPSBuZXcgUmVnRXhwKGV4dENoYXJbMF0sIFwiZ1wiKTtcbiAgICAgIHJlcGxhY2VTdHJpbmcgPSByZXBsYWNlU3RyaW5nLnJlcGxhY2UocmVnZXgsIGV4dENoYXJbMV0pO1xuICAgIH1cbiAgICByZXR1cm4gcmVwbGFjZVN0cmluZztcbiAgfSxcblxuICBnZXRGaXJzdFdvcmQ6IGZ1bmN0aW9uIChzdHJpbmcpIHtcbiAgICBpZiAoc3RyaW5nID09IHVuZGVmaW5lZCB8fCBzdHJpbmcgPT0gbnVsbCkge1xuICAgICAgcmV0dXJuIHN0cmluZztcbiAgICB9XG4gICAgbGV0IHNwYWNlSW5kZXggPSBzdHJpbmcuc2VhcmNoKC9cXHMvKTtcbiAgICBpZiAoc3BhY2VJbmRleCA9PSAtMSkge1xuICAgICAgcmV0dXJuIHN0cmluZztcbiAgICB9XG4gICAgcmV0dXJuIHN0cmluZy5zdWJzdHJpbmcoMCwgc3BhY2VJbmRleCk7XG4gIH0sXG5cbiAgZ2V0TGFzdFdvcmQ6IGZ1bmN0aW9uIChzdHJpbmcpIHtcbiAgICBpZiAoc3RyaW5nID09IHVuZGVmaW5lZCB8fCBzdHJpbmcgPT0gbnVsbCkge1xuICAgICAgcmV0dXJuIHN0cmluZztcbiAgICB9XG4gICAgbGV0IGxhc3RTcGFjZUluZGV4ID0gc3RyaW5nLmxhc3RJbmRleE9mKFwiIFwiKTtcbiAgICBpZiAobGFzdFNwYWNlSW5kZXggPT0gLTEpIHtcbiAgICAgIHJldHVybiBzdHJpbmc7XG4gICAgfVxuICAgIHJldHVybiBzdHJpbmcuc3Vic3RyaW5nKGxhc3RTcGFjZUluZGV4ICsgMSk7XG4gIH0sXG5cbiAgZ2V0U2Vjb25kV29yZDogZnVuY3Rpb24gKHN0cmluZykge1xuICAgIGlmIChzdHJpbmcgPT0gdW5kZWZpbmVkIHx8IHN0cmluZyA9PSBudWxsKSB7XG4gICAgICByZXR1cm4gc3RyaW5nO1xuICAgIH1cbiAgICBsZXQgc3BhY2VJbmRleCA9IHN0cmluZy5zZWFyY2goL1xccy8pO1xuICAgIGlmIChzcGFjZUluZGV4ID09IC0xKSB7XG4gICAgICByZXR1cm4gXCJcIjtcbiAgICB9XG5cbiAgICBsZXQgc2Vjb25kU3BhY2VJbmRleCA9IHN0cmluZy5pbmRleE9mKFwiIFwiLCBzcGFjZUluZGV4ICsgMSk7XG4gICAgaWYgKHNlY29uZFNwYWNlSW5kZXggPT0gLTEpIHtcbiAgICAgIHJldHVybiBzdHJpbmcuc3Vic3RyaW5nKHNwYWNlSW5kZXggKyAxKTtcbiAgICB9XG5cbiAgICByZXR1cm4gc3RyaW5nLnN1YnN0cmluZyhzcGFjZUluZGV4ICsgMSwgc2Vjb25kU3BhY2VJbmRleCk7XG4gIH0sXG5cbiAgZ2V0TWlkZGxlV29yZDogZnVuY3Rpb24gKHN0cmluZykge1xuICAgIC8vIGlmIHRoZXJlIGFyZSAyIHNwYWNlcyBvciBtb3JlLCByZXR1cm4gdGhlIHdvcmQgYmV0d2VlbiB0aGUgZmlyc3QgYW5kIHNlY29uZCBzcGFjZVxuICAgIGlmIChzdHJpbmcgPT0gdW5kZWZpbmVkIHx8IHN0cmluZyA9PSBudWxsKSB7XG4gICAgICByZXR1cm4gc3RyaW5nO1xuICAgIH1cbiAgICBsZXQgc3BhY2VJbmRleCA9IHN0cmluZy5zZWFyY2goL1xccy8pO1xuICAgIGlmIChzcGFjZUluZGV4ID09IC0xKSB7XG4gICAgICByZXR1cm4gXCJcIjtcbiAgICB9XG5cbiAgICBsZXQgc2Vjb25kU3BhY2VJbmRleCA9IHN0cmluZy5pbmRleE9mKFwiIFwiLCBzcGFjZUluZGV4ICsgMSk7XG4gICAgaWYgKHNlY29uZFNwYWNlSW5kZXggPT0gLTEpIHtcbiAgICAgIHJldHVybiBcIlwiO1xuICAgIH1cblxuICAgIHJldHVybiBzdHJpbmcuc3Vic3RyaW5nKHNwYWNlSW5kZXggKyAxLCBzZWNvbmRTcGFjZUluZGV4KS50cmltKCk7XG4gIH0sXG5cbiAgZ2V0TWlkZGxlV29yZHM6IGZ1bmN0aW9uIChzdHJpbmcpIHtcbiAgICAvLyBpZiB0aGVyZSBhcmUgMiBzcGFjZXMgb3IgbW9yZSwgcmV0dXJuIHRoZSB3b3JkIGJldHdlZW4gdGhlIGZpcnN0IGFuZCBzZWNvbmQgc3BhY2VcbiAgICBpZiAoc3RyaW5nID09IHVuZGVmaW5lZCB8fCBzdHJpbmcgPT0gbnVsbCkge1xuICAgICAgcmV0dXJuIHN0cmluZztcbiAgICB9XG4gICAgbGV0IHNwYWNlSW5kZXggPSBzdHJpbmcuc2VhcmNoKC9cXHMvKTtcbiAgICBpZiAoc3BhY2VJbmRleCA9PSAtMSkge1xuICAgICAgcmV0dXJuIFwiXCI7XG4gICAgfVxuXG4gICAgbGV0IGxhc3RTcGFjZUluZGV4ID0gc3RyaW5nLmxhc3RJbmRleE9mKFwiIFwiKTtcbiAgICBpZiAobGFzdFNwYWNlSW5kZXggPT0gLTEgfHwgbGFzdFNwYWNlSW5kZXggPT0gc3BhY2VJbmRleCkge1xuICAgICAgcmV0dXJuIFwiXCI7XG4gICAgfVxuXG4gICAgcmV0dXJuIHN0cmluZy5zdWJzdHJpbmcoc3BhY2VJbmRleCArIDEsIGxhc3RTcGFjZUluZGV4KS50cmltKCk7XG4gIH0sXG5cbiAgZ2V0V29yZHNBZnRlckZpcnN0V29yZDogZnVuY3Rpb24gKHN0cmluZykge1xuICAgIGlmIChzdHJpbmcgPT0gdW5kZWZpbmVkIHx8IHN0cmluZyA9PSBudWxsKSB7XG4gICAgICByZXR1cm4gc3RyaW5nO1xuICAgIH1cbiAgICBsZXQgc3BhY2VJbmRleCA9IHN0cmluZy5zZWFyY2goL1xccy8pO1xuICAgIGlmIChzcGFjZUluZGV4ID09IC0xKSB7XG4gICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgIH1cbiAgICByZXR1cm4gc3RyaW5nLnN1YnN0cmluZyhzcGFjZUluZGV4ICsgMSk7XG4gIH0sXG5cbiAgZ2V0V29yZHNCZWZvcmVMYXN0V29yZDogZnVuY3Rpb24gKHN0cmluZykge1xuICAgIGlmIChzdHJpbmcgPT0gdW5kZWZpbmVkIHx8IHN0cmluZyA9PSBudWxsKSB7XG4gICAgICByZXR1cm4gc3RyaW5nO1xuICAgIH1cbiAgICBsZXQgbGFzdFNwYWNlSW5kZXggPSBzdHJpbmcubGFzdEluZGV4T2YoXCIgXCIpO1xuICAgIGlmIChsYXN0U3BhY2VJbmRleCA9PSAtMSkge1xuICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICB9XG4gICAgcmV0dXJuIHN0cmluZy5zdWJzdHJpbmcoMCwgbGFzdFNwYWNlSW5kZXgpO1xuICB9LFxuXG4gIGNvdW50V29yZHM6IGZ1bmN0aW9uIChzdHJpbmcpIHtcbiAgICByZXR1cm4gc3RyaW5nLnRyaW0oKS5zcGxpdCgvXFxzKy8pLmxlbmd0aDtcbiAgfSxcblxuICBnZXRJbmRlZmluaXRlQXJ0aWNsZTogZnVuY3Rpb24gKHdvcmQpIHtcbiAgICBpZiAoIXdvcmQgfHwgIXdvcmQubGVuZ3RoKSB7XG4gICAgICByZXR1cm4gXCJcIjtcbiAgICB9XG4gICAgaWYgKC9bYWVpb3VdL2kudGVzdCh3b3JkWzBdKSkge1xuICAgICAgcmV0dXJuIFwiYW5cIjtcbiAgICB9XG4gICAgcmV0dXJuIFwiYVwiO1xuICB9LFxuXG4gIGdldFByZXBvc2l0aW9uRm9yUGxhY2VTdHJpbmc6IGZ1bmN0aW9uIChwbGFjZVN0cmluZykge1xuICAgIGlmICghcGxhY2VTdHJpbmcpIHtcbiAgICAgIHJldHVybiBcIlwiO1xuICAgIH1cblxuICAgIGxldCBmaXJzdENoYXIgPSBwbGFjZVN0cmluZ1swXTtcbiAgICBpZiAoZmlyc3RDaGFyID49IFwiMFwiICYmIGZpcnN0Q2hhciA8PSBcIjlcIikge1xuICAgICAgcmV0dXJuIFwiYXRcIjtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gaWYgaXQgaXMgYSB0b3duIHdlIHdhbnQgXCJpblwiIGJ1dCBpZiBpdCBpcyBhIGhvdXNlIG9yIGJ1aWxkaW5nIHRoZW4gd2Ugd2FudCBcImF0XCJcbiAgICAgIC8vIHNvIHdlIGdldCBsYXN0IHdvcmQgb3IgZmlyc3QgcGFydCBhbmQgY29tcGFyZSBpdCB0byBhIHNldCBvZiBzdHJpbmdzXG4gICAgICBsZXQgcHJlcG9zaXRpb24gPSBcImluXCI7XG4gICAgICBsZXQgZmlyc3RQYXJ0ID0gcGxhY2VTdHJpbmc7XG4gICAgICBsZXQgZmlyc3RDb21tYUluZGV4ID0gcGxhY2VTdHJpbmcuaW5kZXhPZihcIixcIik7XG4gICAgICBpZiAoZmlyc3RDb21tYUluZGV4ICE9IC0xKSB7XG4gICAgICAgIGZpcnN0UGFydCA9IHBsYWNlU3RyaW5nLnN1YnN0cmluZygwLCBmaXJzdENvbW1hSW5kZXgpO1xuICAgICAgfVxuICAgICAgbGV0IGxhc3RTcGFjZUluZGV4ID0gZmlyc3RQYXJ0Lmxhc3RJbmRleE9mKFwiIFwiKTtcbiAgICAgIGlmIChsYXN0U3BhY2VJbmRleCAhPSAtMSkge1xuICAgICAgICBsZXQgbGFzdFdvcmQgPSBmaXJzdFBhcnQuc3Vic3RyaW5nKGxhc3RTcGFjZUluZGV4ICsgMSk7XG4gICAgICAgIGNvbnN0IG9uRW5kaW5ncyA9IFtcbiAgICAgICAgICBcInN0cmVldFwiLFxuICAgICAgICAgIFwic3RcIixcbiAgICAgICAgICBcInN0LlwiLFxuICAgICAgICAgIFwicm9hZFwiLFxuICAgICAgICAgIFwicmRcIixcbiAgICAgICAgICBcInJkLlwiLFxuICAgICAgICAgIFwibGFuZVwiLFxuICAgICAgICAgIFwibG5cIixcbiAgICAgICAgICBcImxuLlwiLFxuICAgICAgICAgIFwiYXZlbnVlXCIsXG4gICAgICAgICAgXCJhdmVcIixcbiAgICAgICAgICBcImF2ZS5cIixcbiAgICAgICAgICBcImF2XCIsXG4gICAgICAgICAgXCJhdi5cIixcbiAgICAgICAgXTtcbiAgICAgICAgY29uc3QgYXRFbmRpbmdzID0gW1wid29ya2hvdXNlXCIsIFwiaG91c2VcIiwgXCJtYW5vclwiLCBcImZhcm1cIiwgXCJjaHVyY2hcIiwgXCJob3NwaXRhbFwiLCBcImFwYXJ0bWVudHNcIiwgXCJhcHRzXCIsIFwiYXB0cy5cIl07XG4gICAgICAgIGxhc3RXb3JkID0gbGFzdFdvcmQudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgaWYgKG9uRW5kaW5ncy5pbmNsdWRlcyhsYXN0V29yZCkpIHtcbiAgICAgICAgICBwcmVwb3NpdGlvbiA9IFwib25cIjtcbiAgICAgICAgfSBlbHNlIGlmIChhdEVuZGluZ3MuaW5jbHVkZXMobGFzdFdvcmQpKSB7XG4gICAgICAgICAgcHJlcG9zaXRpb24gPSBcImF0XCI7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiBwcmVwb3NpdGlvbjtcbiAgICB9XG4gIH0sXG5cbiAgaGlnaGxpZ2h0U3RyaW5nOiBmdW5jdGlvbiAoc3RyaW5nLCBoaWdobGlnaHRPcHRpb24pIHtcbiAgICBsZXQgbmV3U3RyaW5nID0gc3RyaW5nO1xuICAgIGlmIChoaWdobGlnaHRPcHRpb24gPT0gXCJib2xkXCIpIHtcbiAgICAgIG5ld1N0cmluZyA9IFwiJycnXCIgKyBuZXdTdHJpbmcgKyBcIicnJ1wiO1xuICAgIH0gZWxzZSBpZiAoaGlnaGxpZ2h0T3B0aW9uID09IFwiaXRhbGljXCIpIHtcbiAgICAgIG5ld1N0cmluZyA9IFwiJydcIiArIG5ld1N0cmluZyArIFwiJydcIjtcbiAgICB9XG4gICAgcmV0dXJuIG5ld1N0cmluZztcbiAgfSxcbn07XG5cbmV4cG9ydCB7IFdUU19TdHJpbmcgfTtcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./extension/base/core/wts_string.mjs\n");

/***/ }),

/***/ "./extension/site/all/core/register_site_options.mjs":
/*!***********************************************************!*\
  !*** ./extension/site/all/core/register_site_options.mjs ***!
  \***********************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _ancestry_core_ancestry_options_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../ancestry/core/ancestry_options.mjs */ \"./extension/site/ancestry/core/ancestry_options.mjs\");\n/* harmony import */ var _bg_core_bg_options_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../bg/core/bg_options.mjs */ \"./extension/site/bg/core/bg_options.mjs\");\n/* harmony import */ var _fmp_core_fmp_options_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../fmp/core/fmp_options.mjs */ \"./extension/site/fmp/core/fmp_options.mjs\");\n/* harmony import */ var _fs_core_fs_options_mjs__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../fs/core/fs_options.mjs */ \"./extension/site/fs/core/fs_options.mjs\");\n/* harmony import */ var _fg_core_fg_options_mjs__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../fg/core/fg_options.mjs */ \"./extension/site/fg/core/fg_options.mjs\");\n/* harmony import */ var _freebmd_core_freebmd_options_mjs__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../freebmd/core/freebmd_options.mjs */ \"./extension/site/freebmd/core/freebmd_options.mjs\");\n/* harmony import */ var _freecen_core_freecen_options_mjs__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../freecen/core/freecen_options.mjs */ \"./extension/site/freecen/core/freecen_options.mjs\");\n/* harmony import */ var _freereg_core_freereg_options_mjs__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../../freereg/core/freereg_options.mjs */ \"./extension/site/freereg/core/freereg_options.mjs\");\n/* harmony import */ var _geneteka_core_geneteka_options_mjs__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../../geneteka/core/geneteka_options.mjs */ \"./extension/site/geneteka/core/geneteka_options.mjs\");\n/* harmony import */ var _gro_core_gro_options_mjs__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! ../../gro/core/gro_options.mjs */ \"./extension/site/gro/core/gro_options.mjs\");\n/* harmony import */ var _np_core_np_options_mjs__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! ../../np/core/np_options.mjs */ \"./extension/site/np/core/np_options.mjs\");\n/* harmony import */ var _scotp_core_scotp_options_mjs__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! ../../scotp/core/scotp_options.mjs */ \"./extension/site/scotp/core/scotp_options.mjs\");\n/* harmony import */ var _wikitree_core_wikitree_options_mjs__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! ../../wikitree/core/wikitree_options.mjs */ \"./extension/site/wikitree/core/wikitree_options.mjs\");\n/*\nMIT License\n\nCopyright (c) 2020 Robert M Pavey\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.\n*/\n\n// Importing each of these site modules causes them to register their options\n\n// Currently the order that they are imported is the order that they appear in the\n// options page subsection drop down\n\n\n\n\n\n\n\n\n\n\n\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9leHRlbnNpb24vc2l0ZS9hbGwvY29yZS9yZWdpc3Rlcl9zaXRlX29wdGlvbnMubWpzLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7O0FBQUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDa0Q7QUFDWjtBQUNFO0FBQ0Y7QUFDQTtBQUNVO0FBQ0E7QUFDQTtBQUNFO0FBQ1Y7QUFDRjtBQUNNO0FBQ00iLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9DaXRhdGlvbkV4dHJhY3Rvci8uL2V4dGVuc2lvbi9zaXRlL2FsbC9jb3JlL3JlZ2lzdGVyX3NpdGVfb3B0aW9ucy5tanM/NWRiOCJdLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuTUlUIExpY2Vuc2VcblxuQ29weXJpZ2h0IChjKSAyMDIwIFJvYmVydCBNIFBhdmV5XG5cblBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHlcbm9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlIFwiU29mdHdhcmVcIiksIHRvIGRlYWxcbmluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHNcbnRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGxcbmNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQgcGVyc29ucyB0byB3aG9tIHRoZSBTb2Z0d2FyZSBpc1xuZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczpcblxuVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW4gYWxsXG5jb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLlxuXG5USEUgU09GVFdBUkUgSVMgUFJPVklERUQgXCJBUyBJU1wiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SXG5JTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSxcbkZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRVxuQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUlxuTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSxcbk9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4gVEhFXG5TT0ZUV0FSRS5cbiovXG5cbi8vIEltcG9ydGluZyBlYWNoIG9mIHRoZXNlIHNpdGUgbW9kdWxlcyBjYXVzZXMgdGhlbSB0byByZWdpc3RlciB0aGVpciBvcHRpb25zXG5cbi8vIEN1cnJlbnRseSB0aGUgb3JkZXIgdGhhdCB0aGV5IGFyZSBpbXBvcnRlZCBpcyB0aGUgb3JkZXIgdGhhdCB0aGV5IGFwcGVhciBpbiB0aGVcbi8vIG9wdGlvbnMgcGFnZSBzdWJzZWN0aW9uIGRyb3AgZG93blxuaW1wb3J0IFwiLi4vLi4vYW5jZXN0cnkvY29yZS9hbmNlc3RyeV9vcHRpb25zLm1qc1wiO1xuaW1wb3J0IFwiLi4vLi4vYmcvY29yZS9iZ19vcHRpb25zLm1qc1wiO1xuaW1wb3J0IFwiLi4vLi4vZm1wL2NvcmUvZm1wX29wdGlvbnMubWpzXCI7XG5pbXBvcnQgXCIuLi8uLi9mcy9jb3JlL2ZzX29wdGlvbnMubWpzXCI7XG5pbXBvcnQgXCIuLi8uLi9mZy9jb3JlL2ZnX29wdGlvbnMubWpzXCI7XG5pbXBvcnQgXCIuLi8uLi9mcmVlYm1kL2NvcmUvZnJlZWJtZF9vcHRpb25zLm1qc1wiO1xuaW1wb3J0IFwiLi4vLi4vZnJlZWNlbi9jb3JlL2ZyZWVjZW5fb3B0aW9ucy5tanNcIjtcbmltcG9ydCBcIi4uLy4uL2ZyZWVyZWcvY29yZS9mcmVlcmVnX29wdGlvbnMubWpzXCI7XG5pbXBvcnQgXCIuLi8uLi9nZW5ldGVrYS9jb3JlL2dlbmV0ZWthX29wdGlvbnMubWpzXCI7XG5pbXBvcnQgXCIuLi8uLi9ncm8vY29yZS9ncm9fb3B0aW9ucy5tanNcIjtcbmltcG9ydCBcIi4uLy4uL25wL2NvcmUvbnBfb3B0aW9ucy5tanNcIjtcbmltcG9ydCBcIi4uLy4uL3Njb3RwL2NvcmUvc2NvdHBfb3B0aW9ucy5tanNcIjtcbmltcG9ydCBcIi4uLy4uL3dpa2l0cmVlL2NvcmUvd2lraXRyZWVfb3B0aW9ucy5tanNcIjtcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./extension/site/all/core/register_site_options.mjs\n");

/***/ }),

/***/ "./extension/site/ancestry/browser/ancestry_fetch.mjs":
/*!************************************************************!*\
  !*** ./extension/site/ancestry/browser/ancestry_fetch.mjs ***!
  \************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"extractRecordHtmlFromUrl\": () => (/* binding */ extractRecordHtmlFromUrl),\n/* harmony export */   \"fetchAncestrySharingDataObj\": () => (/* binding */ fetchAncestrySharingDataObj)\n/* harmony export */ });\n/* harmony import */ var _base_browser_common_browser_compat_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../../base/browser/common/browser_compat.mjs */ \"./extension/base/browser/common/browser_compat.mjs\");\n/*\nMIT License\n\nCopyright (c) 2020 Robert M Pavey\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.\n*/\n\n\n\nfunction getRandomInt(min, max) {\n  min = Math.ceil(min);\n  max = Math.floor(max);\n  return Math.floor(Math.random() * (max - min) + min); //The maximum is exclusive and the minimum is inclusive\n}\n\nasync function fetchAncestrySharingDataObjGivenIds(imageDbId, imageRecordId, recordId, url) {\n  let mode = \"cors\";\n\n  let domain = url.replace(/https?\\:\\/\\/[^\\.]+\\.([^\\/]+)\\/.*/, \"$1\");\n  if (!domain || domain == url) {\n    domain = \"ancestry.com\";\n  }\n\n  //console.log(\"domain is: \" + domain);\n\n  // NOTE: It appears that things are working fine always using ancestry.com as the domain.\n  // It is possible that changing to sometimes use ancestrylibrary.com would break things.\n  // It is reported that creating sharing links from ancestrylibrary.com is working when using\n  // ancestry.com as the domain. So for now always use ancestry.com\n  // NO... I tested by actually signing out of ancestry.com and using ancestry.co.uk and it\n  // could not build the link when I was setting domain here to ancestry.com.\n  //domain = \"ancestry.com\";\n\n  let fetchUrl = \"https://www.\" + domain + \"/sharing/shares/create/v2\";\n\n  //console.log(\"fetchUrl is\");\n  //console.log(fetchUrl);\n\n  const postData = {\n    collection_id: imageDbId,\n    cta_view_original_url: url,\n    image_id: imageRecordId,\n    locale: \"en-US\",\n    record_id: recordId,\n    referrer_client: \"LIVE\",\n    shared_page_url: url,\n  };\n\n  let response = await fetch(fetchUrl, {\n    headers: {\n      accept: \"*/*\",\n      \"accept-language\": \"en-US,en;q=0.9\",\n      \"Content-Type\": \"application/json\",\n    },\n    referrer: \"https://search.\" + domain + \"/\",\n    referrerPolicy: \"origin-when-cross-origin\",\n    body: JSON.stringify(postData),\n    method: \"POST\",\n    mode: mode,\n    credentials: \"include\",\n  }).catch((err) => {\n    console.log(\"Fetch threw an exception, message is: \" + err.message);\n    console.log(err);\n    return { success: false };\n  });\n\n  //console.log(\"response is\");\n  //console.log(response);\n\n  // On Firefox it may return zero any time you use \"no-cors\"\n  if (response.status !== 200) {\n    console.log(\"Looks like there was a problem. Status Code: \" + response.status);\n    return { success: false };\n  }\n\n  // Examine the text in the response\n  let data = await response.text();\n\n  //console.log(\"data is:\");\n  //console.log(data);\n\n  if (data.startsWith(`{\"id\":`)) {\n    const jsonData = data;\n    const dataObj = JSON.parse(jsonData);\n\n    //console.log(\"dataObj is:\");\n    //console.log(dataObj);\n\n    if (dataObj) {\n      return { success: true, dataObj: dataObj };\n    }\n  }\n\n  return { success: false };\n}\n\nasync function getLastSharingData() {\n  return await (0,_base_browser_common_browser_compat_mjs__WEBPACK_IMPORTED_MODULE_0__.getLocalStorageItem)(\"ancestry_lastSharingData\").catch( error => { });\n}\n\nasync function setLastSharingData(lastSharingData) {\n  let items = { ancestry_lastSharingData: lastSharingData };\n  try { chrome.storage.local.set(items)} catch (err) \n  {console.log(\"Failed to write lastSharingData to chrome.storage.local:\" + err.message); console.log(lastSharingData);};\n}\n\nasync function fetchAncestrySharingDataObj(ed) {\n  let result = { success: false, dataObj: undefined };\n\n  // If the request is the same as the last one made then reuse the result to avoid sending too\n  // many fetch requests to server.\n  let lastSharingData = await getLastSharingData();\n  if (lastSharingData && ed.url == lastSharingData.url) {\n    //console.log(\"fetchAncestrySharingDataObj, reusing result:\");\n    //console.log(lastSharingData.dataObj);\n    result.success = true;\n    result.dataObj = lastSharingData.dataObj;\n    return result;\n  }\n\n  let sharingData = {\n    dbId: null,\n    recordId: null,\n    personId: null,\n    url: ed.url,\n    dataObj: null,\n  };\n\n  if (ed.pageType == \"record\") {\n    if (ed.imageUrl) {\n      sharingData.dbId = ed.imageDbId;\n      sharingData.recordId = ed.imageRecordId;\n      sharingData.personId = ed.recordId;\n    }\n  } else if (ed.pageType == \"image\") {\n    sharingData.dbId = ed.dbId;\n    sharingData.recordId = ed.recordId;\n    sharingData.personId = ed.pid;\n  }\n\n  //console.log(\"sharingData is:\");\n  //console.log(sharingData);\n\n  if (sharingData.dbId && sharingData.recordId) {\n    result = await fetchAncestrySharingDataObjGivenIds(\n      sharingData.dbId,\n      sharingData.recordId,\n      sharingData.personId,\n      sharingData.url\n    );\n    //console.log(\"fetchAncestrySharingDataObj, result is\");\n    //console.log(sharingData.dataObj);\n\n    if (result.success && result.dataObj) {\n      sharingData.dataObj = result.dataObj;\n      setLastSharingData(sharingData);\n    }\n  }\n\n  //console.log(\"result is:\");\n  //console.log(result);\n\n  return result;\n}\n\nasync function getRecordPageCache() {\n  let recordPageCache = {};\n  let item = await (0,_base_browser_common_browser_compat_mjs__WEBPACK_IMPORTED_MODULE_0__.getLocalStorageItem)(\"ancestry_recordPageCache\");\n  if (item) {\n    recordPageCache = item;\n  }\n  return recordPageCache;\n}\n\nasync function setRecordPageCache(recordPageCache) {\n  let items = { ancestry_recordPageCache: recordPageCache };\n  chrome.storage.local.set(items);\n}\n\nasync function fetchAncestryRecordPage(recordUrl, cacheTag) {\n  let result = { success: false, recordUrl: recordUrl, cacheTag: cacheTag };\n\n  if (!recordUrl) {\n    return result;\n  }\n\n  try {\n    let ancestryRecordPageCache = await getRecordPageCache();\n    //console.log(\"fetchAncestryRecordPage, cacheTag is: \" + cacheTag);\n\n    if (cacheTag) {\n      //console.log(\"fetchAncestryRecordPage, ancestryRecordPageCache is:\");\n      //console.log(ancestryRecordPageCache);\n\n      let cache = ancestryRecordPageCache[cacheTag];\n\n      //console.log(\"fetchAncestryRecordPage, cache is: \");\n      //console.log(cache);\n\n      if (cache && cache.recordUrl == recordUrl) {\n        return cache.result;\n      }\n    }\n\n    let mode = \"cors\";\n\n    let domain = recordUrl.replace(/https?\\:\\/\\/[^\\.]+\\.([^\\/]+)\\/.*/, \"$1\");\n    if (!domain || domain == recordUrl) {\n      domain = \"ancestry.com\";\n    }\n\n    //console.log(\"domain is: \" + domain);\n\n    let response = await fetch(recordUrl, {\n      headers: {\n        accept: \"*/*\",\n        \"accept-language\": \"en-US,en;q=0.9\",\n      },\n      referrer: \"https://search.\" + domain + \"/\",\n      referrerPolicy: \"origin-when-cross-origin\",\n      body: null,\n      method: \"GET\",\n      mode: mode,\n      credentials: \"include\",\n    }).catch((err) => {\n      console.log(\"Fetch threw an exception, message is: \" + err.message);\n      console.log(err);\n      return result; // Note this returns from this catch function, not fetchAncestryRecordPage\n    });\n\n    // On Firefox it may return zero any time you use \"no-cors\"\n    if (!response || response.status !== 200) {\n      console.log(\"Looks like there was a problem. Status Code: \" + response.status);\n      return result;\n    }\n\n    //console.log(\"response is\");\n    //console.log(response);\n\n    if (response.url && response.url.includes(\"offers/join\")) {\n      // the user does not have a subscription that includes this record\n      result.errorStatus = \"subscriptionHasNoAccess\";\n      return result;\n    }\n\n    // Examine the text in the response\n    let data = await response.text();\n\n    //console.log(\"data is:\");\n    //console.log(data);\n\n    // There are different ways to try to parse it.\n\n    result.htmlText = data;\n    result.success = true;\n\n    //console.log(\"result is: \");\n    //console.log(result);\n\n    if (cacheTag) {\n      let cache = { recordUrl: recordUrl, result: result };\n      ancestryRecordPageCache[cacheTag] = cache;\n      setRecordPageCache(ancestryRecordPageCache);\n    }\n  } catch (error) {\n    console.log(\"WikiTree Sourcer:: fetchAncestryRecordPage, failed. Error message is: \" + error.message);\n  }\n\n  return result;\n}\n\nasync function extractRecordHtmlFromUrl(recordUrl, cacheTag) {\n  //console.log(\"extractRecordFromUrl, recordUrl is: \" + recordUrl);\n\n  let result = await fetchAncestryRecordPage(recordUrl, cacheTag);\n\n  //console.log(\"extractRecordFromUrl, sending response: \");\n  //console.log(result);\n\n  return result;\n}\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9leHRlbnNpb24vc2l0ZS9hbmNlc3RyeS9icm93c2VyL2FuY2VzdHJ5X2ZldGNoLm1qcy5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRThFOztBQUU5RTtBQUNBO0FBQ0E7QUFDQSx3REFBd0Q7QUFDeEQ7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxtQ0FBbUM7QUFDbkM7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQSxhQUFhO0FBQ2IsR0FBRzs7QUFFSDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUEsd0JBQXdCO0FBQ3hCO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBLGVBQWU7QUFDZjtBQUNBOztBQUVBLFdBQVc7QUFDWDs7QUFFQTtBQUNBLGVBQWUsNEZBQW1CLGdEQUFnRDtBQUNsRjs7QUFFQTtBQUNBLGdCQUFnQjtBQUNoQixRQUFRLGlDQUFpQztBQUN6QyxHQUFHLHVGQUF1RjtBQUMxRjs7QUFFQTtBQUNBLGlCQUFpQjs7QUFFakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxtQkFBbUIsNEZBQW1CO0FBQ3RDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxnQkFBZ0I7QUFDaEI7QUFDQTs7QUFFQTtBQUNBLGlCQUFpQjs7QUFFakI7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxxQ0FBcUM7QUFDckMsT0FBTztBQUNQO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCLEtBQUs7O0FBRUw7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBLG9CQUFvQjtBQUNwQjtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVpRSIsInNvdXJjZXMiOlsid2VicGFjazovL0NpdGF0aW9uRXh0cmFjdG9yLy4vZXh0ZW5zaW9uL3NpdGUvYW5jZXN0cnkvYnJvd3Nlci9hbmNlc3RyeV9mZXRjaC5tanM/MTNkZSJdLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuTUlUIExpY2Vuc2VcblxuQ29weXJpZ2h0IChjKSAyMDIwIFJvYmVydCBNIFBhdmV5XG5cblBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHlcbm9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlIFwiU29mdHdhcmVcIiksIHRvIGRlYWxcbmluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHNcbnRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGxcbmNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQgcGVyc29ucyB0byB3aG9tIHRoZSBTb2Z0d2FyZSBpc1xuZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczpcblxuVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW4gYWxsXG5jb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLlxuXG5USEUgU09GVFdBUkUgSVMgUFJPVklERUQgXCJBUyBJU1wiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SXG5JTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSxcbkZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRVxuQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUlxuTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSxcbk9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4gVEhFXG5TT0ZUV0FSRS5cbiovXG5cbmltcG9ydCB7IGdldExvY2FsU3RvcmFnZUl0ZW0gfSBmcm9tIFwiL2Jhc2UvYnJvd3Nlci9jb21tb24vYnJvd3Nlcl9jb21wYXQubWpzXCI7XG5cbmZ1bmN0aW9uIGdldFJhbmRvbUludChtaW4sIG1heCkge1xuICBtaW4gPSBNYXRoLmNlaWwobWluKTtcbiAgbWF4ID0gTWF0aC5mbG9vcihtYXgpO1xuICByZXR1cm4gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKG1heCAtIG1pbikgKyBtaW4pOyAvL1RoZSBtYXhpbXVtIGlzIGV4Y2x1c2l2ZSBhbmQgdGhlIG1pbmltdW0gaXMgaW5jbHVzaXZlXG59XG5cbmFzeW5jIGZ1bmN0aW9uIGZldGNoQW5jZXN0cnlTaGFyaW5nRGF0YU9iakdpdmVuSWRzKGltYWdlRGJJZCwgaW1hZ2VSZWNvcmRJZCwgcmVjb3JkSWQsIHVybCkge1xuICBsZXQgbW9kZSA9IFwiY29yc1wiO1xuXG4gIGxldCBkb21haW4gPSB1cmwucmVwbGFjZSgvaHR0cHM/XFw6XFwvXFwvW15cXC5dK1xcLihbXlxcL10rKVxcLy4qLywgXCIkMVwiKTtcbiAgaWYgKCFkb21haW4gfHwgZG9tYWluID09IHVybCkge1xuICAgIGRvbWFpbiA9IFwiYW5jZXN0cnkuY29tXCI7XG4gIH1cblxuICAvL2NvbnNvbGUubG9nKFwiZG9tYWluIGlzOiBcIiArIGRvbWFpbik7XG5cbiAgLy8gTk9URTogSXQgYXBwZWFycyB0aGF0IHRoaW5ncyBhcmUgd29ya2luZyBmaW5lIGFsd2F5cyB1c2luZyBhbmNlc3RyeS5jb20gYXMgdGhlIGRvbWFpbi5cbiAgLy8gSXQgaXMgcG9zc2libGUgdGhhdCBjaGFuZ2luZyB0byBzb21ldGltZXMgdXNlIGFuY2VzdHJ5bGlicmFyeS5jb20gd291bGQgYnJlYWsgdGhpbmdzLlxuICAvLyBJdCBpcyByZXBvcnRlZCB0aGF0IGNyZWF0aW5nIHNoYXJpbmcgbGlua3MgZnJvbSBhbmNlc3RyeWxpYnJhcnkuY29tIGlzIHdvcmtpbmcgd2hlbiB1c2luZ1xuICAvLyBhbmNlc3RyeS5jb20gYXMgdGhlIGRvbWFpbi4gU28gZm9yIG5vdyBhbHdheXMgdXNlIGFuY2VzdHJ5LmNvbVxuICAvLyBOTy4uLiBJIHRlc3RlZCBieSBhY3R1YWxseSBzaWduaW5nIG91dCBvZiBhbmNlc3RyeS5jb20gYW5kIHVzaW5nIGFuY2VzdHJ5LmNvLnVrIGFuZCBpdFxuICAvLyBjb3VsZCBub3QgYnVpbGQgdGhlIGxpbmsgd2hlbiBJIHdhcyBzZXR0aW5nIGRvbWFpbiBoZXJlIHRvIGFuY2VzdHJ5LmNvbS5cbiAgLy9kb21haW4gPSBcImFuY2VzdHJ5LmNvbVwiO1xuXG4gIGxldCBmZXRjaFVybCA9IFwiaHR0cHM6Ly93d3cuXCIgKyBkb21haW4gKyBcIi9zaGFyaW5nL3NoYXJlcy9jcmVhdGUvdjJcIjtcblxuICAvL2NvbnNvbGUubG9nKFwiZmV0Y2hVcmwgaXNcIik7XG4gIC8vY29uc29sZS5sb2coZmV0Y2hVcmwpO1xuXG4gIGNvbnN0IHBvc3REYXRhID0ge1xuICAgIGNvbGxlY3Rpb25faWQ6IGltYWdlRGJJZCxcbiAgICBjdGFfdmlld19vcmlnaW5hbF91cmw6IHVybCxcbiAgICBpbWFnZV9pZDogaW1hZ2VSZWNvcmRJZCxcbiAgICBsb2NhbGU6IFwiZW4tVVNcIixcbiAgICByZWNvcmRfaWQ6IHJlY29yZElkLFxuICAgIHJlZmVycmVyX2NsaWVudDogXCJMSVZFXCIsXG4gICAgc2hhcmVkX3BhZ2VfdXJsOiB1cmwsXG4gIH07XG5cbiAgbGV0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goZmV0Y2hVcmwsIHtcbiAgICBoZWFkZXJzOiB7XG4gICAgICBhY2NlcHQ6IFwiKi8qXCIsXG4gICAgICBcImFjY2VwdC1sYW5ndWFnZVwiOiBcImVuLVVTLGVuO3E9MC45XCIsXG4gICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgICB9LFxuICAgIHJlZmVycmVyOiBcImh0dHBzOi8vc2VhcmNoLlwiICsgZG9tYWluICsgXCIvXCIsXG4gICAgcmVmZXJyZXJQb2xpY3k6IFwib3JpZ2luLXdoZW4tY3Jvc3Mtb3JpZ2luXCIsXG4gICAgYm9keTogSlNPTi5zdHJpbmdpZnkocG9zdERhdGEpLFxuICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgbW9kZTogbW9kZSxcbiAgICBjcmVkZW50aWFsczogXCJpbmNsdWRlXCIsXG4gIH0pLmNhdGNoKChlcnIpID0+IHtcbiAgICBjb25zb2xlLmxvZyhcIkZldGNoIHRocmV3IGFuIGV4Y2VwdGlvbiwgbWVzc2FnZSBpczogXCIgKyBlcnIubWVzc2FnZSk7XG4gICAgY29uc29sZS5sb2coZXJyKTtcbiAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSB9O1xuICB9KTtcblxuICAvL2NvbnNvbGUubG9nKFwicmVzcG9uc2UgaXNcIik7XG4gIC8vY29uc29sZS5sb2cocmVzcG9uc2UpO1xuXG4gIC8vIE9uIEZpcmVmb3ggaXQgbWF5IHJldHVybiB6ZXJvIGFueSB0aW1lIHlvdSB1c2UgXCJuby1jb3JzXCJcbiAgaWYgKHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7XG4gICAgY29uc29sZS5sb2coXCJMb29rcyBsaWtlIHRoZXJlIHdhcyBhIHByb2JsZW0uIFN0YXR1cyBDb2RlOiBcIiArIHJlc3BvbnNlLnN0YXR1cyk7XG4gICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UgfTtcbiAgfVxuXG4gIC8vIEV4YW1pbmUgdGhlIHRleHQgaW4gdGhlIHJlc3BvbnNlXG4gIGxldCBkYXRhID0gYXdhaXQgcmVzcG9uc2UudGV4dCgpO1xuXG4gIC8vY29uc29sZS5sb2coXCJkYXRhIGlzOlwiKTtcbiAgLy9jb25zb2xlLmxvZyhkYXRhKTtcblxuICBpZiAoZGF0YS5zdGFydHNXaXRoKGB7XCJpZFwiOmApKSB7XG4gICAgY29uc3QganNvbkRhdGEgPSBkYXRhO1xuICAgIGNvbnN0IGRhdGFPYmogPSBKU09OLnBhcnNlKGpzb25EYXRhKTtcblxuICAgIC8vY29uc29sZS5sb2coXCJkYXRhT2JqIGlzOlwiKTtcbiAgICAvL2NvbnNvbGUubG9nKGRhdGFPYmopO1xuXG4gICAgaWYgKGRhdGFPYmopIHtcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIGRhdGFPYmo6IGRhdGFPYmogfTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSB9O1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRMYXN0U2hhcmluZ0RhdGEoKSB7XG4gIHJldHVybiBhd2FpdCBnZXRMb2NhbFN0b3JhZ2VJdGVtKFwiYW5jZXN0cnlfbGFzdFNoYXJpbmdEYXRhXCIpLmNhdGNoKCBlcnJvciA9PiB7IH0pO1xufVxuXG5hc3luYyBmdW5jdGlvbiBzZXRMYXN0U2hhcmluZ0RhdGEobGFzdFNoYXJpbmdEYXRhKSB7XG4gIGxldCBpdGVtcyA9IHsgYW5jZXN0cnlfbGFzdFNoYXJpbmdEYXRhOiBsYXN0U2hhcmluZ0RhdGEgfTtcbiAgdHJ5IHsgY2hyb21lLnN0b3JhZ2UubG9jYWwuc2V0KGl0ZW1zKX0gY2F0Y2ggKGVycikgXG4gIHtjb25zb2xlLmxvZyhcIkZhaWxlZCB0byB3cml0ZSBsYXN0U2hhcmluZ0RhdGEgdG8gY2hyb21lLnN0b3JhZ2UubG9jYWw6XCIgKyBlcnIubWVzc2FnZSk7IGNvbnNvbGUubG9nKGxhc3RTaGFyaW5nRGF0YSk7fTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gZmV0Y2hBbmNlc3RyeVNoYXJpbmdEYXRhT2JqKGVkKSB7XG4gIGxldCByZXN1bHQgPSB7IHN1Y2Nlc3M6IGZhbHNlLCBkYXRhT2JqOiB1bmRlZmluZWQgfTtcblxuICAvLyBJZiB0aGUgcmVxdWVzdCBpcyB0aGUgc2FtZSBhcyB0aGUgbGFzdCBvbmUgbWFkZSB0aGVuIHJldXNlIHRoZSByZXN1bHQgdG8gYXZvaWQgc2VuZGluZyB0b29cbiAgLy8gbWFueSBmZXRjaCByZXF1ZXN0cyB0byBzZXJ2ZXIuXG4gIGxldCBsYXN0U2hhcmluZ0RhdGEgPSBhd2FpdCBnZXRMYXN0U2hhcmluZ0RhdGEoKTtcbiAgaWYgKGxhc3RTaGFyaW5nRGF0YSAmJiBlZC51cmwgPT0gbGFzdFNoYXJpbmdEYXRhLnVybCkge1xuICAgIC8vY29uc29sZS5sb2coXCJmZXRjaEFuY2VzdHJ5U2hhcmluZ0RhdGFPYmosIHJldXNpbmcgcmVzdWx0OlwiKTtcbiAgICAvL2NvbnNvbGUubG9nKGxhc3RTaGFyaW5nRGF0YS5kYXRhT2JqKTtcbiAgICByZXN1bHQuc3VjY2VzcyA9IHRydWU7XG4gICAgcmVzdWx0LmRhdGFPYmogPSBsYXN0U2hhcmluZ0RhdGEuZGF0YU9iajtcbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgbGV0IHNoYXJpbmdEYXRhID0ge1xuICAgIGRiSWQ6IG51bGwsXG4gICAgcmVjb3JkSWQ6IG51bGwsXG4gICAgcGVyc29uSWQ6IG51bGwsXG4gICAgdXJsOiBlZC51cmwsXG4gICAgZGF0YU9iajogbnVsbCxcbiAgfTtcblxuICBpZiAoZWQucGFnZVR5cGUgPT0gXCJyZWNvcmRcIikge1xuICAgIGlmIChlZC5pbWFnZVVybCkge1xuICAgICAgc2hhcmluZ0RhdGEuZGJJZCA9IGVkLmltYWdlRGJJZDtcbiAgICAgIHNoYXJpbmdEYXRhLnJlY29yZElkID0gZWQuaW1hZ2VSZWNvcmRJZDtcbiAgICAgIHNoYXJpbmdEYXRhLnBlcnNvbklkID0gZWQucmVjb3JkSWQ7XG4gICAgfVxuICB9IGVsc2UgaWYgKGVkLnBhZ2VUeXBlID09IFwiaW1hZ2VcIikge1xuICAgIHNoYXJpbmdEYXRhLmRiSWQgPSBlZC5kYklkO1xuICAgIHNoYXJpbmdEYXRhLnJlY29yZElkID0gZWQucmVjb3JkSWQ7XG4gICAgc2hhcmluZ0RhdGEucGVyc29uSWQgPSBlZC5waWQ7XG4gIH1cblxuICAvL2NvbnNvbGUubG9nKFwic2hhcmluZ0RhdGEgaXM6XCIpO1xuICAvL2NvbnNvbGUubG9nKHNoYXJpbmdEYXRhKTtcblxuICBpZiAoc2hhcmluZ0RhdGEuZGJJZCAmJiBzaGFyaW5nRGF0YS5yZWNvcmRJZCkge1xuICAgIHJlc3VsdCA9IGF3YWl0IGZldGNoQW5jZXN0cnlTaGFyaW5nRGF0YU9iakdpdmVuSWRzKFxuICAgICAgc2hhcmluZ0RhdGEuZGJJZCxcbiAgICAgIHNoYXJpbmdEYXRhLnJlY29yZElkLFxuICAgICAgc2hhcmluZ0RhdGEucGVyc29uSWQsXG4gICAgICBzaGFyaW5nRGF0YS51cmxcbiAgICApO1xuICAgIC8vY29uc29sZS5sb2coXCJmZXRjaEFuY2VzdHJ5U2hhcmluZ0RhdGFPYmosIHJlc3VsdCBpc1wiKTtcbiAgICAvL2NvbnNvbGUubG9nKHNoYXJpbmdEYXRhLmRhdGFPYmopO1xuXG4gICAgaWYgKHJlc3VsdC5zdWNjZXNzICYmIHJlc3VsdC5kYXRhT2JqKSB7XG4gICAgICBzaGFyaW5nRGF0YS5kYXRhT2JqID0gcmVzdWx0LmRhdGFPYmo7XG4gICAgICBzZXRMYXN0U2hhcmluZ0RhdGEoc2hhcmluZ0RhdGEpO1xuICAgIH1cbiAgfVxuXG4gIC8vY29uc29sZS5sb2coXCJyZXN1bHQgaXM6XCIpO1xuICAvL2NvbnNvbGUubG9nKHJlc3VsdCk7XG5cbiAgcmV0dXJuIHJlc3VsdDtcbn1cblxuYXN5bmMgZnVuY3Rpb24gZ2V0UmVjb3JkUGFnZUNhY2hlKCkge1xuICBsZXQgcmVjb3JkUGFnZUNhY2hlID0ge307XG4gIGxldCBpdGVtID0gYXdhaXQgZ2V0TG9jYWxTdG9yYWdlSXRlbShcImFuY2VzdHJ5X3JlY29yZFBhZ2VDYWNoZVwiKTtcbiAgaWYgKGl0ZW0pIHtcbiAgICByZWNvcmRQYWdlQ2FjaGUgPSBpdGVtO1xuICB9XG4gIHJldHVybiByZWNvcmRQYWdlQ2FjaGU7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIHNldFJlY29yZFBhZ2VDYWNoZShyZWNvcmRQYWdlQ2FjaGUpIHtcbiAgbGV0IGl0ZW1zID0geyBhbmNlc3RyeV9yZWNvcmRQYWdlQ2FjaGU6IHJlY29yZFBhZ2VDYWNoZSB9O1xuICBjaHJvbWUuc3RvcmFnZS5sb2NhbC5zZXQoaXRlbXMpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBmZXRjaEFuY2VzdHJ5UmVjb3JkUGFnZShyZWNvcmRVcmwsIGNhY2hlVGFnKSB7XG4gIGxldCByZXN1bHQgPSB7IHN1Y2Nlc3M6IGZhbHNlLCByZWNvcmRVcmw6IHJlY29yZFVybCwgY2FjaGVUYWc6IGNhY2hlVGFnIH07XG5cbiAgaWYgKCFyZWNvcmRVcmwpIHtcbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgdHJ5IHtcbiAgICBsZXQgYW5jZXN0cnlSZWNvcmRQYWdlQ2FjaGUgPSBhd2FpdCBnZXRSZWNvcmRQYWdlQ2FjaGUoKTtcbiAgICAvL2NvbnNvbGUubG9nKFwiZmV0Y2hBbmNlc3RyeVJlY29yZFBhZ2UsIGNhY2hlVGFnIGlzOiBcIiArIGNhY2hlVGFnKTtcblxuICAgIGlmIChjYWNoZVRhZykge1xuICAgICAgLy9jb25zb2xlLmxvZyhcImZldGNoQW5jZXN0cnlSZWNvcmRQYWdlLCBhbmNlc3RyeVJlY29yZFBhZ2VDYWNoZSBpczpcIik7XG4gICAgICAvL2NvbnNvbGUubG9nKGFuY2VzdHJ5UmVjb3JkUGFnZUNhY2hlKTtcblxuICAgICAgbGV0IGNhY2hlID0gYW5jZXN0cnlSZWNvcmRQYWdlQ2FjaGVbY2FjaGVUYWddO1xuXG4gICAgICAvL2NvbnNvbGUubG9nKFwiZmV0Y2hBbmNlc3RyeVJlY29yZFBhZ2UsIGNhY2hlIGlzOiBcIik7XG4gICAgICAvL2NvbnNvbGUubG9nKGNhY2hlKTtcblxuICAgICAgaWYgKGNhY2hlICYmIGNhY2hlLnJlY29yZFVybCA9PSByZWNvcmRVcmwpIHtcbiAgICAgICAgcmV0dXJuIGNhY2hlLnJlc3VsdDtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBsZXQgbW9kZSA9IFwiY29yc1wiO1xuXG4gICAgbGV0IGRvbWFpbiA9IHJlY29yZFVybC5yZXBsYWNlKC9odHRwcz9cXDpcXC9cXC9bXlxcLl0rXFwuKFteXFwvXSspXFwvLiovLCBcIiQxXCIpO1xuICAgIGlmICghZG9tYWluIHx8IGRvbWFpbiA9PSByZWNvcmRVcmwpIHtcbiAgICAgIGRvbWFpbiA9IFwiYW5jZXN0cnkuY29tXCI7XG4gICAgfVxuXG4gICAgLy9jb25zb2xlLmxvZyhcImRvbWFpbiBpczogXCIgKyBkb21haW4pO1xuXG4gICAgbGV0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2gocmVjb3JkVXJsLCB7XG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgIGFjY2VwdDogXCIqLypcIixcbiAgICAgICAgXCJhY2NlcHQtbGFuZ3VhZ2VcIjogXCJlbi1VUyxlbjtxPTAuOVwiLFxuICAgICAgfSxcbiAgICAgIHJlZmVycmVyOiBcImh0dHBzOi8vc2VhcmNoLlwiICsgZG9tYWluICsgXCIvXCIsXG4gICAgICByZWZlcnJlclBvbGljeTogXCJvcmlnaW4td2hlbi1jcm9zcy1vcmlnaW5cIixcbiAgICAgIGJvZHk6IG51bGwsXG4gICAgICBtZXRob2Q6IFwiR0VUXCIsXG4gICAgICBtb2RlOiBtb2RlLFxuICAgICAgY3JlZGVudGlhbHM6IFwiaW5jbHVkZVwiLFxuICAgIH0pLmNhdGNoKChlcnIpID0+IHtcbiAgICAgIGNvbnNvbGUubG9nKFwiRmV0Y2ggdGhyZXcgYW4gZXhjZXB0aW9uLCBtZXNzYWdlIGlzOiBcIiArIGVyci5tZXNzYWdlKTtcbiAgICAgIGNvbnNvbGUubG9nKGVycik7XG4gICAgICByZXR1cm4gcmVzdWx0OyAvLyBOb3RlIHRoaXMgcmV0dXJucyBmcm9tIHRoaXMgY2F0Y2ggZnVuY3Rpb24sIG5vdCBmZXRjaEFuY2VzdHJ5UmVjb3JkUGFnZVxuICAgIH0pO1xuXG4gICAgLy8gT24gRmlyZWZveCBpdCBtYXkgcmV0dXJuIHplcm8gYW55IHRpbWUgeW91IHVzZSBcIm5vLWNvcnNcIlxuICAgIGlmICghcmVzcG9uc2UgfHwgcmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHtcbiAgICAgIGNvbnNvbGUubG9nKFwiTG9va3MgbGlrZSB0aGVyZSB3YXMgYSBwcm9ibGVtLiBTdGF0dXMgQ29kZTogXCIgKyByZXNwb25zZS5zdGF0dXMpO1xuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9XG5cbiAgICAvL2NvbnNvbGUubG9nKFwicmVzcG9uc2UgaXNcIik7XG4gICAgLy9jb25zb2xlLmxvZyhyZXNwb25zZSk7XG5cbiAgICBpZiAocmVzcG9uc2UudXJsICYmIHJlc3BvbnNlLnVybC5pbmNsdWRlcyhcIm9mZmVycy9qb2luXCIpKSB7XG4gICAgICAvLyB0aGUgdXNlciBkb2VzIG5vdCBoYXZlIGEgc3Vic2NyaXB0aW9uIHRoYXQgaW5jbHVkZXMgdGhpcyByZWNvcmRcbiAgICAgIHJlc3VsdC5lcnJvclN0YXR1cyA9IFwic3Vic2NyaXB0aW9uSGFzTm9BY2Nlc3NcIjtcbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxuXG4gICAgLy8gRXhhbWluZSB0aGUgdGV4dCBpbiB0aGUgcmVzcG9uc2VcbiAgICBsZXQgZGF0YSA9IGF3YWl0IHJlc3BvbnNlLnRleHQoKTtcblxuICAgIC8vY29uc29sZS5sb2coXCJkYXRhIGlzOlwiKTtcbiAgICAvL2NvbnNvbGUubG9nKGRhdGEpO1xuXG4gICAgLy8gVGhlcmUgYXJlIGRpZmZlcmVudCB3YXlzIHRvIHRyeSB0byBwYXJzZSBpdC5cblxuICAgIHJlc3VsdC5odG1sVGV4dCA9IGRhdGE7XG4gICAgcmVzdWx0LnN1Y2Nlc3MgPSB0cnVlO1xuXG4gICAgLy9jb25zb2xlLmxvZyhcInJlc3VsdCBpczogXCIpO1xuICAgIC8vY29uc29sZS5sb2cocmVzdWx0KTtcblxuICAgIGlmIChjYWNoZVRhZykge1xuICAgICAgbGV0IGNhY2hlID0geyByZWNvcmRVcmw6IHJlY29yZFVybCwgcmVzdWx0OiByZXN1bHQgfTtcbiAgICAgIGFuY2VzdHJ5UmVjb3JkUGFnZUNhY2hlW2NhY2hlVGFnXSA9IGNhY2hlO1xuICAgICAgc2V0UmVjb3JkUGFnZUNhY2hlKGFuY2VzdHJ5UmVjb3JkUGFnZUNhY2hlKTtcbiAgICB9XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5sb2coXCJXaWtpVHJlZSBTb3VyY2VyOjogZmV0Y2hBbmNlc3RyeVJlY29yZFBhZ2UsIGZhaWxlZC4gRXJyb3IgbWVzc2FnZSBpczogXCIgKyBlcnJvci5tZXNzYWdlKTtcbiAgfVxuXG4gIHJldHVybiByZXN1bHQ7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGV4dHJhY3RSZWNvcmRIdG1sRnJvbVVybChyZWNvcmRVcmwsIGNhY2hlVGFnKSB7XG4gIC8vY29uc29sZS5sb2coXCJleHRyYWN0UmVjb3JkRnJvbVVybCwgcmVjb3JkVXJsIGlzOiBcIiArIHJlY29yZFVybCk7XG5cbiAgbGV0IHJlc3VsdCA9IGF3YWl0IGZldGNoQW5jZXN0cnlSZWNvcmRQYWdlKHJlY29yZFVybCwgY2FjaGVUYWcpO1xuXG4gIC8vY29uc29sZS5sb2coXCJleHRyYWN0UmVjb3JkRnJvbVVybCwgc2VuZGluZyByZXNwb25zZTogXCIpO1xuICAvL2NvbnNvbGUubG9nKHJlc3VsdCk7XG5cbiAgcmV0dXJuIHJlc3VsdDtcbn1cblxuZXhwb3J0IHsgZmV0Y2hBbmNlc3RyeVNoYXJpbmdEYXRhT2JqLCBleHRyYWN0UmVjb3JkSHRtbEZyb21VcmwgfTtcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./extension/site/ancestry/browser/ancestry_fetch.mjs\n");

/***/ }),

/***/ "./extension/site/ancestry/core/ancestry_build_citation.mjs":
/*!******************************************************************!*\
  !*** ./extension/site/ancestry/core/ancestry_build_citation.mjs ***!
  \******************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"buildCitation\": () => (/* binding */ buildCitation)\n/* harmony export */ });\n/* harmony import */ var _base_core_citation_builder_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../base/core/citation_builder.mjs */ \"./extension/base/core/citation_builder.mjs\");\n/* harmony import */ var _base_core_data_string_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../base/core/data_string.mjs */ \"./extension/base/core/data_string.mjs\");\n/* harmony import */ var _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../base/core/record_type.mjs */ \"./extension/base/core/record_type.mjs\");\n/*\nMIT License\n\nCopyright (c) 2020 Robert M Pavey\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.\n*/\n\n\n\n\n\nfunction getCleanRecordDataValue(recordData, fieldName) {\n  let value = recordData[fieldName];\n  if (value == undefined) {\n    return value;\n  }\n\n  // sometimes there are values in square brackets after the first value\n  // these make it hard to parse dates, places, names etc so remove them\n  let bracketIndex = value.indexOf(\"[\");\n  if (bracketIndex != -1) {\n    value = value.substring(0, bracketIndex).trim();\n  }\n\n  return value;\n}\n\nfunction getRefTitle(ed, gd) {\n  const recordTypeToRefTitle = [\n    {\n      type: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Census,\n      defaultTitle: \"Census\",\n      addYear: true,\n      titleMatches: [{ title: \"Register\", matches: [\"1939 England and Wales Register\"] }],\n    },\n  ];\n\n  let refTitle = gd.getRefTitle(ed.titleCollection, recordTypeToRefTitle);\n\n  if (refTitle && refTitle != \"Unclassified\") {\n    return refTitle;\n  }\n\n  let rd = ed.recordData;\n  if (rd) {\n    // A user reported getting \"rd.hasOwnProperty is not a function\" once\n    if (Object.prototype.hasOwnProperty.call(rd, \"Event Type\")) {\n      return rd[\"Event Type\"];\n    }\n\n    if (Object.prototype.hasOwnProperty.call(rd, \"Record Type\")) {\n      return rd[\"Record Type\"];\n    }\n  }\n\n  return \"\";\n}\n\nfunction getImageRefTitle(titleCollection, imageBrowsePath) {\n  const titleCollectionTightMatches = [\n    { title: \"Death\", matches: [\"Death Records\"] },\n    { title: \"Probate\", matches: [\"Probate Records\"] },\n  ];\n\n  const imageBrowsePathTightMatches = [\n    { title: \"Death\", matches: [\"Death Certificates\"] },\n    { title: \"Probate\", matches: [\"Probate Records\"] },\n  ];\n\n  const titleCollectionLooseMatches = [\n    { title: \"Birth\", matches: [\"Birth\"] },\n    { title: \"Baptism\", matches: [\"Baptism\"] },\n    { title: \"Marriage\", matches: [\"Marriage\"] },\n    { title: \"Death\", matches: [\"Death\"] },\n    { title: \"Burial\", matches: [\"Burial\"] },\n    { title: \"Probate\", matches: [\"Probate\"] },\n  ];\n\n  const imageBrowsePathLooseMatches = [\n    { title: \"Birth\", matches: [\"Birth\"] },\n    { title: \"Baptism\", matches: [\"Baptism\"] },\n    { title: \"Marriage\", matches: [\"Marriage\"] },\n    { title: \"Death\", matches: [\"Death\"] },\n    { title: \"Burial\", matches: [\"Burial\"] },\n    { title: \"Probate\", matches: [\"Probate\"] },\n  ];\n\n  function lookup(title, table) {\n    for (let obj of table) {\n      if (obj.matches) {\n        for (let match of obj.matches) {\n          if (title && title.includes(match)) {\n            return obj.title;\n          }\n        }\n      }\n    }\n  }\n\n  if (titleCollection) {\n    let refTitle = lookup(titleCollection, titleCollectionTightMatches);\n    if (refTitle) {\n      return refTitle;\n    }\n  }\n\n  if (imageBrowsePath) {\n    let refTitle = lookup(imageBrowsePath, imageBrowsePathTightMatches);\n    if (refTitle) {\n      return refTitle;\n    }\n  }\n\n  if (titleCollection) {\n    let refTitle = lookup(titleCollection, titleCollectionLooseMatches);\n    if (refTitle) {\n      return refTitle;\n    }\n  }\n\n  if (imageBrowsePath) {\n    let refTitle = lookup(imageBrowsePath, imageBrowsePathLooseMatches);\n    if (refTitle) {\n      return refTitle;\n    }\n  }\n\n  // no matches\n  if (titleCollection && imageBrowsePath) {\n    // choose the shorter one\n    return imageBrowsePath.length < titleCollection.length ? imageBrowsePath : titleCollection;\n  }\n  if (titleCollection) {\n    return titleCollection;\n  }\n  if (imageBrowsePath) {\n    return imageBrowsePath;\n  }\n\n  return \"Unclassified\";\n}\n\nfunction getSharingPageRefTitle(titleCollection) {\n  const titleCollectionMatches = [\n    { title: \"Death\", matches: [\"Death Records\"] },\n    { title: \"Probate\", matches: [\"Probate Records\"] },\n    { title: \"Census\", matches: [\"Census\"] },\n    { title: \"School Records\", matches: [\"School\"] },\n    { title: \"Workhouse Records\", matches: [\"Workhouse\"] },\n    { title: \"Birth or Baptism\", matches: [\"Births and Baptisms\"] },\n    { title: \"Birth\", matches: [\"Births\"] },\n    { title: \"Baptism\", matches: [\"Baptisms\"] },\n    { title: \"Birth\", matches: [\"Birth\"] },\n    { title: \"Baptism\", matches: [\"Baptism\"] },\n  ];\n\n  function lookup(title, table) {\n    for (let obj of table) {\n      if (obj.matches) {\n        for (let match of obj.matches) {\n          if (title && title.includes(match)) {\n            return obj.title;\n          }\n        }\n      }\n    }\n  }\n\n  if (titleCollection) {\n    let refTitle = lookup(titleCollection, titleCollectionMatches);\n    if (refTitle) {\n      if (titleCollection.search(/\\d\\d\\d\\d /) == 0) {\n        refTitle = titleCollection.substring(0, 4) + \" \" + refTitle;\n      }\n      return refTitle;\n    }\n  }\n\n  // no matches\n  if (titleCollection) {\n    return titleCollection;\n  }\n\n  return \"Unclassified\";\n}\n\nfunction modifyValueForUrl(value) {\n  if (value.startsWith(\"https://www.findagrave.com/memorial\")) {\n    let memorialId = value.replace(/^https\\:\\/\\/www\\.findagrave\\.com\\/memorial\\/(\\d+)\\/.*$/, \"$1\");\n    if (memorialId && memorialId != value) {\n      return \"{{FindAGrave|\" + memorialId + \"}}\";\n    }\n  }\n\n  return value;\n}\n\nconst referenceKeys = [\n  [\"reference number\"],\n  [\"registration number\"],\n  [\"declaration number\"],\n  [\"marriage certificate number\"],\n  [\"book\"],\n  [\"piece\"],\n  [\"folio\"],\n  [\"volume\", \"volume number\"],\n  [\"page\", \"page number\", \"os page\"],\n  [\"line\", \"line number\"],\n  [\"roll\"],\n  [\"reel number\"],\n  [\"fhl film number\"],\n  [\"schedule\", \"schedule number\", \"household schedule number\"],\n  [\"household number\"],\n  [\"sub schedule number\", \"sub-schedule number\"],\n  [\"registration district number\"],\n  [\"ed, institution, or vessel\"], // this always seems to be a number\n  [\"enumeration district or census tract\"], // this always seems to be a number\n  [\"newspaper information\"],\n  [\"url\"],\n];\n\nfunction isReferenceKey(key) {\n  let lcKey = key.toLowerCase();\n  for (let keyList of referenceKeys) {\n    if (keyList.includes(lcKey)) {\n      return true;\n    }\n  }\n  return false;\n}\n\nfunction getReferenceKeyListForKey(key) {\n  let lcKey = key.toLowerCase();\n  for (let keyList of referenceKeys) {\n    if (keyList.includes(lcKey)) {\n      return keyList;\n    }\n  }\n  return undefined;\n}\n\nfunction removeUnwantedKeysForTable(keys, recordData) {\n  let newKeys = [];\n\n  for (let key of keys) {\n    if (key.includes(\"Parish Map\") || recordData[key].startsWith(\"View\")) continue;\n\n    if (key.includes(\"Search\") || key.includes(\"Learn More\")) continue;\n\n    // remove SSN for privacy. This could be an option\n    if (key.includes(\"Social Security #\")) continue;\n    if (key == \"SSN\") continue;\n\n    if (isReferenceKey(key)) continue;\n\n    newKeys.push(key);\n  }\n\n  return newKeys;\n}\n\nfunction removeUnwantedKeysForDataString(keys, recordData) {\n  let newKeys = [];\n\n  for (let key of keys) {\n    if (key.includes(\"Parish Map\") || recordData[key].startsWith(\"View\")) continue;\n\n    if (key.includes(\"Search\") || key.includes(\"Learn More\")) continue;\n    if (key.includes(\"as it Appears\") || key.includes(\"Register Type\")) continue;\n    if (key.includes(\"Other Records\") || key.includes(\"Family Members\")) continue;\n\n    // remove SSN for privacy. This could be an option\n    if (key.includes(\"Social Security #\")) continue;\n    if (key == \"SSN\") continue;\n\n    if (isReferenceKey(key)) continue;\n\n    newKeys.push(key);\n  }\n\n  return newKeys;\n}\n\nfunction addReferenceDataToSourceReference(data, builder, options) {\n  if (data.recordData) {\n    let keys = Object.keys(data.recordData);\n\n    if (!builder.sourceReference) {\n      builder.sourceReference = \"\";\n    }\n\n    let itemSep = \";\";\n    let valueSep = \":\";\n    if (options.citation_general_sourceReferenceSeparator == \"commaColon\") {\n      itemSep = \",\";\n      valueSep = \":\";\n    } else if (options.citation_general_sourceReferenceSeparator == \"commaSpace\") {\n      itemSep = \",\";\n      valueSep = \"\";\n    }\n\n    let lcSourceReference = builder.sourceReference.toLowerCase();\n\n    for (let key of keys) {\n      let refKeyList = getReferenceKeyListForKey(key);\n      if (refKeyList) {\n        let value = data.recordData[key];\n\n        if (value) {\n          // can't just test value since it could be something like \"1\"\n          let alreadyInSourceReference = false;\n          for (let refKey of refKeyList) {\n            let matchString = itemSep + \" \" + refKey + valueSep;\n            let startString = refKey + valueSep;\n            if (lcSourceReference.includes(matchString) || lcSourceReference.startsWith(startString)) {\n              // now check value is the same\n              let index = lcSourceReference.indexOf(matchString);\n              let valIndex = 0;\n              if (index == -1) {\n                index = 0; // must be at start\n                valIndex = index + startString.length;\n              } else {\n                valIndex = index + matchString.length;\n              }\n              let endIndex = lcSourceReference.indexOf(itemSep, valIndex);\n              if (endIndex == -1) {\n                endIndex = lcSourceReference.length;\n              }\n              let matchValue = lcSourceReference.substring(valIndex, endIndex).trim();\n              if (matchValue == value) {\n                alreadyInSourceReference = true;\n                break;\n              }\n            }\n          }\n          if (!alreadyInSourceReference) {\n            if (key == \"URL\") {\n              value = modifyValueForUrl(value);\n            }\n\n            if (builder.sourceReference) {\n              builder.sourceReference += itemSep + \" \";\n            }\n            builder.sourceReference += key + valueSep + \" \" + value;\n          }\n        }\n      }\n    }\n  }\n}\n\nfunction cleanSourceCitation(sourceCitation, options) {\n  let string = sourceCitation;\n\n  if (string) {\n    string = string.replace(/\\;?\\s*Social Security\\:\\s*\\d+/, \"\");\n  }\n\n  if (\n    string &&\n    (options.citation_general_sourceReferenceSeparator == \"commaColon\" ||\n      options.citation_general_sourceReferenceSeparator == \"commaSpace\")\n  ) {\n    // Ancestry uses semi-colon separator by default, if user wants comma replace ; with ,\n    string = string.replace(/\\; /g, \", \");\n\n    if (options.citation_general_sourceReferenceSeparator == \"commaSpace\") {\n      string = string.replace(/\\: /g, \" \");\n    }\n  }\n\n  return string;\n}\n\nfunction getOneOfPossibleFieldNames(recordData, names) {\n  for (let name of names) {\n    let value = getCleanRecordDataValue(recordData, name);\n    if (value) {\n      return value;\n    }\n  }\n}\n\nfunction buildCustomDataString(gd, options) {\n  let input = {\n    generalizedData: gd,\n    options: options,\n  };\n  return _base_core_data_string_mjs__WEBPACK_IMPORTED_MODULE_1__.DataString.buildDataString(input);\n}\n\nfunction buildDataString(data, gd, dataStyle, options, builder) {\n  let dataString = \"\";\n\n  if (dataStyle == \"string\") {\n    dataString = buildCustomDataString(gd, options);\n    if (dataString) {\n      return dataString;\n    }\n  }\n\n  // build a list string\n  let recordData = data.recordData;\n\n  dataString = \"\";\n\n  let itemSep = \";\";\n  let valueSep = \":\";\n  if (options.citation_general_dataListSeparator == \"commaColon\") {\n    itemSep = \",\";\n    valueSep = \":\";\n  } else if (options.citation_general_dataListSeparator == \"commaSpace\") {\n    itemSep = \",\";\n    valueSep = \"\";\n  }\n\n  if (recordData) {\n    let keys = Object.keys(recordData);\n    keys = removeUnwantedKeysForDataString(keys, recordData);\n    for (let key of keys) {\n      let value = recordData[key];\n      if (value) {\n        if (dataString != \"\") {\n          dataString += itemSep + \" \";\n        }\n        if (key.startsWith(\"Household Members\") || key.startsWith(\"Household Member(s)\")) {\n          if (!builder.householdTableString) {\n            let newKey = key.replace(/\\<br\\/\\>/g, \" \");\n            if (options.citation_general_addBreaksWithinBody) {\n              dataString += \"<br/>\";\n              dataString += newKey + valueSep + \"<br/>\" + value;\n            } else {\n              let newValue = value.replace(/\\<br\\/\\>/g, \", \");\n              dataString += newKey + valueSep + \" \" + newValue;\n            }\n          }\n        } else if (value.indexOf(\"<br/>\") != -1 && !options.citation_general_addBreaksWithinBody) {\n          let newValue = value.replace(/\\<br\\/\\>/g, \", \");\n          dataString += key + valueSep + \" \" + newValue;\n        } else {\n          dataString += key + valueSep + \" \" + value;\n        }\n      }\n    }\n  } else {\n    let titleName = data.titleName;\n    if (!titleName && recordData) {\n      let name = getOneOfPossibleFieldNames(recordData, [\"Name\"]);\n      if (name) {\n        titleName = name;\n      }\n    }\n\n    dataString += titleName;\n  }\n\n  return dataString;\n}\n\nfunction getAdditionalInfo(data, gd, citationType, options, builder) {\n  let dataStyle = options.citation_ancestry_dataStyle;\n  if (dataStyle == \"none\") {\n    return \"\";\n  } else if (dataStyle == \"table\") {\n    if (options.citation_general_referencePosition == \"atEnd\") {\n      dataStyle = \"string\";\n    } else if (citationType == \"source\") {\n      dataStyle = \"list\";\n    }\n  }\n\n  if (dataStyle == \"string\" || dataStyle == \"list\") {\n    return buildDataString(data, gd, dataStyle, options, builder);\n  }\n\n  // style must be table\n  var result = \"\";\n  let recordData = data.recordData;\n  if (recordData) {\n    let keys = Object.keys(recordData);\n\n    keys = removeUnwantedKeysForTable(keys, recordData);\n    if (keys.length > 0) {\n      // start table\n      result = '{| border=\"1\"\\n';\n      let firstRow = true;\n\n      for (let key of keys) {\n        if (firstRow) {\n          firstRow = false;\n        } else {\n          result += \"|-\\n\";\n        }\n        result += \"| \" + key + \" || \" + recordData[key] + \"\\n\";\n      }\n\n      result += \"|}\";\n    }\n  }\n\n  return result;\n}\n\nfunction buildAncestryRecordTemplate(data, options) {\n  const domainParams = {\n    com: \"\",\n    \"co.uk\": \"uk\",\n    ca: \"ca\",\n    \"com.au\": \"au\",\n    de: \"de\",\n    it: \"it\",\n    fr: \"fr\",\n    se: \"se\",\n    mx: \"mx\",\n  };\n\n  let domainParam = undefined;\n\n  if (options.citation_ancestry_recordTemplateDomain == \"fromRecord\") {\n    domainParam = domainParams[data.domain];\n  } else {\n    let fullDomain = options.citation_ancestry_recordTemplateDomain;\n    let domain = fullDomain.replace(/ancestry.(.+)$/, \"$1\");\n    if (domain && domain != fullDomain) {\n      domainParam = domainParams[domain];\n    }\n  }\n\n  if (domainParam) {\n    return \"{{Ancestry Record|\" + data.dbId + \"|\" + data.recordId + \"|\" + domainParam + \"}}\";\n  }\n\n  return \"{{Ancestry Record|\" + data.dbId + \"|\" + data.recordId + \"}}\";\n}\n\nfunction buildAncestryImageTemplate(data, options) {\n  // Note that the Ancestry Image template has no 3rd (domain parameter)\n  return \"{{Ancestry Image|\" + data.dbId + \"|\" + data.recordId + \"}}\";\n}\n\nfunction buildAncestrySharingTemplateFromSharingDataObj(dataObj) {\n  // V1 versions\n  // https://www.ancestry.com/sharing/24274440?h=95cf5c\n  let num1 = dataObj.id;\n  let num2 = dataObj.hmac_id;\n\n  // V2 versions\n  if (dataObj.v2 && dataObj.v2.share_id && dataObj.v2.share_token) {\n    num1 = dataObj.v2.share_id;\n    num2 = dataObj.v2.share_token;\n  }\n\n  if (num1 && num2) {\n    let template = \"{{Ancestry Sharing|\" + num1 + \"|\" + num2 + \"}}\";\n    return template;\n  }\n}\n\nfunction cleanOriginalData(text) {\n  text = text.replace(/^Crown copyright images reproduced [^.]*\\./, \"\");\n  text = text.trim();\n\n  // remove bad Find a Grave links\n  text = text.replace(/^Find a Grave\\.\\s+Find a Grave\\./, \"Find a Grave.\");\n  text = text.trim();\n  text = text.replace(/^Find a Grave\\.\\s+http\\:\\/\\/www\\.findagrave\\.com\\/cgi\\-bin\\/fg\\.cgi\\.?/, \"\");\n  text = text.trim();\n\n  // The Original data string can get quite long and often has verbose ownership verbiage on the end that if not part\n  // of a normal citation. Note that this Original Data string is only used when there is no Source Citation string.\n  const endings = [\n    \"©\",\n    \"Crown copyright\",\n    \"Copyright\",\n    \"copyright\",\n    \"Published by permission\",\n    \"Used by permission\",\n    \"You must not\",\n    \"The Vitalsearch Company Worldwide\",\n  ];\n  for (let ending of endings) {\n    let index = text.indexOf(ending);\n    if (index != -1) {\n      text = text.substring(0, index);\n      let lastPeriodIndex = text.lastIndexOf(\".\");\n      if (lastPeriodIndex != -1) {\n        text = text.substring(0, lastPeriodIndex);\n      } else {\n        text = \"\";\n      }\n    }\n  }\n\n  // Remove links to VitalSearch as they may break or become malicious at some point\n  text = text.replace(\" (www.vitalsearch-worldwide.com)\", \"\");\n\n  // Sometimes there is duplicated information or the collection title is repeated in the Orginal data.\n  // A common example is:\n  // \"General Register Office. England and Wales Civil Registration Indexes. London, England: General Register Office\"\n  // Can we generically handle that?\n  let firstPeriodIndex = text.indexOf(\".\");\n  if (firstPeriodIndex != -1) {\n    let startText = text.substring(0, firstPeriodIndex);\n    if (text.length > firstPeriodIndex * 2) {\n      if (text.endsWith(startText)) {\n        // remove the duplicated sentence from the start\n        text = text.substring(firstPeriodIndex + 1).trim();\n      }\n    }\n  }\n\n  // replace weird hyphens with regular ones\n  text = text.replace(\"–\", \"-\");\n\n  // remove any trailing punctuation\n  text = text.replace(/[.,;]$/g, \"\");\n\n  text = text.trim();\n\n  return text;\n}\n\nfunction buildSourceReference(data, options) {\n  let sourceReference = data.sourceCitation;\n\n  if (!sourceReference && data.originalData) {\n    sourceReference = cleanOriginalData(data.originalData);\n  }\n\n  return cleanSourceCitation(sourceReference, options);\n}\n\nfunction buildCoreCitation(data, gd, options, sharingDataObj, builder) {\n  //console.log(\"buildCoreCitation, sharingDataObj is\");\n  //console.log(sharingDataObj);\n  //console.log(\"buildCoreCitation, data is\");\n  //console.log(data);\n\n  builder.sourceTitle = data.titleCollection;\n  builder.sourceReference = buildSourceReference(data, options);\n  addReferenceDataToSourceReference(data, builder, options);\n\n  if (sharingDataObj) {\n    let template = buildAncestrySharingTemplateFromSharingDataObj(sharingDataObj);\n    builder.sharingLinkOrTemplate = template;\n    builder.databaseHasImages = true;\n  }\n\n  builder.recordLinkOrTemplate = buildAncestryRecordTemplate(data, options);\n\n  let additionalInfo = getAdditionalInfo(data, gd, builder.type, options, builder);\n  if (additionalInfo) {\n    builder.dataString = additionalInfo;\n  }\n}\n\nfunction buildImageCitation(data, options, sharingDataObj, builder) {\n  builder.sourceTitle = data.titleCollection;\n  builder.databaseHasImages = true;\n\n  let sourceReference = data.imageBrowsePath;\n  if (data.totalImages && data.imageNumber) {\n    if (sourceReference) {\n      sourceReference += \" > \";\n    }\n    sourceReference += \"image \" + data.imageNumber + \" of \" + data.totalImages;\n  }\n  if (sourceReference) {\n    builder.sourceReference = sourceReference;\n  }\n\n  if (sharingDataObj) {\n    let template = buildAncestrySharingTemplateFromSharingDataObj(sharingDataObj);\n    builder.sharingLinkOrTemplate = template;\n  }\n\n  // builder.recordLinkOrTemplate = \"Ancestry \" + buildAncestryImageTemplate(data, options) + \" \" + data.dbId + \" \" + data.recordId;\n  builder.recordLinkOrTemplate = \"Ancestry \" + buildAncestryImageTemplate(data, options);\n\n  builder.dataString = data.titleName;\n\n  builder.meaningfulTitle = getImageRefTitle(data.titleCollection, data.imageBrowsePath);\n}\n\nfunction buildSharingPageCitation(data, options, builder) {\n  builder.sourceTitle = data.titleCollection;\n  builder.databaseHasImages = true;\n\n  // no source reference\n\n  if (data.ancestryTemplate) {\n    builder.sharingLinkOrTemplate = data.ancestryTemplate;\n  }\n\n  if (data.dbId && data.recordId) {\n    if (data.sharingType == \"v1\") {\n      builder.recordLinkOrTemplate = \"Ancestry \" + buildAncestryImageTemplate(data, options);\n    } else {\n      builder.recordLinkOrTemplate = buildAncestryRecordTemplate(data, options);\n    }\n  }\n\n  builder.dataString = data.personNarrative;\n\n  builder.meaningfulTitle = getSharingPageRefTitle(data.titleCollection, data.personNarrative);\n}\n\nfunction buildCitation(input) {\n  const data = input.extractedData;\n  const gd = input.generalizedData;\n  const runDate = input.runDate;\n  const sharingDataObj = input.sharingDataObj;\n  const options = input.options;\n  const type = input.type; // \"inline\", \"narrative\" or \"source\"\n\n  let builder = new _base_core_citation_builder_mjs__WEBPACK_IMPORTED_MODULE_0__.CitationBuilder(type, runDate, options);\n  builder.householdTableString = input.householdTableString;\n  builder.includeSubscriptionRequired = options.citation_ancestry_subscriptionRequired;\n\n  if (data.pageType == \"record\") {\n    buildCoreCitation(data, gd, options, sharingDataObj, builder);\n\n    var refTitle = getRefTitle(data, gd);\n    builder.meaningfulTitle = refTitle;\n\n    if (type == \"narrative\") {\n      builder.addNarrative(gd, input.dataCache, options);\n    }\n  } else if (data.pageType == \"image\") {\n    buildImageCitation(data, options, sharingDataObj, builder);\n  } else if (data.pageType == \"sharingImageOrRecord\") {\n    buildSharingPageCitation(data, options, builder);\n  }\n\n  // now the builder is setup use it to build the citation text\n  let fullCitation = builder.getCitationString();\n\n  var citationObject = {\n    citation: fullCitation,\n    type: type,\n  };\n\n  return citationObject;\n}\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9leHRlbnNpb24vc2l0ZS9hbmNlc3RyeS9jb3JlL2FuY2VzdHJ5X2J1aWxkX2NpdGF0aW9uLm1qcy5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUUwRTtBQUNWO0FBQ1I7O0FBRXhEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsWUFBWSxpRUFBUztBQUNyQjtBQUNBO0FBQ0EsdUJBQXVCLGlFQUFpRTtBQUN4RixLQUFLO0FBQ0w7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxNQUFNLDRDQUE0QztBQUNsRCxNQUFNLGdEQUFnRDtBQUN0RDs7QUFFQTtBQUNBLE1BQU0saURBQWlEO0FBQ3ZELE1BQU0sZ0RBQWdEO0FBQ3REOztBQUVBO0FBQ0EsTUFBTSxvQ0FBb0M7QUFDMUMsTUFBTSx3Q0FBd0M7QUFDOUMsTUFBTSwwQ0FBMEM7QUFDaEQsTUFBTSxvQ0FBb0M7QUFDMUMsTUFBTSxzQ0FBc0M7QUFDNUMsTUFBTSx3Q0FBd0M7QUFDOUM7O0FBRUE7QUFDQSxNQUFNLG9DQUFvQztBQUMxQyxNQUFNLHdDQUF3QztBQUM5QyxNQUFNLDBDQUEwQztBQUNoRCxNQUFNLG9DQUFvQztBQUMxQyxNQUFNLHNDQUFzQztBQUM1QyxNQUFNLHdDQUF3QztBQUM5Qzs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNB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QUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQkFBMkI7O0FBRTNCLG9CQUFvQiw0RUFBZTtBQUNuQztBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQSxJQUFJO0FBQ0o7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRXlCIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vQ2l0YXRpb25FeHRyYWN0b3IvLi9leHRlbnNpb24vc2l0ZS9hbmNlc3RyeS9jb3JlL2FuY2VzdHJ5X2J1aWxkX2NpdGF0aW9uLm1qcz8wOTI1Il0sInNvdXJjZXNDb250ZW50IjpbIi8qXG5NSVQgTGljZW5zZVxuXG5Db3B5cmlnaHQgKGMpIDIwMjAgUm9iZXJ0IE0gUGF2ZXlcblxuUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEgY29weVxub2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGUgXCJTb2Z0d2FyZVwiKSwgdG8gZGVhbFxuaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVzdHJpY3Rpb24sIGluY2x1ZGluZyB3aXRob3V0IGxpbWl0YXRpb24gdGhlIHJpZ2h0c1xudG8gdXNlLCBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLCBkaXN0cmlidXRlLCBzdWJsaWNlbnNlLCBhbmQvb3Igc2VsbFxuY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzXG5mdXJuaXNoZWQgdG8gZG8gc28sIHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZyBjb25kaXRpb25zOlxuXG5UaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZCBpbiBhbGxcbmNvcGllcyBvciBzdWJzdGFudGlhbCBwb3J0aW9ucyBvZiB0aGUgU29mdHdhcmUuXG5cblRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCBcIkFTIElTXCIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1JcbklNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLFxuRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFXG5BVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSXG5MSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLFxuT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTiBUSEVcblNPRlRXQVJFLlxuKi9cblxuaW1wb3J0IHsgQ2l0YXRpb25CdWlsZGVyIH0gZnJvbSBcIi4uLy4uLy4uL2Jhc2UvY29yZS9jaXRhdGlvbl9idWlsZGVyLm1qc1wiO1xuaW1wb3J0IHsgRGF0YVN0cmluZyB9IGZyb20gXCIuLi8uLi8uLi9iYXNlL2NvcmUvZGF0YV9zdHJpbmcubWpzXCI7XG5pbXBvcnQgeyBSVCB9IGZyb20gXCIuLi8uLi8uLi9iYXNlL2NvcmUvcmVjb3JkX3R5cGUubWpzXCI7XG5cbmZ1bmN0aW9uIGdldENsZWFuUmVjb3JkRGF0YVZhbHVlKHJlY29yZERhdGEsIGZpZWxkTmFtZSkge1xuICBsZXQgdmFsdWUgPSByZWNvcmREYXRhW2ZpZWxkTmFtZV07XG4gIGlmICh2YWx1ZSA9PSB1bmRlZmluZWQpIHtcbiAgICByZXR1cm4gdmFsdWU7XG4gIH1cblxuICAvLyBzb21ldGltZXMgdGhlcmUgYXJlIHZhbHVlcyBpbiBzcXVhcmUgYnJhY2tldHMgYWZ0ZXIgdGhlIGZpcnN0IHZhbHVlXG4gIC8vIHRoZXNlIG1ha2UgaXQgaGFyZCB0byBwYXJzZSBkYXRlcywgcGxhY2VzLCBuYW1lcyBldGMgc28gcmVtb3ZlIHRoZW1cbiAgbGV0IGJyYWNrZXRJbmRleCA9IHZhbHVlLmluZGV4T2YoXCJbXCIpO1xuICBpZiAoYnJhY2tldEluZGV4ICE9IC0xKSB7XG4gICAgdmFsdWUgPSB2YWx1ZS5zdWJzdHJpbmcoMCwgYnJhY2tldEluZGV4KS50cmltKCk7XG4gIH1cblxuICByZXR1cm4gdmFsdWU7XG59XG5cbmZ1bmN0aW9uIGdldFJlZlRpdGxlKGVkLCBnZCkge1xuICBjb25zdCByZWNvcmRUeXBlVG9SZWZUaXRsZSA9IFtcbiAgICB7XG4gICAgICB0eXBlOiBSVC5DZW5zdXMsXG4gICAgICBkZWZhdWx0VGl0bGU6IFwiQ2Vuc3VzXCIsXG4gICAgICBhZGRZZWFyOiB0cnVlLFxuICAgICAgdGl0bGVNYXRjaGVzOiBbeyB0aXRsZTogXCJSZWdpc3RlclwiLCBtYXRjaGVzOiBbXCIxOTM5IEVuZ2xhbmQgYW5kIFdhbGVzIFJlZ2lzdGVyXCJdIH1dLFxuICAgIH0sXG4gIF07XG5cbiAgbGV0IHJlZlRpdGxlID0gZ2QuZ2V0UmVmVGl0bGUoZWQudGl0bGVDb2xsZWN0aW9uLCByZWNvcmRUeXBlVG9SZWZUaXRsZSk7XG5cbiAgaWYgKHJlZlRpdGxlICYmIHJlZlRpdGxlICE9IFwiVW5jbGFzc2lmaWVkXCIpIHtcbiAgICByZXR1cm4gcmVmVGl0bGU7XG4gIH1cblxuICBsZXQgcmQgPSBlZC5yZWNvcmREYXRhO1xuICBpZiAocmQpIHtcbiAgICAvLyBBIHVzZXIgcmVwb3J0ZWQgZ2V0dGluZyBcInJkLmhhc093blByb3BlcnR5IGlzIG5vdCBhIGZ1bmN0aW9uXCIgb25jZVxuICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwocmQsIFwiRXZlbnQgVHlwZVwiKSkge1xuICAgICAgcmV0dXJuIHJkW1wiRXZlbnQgVHlwZVwiXTtcbiAgICB9XG5cbiAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHJkLCBcIlJlY29yZCBUeXBlXCIpKSB7XG4gICAgICByZXR1cm4gcmRbXCJSZWNvcmQgVHlwZVwiXTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gXCJcIjtcbn1cblxuZnVuY3Rpb24gZ2V0SW1hZ2VSZWZUaXRsZSh0aXRsZUNvbGxlY3Rpb24sIGltYWdlQnJvd3NlUGF0aCkge1xuICBjb25zdCB0aXRsZUNvbGxlY3Rpb25UaWdodE1hdGNoZXMgPSBbXG4gICAgeyB0aXRsZTogXCJEZWF0aFwiLCBtYXRjaGVzOiBbXCJEZWF0aCBSZWNvcmRzXCJdIH0sXG4gICAgeyB0aXRsZTogXCJQcm9iYXRlXCIsIG1hdGNoZXM6IFtcIlByb2JhdGUgUmVjb3Jkc1wiXSB9LFxuICBdO1xuXG4gIGNvbnN0IGltYWdlQnJvd3NlUGF0aFRpZ2h0TWF0Y2hlcyA9IFtcbiAgICB7IHRpdGxlOiBcIkRlYXRoXCIsIG1hdGNoZXM6IFtcIkRlYXRoIENlcnRpZmljYXRlc1wiXSB9LFxuICAgIHsgdGl0bGU6IFwiUHJvYmF0ZVwiLCBtYXRjaGVzOiBbXCJQcm9iYXRlIFJlY29yZHNcIl0gfSxcbiAgXTtcblxuICBjb25zdCB0aXRsZUNvbGxlY3Rpb25Mb29zZU1hdGNoZXMgPSBbXG4gICAgeyB0aXRsZTogXCJCaXJ0aFwiLCBtYXRjaGVzOiBbXCJCaXJ0aFwiXSB9LFxuICAgIHsgdGl0bGU6IFwiQmFwdGlzbVwiLCBtYXRjaGVzOiBbXCJCYXB0aXNtXCJdIH0sXG4gICAgeyB0aXRsZTogXCJNYXJyaWFnZVwiLCBtYXRjaGVzOiBbXCJNYXJyaWFnZVwiXSB9LFxuICAgIHsgdGl0bGU6IFwiRGVhdGhcIiwgbWF0Y2hlczogW1wiRGVhdGhcIl0gfSxcbiAgICB7IHRpdGxlOiBcIkJ1cmlhbFwiLCBtYXRjaGVzOiBbXCJCdXJpYWxcIl0gfSxcbiAgICB7IHRpdGxlOiBcIlByb2JhdGVcIiwgbWF0Y2hlczogW1wiUHJvYmF0ZVwiXSB9LFxuICBdO1xuXG4gIGNvbnN0IGltYWdlQnJvd3NlUGF0aExvb3NlTWF0Y2hlcyA9IFtcbiAgICB7IHRpdGxlOiBcIkJpcnRoXCIsIG1hdGNoZXM6IFtcIkJpcnRoXCJdIH0sXG4gICAgeyB0aXRsZTogXCJCYXB0aXNtXCIsIG1hdGNoZXM6IFtcIkJhcHRpc21cIl0gfSxcbiAgICB7IHRpdGxlOiBcIk1hcnJpYWdlXCIsIG1hdGNoZXM6IFtcIk1hcnJpYWdlXCJdIH0sXG4gICAgeyB0aXRsZTogXCJEZWF0aFwiLCBtYXRjaGVzOiBbXCJEZWF0aFwiXSB9LFxuICAgIHsgdGl0bGU6IFwiQnVyaWFsXCIsIG1hdGNoZXM6IFtcIkJ1cmlhbFwiXSB9LFxuICAgIHsgdGl0bGU6IFwiUHJvYmF0ZVwiLCBtYXRjaGVzOiBbXCJQcm9iYXRlXCJdIH0sXG4gIF07XG5cbiAgZnVuY3Rpb24gbG9va3VwKHRpdGxlLCB0YWJsZSkge1xuICAgIGZvciAobGV0IG9iaiBvZiB0YWJsZSkge1xuICAgICAgaWYgKG9iai5tYXRjaGVzKSB7XG4gICAgICAgIGZvciAobGV0IG1hdGNoIG9mIG9iai5tYXRjaGVzKSB7XG4gICAgICAgICAgaWYgKHRpdGxlICYmIHRpdGxlLmluY2x1ZGVzKG1hdGNoKSkge1xuICAgICAgICAgICAgcmV0dXJuIG9iai50aXRsZTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBpZiAodGl0bGVDb2xsZWN0aW9uKSB7XG4gICAgbGV0IHJlZlRpdGxlID0gbG9va3VwKHRpdGxlQ29sbGVjdGlvbiwgdGl0bGVDb2xsZWN0aW9uVGlnaHRNYXRjaGVzKTtcbiAgICBpZiAocmVmVGl0bGUpIHtcbiAgICAgIHJldHVybiByZWZUaXRsZTtcbiAgICB9XG4gIH1cblxuICBpZiAoaW1hZ2VCcm93c2VQYXRoKSB7XG4gICAgbGV0IHJlZlRpdGxlID0gbG9va3VwKGltYWdlQnJvd3NlUGF0aCwgaW1hZ2VCcm93c2VQYXRoVGlnaHRNYXRjaGVzKTtcbiAgICBpZiAocmVmVGl0bGUpIHtcbiAgICAgIHJldHVybiByZWZUaXRsZTtcbiAgICB9XG4gIH1cblxuICBpZiAodGl0bGVDb2xsZWN0aW9uKSB7XG4gICAgbGV0IHJlZlRpdGxlID0gbG9va3VwKHRpdGxlQ29sbGVjdGlvbiwgdGl0bGVDb2xsZWN0aW9uTG9vc2VNYXRjaGVzKTtcbiAgICBpZiAocmVmVGl0bGUpIHtcbiAgICAgIHJldHVybiByZWZUaXRsZTtcbiAgICB9XG4gIH1cblxuICBpZiAoaW1hZ2VCcm93c2VQYXRoKSB7XG4gICAgbGV0IHJlZlRpdGxlID0gbG9va3VwKGltYWdlQnJvd3NlUGF0aCwgaW1hZ2VCcm93c2VQYXRoTG9vc2VNYXRjaGVzKTtcbiAgICBpZiAocmVmVGl0bGUpIHtcbiAgICAgIHJldHVybiByZWZUaXRsZTtcbiAgICB9XG4gIH1cblxuICAvLyBubyBtYXRjaGVzXG4gIGlmICh0aXRsZUNvbGxlY3Rpb24gJiYgaW1hZ2VCcm93c2VQYXRoKSB7XG4gICAgLy8gY2hvb3NlIHRoZSBzaG9ydGVyIG9uZVxuICAgIHJldHVybiBpbWFnZUJyb3dzZVBhdGgubGVuZ3RoIDwgdGl0bGVDb2xsZWN0aW9uLmxlbmd0aCA/IGltYWdlQnJvd3NlUGF0aCA6IHRpdGxlQ29sbGVjdGlvbjtcbiAgfVxuICBpZiAodGl0bGVDb2xsZWN0aW9uKSB7XG4gICAgcmV0dXJuIHRpdGxlQ29sbGVjdGlvbjtcbiAgfVxuICBpZiAoaW1hZ2VCcm93c2VQYXRoKSB7XG4gICAgcmV0dXJuIGltYWdlQnJvd3NlUGF0aDtcbiAgfVxuXG4gIHJldHVybiBcIlVuY2xhc3NpZmllZFwiO1xufVxuXG5mdW5jdGlvbiBnZXRTaGFyaW5nUGFnZVJlZlRpdGxlKHRpdGxlQ29sbGVjdGlvbikge1xuICBjb25zdCB0aXRsZUNvbGxlY3Rpb25NYXRjaGVzID0gW1xuICAgIHsgdGl0bGU6IFwiRGVhdGhcIiwgbWF0Y2hlczogW1wiRGVhdGggUmVjb3Jkc1wiXSB9LFxuICAgIHsgdGl0bGU6IFwiUHJvYmF0ZVwiLCBtYXRjaGVzOiBbXCJQcm9iYXRlIFJlY29yZHNcIl0gfSxcbiAgICB7IHRpdGxlOiBcIkNlbnN1c1wiLCBtYXRjaGVzOiBbXCJDZW5zdXNcIl0gfSxcbiAgICB7IHRpdGxlOiBcIlNjaG9vbCBSZWNvcmRzXCIsIG1hdGNoZXM6IFtcIlNjaG9vbFwiXSB9LFxuICAgIHsgdGl0bGU6IFwiV29ya2hvdXNlIFJlY29yZHNcIiwgbWF0Y2hlczogW1wiV29ya2hvdXNlXCJdIH0sXG4gICAgeyB0aXRsZTogXCJCaXJ0aCBvciBCYXB0aXNtXCIsIG1hdGNoZXM6IFtcIkJpcnRocyBhbmQgQmFwdGlzbXNcIl0gfSxcbiAgICB7IHRpdGxlOiBcIkJpcnRoXCIsIG1hdGNoZXM6IFtcIkJpcnRoc1wiXSB9LFxuICAgIHsgdGl0bGU6IFwiQmFwdGlzbVwiLCBtYXRjaGVzOiBbXCJCYXB0aXNtc1wiXSB9LFxuICAgIHsgdGl0bGU6IFwiQmlydGhcIiwgbWF0Y2hlczogW1wiQmlydGhcIl0gfSxcbiAgICB7IHRpdGxlOiBcIkJhcHRpc21cIiwgbWF0Y2hlczogW1wiQmFwdGlzbVwiXSB9LFxuICBdO1xuXG4gIGZ1bmN0aW9uIGxvb2t1cCh0aXRsZSwgdGFibGUpIHtcbiAgICBmb3IgKGxldCBvYmogb2YgdGFibGUpIHtcbiAgICAgIGlmIChvYmoubWF0Y2hlcykge1xuICAgICAgICBmb3IgKGxldCBtYXRjaCBvZiBvYmoubWF0Y2hlcykge1xuICAgICAgICAgIGlmICh0aXRsZSAmJiB0aXRsZS5pbmNsdWRlcyhtYXRjaCkpIHtcbiAgICAgICAgICAgIHJldHVybiBvYmoudGl0bGU7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgaWYgKHRpdGxlQ29sbGVjdGlvbikge1xuICAgIGxldCByZWZUaXRsZSA9IGxvb2t1cCh0aXRsZUNvbGxlY3Rpb24sIHRpdGxlQ29sbGVjdGlvbk1hdGNoZXMpO1xuICAgIGlmIChyZWZUaXRsZSkge1xuICAgICAgaWYgKHRpdGxlQ29sbGVjdGlvbi5zZWFyY2goL1xcZFxcZFxcZFxcZCAvKSA9PSAwKSB7XG4gICAgICAgIHJlZlRpdGxlID0gdGl0bGVDb2xsZWN0aW9uLnN1YnN0cmluZygwLCA0KSArIFwiIFwiICsgcmVmVGl0bGU7XG4gICAgICB9XG4gICAgICByZXR1cm4gcmVmVGl0bGU7XG4gICAgfVxuICB9XG5cbiAgLy8gbm8gbWF0Y2hlc1xuICBpZiAodGl0bGVDb2xsZWN0aW9uKSB7XG4gICAgcmV0dXJuIHRpdGxlQ29sbGVjdGlvbjtcbiAgfVxuXG4gIHJldHVybiBcIlVuY2xhc3NpZmllZFwiO1xufVxuXG5mdW5jdGlvbiBtb2RpZnlWYWx1ZUZvclVybCh2YWx1ZSkge1xuICBpZiAodmFsdWUuc3RhcnRzV2l0aChcImh0dHBzOi8vd3d3LmZpbmRhZ3JhdmUuY29tL21lbW9yaWFsXCIpKSB7XG4gICAgbGV0IG1lbW9yaWFsSWQgPSB2YWx1ZS5yZXBsYWNlKC9eaHR0cHNcXDpcXC9cXC93d3dcXC5maW5kYWdyYXZlXFwuY29tXFwvbWVtb3JpYWxcXC8oXFxkKylcXC8uKiQvLCBcIiQxXCIpO1xuICAgIGlmIChtZW1vcmlhbElkICYmIG1lbW9yaWFsSWQgIT0gdmFsdWUpIHtcbiAgICAgIHJldHVybiBcInt7RmluZEFHcmF2ZXxcIiArIG1lbW9yaWFsSWQgKyBcIn19XCI7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHZhbHVlO1xufVxuXG5jb25zdCByZWZlcmVuY2VLZXlzID0gW1xuICBbXCJyZWZlcmVuY2UgbnVtYmVyXCJdLFxuICBbXCJyZWdpc3RyYXRpb24gbnVtYmVyXCJdLFxuICBbXCJkZWNsYXJhdGlvbiBudW1iZXJcIl0sXG4gIFtcIm1hcnJpYWdlIGNlcnRpZmljYXRlIG51bWJlclwiXSxcbiAgW1wiYm9va1wiXSxcbiAgW1wicGllY2VcIl0sXG4gIFtcImZvbGlvXCJdLFxuICBbXCJ2b2x1bWVcIiwgXCJ2b2x1bWUgbnVtYmVyXCJdLFxuICBbXCJwYWdlXCIsIFwicGFnZSBudW1iZXJcIiwgXCJvcyBwYWdlXCJdLFxuICBbXCJsaW5lXCIsIFwibGluZSBudW1iZXJcIl0sXG4gIFtcInJvbGxcIl0sXG4gIFtcInJlZWwgbnVtYmVyXCJdLFxuICBbXCJmaGwgZmlsbSBudW1iZXJcIl0sXG4gIFtcInNjaGVkdWxlXCIsIFwic2NoZWR1bGUgbnVtYmVyXCIsIFwiaG91c2Vob2xkIHNjaGVkdWxlIG51bWJlclwiXSxcbiAgW1wiaG91c2Vob2xkIG51bWJlclwiXSxcbiAgW1wic3ViIHNjaGVkdWxlIG51bWJlclwiLCBcInN1Yi1zY2hlZHVsZSBudW1iZXJcIl0sXG4gIFtcInJlZ2lzdHJhdGlvbiBkaXN0cmljdCBudW1iZXJcIl0sXG4gIFtcImVkLCBpbnN0aXR1dGlvbiwgb3IgdmVzc2VsXCJdLCAvLyB0aGlzIGFsd2F5cyBzZWVtcyB0byBiZSBhIG51bWJlclxuICBbXCJlbnVtZXJhdGlvbiBkaXN0cmljdCBvciBjZW5zdXMgdHJhY3RcIl0sIC8vIHRoaXMgYWx3YXlzIHNlZW1zIHRvIGJlIGEgbnVtYmVyXG4gIFtcIm5ld3NwYXBlciBpbmZvcm1hdGlvblwiXSxcbiAgW1widXJsXCJdLFxuXTtcblxuZnVuY3Rpb24gaXNSZWZlcmVuY2VLZXkoa2V5KSB7XG4gIGxldCBsY0tleSA9IGtleS50b0xvd2VyQ2FzZSgpO1xuICBmb3IgKGxldCBrZXlMaXN0IG9mIHJlZmVyZW5jZUtleXMpIHtcbiAgICBpZiAoa2V5TGlzdC5pbmNsdWRlcyhsY0tleSkpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgfVxuICByZXR1cm4gZmFsc2U7XG59XG5cbmZ1bmN0aW9uIGdldFJlZmVyZW5jZUtleUxpc3RGb3JLZXkoa2V5KSB7XG4gIGxldCBsY0tleSA9IGtleS50b0xvd2VyQ2FzZSgpO1xuICBmb3IgKGxldCBrZXlMaXN0IG9mIHJlZmVyZW5jZUtleXMpIHtcbiAgICBpZiAoa2V5TGlzdC5pbmNsdWRlcyhsY0tleSkpIHtcbiAgICAgIHJldHVybiBrZXlMaXN0O1xuICAgIH1cbiAgfVxuICByZXR1cm4gdW5kZWZpbmVkO1xufVxuXG5mdW5jdGlvbiByZW1vdmVVbndhbnRlZEtleXNGb3JUYWJsZShrZXlzLCByZWNvcmREYXRhKSB7XG4gIGxldCBuZXdLZXlzID0gW107XG5cbiAgZm9yIChsZXQga2V5IG9mIGtleXMpIHtcbiAgICBpZiAoa2V5LmluY2x1ZGVzKFwiUGFyaXNoIE1hcFwiKSB8fCByZWNvcmREYXRhW2tleV0uc3RhcnRzV2l0aChcIlZpZXdcIikpIGNvbnRpbnVlO1xuXG4gICAgaWYgKGtleS5pbmNsdWRlcyhcIlNlYXJjaFwiKSB8fCBrZXkuaW5jbHVkZXMoXCJMZWFybiBNb3JlXCIpKSBjb250aW51ZTtcblxuICAgIC8vIHJlbW92ZSBTU04gZm9yIHByaXZhY3kuIFRoaXMgY291bGQgYmUgYW4gb3B0aW9uXG4gICAgaWYgKGtleS5pbmNsdWRlcyhcIlNvY2lhbCBTZWN1cml0eSAjXCIpKSBjb250aW51ZTtcbiAgICBpZiAoa2V5ID09IFwiU1NOXCIpIGNvbnRpbnVlO1xuXG4gICAgaWYgKGlzUmVmZXJlbmNlS2V5KGtleSkpIGNvbnRpbnVlO1xuXG4gICAgbmV3S2V5cy5wdXNoKGtleSk7XG4gIH1cblxuICByZXR1cm4gbmV3S2V5cztcbn1cblxuZnVuY3Rpb24gcmVtb3ZlVW53YW50ZWRLZXlzRm9yRGF0YVN0cmluZyhrZXlzLCByZWNvcmREYXRhKSB7XG4gIGxldCBuZXdLZXlzID0gW107XG5cbiAgZm9yIChsZXQga2V5IG9mIGtleXMpIHtcbiAgICBpZiAoa2V5LmluY2x1ZGVzKFwiUGFyaXNoIE1hcFwiKSB8fCByZWNvcmREYXRhW2tleV0uc3RhcnRzV2l0aChcIlZpZXdcIikpIGNvbnRpbnVlO1xuXG4gICAgaWYgKGtleS5pbmNsdWRlcyhcIlNlYXJjaFwiKSB8fCBrZXkuaW5jbHVkZXMoXCJMZWFybiBNb3JlXCIpKSBjb250aW51ZTtcbiAgICBpZiAoa2V5LmluY2x1ZGVzKFwiYXMgaXQgQXBwZWFyc1wiKSB8fCBrZXkuaW5jbHVkZXMoXCJSZWdpc3RlciBUeXBlXCIpKSBjb250aW51ZTtcbiAgICBpZiAoa2V5LmluY2x1ZGVzKFwiT3RoZXIgUmVjb3Jkc1wiKSB8fCBrZXkuaW5jbHVkZXMoXCJGYW1pbHkgTWVtYmVyc1wiKSkgY29udGludWU7XG5cbiAgICAvLyByZW1vdmUgU1NOIGZvciBwcml2YWN5LiBUaGlzIGNvdWxkIGJlIGFuIG9wdGlvblxuICAgIGlmIChrZXkuaW5jbHVkZXMoXCJTb2NpYWwgU2VjdXJpdHkgI1wiKSkgY29udGludWU7XG4gICAgaWYgKGtleSA9PSBcIlNTTlwiKSBjb250aW51ZTtcblxuICAgIGlmIChpc1JlZmVyZW5jZUtleShrZXkpKSBjb250aW51ZTtcblxuICAgIG5ld0tleXMucHVzaChrZXkpO1xuICB9XG5cbiAgcmV0dXJuIG5ld0tleXM7XG59XG5cbmZ1bmN0aW9uIGFkZFJlZmVyZW5jZURhdGFUb1NvdXJjZVJlZmVyZW5jZShkYXRhLCBidWlsZGVyLCBvcHRpb25zKSB7XG4gIGlmIChkYXRhLnJlY29yZERhdGEpIHtcbiAgICBsZXQga2V5cyA9IE9iamVjdC5rZXlzKGRhdGEucmVjb3JkRGF0YSk7XG5cbiAgICBpZiAoIWJ1aWxkZXIuc291cmNlUmVmZXJlbmNlKSB7XG4gICAgICBidWlsZGVyLnNvdXJjZVJlZmVyZW5jZSA9IFwiXCI7XG4gICAgfVxuXG4gICAgbGV0IGl0ZW1TZXAgPSBcIjtcIjtcbiAgICBsZXQgdmFsdWVTZXAgPSBcIjpcIjtcbiAgICBpZiAob3B0aW9ucy5jaXRhdGlvbl9nZW5lcmFsX3NvdXJjZVJlZmVyZW5jZVNlcGFyYXRvciA9PSBcImNvbW1hQ29sb25cIikge1xuICAgICAgaXRlbVNlcCA9IFwiLFwiO1xuICAgICAgdmFsdWVTZXAgPSBcIjpcIjtcbiAgICB9IGVsc2UgaWYgKG9wdGlvbnMuY2l0YXRpb25fZ2VuZXJhbF9zb3VyY2VSZWZlcmVuY2VTZXBhcmF0b3IgPT0gXCJjb21tYVNwYWNlXCIpIHtcbiAgICAgIGl0ZW1TZXAgPSBcIixcIjtcbiAgICAgIHZhbHVlU2VwID0gXCJcIjtcbiAgICB9XG5cbiAgICBsZXQgbGNTb3VyY2VSZWZlcmVuY2UgPSBidWlsZGVyLnNvdXJjZVJlZmVyZW5jZS50b0xvd2VyQ2FzZSgpO1xuXG4gICAgZm9yIChsZXQga2V5IG9mIGtleXMpIHtcbiAgICAgIGxldCByZWZLZXlMaXN0ID0gZ2V0UmVmZXJlbmNlS2V5TGlzdEZvcktleShrZXkpO1xuICAgICAgaWYgKHJlZktleUxpc3QpIHtcbiAgICAgICAgbGV0IHZhbHVlID0gZGF0YS5yZWNvcmREYXRhW2tleV07XG5cbiAgICAgICAgaWYgKHZhbHVlKSB7XG4gICAgICAgICAgLy8gY2FuJ3QganVzdCB0ZXN0IHZhbHVlIHNpbmNlIGl0IGNvdWxkIGJlIHNvbWV0aGluZyBsaWtlIFwiMVwiXG4gICAgICAgICAgbGV0IGFscmVhZHlJblNvdXJjZVJlZmVyZW5jZSA9IGZhbHNlO1xuICAgICAgICAgIGZvciAobGV0IHJlZktleSBvZiByZWZLZXlMaXN0KSB7XG4gICAgICAgICAgICBsZXQgbWF0Y2hTdHJpbmcgPSBpdGVtU2VwICsgXCIgXCIgKyByZWZLZXkgKyB2YWx1ZVNlcDtcbiAgICAgICAgICAgIGxldCBzdGFydFN0cmluZyA9IHJlZktleSArIHZhbHVlU2VwO1xuICAgICAgICAgICAgaWYgKGxjU291cmNlUmVmZXJlbmNlLmluY2x1ZGVzKG1hdGNoU3RyaW5nKSB8fCBsY1NvdXJjZVJlZmVyZW5jZS5zdGFydHNXaXRoKHN0YXJ0U3RyaW5nKSkge1xuICAgICAgICAgICAgICAvLyBub3cgY2hlY2sgdmFsdWUgaXMgdGhlIHNhbWVcbiAgICAgICAgICAgICAgbGV0IGluZGV4ID0gbGNTb3VyY2VSZWZlcmVuY2UuaW5kZXhPZihtYXRjaFN0cmluZyk7XG4gICAgICAgICAgICAgIGxldCB2YWxJbmRleCA9IDA7XG4gICAgICAgICAgICAgIGlmIChpbmRleCA9PSAtMSkge1xuICAgICAgICAgICAgICAgIGluZGV4ID0gMDsgLy8gbXVzdCBiZSBhdCBzdGFydFxuICAgICAgICAgICAgICAgIHZhbEluZGV4ID0gaW5kZXggKyBzdGFydFN0cmluZy5sZW5ndGg7XG4gICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdmFsSW5kZXggPSBpbmRleCArIG1hdGNoU3RyaW5nLmxlbmd0aDtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBsZXQgZW5kSW5kZXggPSBsY1NvdXJjZVJlZmVyZW5jZS5pbmRleE9mKGl0ZW1TZXAsIHZhbEluZGV4KTtcbiAgICAgICAgICAgICAgaWYgKGVuZEluZGV4ID09IC0xKSB7XG4gICAgICAgICAgICAgICAgZW5kSW5kZXggPSBsY1NvdXJjZVJlZmVyZW5jZS5sZW5ndGg7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgbGV0IG1hdGNoVmFsdWUgPSBsY1NvdXJjZVJlZmVyZW5jZS5zdWJzdHJpbmcodmFsSW5kZXgsIGVuZEluZGV4KS50cmltKCk7XG4gICAgICAgICAgICAgIGlmIChtYXRjaFZhbHVlID09IHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgYWxyZWFkeUluU291cmNlUmVmZXJlbmNlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoIWFscmVhZHlJblNvdXJjZVJlZmVyZW5jZSkge1xuICAgICAgICAgICAgaWYgKGtleSA9PSBcIlVSTFwiKSB7XG4gICAgICAgICAgICAgIHZhbHVlID0gbW9kaWZ5VmFsdWVGb3JVcmwodmFsdWUpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoYnVpbGRlci5zb3VyY2VSZWZlcmVuY2UpIHtcbiAgICAgICAgICAgICAgYnVpbGRlci5zb3VyY2VSZWZlcmVuY2UgKz0gaXRlbVNlcCArIFwiIFwiO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYnVpbGRlci5zb3VyY2VSZWZlcmVuY2UgKz0ga2V5ICsgdmFsdWVTZXAgKyBcIiBcIiArIHZhbHVlO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxufVxuXG5mdW5jdGlvbiBjbGVhblNvdXJjZUNpdGF0aW9uKHNvdXJjZUNpdGF0aW9uLCBvcHRpb25zKSB7XG4gIGxldCBzdHJpbmcgPSBzb3VyY2VDaXRhdGlvbjtcblxuICBpZiAoc3RyaW5nKSB7XG4gICAgc3RyaW5nID0gc3RyaW5nLnJlcGxhY2UoL1xcOz9cXHMqU29jaWFsIFNlY3VyaXR5XFw6XFxzKlxcZCsvLCBcIlwiKTtcbiAgfVxuXG4gIGlmIChcbiAgICBzdHJpbmcgJiZcbiAgICAob3B0aW9ucy5jaXRhdGlvbl9nZW5lcmFsX3NvdXJjZVJlZmVyZW5jZVNlcGFyYXRvciA9PSBcImNvbW1hQ29sb25cIiB8fFxuICAgICAgb3B0aW9ucy5jaXRhdGlvbl9nZW5lcmFsX3NvdXJjZVJlZmVyZW5jZVNlcGFyYXRvciA9PSBcImNvbW1hU3BhY2VcIilcbiAgKSB7XG4gICAgLy8gQW5jZXN0cnkgdXNlcyBzZW1pLWNvbG9uIHNlcGFyYXRvciBieSBkZWZhdWx0LCBpZiB1c2VyIHdhbnRzIGNvbW1hIHJlcGxhY2UgOyB3aXRoICxcbiAgICBzdHJpbmcgPSBzdHJpbmcucmVwbGFjZSgvXFw7IC9nLCBcIiwgXCIpO1xuXG4gICAgaWYgKG9wdGlvbnMuY2l0YXRpb25fZ2VuZXJhbF9zb3VyY2VSZWZlcmVuY2VTZXBhcmF0b3IgPT0gXCJjb21tYVNwYWNlXCIpIHtcbiAgICAgIHN0cmluZyA9IHN0cmluZy5yZXBsYWNlKC9cXDogL2csIFwiIFwiKTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gc3RyaW5nO1xufVxuXG5mdW5jdGlvbiBnZXRPbmVPZlBvc3NpYmxlRmllbGROYW1lcyhyZWNvcmREYXRhLCBuYW1lcykge1xuICBmb3IgKGxldCBuYW1lIG9mIG5hbWVzKSB7XG4gICAgbGV0IHZhbHVlID0gZ2V0Q2xlYW5SZWNvcmREYXRhVmFsdWUocmVjb3JkRGF0YSwgbmFtZSk7XG4gICAgaWYgKHZhbHVlKSB7XG4gICAgICByZXR1cm4gdmFsdWU7XG4gICAgfVxuICB9XG59XG5cbmZ1bmN0aW9uIGJ1aWxkQ3VzdG9tRGF0YVN0cmluZyhnZCwgb3B0aW9ucykge1xuICBsZXQgaW5wdXQgPSB7XG4gICAgZ2VuZXJhbGl6ZWREYXRhOiBnZCxcbiAgICBvcHRpb25zOiBvcHRpb25zLFxuICB9O1xuICByZXR1cm4gRGF0YVN0cmluZy5idWlsZERhdGFTdHJpbmcoaW5wdXQpO1xufVxuXG5mdW5jdGlvbiBidWlsZERhdGFTdHJpbmcoZGF0YSwgZ2QsIGRhdGFTdHlsZSwgb3B0aW9ucywgYnVpbGRlcikge1xuICBsZXQgZGF0YVN0cmluZyA9IFwiXCI7XG5cbiAgaWYgKGRhdGFTdHlsZSA9PSBcInN0cmluZ1wiKSB7XG4gICAgZGF0YVN0cmluZyA9IGJ1aWxkQ3VzdG9tRGF0YVN0cmluZyhnZCwgb3B0aW9ucyk7XG4gICAgaWYgKGRhdGFTdHJpbmcpIHtcbiAgICAgIHJldHVybiBkYXRhU3RyaW5nO1xuICAgIH1cbiAgfVxuXG4gIC8vIGJ1aWxkIGEgbGlzdCBzdHJpbmdcbiAgbGV0IHJlY29yZERhdGEgPSBkYXRhLnJlY29yZERhdGE7XG5cbiAgZGF0YVN0cmluZyA9IFwiXCI7XG5cbiAgbGV0IGl0ZW1TZXAgPSBcIjtcIjtcbiAgbGV0IHZhbHVlU2VwID0gXCI6XCI7XG4gIGlmIChvcHRpb25zLmNpdGF0aW9uX2dlbmVyYWxfZGF0YUxpc3RTZXBhcmF0b3IgPT0gXCJjb21tYUNvbG9uXCIpIHtcbiAgICBpdGVtU2VwID0gXCIsXCI7XG4gICAgdmFsdWVTZXAgPSBcIjpcIjtcbiAgfSBlbHNlIGlmIChvcHRpb25zLmNpdGF0aW9uX2dlbmVyYWxfZGF0YUxpc3RTZXBhcmF0b3IgPT0gXCJjb21tYVNwYWNlXCIpIHtcbiAgICBpdGVtU2VwID0gXCIsXCI7XG4gICAgdmFsdWVTZXAgPSBcIlwiO1xuICB9XG5cbiAgaWYgKHJlY29yZERhdGEpIHtcbiAgICBsZXQga2V5cyA9IE9iamVjdC5rZXlzKHJlY29yZERhdGEpO1xuICAgIGtleXMgPSByZW1vdmVVbndhbnRlZEtleXNGb3JEYXRhU3RyaW5nKGtleXMsIHJlY29yZERhdGEpO1xuICAgIGZvciAobGV0IGtleSBvZiBrZXlzKSB7XG4gICAgICBsZXQgdmFsdWUgPSByZWNvcmREYXRhW2tleV07XG4gICAgICBpZiAodmFsdWUpIHtcbiAgICAgICAgaWYgKGRhdGFTdHJpbmcgIT0gXCJcIikge1xuICAgICAgICAgIGRhdGFTdHJpbmcgKz0gaXRlbVNlcCArIFwiIFwiO1xuICAgICAgICB9XG4gICAgICAgIGlmIChrZXkuc3RhcnRzV2l0aChcIkhvdXNlaG9sZCBNZW1iZXJzXCIpIHx8IGtleS5zdGFydHNXaXRoKFwiSG91c2Vob2xkIE1lbWJlcihzKVwiKSkge1xuICAgICAgICAgIGlmICghYnVpbGRlci5ob3VzZWhvbGRUYWJsZVN0cmluZykge1xuICAgICAgICAgICAgbGV0IG5ld0tleSA9IGtleS5yZXBsYWNlKC9cXDxiclxcL1xcPi9nLCBcIiBcIik7XG4gICAgICAgICAgICBpZiAob3B0aW9ucy5jaXRhdGlvbl9nZW5lcmFsX2FkZEJyZWFrc1dpdGhpbkJvZHkpIHtcbiAgICAgICAgICAgICAgZGF0YVN0cmluZyArPSBcIjxici8+XCI7XG4gICAgICAgICAgICAgIGRhdGFTdHJpbmcgKz0gbmV3S2V5ICsgdmFsdWVTZXAgKyBcIjxici8+XCIgKyB2YWx1ZTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIGxldCBuZXdWYWx1ZSA9IHZhbHVlLnJlcGxhY2UoL1xcPGJyXFwvXFw+L2csIFwiLCBcIik7XG4gICAgICAgICAgICAgIGRhdGFTdHJpbmcgKz0gbmV3S2V5ICsgdmFsdWVTZXAgKyBcIiBcIiArIG5ld1ZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmICh2YWx1ZS5pbmRleE9mKFwiPGJyLz5cIikgIT0gLTEgJiYgIW9wdGlvbnMuY2l0YXRpb25fZ2VuZXJhbF9hZGRCcmVha3NXaXRoaW5Cb2R5KSB7XG4gICAgICAgICAgbGV0IG5ld1ZhbHVlID0gdmFsdWUucmVwbGFjZSgvXFw8YnJcXC9cXD4vZywgXCIsIFwiKTtcbiAgICAgICAgICBkYXRhU3RyaW5nICs9IGtleSArIHZhbHVlU2VwICsgXCIgXCIgKyBuZXdWYWx1ZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBkYXRhU3RyaW5nICs9IGtleSArIHZhbHVlU2VwICsgXCIgXCIgKyB2YWx1ZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfSBlbHNlIHtcbiAgICBsZXQgdGl0bGVOYW1lID0gZGF0YS50aXRsZU5hbWU7XG4gICAgaWYgKCF0aXRsZU5hbWUgJiYgcmVjb3JkRGF0YSkge1xuICAgICAgbGV0IG5hbWUgPSBnZXRPbmVPZlBvc3NpYmxlRmllbGROYW1lcyhyZWNvcmREYXRhLCBbXCJOYW1lXCJdKTtcbiAgICAgIGlmIChuYW1lKSB7XG4gICAgICAgIHRpdGxlTmFtZSA9IG5hbWU7XG4gICAgICB9XG4gICAgfVxuXG4gICAgZGF0YVN0cmluZyArPSB0aXRsZU5hbWU7XG4gIH1cblxuICByZXR1cm4gZGF0YVN0cmluZztcbn1cblxuZnVuY3Rpb24gZ2V0QWRkaXRpb25hbEluZm8oZGF0YSwgZ2QsIGNpdGF0aW9uVHlwZSwgb3B0aW9ucywgYnVpbGRlcikge1xuICBsZXQgZGF0YVN0eWxlID0gb3B0aW9ucy5jaXRhdGlvbl9hbmNlc3RyeV9kYXRhU3R5bGU7XG4gIGlmIChkYXRhU3R5bGUgPT0gXCJub25lXCIpIHtcbiAgICByZXR1cm4gXCJcIjtcbiAgfSBlbHNlIGlmIChkYXRhU3R5bGUgPT0gXCJ0YWJsZVwiKSB7XG4gICAgaWYgKG9wdGlvbnMuY2l0YXRpb25fZ2VuZXJhbF9yZWZlcmVuY2VQb3NpdGlvbiA9PSBcImF0RW5kXCIpIHtcbiAgICAgIGRhdGFTdHlsZSA9IFwic3RyaW5nXCI7XG4gICAgfSBlbHNlIGlmIChjaXRhdGlvblR5cGUgPT0gXCJzb3VyY2VcIikge1xuICAgICAgZGF0YVN0eWxlID0gXCJsaXN0XCI7XG4gICAgfVxuICB9XG5cbiAgaWYgKGRhdGFTdHlsZSA9PSBcInN0cmluZ1wiIHx8IGRhdGFTdHlsZSA9PSBcImxpc3RcIikge1xuICAgIHJldHVybiBidWlsZERhdGFTdHJpbmcoZGF0YSwgZ2QsIGRhdGFTdHlsZSwgb3B0aW9ucywgYnVpbGRlcik7XG4gIH1cblxuICAvLyBzdHlsZSBtdXN0IGJlIHRhYmxlXG4gIHZhciByZXN1bHQgPSBcIlwiO1xuICBsZXQgcmVjb3JkRGF0YSA9IGRhdGEucmVjb3JkRGF0YTtcbiAgaWYgKHJlY29yZERhdGEpIHtcbiAgICBsZXQga2V5cyA9IE9iamVjdC5rZXlzKHJlY29yZERhdGEpO1xuXG4gICAga2V5cyA9IHJlbW92ZVVud2FudGVkS2V5c0ZvclRhYmxlKGtleXMsIHJlY29yZERhdGEpO1xuICAgIGlmIChrZXlzLmxlbmd0aCA+IDApIHtcbiAgICAgIC8vIHN0YXJ0IHRhYmxlXG4gICAgICByZXN1bHQgPSAne3wgYm9yZGVyPVwiMVwiXFxuJztcbiAgICAgIGxldCBmaXJzdFJvdyA9IHRydWU7XG5cbiAgICAgIGZvciAobGV0IGtleSBvZiBrZXlzKSB7XG4gICAgICAgIGlmIChmaXJzdFJvdykge1xuICAgICAgICAgIGZpcnN0Um93ID0gZmFsc2U7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmVzdWx0ICs9IFwifC1cXG5cIjtcbiAgICAgICAgfVxuICAgICAgICByZXN1bHQgKz0gXCJ8IFwiICsga2V5ICsgXCIgfHwgXCIgKyByZWNvcmREYXRhW2tleV0gKyBcIlxcblwiO1xuICAgICAgfVxuXG4gICAgICByZXN1bHQgKz0gXCJ8fVwiO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiByZXN1bHQ7XG59XG5cbmZ1bmN0aW9uIGJ1aWxkQW5jZXN0cnlSZWNvcmRUZW1wbGF0ZShkYXRhLCBvcHRpb25zKSB7XG4gIGNvbnN0IGRvbWFpblBhcmFtcyA9IHtcbiAgICBjb206IFwiXCIsXG4gICAgXCJjby51a1wiOiBcInVrXCIsXG4gICAgY2E6IFwiY2FcIixcbiAgICBcImNvbS5hdVwiOiBcImF1XCIsXG4gICAgZGU6IFwiZGVcIixcbiAgICBpdDogXCJpdFwiLFxuICAgIGZyOiBcImZyXCIsXG4gICAgc2U6IFwic2VcIixcbiAgICBteDogXCJteFwiLFxuICB9O1xuXG4gIGxldCBkb21haW5QYXJhbSA9IHVuZGVmaW5lZDtcblxuICBpZiAob3B0aW9ucy5jaXRhdGlvbl9hbmNlc3RyeV9yZWNvcmRUZW1wbGF0ZURvbWFpbiA9PSBcImZyb21SZWNvcmRcIikge1xuICAgIGRvbWFpblBhcmFtID0gZG9tYWluUGFyYW1zW2RhdGEuZG9tYWluXTtcbiAgfSBlbHNlIHtcbiAgICBsZXQgZnVsbERvbWFpbiA9IG9wdGlvbnMuY2l0YXRpb25fYW5jZXN0cnlfcmVjb3JkVGVtcGxhdGVEb21haW47XG4gICAgbGV0IGRvbWFpbiA9IGZ1bGxEb21haW4ucmVwbGFjZSgvYW5jZXN0cnkuKC4rKSQvLCBcIiQxXCIpO1xuICAgIGlmIChkb21haW4gJiYgZG9tYWluICE9IGZ1bGxEb21haW4pIHtcbiAgICAgIGRvbWFpblBhcmFtID0gZG9tYWluUGFyYW1zW2RvbWFpbl07XG4gICAgfVxuICB9XG5cbiAgaWYgKGRvbWFpblBhcmFtKSB7XG4gICAgcmV0dXJuIFwie3tBbmNlc3RyeSBSZWNvcmR8XCIgKyBkYXRhLmRiSWQgKyBcInxcIiArIGRhdGEucmVjb3JkSWQgKyBcInxcIiArIGRvbWFpblBhcmFtICsgXCJ9fVwiO1xuICB9XG5cbiAgcmV0dXJuIFwie3tBbmNlc3RyeSBSZWNvcmR8XCIgKyBkYXRhLmRiSWQgKyBcInxcIiArIGRhdGEucmVjb3JkSWQgKyBcIn19XCI7XG59XG5cbmZ1bmN0aW9uIGJ1aWxkQW5jZXN0cnlJbWFnZVRlbXBsYXRlKGRhdGEsIG9wdGlvbnMpIHtcbiAgLy8gTm90ZSB0aGF0IHRoZSBBbmNlc3RyeSBJbWFnZSB0ZW1wbGF0ZSBoYXMgbm8gM3JkIChkb21haW4gcGFyYW1ldGVyKVxuICByZXR1cm4gXCJ7e0FuY2VzdHJ5IEltYWdlfFwiICsgZGF0YS5kYklkICsgXCJ8XCIgKyBkYXRhLnJlY29yZElkICsgXCJ9fVwiO1xufVxuXG5mdW5jdGlvbiBidWlsZEFuY2VzdHJ5U2hhcmluZ1RlbXBsYXRlRnJvbVNoYXJpbmdEYXRhT2JqKGRhdGFPYmopIHtcbiAgLy8gVjEgdmVyc2lvbnNcbiAgLy8gaHR0cHM6Ly93d3cuYW5jZXN0cnkuY29tL3NoYXJpbmcvMjQyNzQ0NDA/aD05NWNmNWNcbiAgbGV0IG51bTEgPSBkYXRhT2JqLmlkO1xuICBsZXQgbnVtMiA9IGRhdGFPYmouaG1hY19pZDtcblxuICAvLyBWMiB2ZXJzaW9uc1xuICBpZiAoZGF0YU9iai52MiAmJiBkYXRhT2JqLnYyLnNoYXJlX2lkICYmIGRhdGFPYmoudjIuc2hhcmVfdG9rZW4pIHtcbiAgICBudW0xID0gZGF0YU9iai52Mi5zaGFyZV9pZDtcbiAgICBudW0yID0gZGF0YU9iai52Mi5zaGFyZV90b2tlbjtcbiAgfVxuXG4gIGlmIChudW0xICYmIG51bTIpIHtcbiAgICBsZXQgdGVtcGxhdGUgPSBcInt7QW5jZXN0cnkgU2hhcmluZ3xcIiArIG51bTEgKyBcInxcIiArIG51bTIgKyBcIn19XCI7XG4gICAgcmV0dXJuIHRlbXBsYXRlO1xuICB9XG59XG5cbmZ1bmN0aW9uIGNsZWFuT3JpZ2luYWxEYXRhKHRleHQpIHtcbiAgdGV4dCA9IHRleHQucmVwbGFjZSgvXkNyb3duIGNvcHlyaWdodCBpbWFnZXMgcmVwcm9kdWNlZCBbXi5dKlxcLi8sIFwiXCIpO1xuICB0ZXh0ID0gdGV4dC50cmltKCk7XG5cbiAgLy8gcmVtb3ZlIGJhZCBGaW5kIGEgR3JhdmUgbGlua3NcbiAgdGV4dCA9IHRleHQucmVwbGFjZSgvXkZpbmQgYSBHcmF2ZVxcLlxccytGaW5kIGEgR3JhdmVcXC4vLCBcIkZpbmQgYSBHcmF2ZS5cIik7XG4gIHRleHQgPSB0ZXh0LnRyaW0oKTtcbiAgdGV4dCA9IHRleHQucmVwbGFjZSgvXkZpbmQgYSBHcmF2ZVxcLlxccytodHRwXFw6XFwvXFwvd3d3XFwuZmluZGFncmF2ZVxcLmNvbVxcL2NnaVxcLWJpblxcL2ZnXFwuY2dpXFwuPy8sIFwiXCIpO1xuICB0ZXh0ID0gdGV4dC50cmltKCk7XG5cbiAgLy8gVGhlIE9yaWdpbmFsIGRhdGEgc3RyaW5nIGNhbiBnZXQgcXVpdGUgbG9uZyBhbmQgb2Z0ZW4gaGFzIHZlcmJvc2Ugb3duZXJzaGlwIHZlcmJpYWdlIG9uIHRoZSBlbmQgdGhhdCBpZiBub3QgcGFydFxuICAvLyBvZiBhIG5vcm1hbCBjaXRhdGlvbi4gTm90ZSB0aGF0IHRoaXMgT3JpZ2luYWwgRGF0YSBzdHJpbmcgaXMgb25seSB1c2VkIHdoZW4gdGhlcmUgaXMgbm8gU291cmNlIENpdGF0aW9uIHN0cmluZy5cbiAgY29uc3QgZW5kaW5ncyA9IFtcbiAgICBcIsKpXCIsXG4gICAgXCJDcm93biBjb3B5cmlnaHRcIixcbiAgICBcIkNvcHlyaWdodFwiLFxuICAgIFwiY29weXJpZ2h0XCIsXG4gICAgXCJQdWJsaXNoZWQgYnkgcGVybWlzc2lvblwiLFxuICAgIFwiVXNlZCBieSBwZXJtaXNzaW9uXCIsXG4gICAgXCJZb3UgbXVzdCBub3RcIixcbiAgICBcIlRoZSBWaXRhbHNlYXJjaCBDb21wYW55IFdvcmxkd2lkZVwiLFxuICBdO1xuICBmb3IgKGxldCBlbmRpbmcgb2YgZW5kaW5ncykge1xuICAgIGxldCBpbmRleCA9IHRleHQuaW5kZXhPZihlbmRpbmcpO1xuICAgIGlmIChpbmRleCAhPSAtMSkge1xuICAgICAgdGV4dCA9IHRleHQuc3Vic3RyaW5nKDAsIGluZGV4KTtcbiAgICAgIGxldCBsYXN0UGVyaW9kSW5kZXggPSB0ZXh0Lmxhc3RJbmRleE9mKFwiLlwiKTtcbiAgICAgIGlmIChsYXN0UGVyaW9kSW5kZXggIT0gLTEpIHtcbiAgICAgICAgdGV4dCA9IHRleHQuc3Vic3RyaW5nKDAsIGxhc3RQZXJpb2RJbmRleCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0ZXh0ID0gXCJcIjtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvLyBSZW1vdmUgbGlua3MgdG8gVml0YWxTZWFyY2ggYXMgdGhleSBtYXkgYnJlYWsgb3IgYmVjb21lIG1hbGljaW91cyBhdCBzb21lIHBvaW50XG4gIHRleHQgPSB0ZXh0LnJlcGxhY2UoXCIgKHd3dy52aXRhbHNlYXJjaC13b3JsZHdpZGUuY29tKVwiLCBcIlwiKTtcblxuICAvLyBTb21ldGltZXMgdGhlcmUgaXMgZHVwbGljYXRlZCBpbmZvcm1hdGlvbiBvciB0aGUgY29sbGVjdGlvbiB0aXRsZSBpcyByZXBlYXRlZCBpbiB0aGUgT3JnaW5hbCBkYXRhLlxuICAvLyBBIGNvbW1vbiBleGFtcGxlIGlzOlxuICAvLyBcIkdlbmVyYWwgUmVnaXN0ZXIgT2ZmaWNlLiBFbmdsYW5kIGFuZCBXYWxlcyBDaXZpbCBSZWdpc3RyYXRpb24gSW5kZXhlcy4gTG9uZG9uLCBFbmdsYW5kOiBHZW5lcmFsIFJlZ2lzdGVyIE9mZmljZVwiXG4gIC8vIENhbiB3ZSBnZW5lcmljYWxseSBoYW5kbGUgdGhhdD9cbiAgbGV0IGZpcnN0UGVyaW9kSW5kZXggPSB0ZXh0LmluZGV4T2YoXCIuXCIpO1xuICBpZiAoZmlyc3RQZXJpb2RJbmRleCAhPSAtMSkge1xuICAgIGxldCBzdGFydFRleHQgPSB0ZXh0LnN1YnN0cmluZygwLCBmaXJzdFBlcmlvZEluZGV4KTtcbiAgICBpZiAodGV4dC5sZW5ndGggPiBmaXJzdFBlcmlvZEluZGV4ICogMikge1xuICAgICAgaWYgKHRleHQuZW5kc1dpdGgoc3RhcnRUZXh0KSkge1xuICAgICAgICAvLyByZW1vdmUgdGhlIGR1cGxpY2F0ZWQgc2VudGVuY2UgZnJvbSB0aGUgc3RhcnRcbiAgICAgICAgdGV4dCA9IHRleHQuc3Vic3RyaW5nKGZpcnN0UGVyaW9kSW5kZXggKyAxKS50cmltKCk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLy8gcmVwbGFjZSB3ZWlyZCBoeXBoZW5zIHdpdGggcmVndWxhciBvbmVzXG4gIHRleHQgPSB0ZXh0LnJlcGxhY2UoXCLigJNcIiwgXCItXCIpO1xuXG4gIC8vIHJlbW92ZSBhbnkgdHJhaWxpbmcgcHVuY3R1YXRpb25cbiAgdGV4dCA9IHRleHQucmVwbGFjZSgvWy4sO10kL2csIFwiXCIpO1xuXG4gIHRleHQgPSB0ZXh0LnRyaW0oKTtcblxuICByZXR1cm4gdGV4dDtcbn1cblxuZnVuY3Rpb24gYnVpbGRTb3VyY2VSZWZlcmVuY2UoZGF0YSwgb3B0aW9ucykge1xuICBsZXQgc291cmNlUmVmZXJlbmNlID0gZGF0YS5zb3VyY2VDaXRhdGlvbjtcblxuICBpZiAoIXNvdXJjZVJlZmVyZW5jZSAmJiBkYXRhLm9yaWdpbmFsRGF0YSkge1xuICAgIHNvdXJjZVJlZmVyZW5jZSA9IGNsZWFuT3JpZ2luYWxEYXRhKGRhdGEub3JpZ2luYWxEYXRhKTtcbiAgfVxuXG4gIHJldHVybiBjbGVhblNvdXJjZUNpdGF0aW9uKHNvdXJjZVJlZmVyZW5jZSwgb3B0aW9ucyk7XG59XG5cbmZ1bmN0aW9uIGJ1aWxkQ29yZUNpdGF0aW9uKGRhdGEsIGdkLCBvcHRpb25zLCBzaGFyaW5nRGF0YU9iaiwgYnVpbGRlcikge1xuICAvL2NvbnNvbGUubG9nKFwiYnVpbGRDb3JlQ2l0YXRpb24sIHNoYXJpbmdEYXRhT2JqIGlzXCIpO1xuICAvL2NvbnNvbGUubG9nKHNoYXJpbmdEYXRhT2JqKTtcbiAgLy9jb25zb2xlLmxvZyhcImJ1aWxkQ29yZUNpdGF0aW9uLCBkYXRhIGlzXCIpO1xuICAvL2NvbnNvbGUubG9nKGRhdGEpO1xuXG4gIGJ1aWxkZXIuc291cmNlVGl0bGUgPSBkYXRhLnRpdGxlQ29sbGVjdGlvbjtcbiAgYnVpbGRlci5zb3VyY2VSZWZlcmVuY2UgPSBidWlsZFNvdXJjZVJlZmVyZW5jZShkYXRhLCBvcHRpb25zKTtcbiAgYWRkUmVmZXJlbmNlRGF0YVRvU291cmNlUmVmZXJlbmNlKGRhdGEsIGJ1aWxkZXIsIG9wdGlvbnMpO1xuXG4gIGlmIChzaGFyaW5nRGF0YU9iaikge1xuICAgIGxldCB0ZW1wbGF0ZSA9IGJ1aWxkQW5jZXN0cnlTaGFyaW5nVGVtcGxhdGVGcm9tU2hhcmluZ0RhdGFPYmooc2hhcmluZ0RhdGFPYmopO1xuICAgIGJ1aWxkZXIuc2hhcmluZ0xpbmtPclRlbXBsYXRlID0gdGVtcGxhdGU7XG4gICAgYnVpbGRlci5kYXRhYmFzZUhhc0ltYWdlcyA9IHRydWU7XG4gIH1cblxuICBidWlsZGVyLnJlY29yZExpbmtPclRlbXBsYXRlID0gYnVpbGRBbmNlc3RyeVJlY29yZFRlbXBsYXRlKGRhdGEsIG9wdGlvbnMpO1xuXG4gIGxldCBhZGRpdGlvbmFsSW5mbyA9IGdldEFkZGl0aW9uYWxJbmZvKGRhdGEsIGdkLCBidWlsZGVyLnR5cGUsIG9wdGlvbnMsIGJ1aWxkZXIpO1xuICBpZiAoYWRkaXRpb25hbEluZm8pIHtcbiAgICBidWlsZGVyLmRhdGFTdHJpbmcgPSBhZGRpdGlvbmFsSW5mbztcbiAgfVxufVxuXG5mdW5jdGlvbiBidWlsZEltYWdlQ2l0YXRpb24oZGF0YSwgb3B0aW9ucywgc2hhcmluZ0RhdGFPYmosIGJ1aWxkZXIpIHtcbiAgYnVpbGRlci5zb3VyY2VUaXRsZSA9IGRhdGEudGl0bGVDb2xsZWN0aW9uO1xuICBidWlsZGVyLmRhdGFiYXNlSGFzSW1hZ2VzID0gdHJ1ZTtcblxuICBsZXQgc291cmNlUmVmZXJlbmNlID0gZGF0YS5pbWFnZUJyb3dzZVBhdGg7XG4gIGlmIChkYXRhLnRvdGFsSW1hZ2VzICYmIGRhdGEuaW1hZ2VOdW1iZXIpIHtcbiAgICBpZiAoc291cmNlUmVmZXJlbmNlKSB7XG4gICAgICBzb3VyY2VSZWZlcmVuY2UgKz0gXCIgPiBcIjtcbiAgICB9XG4gICAgc291cmNlUmVmZXJlbmNlICs9IFwiaW1hZ2UgXCIgKyBkYXRhLmltYWdlTnVtYmVyICsgXCIgb2YgXCIgKyBkYXRhLnRvdGFsSW1hZ2VzO1xuICB9XG4gIGlmIChzb3VyY2VSZWZlcmVuY2UpIHtcbiAgICBidWlsZGVyLnNvdXJjZVJlZmVyZW5jZSA9IHNvdXJjZVJlZmVyZW5jZTtcbiAgfVxuXG4gIGlmIChzaGFyaW5nRGF0YU9iaikge1xuICAgIGxldCB0ZW1wbGF0ZSA9IGJ1aWxkQW5jZXN0cnlTaGFyaW5nVGVtcGxhdGVGcm9tU2hhcmluZ0RhdGFPYmooc2hhcmluZ0RhdGFPYmopO1xuICAgIGJ1aWxkZXIuc2hhcmluZ0xpbmtPclRlbXBsYXRlID0gdGVtcGxhdGU7XG4gIH1cblxuICAvLyBidWlsZGVyLnJlY29yZExpbmtPclRlbXBsYXRlID0gXCJBbmNlc3RyeSBcIiArIGJ1aWxkQW5jZXN0cnlJbWFnZVRlbXBsYXRlKGRhdGEsIG9wdGlvbnMpICsgXCIgXCIgKyBkYXRhLmRiSWQgKyBcIiBcIiArIGRhdGEucmVjb3JkSWQ7XG4gIGJ1aWxkZXIucmVjb3JkTGlua09yVGVtcGxhdGUgPSBcIkFuY2VzdHJ5IFwiICsgYnVpbGRBbmNlc3RyeUltYWdlVGVtcGxhdGUoZGF0YSwgb3B0aW9ucyk7XG5cbiAgYnVpbGRlci5kYXRhU3RyaW5nID0gZGF0YS50aXRsZU5hbWU7XG5cbiAgYnVpbGRlci5tZWFuaW5nZnVsVGl0bGUgPSBnZXRJbWFnZVJlZlRpdGxlKGRhdGEudGl0bGVDb2xsZWN0aW9uLCBkYXRhLmltYWdlQnJvd3NlUGF0aCk7XG59XG5cbmZ1bmN0aW9uIGJ1aWxkU2hhcmluZ1BhZ2VDaXRhdGlvbihkYXRhLCBvcHRpb25zLCBidWlsZGVyKSB7XG4gIGJ1aWxkZXIuc291cmNlVGl0bGUgPSBkYXRhLnRpdGxlQ29sbGVjdGlvbjtcbiAgYnVpbGRlci5kYXRhYmFzZUhhc0ltYWdlcyA9IHRydWU7XG5cbiAgLy8gbm8gc291cmNlIHJlZmVyZW5jZVxuXG4gIGlmIChkYXRhLmFuY2VzdHJ5VGVtcGxhdGUpIHtcbiAgICBidWlsZGVyLnNoYXJpbmdMaW5rT3JUZW1wbGF0ZSA9IGRhdGEuYW5jZXN0cnlUZW1wbGF0ZTtcbiAgfVxuXG4gIGlmIChkYXRhLmRiSWQgJiYgZGF0YS5yZWNvcmRJZCkge1xuICAgIGlmIChkYXRhLnNoYXJpbmdUeXBlID09IFwidjFcIikge1xuICAgICAgYnVpbGRlci5yZWNvcmRMaW5rT3JUZW1wbGF0ZSA9IFwiQW5jZXN0cnkgXCIgKyBidWlsZEFuY2VzdHJ5SW1hZ2VUZW1wbGF0ZShkYXRhLCBvcHRpb25zKTtcbiAgICB9IGVsc2Uge1xuICAgICAgYnVpbGRlci5yZWNvcmRMaW5rT3JUZW1wbGF0ZSA9IGJ1aWxkQW5jZXN0cnlSZWNvcmRUZW1wbGF0ZShkYXRhLCBvcHRpb25zKTtcbiAgICB9XG4gIH1cblxuICBidWlsZGVyLmRhdGFTdHJpbmcgPSBkYXRhLnBlcnNvbk5hcnJhdGl2ZTtcblxuICBidWlsZGVyLm1lYW5pbmdmdWxUaXRsZSA9IGdldFNoYXJpbmdQYWdlUmVmVGl0bGUoZGF0YS50aXRsZUNvbGxlY3Rpb24sIGRhdGEucGVyc29uTmFycmF0aXZlKTtcbn1cblxuZnVuY3Rpb24gYnVpbGRDaXRhdGlvbihpbnB1dCkge1xuICBjb25zdCBkYXRhID0gaW5wdXQuZXh0cmFjdGVkRGF0YTtcbiAgY29uc3QgZ2QgPSBpbnB1dC5nZW5lcmFsaXplZERhdGE7XG4gIGNvbnN0IHJ1bkRhdGUgPSBpbnB1dC5ydW5EYXRlO1xuICBjb25zdCBzaGFyaW5nRGF0YU9iaiA9IGlucHV0LnNoYXJpbmdEYXRhT2JqO1xuICBjb25zdCBvcHRpb25zID0gaW5wdXQub3B0aW9ucztcbiAgY29uc3QgdHlwZSA9IGlucHV0LnR5cGU7IC8vIFwiaW5saW5lXCIsIFwibmFycmF0aXZlXCIgb3IgXCJzb3VyY2VcIlxuXG4gIGxldCBidWlsZGVyID0gbmV3IENpdGF0aW9uQnVpbGRlcih0eXBlLCBydW5EYXRlLCBvcHRpb25zKTtcbiAgYnVpbGRlci5ob3VzZWhvbGRUYWJsZVN0cmluZyA9IGlucHV0LmhvdXNlaG9sZFRhYmxlU3RyaW5nO1xuICBidWlsZGVyLmluY2x1ZGVTdWJzY3JpcHRpb25SZXF1aXJlZCA9IG9wdGlvbnMuY2l0YXRpb25fYW5jZXN0cnlfc3Vic2NyaXB0aW9uUmVxdWlyZWQ7XG5cbiAgaWYgKGRhdGEucGFnZVR5cGUgPT0gXCJyZWNvcmRcIikge1xuICAgIGJ1aWxkQ29yZUNpdGF0aW9uKGRhdGEsIGdkLCBvcHRpb25zLCBzaGFyaW5nRGF0YU9iaiwgYnVpbGRlcik7XG5cbiAgICB2YXIgcmVmVGl0bGUgPSBnZXRSZWZUaXRsZShkYXRhLCBnZCk7XG4gICAgYnVpbGRlci5tZWFuaW5nZnVsVGl0bGUgPSByZWZUaXRsZTtcblxuICAgIGlmICh0eXBlID09IFwibmFycmF0aXZlXCIpIHtcbiAgICAgIGJ1aWxkZXIuYWRkTmFycmF0aXZlKGdkLCBpbnB1dC5kYXRhQ2FjaGUsIG9wdGlvbnMpO1xuICAgIH1cbiAgfSBlbHNlIGlmIChkYXRhLnBhZ2VUeXBlID09IFwiaW1hZ2VcIikge1xuICAgIGJ1aWxkSW1hZ2VDaXRhdGlvbihkYXRhLCBvcHRpb25zLCBzaGFyaW5nRGF0YU9iaiwgYnVpbGRlcik7XG4gIH0gZWxzZSBpZiAoZGF0YS5wYWdlVHlwZSA9PSBcInNoYXJpbmdJbWFnZU9yUmVjb3JkXCIpIHtcbiAgICBidWlsZFNoYXJpbmdQYWdlQ2l0YXRpb24oZGF0YSwgb3B0aW9ucywgYnVpbGRlcik7XG4gIH1cblxuICAvLyBub3cgdGhlIGJ1aWxkZXIgaXMgc2V0dXAgdXNlIGl0IHRvIGJ1aWxkIHRoZSBjaXRhdGlvbiB0ZXh0XG4gIGxldCBmdWxsQ2l0YXRpb24gPSBidWlsZGVyLmdldENpdGF0aW9uU3RyaW5nKCk7XG5cbiAgdmFyIGNpdGF0aW9uT2JqZWN0ID0ge1xuICAgIGNpdGF0aW9uOiBmdWxsQ2l0YXRpb24sXG4gICAgdHlwZTogdHlwZSxcbiAgfTtcblxuICByZXR1cm4gY2l0YXRpb25PYmplY3Q7XG59XG5cbmV4cG9ydCB7IGJ1aWxkQ2l0YXRpb24gfTtcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./extension/site/ancestry/core/ancestry_build_citation.mjs\n");

/***/ }),

/***/ "./extension/site/ancestry/core/ancestry_extract_data.mjs":
/*!****************************************************************!*\
  !*** ./extension/site/ancestry/core/ancestry_extract_data.mjs ***!
  \****************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"detectPageType\": () => (/* binding */ detectPageType),\n/* harmony export */   \"extractData\": () => (/* binding */ extractData),\n/* harmony export */   \"extractRecord\": () => (/* binding */ extractRecord)\n/* harmony export */ });\n/*\nMIT License\n\nCopyright (c) 2020 Robert M Pavey\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.\n*/\n\nfunction cleanText(text) {\n  if (!text) {\n    return \"\";\n  }\n\n  text = text.replace(/\\s+/g, \" \"); // eliminate nbsp and multiple spaces etc\n\n  // sometimes the text is something like \"Zachariah Davey[Zechariah Pavey]\"\n  // in that case add a space before the [\n  text = text.replace(/([^\\s])\\[/, \"$1 [\");\n\n  text = text.trim();\n\n  return text;\n}\n\nfunction cleanLabel(text) {\n  if (!text) {\n    return \"\";\n  }\n\n  text = text.replace(/\\s/g, \" \"); // eliminate nbsp etc\n  text = text.trim();\n\n  // remove trailing :\n  text = text.replace(/\\s*\\:+$/, \"\");\n\n  return text;\n}\n\nfunction setSourceCitation(result, sourceTextNode) {\n  let sourceText = cleanText(sourceTextNode.textContent);\n  result.sourceCitation = sourceText;\n}\n\nfunction setSourceInformation(result, sourceTextNode) {\n  let sourceText = cleanText(sourceTextNode.textContent);\n  result.sourceInformation = sourceText;\n\n  let originalData = \"\";\n\n  const origDataStr = \"Original data:\";\n  // first see if there are child paragraphs\n  let paragraphNodes = sourceTextNode.querySelectorAll(\"p\");\n  if (paragraphNodes.length > 1) {\n    for (let para of paragraphNodes) {\n      let paraText = cleanText(para.textContent);\n      if (paraText.startsWith(origDataStr)) {\n        originalData = paraText.substring(origDataStr.length).trim();\n        break;\n      }\n    }\n  } else {\n    if (sourceText.startsWith(origDataStr)) {\n      originalData = sourceText.substring(origDataStr.length).trim();\n    }\n  }\n\n  if (originalData) {\n    result.originalData = cleanText(originalData);\n  }\n}\n\nfunction setSourceDescription(result, sourceTextNode) {\n  let sourceText = cleanText(sourceTextNode.textContent);\n  result.sourceDescription = sourceText;\n}\n\nfunction extractDbAndRecordId(result, url) {\n  //console.log(\"location href is\");\n  //console.log(url);\n\n  let dbId = \"\";\n  let recordId = \"\";\n  const dbIdStr = \"dbid=\"; // could have & or ? before dbid\n  const dbStr = \"db=\"; // On some records (like Birth Registrations) it is db rather than dbid\n  if (url.includes(dbIdStr) || url.includes(dbStr)) {\n    var dbIdOrDbStr = url.includes(dbIdStr) ? dbIdStr : dbStr;\n    let dbIdIndex = url.indexOf(dbIdOrDbStr);\n    dbIdIndex += dbIdOrDbStr.length;\n    let dbEndIndex = url.indexOf(\"&\", dbIdIndex);\n    if (dbEndIndex != -1) {\n      dbId = url.substring(dbIdIndex, dbEndIndex);\n      const recStr = \"&h=\";\n      let recIndex = url.indexOf(recStr, dbEndIndex);\n      if (recIndex != -1) {\n        recIndex += recStr.length;\n        let ampIndex = url.indexOf(\"&\", recIndex);\n        if (ampIndex != -1) {\n          recordId = url.substring(recIndex, ampIndex);\n        } else {\n          recordId = url.substring(recIndex);\n        }\n      }\n    }\n  } else if (url.includes(\"discoveryui-content\")) {\n    let rec = url.replace(/.*\\/discoveryui-content\\/view\\/([^:]+)\\:.*/, \"$1\");\n    let db = url.replace(/.*\\/discoveryui-content\\/view\\/[^:]+\\:(\\d+).*/, \"$1\");\n    if (db != \"\" && db != url && rec != \"\" && rec != url) {\n      dbId = db;\n      recordId = rec;\n    }\n  } else if (url.includes(\"/collections/\") && url.includes(\"/records/\")) {\n    let db = url.replace(/.*\\/collections\\/([^\\/]+)\\/records\\/.*/, \"$1\");\n    let rec = url.replace(/.*\\/collections\\/[^\\/]+\\/records\\/([^\\/]+)/, \"$1\");\n    if (db != \"\" && db != url && rec != \"\" && rec != url) {\n      dbId = db;\n      recordId = rec;\n    }\n  }\n  //console.log(\"dbId = \" + dbId + \", recordId = \" + recordId);\n\n  result.dbId = dbId;\n  result.recordId = recordId;\n  // Note this is overidden in buildCitation using use options\n  result.ancestryTemplate = \"{{Ancestry Record|\" + result.dbId + \"|\" + result.recordId + \"}}\";\n\n  let domain = url.replace(/.*\\.ancestry.([^\\/]+)\\/.*/, \"$1\");\n  result.domain = domain;\n}\n\nfunction extractRecordPageTitle(document, result) {\n  let titleName = \"\";\n  let titleCollection = \"\";\n\n  let pageTitle = document.querySelector(\"h1.pageTitle > span\");\n  if (pageTitle) {\n    // This is the normal case when there is a name and a title/link\n    titleName = pageTitle.textContent;\n    let pageIntro = document.querySelector(\"h1.pageTitle > p.pageIntro > a\");\n    titleCollection = pageIntro.textContent;\n  } else {\n    let pageTitleLink = document.querySelector(\"h1.pageTitle > a\");\n\n    if (pageTitleLink) {\n      titleCollection = pageTitleLink.textContent;\n    } else {\n      // this is a case that only seems to happen when fetching the page rather than opening it\n      // in a tab.\n      // There is a script that generates the span node we try to read above.\n      // The script is the next sibling to the pageTitleNode\n      let pageTitleNode = document.querySelector(\"h1.pageTitle\");\n      if (pageTitleNode) {\n        //console.log(\"pageTitle found, numChildren = \" + pageTitleNode.children.length);\n        let scriptNode = pageTitleNode.nextElementSibling;\n        if (scriptNode && scriptNode.tagName.toLowerCase() == \"script\") {\n          // we could evaluate the script but that might has security risks.\n          // since we know what the script looks like we could just search it for the string we want.\n          let scriptText = scriptNode.textContent;\n          //console.log(\"scriptText = \");\n          //console.log(scriptText);\n          const titleNamePrefix = 'nameSpanEl.textContent = \"';\n          let startIndex = scriptText.indexOf(titleNamePrefix);\n          if (startIndex != -1) {\n            startIndex += titleNamePrefix.length;\n            let endIndex = scriptText.indexOf('\"', startIndex);\n            if (endIndex != -1) {\n              titleName = scriptText.substring(startIndex, endIndex);\n            }\n          }\n          const titleCollectionPrefix = 'collectionAnchorEl.textContent = \"';\n          startIndex = scriptText.indexOf(titleCollectionPrefix);\n          if (startIndex != -1) {\n            startIndex += titleCollectionPrefix.length;\n            let endIndex = scriptText.indexOf('\"', startIndex);\n            if (endIndex != -1) {\n              titleCollection = scriptText.substring(startIndex, endIndex);\n            }\n          }\n          //console.log(\"titleName = \" + titleName);\n          //console.log(\"titleCollection = \" + titleCollection);\n        }\n      }\n    }\n  }\n\n  result.titleName = titleName;\n  result.titleCollection = titleCollection;\n}\n\nfunction extractRecordData(document, result) {\n  result.recordData = Object.create(null);\n\n  var recordDataRows = document.querySelectorAll(\"#recordData > table > tbody > tr\");\n\n  for (let row of recordDataRows.values()) {\n    // Get the label of the row (must be immediate child)\n    let labelNode = row.querySelector(\":scope > th\");\n    let label = labelNode ? labelNode.textContent : \"\";\n    if (label != \"\") {\n      label = cleanLabel(label);\n      let rowData = row.querySelector(\"td\");\n      let numChildren = rowData.children.length;\n\n      if (numChildren == 0) {\n        let value = rowData.textContent;\n        value = value.replace(/\\s+/g, \" \").trim();\n\n        if (!value.startsWith(\"Search for\")) {\n          //console.log(label + \" \" + value);\n          result.recordData[label] = value;\n        }\n      } else {\n        // there are children. There are several cases to handle here\n        if (rowData.classList.contains(\"p_embedTableTd\")) {\n          // Sub-tables are used for Household Members in census and Records on page in Marriage Reg\n          // If possible put each of the rows of the sub-table in the recordData with line breaks\n          if (label.includes(\"Household\")) {\n            result.household = {};\n            let headings = row.querySelectorAll(\"td.p_embedTableTd th.p_embedTableHead\");\n            if (headings.length > 0) {\n              result.household.headings = [];\n              result.household.members = [];\n              for (let heading of headings) {\n                result.household.headings.push(cleanText(heading.textContent));\n              }\n            }\n          }\n\n          let subTableRows = row.querySelectorAll(\"td.p_embedTableTd tr.p_embedTableRow\");\n          let value = \"\";\n          for (let subRow of subTableRows) {\n            if (value) {\n              value += \"<br/>\";\n            }\n            value += cleanText(subRow.textContent);\n\n            if (result.household !== undefined && result.household.members !== undefined) {\n              let member = {};\n              let subRowCells = subRow.querySelectorAll(\"td\");\n              if (subRowCells.length > 0) {\n                for (let cellIndex = 0; cellIndex < subRowCells.length; cellIndex++) {\n                  let cell = subRowCells[cellIndex];\n                  let memberText = cleanText(cell.textContent);\n                  let heading = result.household.headings[cellIndex];\n                  member[heading] = memberText;\n                  let linkNode = cell.querySelector(\"a\");\n                  if (linkNode) {\n                    let link = linkNode.getAttribute(\"href\");\n                    let extractResult = {};\n                    extractDbAndRecordId(extractResult, link);\n                    member.dbId = extractResult.dbId;\n                    member.recordId = extractResult.recordId;\n                    member.link = link; // used to fetch additional records if needed\n                  }\n                }\n              }\n\n              result.household.members.push(member);\n            }\n          }\n          if (value) {\n            result.recordData[label] = value;\n          }\n        } else {\n          // for now just get the text of all the children.\n          // there can be multiple children for \"Name:\" in death reg\n          // It can also happen for \"Inferred Spouse:\" in 1939 reg.\n          // We used to have code to handle more than one child and one child\n          // differently but now we threat then the same\n          // An example where this does not work is:\n          // https://search.ancestry.com/cgi-bin/sse.dll?indiv=1&db=61311&h=2913\n          let value = rowData.textContent;\n          value = cleanText(value);\n          if (value) {\n            if (!value.startsWith(\"Search for\") && !value.startsWith(\"View \")) {\n              // extra test - sometime the text includes a script. We definitely don't want to include that\n              let scriptNode = rowData.querySelector(\"script\");\n              if (!scriptNode) {\n                // If this is a link we also store the link - this is case we need to read that\n                // additional record (e.g. for a child baptism)\n                let linkNode = rowData.querySelector(\"a\");\n                if (linkNode) {\n                  // there are some links that are for viewing maps or ordering copies\n                  // It seems that these links have 'class=\"link\"' so if that is there ignore\n                  // this row\n                  if (linkNode.className != \"link\") {\n                    result.recordData[label] = value;\n\n                    let linkText = linkNode.textContent;\n                    // ignore links for alternate names\n                    if (!linkText || !linkText.startsWith(\"[\")) {\n                      let link = linkNode.getAttribute(\"href\");\n                      if (link) {\n                        if (!result.linkData) {\n                          result.linkData = {};\n                        }\n                        result.linkData[label] = link;\n                      }\n                    }\n                  }\n                } else {\n                  // no link just use all child text\n                  result.recordData[label] = value;\n                }\n              }\n            }\n          }\n        }\n      }\n    } else {\n      // this row doesn't have a <th> label. Could be something like \"Household members\"\n      if (row.classList.contains(`tableContainerRow`)) {\n        let table = row.querySelector(\"table\");\n\n        // collect all the headings and put them in a string with line breaks between them\n        let headings = table.querySelectorAll(\":scope thead tr th\");\n        let label = \"\";\n        for (let heading of headings) {\n          if (label) {\n            label += \"<br/>\";\n          }\n          label += cleanText(heading.textContent);\n        }\n\n        // now get each row of data and put them all in one string with line breaks between rows\n        let subTableRows = table.querySelectorAll(\":scope tbody tr\");\n        let value = \"\";\n        for (let subRow of subTableRows) {\n          if (value) {\n            value += \"<br/>\";\n          }\n          value += cleanText(subRow.textContent);\n        }\n        if (value) {\n          result.recordData[label] = value;\n        }\n\n        if (label.includes(\"Household\")) {\n          result.household = {};\n          if (headings.length > 0) {\n            result.household.headings = [];\n            result.household.members = [];\n            for (let heading of headings) {\n              result.household.headings.push(cleanText(heading.textContent));\n            }\n          }\n        }\n\n        for (let subRow of subTableRows.values()) {\n          if (result.household !== undefined && result.household.members !== undefined) {\n            let member = {};\n            let subRowCells = subRow.querySelectorAll(\"td\");\n            if (subRowCells.length > 0) {\n              for (let cellIndex = 0; cellIndex < subRowCells.length; cellIndex++) {\n                let cell = subRowCells[cellIndex];\n                let memberText = cleanText(cell.textContent);\n\n                if (cellIndex == 0) {\n                  // check for a closed record\n                  let lcText = memberText.toLowerCase();\n\n                  if (\n                    lcText == \"this record is officially closed.\" ||\n                    (lcText.includes(\"record\") && lcText.includes(\"closed\"))\n                  ) {\n                    member.isClosed = true;\n                    memberText = \"Closed Record\";\n                  }\n                }\n\n                let heading = result.household.headings[cellIndex];\n                member[heading] = memberText;\n\n                let linkNode = cell.querySelector(\"a\");\n                if (linkNode) {\n                  let link = linkNode.getAttribute(\"href\");\n                  let extractResult = {};\n                  extractDbAndRecordId(extractResult, link);\n                  member.dbId = extractResult.dbId;\n                  member.recordId = extractResult.recordId;\n                  member.link = link; // used to fetch additional records if needed\n                }\n              }\n            }\n\n            result.household.members.push(member);\n          }\n        }\n      }\n    }\n  }\n}\n\nfunction extractRecordSourceCitation(document, result) {\n  // test is there are contentViewTabs, this allow you to select between Detail and Source\n  let contentViewTabs = document.querySelector(\"#contentViewTabs\");\n\n  if (contentViewTabs) {\n    // example electoral registers\n    let sourceCitationChildren = document.querySelector(\"#sourceCitation\").children;\n\n    if (sourceCitationChildren.length > 0) {\n      let lastCitationTitle = \"\";\n\n      for (let index = 0; index < sourceCitationChildren.length; index++) {\n        let div = sourceCitationChildren[index];\n\n        let childCitationTitle = div.querySelector(\"h4.citationTitle\");\n        if (childCitationTitle) {\n          let citationTitle = childCitationTitle.textContent;\n          let sourceTextNode = div.querySelector(\"div.sourceText\");\n          if (sourceTextNode) {\n            if (citationTitle == \"Source Citation\") {\n              setSourceCitation(result, sourceTextNode);\n            } else if (citationTitle == \"Source Information\") {\n              setSourceInformation(result, sourceTextNode);\n            } else if (citationTitle == \"Description\") {\n              setSourceDescription(result, sourceTextNode);\n            }\n          }\n        } else {\n          if (div.classList.contains(\"citationTitle\")) {\n            lastCitationTitle = cleanText(div.textContent);\n            //console.log(\"lastCitationTitle = \" + lastCitationTitle);\n          } else if (div.classList.contains(\"sourceText\")) {\n            if (lastCitationTitle == \"Source Information\") {\n              setSourceInformation(result, div);\n            } else if (lastCitationTitle == \"Description\") {\n              setSourceDescription(result, div);\n            }\n          }\n        }\n      }\n    }\n  } else {\n    let sourceAreaDivs = document.querySelectorAll(\"#sourceCitation > div.conBody > div\");\n\n    if (sourceAreaDivs.length > 0) {\n      for (let index = 0; index < sourceAreaDivs.length; index++) {\n        let div = sourceAreaDivs[index];\n        let citationTitleNode = div.querySelector(\"h4.citationTitle\");\n        let sourceTextNode = div.querySelector(\"div.sourceText\");\n        if (citationTitleNode && sourceTextNode) {\n          let citationTitle = citationTitleNode.textContent;\n          if (citationTitle == \"Source Citation\") {\n            setSourceCitation(result, sourceTextNode);\n          } else if (citationTitle == \"Source Information\") {\n            setSourceInformation(result, sourceTextNode);\n          } else if (citationTitle == \"Description\") {\n            setSourceDescription(result, sourceTextNode);\n          }\n        }\n      }\n    }\n  }\n}\n\nfunction extractImageThumb(document, result) {\n  // Note (4 Sep 2021): Ancestry changed the web page to put an extra 2 div between\n  // imageThumb and the \"a\"\n  let thumbNode = document.querySelector(\"#thumbnailTools > div.imageThumb\");\n  //console.log(\"extractImageThumb, thumbNode = \");\n  //console.log(thumbNode);\n\n  if (thumbNode) {\n    let linkNode = thumbNode.querySelector(\"a\");\n    //console.log(\"extractImageThumb, linkNode = \");\n    //console.log(linkNode);\n\n    if (linkNode) {\n      let url = linkNode.getAttribute(\"href\");\n\n      //console.log(\"extractImageThumb, url = \" + url);\n\n      if (url) {\n        // Example:\n        // \"https://www.ancestry.com/imageviewer/collections/7814/images/LNDRG13_157_158-0095?pid=2229789&amp;backurl=https://search.ancestry.com/cgi-bin/sse.dll?dbid%3D7814%26h%3D2229789%26indiv%3Dtry%26o_vc%3DRecord:OtherRecord%26rhSource%3D8753&amp;treeid=&amp;personid=&amp;hintid=&amp;usePUB=true&amp;usePUBJs=true\"\n\n        let dbId = url.replace(/.*imageviewer\\/collections\\/([^\\/]+)\\/images\\/.*/, \"$1\");\n        let recordId = url.replace(/.*\\/images\\/([^?]+).*/, \"$1\");\n\n        result.imageUrl = url;\n        result.imageDbId = dbId;\n        result.imageRecordId = recordId;\n      }\n    } else {\n      // Sometimes in some browsers the linkNode is not there. This happens more when ther user is on the\n      // factEdit modal, especially in Firefox. It seems to be because the link node is generated by a script.\n      // This is a backup that gets the image id from the \"Report a problem\" link.\n      let reportProblemNode = document.querySelector(\"#thumbnailTools a.iconWarning\");\n      if (reportProblemNode) {\n        //console.log(\"extractImageThumb, reportProblemNode = \");\n        //console.log(reportProblemNode);\n\n        // Report problem node looks like:\n        // <a href=\"https://www.ancestry.com/feedback/reportissue?rp=RD&amp;pid=1903047&amp;dbid=2352&amp;imageId=rg14_00802_0395_03&amp;indexOnly=false&amp;backurl=http%3a%2f%2fsearch.ancestry.com%2fcgi-bin%2fsse.dll%3findiv%3d1%26dbid%3d2352%26h%3d1903047%26ssrc%3dpt%26tid%3d86808578%26pid%3d46552199708%26usePUB%3dtrue%26_gl%3d1*vivebz*_ga*MTA5NTMwNjUwOS4xNTg3ODQ4ODc3*_ga_4QT8FMEX30*MTY1MTYwMzE2NS4zMi4xLjE2NTE2MDYzNzkuMA..\" class=\"link icon iconWarning\"><span>Report a problem</span></a>\n\n        let url = reportProblemNode.getAttribute(\"href\");\n\n        //console.log(\"extractImageThumb, reportProblemNode URL = \");\n        //console.log(url);\n\n        if (url) {\n          let imageRecordId = \"\";\n          const imagePrefix = \"imageId=\";\n          let imageIndex = url.indexOf(imagePrefix);\n          if (imageIndex != -1) {\n            let endIndex = url.indexOf(\"&\", imageIndex);\n            if (endIndex != -1) {\n              imageRecordId = url.substring(imageIndex + imagePrefix.length, endIndex);\n              //console.log(\"extractImageThumb, imageRecordId = \" + imageRecordId);\n            }\n          }\n\n          let personId = \"\";\n          const personPrefix = \"pid=\";\n          let personIndex = url.indexOf(personPrefix);\n          if (personIndex != -1) {\n            let endIndex = url.indexOf(\"&\", personIndex);\n            if (endIndex != -1) {\n              personId = url.substring(personIndex + personPrefix.length, endIndex);\n              //console.log(\"extractImageThumb, personId = \" + personId);\n            }\n          }\n\n          if (result.domain && result.dbId && imageRecordId) {\n            result.imageRecordId = imageRecordId;\n            result.imageDbId = result.dbId;\n\n            if (imageRecordId && personId) {\n              // https://www.ancestry.com/imageviewer/collections/61596/images/tna_r39_0773_0773a_021?pid=10189262&treeid=113369578&personid=222372269795&usePUB=true&usePUBJs=true\n              result.imageUrl =\n                \"https://www.\" +\n                result.domain +\n                \"/imageviewer/collections/\" +\n                result.dbId +\n                \"/images/\" +\n                imageRecordId +\n                \"?pid=\" +\n                personId;\n            } else if (imageRecordId) {\n              result.imageUrl =\n                \"https://www.\" + result.domain + \"/imageviewer/collections/\" + result.dbId + \"/images/\" + imageRecordId;\n            }\n          }\n        }\n      }\n    }\n  }\n}\n\nfunction extractImagePageTitle(document, result) {\n  let titleCollection = \"\";\n  let titleName = \"\";\n\n  let titleCollectionNode = document.querySelector(\"div.collectionTitle > h1 > a\");\n  if (titleCollectionNode) {\n    titleCollection = titleCollectionNode.textContent;\n  }\n\n  let titleForNameNode = document.querySelector(\"div.collectionTitle > h1 > span\");\n  if (titleForNameNode) {\n    let titleForName = titleForNameNode.textContent;\n    titleForName = titleForName.replace(/^\\s*for\\s+/, \"\");\n    titleName = titleForName;\n  }\n\n  result.titleCollection = titleCollection;\n  result.titleName = titleName;\n}\n\nfunction extractImageBrowsePath(document, result) {\n  var wrapperNode = document.querySelector(\"div.browse-path-header > div.breadcrumbWrapper\");\n  let browsePath = \"\";\n  if (wrapperNode) {\n    let children = wrapperNode.children;\n    for (let index = 0; index < children.length; index++) {\n      let child = children[index];\n      if (child.classList.contains(\"breadcrumbItem\")) {\n        browsePath += child.textContent;\n      } else if (child.classList.contains(\"iconArrowRight\")) {\n        browsePath += \" > \";\n      }\n    }\n  }\n\n  if (browsePath) {\n    result.imageBrowsePath = browsePath;\n  }\n}\n\nfunction extractImageHasIndex(document, result) {\n  let indexButton = document.querySelector(\n    \"div.image-viewer-wrapper > div.container-space > div.bottom-container > div.paging-panel.panelTopHeight > div > button.indexToggle\"\n  );\n\n  if (indexButton) {\n    if (indexButton.classList.contains(\"disabled\")) {\n      result.imageHasIndex = false;\n    } else {\n      result.imageHasIndex = true;\n    }\n  }\n}\n\nfunction extractImageNumberAndTotal(document, result) {\n  let pageCountWrap = document.querySelector(\n    \"div.image-viewer-wrapper > div.container-space > div.bottom-container > div.paging-panel.panelTopHeight > div > div.imageNum.pageCountWrapInner\"\n  );\n\n  if (pageCountWrap) {\n    let pageNum = pageCountWrap.querySelector(\"input.page-input\");\n    if (pageNum) {\n      result.imageNumber = pageNum.value;\n    }\n\n    let imageCount = pageCountWrap.querySelector(\"span.imageCountText\");\n    if (imageCount) {\n      result.totalImages = imageCount.textContent;\n    }\n  }\n}\n\nfunction extractImageTemplate(result, url) {\n  // https://www.ancestry.com/imageviewer/collections/7814/images/LNDRG13_157_158-0095?treeid=&personid=&hintid=&usePUB=true&usePUBJs=true&_ga=2.91252573.636488732.1621444272-1095306509.1587848877&pId=2229789\n\n  let db = url.replace(/.*\\/imageviewer\\/collections\\/(\\w+)\\/.*/, \"$1\");\n  let rec = url.replace(/.*\\/images\\/([\\w\\d\\-_.]+).*/, \"$1\");\n  let pid = url.replace(/.*[\\?\\&]pId\\=(\\d+).*/, \"$1\");\n  let domain = url.replace(/.*\\.ancestry.([^\\/]+)\\/.*/, \"$1\");\n\n  if (db != \"\" && db != url && rec != \"\" && rec != url) {\n    result.dbId = db;\n    result.recordId = rec;\n    result.ancestryTemplate = \"{{Ancestry Image|\" + result.dbId + \"|\" + result.recordId + \"}}\";\n  }\n\n  if (pid != \"\" && pid != url) {\n    result.pid = pid;\n  }\n\n  if (domain != \"\" && domain != url) {\n    result.domain = domain;\n  }\n}\n\nfunction extractTreeTemplate(result, url) {\n  // e.g. \"https://www.ancestry.com/family-tree/person/tree/86808578/person/260133535006/facts\"\n  // becomes: {{Ancestry Tree|86808578|260133535006}}\n  const treePrefix = \"/family-tree/person/tree/\";\n  const personPrefix = \"/person/\";\n  let treePrefixIndex = url.indexOf(treePrefix);\n  if (treePrefixIndex != -1) {\n    let treeIndex = treePrefixIndex + treePrefix.length;\n    let personPrefixIndex = url.indexOf(personPrefix, treeIndex);\n    if (personPrefixIndex != -1) {\n      let tree = url.substring(treeIndex, personPrefixIndex);\n      let personIndex = personPrefixIndex + personPrefix.length;\n      let personEndIndex = url.indexOf(\"/\", personIndex);\n      if (personEndIndex != -1) {\n        let person = url.substring(personIndex, personEndIndex);\n        result.ancestryTemplate = \"{{Ancestry Tree|\" + tree + \"|\" + person + \"}}\";\n      }\n    }\n  }\n}\n\nfunction extractTreeMediaTemplate(result, url) {\n  // There are various URL forms:\n  // https://www.ancestry.com/family-tree/tree/86808578/media/d69a7d6a-c773-48b1-ab09-19100cd55c14\n  // https://www.ancestry.com/family-tree/tree/86808578/person/46552198684/media/d69a7d6a-c773-48b1-ab09-19100cd55c14\n  // https://www.ancestry.com/mediaui-viewer/tree/86808578/media/d69a7d6a-c773-48b1-ab09-19100cd55c14\n  // https://www.ancestry.com/mediaui-viewer/tree/86808578/person/46552198684/media/d69a7d6a-c773-48b1-ab09-19100cd55c14?usePUBJs=true\n\n  // becomes: {{Ancestry Tree Media|86808578|d69a7d6a-c773-48b1-ab09-19100cd55c14}}\n\n  const treePrefix = \"/tree/\";\n  const mediaPrefix = \"/media/\";\n  let treePrefixIndex = url.indexOf(treePrefix);\n  if (treePrefixIndex != -1) {\n    let treeIndex = treePrefixIndex + treePrefix.length;\n    let endTreeIndex = url.indexOf(\"/\", treeIndex);\n    if (endTreeIndex != -1) {\n      let tree = url.substring(treeIndex, endTreeIndex);\n\n      let mediaPrefixIndex = url.indexOf(mediaPrefix, endTreeIndex);\n      if (mediaPrefixIndex != -1) {\n        let mediaIndex = mediaPrefixIndex + mediaPrefix.length;\n        let mediaEndIndex = url.indexOf(\"/\", mediaIndex);\n        if (mediaEndIndex == -1) {\n          mediaEndIndex = url.indexOf(\"?\", mediaIndex);\n        }\n        if (mediaEndIndex == -1) {\n          mediaEndIndex = url.length;\n        }\n        if (mediaEndIndex != -1) {\n          let media = url.substring(mediaIndex, mediaEndIndex);\n          result.ancestryTemplate = \"{{Ancestry Tree Media|\" + tree + \"|\" + media + \"}}\";\n        }\n      }\n    }\n  }\n}\n\nfunction extractSharingUrlTemplate(document, result) {\n  let bandidoModal = document.querySelector(\"#modal > #modalFixed .bandido-modal-post-share .share-url\");\n  if (bandidoModal) {\n    let urlNode = bandidoModal.querySelector(\".url-input\");\n\n    if (urlNode) {\n      let url = urlNode.value;\n      // https://www.ancestry.com/sharing/24274440?h=95cf5c&utm_campaign=bandido-webparts&utm_source=post-share-modal&utm_medium=copy-url\n      let num1 = url.replace(/.*\\/sharing\\/(\\w+)\\?h\\=\\w+\\&.*/, \"$1\");\n      let num2 = url.replace(/.*\\/sharing\\/\\w+\\?h\\=(\\w+)\\&.*/, \"$1\");\n\n      result.ancestryTemplate = \"{{Ancestry Sharing|\" + num1 + \"|\" + num2 + \"}}\";\n\n      result.sharingUrl = url.replace(/(^.*\\/sharing\\/\\w+\\?h\\=\\w+)\\&.*/, \"$1\");\n    }\n  }\n}\n\nfunction extractSharingImageFullSizeLink(document, result) {\n  //console.log(\"extractSharingImageFullSizeLink\");\n\n  let attachmentContainer = document.querySelector(\"div.main-container > div.attachment-container\");\n  if (attachmentContainer) {\n    let zoomImg = attachmentContainer.querySelector(\"#zoomModal > #zoomContent > #zoomImg\");\n\n    let imageUrl = \"\";\n\n    if (zoomImg) {\n      imageUrl = zoomImg.getAttribute(\"src\");\n    } else {\n      let img = attachmentContainer.querySelector(\"img.attachment-image\");\n      if (img) {\n        imageUrl = img.getAttribute(\"src\");\n      }\n    }\n\n    //console.log(\"imageUrl is \" + imageUrl);\n\n    if (imageUrl) {\n      let maxParamIndex = imageUrl.toLowerCase().indexOf(\"&maxwidth=\");\n      if (maxParamIndex != -1) {\n        imageUrl = imageUrl.substring(0, maxParamIndex);\n      }\n      result.fullSizeSharingImageUrl = imageUrl;\n    }\n  }\n}\n\nfunction extractSharingImageFullSizeLinkV2(document, result) {\n  //console.log(\"extractSharingImageFullSizeLinkV2\");\n\n  let imageUrl = \"\";\n\n  let img = document.querySelector(\"#landingPageContent div.photo > img\");\n  if (img) {\n    imageUrl = img.getAttribute(\"src\");\n  }\n\n  //console.log(\"imageUrl is \" + imageUrl);\n\n  if (imageUrl) {\n    let maxParamIndex = imageUrl.toLowerCase().indexOf(\"&maxwidth=\");\n    if (maxParamIndex != -1) {\n      imageUrl = imageUrl.substring(0, maxParamIndex);\n    }\n    result.fullSizeSharingImageUrl = imageUrl;\n  }\n}\n\nfunction extractSharingImageFullSizeLinkDiscoveries(document, result) {\n  //console.log(\"extractSharingImageFullSizeLinkV2\");\n\n  let imageUrl = \"\";\n\n  let img = document.querySelector(\"#interactiveImageWidgetContainer > div > img\");\n  if (img) {\n    imageUrl = img.getAttribute(\"src\");\n\n    //console.log(\"imageUrl is \" + imageUrl);\n\n    // Example imageURL:\n    // https://mediasvc.ancestry.com/v2/image/namespaces/2442/media/m-t0627-02314-00441.jpg?securitytoken=xwf0ad4ee289f5eb0ebc4290c1c3a06f8ae8dac110959bce00&download=True&client=discoveryui-contentservice\n\n    // we want to remove the \"&download=True\" and onwards\n    if (imageUrl) {\n      let downloadParamIndex = imageUrl.toLowerCase().indexOf(\"&download=\");\n      if (downloadParamIndex != -1) {\n        imageUrl = imageUrl.substring(0, downloadParamIndex);\n      }\n      result.fullSizeSharingImageUrl = imageUrl;\n\n      const altString = img.getAttribute(\"alt\");\n      if (altString) {\n        result.titleCollection = altString;\n      }\n    }\n  } else {\n    // head > meta:nth-child(18)\n    let meta = document.querySelector(\"head > meta[content^='https://mediasvc.ancestry.']\");\n\n    if (meta) {\n      let imageUrl = meta.getAttribute(\"content\");\n\n      if (imageUrl) {\n        let maxParamIndex = imageUrl.toLowerCase().indexOf(\"&maxwidth=\");\n        if (maxParamIndex != -1) {\n          imageUrl = imageUrl.substring(0, maxParamIndex);\n        }\n        result.fullSizeSharingImageUrl = imageUrl;\n      }\n    }\n  }\n}\n\nfunction extractSharingImageOrRecordDetails(document, result) {\n  //console.log(\"extractSharingImageOrRecordDetails\");\n\n  if (result.fullSizeSharingImageUrl) {\n    // extract the dbId and imageId from image URL\n    // https://mediasvc.ancestry.com/v2/image/namespaces/6598/media/LNDRG12_136_137-0719.jpg?securityToken=xw9176821728cabb787654ce65368a763ae9313f7a99db0000&NamespaceId=6598&Client=Share\n\n    const dbId = result.fullSizeSharingImageUrl.replace(\n      /https?\\:\\/\\/[^\\/]+\\/v2\\/image\\/namespaces\\/([^\\/]+)\\/media\\/([^\\?\\.]+).*/,\n      \"$1\"\n    );\n    const imageId = result.fullSizeSharingImageUrl.replace(\n      /https?\\:\\/\\/[^\\/]+\\/v2\\/image\\/namespaces\\/([^\\/]+)\\/media\\/([^\\?\\.]+).*/,\n      \"$2\"\n    );\n\n    if (dbId && dbId != result.fullSizeSharingImageUrl) {\n      result.dbId = dbId;\n    }\n\n    if (imageId && imageId != result.fullSizeSharingImageUrl) {\n      result.recordId = imageId;\n    }\n  }\n\n  const titleElement = document.querySelector(\"title\");\n  if (titleElement) {\n    let title = titleElement.textContent;\n    const prefix = \"discovered in \";\n    const prefixIndex = title.indexOf(prefix);\n    if (prefixIndex != -1) {\n      let remainder = title.substring(prefixIndex + prefix.length);\n      const suffix = \" collection\";\n      if (remainder.endsWith(suffix)) {\n        remainder = remainder.substring(0, remainder.length - suffix.length);\n      }\n\n      if (remainder) {\n        result.titleCollection = remainder;\n      }\n    }\n  }\n\n  const titleName = document.querySelector(\"h1.subject-name\");\n  if (titleName && titleName.textContent) {\n    result.titleName = titleName.textContent.trim();\n  }\n\n  const personNarrative = document.querySelector(\"p.content-caption\");\n  if (personNarrative && personNarrative.textContent) {\n    result.personNarrative = personNarrative.textContent.trim();\n  }\n\n  // https://www.ancestry.com/sharing/26032858?h=db10de&clickref=1011lwhmEYYb%2C1011lwhmEYYb&adref=&o_xid=01011l4xx5&o_lid=01011l4xx5&o_sch=Affiliate+External\n  let num1 = result.url.replace(/.*\\.ancestry[^\\/]+\\/sharing\\/([^\\?]+)\\?.*/, \"$1\");\n  let num2 = result.url.replace(/.*\\.ancestry[^\\/]+\\/sharing\\/[^\\?]+\\?h\\=([^\\?\\&]+).*/, \"$1\");\n\n  if (num1 && num2) {\n    result.ancestryTemplate = \"{{Ancestry Sharing|\" + num1 + \"|\" + num2 + \"}}\";\n  }\n}\n\nfunction extractSharingImageOrRecordDetailsV2(document, result) {\n  //console.log(\"extractSharingImageOrRecordDetailsV2\");\n\n  const contentDiv = document.querySelector(\"#landingPageContent\");\n  if (contentDiv) {\n    const dataObjectId = contentDiv.getAttribute(\"data-object-id\");\n    if (dataObjectId) {\n      // example: \"7163-38659916\"\n      const dashIndex = dataObjectId.indexOf(\"-\");\n      if (dashIndex != -1) {\n        const dbId = dataObjectId.substring(0, dashIndex);\n        const recordId = dataObjectId.substring(dashIndex + 1);\n        if (dbId && recordId) {\n          result.dbId = dbId;\n          result.recordId = recordId;\n        }\n      }\n    }\n  }\n\n  const titleElement = document.querySelector(\"title\");\n  if (titleElement) {\n    let title = titleElement.textContent;\n    const prefix = \"Discovered by \";\n    if (title.startsWith(prefix)) {\n      const collectionIndex = title.indexOf(\" in \", prefix.length);\n      let remainder = title.substring(collectionIndex + 4);\n      const suffix = \" collection\";\n      if (remainder.endsWith(suffix)) {\n        remainder = remainder.substring(0, remainder.length - suffix.length);\n      }\n\n      if (remainder) {\n        result.titleCollection = remainder;\n      }\n    }\n  }\n\n  const titleName = document.querySelector(\"h2.conTitle\");\n  if (titleName && titleName.textContent) {\n    result.titleName = titleName.textContent.trim();\n  }\n\n  const personNarrative = document.querySelector(\"div.conBody > p\");\n  if (personNarrative && personNarrative.textContent) {\n    result.personNarrative = personNarrative.textContent.trim();\n  }\n\n  // https://www.ancestry.com/sharing/236392?token=3832226f2908014024cae3a4bbf644cc019539bca23c8b7133f0affb1529385c\n\n  let num1 = result.url.replace(/.*\\.ancestry[^\\/]+\\/sharing\\/([^\\?]+)\\?.*/, \"$1\");\n  let num2 = result.url.replace(/.*\\.ancestry[^\\/]+\\/sharing\\/[^\\?]+\\?token\\=([^\\?\\&]+).*/, \"$1\");\n\n  if (num1 && num2) {\n    result.ancestryTemplate = \"{{Ancestry Sharing|\" + num1 + \"|\" + num2 + \"}}\";\n  }\n}\n\nfunction extractSharingImageOrRecordDetailsDiscoveries(document, result) {\n  //console.log(\"extractSharingImageOrRecordDetailsDiscoveries\");\n\n  function getQueryField(regex) {\n    let value = result.url.replace(regex, \"$1\");\n\n    if (value && value != result.url) {\n      return value;\n    }\n  }\n\n  function setFromQueryField(regex, resultField) {\n    let value = getQueryField(regex);\n\n    if (value) {\n      result[resultField] = value;\n    }\n  }\n\n  // url contains dbid and recordid:\n  // https://www.ancestry.com/census-search/discoveries\n  // ?matchdbid=2442&matchrecordid=130891334\n  // &matchrelative=relative&share=1&matchgid=ZKaJzrJ3pquxvoYavEO5Hka1nA1QpAf5Wb\n  // &matchfirstname=Leslie%20R&matchlastname=Cox&matchbirthdate=1931&matchgender=male\n  setFromQueryField(/^.*[&?]matchdbid\\=([^&]+).*/, \"dbId\");\n  setFromQueryField(/^.*[&?]matchrecordid\\=([^&]+).*/, \"recordId\");\n\n  let fullName = \"\";\n  const firstNames = getQueryField(/^.*[&?]matchfirstname\\=([^&]+).*/);\n  const lastNames = getQueryField(/^.*[&?]matchlastname\\=([^&]+).*/);\n  if (firstNames) {\n    fullName = decodeURIComponent(firstNames);\n  }\n  if (lastNames) {\n    if (fullName) {\n      fullName += \" \";\n    }\n    fullName += decodeURIComponent(lastNames);\n  }\n  if (fullName) {\n    result.titleName = fullName;\n  }\n\n  // div.app-card-content > p.text2xlrg.textalt.topSpacing\n\n  const personNarrative = document.querySelector(\"div.app-card-content > p.text2xlrg.textalt.topSpacing\");\n  if (personNarrative && personNarrative.textContent) {\n    result.personNarrative = personNarrative.textContent.trim();\n  }\n}\n\nfunction detectPageType(document, result, url) {\n  if (url.includes(\"/imageviewer/collections/\")) {\n    let bandidoModal = document.querySelector(\"#modal > #modalFixed .bandido-modal-post-share .share-url\");\n    if (bandidoModal) {\n      result.pageType = \"sharingUrl\";\n    } else {\n      result.pageType = \"image\";\n    }\n  } else if (url.includes(\"/person/\") && url.includes(\"/facts\")) {\n    result.pageType = \"personFacts\";\n\n    let citationRecord = document.querySelector(\".modalContents #FactEditComponent section.citationRecord\");\n    if (citationRecord) {\n      result.pageType = \"personSourceCitation\";\n    }\n  } else if (url.includes(\"/discoveries\") || url.includes(\"matchdbid=\")) {\n    result.pageType = \"sharingImageOrRecord\";\n    result.sharingType = \"discoveries\";\n  } else if (url.includes(\"dbid=\") || url.includes(\"db=\") || url.includes(\"discoveryui-content\")) {\n    result.pageType = \"record\";\n  } else if (url.includes(\"/collections/\") && url.includes(\"/records/\")) {\n    result.pageType = \"record\";\n  } else if (url.includes(\"/sharing/\") && url.includes(\"?h=\")) {\n    result.pageType = \"sharingImageOrRecord\";\n    result.sharingType = \"v1\";\n  } else if (url.includes(\"/sharing/\") && url.includes(\"?token=\")) {\n    result.pageType = \"sharingImageOrRecord\";\n    result.sharingType = \"v2\";\n  } else if (url.includes(\"/media/\") && url.includes(\"/tree/\")) {\n    result.pageType = \"treeMedia\";\n  } else {\n    result.pageType = \"unknown\";\n  }\n\n  //console.log(\"detectPageType, result.pageType = \" + result.pageType);\n}\n\nfunction handlePersonSourceCitation(document, result) {\n  // This saves the extra click of having to click on \"View record\"\n\n  let modalContents = document.querySelector(\".modalContents\");\n  if (modalContents) {\n    let factEdit = modalContents.querySelector(\"#FactEditComponent\");\n    if (factEdit) {\n      let link = modalContents.querySelector(\"#viewRecordLink\");\n      if (link) {\n        let recordUrl = link.getAttribute(\"href\");\n\n        // for the normal case this is all we need since we will extract the rest of the data\n        // with a fetch using this. This gets us better data (mainly the link data)\n        result.recordUrl = recordUrl;\n\n        // However, if someones subscription doesn't allow acess to this record we may as well\n        // extract what we can.\n        extractDbAndRecordId(result, recordUrl);\n      }\n\n      let imageLink = modalContents.querySelector(\"#viewRecordImageLink\");\n      if (imageLink) {\n        let url = imageLink.getAttribute(\"href\");\n\n        //console.log(\"handlePersonSourceCitation, url = \" + url);\n\n        if (url) {\n          // Example:\n\n          // \"https://www.ancestry.com/interactive/2352/rg14_14817_0059_03/55565824\n          //    ?backurl=https://www.ancestry.com/family-tree/person/tree/86808578/person/46548439562/facts/citation/323635602069/edit/record\"\n          // clicking on this goes to:\n          // https://www.ancestry.com/imageviewer/collections/2352/images/rg14_14817_0059_03?pId=55565824\n\n          let dbId = \"\";\n          let recordId = \"\";\n\n          if (url.includes(\"/imageviewer/\")) {\n            dbId = url.replace(/.*imageviewer\\/collections\\/([^\\/]+)\\/images\\/.*/, \"$1\");\n            recordId = url.replace(/.*\\/images\\/([^?]+).*/, \"$1\");\n          } else if (url.includes(\"/interactive/\")) {\n            dbId = url.replace(/.*interactive\\/([^\\/]+)\\/[^\\/]+\\/.*/, \"$1\");\n            recordId = url.replace(/.*interactive\\/[^\\/]+\\/([^\\/]+)\\/.*/, \"$1\");\n            let base = url.replace(/(.*)\\/interactive\\/[^\\/]+\\/[^\\/]+\\/.*/, \"$1\");\n            url = base + \"/imageviewer/collections/\" + dbId + \"/images/\" + recordId;\n          }\n\n          result.imageUrl = url;\n          result.imageDbId = dbId;\n          result.imageRecordId = recordId;\n        }\n      }\n\n      let citationRecord = factEdit.querySelector(\"section.citationRecord\");\n      if (citationRecord) {\n        result.recordData = {};\n\n        let titleNode = citationRecord.querySelector(\"h3.conTitle\");\n        if (titleNode) {\n          result.titleCollection = titleNode.textContent;\n        }\n\n        let displayFields = citationRecord.querySelectorAll(\"tr[id^='displayFields']\");\n        for (let displayField of displayFields) {\n          let header = displayField.querySelector(\"th\");\n          let data = displayField.querySelector(\"td\");\n          if (header && data) {\n            let key = header.textContent;\n            let value = data.textContent;\n            if (key && value) {\n              // Marital Status can be \"Marital Status\" if no subscription etc\n              // That would be interpreted as \"Married\" if we set it\n              if (key != value) {\n                const placeholderValues = [\"city\", \"location\", \"gender\"];\n                if (!placeholderValues.includes(value)) {\n                  result.recordData[key] = value;\n                }\n              }\n            }\n          }\n        }\n\n        let householdMembers = citationRecord.querySelectorAll(\"tr[id^='householdMembers']\");\n        if (householdMembers && householdMembers.length > 0) {\n          result.household = {};\n          let tbody = householdMembers[0].parentElement;\n          if (tbody) {\n            let thead = tbody.previousElementSibling;\n            if (thead) {\n              let headingRow = thead.querySelector(\"tr\");\n              if (headingRow) {\n                result.household.headings = [];\n                result.household.members = [];\n                let headings = headingRow.querySelectorAll(\"th\");\n                for (let heading of headings) {\n                  result.household.headings.push(cleanText(heading.textContent));\n                }\n\n                let rows = tbody.querySelectorAll(\"tr\");\n                for (let row of rows) {\n                  let member = {};\n                  let subRowCells = row.querySelectorAll(\"th, td\");\n                  if (subRowCells.length > 0) {\n                    for (let cellIndex = 0; cellIndex < subRowCells.length; cellIndex++) {\n                      let cell = subRowCells[cellIndex];\n                      let memberText = cleanText(cell.textContent);\n                      member[result.household.headings[cellIndex]] = memberText;\n                    }\n                  }\n                  result.household.members.push(member);\n                }\n              }\n            }\n          }\n        }\n      }\n\n      let citationInfo = factEdit.querySelector(\"section.citationInformation\");\n      if (citationInfo) {\n        let body = citationInfo.querySelector(\"div.conBody\");\n        if (body) {\n          let dtNodes = body.querySelectorAll(\"dt\");\n          let ddNodes = body.querySelectorAll(\"dd\");\n          if (dtNodes.length == 1 && ddNodes.length == 1) {\n            let sourceText = cleanText(ddNodes[0].textContent);\n            result.sourceCitation = sourceText;\n          } else {\n            let sourceText = cleanText(body.textContent);\n            result.sourceCitation = sourceText;\n          }\n        }\n      }\n\n      let sourceInfo = factEdit.querySelector(\"section.sourceInformation\");\n      if (sourceInfo) {\n        let body = sourceInfo.querySelector(\"div.conBody\");\n        if (body) {\n          let sourceText = cleanText(body.textContent);\n          result.sourceInformation = sourceText;\n        }\n      }\n    }\n  }\n\n  //console.log(\"handleFactEdit, recordUrl is: \" + result.recordUrl);\n}\n\n// Extracting the HTML elements is working but I am unable to get the given name\n// and last name separately that way. There may be a way via a fetch.\n// This request:\n// https://www.ancestry.com/api/treesui-list/trees/11748183/recentlyviewedperson?expires=1667171853706\n// Gets this response:\n// {\"pid\":\"12992988602\",\"gname\":\"Fannie L.\",\"sname\":\"(Kemper) Money Barber\",\"isLiving\":false}\n// The pid can be compared with the pid of the page to make sure it is the right person.\nfunction handlePersonFacts(document, result) {\n  let personCardContainer = document.querySelector(\"#personCardContainer\");\n  if (personCardContainer) {\n    // There is no way that I have found to find the given name and surname separated in the\n    // HTML elements. But it can be found in a script.\n    let scriptElements = personCardContainer.querySelectorAll(\"script\");\n    for (let scriptElement of scriptElements) {\n      let text = scriptElement.textContent;\n      let fullNameIndex = text.indexOf(\"fullName:\");\n      if (fullNameIndex != -1) {\n        let endIndex = text.indexOf(\"}\", fullNameIndex);\n        if (endIndex != -1) {\n          let fullNameText = text.substring(fullNameIndex, endIndex);\n          let givenName = fullNameText.replace(/fullName: { given: '([^']*)', surname: '(([^']*))',.*/, \"$1\");\n          let surname = fullNameText.replace(/fullName: { given: '([^']*)', surname: '(([^']*))',.*/, \"$2\");\n          if (givenName && givenName != fullNameText) {\n            result.givenName = givenName;\n          }\n          if (surname && surname != fullNameText) {\n            result.surname = surname;\n          }\n        }\n      }\n    }\n\n    let userCardTitle = personCardContainer.querySelector(\".userCardTitle\");\n    if (userCardTitle) {\n      let fullName = userCardTitle.textContent;\n      if (fullName) {\n        result.titleName = fullName;\n      }\n    }\n\n    let userCardEvents = personCardContainer.querySelector(\".userCardEvents\");\n    if (userCardEvents) {\n      let birthDateSpan = userCardEvents.querySelector(\"span.birthDate\");\n      if (birthDateSpan) {\n        result.birthDate = birthDateSpan.textContent;\n      }\n      let birthPlaceSpan = userCardEvents.querySelector(\"span.birthPlace\");\n      if (birthPlaceSpan) {\n        result.birthPlace = birthPlaceSpan.textContent;\n      }\n\n      let deathDateSpan = userCardEvents.querySelector(\"span.deathDate\");\n      if (deathDateSpan) {\n        result.deathDate = deathDateSpan.textContent;\n      }\n      let deathPlaceSpan = userCardEvents.querySelector(\"span.deathPlace\");\n      if (deathPlaceSpan) {\n        result.deathPlace = deathPlaceSpan.textContent;\n      }\n    }\n  }\n\n  let researchListFacts = document.querySelector(\"#researchListFacts\");\n  if (researchListFacts) {\n    let factList = researchListFacts.querySelectorAll(\"li.researchListItem\");\n    for (let fact of factList) {\n      if (fact.classList.contains(\"researchListItemGender\")) {\n        let valueNode = fact.querySelector(\"h4\");\n        if (valueNode) {\n          let gender = valueNode.textContent;\n          if (gender) {\n            result.gender = gender;\n          }\n        }\n      } else {\n        let factItem = fact.querySelector(\"div.factItemFact\");\n        if (factItem) {\n          if (factItem.classList.contains(\"preferredEventMarriage\")) {\n            let marriage = {};\n            let dateNode = factItem.querySelector(\"span.factItemDate\");\n            if (dateNode) {\n              let date = dateNode.textContent;\n              if (date) {\n                marriage.date = date;\n              }\n            }\n            let placeNode = factItem.querySelector(\"span.factItemLocation\");\n            if (placeNode) {\n              let place = placeNode.textContent;\n              if (place) {\n                marriage.place = place;\n              }\n            }\n            let spouseNode = factItem.querySelector(\"h5.userCardTitle\");\n            if (spouseNode) {\n              let spouseName = spouseNode.textContent;\n              if (spouseName) {\n                marriage.spouseName = spouseName;\n              }\n            }\n\n            // add the marriage\n            if (!result.marriages) {\n              result.marriages = [];\n            }\n            result.marriages.push(marriage);\n          }\n        }\n      }\n    }\n  }\n\n  let familySection = document.querySelector(\"#familySection\");\n  if (familySection) {\n    // there can be multiple research lists but parents should always be first one\n    let parentResearchList = familySection.querySelector(\"ul.researchList\");\n\n    let parentItems = parentResearchList.querySelectorAll(\"li.researchListItem\");\n\n    if (parentItems.length == 2) {\n      let fatherItem = parentItems[0];\n      let fatherTitle = fatherItem.querySelector(\"h4.userCardTitle\");\n      if (fatherTitle) {\n        result.fatherName = fatherTitle.textContent;\n      }\n\n      let motherItem = parentItems[1];\n      let motherTitle = motherItem.querySelector(\"h4.userCardTitle\");\n      if (motherTitle) {\n        result.motherName = motherTitle.textContent;\n      }\n    }\n  }\n\n  // #family46552199474 > div.noTopSpacing.userCard.userCardSize2 > div.userCardContent.textWrap > h4\n\n  //console.log(\"handleFactEdit, recordUrl is: \" + result.recordUrl);\n}\n\n// Used by background for extracting a referenced record\nfunction extractRecord(document, url, result) {\n  extractDbAndRecordId(result, url);\n  extractRecordPageTitle(document, result);\n  extractRecordData(document, result);\n  extractImageThumb(document, result);\n  extractRecordSourceCitation(document, result);\n}\n\nfunction extractData(document, url) {\n  var result = {};\n\n  result.url = url; // useful to know what domain this record is from\n\n  //console.log(\"Ancestry extractData, url = \" + url);\n\n  // first determine what kind of page we are in.\n  // - Record page\n  // - Image page\n  // - Image page with sharing url up\n\n  detectPageType(document, result, url);\n\n  //console.log(\"Ancestry pageType is \" + result.pageType);\n\n  if (result.pageType == \"record\") {\n    //console.log(\"This is an Ancestry record page\");\n    extractDbAndRecordId(result, url);\n    extractRecordPageTitle(document, result);\n    extractRecordData(document, result);\n    extractImageThumb(document, result);\n    extractRecordSourceCitation(document, result);\n  } else if (result.pageType == \"image\") {\n    extractImagePageTitle(document, result);\n    extractImageTemplate(result, url);\n    extractImageBrowsePath(document, result);\n    extractImageNumberAndTotal(document, result);\n    extractImageHasIndex(document, result);\n  } else if (result.pageType == \"sharingUrl\") {\n    extractImagePageTitle(document, result);\n    extractSharingUrlTemplate(document, result);\n  } else if (result.pageType == \"sharingImageOrRecord\") {\n    if (result.sharingType == \"v1\") {\n      extractSharingImageFullSizeLink(document, result);\n      extractSharingImageOrRecordDetails(document, result);\n    } else if (result.sharingType == \"v2\") {\n      extractSharingImageFullSizeLinkV2(document, result);\n      extractSharingImageOrRecordDetailsV2(document, result);\n    } else if (result.sharingType == \"discoveries\") {\n      extractSharingImageFullSizeLinkDiscoveries(document, result);\n      extractSharingImageOrRecordDetailsDiscoveries(document, result);\n    }\n  } else if (result.pageType == \"personSourceCitation\") {\n    handlePersonSourceCitation(document, result);\n  } else if (result.pageType == \"personFacts\") {\n    handlePersonFacts(document, result);\n    extractTreeTemplate(result, url);\n  } else if (result.pageType == \"treeMedia\") {\n    extractTreeMediaTemplate(result, url);\n  }\n\n  //console.log(\"result of extractData on Ancestry\");\n  //console.log(result);\n\n  return result;\n}\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9leHRlbnNpb24vc2l0ZS9hbmNlc3RyeS9jb3JlL2FuY2VzdHJ5X2V4dHJhY3RfZGF0YS5tanMuanMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLG9DQUFvQzs7QUFFcEM7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsbUNBQW1DO0FBQ25DOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLDJCQUEyQjtBQUMzQix1QkFBdUI7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVU7QUFDVjtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSwrQkFBK0IsNkRBQTZEOztBQUU1RjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjs7QUFFQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRO0FBQ1I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0NBQXdDLGdDQUFnQztBQUN4RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0NBQXdDO0FBQ3hDO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVO0FBQ1Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQkFBa0I7QUFDbEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNB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Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1Q0FBdUMsZ0RBQWdEO0FBQ3ZGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxtQ0FBbUMsNENBQTRDOztBQUUvRTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxpQ0FBaUMsNENBQTRDO0FBQzdFO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBLGlDQUFpQyw0Q0FBNEM7QUFDN0U7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBLElBQUk7QUFDSjtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQSxJQUFJO0FBQ0o7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsWUFBWTtBQUNaO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0Q0FBNEMsZ0NBQWdDO0FBQzVFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZO0FBQ1o7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNDQUFzQztBQUN0QztBQUNBO0FBQ0EsNERBQTREO0FBQzVELDBEQUEwRDtBQUMxRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQSxvQkFBb0I7O0FBRXBCOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFc0QiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9DaXRhdGlvbkV4dHJhY3Rvci8uL2V4dGVuc2lvbi9zaXRlL2FuY2VzdHJ5L2NvcmUvYW5jZXN0cnlfZXh0cmFjdF9kYXRhLm1qcz9mZGZkIl0sInNvdXJjZXNDb250ZW50IjpbIi8qXG5NSVQgTGljZW5zZVxuXG5Db3B5cmlnaHQgKGMpIDIwMjAgUm9iZXJ0IE0gUGF2ZXlcblxuUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEgY29weVxub2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGUgXCJTb2Z0d2FyZVwiKSwgdG8gZGVhbFxuaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVzdHJpY3Rpb24sIGluY2x1ZGluZyB3aXRob3V0IGxpbWl0YXRpb24gdGhlIHJpZ2h0c1xudG8gdXNlLCBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLCBkaXN0cmlidXRlLCBzdWJsaWNlbnNlLCBhbmQvb3Igc2VsbFxuY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzXG5mdXJuaXNoZWQgdG8gZG8gc28sIHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZyBjb25kaXRpb25zOlxuXG5UaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZCBpbiBhbGxcbmNvcGllcyBvciBzdWJzdGFudGlhbCBwb3J0aW9ucyBvZiB0aGUgU29mdHdhcmUuXG5cblRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCBcIkFTIElTXCIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1JcbklNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLFxuRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFXG5BVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSXG5MSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLFxuT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTiBUSEVcblNPRlRXQVJFLlxuKi9cblxuZnVuY3Rpb24gY2xlYW5UZXh0KHRleHQpIHtcbiAgaWYgKCF0ZXh0KSB7XG4gICAgcmV0dXJuIFwiXCI7XG4gIH1cblxuICB0ZXh0ID0gdGV4dC5yZXBsYWNlKC9cXHMrL2csIFwiIFwiKTsgLy8gZWxpbWluYXRlIG5ic3AgYW5kIG11bHRpcGxlIHNwYWNlcyBldGNcblxuICAvLyBzb21ldGltZXMgdGhlIHRleHQgaXMgc29tZXRoaW5nIGxpa2UgXCJaYWNoYXJpYWggRGF2ZXlbWmVjaGFyaWFoIFBhdmV5XVwiXG4gIC8vIGluIHRoYXQgY2FzZSBhZGQgYSBzcGFjZSBiZWZvcmUgdGhlIFtcbiAgdGV4dCA9IHRleHQucmVwbGFjZSgvKFteXFxzXSlcXFsvLCBcIiQxIFtcIik7XG5cbiAgdGV4dCA9IHRleHQudHJpbSgpO1xuXG4gIHJldHVybiB0ZXh0O1xufVxuXG5mdW5jdGlvbiBjbGVhbkxhYmVsKHRleHQpIHtcbiAgaWYgKCF0ZXh0KSB7XG4gICAgcmV0dXJuIFwiXCI7XG4gIH1cblxuICB0ZXh0ID0gdGV4dC5yZXBsYWNlKC9cXHMvZywgXCIgXCIpOyAvLyBlbGltaW5hdGUgbmJzcCBldGNcbiAgdGV4dCA9IHRleHQudHJpbSgpO1xuXG4gIC8vIHJlbW92ZSB0cmFpbGluZyA6XG4gIHRleHQgPSB0ZXh0LnJlcGxhY2UoL1xccypcXDorJC8sIFwiXCIpO1xuXG4gIHJldHVybiB0ZXh0O1xufVxuXG5mdW5jdGlvbiBzZXRTb3VyY2VDaXRhdGlvbihyZXN1bHQsIHNvdXJjZVRleHROb2RlKSB7XG4gIGxldCBzb3VyY2VUZXh0ID0gY2xlYW5UZXh0KHNvdXJjZVRleHROb2RlLnRleHRDb250ZW50KTtcbiAgcmVzdWx0LnNvdXJjZUNpdGF0aW9uID0gc291cmNlVGV4dDtcbn1cblxuZnVuY3Rpb24gc2V0U291cmNlSW5mb3JtYXRpb24ocmVzdWx0LCBzb3VyY2VUZXh0Tm9kZSkge1xuICBsZXQgc291cmNlVGV4dCA9IGNsZWFuVGV4dChzb3VyY2VUZXh0Tm9kZS50ZXh0Q29udGVudCk7XG4gIHJlc3VsdC5zb3VyY2VJbmZvcm1hdGlvbiA9IHNvdXJjZVRleHQ7XG5cbiAgbGV0IG9yaWdpbmFsRGF0YSA9IFwiXCI7XG5cbiAgY29uc3Qgb3JpZ0RhdGFTdHIgPSBcIk9yaWdpbmFsIGRhdGE6XCI7XG4gIC8vIGZpcnN0IHNlZSBpZiB0aGVyZSBhcmUgY2hpbGQgcGFyYWdyYXBoc1xuICBsZXQgcGFyYWdyYXBoTm9kZXMgPSBzb3VyY2VUZXh0Tm9kZS5xdWVyeVNlbGVjdG9yQWxsKFwicFwiKTtcbiAgaWYgKHBhcmFncmFwaE5vZGVzLmxlbmd0aCA+IDEpIHtcbiAgICBmb3IgKGxldCBwYXJhIG9mIHBhcmFncmFwaE5vZGVzKSB7XG4gICAgICBsZXQgcGFyYVRleHQgPSBjbGVhblRleHQocGFyYS50ZXh0Q29udGVudCk7XG4gICAgICBpZiAocGFyYVRleHQuc3RhcnRzV2l0aChvcmlnRGF0YVN0cikpIHtcbiAgICAgICAgb3JpZ2luYWxEYXRhID0gcGFyYVRleHQuc3Vic3RyaW5nKG9yaWdEYXRhU3RyLmxlbmd0aCkudHJpbSgpO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgaWYgKHNvdXJjZVRleHQuc3RhcnRzV2l0aChvcmlnRGF0YVN0cikpIHtcbiAgICAgIG9yaWdpbmFsRGF0YSA9IHNvdXJjZVRleHQuc3Vic3RyaW5nKG9yaWdEYXRhU3RyLmxlbmd0aCkudHJpbSgpO1xuICAgIH1cbiAgfVxuXG4gIGlmIChvcmlnaW5hbERhdGEpIHtcbiAgICByZXN1bHQub3JpZ2luYWxEYXRhID0gY2xlYW5UZXh0KG9yaWdpbmFsRGF0YSk7XG4gIH1cbn1cblxuZnVuY3Rpb24gc2V0U291cmNlRGVzY3JpcHRpb24ocmVzdWx0LCBzb3VyY2VUZXh0Tm9kZSkge1xuICBsZXQgc291cmNlVGV4dCA9IGNsZWFuVGV4dChzb3VyY2VUZXh0Tm9kZS50ZXh0Q29udGVudCk7XG4gIHJlc3VsdC5zb3VyY2VEZXNjcmlwdGlvbiA9IHNvdXJjZVRleHQ7XG59XG5cbmZ1bmN0aW9uIGV4dHJhY3REYkFuZFJlY29yZElkKHJlc3VsdCwgdXJsKSB7XG4gIC8vY29uc29sZS5sb2coXCJsb2NhdGlvbiBocmVmIGlzXCIpO1xuICAvL2NvbnNvbGUubG9nKHVybCk7XG5cbiAgbGV0IGRiSWQgPSBcIlwiO1xuICBsZXQgcmVjb3JkSWQgPSBcIlwiO1xuICBjb25zdCBkYklkU3RyID0gXCJkYmlkPVwiOyAvLyBjb3VsZCBoYXZlICYgb3IgPyBiZWZvcmUgZGJpZFxuICBjb25zdCBkYlN0ciA9IFwiZGI9XCI7IC8vIE9uIHNvbWUgcmVjb3JkcyAobGlrZSBCaXJ0aCBSZWdpc3RyYXRpb25zKSBpdCBpcyBkYiByYXRoZXIgdGhhbiBkYmlkXG4gIGlmICh1cmwuaW5jbHVkZXMoZGJJZFN0cikgfHwgdXJsLmluY2x1ZGVzKGRiU3RyKSkge1xuICAgIHZhciBkYklkT3JEYlN0ciA9IHVybC5pbmNsdWRlcyhkYklkU3RyKSA/IGRiSWRTdHIgOiBkYlN0cjtcbiAgICBsZXQgZGJJZEluZGV4ID0gdXJsLmluZGV4T2YoZGJJZE9yRGJTdHIpO1xuICAgIGRiSWRJbmRleCArPSBkYklkT3JEYlN0ci5sZW5ndGg7XG4gICAgbGV0IGRiRW5kSW5kZXggPSB1cmwuaW5kZXhPZihcIiZcIiwgZGJJZEluZGV4KTtcbiAgICBpZiAoZGJFbmRJbmRleCAhPSAtMSkge1xuICAgICAgZGJJZCA9IHVybC5zdWJzdHJpbmcoZGJJZEluZGV4LCBkYkVuZEluZGV4KTtcbiAgICAgIGNvbnN0IHJlY1N0ciA9IFwiJmg9XCI7XG4gICAgICBsZXQgcmVjSW5kZXggPSB1cmwuaW5kZXhPZihyZWNTdHIsIGRiRW5kSW5kZXgpO1xuICAgICAgaWYgKHJlY0luZGV4ICE9IC0xKSB7XG4gICAgICAgIHJlY0luZGV4ICs9IHJlY1N0ci5sZW5ndGg7XG4gICAgICAgIGxldCBhbXBJbmRleCA9IHVybC5pbmRleE9mKFwiJlwiLCByZWNJbmRleCk7XG4gICAgICAgIGlmIChhbXBJbmRleCAhPSAtMSkge1xuICAgICAgICAgIHJlY29yZElkID0gdXJsLnN1YnN0cmluZyhyZWNJbmRleCwgYW1wSW5kZXgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJlY29yZElkID0gdXJsLnN1YnN0cmluZyhyZWNJbmRleCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH0gZWxzZSBpZiAodXJsLmluY2x1ZGVzKFwiZGlzY292ZXJ5dWktY29udGVudFwiKSkge1xuICAgIGxldCByZWMgPSB1cmwucmVwbGFjZSgvLipcXC9kaXNjb3Zlcnl1aS1jb250ZW50XFwvdmlld1xcLyhbXjpdKylcXDouKi8sIFwiJDFcIik7XG4gICAgbGV0IGRiID0gdXJsLnJlcGxhY2UoLy4qXFwvZGlzY292ZXJ5dWktY29udGVudFxcL3ZpZXdcXC9bXjpdK1xcOihcXGQrKS4qLywgXCIkMVwiKTtcbiAgICBpZiAoZGIgIT0gXCJcIiAmJiBkYiAhPSB1cmwgJiYgcmVjICE9IFwiXCIgJiYgcmVjICE9IHVybCkge1xuICAgICAgZGJJZCA9IGRiO1xuICAgICAgcmVjb3JkSWQgPSByZWM7XG4gICAgfVxuICB9IGVsc2UgaWYgKHVybC5pbmNsdWRlcyhcIi9jb2xsZWN0aW9ucy9cIikgJiYgdXJsLmluY2x1ZGVzKFwiL3JlY29yZHMvXCIpKSB7XG4gICAgbGV0IGRiID0gdXJsLnJlcGxhY2UoLy4qXFwvY29sbGVjdGlvbnNcXC8oW15cXC9dKylcXC9yZWNvcmRzXFwvLiovLCBcIiQxXCIpO1xuICAgIGxldCByZWMgPSB1cmwucmVwbGFjZSgvLipcXC9jb2xsZWN0aW9uc1xcL1teXFwvXStcXC9yZWNvcmRzXFwvKFteXFwvXSspLywgXCIkMVwiKTtcbiAgICBpZiAoZGIgIT0gXCJcIiAmJiBkYiAhPSB1cmwgJiYgcmVjICE9IFwiXCIgJiYgcmVjICE9IHVybCkge1xuICAgICAgZGJJZCA9IGRiO1xuICAgICAgcmVjb3JkSWQgPSByZWM7XG4gICAgfVxuICB9XG4gIC8vY29uc29sZS5sb2coXCJkYklkID0gXCIgKyBkYklkICsgXCIsIHJlY29yZElkID0gXCIgKyByZWNvcmRJZCk7XG5cbiAgcmVzdWx0LmRiSWQgPSBkYklkO1xuICByZXN1bHQucmVjb3JkSWQgPSByZWNvcmRJZDtcbiAgLy8gTm90ZSB0aGlzIGlzIG92ZXJpZGRlbiBpbiBidWlsZENpdGF0aW9uIHVzaW5nIHVzZSBvcHRpb25zXG4gIHJlc3VsdC5hbmNlc3RyeVRlbXBsYXRlID0gXCJ7e0FuY2VzdHJ5IFJlY29yZHxcIiArIHJlc3VsdC5kYklkICsgXCJ8XCIgKyByZXN1bHQucmVjb3JkSWQgKyBcIn19XCI7XG5cbiAgbGV0IGRvbWFpbiA9IHVybC5yZXBsYWNlKC8uKlxcLmFuY2VzdHJ5LihbXlxcL10rKVxcLy4qLywgXCIkMVwiKTtcbiAgcmVzdWx0LmRvbWFpbiA9IGRvbWFpbjtcbn1cblxuZnVuY3Rpb24gZXh0cmFjdFJlY29yZFBhZ2VUaXRsZShkb2N1bWVudCwgcmVzdWx0KSB7XG4gIGxldCB0aXRsZU5hbWUgPSBcIlwiO1xuICBsZXQgdGl0bGVDb2xsZWN0aW9uID0gXCJcIjtcblxuICBsZXQgcGFnZVRpdGxlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcImgxLnBhZ2VUaXRsZSA+IHNwYW5cIik7XG4gIGlmIChwYWdlVGl0bGUpIHtcbiAgICAvLyBUaGlzIGlzIHRoZSBub3JtYWwgY2FzZSB3aGVuIHRoZXJlIGlzIGEgbmFtZSBhbmQgYSB0aXRsZS9saW5rXG4gICAgdGl0bGVOYW1lID0gcGFnZVRpdGxlLnRleHRDb250ZW50O1xuICAgIGxldCBwYWdlSW50cm8gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiaDEucGFnZVRpdGxlID4gcC5wYWdlSW50cm8gPiBhXCIpO1xuICAgIHRpdGxlQ29sbGVjdGlvbiA9IHBhZ2VJbnRyby50ZXh0Q29udGVudDtcbiAgfSBlbHNlIHtcbiAgICBsZXQgcGFnZVRpdGxlTGluayA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCJoMS5wYWdlVGl0bGUgPiBhXCIpO1xuXG4gICAgaWYgKHBhZ2VUaXRsZUxpbmspIHtcbiAgICAgIHRpdGxlQ29sbGVjdGlvbiA9IHBhZ2VUaXRsZUxpbmsudGV4dENvbnRlbnQ7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIHRoaXMgaXMgYSBjYXNlIHRoYXQgb25seSBzZWVtcyB0byBoYXBwZW4gd2hlbiBmZXRjaGluZyB0aGUgcGFnZSByYXRoZXIgdGhhbiBvcGVuaW5nIGl0XG4gICAgICAvLyBpbiBhIHRhYi5cbiAgICAgIC8vIFRoZXJlIGlzIGEgc2NyaXB0IHRoYXQgZ2VuZXJhdGVzIHRoZSBzcGFuIG5vZGUgd2UgdHJ5IHRvIHJlYWQgYWJvdmUuXG4gICAgICAvLyBUaGUgc2NyaXB0IGlzIHRoZSBuZXh0IHNpYmxpbmcgdG8gdGhlIHBhZ2VUaXRsZU5vZGVcbiAgICAgIGxldCBwYWdlVGl0bGVOb2RlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcImgxLnBhZ2VUaXRsZVwiKTtcbiAgICAgIGlmIChwYWdlVGl0bGVOb2RlKSB7XG4gICAgICAgIC8vY29uc29sZS5sb2coXCJwYWdlVGl0bGUgZm91bmQsIG51bUNoaWxkcmVuID0gXCIgKyBwYWdlVGl0bGVOb2RlLmNoaWxkcmVuLmxlbmd0aCk7XG4gICAgICAgIGxldCBzY3JpcHROb2RlID0gcGFnZVRpdGxlTm9kZS5uZXh0RWxlbWVudFNpYmxpbmc7XG4gICAgICAgIGlmIChzY3JpcHROb2RlICYmIHNjcmlwdE5vZGUudGFnTmFtZS50b0xvd2VyQ2FzZSgpID09IFwic2NyaXB0XCIpIHtcbiAgICAgICAgICAvLyB3ZSBjb3VsZCBldmFsdWF0ZSB0aGUgc2NyaXB0IGJ1dCB0aGF0IG1pZ2h0IGhhcyBzZWN1cml0eSByaXNrcy5cbiAgICAgICAgICAvLyBzaW5jZSB3ZSBrbm93IHdoYXQgdGhlIHNjcmlwdCBsb29rcyBsaWtlIHdlIGNvdWxkIGp1c3Qgc2VhcmNoIGl0IGZvciB0aGUgc3RyaW5nIHdlIHdhbnQuXG4gICAgICAgICAgbGV0IHNjcmlwdFRleHQgPSBzY3JpcHROb2RlLnRleHRDb250ZW50O1xuICAgICAgICAgIC8vY29uc29sZS5sb2coXCJzY3JpcHRUZXh0ID0gXCIpO1xuICAgICAgICAgIC8vY29uc29sZS5sb2coc2NyaXB0VGV4dCk7XG4gICAgICAgICAgY29uc3QgdGl0bGVOYW1lUHJlZml4ID0gJ25hbWVTcGFuRWwudGV4dENvbnRlbnQgPSBcIic7XG4gICAgICAgICAgbGV0IHN0YXJ0SW5kZXggPSBzY3JpcHRUZXh0LmluZGV4T2YodGl0bGVOYW1lUHJlZml4KTtcbiAgICAgICAgICBpZiAoc3RhcnRJbmRleCAhPSAtMSkge1xuICAgICAgICAgICAgc3RhcnRJbmRleCArPSB0aXRsZU5hbWVQcmVmaXgubGVuZ3RoO1xuICAgICAgICAgICAgbGV0IGVuZEluZGV4ID0gc2NyaXB0VGV4dC5pbmRleE9mKCdcIicsIHN0YXJ0SW5kZXgpO1xuICAgICAgICAgICAgaWYgKGVuZEluZGV4ICE9IC0xKSB7XG4gICAgICAgICAgICAgIHRpdGxlTmFtZSA9IHNjcmlwdFRleHQuc3Vic3RyaW5nKHN0YXJ0SW5kZXgsIGVuZEluZGV4KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgY29uc3QgdGl0bGVDb2xsZWN0aW9uUHJlZml4ID0gJ2NvbGxlY3Rpb25BbmNob3JFbC50ZXh0Q29udGVudCA9IFwiJztcbiAgICAgICAgICBzdGFydEluZGV4ID0gc2NyaXB0VGV4dC5pbmRleE9mKHRpdGxlQ29sbGVjdGlvblByZWZpeCk7XG4gICAgICAgICAgaWYgKHN0YXJ0SW5kZXggIT0gLTEpIHtcbiAgICAgICAgICAgIHN0YXJ0SW5kZXggKz0gdGl0bGVDb2xsZWN0aW9uUHJlZml4Lmxlbmd0aDtcbiAgICAgICAgICAgIGxldCBlbmRJbmRleCA9IHNjcmlwdFRleHQuaW5kZXhPZignXCInLCBzdGFydEluZGV4KTtcbiAgICAgICAgICAgIGlmIChlbmRJbmRleCAhPSAtMSkge1xuICAgICAgICAgICAgICB0aXRsZUNvbGxlY3Rpb24gPSBzY3JpcHRUZXh0LnN1YnN0cmluZyhzdGFydEluZGV4LCBlbmRJbmRleCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIC8vY29uc29sZS5sb2coXCJ0aXRsZU5hbWUgPSBcIiArIHRpdGxlTmFtZSk7XG4gICAgICAgICAgLy9jb25zb2xlLmxvZyhcInRpdGxlQ29sbGVjdGlvbiA9IFwiICsgdGl0bGVDb2xsZWN0aW9uKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHJlc3VsdC50aXRsZU5hbWUgPSB0aXRsZU5hbWU7XG4gIHJlc3VsdC50aXRsZUNvbGxlY3Rpb24gPSB0aXRsZUNvbGxlY3Rpb247XG59XG5cbmZ1bmN0aW9uIGV4dHJhY3RSZWNvcmREYXRhKGRvY3VtZW50LCByZXN1bHQpIHtcbiAgcmVzdWx0LnJlY29yZERhdGEgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuXG4gIHZhciByZWNvcmREYXRhUm93cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIjcmVjb3JkRGF0YSA+IHRhYmxlID4gdGJvZHkgPiB0clwiKTtcblxuICBmb3IgKGxldCByb3cgb2YgcmVjb3JkRGF0YVJvd3MudmFsdWVzKCkpIHtcbiAgICAvLyBHZXQgdGhlIGxhYmVsIG9mIHRoZSByb3cgKG11c3QgYmUgaW1tZWRpYXRlIGNoaWxkKVxuICAgIGxldCBsYWJlbE5vZGUgPSByb3cucXVlcnlTZWxlY3RvcihcIjpzY29wZSA+IHRoXCIpO1xuICAgIGxldCBsYWJlbCA9IGxhYmVsTm9kZSA/IGxhYmVsTm9kZS50ZXh0Q29udGVudCA6IFwiXCI7XG4gICAgaWYgKGxhYmVsICE9IFwiXCIpIHtcbiAgICAgIGxhYmVsID0gY2xlYW5MYWJlbChsYWJlbCk7XG4gICAgICBsZXQgcm93RGF0YSA9IHJvdy5xdWVyeVNlbGVjdG9yKFwidGRcIik7XG4gICAgICBsZXQgbnVtQ2hpbGRyZW4gPSByb3dEYXRhLmNoaWxkcmVuLmxlbmd0aDtcblxuICAgICAgaWYgKG51bUNoaWxkcmVuID09IDApIHtcbiAgICAgICAgbGV0IHZhbHVlID0gcm93RGF0YS50ZXh0Q29udGVudDtcbiAgICAgICAgdmFsdWUgPSB2YWx1ZS5yZXBsYWNlKC9cXHMrL2csIFwiIFwiKS50cmltKCk7XG5cbiAgICAgICAgaWYgKCF2YWx1ZS5zdGFydHNXaXRoKFwiU2VhcmNoIGZvclwiKSkge1xuICAgICAgICAgIC8vY29uc29sZS5sb2cobGFiZWwgKyBcIiBcIiArIHZhbHVlKTtcbiAgICAgICAgICByZXN1bHQucmVjb3JkRGF0YVtsYWJlbF0gPSB2YWx1ZTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gdGhlcmUgYXJlIGNoaWxkcmVuLiBUaGVyZSBhcmUgc2V2ZXJhbCBjYXNlcyB0byBoYW5kbGUgaGVyZVxuICAgICAgICBpZiAocm93RGF0YS5jbGFzc0xpc3QuY29udGFpbnMoXCJwX2VtYmVkVGFibGVUZFwiKSkge1xuICAgICAgICAgIC8vIFN1Yi10YWJsZXMgYXJlIHVzZWQgZm9yIEhvdXNlaG9sZCBNZW1iZXJzIGluIGNlbnN1cyBhbmQgUmVjb3JkcyBvbiBwYWdlIGluIE1hcnJpYWdlIFJlZ1xuICAgICAgICAgIC8vIElmIHBvc3NpYmxlIHB1dCBlYWNoIG9mIHRoZSByb3dzIG9mIHRoZSBzdWItdGFibGUgaW4gdGhlIHJlY29yZERhdGEgd2l0aCBsaW5lIGJyZWFrc1xuICAgICAgICAgIGlmIChsYWJlbC5pbmNsdWRlcyhcIkhvdXNlaG9sZFwiKSkge1xuICAgICAgICAgICAgcmVzdWx0LmhvdXNlaG9sZCA9IHt9O1xuICAgICAgICAgICAgbGV0IGhlYWRpbmdzID0gcm93LnF1ZXJ5U2VsZWN0b3JBbGwoXCJ0ZC5wX2VtYmVkVGFibGVUZCB0aC5wX2VtYmVkVGFibGVIZWFkXCIpO1xuICAgICAgICAgICAgaWYgKGhlYWRpbmdzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgcmVzdWx0LmhvdXNlaG9sZC5oZWFkaW5ncyA9IFtdO1xuICAgICAgICAgICAgICByZXN1bHQuaG91c2Vob2xkLm1lbWJlcnMgPSBbXTtcbiAgICAgICAgICAgICAgZm9yIChsZXQgaGVhZGluZyBvZiBoZWFkaW5ncykge1xuICAgICAgICAgICAgICAgIHJlc3VsdC5ob3VzZWhvbGQuaGVhZGluZ3MucHVzaChjbGVhblRleHQoaGVhZGluZy50ZXh0Q29udGVudCkpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgbGV0IHN1YlRhYmxlUm93cyA9IHJvdy5xdWVyeVNlbGVjdG9yQWxsKFwidGQucF9lbWJlZFRhYmxlVGQgdHIucF9lbWJlZFRhYmxlUm93XCIpO1xuICAgICAgICAgIGxldCB2YWx1ZSA9IFwiXCI7XG4gICAgICAgICAgZm9yIChsZXQgc3ViUm93IG9mIHN1YlRhYmxlUm93cykge1xuICAgICAgICAgICAgaWYgKHZhbHVlKSB7XG4gICAgICAgICAgICAgIHZhbHVlICs9IFwiPGJyLz5cIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhbHVlICs9IGNsZWFuVGV4dChzdWJSb3cudGV4dENvbnRlbnQpO1xuXG4gICAgICAgICAgICBpZiAocmVzdWx0LmhvdXNlaG9sZCAhPT0gdW5kZWZpbmVkICYmIHJlc3VsdC5ob3VzZWhvbGQubWVtYmVycyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgIGxldCBtZW1iZXIgPSB7fTtcbiAgICAgICAgICAgICAgbGV0IHN1YlJvd0NlbGxzID0gc3ViUm93LnF1ZXJ5U2VsZWN0b3JBbGwoXCJ0ZFwiKTtcbiAgICAgICAgICAgICAgaWYgKHN1YlJvd0NlbGxzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBjZWxsSW5kZXggPSAwOyBjZWxsSW5kZXggPCBzdWJSb3dDZWxscy5sZW5ndGg7IGNlbGxJbmRleCsrKSB7XG4gICAgICAgICAgICAgICAgICBsZXQgY2VsbCA9IHN1YlJvd0NlbGxzW2NlbGxJbmRleF07XG4gICAgICAgICAgICAgICAgICBsZXQgbWVtYmVyVGV4dCA9IGNsZWFuVGV4dChjZWxsLnRleHRDb250ZW50KTtcbiAgICAgICAgICAgICAgICAgIGxldCBoZWFkaW5nID0gcmVzdWx0LmhvdXNlaG9sZC5oZWFkaW5nc1tjZWxsSW5kZXhdO1xuICAgICAgICAgICAgICAgICAgbWVtYmVyW2hlYWRpbmddID0gbWVtYmVyVGV4dDtcbiAgICAgICAgICAgICAgICAgIGxldCBsaW5rTm9kZSA9IGNlbGwucXVlcnlTZWxlY3RvcihcImFcIik7XG4gICAgICAgICAgICAgICAgICBpZiAobGlua05vZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgbGV0IGxpbmsgPSBsaW5rTm9kZS5nZXRBdHRyaWJ1dGUoXCJocmVmXCIpO1xuICAgICAgICAgICAgICAgICAgICBsZXQgZXh0cmFjdFJlc3VsdCA9IHt9O1xuICAgICAgICAgICAgICAgICAgICBleHRyYWN0RGJBbmRSZWNvcmRJZChleHRyYWN0UmVzdWx0LCBsaW5rKTtcbiAgICAgICAgICAgICAgICAgICAgbWVtYmVyLmRiSWQgPSBleHRyYWN0UmVzdWx0LmRiSWQ7XG4gICAgICAgICAgICAgICAgICAgIG1lbWJlci5yZWNvcmRJZCA9IGV4dHJhY3RSZXN1bHQucmVjb3JkSWQ7XG4gICAgICAgICAgICAgICAgICAgIG1lbWJlci5saW5rID0gbGluazsgLy8gdXNlZCB0byBmZXRjaCBhZGRpdGlvbmFsIHJlY29yZHMgaWYgbmVlZGVkXG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgcmVzdWx0LmhvdXNlaG9sZC5tZW1iZXJzLnB1c2gobWVtYmVyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKHZhbHVlKSB7XG4gICAgICAgICAgICByZXN1bHQucmVjb3JkRGF0YVtsYWJlbF0gPSB2YWx1ZTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy8gZm9yIG5vdyBqdXN0IGdldCB0aGUgdGV4dCBvZiBhbGwgdGhlIGNoaWxkcmVuLlxuICAgICAgICAgIC8vIHRoZXJlIGNhbiBiZSBtdWx0aXBsZSBjaGlsZHJlbiBmb3IgXCJOYW1lOlwiIGluIGRlYXRoIHJlZ1xuICAgICAgICAgIC8vIEl0IGNhbiBhbHNvIGhhcHBlbiBmb3IgXCJJbmZlcnJlZCBTcG91c2U6XCIgaW4gMTkzOSByZWcuXG4gICAgICAgICAgLy8gV2UgdXNlZCB0byBoYXZlIGNvZGUgdG8gaGFuZGxlIG1vcmUgdGhhbiBvbmUgY2hpbGQgYW5kIG9uZSBjaGlsZFxuICAgICAgICAgIC8vIGRpZmZlcmVudGx5IGJ1dCBub3cgd2UgdGhyZWF0IHRoZW4gdGhlIHNhbWVcbiAgICAgICAgICAvLyBBbiBleGFtcGxlIHdoZXJlIHRoaXMgZG9lcyBub3Qgd29yayBpczpcbiAgICAgICAgICAvLyBodHRwczovL3NlYXJjaC5hbmNlc3RyeS5jb20vY2dpLWJpbi9zc2UuZGxsP2luZGl2PTEmZGI9NjEzMTEmaD0yOTEzXG4gICAgICAgICAgbGV0IHZhbHVlID0gcm93RGF0YS50ZXh0Q29udGVudDtcbiAgICAgICAgICB2YWx1ZSA9IGNsZWFuVGV4dCh2YWx1ZSk7XG4gICAgICAgICAgaWYgKHZhbHVlKSB7XG4gICAgICAgICAgICBpZiAoIXZhbHVlLnN0YXJ0c1dpdGgoXCJTZWFyY2ggZm9yXCIpICYmICF2YWx1ZS5zdGFydHNXaXRoKFwiVmlldyBcIikpIHtcbiAgICAgICAgICAgICAgLy8gZXh0cmEgdGVzdCAtIHNvbWV0aW1lIHRoZSB0ZXh0IGluY2x1ZGVzIGEgc2NyaXB0LiBXZSBkZWZpbml0ZWx5IGRvbid0IHdhbnQgdG8gaW5jbHVkZSB0aGF0XG4gICAgICAgICAgICAgIGxldCBzY3JpcHROb2RlID0gcm93RGF0YS5xdWVyeVNlbGVjdG9yKFwic2NyaXB0XCIpO1xuICAgICAgICAgICAgICBpZiAoIXNjcmlwdE5vZGUpIHtcbiAgICAgICAgICAgICAgICAvLyBJZiB0aGlzIGlzIGEgbGluayB3ZSBhbHNvIHN0b3JlIHRoZSBsaW5rIC0gdGhpcyBpcyBjYXNlIHdlIG5lZWQgdG8gcmVhZCB0aGF0XG4gICAgICAgICAgICAgICAgLy8gYWRkaXRpb25hbCByZWNvcmQgKGUuZy4gZm9yIGEgY2hpbGQgYmFwdGlzbSlcbiAgICAgICAgICAgICAgICBsZXQgbGlua05vZGUgPSByb3dEYXRhLnF1ZXJ5U2VsZWN0b3IoXCJhXCIpO1xuICAgICAgICAgICAgICAgIGlmIChsaW5rTm9kZSkge1xuICAgICAgICAgICAgICAgICAgLy8gdGhlcmUgYXJlIHNvbWUgbGlua3MgdGhhdCBhcmUgZm9yIHZpZXdpbmcgbWFwcyBvciBvcmRlcmluZyBjb3BpZXNcbiAgICAgICAgICAgICAgICAgIC8vIEl0IHNlZW1zIHRoYXQgdGhlc2UgbGlua3MgaGF2ZSAnY2xhc3M9XCJsaW5rXCInIHNvIGlmIHRoYXQgaXMgdGhlcmUgaWdub3JlXG4gICAgICAgICAgICAgICAgICAvLyB0aGlzIHJvd1xuICAgICAgICAgICAgICAgICAgaWYgKGxpbmtOb2RlLmNsYXNzTmFtZSAhPSBcImxpbmtcIikge1xuICAgICAgICAgICAgICAgICAgICByZXN1bHQucmVjb3JkRGF0YVtsYWJlbF0gPSB2YWx1ZTtcblxuICAgICAgICAgICAgICAgICAgICBsZXQgbGlua1RleHQgPSBsaW5rTm9kZS50ZXh0Q29udGVudDtcbiAgICAgICAgICAgICAgICAgICAgLy8gaWdub3JlIGxpbmtzIGZvciBhbHRlcm5hdGUgbmFtZXNcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFsaW5rVGV4dCB8fCAhbGlua1RleHQuc3RhcnRzV2l0aChcIltcIikpIHtcbiAgICAgICAgICAgICAgICAgICAgICBsZXQgbGluayA9IGxpbmtOb2RlLmdldEF0dHJpYnV0ZShcImhyZWZcIik7XG4gICAgICAgICAgICAgICAgICAgICAgaWYgKGxpbmspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghcmVzdWx0LmxpbmtEYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5saW5rRGF0YSA9IHt9O1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LmxpbmtEYXRhW2xhYmVsXSA9IGxpbms7XG4gICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgIC8vIG5vIGxpbmsganVzdCB1c2UgYWxsIGNoaWxkIHRleHRcbiAgICAgICAgICAgICAgICAgIHJlc3VsdC5yZWNvcmREYXRhW2xhYmVsXSA9IHZhbHVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICAvLyB0aGlzIHJvdyBkb2Vzbid0IGhhdmUgYSA8dGg+IGxhYmVsLiBDb3VsZCBiZSBzb21ldGhpbmcgbGlrZSBcIkhvdXNlaG9sZCBtZW1iZXJzXCJcbiAgICAgIGlmIChyb3cuY2xhc3NMaXN0LmNvbnRhaW5zKGB0YWJsZUNvbnRhaW5lclJvd2ApKSB7XG4gICAgICAgIGxldCB0YWJsZSA9IHJvdy5xdWVyeVNlbGVjdG9yKFwidGFibGVcIik7XG5cbiAgICAgICAgLy8gY29sbGVjdCBhbGwgdGhlIGhlYWRpbmdzIGFuZCBwdXQgdGhlbSBpbiBhIHN0cmluZyB3aXRoIGxpbmUgYnJlYWtzIGJldHdlZW4gdGhlbVxuICAgICAgICBsZXQgaGVhZGluZ3MgPSB0YWJsZS5xdWVyeVNlbGVjdG9yQWxsKFwiOnNjb3BlIHRoZWFkIHRyIHRoXCIpO1xuICAgICAgICBsZXQgbGFiZWwgPSBcIlwiO1xuICAgICAgICBmb3IgKGxldCBoZWFkaW5nIG9mIGhlYWRpbmdzKSB7XG4gICAgICAgICAgaWYgKGxhYmVsKSB7XG4gICAgICAgICAgICBsYWJlbCArPSBcIjxici8+XCI7XG4gICAgICAgICAgfVxuICAgICAgICAgIGxhYmVsICs9IGNsZWFuVGV4dChoZWFkaW5nLnRleHRDb250ZW50KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIG5vdyBnZXQgZWFjaCByb3cgb2YgZGF0YSBhbmQgcHV0IHRoZW0gYWxsIGluIG9uZSBzdHJpbmcgd2l0aCBsaW5lIGJyZWFrcyBiZXR3ZWVuIHJvd3NcbiAgICAgICAgbGV0IHN1YlRhYmxlUm93cyA9IHRhYmxlLnF1ZXJ5U2VsZWN0b3JBbGwoXCI6c2NvcGUgdGJvZHkgdHJcIik7XG4gICAgICAgIGxldCB2YWx1ZSA9IFwiXCI7XG4gICAgICAgIGZvciAobGV0IHN1YlJvdyBvZiBzdWJUYWJsZVJvd3MpIHtcbiAgICAgICAgICBpZiAodmFsdWUpIHtcbiAgICAgICAgICAgIHZhbHVlICs9IFwiPGJyLz5cIjtcbiAgICAgICAgICB9XG4gICAgICAgICAgdmFsdWUgKz0gY2xlYW5UZXh0KHN1YlJvdy50ZXh0Q29udGVudCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHZhbHVlKSB7XG4gICAgICAgICAgcmVzdWx0LnJlY29yZERhdGFbbGFiZWxdID0gdmFsdWU7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAobGFiZWwuaW5jbHVkZXMoXCJIb3VzZWhvbGRcIikpIHtcbiAgICAgICAgICByZXN1bHQuaG91c2Vob2xkID0ge307XG4gICAgICAgICAgaWYgKGhlYWRpbmdzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIHJlc3VsdC5ob3VzZWhvbGQuaGVhZGluZ3MgPSBbXTtcbiAgICAgICAgICAgIHJlc3VsdC5ob3VzZWhvbGQubWVtYmVycyA9IFtdO1xuICAgICAgICAgICAgZm9yIChsZXQgaGVhZGluZyBvZiBoZWFkaW5ncykge1xuICAgICAgICAgICAgICByZXN1bHQuaG91c2Vob2xkLmhlYWRpbmdzLnB1c2goY2xlYW5UZXh0KGhlYWRpbmcudGV4dENvbnRlbnQpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBmb3IgKGxldCBzdWJSb3cgb2Ygc3ViVGFibGVSb3dzLnZhbHVlcygpKSB7XG4gICAgICAgICAgaWYgKHJlc3VsdC5ob3VzZWhvbGQgIT09IHVuZGVmaW5lZCAmJiByZXN1bHQuaG91c2Vob2xkLm1lbWJlcnMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgbGV0IG1lbWJlciA9IHt9O1xuICAgICAgICAgICAgbGV0IHN1YlJvd0NlbGxzID0gc3ViUm93LnF1ZXJ5U2VsZWN0b3JBbGwoXCJ0ZFwiKTtcbiAgICAgICAgICAgIGlmIChzdWJSb3dDZWxscy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgIGZvciAobGV0IGNlbGxJbmRleCA9IDA7IGNlbGxJbmRleCA8IHN1YlJvd0NlbGxzLmxlbmd0aDsgY2VsbEluZGV4KyspIHtcbiAgICAgICAgICAgICAgICBsZXQgY2VsbCA9IHN1YlJvd0NlbGxzW2NlbGxJbmRleF07XG4gICAgICAgICAgICAgICAgbGV0IG1lbWJlclRleHQgPSBjbGVhblRleHQoY2VsbC50ZXh0Q29udGVudCk7XG5cbiAgICAgICAgICAgICAgICBpZiAoY2VsbEluZGV4ID09IDApIHtcbiAgICAgICAgICAgICAgICAgIC8vIGNoZWNrIGZvciBhIGNsb3NlZCByZWNvcmRcbiAgICAgICAgICAgICAgICAgIGxldCBsY1RleHQgPSBtZW1iZXJUZXh0LnRvTG93ZXJDYXNlKCk7XG5cbiAgICAgICAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgICAgICAgbGNUZXh0ID09IFwidGhpcyByZWNvcmQgaXMgb2ZmaWNpYWxseSBjbG9zZWQuXCIgfHxcbiAgICAgICAgICAgICAgICAgICAgKGxjVGV4dC5pbmNsdWRlcyhcInJlY29yZFwiKSAmJiBsY1RleHQuaW5jbHVkZXMoXCJjbG9zZWRcIikpXG4gICAgICAgICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgICAgICAgbWVtYmVyLmlzQ2xvc2VkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgbWVtYmVyVGV4dCA9IFwiQ2xvc2VkIFJlY29yZFwiO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGxldCBoZWFkaW5nID0gcmVzdWx0LmhvdXNlaG9sZC5oZWFkaW5nc1tjZWxsSW5kZXhdO1xuICAgICAgICAgICAgICAgIG1lbWJlcltoZWFkaW5nXSA9IG1lbWJlclRleHQ7XG5cbiAgICAgICAgICAgICAgICBsZXQgbGlua05vZGUgPSBjZWxsLnF1ZXJ5U2VsZWN0b3IoXCJhXCIpO1xuICAgICAgICAgICAgICAgIGlmIChsaW5rTm9kZSkge1xuICAgICAgICAgICAgICAgICAgbGV0IGxpbmsgPSBsaW5rTm9kZS5nZXRBdHRyaWJ1dGUoXCJocmVmXCIpO1xuICAgICAgICAgICAgICAgICAgbGV0IGV4dHJhY3RSZXN1bHQgPSB7fTtcbiAgICAgICAgICAgICAgICAgIGV4dHJhY3REYkFuZFJlY29yZElkKGV4dHJhY3RSZXN1bHQsIGxpbmspO1xuICAgICAgICAgICAgICAgICAgbWVtYmVyLmRiSWQgPSBleHRyYWN0UmVzdWx0LmRiSWQ7XG4gICAgICAgICAgICAgICAgICBtZW1iZXIucmVjb3JkSWQgPSBleHRyYWN0UmVzdWx0LnJlY29yZElkO1xuICAgICAgICAgICAgICAgICAgbWVtYmVyLmxpbmsgPSBsaW5rOyAvLyB1c2VkIHRvIGZldGNoIGFkZGl0aW9uYWwgcmVjb3JkcyBpZiBuZWVkZWRcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmVzdWx0LmhvdXNlaG9sZC5tZW1iZXJzLnB1c2gobWVtYmVyKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cbn1cblxuZnVuY3Rpb24gZXh0cmFjdFJlY29yZFNvdXJjZUNpdGF0aW9uKGRvY3VtZW50LCByZXN1bHQpIHtcbiAgLy8gdGVzdCBpcyB0aGVyZSBhcmUgY29udGVudFZpZXdUYWJzLCB0aGlzIGFsbG93IHlvdSB0byBzZWxlY3QgYmV0d2VlbiBEZXRhaWwgYW5kIFNvdXJjZVxuICBsZXQgY29udGVudFZpZXdUYWJzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNjb250ZW50Vmlld1RhYnNcIik7XG5cbiAgaWYgKGNvbnRlbnRWaWV3VGFicykge1xuICAgIC8vIGV4YW1wbGUgZWxlY3RvcmFsIHJlZ2lzdGVyc1xuICAgIGxldCBzb3VyY2VDaXRhdGlvbkNoaWxkcmVuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNzb3VyY2VDaXRhdGlvblwiKS5jaGlsZHJlbjtcblxuICAgIGlmIChzb3VyY2VDaXRhdGlvbkNoaWxkcmVuLmxlbmd0aCA+IDApIHtcbiAgICAgIGxldCBsYXN0Q2l0YXRpb25UaXRsZSA9IFwiXCI7XG5cbiAgICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCBzb3VyY2VDaXRhdGlvbkNoaWxkcmVuLmxlbmd0aDsgaW5kZXgrKykge1xuICAgICAgICBsZXQgZGl2ID0gc291cmNlQ2l0YXRpb25DaGlsZHJlbltpbmRleF07XG5cbiAgICAgICAgbGV0IGNoaWxkQ2l0YXRpb25UaXRsZSA9IGRpdi5xdWVyeVNlbGVjdG9yKFwiaDQuY2l0YXRpb25UaXRsZVwiKTtcbiAgICAgICAgaWYgKGNoaWxkQ2l0YXRpb25UaXRsZSkge1xuICAgICAgICAgIGxldCBjaXRhdGlvblRpdGxlID0gY2hpbGRDaXRhdGlvblRpdGxlLnRleHRDb250ZW50O1xuICAgICAgICAgIGxldCBzb3VyY2VUZXh0Tm9kZSA9IGRpdi5xdWVyeVNlbGVjdG9yKFwiZGl2LnNvdXJjZVRleHRcIik7XG4gICAgICAgICAgaWYgKHNvdXJjZVRleHROb2RlKSB7XG4gICAgICAgICAgICBpZiAoY2l0YXRpb25UaXRsZSA9PSBcIlNvdXJjZSBDaXRhdGlvblwiKSB7XG4gICAgICAgICAgICAgIHNldFNvdXJjZUNpdGF0aW9uKHJlc3VsdCwgc291cmNlVGV4dE5vZGUpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChjaXRhdGlvblRpdGxlID09IFwiU291cmNlIEluZm9ybWF0aW9uXCIpIHtcbiAgICAgICAgICAgICAgc2V0U291cmNlSW5mb3JtYXRpb24ocmVzdWx0LCBzb3VyY2VUZXh0Tm9kZSk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGNpdGF0aW9uVGl0bGUgPT0gXCJEZXNjcmlwdGlvblwiKSB7XG4gICAgICAgICAgICAgIHNldFNvdXJjZURlc2NyaXB0aW9uKHJlc3VsdCwgc291cmNlVGV4dE5vZGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBpZiAoZGl2LmNsYXNzTGlzdC5jb250YWlucyhcImNpdGF0aW9uVGl0bGVcIikpIHtcbiAgICAgICAgICAgIGxhc3RDaXRhdGlvblRpdGxlID0gY2xlYW5UZXh0KGRpdi50ZXh0Q29udGVudCk7XG4gICAgICAgICAgICAvL2NvbnNvbGUubG9nKFwibGFzdENpdGF0aW9uVGl0bGUgPSBcIiArIGxhc3RDaXRhdGlvblRpdGxlKTtcbiAgICAgICAgICB9IGVsc2UgaWYgKGRpdi5jbGFzc0xpc3QuY29udGFpbnMoXCJzb3VyY2VUZXh0XCIpKSB7XG4gICAgICAgICAgICBpZiAobGFzdENpdGF0aW9uVGl0bGUgPT0gXCJTb3VyY2UgSW5mb3JtYXRpb25cIikge1xuICAgICAgICAgICAgICBzZXRTb3VyY2VJbmZvcm1hdGlvbihyZXN1bHQsIGRpdik7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGxhc3RDaXRhdGlvblRpdGxlID09IFwiRGVzY3JpcHRpb25cIikge1xuICAgICAgICAgICAgICBzZXRTb3VyY2VEZXNjcmlwdGlvbihyZXN1bHQsIGRpdik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIGxldCBzb3VyY2VBcmVhRGl2cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIjc291cmNlQ2l0YXRpb24gPiBkaXYuY29uQm9keSA+IGRpdlwiKTtcblxuICAgIGlmIChzb3VyY2VBcmVhRGl2cy5sZW5ndGggPiAwKSB7XG4gICAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgc291cmNlQXJlYURpdnMubGVuZ3RoOyBpbmRleCsrKSB7XG4gICAgICAgIGxldCBkaXYgPSBzb3VyY2VBcmVhRGl2c1tpbmRleF07XG4gICAgICAgIGxldCBjaXRhdGlvblRpdGxlTm9kZSA9IGRpdi5xdWVyeVNlbGVjdG9yKFwiaDQuY2l0YXRpb25UaXRsZVwiKTtcbiAgICAgICAgbGV0IHNvdXJjZVRleHROb2RlID0gZGl2LnF1ZXJ5U2VsZWN0b3IoXCJkaXYuc291cmNlVGV4dFwiKTtcbiAgICAgICAgaWYgKGNpdGF0aW9uVGl0bGVOb2RlICYmIHNvdXJjZVRleHROb2RlKSB7XG4gICAgICAgICAgbGV0IGNpdGF0aW9uVGl0bGUgPSBjaXRhdGlvblRpdGxlTm9kZS50ZXh0Q29udGVudDtcbiAgICAgICAgICBpZiAoY2l0YXRpb25UaXRsZSA9PSBcIlNvdXJjZSBDaXRhdGlvblwiKSB7XG4gICAgICAgICAgICBzZXRTb3VyY2VDaXRhdGlvbihyZXN1bHQsIHNvdXJjZVRleHROb2RlKTtcbiAgICAgICAgICB9IGVsc2UgaWYgKGNpdGF0aW9uVGl0bGUgPT0gXCJTb3VyY2UgSW5mb3JtYXRpb25cIikge1xuICAgICAgICAgICAgc2V0U291cmNlSW5mb3JtYXRpb24ocmVzdWx0LCBzb3VyY2VUZXh0Tm9kZSk7XG4gICAgICAgICAgfSBlbHNlIGlmIChjaXRhdGlvblRpdGxlID09IFwiRGVzY3JpcHRpb25cIikge1xuICAgICAgICAgICAgc2V0U291cmNlRGVzY3JpcHRpb24ocmVzdWx0LCBzb3VyY2VUZXh0Tm9kZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG59XG5cbmZ1bmN0aW9uIGV4dHJhY3RJbWFnZVRodW1iKGRvY3VtZW50LCByZXN1bHQpIHtcbiAgLy8gTm90ZSAoNCBTZXAgMjAyMSk6IEFuY2VzdHJ5IGNoYW5nZWQgdGhlIHdlYiBwYWdlIHRvIHB1dCBhbiBleHRyYSAyIGRpdiBiZXR3ZWVuXG4gIC8vIGltYWdlVGh1bWIgYW5kIHRoZSBcImFcIlxuICBsZXQgdGh1bWJOb2RlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiN0aHVtYm5haWxUb29scyA+IGRpdi5pbWFnZVRodW1iXCIpO1xuICAvL2NvbnNvbGUubG9nKFwiZXh0cmFjdEltYWdlVGh1bWIsIHRodW1iTm9kZSA9IFwiKTtcbiAgLy9jb25zb2xlLmxvZyh0aHVtYk5vZGUpO1xuXG4gIGlmICh0aHVtYk5vZGUpIHtcbiAgICBsZXQgbGlua05vZGUgPSB0aHVtYk5vZGUucXVlcnlTZWxlY3RvcihcImFcIik7XG4gICAgLy9jb25zb2xlLmxvZyhcImV4dHJhY3RJbWFnZVRodW1iLCBsaW5rTm9kZSA9IFwiKTtcbiAgICAvL2NvbnNvbGUubG9nKGxpbmtOb2RlKTtcblxuICAgIGlmIChsaW5rTm9kZSkge1xuICAgICAgbGV0IHVybCA9IGxpbmtOb2RlLmdldEF0dHJpYnV0ZShcImhyZWZcIik7XG5cbiAgICAgIC8vY29uc29sZS5sb2coXCJleHRyYWN0SW1hZ2VUaHVtYiwgdXJsID0gXCIgKyB1cmwpO1xuXG4gICAgICBpZiAodXJsKSB7XG4gICAgICAgIC8vIEV4YW1wbGU6XG4gICAgICAgIC8vIFwiaHR0cHM6Ly93d3cuYW5jZXN0cnkuY29tL2ltYWdldmlld2VyL2NvbGxlY3Rpb25zLzc4MTQvaW1hZ2VzL0xORFJHMTNfMTU3XzE1OC0wMDk1P3BpZD0yMjI5Nzg5JmFtcDtiYWNrdXJsPWh0dHBzOi8vc2VhcmNoLmFuY2VzdHJ5LmNvbS9jZ2ktYmluL3NzZS5kbGw/ZGJpZCUzRDc4MTQlMjZoJTNEMjIyOTc4OSUyNmluZGl2JTNEdHJ5JTI2b192YyUzRFJlY29yZDpPdGhlclJlY29yZCUyNnJoU291cmNlJTNEODc1MyZhbXA7dHJlZWlkPSZhbXA7cGVyc29uaWQ9JmFtcDtoaW50aWQ9JmFtcDt1c2VQVUI9dHJ1ZSZhbXA7dXNlUFVCSnM9dHJ1ZVwiXG5cbiAgICAgICAgbGV0IGRiSWQgPSB1cmwucmVwbGFjZSgvLippbWFnZXZpZXdlclxcL2NvbGxlY3Rpb25zXFwvKFteXFwvXSspXFwvaW1hZ2VzXFwvLiovLCBcIiQxXCIpO1xuICAgICAgICBsZXQgcmVjb3JkSWQgPSB1cmwucmVwbGFjZSgvLipcXC9pbWFnZXNcXC8oW14/XSspLiovLCBcIiQxXCIpO1xuXG4gICAgICAgIHJlc3VsdC5pbWFnZVVybCA9IHVybDtcbiAgICAgICAgcmVzdWx0LmltYWdlRGJJZCA9IGRiSWQ7XG4gICAgICAgIHJlc3VsdC5pbWFnZVJlY29yZElkID0gcmVjb3JkSWQ7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIFNvbWV0aW1lcyBpbiBzb21lIGJyb3dzZXJzIHRoZSBsaW5rTm9kZSBpcyBub3QgdGhlcmUuIFRoaXMgaGFwcGVucyBtb3JlIHdoZW4gdGhlciB1c2VyIGlzIG9uIHRoZVxuICAgICAgLy8gZmFjdEVkaXQgbW9kYWwsIGVzcGVjaWFsbHkgaW4gRmlyZWZveC4gSXQgc2VlbXMgdG8gYmUgYmVjYXVzZSB0aGUgbGluayBub2RlIGlzIGdlbmVyYXRlZCBieSBhIHNjcmlwdC5cbiAgICAgIC8vIFRoaXMgaXMgYSBiYWNrdXAgdGhhdCBnZXRzIHRoZSBpbWFnZSBpZCBmcm9tIHRoZSBcIlJlcG9ydCBhIHByb2JsZW1cIiBsaW5rLlxuICAgICAgbGV0IHJlcG9ydFByb2JsZW1Ob2RlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiN0aHVtYm5haWxUb29scyBhLmljb25XYXJuaW5nXCIpO1xuICAgICAgaWYgKHJlcG9ydFByb2JsZW1Ob2RlKSB7XG4gICAgICAgIC8vY29uc29sZS5sb2coXCJleHRyYWN0SW1hZ2VUaHVtYiwgcmVwb3J0UHJvYmxlbU5vZGUgPSBcIik7XG4gICAgICAgIC8vY29uc29sZS5sb2cocmVwb3J0UHJvYmxlbU5vZGUpO1xuXG4gICAgICAgIC8vIFJlcG9ydCBwcm9ibGVtIG5vZGUgbG9va3MgbGlrZTpcbiAgICAgICAgLy8gPGEgaHJlZj1cImh0dHBzOi8vd3d3LmFuY2VzdHJ5LmNvbS9mZWVkYmFjay9yZXBvcnRpc3N1ZT9ycD1SRCZhbXA7cGlkPTE5MDMwNDcmYW1wO2RiaWQ9MjM1MiZhbXA7aW1hZ2VJZD1yZzE0XzAwODAyXzAzOTVfMDMmYW1wO2luZGV4T25seT1mYWxzZSZhbXA7YmFja3VybD1odHRwJTNhJTJmJTJmc2VhcmNoLmFuY2VzdHJ5LmNvbSUyZmNnaS1iaW4lMmZzc2UuZGxsJTNmaW5kaXYlM2QxJTI2ZGJpZCUzZDIzNTIlMjZoJTNkMTkwMzA0NyUyNnNzcmMlM2RwdCUyNnRpZCUzZDg2ODA4NTc4JTI2cGlkJTNkNDY1NTIxOTk3MDglMjZ1c2VQVUIlM2R0cnVlJTI2X2dsJTNkMSp2aXZlYnoqX2dhKk1UQTVOVE13TmpVd09TNHhOVGczT0RRNE9EYzMqX2dhXzRRVDhGTUVYMzAqTVRZMU1UWXdNekUyTlM0ek1pNHhMakUyTlRFMk1EWXpOemt1TUEuLlwiIGNsYXNzPVwibGluayBpY29uIGljb25XYXJuaW5nXCI+PHNwYW4+UmVwb3J0IGEgcHJvYmxlbTwvc3Bhbj48L2E+XG5cbiAgICAgICAgbGV0IHVybCA9IHJlcG9ydFByb2JsZW1Ob2RlLmdldEF0dHJpYnV0ZShcImhyZWZcIik7XG5cbiAgICAgICAgLy9jb25zb2xlLmxvZyhcImV4dHJhY3RJbWFnZVRodW1iLCByZXBvcnRQcm9ibGVtTm9kZSBVUkwgPSBcIik7XG4gICAgICAgIC8vY29uc29sZS5sb2codXJsKTtcblxuICAgICAgICBpZiAodXJsKSB7XG4gICAgICAgICAgbGV0IGltYWdlUmVjb3JkSWQgPSBcIlwiO1xuICAgICAgICAgIGNvbnN0IGltYWdlUHJlZml4ID0gXCJpbWFnZUlkPVwiO1xuICAgICAgICAgIGxldCBpbWFnZUluZGV4ID0gdXJsLmluZGV4T2YoaW1hZ2VQcmVmaXgpO1xuICAgICAgICAgIGlmIChpbWFnZUluZGV4ICE9IC0xKSB7XG4gICAgICAgICAgICBsZXQgZW5kSW5kZXggPSB1cmwuaW5kZXhPZihcIiZcIiwgaW1hZ2VJbmRleCk7XG4gICAgICAgICAgICBpZiAoZW5kSW5kZXggIT0gLTEpIHtcbiAgICAgICAgICAgICAgaW1hZ2VSZWNvcmRJZCA9IHVybC5zdWJzdHJpbmcoaW1hZ2VJbmRleCArIGltYWdlUHJlZml4Lmxlbmd0aCwgZW5kSW5kZXgpO1xuICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKFwiZXh0cmFjdEltYWdlVGh1bWIsIGltYWdlUmVjb3JkSWQgPSBcIiArIGltYWdlUmVjb3JkSWQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cblxuICAgICAgICAgIGxldCBwZXJzb25JZCA9IFwiXCI7XG4gICAgICAgICAgY29uc3QgcGVyc29uUHJlZml4ID0gXCJwaWQ9XCI7XG4gICAgICAgICAgbGV0IHBlcnNvbkluZGV4ID0gdXJsLmluZGV4T2YocGVyc29uUHJlZml4KTtcbiAgICAgICAgICBpZiAocGVyc29uSW5kZXggIT0gLTEpIHtcbiAgICAgICAgICAgIGxldCBlbmRJbmRleCA9IHVybC5pbmRleE9mKFwiJlwiLCBwZXJzb25JbmRleCk7XG4gICAgICAgICAgICBpZiAoZW5kSW5kZXggIT0gLTEpIHtcbiAgICAgICAgICAgICAgcGVyc29uSWQgPSB1cmwuc3Vic3RyaW5nKHBlcnNvbkluZGV4ICsgcGVyc29uUHJlZml4Lmxlbmd0aCwgZW5kSW5kZXgpO1xuICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKFwiZXh0cmFjdEltYWdlVGh1bWIsIHBlcnNvbklkID0gXCIgKyBwZXJzb25JZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgaWYgKHJlc3VsdC5kb21haW4gJiYgcmVzdWx0LmRiSWQgJiYgaW1hZ2VSZWNvcmRJZCkge1xuICAgICAgICAgICAgcmVzdWx0LmltYWdlUmVjb3JkSWQgPSBpbWFnZVJlY29yZElkO1xuICAgICAgICAgICAgcmVzdWx0LmltYWdlRGJJZCA9IHJlc3VsdC5kYklkO1xuXG4gICAgICAgICAgICBpZiAoaW1hZ2VSZWNvcmRJZCAmJiBwZXJzb25JZCkge1xuICAgICAgICAgICAgICAvLyBodHRwczovL3d3dy5hbmNlc3RyeS5jb20vaW1hZ2V2aWV3ZXIvY29sbGVjdGlvbnMvNjE1OTYvaW1hZ2VzL3RuYV9yMzlfMDc3M18wNzczYV8wMjE/cGlkPTEwMTg5MjYyJnRyZWVpZD0xMTMzNjk1NzgmcGVyc29uaWQ9MjIyMzcyMjY5Nzk1JnVzZVBVQj10cnVlJnVzZVBVQkpzPXRydWVcbiAgICAgICAgICAgICAgcmVzdWx0LmltYWdlVXJsID1cbiAgICAgICAgICAgICAgICBcImh0dHBzOi8vd3d3LlwiICtcbiAgICAgICAgICAgICAgICByZXN1bHQuZG9tYWluICtcbiAgICAgICAgICAgICAgICBcIi9pbWFnZXZpZXdlci9jb2xsZWN0aW9ucy9cIiArXG4gICAgICAgICAgICAgICAgcmVzdWx0LmRiSWQgK1xuICAgICAgICAgICAgICAgIFwiL2ltYWdlcy9cIiArXG4gICAgICAgICAgICAgICAgaW1hZ2VSZWNvcmRJZCArXG4gICAgICAgICAgICAgICAgXCI/cGlkPVwiICtcbiAgICAgICAgICAgICAgICBwZXJzb25JZDtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoaW1hZ2VSZWNvcmRJZCkge1xuICAgICAgICAgICAgICByZXN1bHQuaW1hZ2VVcmwgPVxuICAgICAgICAgICAgICAgIFwiaHR0cHM6Ly93d3cuXCIgKyByZXN1bHQuZG9tYWluICsgXCIvaW1hZ2V2aWV3ZXIvY29sbGVjdGlvbnMvXCIgKyByZXN1bHQuZGJJZCArIFwiL2ltYWdlcy9cIiArIGltYWdlUmVjb3JkSWQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG59XG5cbmZ1bmN0aW9uIGV4dHJhY3RJbWFnZVBhZ2VUaXRsZShkb2N1bWVudCwgcmVzdWx0KSB7XG4gIGxldCB0aXRsZUNvbGxlY3Rpb24gPSBcIlwiO1xuICBsZXQgdGl0bGVOYW1lID0gXCJcIjtcblxuICBsZXQgdGl0bGVDb2xsZWN0aW9uTm9kZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCJkaXYuY29sbGVjdGlvblRpdGxlID4gaDEgPiBhXCIpO1xuICBpZiAodGl0bGVDb2xsZWN0aW9uTm9kZSkge1xuICAgIHRpdGxlQ29sbGVjdGlvbiA9IHRpdGxlQ29sbGVjdGlvbk5vZGUudGV4dENvbnRlbnQ7XG4gIH1cblxuICBsZXQgdGl0bGVGb3JOYW1lTm9kZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCJkaXYuY29sbGVjdGlvblRpdGxlID4gaDEgPiBzcGFuXCIpO1xuICBpZiAodGl0bGVGb3JOYW1lTm9kZSkge1xuICAgIGxldCB0aXRsZUZvck5hbWUgPSB0aXRsZUZvck5hbWVOb2RlLnRleHRDb250ZW50O1xuICAgIHRpdGxlRm9yTmFtZSA9IHRpdGxlRm9yTmFtZS5yZXBsYWNlKC9eXFxzKmZvclxccysvLCBcIlwiKTtcbiAgICB0aXRsZU5hbWUgPSB0aXRsZUZvck5hbWU7XG4gIH1cblxuICByZXN1bHQudGl0bGVDb2xsZWN0aW9uID0gdGl0bGVDb2xsZWN0aW9uO1xuICByZXN1bHQudGl0bGVOYW1lID0gdGl0bGVOYW1lO1xufVxuXG5mdW5jdGlvbiBleHRyYWN0SW1hZ2VCcm93c2VQYXRoKGRvY3VtZW50LCByZXN1bHQpIHtcbiAgdmFyIHdyYXBwZXJOb2RlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcImRpdi5icm93c2UtcGF0aC1oZWFkZXIgPiBkaXYuYnJlYWRjcnVtYldyYXBwZXJcIik7XG4gIGxldCBicm93c2VQYXRoID0gXCJcIjtcbiAgaWYgKHdyYXBwZXJOb2RlKSB7XG4gICAgbGV0IGNoaWxkcmVuID0gd3JhcHBlck5vZGUuY2hpbGRyZW47XG4gICAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IGNoaWxkcmVuLmxlbmd0aDsgaW5kZXgrKykge1xuICAgICAgbGV0IGNoaWxkID0gY2hpbGRyZW5baW5kZXhdO1xuICAgICAgaWYgKGNoaWxkLmNsYXNzTGlzdC5jb250YWlucyhcImJyZWFkY3J1bWJJdGVtXCIpKSB7XG4gICAgICAgIGJyb3dzZVBhdGggKz0gY2hpbGQudGV4dENvbnRlbnQ7XG4gICAgICB9IGVsc2UgaWYgKGNoaWxkLmNsYXNzTGlzdC5jb250YWlucyhcImljb25BcnJvd1JpZ2h0XCIpKSB7XG4gICAgICAgIGJyb3dzZVBhdGggKz0gXCIgPiBcIjtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBpZiAoYnJvd3NlUGF0aCkge1xuICAgIHJlc3VsdC5pbWFnZUJyb3dzZVBhdGggPSBicm93c2VQYXRoO1xuICB9XG59XG5cbmZ1bmN0aW9uIGV4dHJhY3RJbWFnZUhhc0luZGV4KGRvY3VtZW50LCByZXN1bHQpIHtcbiAgbGV0IGluZGV4QnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcbiAgICBcImRpdi5pbWFnZS12aWV3ZXItd3JhcHBlciA+IGRpdi5jb250YWluZXItc3BhY2UgPiBkaXYuYm90dG9tLWNvbnRhaW5lciA+IGRpdi5wYWdpbmctcGFuZWwucGFuZWxUb3BIZWlnaHQgPiBkaXYgPiBidXR0b24uaW5kZXhUb2dnbGVcIlxuICApO1xuXG4gIGlmIChpbmRleEJ1dHRvbikge1xuICAgIGlmIChpbmRleEJ1dHRvbi5jbGFzc0xpc3QuY29udGFpbnMoXCJkaXNhYmxlZFwiKSkge1xuICAgICAgcmVzdWx0LmltYWdlSGFzSW5kZXggPSBmYWxzZTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmVzdWx0LmltYWdlSGFzSW5kZXggPSB0cnVlO1xuICAgIH1cbiAgfVxufVxuXG5mdW5jdGlvbiBleHRyYWN0SW1hZ2VOdW1iZXJBbmRUb3RhbChkb2N1bWVudCwgcmVzdWx0KSB7XG4gIGxldCBwYWdlQ291bnRXcmFwID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcbiAgICBcImRpdi5pbWFnZS12aWV3ZXItd3JhcHBlciA+IGRpdi5jb250YWluZXItc3BhY2UgPiBkaXYuYm90dG9tLWNvbnRhaW5lciA+IGRpdi5wYWdpbmctcGFuZWwucGFuZWxUb3BIZWlnaHQgPiBkaXYgPiBkaXYuaW1hZ2VOdW0ucGFnZUNvdW50V3JhcElubmVyXCJcbiAgKTtcblxuICBpZiAocGFnZUNvdW50V3JhcCkge1xuICAgIGxldCBwYWdlTnVtID0gcGFnZUNvdW50V3JhcC5xdWVyeVNlbGVjdG9yKFwiaW5wdXQucGFnZS1pbnB1dFwiKTtcbiAgICBpZiAocGFnZU51bSkge1xuICAgICAgcmVzdWx0LmltYWdlTnVtYmVyID0gcGFnZU51bS52YWx1ZTtcbiAgICB9XG5cbiAgICBsZXQgaW1hZ2VDb3VudCA9IHBhZ2VDb3VudFdyYXAucXVlcnlTZWxlY3RvcihcInNwYW4uaW1hZ2VDb3VudFRleHRcIik7XG4gICAgaWYgKGltYWdlQ291bnQpIHtcbiAgICAgIHJlc3VsdC50b3RhbEltYWdlcyA9IGltYWdlQ291bnQudGV4dENvbnRlbnQ7XG4gICAgfVxuICB9XG59XG5cbmZ1bmN0aW9uIGV4dHJhY3RJbWFnZVRlbXBsYXRlKHJlc3VsdCwgdXJsKSB7XG4gIC8vIGh0dHBzOi8vd3d3LmFuY2VzdHJ5LmNvbS9pbWFnZXZpZXdlci9jb2xsZWN0aW9ucy83ODE0L2ltYWdlcy9MTkRSRzEzXzE1N18xNTgtMDA5NT90cmVlaWQ9JnBlcnNvbmlkPSZoaW50aWQ9JnVzZVBVQj10cnVlJnVzZVBVQkpzPXRydWUmX2dhPTIuOTEyNTI1NzMuNjM2NDg4NzMyLjE2MjE0NDQyNzItMTA5NTMwNjUwOS4xNTg3ODQ4ODc3JnBJZD0yMjI5Nzg5XG5cbiAgbGV0IGRiID0gdXJsLnJlcGxhY2UoLy4qXFwvaW1hZ2V2aWV3ZXJcXC9jb2xsZWN0aW9uc1xcLyhcXHcrKVxcLy4qLywgXCIkMVwiKTtcbiAgbGV0IHJlYyA9IHVybC5yZXBsYWNlKC8uKlxcL2ltYWdlc1xcLyhbXFx3XFxkXFwtXy5dKykuKi8sIFwiJDFcIik7XG4gIGxldCBwaWQgPSB1cmwucmVwbGFjZSgvLipbXFw/XFwmXXBJZFxcPShcXGQrKS4qLywgXCIkMVwiKTtcbiAgbGV0IGRvbWFpbiA9IHVybC5yZXBsYWNlKC8uKlxcLmFuY2VzdHJ5LihbXlxcL10rKVxcLy4qLywgXCIkMVwiKTtcblxuICBpZiAoZGIgIT0gXCJcIiAmJiBkYiAhPSB1cmwgJiYgcmVjICE9IFwiXCIgJiYgcmVjICE9IHVybCkge1xuICAgIHJlc3VsdC5kYklkID0gZGI7XG4gICAgcmVzdWx0LnJlY29yZElkID0gcmVjO1xuICAgIHJlc3VsdC5hbmNlc3RyeVRlbXBsYXRlID0gXCJ7e0FuY2VzdHJ5IEltYWdlfFwiICsgcmVzdWx0LmRiSWQgKyBcInxcIiArIHJlc3VsdC5yZWNvcmRJZCArIFwifX1cIjtcbiAgfVxuXG4gIGlmIChwaWQgIT0gXCJcIiAmJiBwaWQgIT0gdXJsKSB7XG4gICAgcmVzdWx0LnBpZCA9IHBpZDtcbiAgfVxuXG4gIGlmIChkb21haW4gIT0gXCJcIiAmJiBkb21haW4gIT0gdXJsKSB7XG4gICAgcmVzdWx0LmRvbWFpbiA9IGRvbWFpbjtcbiAgfVxufVxuXG5mdW5jdGlvbiBleHRyYWN0VHJlZVRlbXBsYXRlKHJlc3VsdCwgdXJsKSB7XG4gIC8vIGUuZy4gXCJodHRwczovL3d3dy5hbmNlc3RyeS5jb20vZmFtaWx5LXRyZWUvcGVyc29uL3RyZWUvODY4MDg1NzgvcGVyc29uLzI2MDEzMzUzNTAwNi9mYWN0c1wiXG4gIC8vIGJlY29tZXM6IHt7QW5jZXN0cnkgVHJlZXw4NjgwODU3OHwyNjAxMzM1MzUwMDZ9fVxuICBjb25zdCB0cmVlUHJlZml4ID0gXCIvZmFtaWx5LXRyZWUvcGVyc29uL3RyZWUvXCI7XG4gIGNvbnN0IHBlcnNvblByZWZpeCA9IFwiL3BlcnNvbi9cIjtcbiAgbGV0IHRyZWVQcmVmaXhJbmRleCA9IHVybC5pbmRleE9mKHRyZWVQcmVmaXgpO1xuICBpZiAodHJlZVByZWZpeEluZGV4ICE9IC0xKSB7XG4gICAgbGV0IHRyZWVJbmRleCA9IHRyZWVQcmVmaXhJbmRleCArIHRyZWVQcmVmaXgubGVuZ3RoO1xuICAgIGxldCBwZXJzb25QcmVmaXhJbmRleCA9IHVybC5pbmRleE9mKHBlcnNvblByZWZpeCwgdHJlZUluZGV4KTtcbiAgICBpZiAocGVyc29uUHJlZml4SW5kZXggIT0gLTEpIHtcbiAgICAgIGxldCB0cmVlID0gdXJsLnN1YnN0cmluZyh0cmVlSW5kZXgsIHBlcnNvblByZWZpeEluZGV4KTtcbiAgICAgIGxldCBwZXJzb25JbmRleCA9IHBlcnNvblByZWZpeEluZGV4ICsgcGVyc29uUHJlZml4Lmxlbmd0aDtcbiAgICAgIGxldCBwZXJzb25FbmRJbmRleCA9IHVybC5pbmRleE9mKFwiL1wiLCBwZXJzb25JbmRleCk7XG4gICAgICBpZiAocGVyc29uRW5kSW5kZXggIT0gLTEpIHtcbiAgICAgICAgbGV0IHBlcnNvbiA9IHVybC5zdWJzdHJpbmcocGVyc29uSW5kZXgsIHBlcnNvbkVuZEluZGV4KTtcbiAgICAgICAgcmVzdWx0LmFuY2VzdHJ5VGVtcGxhdGUgPSBcInt7QW5jZXN0cnkgVHJlZXxcIiArIHRyZWUgKyBcInxcIiArIHBlcnNvbiArIFwifX1cIjtcbiAgICAgIH1cbiAgICB9XG4gIH1cbn1cblxuZnVuY3Rpb24gZXh0cmFjdFRyZWVNZWRpYVRlbXBsYXRlKHJlc3VsdCwgdXJsKSB7XG4gIC8vIFRoZXJlIGFyZSB2YXJpb3VzIFVSTCBmb3JtczpcbiAgLy8gaHR0cHM6Ly93d3cuYW5jZXN0cnkuY29tL2ZhbWlseS10cmVlL3RyZWUvODY4MDg1NzgvbWVkaWEvZDY5YTdkNmEtYzc3My00OGIxLWFiMDktMTkxMDBjZDU1YzE0XG4gIC8vIGh0dHBzOi8vd3d3LmFuY2VzdHJ5LmNvbS9mYW1pbHktdHJlZS90cmVlLzg2ODA4NTc4L3BlcnNvbi80NjU1MjE5ODY4NC9tZWRpYS9kNjlhN2Q2YS1jNzczLTQ4YjEtYWIwOS0xOTEwMGNkNTVjMTRcbiAgLy8gaHR0cHM6Ly93d3cuYW5jZXN0cnkuY29tL21lZGlhdWktdmlld2VyL3RyZWUvODY4MDg1NzgvbWVkaWEvZDY5YTdkNmEtYzc3My00OGIxLWFiMDktMTkxMDBjZDU1YzE0XG4gIC8vIGh0dHBzOi8vd3d3LmFuY2VzdHJ5LmNvbS9tZWRpYXVpLXZpZXdlci90cmVlLzg2ODA4NTc4L3BlcnNvbi80NjU1MjE5ODY4NC9tZWRpYS9kNjlhN2Q2YS1jNzczLTQ4YjEtYWIwOS0xOTEwMGNkNTVjMTQ/dXNlUFVCSnM9dHJ1ZVxuXG4gIC8vIGJlY29tZXM6IHt7QW5jZXN0cnkgVHJlZSBNZWRpYXw4NjgwODU3OHxkNjlhN2Q2YS1jNzczLTQ4YjEtYWIwOS0xOTEwMGNkNTVjMTR9fVxuXG4gIGNvbnN0IHRyZWVQcmVmaXggPSBcIi90cmVlL1wiO1xuICBjb25zdCBtZWRpYVByZWZpeCA9IFwiL21lZGlhL1wiO1xuICBsZXQgdHJlZVByZWZpeEluZGV4ID0gdXJsLmluZGV4T2YodHJlZVByZWZpeCk7XG4gIGlmICh0cmVlUHJlZml4SW5kZXggIT0gLTEpIHtcbiAgICBsZXQgdHJlZUluZGV4ID0gdHJlZVByZWZpeEluZGV4ICsgdHJlZVByZWZpeC5sZW5ndGg7XG4gICAgbGV0IGVuZFRyZWVJbmRleCA9IHVybC5pbmRleE9mKFwiL1wiLCB0cmVlSW5kZXgpO1xuICAgIGlmIChlbmRUcmVlSW5kZXggIT0gLTEpIHtcbiAgICAgIGxldCB0cmVlID0gdXJsLnN1YnN0cmluZyh0cmVlSW5kZXgsIGVuZFRyZWVJbmRleCk7XG5cbiAgICAgIGxldCBtZWRpYVByZWZpeEluZGV4ID0gdXJsLmluZGV4T2YobWVkaWFQcmVmaXgsIGVuZFRyZWVJbmRleCk7XG4gICAgICBpZiAobWVkaWFQcmVmaXhJbmRleCAhPSAtMSkge1xuICAgICAgICBsZXQgbWVkaWFJbmRleCA9IG1lZGlhUHJlZml4SW5kZXggKyBtZWRpYVByZWZpeC5sZW5ndGg7XG4gICAgICAgIGxldCBtZWRpYUVuZEluZGV4ID0gdXJsLmluZGV4T2YoXCIvXCIsIG1lZGlhSW5kZXgpO1xuICAgICAgICBpZiAobWVkaWFFbmRJbmRleCA9PSAtMSkge1xuICAgICAgICAgIG1lZGlhRW5kSW5kZXggPSB1cmwuaW5kZXhPZihcIj9cIiwgbWVkaWFJbmRleCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG1lZGlhRW5kSW5kZXggPT0gLTEpIHtcbiAgICAgICAgICBtZWRpYUVuZEluZGV4ID0gdXJsLmxlbmd0aDtcbiAgICAgICAgfVxuICAgICAgICBpZiAobWVkaWFFbmRJbmRleCAhPSAtMSkge1xuICAgICAgICAgIGxldCBtZWRpYSA9IHVybC5zdWJzdHJpbmcobWVkaWFJbmRleCwgbWVkaWFFbmRJbmRleCk7XG4gICAgICAgICAgcmVzdWx0LmFuY2VzdHJ5VGVtcGxhdGUgPSBcInt7QW5jZXN0cnkgVHJlZSBNZWRpYXxcIiArIHRyZWUgKyBcInxcIiArIG1lZGlhICsgXCJ9fVwiO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG59XG5cbmZ1bmN0aW9uIGV4dHJhY3RTaGFyaW5nVXJsVGVtcGxhdGUoZG9jdW1lbnQsIHJlc3VsdCkge1xuICBsZXQgYmFuZGlkb01vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNtb2RhbCA+ICNtb2RhbEZpeGVkIC5iYW5kaWRvLW1vZGFsLXBvc3Qtc2hhcmUgLnNoYXJlLXVybFwiKTtcbiAgaWYgKGJhbmRpZG9Nb2RhbCkge1xuICAgIGxldCB1cmxOb2RlID0gYmFuZGlkb01vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIudXJsLWlucHV0XCIpO1xuXG4gICAgaWYgKHVybE5vZGUpIHtcbiAgICAgIGxldCB1cmwgPSB1cmxOb2RlLnZhbHVlO1xuICAgICAgLy8gaHR0cHM6Ly93d3cuYW5jZXN0cnkuY29tL3NoYXJpbmcvMjQyNzQ0NDA/aD05NWNmNWMmdXRtX2NhbXBhaWduPWJhbmRpZG8td2VicGFydHMmdXRtX3NvdXJjZT1wb3N0LXNoYXJlLW1vZGFsJnV0bV9tZWRpdW09Y29weS11cmxcbiAgICAgIGxldCBudW0xID0gdXJsLnJlcGxhY2UoLy4qXFwvc2hhcmluZ1xcLyhcXHcrKVxcP2hcXD1cXHcrXFwmLiovLCBcIiQxXCIpO1xuICAgICAgbGV0IG51bTIgPSB1cmwucmVwbGFjZSgvLipcXC9zaGFyaW5nXFwvXFx3K1xcP2hcXD0oXFx3KylcXCYuKi8sIFwiJDFcIik7XG5cbiAgICAgIHJlc3VsdC5hbmNlc3RyeVRlbXBsYXRlID0gXCJ7e0FuY2VzdHJ5IFNoYXJpbmd8XCIgKyBudW0xICsgXCJ8XCIgKyBudW0yICsgXCJ9fVwiO1xuXG4gICAgICByZXN1bHQuc2hhcmluZ1VybCA9IHVybC5yZXBsYWNlKC8oXi4qXFwvc2hhcmluZ1xcL1xcdytcXD9oXFw9XFx3KylcXCYuKi8sIFwiJDFcIik7XG4gICAgfVxuICB9XG59XG5cbmZ1bmN0aW9uIGV4dHJhY3RTaGFyaW5nSW1hZ2VGdWxsU2l6ZUxpbmsoZG9jdW1lbnQsIHJlc3VsdCkge1xuICAvL2NvbnNvbGUubG9nKFwiZXh0cmFjdFNoYXJpbmdJbWFnZUZ1bGxTaXplTGlua1wiKTtcblxuICBsZXQgYXR0YWNobWVudENvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCJkaXYubWFpbi1jb250YWluZXIgPiBkaXYuYXR0YWNobWVudC1jb250YWluZXJcIik7XG4gIGlmIChhdHRhY2htZW50Q29udGFpbmVyKSB7XG4gICAgbGV0IHpvb21JbWcgPSBhdHRhY2htZW50Q29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoXCIjem9vbU1vZGFsID4gI3pvb21Db250ZW50ID4gI3pvb21JbWdcIik7XG5cbiAgICBsZXQgaW1hZ2VVcmwgPSBcIlwiO1xuXG4gICAgaWYgKHpvb21JbWcpIHtcbiAgICAgIGltYWdlVXJsID0gem9vbUltZy5nZXRBdHRyaWJ1dGUoXCJzcmNcIik7XG4gICAgfSBlbHNlIHtcbiAgICAgIGxldCBpbWcgPSBhdHRhY2htZW50Q29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoXCJpbWcuYXR0YWNobWVudC1pbWFnZVwiKTtcbiAgICAgIGlmIChpbWcpIHtcbiAgICAgICAgaW1hZ2VVcmwgPSBpbWcuZ2V0QXR0cmlidXRlKFwic3JjXCIpO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vY29uc29sZS5sb2coXCJpbWFnZVVybCBpcyBcIiArIGltYWdlVXJsKTtcblxuICAgIGlmIChpbWFnZVVybCkge1xuICAgICAgbGV0IG1heFBhcmFtSW5kZXggPSBpbWFnZVVybC50b0xvd2VyQ2FzZSgpLmluZGV4T2YoXCImbWF4d2lkdGg9XCIpO1xuICAgICAgaWYgKG1heFBhcmFtSW5kZXggIT0gLTEpIHtcbiAgICAgICAgaW1hZ2VVcmwgPSBpbWFnZVVybC5zdWJzdHJpbmcoMCwgbWF4UGFyYW1JbmRleCk7XG4gICAgICB9XG4gICAgICByZXN1bHQuZnVsbFNpemVTaGFyaW5nSW1hZ2VVcmwgPSBpbWFnZVVybDtcbiAgICB9XG4gIH1cbn1cblxuZnVuY3Rpb24gZXh0cmFjdFNoYXJpbmdJbWFnZUZ1bGxTaXplTGlua1YyKGRvY3VtZW50LCByZXN1bHQpIHtcbiAgLy9jb25zb2xlLmxvZyhcImV4dHJhY3RTaGFyaW5nSW1hZ2VGdWxsU2l6ZUxpbmtWMlwiKTtcblxuICBsZXQgaW1hZ2VVcmwgPSBcIlwiO1xuXG4gIGxldCBpbWcgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2xhbmRpbmdQYWdlQ29udGVudCBkaXYucGhvdG8gPiBpbWdcIik7XG4gIGlmIChpbWcpIHtcbiAgICBpbWFnZVVybCA9IGltZy5nZXRBdHRyaWJ1dGUoXCJzcmNcIik7XG4gIH1cblxuICAvL2NvbnNvbGUubG9nKFwiaW1hZ2VVcmwgaXMgXCIgKyBpbWFnZVVybCk7XG5cbiAgaWYgKGltYWdlVXJsKSB7XG4gICAgbGV0IG1heFBhcmFtSW5kZXggPSBpbWFnZVVybC50b0xvd2VyQ2FzZSgpLmluZGV4T2YoXCImbWF4d2lkdGg9XCIpO1xuICAgIGlmIChtYXhQYXJhbUluZGV4ICE9IC0xKSB7XG4gICAgICBpbWFnZVVybCA9IGltYWdlVXJsLnN1YnN0cmluZygwLCBtYXhQYXJhbUluZGV4KTtcbiAgICB9XG4gICAgcmVzdWx0LmZ1bGxTaXplU2hhcmluZ0ltYWdlVXJsID0gaW1hZ2VVcmw7XG4gIH1cbn1cblxuZnVuY3Rpb24gZXh0cmFjdFNoYXJpbmdJbWFnZUZ1bGxTaXplTGlua0Rpc2NvdmVyaWVzKGRvY3VtZW50LCByZXN1bHQpIHtcbiAgLy9jb25zb2xlLmxvZyhcImV4dHJhY3RTaGFyaW5nSW1hZ2VGdWxsU2l6ZUxpbmtWMlwiKTtcblxuICBsZXQgaW1hZ2VVcmwgPSBcIlwiO1xuXG4gIGxldCBpbWcgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2ludGVyYWN0aXZlSW1hZ2VXaWRnZXRDb250YWluZXIgPiBkaXYgPiBpbWdcIik7XG4gIGlmIChpbWcpIHtcbiAgICBpbWFnZVVybCA9IGltZy5nZXRBdHRyaWJ1dGUoXCJzcmNcIik7XG5cbiAgICAvL2NvbnNvbGUubG9nKFwiaW1hZ2VVcmwgaXMgXCIgKyBpbWFnZVVybCk7XG5cbiAgICAvLyBFeGFtcGxlIGltYWdlVVJMOlxuICAgIC8vIGh0dHBzOi8vbWVkaWFzdmMuYW5jZXN0cnkuY29tL3YyL2ltYWdlL25hbWVzcGFjZXMvMjQ0Mi9tZWRpYS9tLXQwNjI3LTAyMzE0LTAwNDQxLmpwZz9zZWN1cml0eXRva2VuPXh3ZjBhZDRlZTI4OWY1ZWIwZWJjNDI5MGMxYzNhMDZmOGFlOGRhYzExMDk1OWJjZTAwJmRvd25sb2FkPVRydWUmY2xpZW50PWRpc2NvdmVyeXVpLWNvbnRlbnRzZXJ2aWNlXG5cbiAgICAvLyB3ZSB3YW50IHRvIHJlbW92ZSB0aGUgXCImZG93bmxvYWQ9VHJ1ZVwiIGFuZCBvbndhcmRzXG4gICAgaWYgKGltYWdlVXJsKSB7XG4gICAgICBsZXQgZG93bmxvYWRQYXJhbUluZGV4ID0gaW1hZ2VVcmwudG9Mb3dlckNhc2UoKS5pbmRleE9mKFwiJmRvd25sb2FkPVwiKTtcbiAgICAgIGlmIChkb3dubG9hZFBhcmFtSW5kZXggIT0gLTEpIHtcbiAgICAgICAgaW1hZ2VVcmwgPSBpbWFnZVVybC5zdWJzdHJpbmcoMCwgZG93bmxvYWRQYXJhbUluZGV4KTtcbiAgICAgIH1cbiAgICAgIHJlc3VsdC5mdWxsU2l6ZVNoYXJpbmdJbWFnZVVybCA9IGltYWdlVXJsO1xuXG4gICAgICBjb25zdCBhbHRTdHJpbmcgPSBpbWcuZ2V0QXR0cmlidXRlKFwiYWx0XCIpO1xuICAgICAgaWYgKGFsdFN0cmluZykge1xuICAgICAgICByZXN1bHQudGl0bGVDb2xsZWN0aW9uID0gYWx0U3RyaW5nO1xuICAgICAgfVxuICAgIH1cbiAgfSBlbHNlIHtcbiAgICAvLyBoZWFkID4gbWV0YTpudGgtY2hpbGQoMTgpXG4gICAgbGV0IG1ldGEgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiaGVhZCA+IG1ldGFbY29udGVudF49J2h0dHBzOi8vbWVkaWFzdmMuYW5jZXN0cnkuJ11cIik7XG5cbiAgICBpZiAobWV0YSkge1xuICAgICAgbGV0IGltYWdlVXJsID0gbWV0YS5nZXRBdHRyaWJ1dGUoXCJjb250ZW50XCIpO1xuXG4gICAgICBpZiAoaW1hZ2VVcmwpIHtcbiAgICAgICAgbGV0IG1heFBhcmFtSW5kZXggPSBpbWFnZVVybC50b0xvd2VyQ2FzZSgpLmluZGV4T2YoXCImbWF4d2lkdGg9XCIpO1xuICAgICAgICBpZiAobWF4UGFyYW1JbmRleCAhPSAtMSkge1xuICAgICAgICAgIGltYWdlVXJsID0gaW1hZ2VVcmwuc3Vic3RyaW5nKDAsIG1heFBhcmFtSW5kZXgpO1xuICAgICAgICB9XG4gICAgICAgIHJlc3VsdC5mdWxsU2l6ZVNoYXJpbmdJbWFnZVVybCA9IGltYWdlVXJsO1xuICAgICAgfVxuICAgIH1cbiAgfVxufVxuXG5mdW5jdGlvbiBleHRyYWN0U2hhcmluZ0ltYWdlT3JSZWNvcmREZXRhaWxzKGRvY3VtZW50LCByZXN1bHQpIHtcbiAgLy9jb25zb2xlLmxvZyhcImV4dHJhY3RTaGFyaW5nSW1hZ2VPclJlY29yZERldGFpbHNcIik7XG5cbiAgaWYgKHJlc3VsdC5mdWxsU2l6ZVNoYXJpbmdJbWFnZVVybCkge1xuICAgIC8vIGV4dHJhY3QgdGhlIGRiSWQgYW5kIGltYWdlSWQgZnJvbSBpbWFnZSBVUkxcbiAgICAvLyBodHRwczovL21lZGlhc3ZjLmFuY2VzdHJ5LmNvbS92Mi9pbWFnZS9uYW1lc3BhY2VzLzY1OTgvbWVkaWEvTE5EUkcxMl8xMzZfMTM3LTA3MTkuanBnP3NlY3VyaXR5VG9rZW49eHc5MTc2ODIxNzI4Y2FiYjc4NzY1NGNlNjUzNjhhNzYzYWU5MzEzZjdhOTlkYjAwMDAmTmFtZXNwYWNlSWQ9NjU5OCZDbGllbnQ9U2hhcmVcblxuICAgIGNvbnN0IGRiSWQgPSByZXN1bHQuZnVsbFNpemVTaGFyaW5nSW1hZ2VVcmwucmVwbGFjZShcbiAgICAgIC9odHRwcz9cXDpcXC9cXC9bXlxcL10rXFwvdjJcXC9pbWFnZVxcL25hbWVzcGFjZXNcXC8oW15cXC9dKylcXC9tZWRpYVxcLyhbXlxcP1xcLl0rKS4qLyxcbiAgICAgIFwiJDFcIlxuICAgICk7XG4gICAgY29uc3QgaW1hZ2VJZCA9IHJlc3VsdC5mdWxsU2l6ZVNoYXJpbmdJbWFnZVVybC5yZXBsYWNlKFxuICAgICAgL2h0dHBzP1xcOlxcL1xcL1teXFwvXStcXC92MlxcL2ltYWdlXFwvbmFtZXNwYWNlc1xcLyhbXlxcL10rKVxcL21lZGlhXFwvKFteXFw/XFwuXSspLiovLFxuICAgICAgXCIkMlwiXG4gICAgKTtcblxuICAgIGlmIChkYklkICYmIGRiSWQgIT0gcmVzdWx0LmZ1bGxTaXplU2hhcmluZ0ltYWdlVXJsKSB7XG4gICAgICByZXN1bHQuZGJJZCA9IGRiSWQ7XG4gICAgfVxuXG4gICAgaWYgKGltYWdlSWQgJiYgaW1hZ2VJZCAhPSByZXN1bHQuZnVsbFNpemVTaGFyaW5nSW1hZ2VVcmwpIHtcbiAgICAgIHJlc3VsdC5yZWNvcmRJZCA9IGltYWdlSWQ7XG4gICAgfVxuICB9XG5cbiAgY29uc3QgdGl0bGVFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcInRpdGxlXCIpO1xuICBpZiAodGl0bGVFbGVtZW50KSB7XG4gICAgbGV0IHRpdGxlID0gdGl0bGVFbGVtZW50LnRleHRDb250ZW50O1xuICAgIGNvbnN0IHByZWZpeCA9IFwiZGlzY292ZXJlZCBpbiBcIjtcbiAgICBjb25zdCBwcmVmaXhJbmRleCA9IHRpdGxlLmluZGV4T2YocHJlZml4KTtcbiAgICBpZiAocHJlZml4SW5kZXggIT0gLTEpIHtcbiAgICAgIGxldCByZW1haW5kZXIgPSB0aXRsZS5zdWJzdHJpbmcocHJlZml4SW5kZXggKyBwcmVmaXgubGVuZ3RoKTtcbiAgICAgIGNvbnN0IHN1ZmZpeCA9IFwiIGNvbGxlY3Rpb25cIjtcbiAgICAgIGlmIChyZW1haW5kZXIuZW5kc1dpdGgoc3VmZml4KSkge1xuICAgICAgICByZW1haW5kZXIgPSByZW1haW5kZXIuc3Vic3RyaW5nKDAsIHJlbWFpbmRlci5sZW5ndGggLSBzdWZmaXgubGVuZ3RoKTtcbiAgICAgIH1cblxuICAgICAgaWYgKHJlbWFpbmRlcikge1xuICAgICAgICByZXN1bHQudGl0bGVDb2xsZWN0aW9uID0gcmVtYWluZGVyO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGNvbnN0IHRpdGxlTmFtZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCJoMS5zdWJqZWN0LW5hbWVcIik7XG4gIGlmICh0aXRsZU5hbWUgJiYgdGl0bGVOYW1lLnRleHRDb250ZW50KSB7XG4gICAgcmVzdWx0LnRpdGxlTmFtZSA9IHRpdGxlTmFtZS50ZXh0Q29udGVudC50cmltKCk7XG4gIH1cblxuICBjb25zdCBwZXJzb25OYXJyYXRpdmUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwicC5jb250ZW50LWNhcHRpb25cIik7XG4gIGlmIChwZXJzb25OYXJyYXRpdmUgJiYgcGVyc29uTmFycmF0aXZlLnRleHRDb250ZW50KSB7XG4gICAgcmVzdWx0LnBlcnNvbk5hcnJhdGl2ZSA9IHBlcnNvbk5hcnJhdGl2ZS50ZXh0Q29udGVudC50cmltKCk7XG4gIH1cblxuICAvLyBodHRwczovL3d3dy5hbmNlc3RyeS5jb20vc2hhcmluZy8yNjAzMjg1OD9oPWRiMTBkZSZjbGlja3JlZj0xMDExbHdobUVZWWIlMkMxMDExbHdobUVZWWImYWRyZWY9Jm9feGlkPTAxMDExbDR4eDUmb19saWQ9MDEwMTFsNHh4NSZvX3NjaD1BZmZpbGlhdGUrRXh0ZXJuYWxcbiAgbGV0IG51bTEgPSByZXN1bHQudXJsLnJlcGxhY2UoLy4qXFwuYW5jZXN0cnlbXlxcL10rXFwvc2hhcmluZ1xcLyhbXlxcP10rKVxcPy4qLywgXCIkMVwiKTtcbiAgbGV0IG51bTIgPSByZXN1bHQudXJsLnJlcGxhY2UoLy4qXFwuYW5jZXN0cnlbXlxcL10rXFwvc2hhcmluZ1xcL1teXFw/XStcXD9oXFw9KFteXFw/XFwmXSspLiovLCBcIiQxXCIpO1xuXG4gIGlmIChudW0xICYmIG51bTIpIHtcbiAgICByZXN1bHQuYW5jZXN0cnlUZW1wbGF0ZSA9IFwie3tBbmNlc3RyeSBTaGFyaW5nfFwiICsgbnVtMSArIFwifFwiICsgbnVtMiArIFwifX1cIjtcbiAgfVxufVxuXG5mdW5jdGlvbiBleHRyYWN0U2hhcmluZ0ltYWdlT3JSZWNvcmREZXRhaWxzVjIoZG9jdW1lbnQsIHJlc3VsdCkge1xuICAvL2NvbnNvbGUubG9nKFwiZXh0cmFjdFNoYXJpbmdJbWFnZU9yUmVjb3JkRGV0YWlsc1YyXCIpO1xuXG4gIGNvbnN0IGNvbnRlbnREaXYgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2xhbmRpbmdQYWdlQ29udGVudFwiKTtcbiAgaWYgKGNvbnRlbnREaXYpIHtcbiAgICBjb25zdCBkYXRhT2JqZWN0SWQgPSBjb250ZW50RGl2LmdldEF0dHJpYnV0ZShcImRhdGEtb2JqZWN0LWlkXCIpO1xuICAgIGlmIChkYXRhT2JqZWN0SWQpIHtcbiAgICAgIC8vIGV4YW1wbGU6IFwiNzE2My0zODY1OTkxNlwiXG4gICAgICBjb25zdCBkYXNoSW5kZXggPSBkYXRhT2JqZWN0SWQuaW5kZXhPZihcIi1cIik7XG4gICAgICBpZiAoZGFzaEluZGV4ICE9IC0xKSB7XG4gICAgICAgIGNvbnN0IGRiSWQgPSBkYXRhT2JqZWN0SWQuc3Vic3RyaW5nKDAsIGRhc2hJbmRleCk7XG4gICAgICAgIGNvbnN0IHJlY29yZElkID0gZGF0YU9iamVjdElkLnN1YnN0cmluZyhkYXNoSW5kZXggKyAxKTtcbiAgICAgICAgaWYgKGRiSWQgJiYgcmVjb3JkSWQpIHtcbiAgICAgICAgICByZXN1bHQuZGJJZCA9IGRiSWQ7XG4gICAgICAgICAgcmVzdWx0LnJlY29yZElkID0gcmVjb3JkSWQ7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBjb25zdCB0aXRsZUVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwidGl0bGVcIik7XG4gIGlmICh0aXRsZUVsZW1lbnQpIHtcbiAgICBsZXQgdGl0bGUgPSB0aXRsZUVsZW1lbnQudGV4dENvbnRlbnQ7XG4gICAgY29uc3QgcHJlZml4ID0gXCJEaXNjb3ZlcmVkIGJ5IFwiO1xuICAgIGlmICh0aXRsZS5zdGFydHNXaXRoKHByZWZpeCkpIHtcbiAgICAgIGNvbnN0IGNvbGxlY3Rpb25JbmRleCA9IHRpdGxlLmluZGV4T2YoXCIgaW4gXCIsIHByZWZpeC5sZW5ndGgpO1xuICAgICAgbGV0IHJlbWFpbmRlciA9IHRpdGxlLnN1YnN0cmluZyhjb2xsZWN0aW9uSW5kZXggKyA0KTtcbiAgICAgIGNvbnN0IHN1ZmZpeCA9IFwiIGNvbGxlY3Rpb25cIjtcbiAgICAgIGlmIChyZW1haW5kZXIuZW5kc1dpdGgoc3VmZml4KSkge1xuICAgICAgICByZW1haW5kZXIgPSByZW1haW5kZXIuc3Vic3RyaW5nKDAsIHJlbWFpbmRlci5sZW5ndGggLSBzdWZmaXgubGVuZ3RoKTtcbiAgICAgIH1cblxuICAgICAgaWYgKHJlbWFpbmRlcikge1xuICAgICAgICByZXN1bHQudGl0bGVDb2xsZWN0aW9uID0gcmVtYWluZGVyO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGNvbnN0IHRpdGxlTmFtZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCJoMi5jb25UaXRsZVwiKTtcbiAgaWYgKHRpdGxlTmFtZSAmJiB0aXRsZU5hbWUudGV4dENvbnRlbnQpIHtcbiAgICByZXN1bHQudGl0bGVOYW1lID0gdGl0bGVOYW1lLnRleHRDb250ZW50LnRyaW0oKTtcbiAgfVxuXG4gIGNvbnN0IHBlcnNvbk5hcnJhdGl2ZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCJkaXYuY29uQm9keSA+IHBcIik7XG4gIGlmIChwZXJzb25OYXJyYXRpdmUgJiYgcGVyc29uTmFycmF0aXZlLnRleHRDb250ZW50KSB7XG4gICAgcmVzdWx0LnBlcnNvbk5hcnJhdGl2ZSA9IHBlcnNvbk5hcnJhdGl2ZS50ZXh0Q29udGVudC50cmltKCk7XG4gIH1cblxuICAvLyBodHRwczovL3d3dy5hbmNlc3RyeS5jb20vc2hhcmluZy8yMzYzOTI/dG9rZW49MzgzMjIyNmYyOTA4MDE0MDI0Y2FlM2E0YmJmNjQ0Y2MwMTk1MzliY2EyM2M4YjcxMzNmMGFmZmIxNTI5Mzg1Y1xuXG4gIGxldCBudW0xID0gcmVzdWx0LnVybC5yZXBsYWNlKC8uKlxcLmFuY2VzdHJ5W15cXC9dK1xcL3NoYXJpbmdcXC8oW15cXD9dKylcXD8uKi8sIFwiJDFcIik7XG4gIGxldCBudW0yID0gcmVzdWx0LnVybC5yZXBsYWNlKC8uKlxcLmFuY2VzdHJ5W15cXC9dK1xcL3NoYXJpbmdcXC9bXlxcP10rXFw/dG9rZW5cXD0oW15cXD9cXCZdKykuKi8sIFwiJDFcIik7XG5cbiAgaWYgKG51bTEgJiYgbnVtMikge1xuICAgIHJlc3VsdC5hbmNlc3RyeVRlbXBsYXRlID0gXCJ7e0FuY2VzdHJ5IFNoYXJpbmd8XCIgKyBudW0xICsgXCJ8XCIgKyBudW0yICsgXCJ9fVwiO1xuICB9XG59XG5cbmZ1bmN0aW9uIGV4dHJhY3RTaGFyaW5nSW1hZ2VPclJlY29yZERldGFpbHNEaXNjb3Zlcmllcyhkb2N1bWVudCwgcmVzdWx0KSB7XG4gIC8vY29uc29sZS5sb2coXCJleHRyYWN0U2hhcmluZ0ltYWdlT3JSZWNvcmREZXRhaWxzRGlzY292ZXJpZXNcIik7XG5cbiAgZnVuY3Rpb24gZ2V0UXVlcnlGaWVsZChyZWdleCkge1xuICAgIGxldCB2YWx1ZSA9IHJlc3VsdC51cmwucmVwbGFjZShyZWdleCwgXCIkMVwiKTtcblxuICAgIGlmICh2YWx1ZSAmJiB2YWx1ZSAhPSByZXN1bHQudXJsKSB7XG4gICAgICByZXR1cm4gdmFsdWU7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gc2V0RnJvbVF1ZXJ5RmllbGQocmVnZXgsIHJlc3VsdEZpZWxkKSB7XG4gICAgbGV0IHZhbHVlID0gZ2V0UXVlcnlGaWVsZChyZWdleCk7XG5cbiAgICBpZiAodmFsdWUpIHtcbiAgICAgIHJlc3VsdFtyZXN1bHRGaWVsZF0gPSB2YWx1ZTtcbiAgICB9XG4gIH1cblxuICAvLyB1cmwgY29udGFpbnMgZGJpZCBhbmQgcmVjb3JkaWQ6XG4gIC8vIGh0dHBzOi8vd3d3LmFuY2VzdHJ5LmNvbS9jZW5zdXMtc2VhcmNoL2Rpc2NvdmVyaWVzXG4gIC8vID9tYXRjaGRiaWQ9MjQ0MiZtYXRjaHJlY29yZGlkPTEzMDg5MTMzNFxuICAvLyAmbWF0Y2hyZWxhdGl2ZT1yZWxhdGl2ZSZzaGFyZT0xJm1hdGNoZ2lkPVpLYUp6ckozcHF1eHZvWWF2RU81SGthMW5BMVFwQWY1V2JcbiAgLy8gJm1hdGNoZmlyc3RuYW1lPUxlc2xpZSUyMFImbWF0Y2hsYXN0bmFtZT1Db3gmbWF0Y2hiaXJ0aGRhdGU9MTkzMSZtYXRjaGdlbmRlcj1tYWxlXG4gIHNldEZyb21RdWVyeUZpZWxkKC9eLipbJj9dbWF0Y2hkYmlkXFw9KFteJl0rKS4qLywgXCJkYklkXCIpO1xuICBzZXRGcm9tUXVlcnlGaWVsZCgvXi4qWyY/XW1hdGNocmVjb3JkaWRcXD0oW14mXSspLiovLCBcInJlY29yZElkXCIpO1xuXG4gIGxldCBmdWxsTmFtZSA9IFwiXCI7XG4gIGNvbnN0IGZpcnN0TmFtZXMgPSBnZXRRdWVyeUZpZWxkKC9eLipbJj9dbWF0Y2hmaXJzdG5hbWVcXD0oW14mXSspLiovKTtcbiAgY29uc3QgbGFzdE5hbWVzID0gZ2V0UXVlcnlGaWVsZCgvXi4qWyY/XW1hdGNobGFzdG5hbWVcXD0oW14mXSspLiovKTtcbiAgaWYgKGZpcnN0TmFtZXMpIHtcbiAgICBmdWxsTmFtZSA9IGRlY29kZVVSSUNvbXBvbmVudChmaXJzdE5hbWVzKTtcbiAgfVxuICBpZiAobGFzdE5hbWVzKSB7XG4gICAgaWYgKGZ1bGxOYW1lKSB7XG4gICAgICBmdWxsTmFtZSArPSBcIiBcIjtcbiAgICB9XG4gICAgZnVsbE5hbWUgKz0gZGVjb2RlVVJJQ29tcG9uZW50KGxhc3ROYW1lcyk7XG4gIH1cbiAgaWYgKGZ1bGxOYW1lKSB7XG4gICAgcmVzdWx0LnRpdGxlTmFtZSA9IGZ1bGxOYW1lO1xuICB9XG5cbiAgLy8gZGl2LmFwcC1jYXJkLWNvbnRlbnQgPiBwLnRleHQyeGxyZy50ZXh0YWx0LnRvcFNwYWNpbmdcblxuICBjb25zdCBwZXJzb25OYXJyYXRpdmUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiZGl2LmFwcC1jYXJkLWNvbnRlbnQgPiBwLnRleHQyeGxyZy50ZXh0YWx0LnRvcFNwYWNpbmdcIik7XG4gIGlmIChwZXJzb25OYXJyYXRpdmUgJiYgcGVyc29uTmFycmF0aXZlLnRleHRDb250ZW50KSB7XG4gICAgcmVzdWx0LnBlcnNvbk5hcnJhdGl2ZSA9IHBlcnNvbk5hcnJhdGl2ZS50ZXh0Q29udGVudC50cmltKCk7XG4gIH1cbn1cblxuZnVuY3Rpb24gZGV0ZWN0UGFnZVR5cGUoZG9jdW1lbnQsIHJlc3VsdCwgdXJsKSB7XG4gIGlmICh1cmwuaW5jbHVkZXMoXCIvaW1hZ2V2aWV3ZXIvY29sbGVjdGlvbnMvXCIpKSB7XG4gICAgbGV0IGJhbmRpZG9Nb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjbW9kYWwgPiAjbW9kYWxGaXhlZCAuYmFuZGlkby1tb2RhbC1wb3N0LXNoYXJlIC5zaGFyZS11cmxcIik7XG4gICAgaWYgKGJhbmRpZG9Nb2RhbCkge1xuICAgICAgcmVzdWx0LnBhZ2VUeXBlID0gXCJzaGFyaW5nVXJsXCI7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJlc3VsdC5wYWdlVHlwZSA9IFwiaW1hZ2VcIjtcbiAgICB9XG4gIH0gZWxzZSBpZiAodXJsLmluY2x1ZGVzKFwiL3BlcnNvbi9cIikgJiYgdXJsLmluY2x1ZGVzKFwiL2ZhY3RzXCIpKSB7XG4gICAgcmVzdWx0LnBhZ2VUeXBlID0gXCJwZXJzb25GYWN0c1wiO1xuXG4gICAgbGV0IGNpdGF0aW9uUmVjb3JkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5tb2RhbENvbnRlbnRzICNGYWN0RWRpdENvbXBvbmVudCBzZWN0aW9uLmNpdGF0aW9uUmVjb3JkXCIpO1xuICAgIGlmIChjaXRhdGlvblJlY29yZCkge1xuICAgICAgcmVzdWx0LnBhZ2VUeXBlID0gXCJwZXJzb25Tb3VyY2VDaXRhdGlvblwiO1xuICAgIH1cbiAgfSBlbHNlIGlmICh1cmwuaW5jbHVkZXMoXCIvZGlzY292ZXJpZXNcIikgfHwgdXJsLmluY2x1ZGVzKFwibWF0Y2hkYmlkPVwiKSkge1xuICAgIHJlc3VsdC5wYWdlVHlwZSA9IFwic2hhcmluZ0ltYWdlT3JSZWNvcmRcIjtcbiAgICByZXN1bHQuc2hhcmluZ1R5cGUgPSBcImRpc2NvdmVyaWVzXCI7XG4gIH0gZWxzZSBpZiAodXJsLmluY2x1ZGVzKFwiZGJpZD1cIikgfHwgdXJsLmluY2x1ZGVzKFwiZGI9XCIpIHx8IHVybC5pbmNsdWRlcyhcImRpc2NvdmVyeXVpLWNvbnRlbnRcIikpIHtcbiAgICByZXN1bHQucGFnZVR5cGUgPSBcInJlY29yZFwiO1xuICB9IGVsc2UgaWYgKHVybC5pbmNsdWRlcyhcIi9jb2xsZWN0aW9ucy9cIikgJiYgdXJsLmluY2x1ZGVzKFwiL3JlY29yZHMvXCIpKSB7XG4gICAgcmVzdWx0LnBhZ2VUeXBlID0gXCJyZWNvcmRcIjtcbiAgfSBlbHNlIGlmICh1cmwuaW5jbHVkZXMoXCIvc2hhcmluZy9cIikgJiYgdXJsLmluY2x1ZGVzKFwiP2g9XCIpKSB7XG4gICAgcmVzdWx0LnBhZ2VUeXBlID0gXCJzaGFyaW5nSW1hZ2VPclJlY29yZFwiO1xuICAgIHJlc3VsdC5zaGFyaW5nVHlwZSA9IFwidjFcIjtcbiAgfSBlbHNlIGlmICh1cmwuaW5jbHVkZXMoXCIvc2hhcmluZy9cIikgJiYgdXJsLmluY2x1ZGVzKFwiP3Rva2VuPVwiKSkge1xuICAgIHJlc3VsdC5wYWdlVHlwZSA9IFwic2hhcmluZ0ltYWdlT3JSZWNvcmRcIjtcbiAgICByZXN1bHQuc2hhcmluZ1R5cGUgPSBcInYyXCI7XG4gIH0gZWxzZSBpZiAodXJsLmluY2x1ZGVzKFwiL21lZGlhL1wiKSAmJiB1cmwuaW5jbHVkZXMoXCIvdHJlZS9cIikpIHtcbiAgICByZXN1bHQucGFnZVR5cGUgPSBcInRyZWVNZWRpYVwiO1xuICB9IGVsc2Uge1xuICAgIHJlc3VsdC5wYWdlVHlwZSA9IFwidW5rbm93blwiO1xuICB9XG5cbiAgLy9jb25zb2xlLmxvZyhcImRldGVjdFBhZ2VUeXBlLCByZXN1bHQucGFnZVR5cGUgPSBcIiArIHJlc3VsdC5wYWdlVHlwZSk7XG59XG5cbmZ1bmN0aW9uIGhhbmRsZVBlcnNvblNvdXJjZUNpdGF0aW9uKGRvY3VtZW50LCByZXN1bHQpIHtcbiAgLy8gVGhpcyBzYXZlcyB0aGUgZXh0cmEgY2xpY2sgb2YgaGF2aW5nIHRvIGNsaWNrIG9uIFwiVmlldyByZWNvcmRcIlxuXG4gIGxldCBtb2RhbENvbnRlbnRzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5tb2RhbENvbnRlbnRzXCIpO1xuICBpZiAobW9kYWxDb250ZW50cykge1xuICAgIGxldCBmYWN0RWRpdCA9IG1vZGFsQ29udGVudHMucXVlcnlTZWxlY3RvcihcIiNGYWN0RWRpdENvbXBvbmVudFwiKTtcbiAgICBpZiAoZmFjdEVkaXQpIHtcbiAgICAgIGxldCBsaW5rID0gbW9kYWxDb250ZW50cy5xdWVyeVNlbGVjdG9yKFwiI3ZpZXdSZWNvcmRMaW5rXCIpO1xuICAgICAgaWYgKGxpbmspIHtcbiAgICAgICAgbGV0IHJlY29yZFVybCA9IGxpbmsuZ2V0QXR0cmlidXRlKFwiaHJlZlwiKTtcblxuICAgICAgICAvLyBmb3IgdGhlIG5vcm1hbCBjYXNlIHRoaXMgaXMgYWxsIHdlIG5lZWQgc2luY2Ugd2Ugd2lsbCBleHRyYWN0IHRoZSByZXN0IG9mIHRoZSBkYXRhXG4gICAgICAgIC8vIHdpdGggYSBmZXRjaCB1c2luZyB0aGlzLiBUaGlzIGdldHMgdXMgYmV0dGVyIGRhdGEgKG1haW5seSB0aGUgbGluayBkYXRhKVxuICAgICAgICByZXN1bHQucmVjb3JkVXJsID0gcmVjb3JkVXJsO1xuXG4gICAgICAgIC8vIEhvd2V2ZXIsIGlmIHNvbWVvbmVzIHN1YnNjcmlwdGlvbiBkb2Vzbid0IGFsbG93IGFjZXNzIHRvIHRoaXMgcmVjb3JkIHdlIG1heSBhcyB3ZWxsXG4gICAgICAgIC8vIGV4dHJhY3Qgd2hhdCB3ZSBjYW4uXG4gICAgICAgIGV4dHJhY3REYkFuZFJlY29yZElkKHJlc3VsdCwgcmVjb3JkVXJsKTtcbiAgICAgIH1cblxuICAgICAgbGV0IGltYWdlTGluayA9IG1vZGFsQ29udGVudHMucXVlcnlTZWxlY3RvcihcIiN2aWV3UmVjb3JkSW1hZ2VMaW5rXCIpO1xuICAgICAgaWYgKGltYWdlTGluaykge1xuICAgICAgICBsZXQgdXJsID0gaW1hZ2VMaW5rLmdldEF0dHJpYnV0ZShcImhyZWZcIik7XG5cbiAgICAgICAgLy9jb25zb2xlLmxvZyhcImhhbmRsZVBlcnNvblNvdXJjZUNpdGF0aW9uLCB1cmwgPSBcIiArIHVybCk7XG5cbiAgICAgICAgaWYgKHVybCkge1xuICAgICAgICAgIC8vIEV4YW1wbGU6XG5cbiAgICAgICAgICAvLyBcImh0dHBzOi8vd3d3LmFuY2VzdHJ5LmNvbS9pbnRlcmFjdGl2ZS8yMzUyL3JnMTRfMTQ4MTdfMDA1OV8wMy81NTU2NTgyNFxuICAgICAgICAgIC8vICAgID9iYWNrdXJsPWh0dHBzOi8vd3d3LmFuY2VzdHJ5LmNvbS9mYW1pbHktdHJlZS9wZXJzb24vdHJlZS84NjgwODU3OC9wZXJzb24vNDY1NDg0Mzk1NjIvZmFjdHMvY2l0YXRpb24vMzIzNjM1NjAyMDY5L2VkaXQvcmVjb3JkXCJcbiAgICAgICAgICAvLyBjbGlja2luZyBvbiB0aGlzIGdvZXMgdG86XG4gICAgICAgICAgLy8gaHR0cHM6Ly93d3cuYW5jZXN0cnkuY29tL2ltYWdldmlld2VyL2NvbGxlY3Rpb25zLzIzNTIvaW1hZ2VzL3JnMTRfMTQ4MTdfMDA1OV8wMz9wSWQ9NTU1NjU4MjRcblxuICAgICAgICAgIGxldCBkYklkID0gXCJcIjtcbiAgICAgICAgICBsZXQgcmVjb3JkSWQgPSBcIlwiO1xuXG4gICAgICAgICAgaWYgKHVybC5pbmNsdWRlcyhcIi9pbWFnZXZpZXdlci9cIikpIHtcbiAgICAgICAgICAgIGRiSWQgPSB1cmwucmVwbGFjZSgvLippbWFnZXZpZXdlclxcL2NvbGxlY3Rpb25zXFwvKFteXFwvXSspXFwvaW1hZ2VzXFwvLiovLCBcIiQxXCIpO1xuICAgICAgICAgICAgcmVjb3JkSWQgPSB1cmwucmVwbGFjZSgvLipcXC9pbWFnZXNcXC8oW14/XSspLiovLCBcIiQxXCIpO1xuICAgICAgICAgIH0gZWxzZSBpZiAodXJsLmluY2x1ZGVzKFwiL2ludGVyYWN0aXZlL1wiKSkge1xuICAgICAgICAgICAgZGJJZCA9IHVybC5yZXBsYWNlKC8uKmludGVyYWN0aXZlXFwvKFteXFwvXSspXFwvW15cXC9dK1xcLy4qLywgXCIkMVwiKTtcbiAgICAgICAgICAgIHJlY29yZElkID0gdXJsLnJlcGxhY2UoLy4qaW50ZXJhY3RpdmVcXC9bXlxcL10rXFwvKFteXFwvXSspXFwvLiovLCBcIiQxXCIpO1xuICAgICAgICAgICAgbGV0IGJhc2UgPSB1cmwucmVwbGFjZSgvKC4qKVxcL2ludGVyYWN0aXZlXFwvW15cXC9dK1xcL1teXFwvXStcXC8uKi8sIFwiJDFcIik7XG4gICAgICAgICAgICB1cmwgPSBiYXNlICsgXCIvaW1hZ2V2aWV3ZXIvY29sbGVjdGlvbnMvXCIgKyBkYklkICsgXCIvaW1hZ2VzL1wiICsgcmVjb3JkSWQ7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgcmVzdWx0LmltYWdlVXJsID0gdXJsO1xuICAgICAgICAgIHJlc3VsdC5pbWFnZURiSWQgPSBkYklkO1xuICAgICAgICAgIHJlc3VsdC5pbWFnZVJlY29yZElkID0gcmVjb3JkSWQ7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgbGV0IGNpdGF0aW9uUmVjb3JkID0gZmFjdEVkaXQucXVlcnlTZWxlY3RvcihcInNlY3Rpb24uY2l0YXRpb25SZWNvcmRcIik7XG4gICAgICBpZiAoY2l0YXRpb25SZWNvcmQpIHtcbiAgICAgICAgcmVzdWx0LnJlY29yZERhdGEgPSB7fTtcblxuICAgICAgICBsZXQgdGl0bGVOb2RlID0gY2l0YXRpb25SZWNvcmQucXVlcnlTZWxlY3RvcihcImgzLmNvblRpdGxlXCIpO1xuICAgICAgICBpZiAodGl0bGVOb2RlKSB7XG4gICAgICAgICAgcmVzdWx0LnRpdGxlQ29sbGVjdGlvbiA9IHRpdGxlTm9kZS50ZXh0Q29udGVudDtcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCBkaXNwbGF5RmllbGRzID0gY2l0YXRpb25SZWNvcmQucXVlcnlTZWxlY3RvckFsbChcInRyW2lkXj0nZGlzcGxheUZpZWxkcyddXCIpO1xuICAgICAgICBmb3IgKGxldCBkaXNwbGF5RmllbGQgb2YgZGlzcGxheUZpZWxkcykge1xuICAgICAgICAgIGxldCBoZWFkZXIgPSBkaXNwbGF5RmllbGQucXVlcnlTZWxlY3RvcihcInRoXCIpO1xuICAgICAgICAgIGxldCBkYXRhID0gZGlzcGxheUZpZWxkLnF1ZXJ5U2VsZWN0b3IoXCJ0ZFwiKTtcbiAgICAgICAgICBpZiAoaGVhZGVyICYmIGRhdGEpIHtcbiAgICAgICAgICAgIGxldCBrZXkgPSBoZWFkZXIudGV4dENvbnRlbnQ7XG4gICAgICAgICAgICBsZXQgdmFsdWUgPSBkYXRhLnRleHRDb250ZW50O1xuICAgICAgICAgICAgaWYgKGtleSAmJiB2YWx1ZSkge1xuICAgICAgICAgICAgICAvLyBNYXJpdGFsIFN0YXR1cyBjYW4gYmUgXCJNYXJpdGFsIFN0YXR1c1wiIGlmIG5vIHN1YnNjcmlwdGlvbiBldGNcbiAgICAgICAgICAgICAgLy8gVGhhdCB3b3VsZCBiZSBpbnRlcnByZXRlZCBhcyBcIk1hcnJpZWRcIiBpZiB3ZSBzZXQgaXRcbiAgICAgICAgICAgICAgaWYgKGtleSAhPSB2YWx1ZSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHBsYWNlaG9sZGVyVmFsdWVzID0gW1wiY2l0eVwiLCBcImxvY2F0aW9uXCIsIFwiZ2VuZGVyXCJdO1xuICAgICAgICAgICAgICAgIGlmICghcGxhY2Vob2xkZXJWYWx1ZXMuaW5jbHVkZXModmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgICByZXN1bHQucmVjb3JkRGF0YVtrZXldID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgbGV0IGhvdXNlaG9sZE1lbWJlcnMgPSBjaXRhdGlvblJlY29yZC5xdWVyeVNlbGVjdG9yQWxsKFwidHJbaWRePSdob3VzZWhvbGRNZW1iZXJzJ11cIik7XG4gICAgICAgIGlmIChob3VzZWhvbGRNZW1iZXJzICYmIGhvdXNlaG9sZE1lbWJlcnMubGVuZ3RoID4gMCkge1xuICAgICAgICAgIHJlc3VsdC5ob3VzZWhvbGQgPSB7fTtcbiAgICAgICAgICBsZXQgdGJvZHkgPSBob3VzZWhvbGRNZW1iZXJzWzBdLnBhcmVudEVsZW1lbnQ7XG4gICAgICAgICAgaWYgKHRib2R5KSB7XG4gICAgICAgICAgICBsZXQgdGhlYWQgPSB0Ym9keS5wcmV2aW91c0VsZW1lbnRTaWJsaW5nO1xuICAgICAgICAgICAgaWYgKHRoZWFkKSB7XG4gICAgICAgICAgICAgIGxldCBoZWFkaW5nUm93ID0gdGhlYWQucXVlcnlTZWxlY3RvcihcInRyXCIpO1xuICAgICAgICAgICAgICBpZiAoaGVhZGluZ1Jvdykge1xuICAgICAgICAgICAgICAgIHJlc3VsdC5ob3VzZWhvbGQuaGVhZGluZ3MgPSBbXTtcbiAgICAgICAgICAgICAgICByZXN1bHQuaG91c2Vob2xkLm1lbWJlcnMgPSBbXTtcbiAgICAgICAgICAgICAgICBsZXQgaGVhZGluZ3MgPSBoZWFkaW5nUm93LnF1ZXJ5U2VsZWN0b3JBbGwoXCJ0aFwiKTtcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBoZWFkaW5nIG9mIGhlYWRpbmdzKSB7XG4gICAgICAgICAgICAgICAgICByZXN1bHQuaG91c2Vob2xkLmhlYWRpbmdzLnB1c2goY2xlYW5UZXh0KGhlYWRpbmcudGV4dENvbnRlbnQpKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBsZXQgcm93cyA9IHRib2R5LnF1ZXJ5U2VsZWN0b3JBbGwoXCJ0clwiKTtcbiAgICAgICAgICAgICAgICBmb3IgKGxldCByb3cgb2Ygcm93cykge1xuICAgICAgICAgICAgICAgICAgbGV0IG1lbWJlciA9IHt9O1xuICAgICAgICAgICAgICAgICAgbGV0IHN1YlJvd0NlbGxzID0gcm93LnF1ZXJ5U2VsZWN0b3JBbGwoXCJ0aCwgdGRcIik7XG4gICAgICAgICAgICAgICAgICBpZiAoc3ViUm93Q2VsbHMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBjZWxsSW5kZXggPSAwOyBjZWxsSW5kZXggPCBzdWJSb3dDZWxscy5sZW5ndGg7IGNlbGxJbmRleCsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgbGV0IGNlbGwgPSBzdWJSb3dDZWxsc1tjZWxsSW5kZXhdO1xuICAgICAgICAgICAgICAgICAgICAgIGxldCBtZW1iZXJUZXh0ID0gY2xlYW5UZXh0KGNlbGwudGV4dENvbnRlbnQpO1xuICAgICAgICAgICAgICAgICAgICAgIG1lbWJlcltyZXN1bHQuaG91c2Vob2xkLmhlYWRpbmdzW2NlbGxJbmRleF1dID0gbWVtYmVyVGV4dDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgcmVzdWx0LmhvdXNlaG9sZC5tZW1iZXJzLnB1c2gobWVtYmVyKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgbGV0IGNpdGF0aW9uSW5mbyA9IGZhY3RFZGl0LnF1ZXJ5U2VsZWN0b3IoXCJzZWN0aW9uLmNpdGF0aW9uSW5mb3JtYXRpb25cIik7XG4gICAgICBpZiAoY2l0YXRpb25JbmZvKSB7XG4gICAgICAgIGxldCBib2R5ID0gY2l0YXRpb25JbmZvLnF1ZXJ5U2VsZWN0b3IoXCJkaXYuY29uQm9keVwiKTtcbiAgICAgICAgaWYgKGJvZHkpIHtcbiAgICAgICAgICBsZXQgZHROb2RlcyA9IGJvZHkucXVlcnlTZWxlY3RvckFsbChcImR0XCIpO1xuICAgICAgICAgIGxldCBkZE5vZGVzID0gYm9keS5xdWVyeVNlbGVjdG9yQWxsKFwiZGRcIik7XG4gICAgICAgICAgaWYgKGR0Tm9kZXMubGVuZ3RoID09IDEgJiYgZGROb2Rlcy5sZW5ndGggPT0gMSkge1xuICAgICAgICAgICAgbGV0IHNvdXJjZVRleHQgPSBjbGVhblRleHQoZGROb2Rlc1swXS50ZXh0Q29udGVudCk7XG4gICAgICAgICAgICByZXN1bHQuc291cmNlQ2l0YXRpb24gPSBzb3VyY2VUZXh0O1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBsZXQgc291cmNlVGV4dCA9IGNsZWFuVGV4dChib2R5LnRleHRDb250ZW50KTtcbiAgICAgICAgICAgIHJlc3VsdC5zb3VyY2VDaXRhdGlvbiA9IHNvdXJjZVRleHQ7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGxldCBzb3VyY2VJbmZvID0gZmFjdEVkaXQucXVlcnlTZWxlY3RvcihcInNlY3Rpb24uc291cmNlSW5mb3JtYXRpb25cIik7XG4gICAgICBpZiAoc291cmNlSW5mbykge1xuICAgICAgICBsZXQgYm9keSA9IHNvdXJjZUluZm8ucXVlcnlTZWxlY3RvcihcImRpdi5jb25Cb2R5XCIpO1xuICAgICAgICBpZiAoYm9keSkge1xuICAgICAgICAgIGxldCBzb3VyY2VUZXh0ID0gY2xlYW5UZXh0KGJvZHkudGV4dENvbnRlbnQpO1xuICAgICAgICAgIHJlc3VsdC5zb3VyY2VJbmZvcm1hdGlvbiA9IHNvdXJjZVRleHQ7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvL2NvbnNvbGUubG9nKFwiaGFuZGxlRmFjdEVkaXQsIHJlY29yZFVybCBpczogXCIgKyByZXN1bHQucmVjb3JkVXJsKTtcbn1cblxuLy8gRXh0cmFjdGluZyB0aGUgSFRNTCBlbGVtZW50cyBpcyB3b3JraW5nIGJ1dCBJIGFtIHVuYWJsZSB0byBnZXQgdGhlIGdpdmVuIG5hbWVcbi8vIGFuZCBsYXN0IG5hbWUgc2VwYXJhdGVseSB0aGF0IHdheS4gVGhlcmUgbWF5IGJlIGEgd2F5IHZpYSBhIGZldGNoLlxuLy8gVGhpcyByZXF1ZXN0OlxuLy8gaHR0cHM6Ly93d3cuYW5jZXN0cnkuY29tL2FwaS90cmVlc3VpLWxpc3QvdHJlZXMvMTE3NDgxODMvcmVjZW50bHl2aWV3ZWRwZXJzb24/ZXhwaXJlcz0xNjY3MTcxODUzNzA2XG4vLyBHZXRzIHRoaXMgcmVzcG9uc2U6XG4vLyB7XCJwaWRcIjpcIjEyOTkyOTg4NjAyXCIsXCJnbmFtZVwiOlwiRmFubmllIEwuXCIsXCJzbmFtZVwiOlwiKEtlbXBlcikgTW9uZXkgQmFyYmVyXCIsXCJpc0xpdmluZ1wiOmZhbHNlfVxuLy8gVGhlIHBpZCBjYW4gYmUgY29tcGFyZWQgd2l0aCB0aGUgcGlkIG9mIHRoZSBwYWdlIHRvIG1ha2Ugc3VyZSBpdCBpcyB0aGUgcmlnaHQgcGVyc29uLlxuZnVuY3Rpb24gaGFuZGxlUGVyc29uRmFjdHMoZG9jdW1lbnQsIHJlc3VsdCkge1xuICBsZXQgcGVyc29uQ2FyZENvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjcGVyc29uQ2FyZENvbnRhaW5lclwiKTtcbiAgaWYgKHBlcnNvbkNhcmRDb250YWluZXIpIHtcbiAgICAvLyBUaGVyZSBpcyBubyB3YXkgdGhhdCBJIGhhdmUgZm91bmQgdG8gZmluZCB0aGUgZ2l2ZW4gbmFtZSBhbmQgc3VybmFtZSBzZXBhcmF0ZWQgaW4gdGhlXG4gICAgLy8gSFRNTCBlbGVtZW50cy4gQnV0IGl0IGNhbiBiZSBmb3VuZCBpbiBhIHNjcmlwdC5cbiAgICBsZXQgc2NyaXB0RWxlbWVudHMgPSBwZXJzb25DYXJkQ29udGFpbmVyLnF1ZXJ5U2VsZWN0b3JBbGwoXCJzY3JpcHRcIik7XG4gICAgZm9yIChsZXQgc2NyaXB0RWxlbWVudCBvZiBzY3JpcHRFbGVtZW50cykge1xuICAgICAgbGV0IHRleHQgPSBzY3JpcHRFbGVtZW50LnRleHRDb250ZW50O1xuICAgICAgbGV0IGZ1bGxOYW1lSW5kZXggPSB0ZXh0LmluZGV4T2YoXCJmdWxsTmFtZTpcIik7XG4gICAgICBpZiAoZnVsbE5hbWVJbmRleCAhPSAtMSkge1xuICAgICAgICBsZXQgZW5kSW5kZXggPSB0ZXh0LmluZGV4T2YoXCJ9XCIsIGZ1bGxOYW1lSW5kZXgpO1xuICAgICAgICBpZiAoZW5kSW5kZXggIT0gLTEpIHtcbiAgICAgICAgICBsZXQgZnVsbE5hbWVUZXh0ID0gdGV4dC5zdWJzdHJpbmcoZnVsbE5hbWVJbmRleCwgZW5kSW5kZXgpO1xuICAgICAgICAgIGxldCBnaXZlbk5hbWUgPSBmdWxsTmFtZVRleHQucmVwbGFjZSgvZnVsbE5hbWU6IHsgZ2l2ZW46ICcoW14nXSopJywgc3VybmFtZTogJygoW14nXSopKScsLiovLCBcIiQxXCIpO1xuICAgICAgICAgIGxldCBzdXJuYW1lID0gZnVsbE5hbWVUZXh0LnJlcGxhY2UoL2Z1bGxOYW1lOiB7IGdpdmVuOiAnKFteJ10qKScsIHN1cm5hbWU6ICcoKFteJ10qKSknLC4qLywgXCIkMlwiKTtcbiAgICAgICAgICBpZiAoZ2l2ZW5OYW1lICYmIGdpdmVuTmFtZSAhPSBmdWxsTmFtZVRleHQpIHtcbiAgICAgICAgICAgIHJlc3VsdC5naXZlbk5hbWUgPSBnaXZlbk5hbWU7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChzdXJuYW1lICYmIHN1cm5hbWUgIT0gZnVsbE5hbWVUZXh0KSB7XG4gICAgICAgICAgICByZXN1bHQuc3VybmFtZSA9IHN1cm5hbWU7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgbGV0IHVzZXJDYXJkVGl0bGUgPSBwZXJzb25DYXJkQ29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoXCIudXNlckNhcmRUaXRsZVwiKTtcbiAgICBpZiAodXNlckNhcmRUaXRsZSkge1xuICAgICAgbGV0IGZ1bGxOYW1lID0gdXNlckNhcmRUaXRsZS50ZXh0Q29udGVudDtcbiAgICAgIGlmIChmdWxsTmFtZSkge1xuICAgICAgICByZXN1bHQudGl0bGVOYW1lID0gZnVsbE5hbWU7XG4gICAgICB9XG4gICAgfVxuXG4gICAgbGV0IHVzZXJDYXJkRXZlbnRzID0gcGVyc29uQ2FyZENvbnRhaW5lci5xdWVyeVNlbGVjdG9yKFwiLnVzZXJDYXJkRXZlbnRzXCIpO1xuICAgIGlmICh1c2VyQ2FyZEV2ZW50cykge1xuICAgICAgbGV0IGJpcnRoRGF0ZVNwYW4gPSB1c2VyQ2FyZEV2ZW50cy5xdWVyeVNlbGVjdG9yKFwic3Bhbi5iaXJ0aERhdGVcIik7XG4gICAgICBpZiAoYmlydGhEYXRlU3Bhbikge1xuICAgICAgICByZXN1bHQuYmlydGhEYXRlID0gYmlydGhEYXRlU3Bhbi50ZXh0Q29udGVudDtcbiAgICAgIH1cbiAgICAgIGxldCBiaXJ0aFBsYWNlU3BhbiA9IHVzZXJDYXJkRXZlbnRzLnF1ZXJ5U2VsZWN0b3IoXCJzcGFuLmJpcnRoUGxhY2VcIik7XG4gICAgICBpZiAoYmlydGhQbGFjZVNwYW4pIHtcbiAgICAgICAgcmVzdWx0LmJpcnRoUGxhY2UgPSBiaXJ0aFBsYWNlU3Bhbi50ZXh0Q29udGVudDtcbiAgICAgIH1cblxuICAgICAgbGV0IGRlYXRoRGF0ZVNwYW4gPSB1c2VyQ2FyZEV2ZW50cy5xdWVyeVNlbGVjdG9yKFwic3Bhbi5kZWF0aERhdGVcIik7XG4gICAgICBpZiAoZGVhdGhEYXRlU3Bhbikge1xuICAgICAgICByZXN1bHQuZGVhdGhEYXRlID0gZGVhdGhEYXRlU3Bhbi50ZXh0Q29udGVudDtcbiAgICAgIH1cbiAgICAgIGxldCBkZWF0aFBsYWNlU3BhbiA9IHVzZXJDYXJkRXZlbnRzLnF1ZXJ5U2VsZWN0b3IoXCJzcGFuLmRlYXRoUGxhY2VcIik7XG4gICAgICBpZiAoZGVhdGhQbGFjZVNwYW4pIHtcbiAgICAgICAgcmVzdWx0LmRlYXRoUGxhY2UgPSBkZWF0aFBsYWNlU3Bhbi50ZXh0Q29udGVudDtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBsZXQgcmVzZWFyY2hMaXN0RmFjdHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3Jlc2VhcmNoTGlzdEZhY3RzXCIpO1xuICBpZiAocmVzZWFyY2hMaXN0RmFjdHMpIHtcbiAgICBsZXQgZmFjdExpc3QgPSByZXNlYXJjaExpc3RGYWN0cy5xdWVyeVNlbGVjdG9yQWxsKFwibGkucmVzZWFyY2hMaXN0SXRlbVwiKTtcbiAgICBmb3IgKGxldCBmYWN0IG9mIGZhY3RMaXN0KSB7XG4gICAgICBpZiAoZmFjdC5jbGFzc0xpc3QuY29udGFpbnMoXCJyZXNlYXJjaExpc3RJdGVtR2VuZGVyXCIpKSB7XG4gICAgICAgIGxldCB2YWx1ZU5vZGUgPSBmYWN0LnF1ZXJ5U2VsZWN0b3IoXCJoNFwiKTtcbiAgICAgICAgaWYgKHZhbHVlTm9kZSkge1xuICAgICAgICAgIGxldCBnZW5kZXIgPSB2YWx1ZU5vZGUudGV4dENvbnRlbnQ7XG4gICAgICAgICAgaWYgKGdlbmRlcikge1xuICAgICAgICAgICAgcmVzdWx0LmdlbmRlciA9IGdlbmRlcjtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGxldCBmYWN0SXRlbSA9IGZhY3QucXVlcnlTZWxlY3RvcihcImRpdi5mYWN0SXRlbUZhY3RcIik7XG4gICAgICAgIGlmIChmYWN0SXRlbSkge1xuICAgICAgICAgIGlmIChmYWN0SXRlbS5jbGFzc0xpc3QuY29udGFpbnMoXCJwcmVmZXJyZWRFdmVudE1hcnJpYWdlXCIpKSB7XG4gICAgICAgICAgICBsZXQgbWFycmlhZ2UgPSB7fTtcbiAgICAgICAgICAgIGxldCBkYXRlTm9kZSA9IGZhY3RJdGVtLnF1ZXJ5U2VsZWN0b3IoXCJzcGFuLmZhY3RJdGVtRGF0ZVwiKTtcbiAgICAgICAgICAgIGlmIChkYXRlTm9kZSkge1xuICAgICAgICAgICAgICBsZXQgZGF0ZSA9IGRhdGVOb2RlLnRleHRDb250ZW50O1xuICAgICAgICAgICAgICBpZiAoZGF0ZSkge1xuICAgICAgICAgICAgICAgIG1hcnJpYWdlLmRhdGUgPSBkYXRlO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsZXQgcGxhY2VOb2RlID0gZmFjdEl0ZW0ucXVlcnlTZWxlY3RvcihcInNwYW4uZmFjdEl0ZW1Mb2NhdGlvblwiKTtcbiAgICAgICAgICAgIGlmIChwbGFjZU5vZGUpIHtcbiAgICAgICAgICAgICAgbGV0IHBsYWNlID0gcGxhY2VOb2RlLnRleHRDb250ZW50O1xuICAgICAgICAgICAgICBpZiAocGxhY2UpIHtcbiAgICAgICAgICAgICAgICBtYXJyaWFnZS5wbGFjZSA9IHBsYWNlO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsZXQgc3BvdXNlTm9kZSA9IGZhY3RJdGVtLnF1ZXJ5U2VsZWN0b3IoXCJoNS51c2VyQ2FyZFRpdGxlXCIpO1xuICAgICAgICAgICAgaWYgKHNwb3VzZU5vZGUpIHtcbiAgICAgICAgICAgICAgbGV0IHNwb3VzZU5hbWUgPSBzcG91c2VOb2RlLnRleHRDb250ZW50O1xuICAgICAgICAgICAgICBpZiAoc3BvdXNlTmFtZSkge1xuICAgICAgICAgICAgICAgIG1hcnJpYWdlLnNwb3VzZU5hbWUgPSBzcG91c2VOYW1lO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIGFkZCB0aGUgbWFycmlhZ2VcbiAgICAgICAgICAgIGlmICghcmVzdWx0Lm1hcnJpYWdlcykge1xuICAgICAgICAgICAgICByZXN1bHQubWFycmlhZ2VzID0gW107XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXN1bHQubWFycmlhZ2VzLnB1c2gobWFycmlhZ2UpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGxldCBmYW1pbHlTZWN0aW9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNmYW1pbHlTZWN0aW9uXCIpO1xuICBpZiAoZmFtaWx5U2VjdGlvbikge1xuICAgIC8vIHRoZXJlIGNhbiBiZSBtdWx0aXBsZSByZXNlYXJjaCBsaXN0cyBidXQgcGFyZW50cyBzaG91bGQgYWx3YXlzIGJlIGZpcnN0IG9uZVxuICAgIGxldCBwYXJlbnRSZXNlYXJjaExpc3QgPSBmYW1pbHlTZWN0aW9uLnF1ZXJ5U2VsZWN0b3IoXCJ1bC5yZXNlYXJjaExpc3RcIik7XG5cbiAgICBsZXQgcGFyZW50SXRlbXMgPSBwYXJlbnRSZXNlYXJjaExpc3QucXVlcnlTZWxlY3RvckFsbChcImxpLnJlc2VhcmNoTGlzdEl0ZW1cIik7XG5cbiAgICBpZiAocGFyZW50SXRlbXMubGVuZ3RoID09IDIpIHtcbiAgICAgIGxldCBmYXRoZXJJdGVtID0gcGFyZW50SXRlbXNbMF07XG4gICAgICBsZXQgZmF0aGVyVGl0bGUgPSBmYXRoZXJJdGVtLnF1ZXJ5U2VsZWN0b3IoXCJoNC51c2VyQ2FyZFRpdGxlXCIpO1xuICAgICAgaWYgKGZhdGhlclRpdGxlKSB7XG4gICAgICAgIHJlc3VsdC5mYXRoZXJOYW1lID0gZmF0aGVyVGl0bGUudGV4dENvbnRlbnQ7XG4gICAgICB9XG5cbiAgICAgIGxldCBtb3RoZXJJdGVtID0gcGFyZW50SXRlbXNbMV07XG4gICAgICBsZXQgbW90aGVyVGl0bGUgPSBtb3RoZXJJdGVtLnF1ZXJ5U2VsZWN0b3IoXCJoNC51c2VyQ2FyZFRpdGxlXCIpO1xuICAgICAgaWYgKG1vdGhlclRpdGxlKSB7XG4gICAgICAgIHJlc3VsdC5tb3RoZXJOYW1lID0gbW90aGVyVGl0bGUudGV4dENvbnRlbnQ7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLy8gI2ZhbWlseTQ2NTUyMTk5NDc0ID4gZGl2Lm5vVG9wU3BhY2luZy51c2VyQ2FyZC51c2VyQ2FyZFNpemUyID4gZGl2LnVzZXJDYXJkQ29udGVudC50ZXh0V3JhcCA+IGg0XG5cbiAgLy9jb25zb2xlLmxvZyhcImhhbmRsZUZhY3RFZGl0LCByZWNvcmRVcmwgaXM6IFwiICsgcmVzdWx0LnJlY29yZFVybCk7XG59XG5cbi8vIFVzZWQgYnkgYmFja2dyb3VuZCBmb3IgZXh0cmFjdGluZyBhIHJlZmVyZW5jZWQgcmVjb3JkXG5mdW5jdGlvbiBleHRyYWN0UmVjb3JkKGRvY3VtZW50LCB1cmwsIHJlc3VsdCkge1xuICBleHRyYWN0RGJBbmRSZWNvcmRJZChyZXN1bHQsIHVybCk7XG4gIGV4dHJhY3RSZWNvcmRQYWdlVGl0bGUoZG9jdW1lbnQsIHJlc3VsdCk7XG4gIGV4dHJhY3RSZWNvcmREYXRhKGRvY3VtZW50LCByZXN1bHQpO1xuICBleHRyYWN0SW1hZ2VUaHVtYihkb2N1bWVudCwgcmVzdWx0KTtcbiAgZXh0cmFjdFJlY29yZFNvdXJjZUNpdGF0aW9uKGRvY3VtZW50LCByZXN1bHQpO1xufVxuXG5mdW5jdGlvbiBleHRyYWN0RGF0YShkb2N1bWVudCwgdXJsKSB7XG4gIHZhciByZXN1bHQgPSB7fTtcblxuICByZXN1bHQudXJsID0gdXJsOyAvLyB1c2VmdWwgdG8ga25vdyB3aGF0IGRvbWFpbiB0aGlzIHJlY29yZCBpcyBmcm9tXG5cbiAgLy9jb25zb2xlLmxvZyhcIkFuY2VzdHJ5IGV4dHJhY3REYXRhLCB1cmwgPSBcIiArIHVybCk7XG5cbiAgLy8gZmlyc3QgZGV0ZXJtaW5lIHdoYXQga2luZCBvZiBwYWdlIHdlIGFyZSBpbi5cbiAgLy8gLSBSZWNvcmQgcGFnZVxuICAvLyAtIEltYWdlIHBhZ2VcbiAgLy8gLSBJbWFnZSBwYWdlIHdpdGggc2hhcmluZyB1cmwgdXBcblxuICBkZXRlY3RQYWdlVHlwZShkb2N1bWVudCwgcmVzdWx0LCB1cmwpO1xuXG4gIC8vY29uc29sZS5sb2coXCJBbmNlc3RyeSBwYWdlVHlwZSBpcyBcIiArIHJlc3VsdC5wYWdlVHlwZSk7XG5cbiAgaWYgKHJlc3VsdC5wYWdlVHlwZSA9PSBcInJlY29yZFwiKSB7XG4gICAgLy9jb25zb2xlLmxvZyhcIlRoaXMgaXMgYW4gQW5jZXN0cnkgcmVjb3JkIHBhZ2VcIik7XG4gICAgZXh0cmFjdERiQW5kUmVjb3JkSWQocmVzdWx0LCB1cmwpO1xuICAgIGV4dHJhY3RSZWNvcmRQYWdlVGl0bGUoZG9jdW1lbnQsIHJlc3VsdCk7XG4gICAgZXh0cmFjdFJlY29yZERhdGEoZG9jdW1lbnQsIHJlc3VsdCk7XG4gICAgZXh0cmFjdEltYWdlVGh1bWIoZG9jdW1lbnQsIHJlc3VsdCk7XG4gICAgZXh0cmFjdFJlY29yZFNvdXJjZUNpdGF0aW9uKGRvY3VtZW50LCByZXN1bHQpO1xuICB9IGVsc2UgaWYgKHJlc3VsdC5wYWdlVHlwZSA9PSBcImltYWdlXCIpIHtcbiAgICBleHRyYWN0SW1hZ2VQYWdlVGl0bGUoZG9jdW1lbnQsIHJlc3VsdCk7XG4gICAgZXh0cmFjdEltYWdlVGVtcGxhdGUocmVzdWx0LCB1cmwpO1xuICAgIGV4dHJhY3RJbWFnZUJyb3dzZVBhdGgoZG9jdW1lbnQsIHJlc3VsdCk7XG4gICAgZXh0cmFjdEltYWdlTnVtYmVyQW5kVG90YWwoZG9jdW1lbnQsIHJlc3VsdCk7XG4gICAgZXh0cmFjdEltYWdlSGFzSW5kZXgoZG9jdW1lbnQsIHJlc3VsdCk7XG4gIH0gZWxzZSBpZiAocmVzdWx0LnBhZ2VUeXBlID09IFwic2hhcmluZ1VybFwiKSB7XG4gICAgZXh0cmFjdEltYWdlUGFnZVRpdGxlKGRvY3VtZW50LCByZXN1bHQpO1xuICAgIGV4dHJhY3RTaGFyaW5nVXJsVGVtcGxhdGUoZG9jdW1lbnQsIHJlc3VsdCk7XG4gIH0gZWxzZSBpZiAocmVzdWx0LnBhZ2VUeXBlID09IFwic2hhcmluZ0ltYWdlT3JSZWNvcmRcIikge1xuICAgIGlmIChyZXN1bHQuc2hhcmluZ1R5cGUgPT0gXCJ2MVwiKSB7XG4gICAgICBleHRyYWN0U2hhcmluZ0ltYWdlRnVsbFNpemVMaW5rKGRvY3VtZW50LCByZXN1bHQpO1xuICAgICAgZXh0cmFjdFNoYXJpbmdJbWFnZU9yUmVjb3JkRGV0YWlscyhkb2N1bWVudCwgcmVzdWx0KTtcbiAgICB9IGVsc2UgaWYgKHJlc3VsdC5zaGFyaW5nVHlwZSA9PSBcInYyXCIpIHtcbiAgICAgIGV4dHJhY3RTaGFyaW5nSW1hZ2VGdWxsU2l6ZUxpbmtWMihkb2N1bWVudCwgcmVzdWx0KTtcbiAgICAgIGV4dHJhY3RTaGFyaW5nSW1hZ2VPclJlY29yZERldGFpbHNWMihkb2N1bWVudCwgcmVzdWx0KTtcbiAgICB9IGVsc2UgaWYgKHJlc3VsdC5zaGFyaW5nVHlwZSA9PSBcImRpc2NvdmVyaWVzXCIpIHtcbiAgICAgIGV4dHJhY3RTaGFyaW5nSW1hZ2VGdWxsU2l6ZUxpbmtEaXNjb3Zlcmllcyhkb2N1bWVudCwgcmVzdWx0KTtcbiAgICAgIGV4dHJhY3RTaGFyaW5nSW1hZ2VPclJlY29yZERldGFpbHNEaXNjb3Zlcmllcyhkb2N1bWVudCwgcmVzdWx0KTtcbiAgICB9XG4gIH0gZWxzZSBpZiAocmVzdWx0LnBhZ2VUeXBlID09IFwicGVyc29uU291cmNlQ2l0YXRpb25cIikge1xuICAgIGhhbmRsZVBlcnNvblNvdXJjZUNpdGF0aW9uKGRvY3VtZW50LCByZXN1bHQpO1xuICB9IGVsc2UgaWYgKHJlc3VsdC5wYWdlVHlwZSA9PSBcInBlcnNvbkZhY3RzXCIpIHtcbiAgICBoYW5kbGVQZXJzb25GYWN0cyhkb2N1bWVudCwgcmVzdWx0KTtcbiAgICBleHRyYWN0VHJlZVRlbXBsYXRlKHJlc3VsdCwgdXJsKTtcbiAgfSBlbHNlIGlmIChyZXN1bHQucGFnZVR5cGUgPT0gXCJ0cmVlTWVkaWFcIikge1xuICAgIGV4dHJhY3RUcmVlTWVkaWFUZW1wbGF0ZShyZXN1bHQsIHVybCk7XG4gIH1cblxuICAvL2NvbnNvbGUubG9nKFwicmVzdWx0IG9mIGV4dHJhY3REYXRhIG9uIEFuY2VzdHJ5XCIpO1xuICAvL2NvbnNvbGUubG9nKHJlc3VsdCk7XG5cbiAgcmV0dXJuIHJlc3VsdDtcbn1cblxuZXhwb3J0IHsgZXh0cmFjdERhdGEsIGRldGVjdFBhZ2VUeXBlLCBleHRyYWN0UmVjb3JkIH07XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./extension/site/ancestry/core/ancestry_extract_data.mjs\n");

/***/ }),

/***/ "./extension/site/ancestry/core/ancestry_generalize_data.mjs":
/*!*******************************************************************!*\
  !*** ./extension/site/ancestry/core/ancestry_generalize_data.mjs ***!
  \*******************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"GeneralizedData\": () => (/* reexport safe */ _base_core_generalize_data_utils_mjs__WEBPACK_IMPORTED_MODULE_0__.GeneralizedData),\n/* harmony export */   \"dateQualifiers\": () => (/* reexport safe */ _base_core_generalize_data_utils_mjs__WEBPACK_IMPORTED_MODULE_0__.dateQualifiers),\n/* harmony export */   \"generalizeData\": () => (/* binding */ generalizeData),\n/* harmony export */   \"generalizeDataGivenRecordType\": () => (/* binding */ generalizeDataGivenRecordType),\n/* harmony export */   \"regeneralizeDataWithLinkedRecords\": () => (/* binding */ regeneralizeDataWithLinkedRecords)\n/* harmony export */ });\n/* harmony import */ var _base_core_generalize_data_utils_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../base/core/generalize_data_utils.mjs */ \"./extension/base/core/generalize_data_utils.mjs\");\n/* harmony import */ var _base_core_record_collections_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../base/core/record_collections.mjs */ \"./extension/base/core/record_collections.mjs\");\n/* harmony import */ var _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../base/core/record_type.mjs */ \"./extension/base/core/record_type.mjs\");\n/*\nMIT License\n\nCopyright (c) 2020 Robert M Pavey\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.\n*/\n\n\n\n\n\nconst eventTypeStringToDataType = {\n  BirthRegistration: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.BirthRegistration,\n  Birth: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Birth,\n  DeathRegistration: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.DeathRegistration,\n  Death: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Death,\n  Marriage: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Marriage,\n  \"ægteskab(Marriage)\": _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Marriage,\n  MarriageLicense: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Marriage,\n  Census: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Census,\n  ElectoralRegister: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.ElectoralRegister,\n  Baptism: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Baptism,\n  Burial: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Burial,\n  CriminalRegister: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.CriminalRegister,\n  FreemasonMembership: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.FreemasonMembership,\n  Probate: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Probate,\n  Divorce: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Divorce,\n  MilitaryService: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Military,\n  TaxList: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Tax,\n};\n\nconst recordTypeByFields = [\n  { type: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Divorce, labels: [\"Divorce Date\"] },\n  { type: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Marriage, labels: [\"Marriage Date\", \"Marriage Place\", \"Spouse\"] },\n  {\n    type: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Marriage,\n    labels: [\"Marriage License Date\", \"Marriage License Place\", \"Spouse\"],\n  },\n  { type: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Marriage, labels: [\"License Date\", \"License Place\", \"Spouse\"] },\n  { type: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Baptism, labels: [\"Baptism Date\", \"Baptism Place\"] },\n  { type: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Burial, labels: [\"Burial Date\", \"Burial Place\"] },\n  { type: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Burial, labels: [\"Burial Year\", \"Burial Place\"] },\n  { type: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Burial, labels: [\"Death Date\", \"Burial Place\"] },\n  { type: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Marriage, labels: [\"Marriage Date\", \"Marriage Place\"] },\n  { type: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Marriage, labels: [\"Marriage Date on Image\", \"Marriage Place\"] },\n  { type: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Marriage, labels: [\"Marriage Year\", \"Marriage Place\"] },\n  { type: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Marriage, labels: [\"Marriage Year\", \"Marriage State\"] },\n  { type: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Marriage, labels: [\"Marriage Date\"] },\n  { type: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.MarriageRegistration, labels: [\"Marriage Registration Place\"] },\n  { type: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.MarriageRegistration, labels: [\"Marriage Registration Date\"] },\n  { type: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.MarriageRegistration, labels: [\"Marriage Registration Year\"] },\n  {\n    type: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Death,\n    labels: [\"Death Date on Image\", \"Translated Death Date\", \"Death Place\"],\n  },\n  { type: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Death, labels: [\"Death Date\", \"Monthly Meeting\"] },\n  { type: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Military, labels: [\"Enlistment Date\", \"Enlistment Place\"] },\n];\n\nfunction determineRecordType(extractedData) {\n  const titleMatches = [\n    { type: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Baptism, matches: [\"Christening Index\"] },\n    {\n      type: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.BirthRegistration,\n      matches: [\"Birth Index\"],\n      requiredData: [\"Birth Registration Date\"],\n    },\n    {\n      type: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.BirthRegistration,\n      matches: [\"Birth Index\"],\n      requiredData: [\"Birth Registration Place\"],\n    },\n    {\n      type: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Birth,\n      matches: [\"Birth Certificate\", \"Birth Record\", \"Birth Index\"],\n    },\n    {\n      type: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Baptism,\n      matches: [\"Births and Christenings\", \"Births and Baptisms\", \"Church of England Baptisms\", \"Baptism Index\"],\n      requiredData: [\"Baptism Date\"],\n    },\n    {\n      type: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Birth,\n      matches: [\"Births and Christenings\", \"Births and Baptisms\", \"Canada Births\", \"Canada, Births\", \"Birth Registers\"],\n      requiredData: [\"Birth Date\"],\n    },\n    {\n      type: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Birth,\n      matches: [\"Millennium File\", \"Vital Extracts\", \"Membership of The Church of Jesus Christ of Latter-day Saints\"],\n      requiredData: [\"Birth Date\"],\n    },\n    {\n      type: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Birth,\n      matches: [\"Births\"],\n      requiredData: [\"Birth Date\", \"Birth Place\", \"Gender\"],\n    },\n    {\n      type: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.BirthOrBaptism,\n      matches: [\n        \"Select Births and Christenings\",\n        \"Select Births and Baptisms\",\n        \"Church of England Births and Baptisms\",\n      ],\n    },\n\n    { type: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Divorce, matches: [\"Divorce Records\", \"Divorce Index\"] },\n    {\n      type: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Marriage,\n      matches: [\n        \"Church of England Marriages and Banns\",\n        \"Marriage Registers, Bonds and Allegations\",\n        \"U.S. and International Marriage Records\",\n        \"Index to Marriage Bonds\",\n        \"Marriage Bonds and Allegations\",\n      ],\n    },\n    {\n      type: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Burial,\n      matches: [\n        \"Church of England Burials\",\n        \"England Deaths and Burials\",\n        \"Burial and Cremation Index\",\n        \"Find a Grave\",\n        \"Cemetery Burial Cards\",\n        \"Veterans Burial Cards\",\n        \"Gravesites\",\n        \"Graves of Revolutionary Patriots\",\n      ],\n    },\n    {\n      type: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Burial,\n      matches: [\"Deaths and Burials\", \"Cemetery\", \"Funeral Home\", \"Gravestone\"],\n      requiredData: [\"Burial Date\"],\n    },\n    {\n      type: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Cremation,\n      matches: [\"Cemetery Records\"],\n      requiredData: [\"Cremation Date\"],\n    },\n    {\n      type: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Burial,\n      matches: [\"Historical Cemetery Commission Index\", \"Headstone Transcriptions\", \"Cemetery\", \"Funeral\"],\n      requiredData: [\"Burial Place\"],\n    },\n    {\n      type: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.DeathRegistration,\n      matches: [\"Deaths\", \"Death Records\", \"Death Index\"],\n      requiredData: [\"Death Registration Place\"],\n    },\n    {\n      type: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Death,\n      matches: [\"Deaths\", \"Death Records\", \"Scotland, Local Heritage Index\"],\n      requiredData: [\"Death Date\"],\n    },\n    {\n      type: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Death,\n      matches: [\n        \"Death Index\",\n        \"Death Certificate\",\n        \"U.S., Death Record\",\n        \"Index to Deceased Estate Files\",\n        \"Death Notice\",\n        \"Canada, Deaths\",\n      ],\n    },\n    {\n      type: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.NonpopulationCensus,\n      matches: [\"Census Non-Population Schedule\"],\n    },\n    { type: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Census, matches: [\"Census\", \"1939 England and Wales Register\"] },\n    {\n      type: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.ElectoralRegister,\n      matches: [\"Electoral Roll\", \"Voter Registers\", \"Electoral Registers\"],\n    },\n    { type: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Probate, matches: [\"Probate\"] },\n    {\n      type: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Will,\n      matches: [\"Prerogative Court of Canterbury Wills\", \"Will Index\"],\n    },\n    {\n      type: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.MarriageRegistration,\n      matches: [\"Civil Registration Marriage Index\"],\n    },\n    {\n      type: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.CriminalRegister,\n      matches: [\"Criminal Register\", \"Police Gazettes\", \"Convict Register\", \"Prison Hulk Register\"],\n    },\n    {\n      type: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.FreemasonMembership,\n      matches: [\"Freemason Membership\", \"Mason Membership Cards\"],\n    },\n    {\n      type: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.WorkhouseRecord,\n      matches: [\"Workhouse Admission and Discharge Records\"],\n    },\n    {\n      type: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.PassengerList,\n      matches: [\n        \"Passenger List\",\n        \"Passenger and Crew List\",\n        \"Passenger and Immigration Lists Index\",\n        \"Index to Alien Arrivals\",\n      ],\n    },\n    { type: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.CrewList, matches: [\"Crew List\"] },\n    { type: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.ConvictTransportation, matches: [\"Convict Transportation\"] },\n    {\n      type: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Military,\n      matches: [\n        \"Medal and Award Rolls\",\n        \"British Army World War I Service Records\",\n        \"Army World War I Pension\",\n        \"World War I Pension Ledgers and Index Cards\",\n        \"Regimental Rolls and Recruitment Registers\",\n        \"Chelsea Pensioner Soldier Service Records\",\n        \"Soldiers Died in the Great War\",\n        \"World War I\",\n        \"War Graves\",\n        \"U.S., Department of Veterans Affairs BIRLS Death File\",\n        \"UK, Army Registers of Soldiers' Effects\",\n        \"Soldier Grave Registrations\",\n        \"Military Service\",\n        \"Compiled Service Records\",\n        \"Volunteer Militia\",\n        \"Revolutionary War Residents\",\n        \"Soldier Records\",\n        \"War Soldiers\",\n        \"Prisoner of War\",\n        \"War Rolls\",\n        \"War Pensioners\",\n        \"War of 1812 Pension\",\n        \"Draft Registration\",\n        \"Civil, Military, and Naval Service\",\n        \"Air Force Airmen Records\",\n        \"Navy Registers of Seamen's Services\",\n        \"Confederate Pensions\",\n        \"War Pension\",\n      ],\n    },\n    { type: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Military, matches: [\"War\"], secondMatches: [\"Pension\"] },\n    {\n      type: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.MedicalPatient,\n      matches: [\"Lunacy Patients Admission Registers\"],\n    },\n    { type: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.QuarterSession, matches: [\"Quarter Sessions\"] },\n    {\n      type: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Directory,\n      matches: [\n        \"City and County Directories\",\n        \"City Directories\",\n        \"City and Area Directories\",\n        \"Phone Book\",\n        \"Trade Directories\",\n      ],\n    },\n    {\n      type: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Employment,\n      matches: [\n        \"Employment Records\",\n        \"UK, Postal Service Appointment Books\",\n        \"Nursing Registers\",\n        \"Appointments of U. S. Postmasters\",\n        \"Police Pension Registers\",\n      ],\n    },\n    { type: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.SocialSecurity, matches: [\"U.S., Social Security\"] },\n    { type: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.LandTax, matches: [\"Land Tax Redemption\", \"Land Tax Records\"] },\n    {\n      type: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Tax,\n      matches: [\"Direct Tax Lists\", \"Tax and Exoneration\", \"Tax List Record\", \"Tax Record\"],\n    },\n    { type: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Apprenticeship, matches: [\"Apprentices' Indentures\"] },\n    { type: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Obituary, matches: [\"Obituary\", \"Obituaries\"] },\n    {\n      type: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.SchoolRecords,\n      matches: [\"School Yearbook\", \"School Admission\", \"School Registers\"],\n    },\n    {\n      type: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Naturalization,\n      matches: [\"Naturalization Record\", \"Naturalisation Certificate\"],\n    },\n    {\n      type: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.LegalRecord,\n      matches: [\"Land Warrant\", \"Land Office Records\", \"Homestead Grant\"],\n    },\n    { type: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Immigration, matches: [\"Immigration Records\"] },\n    { type: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Emigration, matches: [\"Emigration Records\"] },\n    {\n      type: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Certificate,\n      matches: [\"Certificate\"],\n      requiredData: [\"Issue Date\"],\n    },\n    {\n      type: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Residence,\n      matches: [\"Residents\", \"U.S., Public Records Index\"],\n      requiredData: [\"Residence Place\"],\n    },\n    {\n      type: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Residence,\n      matches: [\"U.S., Public Records Index\"],\n      requiredData: [\"Residence\"],\n    },\n    {\n      type: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Residence,\n      matches: [\"U.S., Public Records Index\"],\n      requiredData: [\"Residence Date\"],\n    },\n    {\n      type: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.FamHistOrPedigree,\n      matches: [\"of the American Revolution Membership\", \"Colonial Families of the USA\"],\n    },\n    {\n      // This could possibly be confused with a child marriage. It is to handle a record like this:\n      // https://www.ancestry.com/discoveryui-content/view/154307070:61039\n      type: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Baptism,\n      matches: [\"Catholic Parish Registers\"],\n      requiredData: [\"Name\", \"Child\", \"Gender\"],\n    },\n    {\n      type: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.MarriageRegistration,\n      matches: [\"Marriage Index\"],\n      requiredData: [\"Marriage Registration Place\", \"Spouse\"],\n    },\n    {\n      type: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Marriage,\n      matches: [\"Marriage Index\"],\n      requiredData: [\"Spouse\"],\n    },\n    {\n      type: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Birth,\n      matches: [\"American Genealogical-Biographical Index\"],\n      requiredData: [\"Birth Date\"],\n    },\n    {\n      type: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Military,\n      matches: [\"Veteran\", \"Soldier\", \"Military\", \"Armed\"],\n      requiredData: [\"Rank\"],\n    },\n    {\n      type: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Military,\n      matches: [\"Veterans\", \"Soldier\", \"Military\", \"Armed\"],\n      requiredData: [\"Muster In Date\"],\n    },\n    { type: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.PassportApplication, matches: [\"Passport Application\"] },\n    { type: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Pension, matches: [\"Pension Index\"] },\n  ];\n\n  //console.log(\"in determineRecordType\");\n  //console.log(extractedData);\n\n  let eventTypeString = undefined;\n  if (extractedData.recordData) {\n    eventTypeString = extractedData.recordData[\"Event Type\"];\n    if (!eventTypeString) {\n      eventTypeString = extractedData.recordData[\"Record Type\"];\n    }\n  }\n\n  if (eventTypeString) {\n    eventTypeString = eventTypeString.replace(/\\s/g, \"\");\n    let dataType = eventTypeStringToDataType[eventTypeString];\n    if (!dataType) {\n      console.log(\"determineRecordType: Unrecognised event type: \" + eventTypeString);\n    } else {\n      return dataType;\n    }\n  }\n\n  if (extractedData.titleCollection) {\n    // check for birth or death registration\n    if (extractedData.titleCollection.includes(\"Registration\")) {\n      if (extractedData.titleCollection.includes(\"Birth\")) {\n        return _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.BirthRegistration;\n      }\n      if (extractedData.titleCollection.includes(\"Death\")) {\n        return _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.DeathRegistration;\n      }\n      if (extractedData.titleCollection.includes(\"Marriage\")) {\n        return _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.MarriageRegistration;\n      }\n    }\n\n    // check for a marriage\n    if (\n      extractedData.titleCollection.includes(\"Marriage\") &&\n      extractedData.recordData &&\n      extractedData.recordData[\"Marriage Date\"]\n    ) {\n      return _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Marriage;\n    }\n\n    if (extractedData.titleCollection.includes(\"Criminal Register\")) {\n      return _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.CriminalRegister;\n    }\n\n    if (extractedData.titleCollection.includes(\"Freemason Membership\")) {\n      return _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.FreemasonMembership;\n    }\n\n    for (let titleMatch of titleMatches) {\n      let titleMatched = false;\n      for (let match of titleMatch.matches) {\n        if (extractedData.titleCollection.includes(match)) {\n          titleMatched = true;\n          break;\n        }\n      }\n      if (!titleMatched) {\n        continue;\n      }\n\n      if (titleMatch.secondMatches) {\n        let secondTitleMatched = false;\n        for (let match of titleMatch.secondMatches) {\n          if (extractedData.titleCollection.includes(match)) {\n            secondTitleMatched = true;\n            break;\n          }\n        }\n        if (!secondTitleMatched) {\n          continue;\n        }\n      }\n\n      if (!titleMatch.requiredData) {\n        return titleMatch.type;\n      } else if (extractedData.recordData) {\n        let match = true;\n        for (let fieldName of titleMatch.requiredData) {\n          if (!extractedData.recordData[fieldName]) {\n            match = false;\n            break;\n          }\n        }\n        if (match) {\n          return titleMatch.type;\n        }\n      }\n    }\n  }\n\n  // The title and record/event type have not identfied the record\n  // Try to classify it using recordData field names\n  if (extractedData.recordData) {\n    for (let entry of recordTypeByFields) {\n      let match = true;\n      for (let fieldName of entry.labels) {\n        if (!extractedData.recordData[fieldName]) {\n          match = false;\n          break;\n        }\n      }\n\n      if (match) {\n        return entry.type;\n      }\n    }\n  }\n\n  return _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Unclassified;\n}\n\nfunction determineRoleGivenRecordType(extractedData, result) {\n  //console.log(\"determineRoleGivenRecordType, recordType is: \" + result.recordType);\n  //console.log(\"determineRoleGivenRecordType, extractedData is: \");\n  //console.log(extractedData);\n\n  if (!extractedData.recordData) {\n    return; // can't assign a role\n  }\n\n  let recordType = result.recordType;\n\n  if (recordType == _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Baptism || recordType == _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Birth || recordType == _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.BirthOrBaptism) {\n    // if there is a baptism date etc then this is likely a record for this person not a\n    // child or spouse. There could be a birth date though - for the parent of the child\n    // e.g.: https://www.ancestry.com/discoveryui-content/view/300065623:8703?ssrc=pt&tid=180320731&pid=412419830925\n    let value = getCleanValueForRecordDataList(extractedData, [\"Baptism Date\", \"Christening Date\"]);\n    if (!value) {\n      if (extractedData.recordData[\"Child\"]) {\n        // some family records have all parents and children of the primary person\n        // ignore if Father or Mother fields\n        if (!extractedData.recordData[\"Father\"] && !extractedData.recordData[\"Mother\"]) {\n          result.role = _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.Role.Parent;\n          result.primaryPerson = extractedData.recordData[\"Child\"];\n        }\n      }\n    }\n  } else if (recordType == _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Death || recordType == _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.DeathRegistration || recordType == _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Burial) {\n    // if there is a death or burial date etc then this is likely a record for this person not a\n    // child or spouse\n    let value = getCleanValueForRecordDataList(extractedData, [\n      \"Death Date\",\n      \"Burial Date\",\n      \"Cremation Date\",\n      \"Burial Year\",\n    ]);\n    if (!value) {\n      if (extractedData.recordData[\"Child\"]) {\n        result.role = _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.Role.Parent;\n        result.primaryPerson = extractedData.recordData[\"Child\"];\n      } else if (extractedData.recordData[\"Spouse\"]) {\n        if (\n          !extractedData.recordData[\"Death Date\"] &&\n          !extractedData.recordData[\"Death Place\"] &&\n          !extractedData.recordData[\"Burial Date\"] &&\n          !extractedData.recordData[\"Burial Year\"] &&\n          !extractedData.recordData[\"Burial Place\"]\n        ) {\n          result.role = _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.Role.Spouse;\n          result.primaryPerson = extractedData.recordData[\"Spouse\"];\n        }\n      }\n    }\n  } else if (recordType == _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Marriage || recordType == _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.MarriageRegistration) {\n    // if there is a date etc then this is likely a record for this person not a\n    // child or spouse\n    let value = getCleanValueForRecordDataList(extractedData, [\"Marriage Date\"]);\n    if (!value) {\n      if (extractedData.recordData[\"Child\"]) {\n        if (!extractedData.recordData[\"Father\"] && !extractedData.recordData[\"Mother\"]) {\n          result.role = _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.Role.Parent;\n          result.primaryPerson = extractedData.recordData[\"Child\"];\n        }\n      }\n    }\n  }\n  // possibly any other type should go through here?\n  // We could possibly test if recordData num properties is <= 4 or something like that\n  else if (recordType == _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Unclassified || recordType == _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Employment) {\n    let value = getCleanValueForRecordDataList(extractedData, [\n      \"Birth Date\",\n      \"Baptism Date\",\n      \"Christening Date\",\n      \"Death Date\",\n      \"Burial Date\",\n      \"Cremation Date\",\n      \"Marriage Date\",\n    ]);\n    if (!value) {\n      if (extractedData.recordData[\"Child\"]) {\n        if (!extractedData.recordData[\"Father\"] && !extractedData.recordData[\"Mother\"]) {\n          result.role = _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.Role.Parent;\n          result.primaryPerson = extractedData.recordData[\"Child\"];\n        }\n      }\n    }\n  } else if (recordType == _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Obituary) {\n    // obituary can have lots of relations\n    let value = getCleanValueForRecordDataList(extractedData, [\n      \"Death Date\",\n      \"Burial Date\",\n      \"Cremation Date\",\n      \"Burial Year\",\n    ]);\n    if (!value) {\n      if (\n        !extractedData.recordData[\"Death Date\"] &&\n        !extractedData.recordData[\"Death Place\"] &&\n        !extractedData.recordData[\"Death Age\"]\n      ) {\n        if (extractedData.recordData[\"Child\"]) {\n          result.role = _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.Role.Parent;\n          result.primaryPerson = extractedData.recordData[\"Child\"];\n        } else if (extractedData.recordData[\"Spouse\"]) {\n          result.role = _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.Role.Spouse;\n          result.primaryPerson = extractedData.recordData[\"Spouse\"];\n        } else if (extractedData.recordData[\"Father\"]) {\n          result.role = _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.Role.Child;\n          result.primaryPerson = extractedData.recordData[\"Father\"];\n        } else if (extractedData.recordData[\"Mother\"]) {\n          result.role = _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.Role.Child;\n          result.primaryPerson = extractedData.recordData[\"Mother\"];\n        } else if (extractedData.recordData[\"Siblings\"]) {\n          result.role = _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.Role.Sibling;\n          result.primaryPerson = extractedData.recordData[\"Siblings\"];\n        }\n      }\n    }\n  }\n\n  //console.log(\"determineRoleGivenRecordType. role is: \" + result.role);\n}\n\nfunction determineRecordTypeAndRole(extractedData, result) {\n  result.recordType = determineRecordType(extractedData);\n  determineRoleGivenRecordType(extractedData, result);\n}\n\nfunction monthStrToNum(monthStr) {\n  const months = [\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"May\", \"Jun\", \"Jul\", \"Aug\", \"Sep\", \"Oct\", \"Nov\", \"Dec\"];\n\n  for (let i = 0; i < months.length; ++i) {\n    if (monthStr.startsWith(months[i])) {\n      return i + 1;\n    }\n  }\n\n  return 0;\n}\n\nfunction cleanDateString(dateString) {\n  // sometimes records have dates like this:\n  // 25. Jun 1840 (25 Jun 1840)\n\n  let newString = dateString.trim();\n  newString = newString.replace(\"s+\", \" \");\n\n  if (/^\\d\\d? \\w\\w\\w \\d\\d\\d\\d$/.test(newString)) {\n    // this is the \"normal\" format for an Ancestry date string\n    return newString;\n  }\n\n  let openParenIndex = newString.indexOf(\"(\");\n  if (openParenIndex != -1) {\n    // there is an open parentheses\n    let closeParenIndex = newString.indexOf(\")\");\n    if (closeParenIndex != -1 && closeParenIndex > openParenIndex) {\n      let firstDateString = newString.substring(0, openParenIndex).trim();\n      let secondDateString = newString.substring(openParenIndex + 1, closeParenIndex).trim();\n      if (/^\\d\\d? \\w\\w\\w \\d\\d\\d\\d$/.test(secondDateString)) {\n        return secondDateString;\n      }\n      if (/^\\d\\d? \\w\\w\\w \\d\\d\\d\\d$/.test(firstDateString)) {\n        return firstDateString;\n      }\n\n      // neither date is expected format. Just use the one in parents and continue checks\n      newString = secondDateString;\n    } else {\n      newString = newString.substring(0, openParenIndex).trim();\n    }\n  }\n\n  return newString;\n}\n\nfunction getCleanRecordDataValue(data, fieldName, type = \"\") {\n  if (!data.recordData) {\n    return \"\";\n  }\n\n  let value = data.recordData[fieldName];\n  if (value == undefined) {\n    return value;\n  }\n\n  // sometimes there are values in square brackets after the first value\n  // these make it hard to parse dates, placses names etc so remove them\n  let bracketIndex = value.indexOf(\"[\");\n  if (bracketIndex != -1) {\n    value = value.substring(0, bracketIndex).trim();\n  }\n\n  // sometimes places have commas with no space after them\n  value = value.replace(/\\,([^\\s])/g, \", $1\");\n\n  if (type == \"date\") {\n    value = cleanDateString(value);\n  }\n\n  return value;\n}\n\nfunction getCleanValueForRecordDataList(data, fieldNames, type = \"\") {\n  for (let fieldName of fieldNames) {\n    let value = getCleanRecordDataValue(data, fieldName, type);\n    if (value) {\n      return value;\n    }\n  }\n}\n\nfunction buildParents(data, result) {\n  let fatherName = getCleanValueForRecordDataList(data, [\"Father\", \"Father Name\"]);\n  if (fatherName) {\n    let father = result.addFather();\n    father.name.name = fatherName;\n  }\n  let motherName = getCleanValueForRecordDataList(data, [\"Mother\", \"Mother Name\"]);\n  if (motherName) {\n    let mother = result.addMother();\n    mother.name.name = motherName;\n  }\n\n  let mmn = getCleanValueForRecordDataList(data, [\"Mother Maiden Name\", \"Mother's Maiden Name\"]);\n  if (mmn) {\n    result.mothersMaidenName = mmn;\n  }\n}\n\nfunction buildEventPlace(data, result, includeResidence) {\n  let country = getCleanValueForRecordDataList(data, [\"Country\"]);\n  let state = getCleanValueForRecordDataList(data, [\"State\", \"Province\"]);\n  let county = getCleanValueForRecordDataList(data, [\"County/Island\", \"County\", \"County or Borough\"]);\n  let civilParish = getCleanValueForRecordDataList(data, [\"Civil Parish\", \"Civil parish\", \"Parish\"]);\n  let town = getCleanValueForRecordDataList(data, [\"Town\", \"Ward or Division/Constituency\", \"Locality\"]);\n  let streetAddress = getCleanValueForRecordDataList(data, [\"Street Address\", \"Address\"]);\n  let houseNumber = getCleanValueForRecordDataList(data, [\"House Number\"]);\n  let residence = \"\";\n\n  if (includeResidence) {\n    if (!country) {\n      country = getCleanValueForRecordDataList(data, [\"Residence Country\"]);\n    }\n    if (!state) {\n      state = getCleanValueForRecordDataList(data, [\"Residence State\", \"Residence Province or Territory\"]);\n    }\n    if (!county) {\n      county = getCleanValueForRecordDataList(data, [\n        \"County/Island\",\n        \"County\",\n        \"County or Borough\",\n        \"Residence County\",\n      ]);\n    }\n    if (!town) {\n      town = getCleanValueForRecordDataList(data, [\"Place of Habitation\", \"Residence District\"]);\n    }\n    if (!streetAddress) {\n      streetAddress = getCleanValueForRecordDataList(data, [\n        \"Street Address\",\n        \"Address\",\n        \"Residence Street or Township\",\n      ]);\n    }\n\n    let yearString = result.inferEventYear();\n    let homeString = \"Home in \" + yearString; // label used in US federal census\n    let homeString2 = \"Home in \" + yearString + \" (City, County, State)\"; // label used in US 1800-1840 federal census\n    residence = getCleanValueForRecordDataList(data, [\"Residence\", \"Residence Place\", homeString, homeString2]);\n  }\n\n  let placeString = \"\";\n  if (residence && residence.includes(\",\")) {\n    // for example in US state census Residence is the full address. It is in UK 1891 census too\n    // It is not in Ontario, Canada, County Marriage Registers, 1858-1869 though\n    placeString += residence;\n  } else {\n    if (streetAddress) {\n      if (houseNumber && !streetAddress.startsWith(houseNumber)) {\n        placeString += houseNumber + \" \";\n      }\n      placeString += streetAddress;\n    } else if (residence) {\n      placeString += residence;\n    }\n\n    if (town) {\n      if (placeString) {\n        placeString += \", \";\n      }\n      placeString += town;\n    }\n    if (civilParish && civilParish != town) {\n      if (placeString) {\n        placeString += \", \";\n      }\n      placeString += civilParish;\n    }\n    if (county) {\n      if (placeString) {\n        placeString += \", \";\n      }\n      placeString += county;\n    }\n    if (state) {\n      if (placeString) {\n        placeString += \", \";\n      }\n      placeString += state;\n    }\n    if (country) {\n      if (placeString) {\n        placeString += \", \";\n      }\n      placeString += country;\n    }\n  }\n  result.setEventPlace(placeString);\n\n  if (streetAddress) {\n    if (houseNumber && !streetAddress.startsWith(houseNumber)) {\n      result.eventPlace.streetAddress = houseNumber + \" \" + streetAddress;\n    } else {\n      result.eventPlace.streetAddress = streetAddress;\n    }\n  }\n}\n\nconst ancestryQuarterNames = [\n  {\n    name: \"Jan-Feb-Mar\",\n    value: 1,\n  },\n  {\n    name: \"Apr-May-Jun\",\n    value: 2,\n  },\n  {\n    name: \"Jul-Aug-Sep\",\n    value: 3,\n  },\n  {\n    name: \"Oct-Nov-Dec\",\n    value: 4,\n  },\n];\n\nconst ancestryQuarterMonthNames = [\n  {\n    name: \"Jan\",\n    value: 1,\n  },\n  {\n    name: \"Apr\",\n    value: 2,\n  },\n  {\n    name: \"Jul\",\n    value: 3,\n  },\n  {\n    name: \"Oct\",\n    value: 4,\n  },\n];\n\nfunction generalizeDataGivenRecordType(data, result) {\n  determineRoleGivenRecordType(data, result);\n\n  if (result.recordType == _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.BirthRegistration) {\n    let birthDate = getCleanValueForRecordDataList(data, [\"Birth Date\"], \"date\");\n    if (birthDate) {\n      result.setEventDate(birthDate);\n      result.setBirthDate(birthDate);\n    } else if (result.eventDate) {\n      // result.eventDate may be set from \"Registration Year\"\n      result.birthDate = result.eventDate;\n    }\n\n    let eventPlace = getCleanValueForRecordDataList(data, [\"Birth Registration Place\", \"Registration Place\"]);\n    if (eventPlace) {\n      if (!result.registrationDistrict) {\n        let place = eventPlace;\n        let commaIndex = place.indexOf(`,`);\n        if (commaIndex != -1) {\n          place = place.substring(0, commaIndex);\n        }\n        result.registrationDistrict = place;\n      }\n\n      let county = getCleanRecordDataValue(data, \"Inferred County\");\n      if (county && !eventPlace.includes(county)) {\n        eventPlace += \", \" + county;\n      }\n      result.setEventPlace(eventPlace);\n    } else if (result.registrationDistrict && data.recordData[\"Inferred County\"]) {\n      let eventPlace = result.registrationDistrict;\n      let county = getCleanRecordDataValue(data, \"Inferred County\");\n      if (!eventPlace.includes(county)) {\n        eventPlace += \", \" + county;\n      }\n      result.setEventPlace(eventPlace);\n    }\n    result.lastNameAtBirth = result.inferLastName();\n\n    buildParents(data, result);\n  } else if (result.recordType == _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Birth) {\n    let birthDate = getCleanRecordDataValue(data, \"Birth Date\", \"date\");\n    if (birthDate) {\n      result.setEventDate(birthDate);\n      result.setBirthDate(birthDate);\n    }\n\n    let eventPlace = getCleanValueForRecordDataList(data, [\"Birth Place\", \"Birthplace\", \"Registration Place\"]);\n    if (eventPlace) {\n      result.setBirthPlace(eventPlace);\n      result.setEventPlace(eventPlace);\n    }\n    result.lastNameAtBirth = result.inferLastName();\n    buildParents(data, result);\n\n    if (result.role && result.role == _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.Role.Parent) {\n      let spouseName = getCleanValueForRecordDataList(data, [\"Spouse\"]);\n      if (spouseName) {\n        let name = new _base_core_generalize_data_utils_mjs__WEBPACK_IMPORTED_MODULE_0__.WtsName();\n\n        if (spouseName) {\n          name.name = spouseName;\n        }\n\n        let spouse = {\n          name: name,\n        };\n\n        result.spouses = [spouse];\n      }\n    }\n\n    let mmn = getCleanValueForRecordDataList(data, [\"Mother Maiden Name\"]);\n    if (mmn) {\n      result.mothersMaidenName = mmn;\n    }\n  } else if (result.recordType == _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.DeathRegistration) {\n    let deathDate = getCleanValueForRecordDataList(\n      data,\n      [\"Death Date\", \"Death Registration Date\", \"Death Registration Year\"],\n      \"date\"\n    );\n    if (deathDate) {\n      result.setEventDate(deathDate);\n      result.setDeathDate(deathDate);\n    } else if (result.eventDate) {\n      // result.eventDate may be set from \"Registration Year\"\n      result.deathDate = result.eventDate;\n    }\n\n    let eventPlace = getCleanValueForRecordDataList(data, [\"Death Registration Place\", \"Registration Place\"]);\n    if (eventPlace) {\n      if (!result.registrationDistrict) {\n        let place = eventPlace;\n        let commaIndex = place.indexOf(`,`);\n        if (commaIndex != -1) {\n          place = place.substring(0, commaIndex);\n        }\n        result.registrationDistrict = place;\n      }\n\n      let county = getCleanRecordDataValue(data, \"Inferred County\");\n      if (county && !eventPlace.includes(county)) {\n        eventPlace += \", \" + county;\n      }\n      result.setEventPlace(eventPlace);\n    } else {\n      let eventPlace = getCleanValueForRecordDataList(data, [\"Death Place\", \"Death County\", \"Residence Place\"]);\n      result.setEventPlace(eventPlace);\n    }\n\n    result.lastNameAtDeath = result.inferLastName();\n    result.ageAtDeath = getCleanValueForRecordDataList(data, [\"Age at Death\", \"Death Age\", \"Age\"]);\n\n    // later England Death Registration include exact birth date\n    let birthDate = getCleanValueForRecordDataList(data, [\"Birth Date\"], \"date\");\n    if (birthDate) {\n      result.setBirthDate(birthDate);\n    }\n  } else if (result.recordType == _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Death) {\n    let deathDate = getCleanValueForRecordDataList(\n      data,\n      [\"Death Date\", \"Translated Death Date\", \"Death Date on Image\", \"Death Year\"],\n      \"date\"\n    );\n    if (deathDate) {\n      result.setEventDate(deathDate);\n      result.setDeathDate(deathDate);\n    } else if (result.eventDate) {\n      // result.eventDate may be set from \"Registration Year\"\n      result.deathDate = result.eventDate;\n    }\n\n    let eventPlace = getCleanValueForRecordDataList(data, [\"Death Place\", \"Death County\", \"Death Country\", \"State\"]);\n    result.setEventPlace(eventPlace);\n\n    let residencePlace = getCleanValueForRecordDataList(data, [\n      \"Residence Place\",\n      \"Last Residence Place\",\n      \"Last Residence\",\n      \"Residence\",\n    ]);\n    result.setResidencePlace(residencePlace);\n\n    result.lastNameAtDeath = result.inferLastName();\n\n    let maidenName = getCleanValueForRecordDataList(data, [\"Maiden Name\"]);\n    if (maidenName) {\n      result.lastNameAtBirth = maidenName;\n    }\n\n    let ageAtDeath = getCleanValueForRecordDataList(data, [\"Age at Death\", \"Death Age\", \"Age\"]);\n    if (ageAtDeath) {\n      result.ageAtDeath = ageAtDeath;\n    }\n\n    // later England Death Registration include exact birth date\n    let birthDate = getCleanValueForRecordDataList(data, [\"Birth Date\", \"Birth Year\"], \"date\");\n    if (birthDate) {\n      result.setBirthDate(birthDate);\n    }\n\n    buildParents(data, result);\n  } else if (result.recordType == _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Census) {\n    function buildHouseholdArray() {\n      const stdFieldNames = [\n        {\n          stdName: \"name\",\n          ancestryHeadings: [\"Name\", \"Household Members\", \"Household Member(s)\", \"Household Members (Name)\"],\n        },\n        { stdName: \"age\", ancestryHeadings: [\"Age\"] },\n        { stdName: \"relationship\", ancestryHeadings: [\"Relationship\"] },\n      ];\n      function headingToStdName(heading) {\n        for (let entry of stdFieldNames) {\n          if (entry.ancestryHeadings.includes(heading)) {\n            return entry.stdName;\n          }\n        }\n      }\n      if (data.household && data.household.members && data.household.members.length > 0) {\n        let headings = data.household.headings;\n        let members = data.household.members;\n        if (headings && members) {\n          result.householdArrayFields = [];\n\n          // check that we have a heading that maps to name, if not we do some extra work later\n          let haveANameHeading = false;\n          for (let heading of headings) {\n            let fieldName = headingToStdName(heading);\n            if (fieldName && fieldName == \"name\") {\n              haveANameHeading = true;\n              break;\n            }\n          }\n\n          let householdArray = [];\n          for (let member of members) {\n            let householdMember = {};\n            if (member.isClosed) {\n              householdMember.isClosed = true;\n            } else {\n              for (let headingIndex = 0; headingIndex < headings.length; headingIndex++) {\n                let heading = headings[headingIndex];\n                let fieldName = headingToStdName(heading);\n\n                // This could be the name column as Ancestry keeps changing its name\n                if (!fieldName && !haveANameHeading && headingIndex == 0) {\n                  fieldName = \"name\";\n                }\n                if (fieldName) {\n                  let fieldValue = member[heading];\n                  if (fieldValue) {\n                    if (fieldName == \"relationship\") {\n                      fieldValue = _base_core_generalize_data_utils_mjs__WEBPACK_IMPORTED_MODULE_0__.GD.standardizeRelationshipToHead(fieldValue);\n                    }\n                    householdMember[fieldName] = fieldValue;\n                  }\n                }\n              }\n              let isSelected = false;\n              if (!member.recordId || member.recordId == data.recordId) {\n                isSelected = true;\n              }\n              if (isSelected) {\n                householdMember.isSelected = isSelected;\n\n                setExtraGdHouseholdFields(data, householdMember, result.householdArrayFields);\n              }\n              if (member.link) {\n                // we need a way of comparing back to extractedData when we\n                // fetch additional records\n                householdMember.uid = member.link;\n              }\n            }\n            householdArray.push(householdMember);\n          }\n          result.householdArray = householdArray;\n\n          let householdArrayFields = [];\n          for (let headingIndex = 0; headingIndex < headings.length; headingIndex++) {\n            let heading = headings[headingIndex];\n            let fieldName = headingToStdName(heading);\n\n            // This could be the name column as Ancestry keeps changing its name\n            if (!fieldName && !haveANameHeading && headingIndex == 0) {\n              fieldName = \"name\";\n            }\n\n            if (fieldName) {\n              householdArrayFields.push(fieldName);\n            }\n          }\n          result.householdArrayFields = householdArrayFields;\n        }\n      }\n    }\n\n    if (data.titleCollection && data.titleCollection.includes(\"1939\")) {\n      result.setEventYear(\"1939\");\n\n      let birthDate = getCleanValueForRecordDataList(data, [\"Birth Date\"], \"date\");\n      result.setBirthDate(birthDate);\n\n      let maritalStatus = getCleanValueForRecordDataList(data, [\"Marital Status\", \"Marital status\"]);\n      result.setMaritalStatus(maritalStatus);\n\n      let streetAddress = getCleanRecordDataValue(data, \"Address\");\n      let place = getCleanRecordDataValue(data, \"Residence Place\");\n      let placeString = \"\";\n      if (streetAddress) {\n        placeString += streetAddress;\n      }\n      if (place) {\n        if (placeString) {\n          placeString += \", \";\n        }\n        placeString += place;\n      }\n      result.setEventPlace(placeString);\n\n      let occupation = getCleanRecordDataValue(data, \"Occupation\");\n      if (occupation && occupation != \"None\") {\n        result.occupation = occupation;\n      }\n\n      let positionInHousehold = getCleanRecordDataValue(data, \"Sub Schedule Number\");\n      if (positionInHousehold) {\n        if (positionInHousehold == 1) {\n          result.relationshipToHead = \"head\";\n        }\n      }\n\n      buildHouseholdArray();\n    } else {\n      let birthYear = getCleanValueForRecordDataList(data, [\"Estimated Birth Year\", \"Birth Year\"]);\n\n      if (birthYear) {\n        let estYear = birthYear;\n        if (estYear.startsWith(\"abt \")) {\n          estYear = estYear.substring(4);\n        }\n        result.setBirthYear(estYear);\n        result.birthDate.qualifier = _base_core_generalize_data_utils_mjs__WEBPACK_IMPORTED_MODULE_0__.dateQualifiers.ABOUT;\n      }\n\n      let birthPlace = getCleanValueForRecordDataList(data, [\n        \"Where born\",\n        \"Where Born\",\n        \"Birth Place\",\n        \"Birth place\",\n        \"Birthplace\",\n      ]);\n      if (birthPlace) {\n        result.setBirthPlace(birthPlace);\n      }\n\n      if (!result.eventDate || (!result.eventDate.dateString && !result.eventDate.yearString)) {\n        // see if we can get the census year from a field\n        let yearString = getCleanValueForRecordDataList(data, [\"Enumeration Year\", \"Residence Year\", \"Census Year\"]);\n        if (yearString) {\n          result.setEventYear(yearString);\n        } else {\n          let dateString = getCleanValueForRecordDataList(data, [\"Enumeration Date\", \"Residence Date\", \"Census Date\"]);\n          if (dateString) {\n            result.setEventDate(dateString);\n          } else if (data.titleCollection) {\n            // extract the year from the collection title, if it is a range treat that specially\n            let yearRangeString = data.titleCollection.replace(/^.*(\\d\\d\\d\\d\\-\\d\\d\\d\\d).*$/, \"$1\");\n            if (yearRangeString && yearRangeString != data.titleCollection) {\n              result.setEventYear(yearRangeString);\n            } else {\n              yearString = data.titleCollection.replace(/^.*(\\d\\d\\d\\d).*$/, \"$1\");\n              if (yearString && yearString != data.titleCollection) {\n                result.setEventYear(yearString);\n              }\n            }\n          }\n        }\n      }\n\n      buildEventPlace(data, result, true);\n\n      let occupation = getCleanRecordDataValue(data, \"Occupation\");\n      if (occupation && occupation != \"None\") {\n        result.occupation = occupation;\n      }\n\n      let age = getCleanValueForRecordDataList(data, [\"Age\"]);\n      if (!age) {\n        if (result.eventDate && result.eventDate.yearString) {\n          let label = \"Age in \" + result.eventDate.yearString;\n          age = getCleanRecordDataValue(data, label);\n        }\n      }\n      if (age) {\n        result.ageAtEvent = age;\n      }\n      let maritalStatus = getCleanValueForRecordDataList(data, [\"Marital Status\", \"Marital status\"]);\n      result.setMaritalStatus(maritalStatus);\n      let relationshipToHead = getCleanValueForRecordDataList(data, [\n        \"Relationship to Head\",\n        \"Relation to Head\",\n        \"Relation to Head of House\",\n        \"Relationship\",\n        \"Relation\",\n      ]);\n\n      result.setRelationshipToHead(relationshipToHead);\n\n      buildHouseholdArray();\n\n      // We can also determine parents and spouse in some cases\n      // Note: This is a bit limited for Ancestry because we do not do the deep dive of fetching other\n      // records unless we are building a household table.\n      result.addSpouseOrParentsForSelectedHouseholdMember();\n    }\n  } else if (result.recordType == _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.NonpopulationCensus) {\n    result.setEventDate(getCleanValueForRecordDataList(data, [\"Enumeration Date\"], \"date\"));\n    result.setEventPlace(getCleanValueForRecordDataList(data, [\"Place\"]));\n  } else if (result.recordType == _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Marriage) {\n    result.setEventDate(\n      getCleanValueForRecordDataList(\n        data,\n        [\n          \"Marriage Date\",\n          \"Marriage or Bann Date\",\n          \"Marriage Banns Date\",\n          \"Marriage License Date\",\n          \"Bond Date\",\n          \"Recording Date\",\n          \"License Date\",\n          \"Event Date\",\n          \"Translated Marriage Date\",\n          \"Marriage Year\",\n          \"Marriage Date on Image\",\n        ],\n        \"date\"\n      )\n    );\n\n    let marriagePlace = getCleanValueForRecordDataList(data, [\n      \"Marriage Place\",\n      \"Marriage or Bann Place\",\n      \"Marriage Banns Place\",\n      \"Marriage License Place\",\n      \"Recording Place\",\n      \"License Place\",\n      \"Marriage State\",\n      \"Marriage City\",\n    ]);\n    if (marriagePlace) {\n      result.setEventPlace(marriagePlace);\n    } else {\n      buildEventPlace(data, result);\n    }\n    result.setFieldIfValueExists(\"ageAtEvent\", getCleanValueForRecordDataList(data, [\"Marriage Age\", \"Age\"]));\n    buildParents(data, result);\n\n    let spouseName = getCleanValueForRecordDataList(data, [\"Spouse\", \"Spouse Name\", \"Spouse's Name\"]);\n\n    // occasionally there is no field for the spouse name but there is a Household Members sections\n    // that lists the bride and groom. us_pa_marriage_1761_patience_brown is an example.\n    if (!spouseName) {\n      if (data.household && data.household.headings && data.household.members) {\n        if (data.household.headings[0] == \"Name\" && data.household.headings[1] == \"Role\") {\n          if (data.household.members.length >= 2) {\n            let thisPersonRole = data.recordData[\"Role\"];\n            if (thisPersonRole) {\n              for (let member of data.household.members) {\n                let role = member.Role;\n                if (role != thisPersonRole && (role == \"Bride\" || role == \"Groom\")) {\n                  if (member.Name) {\n                    spouseName = member.Name;\n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n\n    if ((spouseName || result.eventDate) && (!result.role || result.role == _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.Role.Primary)) {\n      let name = new _base_core_generalize_data_utils_mjs__WEBPACK_IMPORTED_MODULE_0__.WtsName();\n\n      if (spouseName) {\n        name.name = spouseName;\n      }\n\n      let spouse = {\n        name: name,\n      };\n\n      if (result.eventDate) {\n        spouse.marriageDate = result.eventDate;\n      }\n\n      if (result.eventPlace) {\n        spouse.marriagePlace = result.eventPlace;\n      }\n\n      let spouseAge = getCleanValueForRecordDataList(data, [\"Spouse's Age\"]);\n      if (spouseAge) {\n        spouse.age = spouseAge;\n      }\n\n      result.spouses = [spouse];\n\n      if (result.personGender == \"female\") {\n        result.lastNameAtDeath = name.inferLastName();\n      }\n    }\n  } else if (result.recordType == _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.MarriageRegistration) {\n    result.setEventDate(\n      getCleanValueForRecordDataList(\n        data,\n        [\n          \"Marriage Registration Date\",\n          \"Marriage Registration Year\",\n          \"Marriage Date\",\n          \"Marriage License Date\",\n          \"Marriage Year\",\n        ],\n        \"date\"\n      )\n    );\n\n    let marriageRegistrationPlace = getCleanValueForRecordDataList(data, [\n      \"Marriage Registration Place\",\n      \"Registration Place\",\n    ]);\n    if (marriageRegistrationPlace && !result.registrationDistrict) {\n      let place = marriageRegistrationPlace;\n      let commaIndex = place.indexOf(`,`);\n      if (commaIndex != -1) {\n        place = place.substring(0, commaIndex);\n      }\n      result.registrationDistrict = place;\n    }\n\n    let marriagePlace = getCleanValueForRecordDataList(data, [\n      \"Marriage Registration Place\",\n      \"Marriage Place\",\n      \"Registration Place\",\n    ]);\n    if (marriagePlace) {\n      result.setEventPlace(marriagePlace);\n    } else {\n      buildEventPlace(data, result);\n    }\n    result.setFieldIfValueExists(\"ageAtEvent\", getCleanValueForRecordDataList(data, [\"Marriage Age\", \"Age\"]));\n\n    let spouseName = getCleanValueForRecordDataList(data, [\"Spouse\", \"Spouse Name\"]);\n\n    if (!spouseName) {\n      // For a UK marriage registration, if there are only two records on page, we can infer spouse\n      if (data.recordData) {\n        let records = data.recordData[\"Records on Page\"];\n        let name = data.recordData[\"Name\"];\n        if (records && name) {\n          if (records.includes(\"<br/>\")) {\n            let names = records.split(\"<br/>\");\n            if (names.length == 2) {\n              if (names[0] == name) {\n                spouseName = names[1];\n              } else if (names[1] == name) {\n                spouseName = names[0];\n              }\n            }\n          }\n        }\n      }\n    }\n    if (spouseName || result.eventDate) {\n      let name = new _base_core_generalize_data_utils_mjs__WEBPACK_IMPORTED_MODULE_0__.WtsName();\n\n      if (spouseName) {\n        name.name = spouseName;\n      }\n\n      let spouse = {\n        name: name,\n      };\n\n      if (result.eventDate) {\n        spouse.marriageDate = result.eventDate;\n      }\n\n      if (result.eventPlace) {\n        spouse.marriagePlace = result.eventPlace;\n      }\n\n      result.spouses = [spouse];\n\n      if (result.personGender == \"female\") {\n        result.lastNameAtDeath = name.inferLastName();\n      }\n    }\n  } else if (result.recordType == _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Baptism) {\n    let birthDate = getCleanRecordDataValue(data, \"Birth Date\", \"date\");\n    let baptismDate = getCleanValueForRecordDataList(data, [\"Baptism Date\", \"Christening Date\"], \"date\");\n    if (birthDate) {\n      result.setBirthDate(birthDate);\n    }\n    if (baptismDate) {\n      result.setEventDate(baptismDate);\n    }\n\n    // occasionally a baptism record also has a death date (usually for an infant death)\n    result.setDeathDate(getCleanRecordDataValue(data, \"Death Date\", \"date\"));\n\n    let eventPlace = getCleanValueForRecordDataList(data, [\"Baptism Place\", \"Christening Place\", \"Parish\"]);\n    if (eventPlace) {\n      result.setEventPlace(eventPlace);\n      result.setBirthPlace(eventPlace);\n    }\n    result.lastNameAtBirth = result.inferLastName();\n\n    let age = getCleanValueForRecordDataList(data, [\"Age\", \"Baptism Age\", \"Christening Age\"]);\n    if (age) {\n      result.ageAtEvent = age;\n    }\n\n    let fatherName = getCleanRecordDataValue(data, \"Father\");\n    if (fatherName) {\n      let father = result.addFather();\n      father.name.name = fatherName;\n    }\n    let motherName = getCleanRecordDataValue(data, \"Mother\");\n    if (motherName) {\n      let mother = result.addMother();\n      mother.name.name = motherName;\n    }\n  } else if (result.recordType == _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Burial) {\n    let birthDate = getCleanRecordDataValue(data, \"Birth Date\", \"date\");\n    let deathDate = getCleanRecordDataValue(data, \"Death Date\", \"date\");\n    let eventDate = getCleanValueForRecordDataList(\n      data,\n      [\"Burial Date\", \"Burial or Cremation Date\", \"Interment Date\", \"Burial Year\"],\n      \"date\"\n    );\n\n    if (birthDate) {\n      result.setBirthDate(birthDate);\n    }\n    if (deathDate) {\n      result.setDeathDate(deathDate);\n    }\n    if (eventDate) {\n      result.setEventDate(eventDate);\n    }\n\n    let eventPlace = getCleanValueForRecordDataList(data, [\n      \"Burial Place\",\n      \"Burial or Cremation Place\",\n      \"Interment Place\",\n      \"Cemetery Location\",\n      \"Cemetery Name\",\n      \"Cemetery\",\n    ]);\n    let largerPlace = getCleanValueForRecordDataList(data, [\"Location\"]);\n    if (largerPlace) {\n      if (!eventPlace) {\n        eventPlace = largerPlace;\n      } else if (eventPlace != largerPlace) {\n        eventPlace = eventPlace + \", \" + largerPlace;\n      }\n    }\n    if (eventPlace) {\n      result.setEventPlace(eventPlace);\n      result.setDeathPlace(eventPlace);\n    }\n    result.lastNameAtDeath = result.inferLastName();\n\n    let age = getCleanRecordDataValue(data, \"Age\");\n    if (age) {\n      result.ageAtDeath = age;\n    }\n  } else if (result.recordType == _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Cremation) {\n    let birthDate = getCleanRecordDataValue(data, \"Birth Date\", \"date\");\n    let deathDate = getCleanRecordDataValue(data, \"Death Date\", \"date\");\n    let eventDate = getCleanValueForRecordDataList(data, [\"Cremation Date\", \"Burial or Cremation Date\"], \"date\");\n\n    if (birthDate) {\n      result.setBirthDate(birthDate);\n    }\n    if (deathDate) {\n      result.setDeathDate(deathDate);\n    }\n    if (eventDate) {\n      result.setEventDate(eventDate);\n    }\n\n    let eventPlace = getCleanValueForRecordDataList(data, [\n      \"Cremation Place\",\n      \"Burial or Cremation Place\",\n      \"Burial Place\",\n    ]);\n    if (eventPlace) {\n      result.setEventPlace(eventPlace);\n      result.setDeathPlace(eventPlace);\n    }\n    result.lastNameAtDeath = result.inferLastName();\n\n    let age = getCleanRecordDataValue(data, \"Age\");\n    if (age) {\n      result.ageAtDeath = age;\n    }\n  } else if (result.recordType == _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Obituary) {\n    // if there is a death or burial date etc then this is likely a record for this person not a\n    // child or spouse\n    let birthDate = getCleanValueForRecordDataList(data, [\"Birth Date\"], \"date\");\n    let deathDate = getCleanValueForRecordDataList(data, [\"Death Date\"], \"date\");\n    let deathPlace = getCleanValueForRecordDataList(data, [\"Death Place\", \"Death County\"]);\n    let eventDate = getCleanValueForRecordDataList(data, [\"Obituary Date\", \"Date\", \"Newspaper Date\"], \"date\");\n    let eventPlace = getCleanValueForRecordDataList(data, [\"Obituary Place\", \"Newspaper Place\", \"Place\"]);\n\n    if (birthDate) {\n      result.setBirthDate(birthDate);\n    }\n    if (deathDate) {\n      result.setDeathDate(deathDate);\n    }\n    if (deathPlace) {\n      result.setDeathPlace(deathPlace);\n    }\n    if (eventDate) {\n      result.setEventDate(eventDate);\n    }\n    if (eventPlace) {\n      result.setEventPlace(eventPlace);\n    }\n    result.lastNameAtDeath = result.inferLastName();\n\n    let age = getCleanValueForRecordDataList(data, [\"Age\", \"Death Age\"]);\n    if (age) {\n      result.ageAtDeath = age;\n    }\n  } else if (result.recordType == _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Will || result.recordType == _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Probate) {\n    result.setDeathDate(getCleanRecordDataValue(data, \"Death Date\", \"date\"));\n    result.setDeathYear(getCleanRecordDataValue(data, \"Death Year\"));\n    result.setEventDate(\n      getCleanValueForRecordDataList(data, [\"Probate Date\", \"Will Proved Date\", \"Grant Date\"], \"date\")\n    );\n    result.setEventYear(getCleanRecordDataValue(data, \"Probate Year\"));\n\n    if (result.recordType == _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Will) {\n      result.recordSubtype = \"Probate\"; // for now assume Ancestry Will records have probate date\n    }\n\n    let eventPlace = getCleanValueForRecordDataList(data, [\"Probate Registry\"]);\n    if (eventPlace) {\n      result.setEventPlace(eventPlace);\n    }\n    let deathPlace = getCleanValueForRecordDataList(data, [\"Residence\", \"Death Place\", \"Death County\"]);\n    if (deathPlace) {\n      result.setDeathPlace(deathPlace);\n    }\n\n    let role = getCleanRecordDataValue(data, \"Role\");\n    if (role) {\n      // Primary person's role field may be \"Decedent\"\n      if (role == \"Child\" || role == \"Daughter\" || role == \"Son\") {\n        result.role = _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.Role.Child;\n      } else if (role == \"Parent\" || role == \"Father\" || role == \"Mother\") {\n        result.role = _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.Role.Parent;\n      } else if (role == \"Spouse\" || role == \"Husband\" || role == \"Wife\") {\n        result.role = _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.Role.Spouse;\n      } else if (role == \"Witness\") {\n        result.role = _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.Role.Witness;\n      }\n    }\n\n    // Some probate records have occupation (e.g. Victoria, Australia, Wills and Probate Records, 1841-2009)\n    let occupation = getCleanRecordDataValue(data, \"Occupation\");\n    if (occupation && occupation != \"None\") {\n      result.occupation = occupation;\n    }\n\n    result.lastNameAtDeath = result.inferLastName();\n  } else if (result.recordType == _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Divorce) {\n    result.setEventDate(getCleanValueForRecordDataList(data, [\"Divorce Date\", \"Petition Date\", \"Date\"], \"date\"));\n    result.setEventPlace(getCleanValueForRecordDataList(data, [\"Divorce Place\", \"Location\"]));\n\n    let spouseName = getCleanValueForRecordDataList(data, [\"Spouse\", \"Spouse Name\"]);\n\n    if (spouseName) {\n      let name = new _base_core_generalize_data_utils_mjs__WEBPACK_IMPORTED_MODULE_0__.WtsName();\n      name.name = spouseName;\n      let spouse = {\n        name: name,\n      };\n\n      let marriageDate = getCleanValueForRecordDataList(data, [\"Marriage Date\", \"Marriage Year\"], \"date\");\n      if (marriageDate) {\n        spouse.marriageDate = new _base_core_generalize_data_utils_mjs__WEBPACK_IMPORTED_MODULE_0__.WtsDate();\n        spouse.marriageDate.dateString = marriageDate;\n      }\n\n      result.spouses = [spouse];\n    }\n  } else if (result.recordType == _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.BirthOrBaptism) {\n    let birthDate = getCleanRecordDataValue(data, \"Birth Date\", \"date\");\n    let baptismDate = getCleanValueForRecordDataList(data, [\"Baptism Date\", \"Christening Date\"], \"date\");\n    if (birthDate) {\n      result.setBirthDate(birthDate);\n    }\n    if (baptismDate) {\n      result.setEventDate(baptismDate);\n    } else if (birthDate) {\n      result.setEventDate(birthDate);\n    }\n\n    // occasionally a baptism record also has a death date (usually for an infant death)\n    result.setDeathDate(getCleanRecordDataValue(data, \"Death Date\", \"date\"));\n\n    let eventPlace = getCleanValueForRecordDataList(data, [\"Baptism Place\", \"Christening Place\", \"Birth Place\"]);\n    if (eventPlace) {\n      result.setEventPlace(eventPlace);\n      result.setBirthPlace(eventPlace);\n    }\n    result.lastNameAtBirth = result.inferLastName();\n\n    let age = getCleanValueForRecordDataList(data, [\"Age\", \"Baptism Age\", \"Christening Age\"]);\n    if (age) {\n      result.ageAtEvent = age;\n    }\n\n    if (result.role != _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.Role.Parent) {\n      let fatherName = getCleanRecordDataValue(data, \"Father\");\n      if (fatherName) {\n        let father = result.addFather();\n        father.name.name = fatherName;\n      }\n      let motherName = getCleanRecordDataValue(data, \"Mother\");\n      if (motherName) {\n        let mother = result.addMother();\n        mother.name.name = motherName;\n      }\n    }\n  } else if (result.recordType == _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Military) {\n    result.setEventDate(\n      getCleanValueForRecordDataList(\n        data,\n        [\n          \"Event Date\",\n          \"Date\",\n          \"Enlistment Date\",\n          \"Service Start Date\",\n          \"First Service Date\",\n          \"Service Date\",\n          \"Last Service Date\",\n          \"Muster Date\",\n          \"Military Date\",\n          \"Residence Date\",\n        ],\n        \"date\"\n      )\n    );\n    result.setBirthDate(getCleanValueForRecordDataList(data, [\"Birth Date\"], \"date\"));\n    result.setDeathDate(getCleanValueForRecordDataList(data, [\"Death Date\"], \"date\"));\n    result.setEventYear(\n      getCleanValueForRecordDataList(data, [\n        \"Event Year\",\n        \"Year\",\n        \"Enlistment Year\",\n        \"Service Year\",\n        \"Year Range\",\n        \"Year range\",\n      ])\n    );\n    result.setEventPlace(\n      getCleanValueForRecordDataList(data, [\n        \"Event Place\",\n        \"Death Place\",\n        \"Place\",\n        \"Location\",\n        \"Enlistment Place\",\n        \"Residence\",\n        \"Residence Place\",\n        \"Residence Location\",\n        \"Military Enlistment Place\",\n        \"Service Start Place\",\n        \"Military Service Location\",\n        \"Pension Office Place\",\n        \"Military Place\",\n        \"Station or Residence Place\",\n        \"State or Territory\",\n      ])\n    );\n\n    let dischargeDate = getCleanValueForRecordDataList(data, [\"Discharge Date\"], \"date\");\n    if (dischargeDate) {\n      result.dischargeDate = dischargeDate;\n    }\n\n    let serviceNumber = getCleanValueForRecordDataList(data, [\"Service Number\", \"Regimental Number\"]);\n    if (serviceNumber) {\n      result.serviceNumber = serviceNumber;\n    }\n    let rank = getCleanValueForRecordDataList(data, [\"Rank\"]);\n    if (rank) {\n      result.rank = rank;\n    }\n    let unit = getCleanValueForRecordDataList(data, [\"Corps, Regiment or Unit\", \"Regiment\", \"Military Unit\", \"Unit\"]);\n    if (unit) {\n      result.unit = unit;\n    }\n    let militaryBranch = getCleanValueForRecordDataList(data, [\"Enlistment Branch\", \"Branch of Service\"]);\n    if (militaryBranch) {\n      result.militaryBranch = militaryBranch;\n    }\n    let nextOfKin = getCleanValueForRecordDataList(data, [\"Next of Kin\"]);\n    if (nextOfKin) {\n      result.nextOfKin = nextOfKin;\n    }\n\n    // sometimes a military record can contain a spouse name and possibly a marriage date\n    let spouseName = getCleanValueForRecordDataList(data, [\"Spouse\", \"Spouse Name\", \"Spouse's Name\"]);\n    if (spouseName) {\n      let name = new _base_core_generalize_data_utils_mjs__WEBPACK_IMPORTED_MODULE_0__.WtsName();\n      name.name = spouseName;\n\n      let spouse = {\n        name: name,\n      };\n\n      let marriageDate = getCleanValueForRecordDataList(data, [\"Marriage Date\"]);\n      let marriagePlace = getCleanValueForRecordDataList(data, [\"Marriage Place\"]);\n\n      if (marriageDate) {\n        spouse.marriageDate = new _base_core_generalize_data_utils_mjs__WEBPACK_IMPORTED_MODULE_0__.WtsDate();\n        spouse.marriageDate.dateString = marriageDate;\n      }\n\n      if (marriagePlace) {\n        spouse.marriagePlace = new _base_core_generalize_data_utils_mjs__WEBPACK_IMPORTED_MODULE_0__.WtsPlace();\n        spouse.marriagePlace.placeString = marriagePlace;\n      }\n\n      result.spouses = [spouse];\n    }\n  } else if (result.recordType == _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.SchoolRecords) {\n    result.setEventDate(getCleanValueForRecordDataList(data, [\"Yearbook Date\", \"Admission Date\"], \"date\"));\n\n    result.setBirthDate(getCleanValueForRecordDataList(data, [\"Birth Date\"], \"date\"));\n    result.setBirthYear(getCleanValueForRecordDataList(data, [\"Birth Year\"]));\n\n    let schoolLocation = getCleanValueForRecordDataList(data, [\"School Location\"]);\n    let schoolName = getCleanValueForRecordDataList(data, [\"School\"]);\n\n    result.setEventPlace(schoolLocation);\n\n    if (schoolName) {\n      result.schoolName = schoolName;\n    }\n\n    let age = getCleanValueForRecordDataList(data, [\"Age\", \"Estimated Age\"]);\n    if (age) {\n      result.ageAtEvent = age;\n    }\n\n    let fatherName = getCleanRecordDataValue(data, \"Father\");\n    if (fatherName) {\n      let father = result.addFather();\n      father.name.name = fatherName;\n    }\n    let motherName = getCleanRecordDataValue(data, \"Mother\");\n    if (motherName) {\n      let mother = result.addMother();\n      mother.name.name = motherName;\n    }\n  } else if (result.recordType == _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.PassengerList) {\n    let departureDate = getCleanValueForRecordDataList(data, [\"Departure Date\", \"Departure Year\"], \"date\");\n    let arrivalDate = getCleanValueForRecordDataList(data, [\"Arrival Date\", \"Arrival Year\", \"Arrival year\"], \"date\");\n    let departurePlace = getCleanValueForRecordDataList(data, [\"Departure Place\"]);\n    let arrivalPlace = getCleanValueForRecordDataList(data, [\"Arrival Place\", \"Arrival Country\"]);\n\n    result.setFieldIfValueExists(\"departureDate\", departureDate);\n    result.setFieldIfValueExists(\"departurePlace\", departurePlace);\n    result.setFieldIfValueExists(\"arrivalDate\", arrivalDate);\n    result.setFieldIfValueExists(\"arrivalPlace\", arrivalPlace);\n\n    if (data.titleCollection.toLowerCase().includes(\"arriv\")) {\n      result.setEventDate(arrivalDate);\n      result.setEventPlace(arrivalPlace);\n    } else if (data.titleCollection.toLowerCase().includes(\"depart\")) {\n      result.setEventDate(departureDate);\n      result.setEventPlace(departurePlace);\n    } else if (arrivalDate || arrivalPlace) {\n      result.setEventDate(arrivalDate);\n      result.setEventPlace(arrivalPlace);\n    } else if (departureDate || departurePlace) {\n      result.setEventDate(departureDate);\n      result.setEventPlace(departurePlace);\n    }\n\n    result.setFieldIfValueExists(\"shipName\", getCleanValueForRecordDataList(data, [\"Ship\"]));\n\n    result.setFieldIfValueExists(\n      \"ageAtEvent\",\n      getCleanValueForRecordDataList(data, [\"Age\", \"Departure Age\", \"Arrival Age\"])\n    );\n  } else if (result.recordType == _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Naturalization) {\n    result.setEventDate(\n      getCleanValueForRecordDataList(\n        data,\n        [\"Event Date\", \"Date\", \"Petition Date\", \"Declaration Date\", \"Certificate Date\"],\n        \"date\"\n      )\n    );\n    result.setEventPlace(\n      getCleanValueForRecordDataList(data, [\n        \"Petition Place\",\n        \"Declaration Place\",\n        \"Event Place\",\n        \"Place\",\n        \"Location\",\n        \"Residence\",\n        \"Residence Place\",\n        \"Residence Location\",\n        \"Naturalisation Place\",\n        \"Arrival Place\",\n      ])\n    );\n    let ageAtEvent = getCleanValueForRecordDataList(data, [\"Age\", \"Petition Age\", \"Declaration Age\"]);\n    if (ageAtEvent) {\n      result.ageAtEvent = ageAtEvent;\n    }\n    result.setBirthDate(getCleanValueForRecordDataList(data, [\"Birth Date\"], \"date\"));\n    result.setBirthPlace(getCleanValueForRecordDataList(data, [\"Birth Place\"]));\n    let arrivalDate = getCleanValueForRecordDataList(data, [\"Arrival Date\"]);\n    if (arrivalDate) {\n      result.arrivalDate = arrivalDate;\n    }\n    let arrivalPlace = getCleanValueForRecordDataList(data, [\"Arrival Place\"]);\n    if (arrivalPlace) {\n      result.arrivalPlace = arrivalPlace;\n    }\n    let nativePlace = getCleanValueForRecordDataList(data, [\"Native Place\"]);\n    if (nativePlace) {\n      result.nativePlace = nativePlace;\n    }\n  } else {\n    // generic record type support\n    result.setEventDate(\n      getCleanValueForRecordDataList(\n        data,\n        [\n          \"Event Date\",\n          \"Date\",\n          \"Residence Date\",\n          \"Payment Date\",\n          \"Obituary Date\",\n          \"Departure Date\",\n          \"Arrival Date\",\n          \"Electoral Date\",\n          \"Appointed Date\",\n          \"Application Date\",\n          \"Warrant Date\",\n          \"Issue Date\",\n          \"Appointment Date\",\n          \"Discharge Date\",\n          \"Death Date\",\n          \"Hire Date\",\n          \"Record Date\",\n          \"Arrival Year\",\n          \"Date Received\",\n          \"Passport Issue Date\",\n        ],\n        \"date\"\n      )\n    );\n    result.setEventYear(\n      getCleanValueForRecordDataList(data, [\n        \"Event Year\",\n        \"Year\",\n        \"Publication Year\",\n        \"Enlistment Year\",\n        \"Residence Year\",\n      ])\n    );\n    let eventPlace = getCleanValueForRecordDataList(data, [\n      \"Obituary Place\",\n      \"Event Place\",\n      \"Place\",\n      \"Location\",\n      \"Residence\",\n      \"Residence Place\",\n      \"Residence Location\",\n      \"Military Enlistment Place\",\n      \"Departure Place\",\n      \"Arrival Place\",\n      \"Appointed Place\",\n      \"Death Place\",\n      \"Warrant Location\",\n      \"Last Residence Place\",\n      \"Issue Port\",\n      \"Post Office Location\",\n      \"Record Place\",\n      \"Place Moored\",\n      \"Electoral Place\",\n      \"Death County\",\n    ]);\n\n    if (!eventPlace) {\n      if (true) {\n        // trying this out instead (2 Apr 2022)\n        buildEventPlace(data, result, true);\n      }\n    }\n\n    result.setEventPlace(eventPlace);\n\n    // lots of record have a birth date. The narrative may not use it but search can.\n    result.setBirthDate(getCleanValueForRecordDataList(data, [\"Birth Date\"], \"date\"));\n    result.setBirthPlace(getCleanValueForRecordDataList(data, [\"Birth Place\"]));\n\n    let ageAtEvent = getCleanValueForRecordDataList(data, [\"Age\", \"Departure Age\", \"Arrival Age\"]);\n    if (ageAtEvent) {\n      result.ageAtEvent = ageAtEvent;\n    }\n  }\n}\n\n// This function generalizes the data extracted from an Ancestry page.\n// We know what fields can be there. And we know the ones we want in generalizedData.\nfunction generalizeRecordData(input, result) {\n  let data = input.extractedData;\n\n  result.sourceType = \"record\";\n  determineRecordTypeAndRole(data, result);\n\n  result.sourceOfData = \"ancestry\";\n\n  // from an Ancestry record we often do not have the name broken down into parts.\n  let fullName = data.titleName;\n  if (!fullName && data.recordData) {\n    fullName = getCleanRecordDataValue(data, \"Name\");\n  }\n\n  result.setFullName(fullName);\n\n  if (data.recordData != undefined) {\n    result.setPersonGender(getCleanRecordDataValue(data, \"Gender\"));\n\n    result.setEventCountry(getCleanRecordDataValue(data, \"Country\"));\n    result.setEventCounty(getCleanValueForRecordDataList(data, [\"County\", \"Inferred County\"]));\n\n    let registrationDate = getCleanValueForRecordDataList(data, [\"Registration Date\", \"Date of Registration\"], \"date\");\n    if (registrationDate) {\n      // special case, date could be of form \"1933 Jan-Feb-Mar\"\n      // e.g. https://www.ancestry.com/discoveryui-content/view/6407416:2534\n      if (/^\\d\\d\\d\\d +\\w\\w\\w\\-\\w\\w\\w\\-\\w\\w\\w$/.test(registrationDate)) {\n        let yearString = registrationDate.replace(/^(\\d\\d\\d\\d) +\\w\\w\\w\\-\\w\\w\\w\\-\\w\\w\\w$/, \"$1\");\n        let ancestryQuarter = registrationDate.replace(/^\\d\\d\\d\\d +(\\w\\w\\w\\-\\w\\w\\w\\-\\w\\w\\w)$/, \"$1\");\n        if (yearString && yearString != registrationDate && ancestryQuarter && ancestryQuarter != registrationDate) {\n          let quarter = -1;\n          for (let quarterName of ancestryQuarterNames) {\n            if (ancestryQuarter == quarterName.name) {\n              quarter = quarterName.value;\n              break;\n            }\n          }\n          if (quarter != -1) {\n            result.setEventYear(yearString);\n            result.setEventQuarter(quarter);\n          }\n        }\n      } else {\n        result.setEventDate(registrationDate);\n      }\n    } else {\n      let registrationYear = getCleanRecordDataValue(data, \"Registration Year\");\n      if (registrationYear) {\n        result.setEventYear(registrationYear);\n      }\n    }\n\n    let registrationDistrict = getCleanValueForRecordDataList(data, [\"Registration District\", \"Registration district\"]);\n    if (registrationDistrict) {\n      result.registrationDistrict = registrationDistrict;\n    }\n\n    let ancestryQuarter = getCleanValueForRecordDataList(data, [\"Registration Quarter\", \"Quarter of the Year\"]);\n    if (ancestryQuarter) {\n      let quarter = -1;\n      for (let quarterName of ancestryQuarterNames) {\n        if (ancestryQuarter == quarterName.name) {\n          quarter = quarterName.value;\n          break;\n        }\n      }\n      if (quarter != -1) {\n        result.setEventQuarter(quarter);\n      }\n    } else if (registrationDate) {\n      if (/^\\w\\w\\w \\d\\d\\d\\d$/.test(registrationDate)) {\n        let yearString = registrationDate.replace(/^\\w\\w\\w (\\d\\d\\d\\d)$/, \"$1\");\n        let ancestryQuarter = registrationDate.replace(/^(\\w\\w\\w) \\d\\d\\d\\d$/, \"$1\");\n\n        if (yearString && yearString != registrationDate && ancestryQuarter && ancestryQuarter != registrationDate) {\n          let quarter = -1;\n          for (let quarterName of ancestryQuarterMonthNames) {\n            if (ancestryQuarter == quarterName.name) {\n              quarter = quarterName.value;\n              break;\n            }\n          }\n          if (quarter != -1) {\n            result.setEventQuarter(quarter);\n          }\n        }\n      }\n    }\n\n    generalizeDataGivenRecordType(data, result);\n  }\n\n  // Collection\n  if (data.dbId) {\n    // sometime the dbId is the text version and not the number.\n    // e.g. 1911England instead of 2352\n    let collectionId = data.dbId;\n    let altIdCollection = _base_core_record_collections_mjs__WEBPACK_IMPORTED_MODULE_1__.RC.findCollectionByAltId(\"ancestry\", data.dbId);\n    if (altIdCollection) {\n      collectionId = altIdCollection.sites[\"ancestry\"].id;\n    }\n    result.collectionData = {\n      id: collectionId,\n    };\n\n    if (data.recordData) {\n      // could be an image page\n      let volume = getCleanValueForRecordDataList(data, [\"Volume\", \"Volume Number\", \"Volume number\"]);\n      if (volume) {\n        result.collectionData.volume = volume;\n      }\n      let page = getCleanValueForRecordDataList(data, [\"Page\", \"Page number\", \"Page Number\"]);\n      if (page) {\n        result.collectionData.page = page;\n      }\n      let folio = getCleanRecordDataValue(data, \"Folio\");\n      if (folio) {\n        result.collectionData.folio = folio;\n      }\n      let piece = getCleanRecordDataValue(data, \"Piece\");\n      if (piece) {\n        result.collectionData.piece = piece;\n      }\n      let schedule = getCleanValueForRecordDataList(data, [\"Schedule Number\", \"Household Schedule Number\"]);\n      if (schedule) {\n        result.collectionData.schedule = schedule;\n      }\n      let parish = getCleanValueForRecordDataList(data, [\"Civil Parish\", \"Parish\"]);\n      if (parish) {\n        result.collectionData.parish = parish;\n      }\n      let county = getCleanValueForRecordDataList(data, [\"County/Island\", \"County\"]);\n      if (county) {\n        result.collectionData.county = county;\n      }\n      let borough = getCleanValueForRecordDataList(data, [\"Borough\"]);\n      if (borough) {\n        result.collectionData.borough = borough;\n      }\n    }\n  }\n}\n\nfunction generalizeProfileData(input, result) {\n  let data = input.extractedData;\n\n  result.sourceType = \"profile\";\n  result.sourceOfData = \"ancestry\";\n\n  result.setFullName(data.titleName);\n\n  result.setBirthDate(data.birthDate);\n  result.setBirthPlace(data.birthPlace);\n  result.setDeathDate(data.deathDate);\n  result.setDeathPlace(data.deathPlace);\n\n  result.setPersonGender(data.gender);\n\n  if (data.marriages) {\n    for (let marriage of data.marriages) {\n      let spouse = result.addSpouse();\n      spouse.name.setFullName(marriage.spouseName);\n      spouse.marriageDate.dateString = marriage.date;\n      spouse.marriagePlace.placeString = marriage.place;\n    }\n  }\n\n  if (data.fatherName) {\n    let father = result.addFather();\n    father.name.setFullName(data.fatherName);\n  }\n  if (data.motherName) {\n    let mother = result.addMother();\n    mother.name.setFullName(data.motherName);\n  }\n\n  // analyze the surname - sometimes Ancestry users put the LNAB in parens\n  let surname = data.surname;\n  const openParenIndex = surname.indexOf(\"(\");\n  if (result.name && openParenIndex == 0) {\n    const closeParenIndex = surname.indexOf(\")\", openParenIndex);\n    if (closeParenIndex != -1) {\n      let lnab = surname.substring(openParenIndex + 1, closeParenIndex).trim();\n      let remainder = surname.substring(closeParenIndex + 1).trim();\n      if (lnab && remainder) {\n        result.lastNameAtBirth = lnab;\n        surname = lnab;\n        const spaceIndex = remainder.indexOf(\" \");\n        if (spaceIndex == -1) {\n          result.lastNameAtDeath = remainder;\n        } else {\n          // there are multiple names after close paren\n          // These could be last name at death folloed by other married names\n          // Could check names of spouses to get more info\n          const cln = remainder.substring(0, spaceIndex);\n          if (cln) {\n            result.lastNameAtDeath = remainder;\n          }\n        }\n      }\n    }\n  }\n  result.setLastNameAndForeNames(surname, data.givenName);\n}\n\n// This function generalizes the data extracted from an Ancestry page.\n// We know what fields can be there. And we know the ones we want in generalizedData.\nfunction generalizeData(input) {\n  let data = input.extractedData;\n\n  let result = new _base_core_generalize_data_utils_mjs__WEBPACK_IMPORTED_MODULE_0__.GeneralizedData();\n\n  if (data.pageType == \"personFacts\") {\n    generalizeProfileData(input, result);\n  } else {\n    generalizeRecordData(input, result);\n  }\n\n  result.hasValidData = true;\n\n  //console.log(\"End of Ancestry generalizeData, result is:\");\n  //console.log(result);\n\n  return result;\n}\n\nfunction setExtraGdHouseholdFields(extractedData, generalizedMember, fieldNames) {\n  function setMemberData(propertyName, recordDataNames, standardizeFunction) {\n    if (!generalizedMember[propertyName]) {\n      let value = getCleanValueForRecordDataList(extractedData, recordDataNames);\n      if (value) {\n        if (standardizeFunction) {\n          value = standardizeFunction(value);\n        }\n        generalizedMember[propertyName] = value;\n\n        if (!fieldNames.includes(propertyName)) {\n          fieldNames.push(propertyName);\n        }\n      }\n    }\n  }\n\n  setMemberData(\n    \"relationship\",\n    [\"Relationship to Head\", \"Relation to Head\", \"Relation to Head of House\", \"Relationship\", \"Relation\"],\n    _base_core_generalize_data_utils_mjs__WEBPACK_IMPORTED_MODULE_0__.GD.standardizeRelationshipToHead\n  );\n  setMemberData(\"maritalStatus\", [\"Marital Status\", \"Marital status\"], _base_core_generalize_data_utils_mjs__WEBPACK_IMPORTED_MODULE_0__.GD.standardizeMaritalStatus);\n  setMemberData(\"gender\", [\"Gender\"], _base_core_generalize_data_utils_mjs__WEBPACK_IMPORTED_MODULE_0__.GD.standardizeGender);\n  setMemberData(\"occupation\", [\"Occupation\"]);\n  setMemberData(\"birthDate\", [\"Birth Date\", \"DOB\"]);\n  setMemberData(\"birthPlace\", [\"Where born\", \"Where Born\", \"Birth Place\", \"Birthplace\", \"Birth place\"]);\n  setMemberData(\"birthYear\", [\"Estimated Birth Year\", \"Birth Year\"]);\n  setMemberData(\"employer\", [\"Employer\"]);\n}\n\nfunction regeneralizeDataWithLinkedRecords(input) {\n  let data = input.extractedData;\n  let result = input.generalizedData;\n  let linkedRecords = input.linkedRecords;\n\n  //console.log(\"regeneralizeDataWithLinkedRecords, data is:\");\n  //console.log(data);\n  //console.log(\"regeneralizeDataWithLinkedRecords, result is:\");\n  //console.log(result);\n  //console.log(\"regeneralizeDataWithLinkedRecords, linkedRecords is:\");\n  //console.log(linkedRecords);\n\n  if (data.household) {\n    for (let extractedMember of data.household.members) {\n      if (extractedMember.link) {\n        // find the same member in the generalized data\n        let generalizedMember = undefined;\n        for (let member of result.householdArray) {\n          //console.log(\"regeneralizeDataWithLinkedRecords extractedMember.link is:\" + extractedMember.link);\n          if (member.uid == extractedMember.link) {\n            generalizedMember = member;\n            break;\n          }\n        }\n\n        if (generalizedMember) {\n          let memberData = undefined;\n          if (generalizedMember.isSelected) {\n            // we don't have a linked record for the primary member\n            // But we want to do some similar filling out of fields\n            //console.log(\"regeneralizeDataWithLinkedRecords member is selected\");\n            memberData = data;\n          } else {\n            let memberLinkedRecord = undefined;\n            for (let linkedRecord of linkedRecords) {\n              if (linkedRecord.link == extractedMember.link) {\n                memberLinkedRecord = linkedRecord;\n                break;\n              }\n            }\n            if (memberLinkedRecord) {\n              memberData = memberLinkedRecord.extractedData;\n            }\n          }\n\n          if (memberData) {\n            //console.log(\"regeneralizeDataWithLinkedRecords found matching member. Name is:\" + generalizedMember.name);\n            //console.log(\"regeneralizeDataWithLinkedRecords. Extracted data is :\");\n            //console.log(memberData);\n            setExtraGdHouseholdFields(memberData, generalizedMember, result.householdArrayFields);\n          }\n        }\n      }\n    }\n  } else if (data.linkData && result.role) {\n    // if there are linkData and this person is not the primary person on the record\n    // we should be able to get more detail from the linData of the primary person\n\n    // Note the code below may be redundant because the code that adds the linked records\n    // only adds the one that is needed so we are duplicating things here\n    let primaryLink = undefined;\n    if (result.role == \"Parent\") {\n      let link = data.linkData[\"Child\"];\n      if (link) {\n        primaryLink = link;\n      }\n    } else if (result.role == \"Child\") {\n      let link = data.linkData[\"Parent\"];\n      if (link) {\n        primaryLink = link;\n      } else {\n        let link = data.linkData[\"Father\"];\n        if (link) {\n          primaryLink = link;\n        } else {\n          let link = data.linkData[\"Mother\"];\n          if (link) {\n            primaryLink = link;\n          }\n        }\n      }\n    } else if (result.role == \"Sibling\") {\n      let link = data.linkData[\"Siblings\"];\n      if (link) {\n        primaryLink = link;\n      }\n    }\n\n    //console.log(\"regeneralizeDataWithLinkedRecords, primaryLink is:\");\n    //console.log(primaryLink);\n\n    if (primaryLink) {\n      let primaryLinkedRecord = undefined;\n      for (let linkedRecord of linkedRecords) {\n        if (linkedRecord.link == primaryLink) {\n          primaryLinkedRecord = linkedRecord;\n          break;\n        }\n      }\n\n      if (primaryLinkedRecord) {\n        //console.log(\"regeneralizeDataWithLinkedRecords, primaryLinkedRecord.extractedData is:\");\n        //console.log(primaryLinkedRecord.extractedData);\n\n        // Now we can look for extra data\n        let gdInput = {};\n        gdInput.extractedData = primaryLinkedRecord.extractedData;\n        let generalizedData = generalizeData(gdInput);\n\n        //console.log(\"regeneralizeDataWithLinkedRecords, primaryLinkedRecord generalizedData is:\");\n        //console.log(generalizedData);\n\n        // even if we have an event date and place the one from the linked record should be better.\n        // For example the parent in a child birt record can have a birth place which has been\n        // interpreted as the event place incorrectly e.g.:\n        // https://www.ancestry.com/discoveryui-content/view/300065623:8703\n        if (generalizedData.eventPlace) {\n          result.eventPlace = generalizedData.eventPlace;\n        }\n        if (generalizedData.eventDate) {\n          result.eventDate = generalizedData.eventDate;\n        }\n\n        // because the linked record has more data it will have a more accurate recordType\n        // For example the existing one might be BirthOrBaptism but the linked one may have\n        // Baptism because it has a BaptismDate.\n        // But we have to be careful in case it is an unclassified event\n        if (generalizedData.recordType && generalizedData.recordType != _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_2__.RT.Unclassified) {\n          result.recordType = generalizedData.recordType;\n\n          if (result.overrideRefTitle) {\n            // this means that we asked the user to specify the recordType because it was unclassified\n            // But now we have a recordType from the linkedRecord.\n            // So we didn't need to ask. If we leave the overrideRefTitle we can end up with\n            // contradictory data in the citation if they picked the wrong type.\n            delete result.overrideRefTitle;\n          }\n        }\n\n        if (generalizedData.personGender && !result.primaryPersonGender) {\n          result.primaryPersonGender = generalizedData.personGender;\n        }\n\n        // For a child marriage we want to get the spouse,\n        // This is a bit confusing - we store this in result.spouses even though it is\n        // the spouse of the child not this person\n        if (generalizedData.spouses) {\n          result.spouses = generalizedData.spouses;\n\n          if (generalizedData.ageAtEvent) {\n            result.primaryPersonAge = generalizedData.ageAtEvent;\n          }\n        } else {\n          // for a child birth/baptism we want to get the other parent and put that in spouses\n          let otherParent = undefined;\n          if (generalizedData.parents) {\n            if (result.personGender == \"male\") {\n              if (generalizedData.parents.mother) {\n                otherParent = generalizedData.parents.mother;\n              }\n            } else if (result.personGender == \"female\") {\n              if (generalizedData.parents.father) {\n                otherParent = generalizedData.parents.father;\n              }\n            } else if (result.name && result.name.name) {\n              // don't know gender so have to compare our name with parent names\n              let fatherName = \"\";\n              let motherName = \"\";\n              if (generalizedData.parents.father && generalizedData.parents.father.name) {\n                fatherName = generalizedData.parents.father.name.name;\n              }\n              if (generalizedData.parents.mother && generalizedData.parents.mother.name) {\n                motherName = generalizedData.parents.mother.name.name;\n              }\n              if (result.name.name == fatherName && generalizedData.parents.mother) {\n                otherParent = generalizedData.parents.mother;\n              } else if (result.name.name == motherName && generalizedData.parents.father) {\n                otherParent = generalizedData.parents.father;\n              }\n            }\n          }\n\n          if (otherParent && otherParent.name) {\n            result.spouses = [];\n            result.spouses.push(otherParent);\n          }\n        }\n      }\n    }\n  }\n\n  //console.log(\"regeneralizeDataWithLinkedRecords, result is:\");\n  //console.log(result);\n}\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9leHRlbnNpb24vc2l0ZS9hbmNlc3RyeS9jb3JlL2FuY2VzdHJ5X2dlbmVyYWxpemVfZGF0YS5tanMuanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFBQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBU3NEO0FBQ1M7QUFDRDs7QUFFOUQ7QUFDQSxxQkFBcUIsNEVBQW9CO0FBQ3pDLFNBQVMsZ0VBQVE7QUFDakIscUJBQXFCLDRFQUFvQjtBQUN6QyxTQUFTLGdFQUFRO0FBQ2pCLFlBQVksbUVBQVc7QUFDdkIsd0JBQXdCLG1FQUFXO0FBQ25DLG1CQUFtQixtRUFBVztBQUM5QixVQUFVLGlFQUFTO0FBQ25CLHFCQUFxQiw0RUFBb0I7QUFDekMsV0FBVyxrRUFBVTtBQUNyQixVQUFVLGlFQUFTO0FBQ25CLG9CQUFvQiwyRUFBbUI7QUFDdkMsdUJBQXVCLDhFQUFzQjtBQUM3QyxXQUFXLGtFQUFVO0FBQ3JCLFdBQVcsa0VBQVU7QUFDckIsbUJBQW1CLG1FQUFXO0FBQzlCLFdBQVcsOERBQU07QUFDakI7O0FBRUE7QUFDQSxJQUFJLE1BQU0sa0VBQVUsNEJBQTRCO0FBQ2hELElBQUksTUFBTSxtRUFBVyx5REFBeUQ7QUFDOUU7QUFDQSxVQUFVLG1FQUFXO0FBQ3JCO0FBQ0EsR0FBRztBQUNILElBQUksTUFBTSxtRUFBVyx1REFBdUQ7QUFDNUUsSUFBSSxNQUFNLGtFQUFVLDZDQUE2QztBQUNqRSxJQUFJLE1BQU0saUVBQVMsMkNBQTJDO0FBQzlELElBQUksTUFBTSxpRUFBUywyQ0FBMkM7QUFDOUQsSUFBSSxNQUFNLGlFQUFTLDBDQUEwQztBQUM3RCxJQUFJLE1BQU0sbUVBQVcsK0NBQStDO0FBQ3BFLElBQUksTUFBTSxtRUFBVyx3REFBd0Q7QUFDN0UsSUFBSSxNQUFNLG1FQUFXLCtDQUErQztBQUNwRSxJQUFJLE1BQU0sbUVBQVcs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O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLDhDQUE4QztBQUM5QywwRUFBMEU7QUFDMUU7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0Es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QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCO0FBQ2hCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQkFBcUIseUVBQU87O0FBRTVCO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUksOEJBQThCLGtFQUFVO0FBQzVDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJLDhCQUE4QixpRUFBUztBQUMzQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJLDhCQUE4QixvRUFBWTtBQUM5QztBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FB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Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxVQUFVLElBQUk7QUFDZDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBCQUEwQix1RkFBd0I7QUFDbEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVU7QUFDVjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxtQkFBbUIsaUZBQWU7O0FBRWxDO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxJQUFJLGtHQUFnQztBQUNwQztBQUNBLHVFQUF1RSw2RkFBMkI7QUFDbEcsc0NBQXNDLHNGQUFvQjtBQUMxRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVk7QUFDWjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7QUFDQTtBQUNBLFVBQVU7QUFDVjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3RUFBd0UsdUVBQWU7QUFDdkY7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxVQUFVO0FBQ1Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxjQUFjO0FBQ2Q7QUFDQTtBQUNBO0FBQ0EsY0FBYztBQUNkO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0I7QUFDaEI7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBUUUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9DaXRhdGlvbkV4dHJhY3Rvci8uL2V4dGVuc2lvbi9zaXRlL2FuY2VzdHJ5L2NvcmUvYW5jZXN0cnlfZ2VuZXJhbGl6ZV9kYXRhLm1qcz9iNjQ3Il0sInNvdXJjZXNDb250ZW50IjpbIi8qXG5NSVQgTGljZW5zZVxuXG5Db3B5cmlnaHQgKGMpIDIwMjAgUm9iZXJ0IE0gUGF2ZXlcblxuUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEgY29weVxub2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGUgXCJTb2Z0d2FyZVwiKSwgdG8gZGVhbFxuaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVzdHJpY3Rpb24sIGluY2x1ZGluZyB3aXRob3V0IGxpbWl0YXRpb24gdGhlIHJpZ2h0c1xudG8gdXNlLCBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLCBkaXN0cmlidXRlLCBzdWJsaWNlbnNlLCBhbmQvb3Igc2VsbFxuY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzXG5mdXJuaXNoZWQgdG8gZG8gc28sIHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZyBjb25kaXRpb25zOlxuXG5UaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZCBpbiBhbGxcbmNvcGllcyBvciBzdWJzdGFudGlhbCBwb3J0aW9ucyBvZiB0aGUgU29mdHdhcmUuXG5cblRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCBcIkFTIElTXCIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1JcbklNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLFxuRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFXG5BVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSXG5MSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLFxuT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTiBUSEVcblNPRlRXQVJFLlxuKi9cblxuaW1wb3J0IHtcbiAgR2VuZXJhbGl6ZWREYXRhLFxuICBHRCxcbiAgZGF0ZVF1YWxpZmllcnMsXG4gIFd0c1BsYWNlLFxuICBXdHNOYW1lLFxuICBXdHNEYXRlLFxufSBmcm9tIFwiLi4vLi4vLi4vYmFzZS9jb3JlL2dlbmVyYWxpemVfZGF0YV91dGlscy5tanNcIjtcbmltcG9ydCB7IFJDIH0gZnJvbSBcIi4uLy4uLy4uL2Jhc2UvY29yZS9yZWNvcmRfY29sbGVjdGlvbnMubWpzXCI7XG5pbXBvcnQgeyBSVCwgUm9sZSB9IGZyb20gXCIuLi8uLi8uLi9iYXNlL2NvcmUvcmVjb3JkX3R5cGUubWpzXCI7XG5cbmNvbnN0IGV2ZW50VHlwZVN0cmluZ1RvRGF0YVR5cGUgPSB7XG4gIEJpcnRoUmVnaXN0cmF0aW9uOiBSVC5CaXJ0aFJlZ2lzdHJhdGlvbixcbiAgQmlydGg6IFJULkJpcnRoLFxuICBEZWF0aFJlZ2lzdHJhdGlvbjogUlQuRGVhdGhSZWdpc3RyYXRpb24sXG4gIERlYXRoOiBSVC5EZWF0aCxcbiAgTWFycmlhZ2U6IFJULk1hcnJpYWdlLFxuICBcIsOmZ3Rlc2thYihNYXJyaWFnZSlcIjogUlQuTWFycmlhZ2UsXG4gIE1hcnJpYWdlTGljZW5zZTogUlQuTWFycmlhZ2UsXG4gIENlbnN1czogUlQuQ2Vuc3VzLFxuICBFbGVjdG9yYWxSZWdpc3RlcjogUlQuRWxlY3RvcmFsUmVnaXN0ZXIsXG4gIEJhcHRpc206IFJULkJhcHRpc20sXG4gIEJ1cmlhbDogUlQuQnVyaWFsLFxuICBDcmltaW5hbFJlZ2lzdGVyOiBSVC5DcmltaW5hbFJlZ2lzdGVyLFxuICBGcmVlbWFzb25NZW1iZXJzaGlwOiBSVC5GcmVlbWFzb25NZW1iZXJzaGlwLFxuICBQcm9iYXRlOiBSVC5Qcm9iYXRlLFxuICBEaXZvcmNlOiBSVC5EaXZvcmNlLFxuICBNaWxpdGFyeVNlcnZpY2U6IFJULk1pbGl0YXJ5LFxuICBUYXhMaXN0OiBSVC5UYXgsXG59O1xuXG5jb25zdCByZWNvcmRUeXBlQnlGaWVsZHMgPSBbXG4gIHsgdHlwZTogUlQuRGl2b3JjZSwgbGFiZWxzOiBbXCJEaXZvcmNlIERhdGVcIl0gfSxcbiAgeyB0eXBlOiBSVC5NYXJyaWFnZSwgbGFiZWxzOiBbXCJNYXJyaWFnZSBEYXRlXCIsIFwiTWFycmlhZ2UgUGxhY2VcIiwgXCJTcG91c2VcIl0gfSxcbiAge1xuICAgIHR5cGU6IFJULk1hcnJpYWdlLFxuICAgIGxhYmVsczogW1wiTWFycmlhZ2UgTGljZW5zZSBEYXRlXCIsIFwiTWFycmlhZ2UgTGljZW5zZSBQbGFjZVwiLCBcIlNwb3VzZVwiXSxcbiAgfSxcbiAgeyB0eXBlOiBSVC5NYXJyaWFnZSwgbGFiZWxzOiBbXCJMaWNlbnNlIERhdGVcIiwgXCJMaWNlbnNlIFBsYWNlXCIsIFwiU3BvdXNlXCJdIH0sXG4gIHsgdHlwZTogUlQuQmFwdGlzbSwgbGFiZWxzOiBbXCJCYXB0aXNtIERhdGVcIiwgXCJCYXB0aXNtIFBsYWNlXCJdIH0sXG4gIHsgdHlwZTogUlQuQnVyaWFsLCBsYWJlbHM6IFtcIkJ1cmlhbCBEYXRlXCIsIFwiQnVyaWFsIFBsYWNlXCJdIH0sXG4gIHsgdHlwZTogUlQuQnVyaWFsLCBsYWJlbHM6IFtcIkJ1cmlhbCBZZWFyXCIsIFwiQnVyaWFsIFBsYWNlXCJdIH0sXG4gIHsgdHlwZTogUlQuQnVyaWFsLCBsYWJlbHM6IFtcIkRlYXRoIERhdGVcIiwgXCJCdXJpYWwgUGxhY2VcIl0gfSxcbiAgeyB0eXBlOiBSVC5NYXJyaWFnZSwgbGFiZWxzOiBbXCJNYXJyaWFnZSBEYXRlXCIsIFwiTWFycmlhZ2UgUGxhY2VcIl0gfSxcbiAgeyB0eXBlOiBSVC5NYXJyaWFnZSwgbGFiZWxzOiBbXCJNYXJyaWFnZSBEYXRlIG9uIEltYWdlXCIsIFwiTWFycmlhZ2UgUGxhY2VcIl0gfSxcbiAgeyB0eXBlOiBSVC5NYXJyaWFnZSwgbGFiZWxzOiBbXCJNYXJyaWFnZSBZZWFyXCIsIFwiTWFycmlhZ2UgUGxhY2VcIl0gfSxcbiAgeyB0eXBlOiBSVC5NYXJyaWFnZSwgbGFiZWxzOiBbXCJNYXJyaWFnZSBZZWFyXCIsIFwiTWFycmlhZ2UgU3RhdGVcIl0gfSxcbiAgeyB0eXBlOiBSVC5NYXJyaWFnZSwgbGFiZWxzOiBbXCJNYXJyaWFnZSBEYXRlXCJdIH0sXG4gIHsgdHlwZTogUlQuTWFycmlhZ2VSZWdpc3RyYXRpb24sIGxhYmVsczogW1wiTWFycmlhZ2UgUmVnaXN0cmF0aW9uIFBsYWNlXCJdIH0sXG4gIHsgdHlwZTogUlQuTWFycmlhZ2VSZWdpc3RyYXRpb24sIGxhYmVsczogW1wiTWFycmlhZ2UgUmVnaXN0cmF0aW9uIERhdGVcIl0gfSxcbiAgeyB0eXBlOiBSVC5NYXJyaWFnZVJlZ2lzdHJhdGlvbiwgbGFiZWxzOiBbXCJNYXJyaWFnZSBSZWdpc3RyYXRpb24gWWVhclwiXSB9LFxuICB7XG4gICAgdHlwZTogUlQuRGVhdGgsXG4gICAgbGFiZWxzOiBbXCJEZWF0aCBEYXRlIG9uIEltYWdlXCIsIFwiVHJhbnNsYXRlZCBEZWF0aCBEYXRlXCIsIFwiRGVhdGggUGxhY2VcIl0sXG4gIH0sXG4gIHsgdHlwZTogUlQuRGVhdGgsIGxhYmVsczogW1wiRGVhdGggRGF0ZVwiLCBcIk1vbnRobHkgTWVldGluZ1wiXSB9LFxuICB7IHR5cGU6IFJULk1pbGl0YXJ5LCBsYWJlbHM6IFtcIkVubGlzdG1lbnQgRGF0ZVwiLCBcIkVubGlzdG1lbnQgUGxhY2VcIl0gfSxcbl07XG5cbmZ1bmN0aW9uIGRldGVybWluZVJlY29yZFR5cGUoZXh0cmFjdGVkRGF0YSkge1xuICBjb25zdCB0aXRsZU1hdGNoZXMgPSBbXG4gICAgeyB0eXBlOiBSVC5CYXB0aXNtLCBtYXRjaGVzOiBbXCJDaHJpc3RlbmluZyBJbmRleFwiXSB9LFxuICAgIHtcbiAgICAgIHR5cGU6IFJULkJpcnRoUmVnaXN0cmF0aW9uLFxuICAgICAgbWF0Y2hlczogW1wiQmlydGggSW5kZXhcIl0sXG4gICAgICByZXF1aXJlZERhdGE6IFtcIkJpcnRoIFJlZ2lzdHJhdGlvbiBEYXRlXCJdLFxuICAgIH0sXG4gICAge1xuICAgICAgdHlwZTogUlQuQmlydGhSZWdpc3RyYXRpb24sXG4gICAgICBtYXRjaGVzOiBbXCJCaXJ0aCBJbmRleFwiXSxcbiAgICAgIHJlcXVpcmVkRGF0YTogW1wiQmlydGggUmVnaXN0cmF0aW9uIFBsYWNlXCJdLFxuICAgIH0sXG4gICAge1xuICAgICAgdHlwZTogUlQuQmlydGgsXG4gICAgICBtYXRjaGVzOiBbXCJCaXJ0aCBDZXJ0aWZpY2F0ZVwiLCBcIkJpcnRoIFJlY29yZFwiLCBcIkJpcnRoIEluZGV4XCJdLFxuICAgIH0sXG4gICAge1xuICAgICAgdHlwZTogUlQuQmFwdGlzbSxcbiAgICAgIG1hdGNoZXM6IFtcIkJpcnRocyBhbmQgQ2hyaXN0ZW5pbmdzXCIsIFwiQmlydGhzIGFuZCBCYXB0aXNtc1wiLCBcIkNodXJjaCBvZiBFbmdsYW5kIEJhcHRpc21zXCIsIFwiQmFwdGlzbSBJbmRleFwiXSxcbiAgICAgIHJlcXVpcmVkRGF0YTogW1wiQmFwdGlzbSBEYXRlXCJdLFxuICAgIH0sXG4gICAge1xuICAgICAgdHlwZTogUlQuQmlydGgsXG4gICAgICBtYXRjaGVzOiBbXCJCaXJ0aHMgYW5kIENocmlzdGVuaW5nc1wiLCBcIkJpcnRocyBhbmQgQmFwdGlzbXNcIiwgXCJDYW5hZGEgQmlydGhzXCIsIFwiQ2FuYWRhLCBCaXJ0aHNcIiwgXCJCaXJ0aCBSZWdpc3RlcnNcIl0sXG4gICAgICByZXF1aXJlZERhdGE6IFtcIkJpcnRoIERhdGVcIl0sXG4gICAgfSxcbiAgICB7XG4gICAgICB0eXBlOiBSVC5CaXJ0aCxcbiAgICAgIG1hdGNoZXM6IFtcIk1pbGxlbm5pdW0gRmlsZVwiLCBcIlZpdGFsIEV4dHJhY3RzXCIsIFwiTWVtYmVyc2hpcCBvZiBUaGUgQ2h1cmNoIG9mIEplc3VzIENocmlzdCBvZiBMYXR0ZXItZGF5IFNhaW50c1wiXSxcbiAgICAgIHJlcXVpcmVkRGF0YTogW1wiQmlydGggRGF0ZVwiXSxcbiAgICB9LFxuICAgIHtcbiAgICAgIHR5cGU6IFJULkJpcnRoLFxuICAgICAgbWF0Y2hlczogW1wiQmlydGhzXCJdLFxuICAgICAgcmVxdWlyZWREYXRhOiBbXCJCaXJ0aCBEYXRlXCIsIFwiQmlydGggUGxhY2VcIiwgXCJHZW5kZXJcIl0sXG4gICAgfSxcbiAgICB7XG4gICAgICB0eXBlOiBSVC5CaXJ0aE9yQmFwdGlzbSxcbiAgICAgIG1hdGNoZXM6IFtcbiAgICAgICAgXCJTZWxlY3QgQmlydGhzIGFuZCBDaHJpc3RlbmluZ3NcIixcbiAgICAgICAgXCJTZWxlY3QgQmlydGhzIGFuZCBCYXB0aXNtc1wiLFxuICAgICAgICBcIkNodXJjaCBvZiBFbmdsYW5kIEJpcnRocyBhbmQgQmFwdGlzbXNcIixcbiAgICAgIF0sXG4gICAgfSxcblxuICAgIHsgdHlwZTogUlQuRGl2b3JjZSwgbWF0Y2hlczogW1wiRGl2b3JjZSBSZWNvcmRzXCIsIFwiRGl2b3JjZSBJbmRleFwiXSB9LFxuICAgIHtcbiAgICAgIHR5cGU6IFJULk1hcnJpYWdlLFxuICAgICAgbWF0Y2hlczogW1xuICAgICAgICBcIkNodXJjaCBvZiBFbmdsYW5kIE1hcnJpYWdlcyBhbmQgQmFubnNcIixcbiAgICAgICAgXCJNYXJyaWFnZSBSZWdpc3RlcnMsIEJvbmRzIGFuZCBBbGxlZ2F0aW9uc1wiLFxuICAgICAgICBcIlUuUy4gYW5kIEludGVybmF0aW9uYWwgTWFycmlhZ2UgUmVjb3Jkc1wiLFxuICAgICAgICBcIkluZGV4IHRvIE1hcnJpYWdlIEJvbmRzXCIsXG4gICAgICAgIFwiTWFycmlhZ2UgQm9uZHMgYW5kIEFsbGVnYXRpb25zXCIsXG4gICAgICBdLFxuICAgIH0sXG4gICAge1xuICAgICAgdHlwZTogUlQuQnVyaWFsLFxuICAgICAgbWF0Y2hlczogW1xuICAgICAgICBcIkNodXJjaCBvZiBFbmdsYW5kIEJ1cmlhbHNcIixcbiAgICAgICAgXCJFbmdsYW5kIERlYXRocyBhbmQgQnVyaWFsc1wiLFxuICAgICAgICBcIkJ1cmlhbCBhbmQgQ3JlbWF0aW9uIEluZGV4XCIsXG4gICAgICAgIFwiRmluZCBhIEdyYXZlXCIsXG4gICAgICAgIFwiQ2VtZXRlcnkgQnVyaWFsIENhcmRzXCIsXG4gICAgICAgIFwiVmV0ZXJhbnMgQnVyaWFsIENhcmRzXCIsXG4gICAgICAgIFwiR3JhdmVzaXRlc1wiLFxuICAgICAgICBcIkdyYXZlcyBvZiBSZXZvbHV0aW9uYXJ5IFBhdHJpb3RzXCIsXG4gICAgICBdLFxuICAgIH0sXG4gICAge1xuICAgICAgdHlwZTogUlQuQnVyaWFsLFxuICAgICAgbWF0Y2hlczogW1wiRGVhdGhzIGFuZCBCdXJpYWxzXCIsIFwiQ2VtZXRlcnlcIiwgXCJGdW5lcmFsIEhvbWVcIiwgXCJHcmF2ZXN0b25lXCJdLFxuICAgICAgcmVxdWlyZWREYXRhOiBbXCJCdXJpYWwgRGF0ZVwiXSxcbiAgICB9LFxuICAgIHtcbiAgICAgIHR5cGU6IFJULkNyZW1hdGlvbixcbiAgICAgIG1hdGNoZXM6IFtcIkNlbWV0ZXJ5IFJlY29yZHNcIl0sXG4gICAgICByZXF1aXJlZERhdGE6IFtcIkNyZW1hdGlvbiBEYXRlXCJdLFxuICAgIH0sXG4gICAge1xuICAgICAgdHlwZTogUlQuQnVyaWFsLFxuICAgICAgbWF0Y2hlczogW1wiSGlzdG9yaWNhbCBDZW1ldGVyeSBDb21taXNzaW9uIEluZGV4XCIsIFwiSGVhZHN0b25lIFRyYW5zY3JpcHRpb25zXCIsIFwiQ2VtZXRlcnlcIiwgXCJGdW5lcmFsXCJdLFxuICAgICAgcmVxdWlyZWREYXRhOiBbXCJCdXJpYWwgUGxhY2VcIl0sXG4gICAgfSxcbiAgICB7XG4gICAgICB0eXBlOiBSVC5EZWF0aFJlZ2lzdHJhdGlvbixcbiAgICAgIG1hdGNoZXM6IFtcIkRlYXRoc1wiLCBcIkRlYXRoIFJlY29yZHNcIiwgXCJEZWF0aCBJbmRleFwiXSxcbiAgICAgIHJlcXVpcmVkRGF0YTogW1wiRGVhdGggUmVnaXN0cmF0aW9uIFBsYWNlXCJdLFxuICAgIH0sXG4gICAge1xuICAgICAgdHlwZTogUlQuRGVhdGgsXG4gICAgICBtYXRjaGVzOiBbXCJEZWF0aHNcIiwgXCJEZWF0aCBSZWNvcmRzXCIsIFwiU2NvdGxhbmQsIExvY2FsIEhlcml0YWdlIEluZGV4XCJdLFxuICAgICAgcmVxdWlyZWREYXRhOiBbXCJEZWF0aCBEYXRlXCJdLFxuICAgIH0sXG4gICAge1xuICAgICAgdHlwZTogUlQuRGVhdGgsXG4gICAgICBtYXRjaGVzOiBbXG4gICAgICAgIFwiRGVhdGggSW5kZXhcIixcbiAgICAgICAgXCJEZWF0aCBDZXJ0aWZpY2F0ZVwiLFxuICAgICAgICBcIlUuUy4sIERlYXRoIFJlY29yZFwiLFxuICAgICAgICBcIkluZGV4IHRvIERlY2Vhc2VkIEVzdGF0ZSBGaWxlc1wiLFxuICAgICAgICBcIkRlYXRoIE5vdGljZVwiLFxuICAgICAgICBcIkNhbmFkYSwgRGVhdGhzXCIsXG4gICAgICBdLFxuICAgIH0sXG4gICAge1xuICAgICAgdHlwZTogUlQuTm9ucG9wdWxhdGlvbkNlbnN1cyxcbiAgICAgIG1hdGNoZXM6IFtcIkNlbnN1cyBOb24tUG9wdWxhdGlvbiBTY2hlZHVsZVwiXSxcbiAgICB9LFxuICAgIHsgdHlwZTogUlQuQ2Vuc3VzLCBtYXRjaGVzOiBbXCJDZW5zdXNcIiwgXCIxOTM5IEVuZ2xhbmQgYW5kIFdhbGVzIFJlZ2lzdGVyXCJdIH0sXG4gICAge1xuICAgICAgdHlwZTogUlQuRWxlY3RvcmFsUmVnaXN0ZXIsXG4gICAgICBtYXRjaGVzOiBbXCJFbGVjdG9yYWwgUm9sbFwiLCBcIlZvdGVyIFJlZ2lzdGVyc1wiLCBcIkVsZWN0b3JhbCBSZWdpc3RlcnNcIl0sXG4gICAgfSxcbiAgICB7IHR5cGU6IFJULlByb2JhdGUsIG1hdGNoZXM6IFtcIlByb2JhdGVcIl0gfSxcbiAgICB7XG4gICAgICB0eXBlOiBSVC5XaWxsLFxuICAgICAgbWF0Y2hlczogW1wiUHJlcm9nYXRpdmUgQ291cnQgb2YgQ2FudGVyYnVyeSBXaWxsc1wiLCBcIldpbGwgSW5kZXhcIl0sXG4gICAgfSxcbiAgICB7XG4gICAgICB0eXBlOiBSVC5NYXJyaWFnZVJlZ2lzdHJhdGlvbixcbiAgICAgIG1hdGNoZXM6IFtcIkNpdmlsIFJlZ2lzdHJhdGlvbiBNYXJyaWFnZSBJbmRleFwiXSxcbiAgICB9LFxuICAgIHtcbiAgICAgIHR5cGU6IFJULkNyaW1pbmFsUmVnaXN0ZXIsXG4gICAgICBtYXRjaGVzOiBbXCJDcmltaW5hbCBSZWdpc3RlclwiLCBcIlBvbGljZSBHYXpldHRlc1wiLCBcIkNvbnZpY3QgUmVnaXN0ZXJcIiwgXCJQcmlzb24gSHVsayBSZWdpc3RlclwiXSxcbiAgICB9LFxuICAgIHtcbiAgICAgIHR5cGU6IFJULkZyZWVtYXNvbk1lbWJlcnNoaXAsXG4gICAgICBtYXRjaGVzOiBbXCJGcmVlbWFzb24gTWVtYmVyc2hpcFwiLCBcIk1hc29uIE1lbWJlcnNoaXAgQ2FyZHNcIl0sXG4gICAgfSxcbiAgICB7XG4gICAgICB0eXBlOiBSVC5Xb3JraG91c2VSZWNvcmQsXG4gICAgICBtYXRjaGVzOiBbXCJXb3JraG91c2UgQWRtaXNzaW9uIGFuZCBEaXNjaGFyZ2UgUmVjb3Jkc1wiXSxcbiAgICB9LFxuICAgIHtcbiAgICAgIHR5cGU6IFJULlBhc3Nlbmdlckxpc3QsXG4gICAgICBtYXRjaGVzOiBbXG4gICAgICAgIFwiUGFzc2VuZ2VyIExpc3RcIixcbiAgICAgICAgXCJQYXNzZW5nZXIgYW5kIENyZXcgTGlzdFwiLFxuICAgICAgICBcIlBhc3NlbmdlciBhbmQgSW1taWdyYXRpb24gTGlzdHMgSW5kZXhcIixcbiAgICAgICAgXCJJbmRleCB0byBBbGllbiBBcnJpdmFsc1wiLFxuICAgICAgXSxcbiAgICB9LFxuICAgIHsgdHlwZTogUlQuQ3Jld0xpc3QsIG1hdGNoZXM6IFtcIkNyZXcgTGlzdFwiXSB9LFxuICAgIHsgdHlwZTogUlQuQ29udmljdFRyYW5zcG9ydGF0aW9uLCBtYXRjaGVzOiBbXCJDb252aWN0IFRyYW5zcG9ydGF0aW9uXCJdIH0sXG4gICAge1xuICAgICAgdHlwZTogUlQuTWlsaXRhcnksXG4gICAgICBtYXRjaGVzOiBbXG4gICAgICAgIFwiTWVkYWwgYW5kIEF3YXJkIFJvbGxzXCIsXG4gICAgICAgIFwiQnJpdGlzaCBBcm15IFdvcmxkIFdhciBJIFNlcnZpY2UgUmVjb3Jkc1wiLFxuICAgICAgICBcIkFybXkgV29ybGQgV2FyIEkgUGVuc2lvblwiLFxuICAgICAgICBcIldvcmxkIFdhciBJIFBlbnNpb24gTGVkZ2VycyBhbmQgSW5kZXggQ2FyZHNcIixcbiAgICAgICAgXCJSZWdpbWVudGFsIFJvbGxzIGFuZCBSZWNydWl0bWVudCBSZWdpc3RlcnNcIixcbiAgICAgICAgXCJDaGVsc2VhIFBlbnNpb25lciBTb2xkaWVyIFNlcnZpY2UgUmVjb3Jkc1wiLFxuICAgICAgICBcIlNvbGRpZXJzIERpZWQgaW4gdGhlIEdyZWF0IFdhclwiLFxuICAgICAgICBcIldvcmxkIFdhciBJXCIsXG4gICAgICAgIFwiV2FyIEdyYXZlc1wiLFxuICAgICAgICBcIlUuUy4sIERlcGFydG1lbnQgb2YgVmV0ZXJhbnMgQWZmYWlycyBCSVJMUyBEZWF0aCBGaWxlXCIsXG4gICAgICAgIFwiVUssIEFybXkgUmVnaXN0ZXJzIG9mIFNvbGRpZXJzJyBFZmZlY3RzXCIsXG4gICAgICAgIFwiU29sZGllciBHcmF2ZSBSZWdpc3RyYXRpb25zXCIsXG4gICAgICAgIFwiTWlsaXRhcnkgU2VydmljZVwiLFxuICAgICAgICBcIkNvbXBpbGVkIFNlcnZpY2UgUmVjb3Jkc1wiLFxuICAgICAgICBcIlZvbHVudGVlciBNaWxpdGlhXCIsXG4gICAgICAgIFwiUmV2b2x1dGlvbmFyeSBXYXIgUmVzaWRlbnRzXCIsXG4gICAgICAgIFwiU29sZGllciBSZWNvcmRzXCIsXG4gICAgICAgIFwiV2FyIFNvbGRpZXJzXCIsXG4gICAgICAgIFwiUHJpc29uZXIgb2YgV2FyXCIsXG4gICAgICAgIFwiV2FyIFJvbGxzXCIsXG4gICAgICAgIFwiV2FyIFBlbnNpb25lcnNcIixcbiAgICAgICAgXCJXYXIgb2YgMTgxMiBQZW5zaW9uXCIsXG4gICAgICAgIFwiRHJhZnQgUmVnaXN0cmF0aW9uXCIsXG4gICAgICAgIFwiQ2l2aWwsIE1pbGl0YXJ5LCBhbmQgTmF2YWwgU2VydmljZVwiLFxuICAgICAgICBcIkFpciBGb3JjZSBBaXJtZW4gUmVjb3Jkc1wiLFxuICAgICAgICBcIk5hdnkgUmVnaXN0ZXJzIG9mIFNlYW1lbidzIFNlcnZpY2VzXCIsXG4gICAgICAgIFwiQ29uZmVkZXJhdGUgUGVuc2lvbnNcIixcbiAgICAgICAgXCJXYXIgUGVuc2lvblwiLFxuICAgICAgXSxcbiAgICB9LFxuICAgIHsgdHlwZTogUlQuTWlsaXRhcnksIG1hdGNoZXM6IFtcIldhclwiXSwgc2Vjb25kTWF0Y2hlczogW1wiUGVuc2lvblwiXSB9LFxuICAgIHtcbiAgICAgIHR5cGU6IFJULk1lZGljYWxQYXRpZW50LFxuICAgICAgbWF0Y2hlczogW1wiTHVuYWN5IFBhdGllbnRzIEFkbWlzc2lvbiBSZWdpc3RlcnNcIl0sXG4gICAgfSxcbiAgICB7IHR5cGU6IFJULlF1YXJ0ZXJTZXNzaW9uLCBtYXRjaGVzOiBbXCJRdWFydGVyIFNlc3Npb25zXCJdIH0sXG4gICAge1xuICAgICAgdHlwZTogUlQuRGlyZWN0b3J5LFxuICAgICAgbWF0Y2hlczogW1xuICAgICAgICBcIkNpdHkgYW5kIENvdW50eSBEaXJlY3Rvcmllc1wiLFxuICAgICAgICBcIkNpdHkgRGlyZWN0b3JpZXNcIixcbiAgICAgICAgXCJDaXR5IGFuZCBBcmVhIERpcmVjdG9yaWVzXCIsXG4gICAgICAgIFwiUGhvbmUgQm9va1wiLFxuICAgICAgICBcIlRyYWRlIERpcmVjdG9yaWVzXCIsXG4gICAgICBdLFxuICAgIH0sXG4gICAge1xuICAgICAgdHlwZTogUlQuRW1wbG95bWVudCxcbiAgICAgIG1hdGNoZXM6IFtcbiAgICAgICAgXCJFbXBsb3ltZW50IFJlY29yZHNcIixcbiAgICAgICAgXCJVSywgUG9zdGFsIFNlcnZpY2UgQXBwb2ludG1lbnQgQm9va3NcIixcbiAgICAgICAgXCJOdXJzaW5nIFJlZ2lzdGVyc1wiLFxuICAgICAgICBcIkFwcG9pbnRtZW50cyBvZiBVLiBTLiBQb3N0bWFzdGVyc1wiLFxuICAgICAgICBcIlBvbGljZSBQZW5zaW9uIFJlZ2lzdGVyc1wiLFxuICAgICAgXSxcbiAgICB9LFxuICAgIHsgdHlwZTogUlQuU29jaWFsU2VjdXJpdHksIG1hdGNoZXM6IFtcIlUuUy4sIFNvY2lhbCBTZWN1cml0eVwiXSB9LFxuICAgIHsgdHlwZTogUlQuTGFuZFRheCwgbWF0Y2hlczogW1wiTGFuZCBUYXggUmVkZW1wdGlvblwiLCBcIkxhbmQgVGF4IFJlY29yZHNcIl0gfSxcbiAgICB7XG4gICAgICB0eXBlOiBSVC5UYXgsXG4gICAgICBtYXRjaGVzOiBbXCJEaXJlY3QgVGF4IExpc3RzXCIsIFwiVGF4IGFuZCBFeG9uZXJhdGlvblwiLCBcIlRheCBMaXN0IFJlY29yZFwiLCBcIlRheCBSZWNvcmRcIl0sXG4gICAgfSxcbiAgICB7IHR5cGU6IFJULkFwcHJlbnRpY2VzaGlwLCBtYXRjaGVzOiBbXCJBcHByZW50aWNlcycgSW5kZW50dXJlc1wiXSB9LFxuICAgIHsgdHlwZTogUlQuT2JpdHVhcnksIG1hdGNoZXM6IFtcIk9iaXR1YXJ5XCIsIFwiT2JpdHVhcmllc1wiXSB9LFxuICAgIHtcbiAgICAgIHR5cGU6IFJULlNjaG9vbFJlY29yZHMsXG4gICAgICBtYXRjaGVzOiBbXCJTY2hvb2wgWWVhcmJvb2tcIiwgXCJTY2hvb2wgQWRtaXNzaW9uXCIsIFwiU2Nob29sIFJlZ2lzdGVyc1wiXSxcbiAgICB9LFxuICAgIHtcbiAgICAgIHR5cGU6IFJULk5hdHVyYWxpemF0aW9uLFxuICAgICAgbWF0Y2hlczogW1wiTmF0dXJhbGl6YXRpb24gUmVjb3JkXCIsIFwiTmF0dXJhbGlzYXRpb24gQ2VydGlmaWNhdGVcIl0sXG4gICAgfSxcbiAgICB7XG4gICAgICB0eXBlOiBSVC5MZWdhbFJlY29yZCxcbiAgICAgIG1hdGNoZXM6IFtcIkxhbmQgV2FycmFudFwiLCBcIkxhbmQgT2ZmaWNlIFJlY29yZHNcIiwgXCJIb21lc3RlYWQgR3JhbnRcIl0sXG4gICAgfSxcbiAgICB7IHR5cGU6IFJULkltbWlncmF0aW9uLCBtYXRjaGVzOiBbXCJJbW1pZ3JhdGlvbiBSZWNvcmRzXCJdIH0sXG4gICAgeyB0eXBlOiBSVC5FbWlncmF0aW9uLCBtYXRjaGVzOiBbXCJFbWlncmF0aW9uIFJlY29yZHNcIl0gfSxcbiAgICB7XG4gICAgICB0eXBlOiBSVC5DZXJ0aWZpY2F0ZSxcbiAgICAgIG1hdGNoZXM6IFtcIkNlcnRpZmljYXRlXCJdLFxuICAgICAgcmVxdWlyZWREYXRhOiBbXCJJc3N1ZSBEYXRlXCJdLFxuICAgIH0sXG4gICAge1xuICAgICAgdHlwZTogUlQuUmVzaWRlbmNlLFxuICAgICAgbWF0Y2hlczogW1wiUmVzaWRlbnRzXCIsIFwiVS5TLiwgUHVibGljIFJlY29yZHMgSW5kZXhcIl0sXG4gICAgICByZXF1aXJlZERhdGE6IFtcIlJlc2lkZW5jZSBQbGFjZVwiXSxcbiAgICB9LFxuICAgIHtcbiAgICAgIHR5cGU6IFJULlJlc2lkZW5jZSxcbiAgICAgIG1hdGNoZXM6IFtcIlUuUy4sIFB1YmxpYyBSZWNvcmRzIEluZGV4XCJdLFxuICAgICAgcmVxdWlyZWREYXRhOiBbXCJSZXNpZGVuY2VcIl0sXG4gICAgfSxcbiAgICB7XG4gICAgICB0eXBlOiBSVC5SZXNpZGVuY2UsXG4gICAgICBtYXRjaGVzOiBbXCJVLlMuLCBQdWJsaWMgUmVjb3JkcyBJbmRleFwiXSxcbiAgICAgIHJlcXVpcmVkRGF0YTogW1wiUmVzaWRlbmNlIERhdGVcIl0sXG4gICAgfSxcbiAgICB7XG4gICAgICB0eXBlOiBSVC5GYW1IaXN0T3JQZWRpZ3JlZSxcbiAgICAgIG1hdGNoZXM6IFtcIm9mIHRoZSBBbWVyaWNhbiBSZXZvbHV0aW9uIE1lbWJlcnNoaXBcIiwgXCJDb2xvbmlhbCBGYW1pbGllcyBvZiB0aGUgVVNBXCJdLFxuICAgIH0sXG4gICAge1xuICAgICAgLy8gVGhpcyBjb3VsZCBwb3NzaWJseSBiZSBjb25mdXNlZCB3aXRoIGEgY2hpbGQgbWFycmlhZ2UuIEl0IGlzIHRvIGhhbmRsZSBhIHJlY29yZCBsaWtlIHRoaXM6XG4gICAgICAvLyBodHRwczovL3d3dy5hbmNlc3RyeS5jb20vZGlzY292ZXJ5dWktY29udGVudC92aWV3LzE1NDMwNzA3MDo2MTAzOVxuICAgICAgdHlwZTogUlQuQmFwdGlzbSxcbiAgICAgIG1hdGNoZXM6IFtcIkNhdGhvbGljIFBhcmlzaCBSZWdpc3RlcnNcIl0sXG4gICAgICByZXF1aXJlZERhdGE6IFtcIk5hbWVcIiwgXCJDaGlsZFwiLCBcIkdlbmRlclwiXSxcbiAgICB9LFxuICAgIHtcbiAgICAgIHR5cGU6IFJULk1hcnJpYWdlUmVnaXN0cmF0aW9uLFxuICAgICAgbWF0Y2hlczogW1wiTWFycmlhZ2UgSW5kZXhcIl0sXG4gICAgICByZXF1aXJlZERhdGE6IFtcIk1hcnJpYWdlIFJlZ2lzdHJhdGlvbiBQbGFjZVwiLCBcIlNwb3VzZVwiXSxcbiAgICB9LFxuICAgIHtcbiAgICAgIHR5cGU6IFJULk1hcnJpYWdlLFxuICAgICAgbWF0Y2hlczogW1wiTWFycmlhZ2UgSW5kZXhcIl0sXG4gICAgICByZXF1aXJlZERhdGE6IFtcIlNwb3VzZVwiXSxcbiAgICB9LFxuICAgIHtcbiAgICAgIHR5cGU6IFJULkJpcnRoLFxuICAgICAgbWF0Y2hlczogW1wiQW1lcmljYW4gR2VuZWFsb2dpY2FsLUJpb2dyYXBoaWNhbCBJbmRleFwiXSxcbiAgICAgIHJlcXVpcmVkRGF0YTogW1wiQmlydGggRGF0ZVwiXSxcbiAgICB9LFxuICAgIHtcbiAgICAgIHR5cGU6IFJULk1pbGl0YXJ5LFxuICAgICAgbWF0Y2hlczogW1wiVmV0ZXJhblwiLCBcIlNvbGRpZXJcIiwgXCJNaWxpdGFyeVwiLCBcIkFybWVkXCJdLFxuICAgICAgcmVxdWlyZWREYXRhOiBbXCJSYW5rXCJdLFxuICAgIH0sXG4gICAge1xuICAgICAgdHlwZTogUlQuTWlsaXRhcnksXG4gICAgICBtYXRjaGVzOiBbXCJWZXRlcmFuc1wiLCBcIlNvbGRpZXJcIiwgXCJNaWxpdGFyeVwiLCBcIkFybWVkXCJdLFxuICAgICAgcmVxdWlyZWREYXRhOiBbXCJNdXN0ZXIgSW4gRGF0ZVwiXSxcbiAgICB9LFxuICAgIHsgdHlwZTogUlQuUGFzc3BvcnRBcHBsaWNhdGlvbiwgbWF0Y2hlczogW1wiUGFzc3BvcnQgQXBwbGljYXRpb25cIl0gfSxcbiAgICB7IHR5cGU6IFJULlBlbnNpb24sIG1hdGNoZXM6IFtcIlBlbnNpb24gSW5kZXhcIl0gfSxcbiAgXTtcblxuICAvL2NvbnNvbGUubG9nKFwiaW4gZGV0ZXJtaW5lUmVjb3JkVHlwZVwiKTtcbiAgLy9jb25zb2xlLmxvZyhleHRyYWN0ZWREYXRhKTtcblxuICBsZXQgZXZlbnRUeXBlU3RyaW5nID0gdW5kZWZpbmVkO1xuICBpZiAoZXh0cmFjdGVkRGF0YS5yZWNvcmREYXRhKSB7XG4gICAgZXZlbnRUeXBlU3RyaW5nID0gZXh0cmFjdGVkRGF0YS5yZWNvcmREYXRhW1wiRXZlbnQgVHlwZVwiXTtcbiAgICBpZiAoIWV2ZW50VHlwZVN0cmluZykge1xuICAgICAgZXZlbnRUeXBlU3RyaW5nID0gZXh0cmFjdGVkRGF0YS5yZWNvcmREYXRhW1wiUmVjb3JkIFR5cGVcIl07XG4gICAgfVxuICB9XG5cbiAgaWYgKGV2ZW50VHlwZVN0cmluZykge1xuICAgIGV2ZW50VHlwZVN0cmluZyA9IGV2ZW50VHlwZVN0cmluZy5yZXBsYWNlKC9cXHMvZywgXCJcIik7XG4gICAgbGV0IGRhdGFUeXBlID0gZXZlbnRUeXBlU3RyaW5nVG9EYXRhVHlwZVtldmVudFR5cGVTdHJpbmddO1xuICAgIGlmICghZGF0YVR5cGUpIHtcbiAgICAgIGNvbnNvbGUubG9nKFwiZGV0ZXJtaW5lUmVjb3JkVHlwZTogVW5yZWNvZ25pc2VkIGV2ZW50IHR5cGU6IFwiICsgZXZlbnRUeXBlU3RyaW5nKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIGRhdGFUeXBlO1xuICAgIH1cbiAgfVxuXG4gIGlmIChleHRyYWN0ZWREYXRhLnRpdGxlQ29sbGVjdGlvbikge1xuICAgIC8vIGNoZWNrIGZvciBiaXJ0aCBvciBkZWF0aCByZWdpc3RyYXRpb25cbiAgICBpZiAoZXh0cmFjdGVkRGF0YS50aXRsZUNvbGxlY3Rpb24uaW5jbHVkZXMoXCJSZWdpc3RyYXRpb25cIikpIHtcbiAgICAgIGlmIChleHRyYWN0ZWREYXRhLnRpdGxlQ29sbGVjdGlvbi5pbmNsdWRlcyhcIkJpcnRoXCIpKSB7XG4gICAgICAgIHJldHVybiBSVC5CaXJ0aFJlZ2lzdHJhdGlvbjtcbiAgICAgIH1cbiAgICAgIGlmIChleHRyYWN0ZWREYXRhLnRpdGxlQ29sbGVjdGlvbi5pbmNsdWRlcyhcIkRlYXRoXCIpKSB7XG4gICAgICAgIHJldHVybiBSVC5EZWF0aFJlZ2lzdHJhdGlvbjtcbiAgICAgIH1cbiAgICAgIGlmIChleHRyYWN0ZWREYXRhLnRpdGxlQ29sbGVjdGlvbi5pbmNsdWRlcyhcIk1hcnJpYWdlXCIpKSB7XG4gICAgICAgIHJldHVybiBSVC5NYXJyaWFnZVJlZ2lzdHJhdGlvbjtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBjaGVjayBmb3IgYSBtYXJyaWFnZVxuICAgIGlmIChcbiAgICAgIGV4dHJhY3RlZERhdGEudGl0bGVDb2xsZWN0aW9uLmluY2x1ZGVzKFwiTWFycmlhZ2VcIikgJiZcbiAgICAgIGV4dHJhY3RlZERhdGEucmVjb3JkRGF0YSAmJlxuICAgICAgZXh0cmFjdGVkRGF0YS5yZWNvcmREYXRhW1wiTWFycmlhZ2UgRGF0ZVwiXVxuICAgICkge1xuICAgICAgcmV0dXJuIFJULk1hcnJpYWdlO1xuICAgIH1cblxuICAgIGlmIChleHRyYWN0ZWREYXRhLnRpdGxlQ29sbGVjdGlvbi5pbmNsdWRlcyhcIkNyaW1pbmFsIFJlZ2lzdGVyXCIpKSB7XG4gICAgICByZXR1cm4gUlQuQ3JpbWluYWxSZWdpc3RlcjtcbiAgICB9XG5cbiAgICBpZiAoZXh0cmFjdGVkRGF0YS50aXRsZUNvbGxlY3Rpb24uaW5jbHVkZXMoXCJGcmVlbWFzb24gTWVtYmVyc2hpcFwiKSkge1xuICAgICAgcmV0dXJuIFJULkZyZWVtYXNvbk1lbWJlcnNoaXA7XG4gICAgfVxuXG4gICAgZm9yIChsZXQgdGl0bGVNYXRjaCBvZiB0aXRsZU1hdGNoZXMpIHtcbiAgICAgIGxldCB0aXRsZU1hdGNoZWQgPSBmYWxzZTtcbiAgICAgIGZvciAobGV0IG1hdGNoIG9mIHRpdGxlTWF0Y2gubWF0Y2hlcykge1xuICAgICAgICBpZiAoZXh0cmFjdGVkRGF0YS50aXRsZUNvbGxlY3Rpb24uaW5jbHVkZXMobWF0Y2gpKSB7XG4gICAgICAgICAgdGl0bGVNYXRjaGVkID0gdHJ1ZTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKCF0aXRsZU1hdGNoZWQpIHtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG5cbiAgICAgIGlmICh0aXRsZU1hdGNoLnNlY29uZE1hdGNoZXMpIHtcbiAgICAgICAgbGV0IHNlY29uZFRpdGxlTWF0Y2hlZCA9IGZhbHNlO1xuICAgICAgICBmb3IgKGxldCBtYXRjaCBvZiB0aXRsZU1hdGNoLnNlY29uZE1hdGNoZXMpIHtcbiAgICAgICAgICBpZiAoZXh0cmFjdGVkRGF0YS50aXRsZUNvbGxlY3Rpb24uaW5jbHVkZXMobWF0Y2gpKSB7XG4gICAgICAgICAgICBzZWNvbmRUaXRsZU1hdGNoZWQgPSB0cnVlO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmICghc2Vjb25kVGl0bGVNYXRjaGVkKSB7XG4gICAgICAgICAgY29udGludWU7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgaWYgKCF0aXRsZU1hdGNoLnJlcXVpcmVkRGF0YSkge1xuICAgICAgICByZXR1cm4gdGl0bGVNYXRjaC50eXBlO1xuICAgICAgfSBlbHNlIGlmIChleHRyYWN0ZWREYXRhLnJlY29yZERhdGEpIHtcbiAgICAgICAgbGV0IG1hdGNoID0gdHJ1ZTtcbiAgICAgICAgZm9yIChsZXQgZmllbGROYW1lIG9mIHRpdGxlTWF0Y2gucmVxdWlyZWREYXRhKSB7XG4gICAgICAgICAgaWYgKCFleHRyYWN0ZWREYXRhLnJlY29yZERhdGFbZmllbGROYW1lXSkge1xuICAgICAgICAgICAgbWF0Y2ggPSBmYWxzZTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAobWF0Y2gpIHtcbiAgICAgICAgICByZXR1cm4gdGl0bGVNYXRjaC50eXBlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLy8gVGhlIHRpdGxlIGFuZCByZWNvcmQvZXZlbnQgdHlwZSBoYXZlIG5vdCBpZGVudGZpZWQgdGhlIHJlY29yZFxuICAvLyBUcnkgdG8gY2xhc3NpZnkgaXQgdXNpbmcgcmVjb3JkRGF0YSBmaWVsZCBuYW1lc1xuICBpZiAoZXh0cmFjdGVkRGF0YS5yZWNvcmREYXRhKSB7XG4gICAgZm9yIChsZXQgZW50cnkgb2YgcmVjb3JkVHlwZUJ5RmllbGRzKSB7XG4gICAgICBsZXQgbWF0Y2ggPSB0cnVlO1xuICAgICAgZm9yIChsZXQgZmllbGROYW1lIG9mIGVudHJ5LmxhYmVscykge1xuICAgICAgICBpZiAoIWV4dHJhY3RlZERhdGEucmVjb3JkRGF0YVtmaWVsZE5hbWVdKSB7XG4gICAgICAgICAgbWF0Y2ggPSBmYWxzZTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpZiAobWF0Y2gpIHtcbiAgICAgICAgcmV0dXJuIGVudHJ5LnR5cGU7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIFJULlVuY2xhc3NpZmllZDtcbn1cblxuZnVuY3Rpb24gZGV0ZXJtaW5lUm9sZUdpdmVuUmVjb3JkVHlwZShleHRyYWN0ZWREYXRhLCByZXN1bHQpIHtcbiAgLy9jb25zb2xlLmxvZyhcImRldGVybWluZVJvbGVHaXZlblJlY29yZFR5cGUsIHJlY29yZFR5cGUgaXM6IFwiICsgcmVzdWx0LnJlY29yZFR5cGUpO1xuICAvL2NvbnNvbGUubG9nKFwiZGV0ZXJtaW5lUm9sZUdpdmVuUmVjb3JkVHlwZSwgZXh0cmFjdGVkRGF0YSBpczogXCIpO1xuICAvL2NvbnNvbGUubG9nKGV4dHJhY3RlZERhdGEpO1xuXG4gIGlmICghZXh0cmFjdGVkRGF0YS5yZWNvcmREYXRhKSB7XG4gICAgcmV0dXJuOyAvLyBjYW4ndCBhc3NpZ24gYSByb2xlXG4gIH1cblxuICBsZXQgcmVjb3JkVHlwZSA9IHJlc3VsdC5yZWNvcmRUeXBlO1xuXG4gIGlmIChyZWNvcmRUeXBlID09IFJULkJhcHRpc20gfHwgcmVjb3JkVHlwZSA9PSBSVC5CaXJ0aCB8fCByZWNvcmRUeXBlID09IFJULkJpcnRoT3JCYXB0aXNtKSB7XG4gICAgLy8gaWYgdGhlcmUgaXMgYSBiYXB0aXNtIGRhdGUgZXRjIHRoZW4gdGhpcyBpcyBsaWtlbHkgYSByZWNvcmQgZm9yIHRoaXMgcGVyc29uIG5vdCBhXG4gICAgLy8gY2hpbGQgb3Igc3BvdXNlLiBUaGVyZSBjb3VsZCBiZSBhIGJpcnRoIGRhdGUgdGhvdWdoIC0gZm9yIHRoZSBwYXJlbnQgb2YgdGhlIGNoaWxkXG4gICAgLy8gZS5nLjogaHR0cHM6Ly93d3cuYW5jZXN0cnkuY29tL2Rpc2NvdmVyeXVpLWNvbnRlbnQvdmlldy8zMDAwNjU2MjM6ODcwMz9zc3JjPXB0JnRpZD0xODAzMjA3MzEmcGlkPTQxMjQxOTgzMDkyNVxuICAgIGxldCB2YWx1ZSA9IGdldENsZWFuVmFsdWVGb3JSZWNvcmREYXRhTGlzdChleHRyYWN0ZWREYXRhLCBbXCJCYXB0aXNtIERhdGVcIiwgXCJDaHJpc3RlbmluZyBEYXRlXCJdKTtcbiAgICBpZiAoIXZhbHVlKSB7XG4gICAgICBpZiAoZXh0cmFjdGVkRGF0YS5yZWNvcmREYXRhW1wiQ2hpbGRcIl0pIHtcbiAgICAgICAgLy8gc29tZSBmYW1pbHkgcmVjb3JkcyBoYXZlIGFsbCBwYXJlbnRzIGFuZCBjaGlsZHJlbiBvZiB0aGUgcHJpbWFyeSBwZXJzb25cbiAgICAgICAgLy8gaWdub3JlIGlmIEZhdGhlciBvciBNb3RoZXIgZmllbGRzXG4gICAgICAgIGlmICghZXh0cmFjdGVkRGF0YS5yZWNvcmREYXRhW1wiRmF0aGVyXCJdICYmICFleHRyYWN0ZWREYXRhLnJlY29yZERhdGFbXCJNb3RoZXJcIl0pIHtcbiAgICAgICAgICByZXN1bHQucm9sZSA9IFJvbGUuUGFyZW50O1xuICAgICAgICAgIHJlc3VsdC5wcmltYXJ5UGVyc29uID0gZXh0cmFjdGVkRGF0YS5yZWNvcmREYXRhW1wiQ2hpbGRcIl07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH0gZWxzZSBpZiAocmVjb3JkVHlwZSA9PSBSVC5EZWF0aCB8fCByZWNvcmRUeXBlID09IFJULkRlYXRoUmVnaXN0cmF0aW9uIHx8IHJlY29yZFR5cGUgPT0gUlQuQnVyaWFsKSB7XG4gICAgLy8gaWYgdGhlcmUgaXMgYSBkZWF0aCBvciBidXJpYWwgZGF0ZSBldGMgdGhlbiB0aGlzIGlzIGxpa2VseSBhIHJlY29yZCBmb3IgdGhpcyBwZXJzb24gbm90IGFcbiAgICAvLyBjaGlsZCBvciBzcG91c2VcbiAgICBsZXQgdmFsdWUgPSBnZXRDbGVhblZhbHVlRm9yUmVjb3JkRGF0YUxpc3QoZXh0cmFjdGVkRGF0YSwgW1xuICAgICAgXCJEZWF0aCBEYXRlXCIsXG4gICAgICBcIkJ1cmlhbCBEYXRlXCIsXG4gICAgICBcIkNyZW1hdGlvbiBEYXRlXCIsXG4gICAgICBcIkJ1cmlhbCBZZWFyXCIsXG4gICAgXSk7XG4gICAgaWYgKCF2YWx1ZSkge1xuICAgICAgaWYgKGV4dHJhY3RlZERhdGEucmVjb3JkRGF0YVtcIkNoaWxkXCJdKSB7XG4gICAgICAgIHJlc3VsdC5yb2xlID0gUm9sZS5QYXJlbnQ7XG4gICAgICAgIHJlc3VsdC5wcmltYXJ5UGVyc29uID0gZXh0cmFjdGVkRGF0YS5yZWNvcmREYXRhW1wiQ2hpbGRcIl07XG4gICAgICB9IGVsc2UgaWYgKGV4dHJhY3RlZERhdGEucmVjb3JkRGF0YVtcIlNwb3VzZVwiXSkge1xuICAgICAgICBpZiAoXG4gICAgICAgICAgIWV4dHJhY3RlZERhdGEucmVjb3JkRGF0YVtcIkRlYXRoIERhdGVcIl0gJiZcbiAgICAgICAgICAhZXh0cmFjdGVkRGF0YS5yZWNvcmREYXRhW1wiRGVhdGggUGxhY2VcIl0gJiZcbiAgICAgICAgICAhZXh0cmFjdGVkRGF0YS5yZWNvcmREYXRhW1wiQnVyaWFsIERhdGVcIl0gJiZcbiAgICAgICAgICAhZXh0cmFjdGVkRGF0YS5yZWNvcmREYXRhW1wiQnVyaWFsIFllYXJcIl0gJiZcbiAgICAgICAgICAhZXh0cmFjdGVkRGF0YS5yZWNvcmREYXRhW1wiQnVyaWFsIFBsYWNlXCJdXG4gICAgICAgICkge1xuICAgICAgICAgIHJlc3VsdC5yb2xlID0gUm9sZS5TcG91c2U7XG4gICAgICAgICAgcmVzdWx0LnByaW1hcnlQZXJzb24gPSBleHRyYWN0ZWREYXRhLnJlY29yZERhdGFbXCJTcG91c2VcIl07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH0gZWxzZSBpZiAocmVjb3JkVHlwZSA9PSBSVC5NYXJyaWFnZSB8fCByZWNvcmRUeXBlID09IFJULk1hcnJpYWdlUmVnaXN0cmF0aW9uKSB7XG4gICAgLy8gaWYgdGhlcmUgaXMgYSBkYXRlIGV0YyB0aGVuIHRoaXMgaXMgbGlrZWx5IGEgcmVjb3JkIGZvciB0aGlzIHBlcnNvbiBub3QgYVxuICAgIC8vIGNoaWxkIG9yIHNwb3VzZVxuICAgIGxldCB2YWx1ZSA9IGdldENsZWFuVmFsdWVGb3JSZWNvcmREYXRhTGlzdChleHRyYWN0ZWREYXRhLCBbXCJNYXJyaWFnZSBEYXRlXCJdKTtcbiAgICBpZiAoIXZhbHVlKSB7XG4gICAgICBpZiAoZXh0cmFjdGVkRGF0YS5yZWNvcmREYXRhW1wiQ2hpbGRcIl0pIHtcbiAgICAgICAgaWYgKCFleHRyYWN0ZWREYXRhLnJlY29yZERhdGFbXCJGYXRoZXJcIl0gJiYgIWV4dHJhY3RlZERhdGEucmVjb3JkRGF0YVtcIk1vdGhlclwiXSkge1xuICAgICAgICAgIHJlc3VsdC5yb2xlID0gUm9sZS5QYXJlbnQ7XG4gICAgICAgICAgcmVzdWx0LnByaW1hcnlQZXJzb24gPSBleHRyYWN0ZWREYXRhLnJlY29yZERhdGFbXCJDaGlsZFwiXTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuICAvLyBwb3NzaWJseSBhbnkgb3RoZXIgdHlwZSBzaG91bGQgZ28gdGhyb3VnaCBoZXJlP1xuICAvLyBXZSBjb3VsZCBwb3NzaWJseSB0ZXN0IGlmIHJlY29yZERhdGEgbnVtIHByb3BlcnRpZXMgaXMgPD0gNCBvciBzb21ldGhpbmcgbGlrZSB0aGF0XG4gIGVsc2UgaWYgKHJlY29yZFR5cGUgPT0gUlQuVW5jbGFzc2lmaWVkIHx8IHJlY29yZFR5cGUgPT0gUlQuRW1wbG95bWVudCkge1xuICAgIGxldCB2YWx1ZSA9IGdldENsZWFuVmFsdWVGb3JSZWNvcmREYXRhTGlzdChleHRyYWN0ZWREYXRhLCBbXG4gICAgICBcIkJpcnRoIERhdGVcIixcbiAgICAgIFwiQmFwdGlzbSBEYXRlXCIsXG4gICAgICBcIkNocmlzdGVuaW5nIERhdGVcIixcbiAgICAgIFwiRGVhdGggRGF0ZVwiLFxuICAgICAgXCJCdXJpYWwgRGF0ZVwiLFxuICAgICAgXCJDcmVtYXRpb24gRGF0ZVwiLFxuICAgICAgXCJNYXJyaWFnZSBEYXRlXCIsXG4gICAgXSk7XG4gICAgaWYgKCF2YWx1ZSkge1xuICAgICAgaWYgKGV4dHJhY3RlZERhdGEucmVjb3JkRGF0YVtcIkNoaWxkXCJdKSB7XG4gICAgICAgIGlmICghZXh0cmFjdGVkRGF0YS5yZWNvcmREYXRhW1wiRmF0aGVyXCJdICYmICFleHRyYWN0ZWREYXRhLnJlY29yZERhdGFbXCJNb3RoZXJcIl0pIHtcbiAgICAgICAgICByZXN1bHQucm9sZSA9IFJvbGUuUGFyZW50O1xuICAgICAgICAgIHJlc3VsdC5wcmltYXJ5UGVyc29uID0gZXh0cmFjdGVkRGF0YS5yZWNvcmREYXRhW1wiQ2hpbGRcIl07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH0gZWxzZSBpZiAocmVjb3JkVHlwZSA9PSBSVC5PYml0dWFyeSkge1xuICAgIC8vIG9iaXR1YXJ5IGNhbiBoYXZlIGxvdHMgb2YgcmVsYXRpb25zXG4gICAgbGV0IHZhbHVlID0gZ2V0Q2xlYW5WYWx1ZUZvclJlY29yZERhdGFMaXN0KGV4dHJhY3RlZERhdGEsIFtcbiAgICAgIFwiRGVhdGggRGF0ZVwiLFxuICAgICAgXCJCdXJpYWwgRGF0ZVwiLFxuICAgICAgXCJDcmVtYXRpb24gRGF0ZVwiLFxuICAgICAgXCJCdXJpYWwgWWVhclwiLFxuICAgIF0pO1xuICAgIGlmICghdmFsdWUpIHtcbiAgICAgIGlmIChcbiAgICAgICAgIWV4dHJhY3RlZERhdGEucmVjb3JkRGF0YVtcIkRlYXRoIERhdGVcIl0gJiZcbiAgICAgICAgIWV4dHJhY3RlZERhdGEucmVjb3JkRGF0YVtcIkRlYXRoIFBsYWNlXCJdICYmXG4gICAgICAgICFleHRyYWN0ZWREYXRhLnJlY29yZERhdGFbXCJEZWF0aCBBZ2VcIl1cbiAgICAgICkge1xuICAgICAgICBpZiAoZXh0cmFjdGVkRGF0YS5yZWNvcmREYXRhW1wiQ2hpbGRcIl0pIHtcbiAgICAgICAgICByZXN1bHQucm9sZSA9IFJvbGUuUGFyZW50O1xuICAgICAgICAgIHJlc3VsdC5wcmltYXJ5UGVyc29uID0gZXh0cmFjdGVkRGF0YS5yZWNvcmREYXRhW1wiQ2hpbGRcIl07XG4gICAgICAgIH0gZWxzZSBpZiAoZXh0cmFjdGVkRGF0YS5yZWNvcmREYXRhW1wiU3BvdXNlXCJdKSB7XG4gICAgICAgICAgcmVzdWx0LnJvbGUgPSBSb2xlLlNwb3VzZTtcbiAgICAgICAgICByZXN1bHQucHJpbWFyeVBlcnNvbiA9IGV4dHJhY3RlZERhdGEucmVjb3JkRGF0YVtcIlNwb3VzZVwiXTtcbiAgICAgICAgfSBlbHNlIGlmIChleHRyYWN0ZWREYXRhLnJlY29yZERhdGFbXCJGYXRoZXJcIl0pIHtcbiAgICAgICAgICByZXN1bHQucm9sZSA9IFJvbGUuQ2hpbGQ7XG4gICAgICAgICAgcmVzdWx0LnByaW1hcnlQZXJzb24gPSBleHRyYWN0ZWREYXRhLnJlY29yZERhdGFbXCJGYXRoZXJcIl07XG4gICAgICAgIH0gZWxzZSBpZiAoZXh0cmFjdGVkRGF0YS5yZWNvcmREYXRhW1wiTW90aGVyXCJdKSB7XG4gICAgICAgICAgcmVzdWx0LnJvbGUgPSBSb2xlLkNoaWxkO1xuICAgICAgICAgIHJlc3VsdC5wcmltYXJ5UGVyc29uID0gZXh0cmFjdGVkRGF0YS5yZWNvcmREYXRhW1wiTW90aGVyXCJdO1xuICAgICAgICB9IGVsc2UgaWYgKGV4dHJhY3RlZERhdGEucmVjb3JkRGF0YVtcIlNpYmxpbmdzXCJdKSB7XG4gICAgICAgICAgcmVzdWx0LnJvbGUgPSBSb2xlLlNpYmxpbmc7XG4gICAgICAgICAgcmVzdWx0LnByaW1hcnlQZXJzb24gPSBleHRyYWN0ZWREYXRhLnJlY29yZERhdGFbXCJTaWJsaW5nc1wiXTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8vY29uc29sZS5sb2coXCJkZXRlcm1pbmVSb2xlR2l2ZW5SZWNvcmRUeXBlLiByb2xlIGlzOiBcIiArIHJlc3VsdC5yb2xlKTtcbn1cblxuZnVuY3Rpb24gZGV0ZXJtaW5lUmVjb3JkVHlwZUFuZFJvbGUoZXh0cmFjdGVkRGF0YSwgcmVzdWx0KSB7XG4gIHJlc3VsdC5yZWNvcmRUeXBlID0gZGV0ZXJtaW5lUmVjb3JkVHlwZShleHRyYWN0ZWREYXRhKTtcbiAgZGV0ZXJtaW5lUm9sZUdpdmVuUmVjb3JkVHlwZShleHRyYWN0ZWREYXRhLCByZXN1bHQpO1xufVxuXG5mdW5jdGlvbiBtb250aFN0clRvTnVtKG1vbnRoU3RyKSB7XG4gIGNvbnN0IG1vbnRocyA9IFtcIkphblwiLCBcIkZlYlwiLCBcIk1hclwiLCBcIkFwclwiLCBcIk1heVwiLCBcIkp1blwiLCBcIkp1bFwiLCBcIkF1Z1wiLCBcIlNlcFwiLCBcIk9jdFwiLCBcIk5vdlwiLCBcIkRlY1wiXTtcblxuICBmb3IgKGxldCBpID0gMDsgaSA8IG1vbnRocy5sZW5ndGg7ICsraSkge1xuICAgIGlmIChtb250aFN0ci5zdGFydHNXaXRoKG1vbnRoc1tpXSkpIHtcbiAgICAgIHJldHVybiBpICsgMTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gMDtcbn1cblxuZnVuY3Rpb24gY2xlYW5EYXRlU3RyaW5nKGRhdGVTdHJpbmcpIHtcbiAgLy8gc29tZXRpbWVzIHJlY29yZHMgaGF2ZSBkYXRlcyBsaWtlIHRoaXM6XG4gIC8vIDI1LiBKdW4gMTg0MCAoMjUgSnVuIDE4NDApXG5cbiAgbGV0IG5ld1N0cmluZyA9IGRhdGVTdHJpbmcudHJpbSgpO1xuICBuZXdTdHJpbmcgPSBuZXdTdHJpbmcucmVwbGFjZShcInMrXCIsIFwiIFwiKTtcblxuICBpZiAoL15cXGRcXGQ/IFxcd1xcd1xcdyBcXGRcXGRcXGRcXGQkLy50ZXN0KG5ld1N0cmluZykpIHtcbiAgICAvLyB0aGlzIGlzIHRoZSBcIm5vcm1hbFwiIGZvcm1hdCBmb3IgYW4gQW5jZXN0cnkgZGF0ZSBzdHJpbmdcbiAgICByZXR1cm4gbmV3U3RyaW5nO1xuICB9XG5cbiAgbGV0IG9wZW5QYXJlbkluZGV4ID0gbmV3U3RyaW5nLmluZGV4T2YoXCIoXCIpO1xuICBpZiAob3BlblBhcmVuSW5kZXggIT0gLTEpIHtcbiAgICAvLyB0aGVyZSBpcyBhbiBvcGVuIHBhcmVudGhlc2VzXG4gICAgbGV0IGNsb3NlUGFyZW5JbmRleCA9IG5ld1N0cmluZy5pbmRleE9mKFwiKVwiKTtcbiAgICBpZiAoY2xvc2VQYXJlbkluZGV4ICE9IC0xICYmIGNsb3NlUGFyZW5JbmRleCA+IG9wZW5QYXJlbkluZGV4KSB7XG4gICAgICBsZXQgZmlyc3REYXRlU3RyaW5nID0gbmV3U3RyaW5nLnN1YnN0cmluZygwLCBvcGVuUGFyZW5JbmRleCkudHJpbSgpO1xuICAgICAgbGV0IHNlY29uZERhdGVTdHJpbmcgPSBuZXdTdHJpbmcuc3Vic3RyaW5nKG9wZW5QYXJlbkluZGV4ICsgMSwgY2xvc2VQYXJlbkluZGV4KS50cmltKCk7XG4gICAgICBpZiAoL15cXGRcXGQ/IFxcd1xcd1xcdyBcXGRcXGRcXGRcXGQkLy50ZXN0KHNlY29uZERhdGVTdHJpbmcpKSB7XG4gICAgICAgIHJldHVybiBzZWNvbmREYXRlU3RyaW5nO1xuICAgICAgfVxuICAgICAgaWYgKC9eXFxkXFxkPyBcXHdcXHdcXHcgXFxkXFxkXFxkXFxkJC8udGVzdChmaXJzdERhdGVTdHJpbmcpKSB7XG4gICAgICAgIHJldHVybiBmaXJzdERhdGVTdHJpbmc7XG4gICAgICB9XG5cbiAgICAgIC8vIG5laXRoZXIgZGF0ZSBpcyBleHBlY3RlZCBmb3JtYXQuIEp1c3QgdXNlIHRoZSBvbmUgaW4gcGFyZW50cyBhbmQgY29udGludWUgY2hlY2tzXG4gICAgICBuZXdTdHJpbmcgPSBzZWNvbmREYXRlU3RyaW5nO1xuICAgIH0gZWxzZSB7XG4gICAgICBuZXdTdHJpbmcgPSBuZXdTdHJpbmcuc3Vic3RyaW5nKDAsIG9wZW5QYXJlbkluZGV4KS50cmltKCk7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIG5ld1N0cmluZztcbn1cblxuZnVuY3Rpb24gZ2V0Q2xlYW5SZWNvcmREYXRhVmFsdWUoZGF0YSwgZmllbGROYW1lLCB0eXBlID0gXCJcIikge1xuICBpZiAoIWRhdGEucmVjb3JkRGF0YSkge1xuICAgIHJldHVybiBcIlwiO1xuICB9XG5cbiAgbGV0IHZhbHVlID0gZGF0YS5yZWNvcmREYXRhW2ZpZWxkTmFtZV07XG4gIGlmICh2YWx1ZSA9PSB1bmRlZmluZWQpIHtcbiAgICByZXR1cm4gdmFsdWU7XG4gIH1cblxuICAvLyBzb21ldGltZXMgdGhlcmUgYXJlIHZhbHVlcyBpbiBzcXVhcmUgYnJhY2tldHMgYWZ0ZXIgdGhlIGZpcnN0IHZhbHVlXG4gIC8vIHRoZXNlIG1ha2UgaXQgaGFyZCB0byBwYXJzZSBkYXRlcywgcGxhY3NlcyBuYW1lcyBldGMgc28gcmVtb3ZlIHRoZW1cbiAgbGV0IGJyYWNrZXRJbmRleCA9IHZhbHVlLmluZGV4T2YoXCJbXCIpO1xuICBpZiAoYnJhY2tldEluZGV4ICE9IC0xKSB7XG4gICAgdmFsdWUgPSB2YWx1ZS5zdWJzdHJpbmcoMCwgYnJhY2tldEluZGV4KS50cmltKCk7XG4gIH1cblxuICAvLyBzb21ldGltZXMgcGxhY2VzIGhhdmUgY29tbWFzIHdpdGggbm8gc3BhY2UgYWZ0ZXIgdGhlbVxuICB2YWx1ZSA9IHZhbHVlLnJlcGxhY2UoL1xcLChbXlxcc10pL2csIFwiLCAkMVwiKTtcblxuICBpZiAodHlwZSA9PSBcImRhdGVcIikge1xuICAgIHZhbHVlID0gY2xlYW5EYXRlU3RyaW5nKHZhbHVlKTtcbiAgfVxuXG4gIHJldHVybiB2YWx1ZTtcbn1cblxuZnVuY3Rpb24gZ2V0Q2xlYW5WYWx1ZUZvclJlY29yZERhdGFMaXN0KGRhdGEsIGZpZWxkTmFtZXMsIHR5cGUgPSBcIlwiKSB7XG4gIGZvciAobGV0IGZpZWxkTmFtZSBvZiBmaWVsZE5hbWVzKSB7XG4gICAgbGV0IHZhbHVlID0gZ2V0Q2xlYW5SZWNvcmREYXRhVmFsdWUoZGF0YSwgZmllbGROYW1lLCB0eXBlKTtcbiAgICBpZiAodmFsdWUpIHtcbiAgICAgIHJldHVybiB2YWx1ZTtcbiAgICB9XG4gIH1cbn1cblxuZnVuY3Rpb24gYnVpbGRQYXJlbnRzKGRhdGEsIHJlc3VsdCkge1xuICBsZXQgZmF0aGVyTmFtZSA9IGdldENsZWFuVmFsdWVGb3JSZWNvcmREYXRhTGlzdChkYXRhLCBbXCJGYXRoZXJcIiwgXCJGYXRoZXIgTmFtZVwiXSk7XG4gIGlmIChmYXRoZXJOYW1lKSB7XG4gICAgbGV0IGZhdGhlciA9IHJlc3VsdC5hZGRGYXRoZXIoKTtcbiAgICBmYXRoZXIubmFtZS5uYW1lID0gZmF0aGVyTmFtZTtcbiAgfVxuICBsZXQgbW90aGVyTmFtZSA9IGdldENsZWFuVmFsdWVGb3JSZWNvcmREYXRhTGlzdChkYXRhLCBbXCJNb3RoZXJcIiwgXCJNb3RoZXIgTmFtZVwiXSk7XG4gIGlmIChtb3RoZXJOYW1lKSB7XG4gICAgbGV0IG1vdGhlciA9IHJlc3VsdC5hZGRNb3RoZXIoKTtcbiAgICBtb3RoZXIubmFtZS5uYW1lID0gbW90aGVyTmFtZTtcbiAgfVxuXG4gIGxldCBtbW4gPSBnZXRDbGVhblZhbHVlRm9yUmVjb3JkRGF0YUxpc3QoZGF0YSwgW1wiTW90aGVyIE1haWRlbiBOYW1lXCIsIFwiTW90aGVyJ3MgTWFpZGVuIE5hbWVcIl0pO1xuICBpZiAobW1uKSB7XG4gICAgcmVzdWx0Lm1vdGhlcnNNYWlkZW5OYW1lID0gbW1uO1xuICB9XG59XG5cbmZ1bmN0aW9uIGJ1aWxkRXZlbnRQbGFjZShkYXRhLCByZXN1bHQsIGluY2x1ZGVSZXNpZGVuY2UpIHtcbiAgbGV0IGNvdW50cnkgPSBnZXRDbGVhblZhbHVlRm9yUmVjb3JkRGF0YUxpc3QoZGF0YSwgW1wiQ291bnRyeVwiXSk7XG4gIGxldCBzdGF0ZSA9IGdldENsZWFuVmFsdWVGb3JSZWNvcmREYXRhTGlzdChkYXRhLCBbXCJTdGF0ZVwiLCBcIlByb3ZpbmNlXCJdKTtcbiAgbGV0IGNvdW50eSA9IGdldENsZWFuVmFsdWVGb3JSZWNvcmREYXRhTGlzdChkYXRhLCBbXCJDb3VudHkvSXNsYW5kXCIsIFwiQ291bnR5XCIsIFwiQ291bnR5IG9yIEJvcm91Z2hcIl0pO1xuICBsZXQgY2l2aWxQYXJpc2ggPSBnZXRDbGVhblZhbHVlRm9yUmVjb3JkRGF0YUxpc3QoZGF0YSwgW1wiQ2l2aWwgUGFyaXNoXCIsIFwiQ2l2aWwgcGFyaXNoXCIsIFwiUGFyaXNoXCJdKTtcbiAgbGV0IHRvd24gPSBnZXRDbGVhblZhbHVlRm9yUmVjb3JkRGF0YUxpc3QoZGF0YSwgW1wiVG93blwiLCBcIldhcmQgb3IgRGl2aXNpb24vQ29uc3RpdHVlbmN5XCIsIFwiTG9jYWxpdHlcIl0pO1xuICBsZXQgc3RyZWV0QWRkcmVzcyA9IGdldENsZWFuVmFsdWVGb3JSZWNvcmREYXRhTGlzdChkYXRhLCBbXCJTdHJlZXQgQWRkcmVzc1wiLCBcIkFkZHJlc3NcIl0pO1xuICBsZXQgaG91c2VOdW1iZXIgPSBnZXRDbGVhblZhbHVlRm9yUmVjb3JkRGF0YUxpc3QoZGF0YSwgW1wiSG91c2UgTnVtYmVyXCJdKTtcbiAgbGV0IHJlc2lkZW5jZSA9IFwiXCI7XG5cbiAgaWYgKGluY2x1ZGVSZXNpZGVuY2UpIHtcbiAgICBpZiAoIWNvdW50cnkpIHtcbiAgICAgIGNvdW50cnkgPSBnZXRDbGVhblZhbHVlRm9yUmVjb3JkRGF0YUxpc3QoZGF0YSwgW1wiUmVzaWRlbmNlIENvdW50cnlcIl0pO1xuICAgIH1cbiAgICBpZiAoIXN0YXRlKSB7XG4gICAgICBzdGF0ZSA9IGdldENsZWFuVmFsdWVGb3JSZWNvcmREYXRhTGlzdChkYXRhLCBbXCJSZXNpZGVuY2UgU3RhdGVcIiwgXCJSZXNpZGVuY2UgUHJvdmluY2Ugb3IgVGVycml0b3J5XCJdKTtcbiAgICB9XG4gICAgaWYgKCFjb3VudHkpIHtcbiAgICAgIGNvdW50eSA9IGdldENsZWFuVmFsdWVGb3JSZWNvcmREYXRhTGlzdChkYXRhLCBbXG4gICAgICAgIFwiQ291bnR5L0lzbGFuZFwiLFxuICAgICAgICBcIkNvdW50eVwiLFxuICAgICAgICBcIkNvdW50eSBvciBCb3JvdWdoXCIsXG4gICAgICAgIFwiUmVzaWRlbmNlIENvdW50eVwiLFxuICAgICAgXSk7XG4gICAgfVxuICAgIGlmICghdG93bikge1xuICAgICAgdG93biA9IGdldENsZWFuVmFsdWVGb3JSZWNvcmREYXRhTGlzdChkYXRhLCBbXCJQbGFjZSBvZiBIYWJpdGF0aW9uXCIsIFwiUmVzaWRlbmNlIERpc3RyaWN0XCJdKTtcbiAgICB9XG4gICAgaWYgKCFzdHJlZXRBZGRyZXNzKSB7XG4gICAgICBzdHJlZXRBZGRyZXNzID0gZ2V0Q2xlYW5WYWx1ZUZvclJlY29yZERhdGFMaXN0KGRhdGEsIFtcbiAgICAgICAgXCJTdHJlZXQgQWRkcmVzc1wiLFxuICAgICAgICBcIkFkZHJlc3NcIixcbiAgICAgICAgXCJSZXNpZGVuY2UgU3RyZWV0IG9yIFRvd25zaGlwXCIsXG4gICAgICBdKTtcbiAgICB9XG5cbiAgICBsZXQgeWVhclN0cmluZyA9IHJlc3VsdC5pbmZlckV2ZW50WWVhcigpO1xuICAgIGxldCBob21lU3RyaW5nID0gXCJIb21lIGluIFwiICsgeWVhclN0cmluZzsgLy8gbGFiZWwgdXNlZCBpbiBVUyBmZWRlcmFsIGNlbnN1c1xuICAgIGxldCBob21lU3RyaW5nMiA9IFwiSG9tZSBpbiBcIiArIHllYXJTdHJpbmcgKyBcIiAoQ2l0eSwgQ291bnR5LCBTdGF0ZSlcIjsgLy8gbGFiZWwgdXNlZCBpbiBVUyAxODAwLTE4NDAgZmVkZXJhbCBjZW5zdXNcbiAgICByZXNpZGVuY2UgPSBnZXRDbGVhblZhbHVlRm9yUmVjb3JkRGF0YUxpc3QoZGF0YSwgW1wiUmVzaWRlbmNlXCIsIFwiUmVzaWRlbmNlIFBsYWNlXCIsIGhvbWVTdHJpbmcsIGhvbWVTdHJpbmcyXSk7XG4gIH1cblxuICBsZXQgcGxhY2VTdHJpbmcgPSBcIlwiO1xuICBpZiAocmVzaWRlbmNlICYmIHJlc2lkZW5jZS5pbmNsdWRlcyhcIixcIikpIHtcbiAgICAvLyBmb3IgZXhhbXBsZSBpbiBVUyBzdGF0ZSBjZW5zdXMgUmVzaWRlbmNlIGlzIHRoZSBmdWxsIGFkZHJlc3MuIEl0IGlzIGluIFVLIDE4OTEgY2Vuc3VzIHRvb1xuICAgIC8vIEl0IGlzIG5vdCBpbiBPbnRhcmlvLCBDYW5hZGEsIENvdW50eSBNYXJyaWFnZSBSZWdpc3RlcnMsIDE4NTgtMTg2OSB0aG91Z2hcbiAgICBwbGFjZVN0cmluZyArPSByZXNpZGVuY2U7XG4gIH0gZWxzZSB7XG4gICAgaWYgKHN0cmVldEFkZHJlc3MpIHtcbiAgICAgIGlmIChob3VzZU51bWJlciAmJiAhc3RyZWV0QWRkcmVzcy5zdGFydHNXaXRoKGhvdXNlTnVtYmVyKSkge1xuICAgICAgICBwbGFjZVN0cmluZyArPSBob3VzZU51bWJlciArIFwiIFwiO1xuICAgICAgfVxuICAgICAgcGxhY2VTdHJpbmcgKz0gc3RyZWV0QWRkcmVzcztcbiAgICB9IGVsc2UgaWYgKHJlc2lkZW5jZSkge1xuICAgICAgcGxhY2VTdHJpbmcgKz0gcmVzaWRlbmNlO1xuICAgIH1cblxuICAgIGlmICh0b3duKSB7XG4gICAgICBpZiAocGxhY2VTdHJpbmcpIHtcbiAgICAgICAgcGxhY2VTdHJpbmcgKz0gXCIsIFwiO1xuICAgICAgfVxuICAgICAgcGxhY2VTdHJpbmcgKz0gdG93bjtcbiAgICB9XG4gICAgaWYgKGNpdmlsUGFyaXNoICYmIGNpdmlsUGFyaXNoICE9IHRvd24pIHtcbiAgICAgIGlmIChwbGFjZVN0cmluZykge1xuICAgICAgICBwbGFjZVN0cmluZyArPSBcIiwgXCI7XG4gICAgICB9XG4gICAgICBwbGFjZVN0cmluZyArPSBjaXZpbFBhcmlzaDtcbiAgICB9XG4gICAgaWYgKGNvdW50eSkge1xuICAgICAgaWYgKHBsYWNlU3RyaW5nKSB7XG4gICAgICAgIHBsYWNlU3RyaW5nICs9IFwiLCBcIjtcbiAgICAgIH1cbiAgICAgIHBsYWNlU3RyaW5nICs9IGNvdW50eTtcbiAgICB9XG4gICAgaWYgKHN0YXRlKSB7XG4gICAgICBpZiAocGxhY2VTdHJpbmcpIHtcbiAgICAgICAgcGxhY2VTdHJpbmcgKz0gXCIsIFwiO1xuICAgICAgfVxuICAgICAgcGxhY2VTdHJpbmcgKz0gc3RhdGU7XG4gICAgfVxuICAgIGlmIChjb3VudHJ5KSB7XG4gICAgICBpZiAocGxhY2VTdHJpbmcpIHtcbiAgICAgICAgcGxhY2VTdHJpbmcgKz0gXCIsIFwiO1xuICAgICAgfVxuICAgICAgcGxhY2VTdHJpbmcgKz0gY291bnRyeTtcbiAgICB9XG4gIH1cbiAgcmVzdWx0LnNldEV2ZW50UGxhY2UocGxhY2VTdHJpbmcpO1xuXG4gIGlmIChzdHJlZXRBZGRyZXNzKSB7XG4gICAgaWYgKGhvdXNlTnVtYmVyICYmICFzdHJlZXRBZGRyZXNzLnN0YXJ0c1dpdGgoaG91c2VOdW1iZXIpKSB7XG4gICAgICByZXN1bHQuZXZlbnRQbGFjZS5zdHJlZXRBZGRyZXNzID0gaG91c2VOdW1iZXIgKyBcIiBcIiArIHN0cmVldEFkZHJlc3M7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJlc3VsdC5ldmVudFBsYWNlLnN0cmVldEFkZHJlc3MgPSBzdHJlZXRBZGRyZXNzO1xuICAgIH1cbiAgfVxufVxuXG5jb25zdCBhbmNlc3RyeVF1YXJ0ZXJOYW1lcyA9IFtcbiAge1xuICAgIG5hbWU6IFwiSmFuLUZlYi1NYXJcIixcbiAgICB2YWx1ZTogMSxcbiAgfSxcbiAge1xuICAgIG5hbWU6IFwiQXByLU1heS1KdW5cIixcbiAgICB2YWx1ZTogMixcbiAgfSxcbiAge1xuICAgIG5hbWU6IFwiSnVsLUF1Zy1TZXBcIixcbiAgICB2YWx1ZTogMyxcbiAgfSxcbiAge1xuICAgIG5hbWU6IFwiT2N0LU5vdi1EZWNcIixcbiAgICB2YWx1ZTogNCxcbiAgfSxcbl07XG5cbmNvbnN0IGFuY2VzdHJ5UXVhcnRlck1vbnRoTmFtZXMgPSBbXG4gIHtcbiAgICBuYW1lOiBcIkphblwiLFxuICAgIHZhbHVlOiAxLFxuICB9LFxuICB7XG4gICAgbmFtZTogXCJBcHJcIixcbiAgICB2YWx1ZTogMixcbiAgfSxcbiAge1xuICAgIG5hbWU6IFwiSnVsXCIsXG4gICAgdmFsdWU6IDMsXG4gIH0sXG4gIHtcbiAgICBuYW1lOiBcIk9jdFwiLFxuICAgIHZhbHVlOiA0LFxuICB9LFxuXTtcblxuZnVuY3Rpb24gZ2VuZXJhbGl6ZURhdGFHaXZlblJlY29yZFR5cGUoZGF0YSwgcmVzdWx0KSB7XG4gIGRldGVybWluZVJvbGVHaXZlblJlY29yZFR5cGUoZGF0YSwgcmVzdWx0KTtcblxuICBpZiAocmVzdWx0LnJlY29yZFR5cGUgPT0gUlQuQmlydGhSZWdpc3RyYXRpb24pIHtcbiAgICBsZXQgYmlydGhEYXRlID0gZ2V0Q2xlYW5WYWx1ZUZvclJlY29yZERhdGFMaXN0KGRhdGEsIFtcIkJpcnRoIERhdGVcIl0sIFwiZGF0ZVwiKTtcbiAgICBpZiAoYmlydGhEYXRlKSB7XG4gICAgICByZXN1bHQuc2V0RXZlbnREYXRlKGJpcnRoRGF0ZSk7XG4gICAgICByZXN1bHQuc2V0QmlydGhEYXRlKGJpcnRoRGF0ZSk7XG4gICAgfSBlbHNlIGlmIChyZXN1bHQuZXZlbnREYXRlKSB7XG4gICAgICAvLyByZXN1bHQuZXZlbnREYXRlIG1heSBiZSBzZXQgZnJvbSBcIlJlZ2lzdHJhdGlvbiBZZWFyXCJcbiAgICAgIHJlc3VsdC5iaXJ0aERhdGUgPSByZXN1bHQuZXZlbnREYXRlO1xuICAgIH1cblxuICAgIGxldCBldmVudFBsYWNlID0gZ2V0Q2xlYW5WYWx1ZUZvclJlY29yZERhdGFMaXN0KGRhdGEsIFtcIkJpcnRoIFJlZ2lzdHJhdGlvbiBQbGFjZVwiLCBcIlJlZ2lzdHJhdGlvbiBQbGFjZVwiXSk7XG4gICAgaWYgKGV2ZW50UGxhY2UpIHtcbiAgICAgIGlmICghcmVzdWx0LnJlZ2lzdHJhdGlvbkRpc3RyaWN0KSB7XG4gICAgICAgIGxldCBwbGFjZSA9IGV2ZW50UGxhY2U7XG4gICAgICAgIGxldCBjb21tYUluZGV4ID0gcGxhY2UuaW5kZXhPZihgLGApO1xuICAgICAgICBpZiAoY29tbWFJbmRleCAhPSAtMSkge1xuICAgICAgICAgIHBsYWNlID0gcGxhY2Uuc3Vic3RyaW5nKDAsIGNvbW1hSW5kZXgpO1xuICAgICAgICB9XG4gICAgICAgIHJlc3VsdC5yZWdpc3RyYXRpb25EaXN0cmljdCA9IHBsYWNlO1xuICAgICAgfVxuXG4gICAgICBsZXQgY291bnR5ID0gZ2V0Q2xlYW5SZWNvcmREYXRhVmFsdWUoZGF0YSwgXCJJbmZlcnJlZCBDb3VudHlcIik7XG4gICAgICBpZiAoY291bnR5ICYmICFldmVudFBsYWNlLmluY2x1ZGVzKGNvdW50eSkpIHtcbiAgICAgICAgZXZlbnRQbGFjZSArPSBcIiwgXCIgKyBjb3VudHk7XG4gICAgICB9XG4gICAgICByZXN1bHQuc2V0RXZlbnRQbGFjZShldmVudFBsYWNlKTtcbiAgICB9IGVsc2UgaWYgKHJlc3VsdC5yZWdpc3RyYXRpb25EaXN0cmljdCAmJiBkYXRhLnJlY29yZERhdGFbXCJJbmZlcnJlZCBDb3VudHlcIl0pIHtcbiAgICAgIGxldCBldmVudFBsYWNlID0gcmVzdWx0LnJlZ2lzdHJhdGlvbkRpc3RyaWN0O1xuICAgICAgbGV0IGNvdW50eSA9IGdldENsZWFuUmVjb3JkRGF0YVZhbHVlKGRhdGEsIFwiSW5mZXJyZWQgQ291bnR5XCIpO1xuICAgICAgaWYgKCFldmVudFBsYWNlLmluY2x1ZGVzKGNvdW50eSkpIHtcbiAgICAgICAgZXZlbnRQbGFjZSArPSBcIiwgXCIgKyBjb3VudHk7XG4gICAgICB9XG4gICAgICByZXN1bHQuc2V0RXZlbnRQbGFjZShldmVudFBsYWNlKTtcbiAgICB9XG4gICAgcmVzdWx0Lmxhc3ROYW1lQXRCaXJ0aCA9IHJlc3VsdC5pbmZlckxhc3ROYW1lKCk7XG5cbiAgICBidWlsZFBhcmVudHMoZGF0YSwgcmVzdWx0KTtcbiAgfSBlbHNlIGlmIChyZXN1bHQucmVjb3JkVHlwZSA9PSBSVC5CaXJ0aCkge1xuICAgIGxldCBiaXJ0aERhdGUgPSBnZXRDbGVhblJlY29yZERhdGFWYWx1ZShkYXRhLCBcIkJpcnRoIERhdGVcIiwgXCJkYXRlXCIpO1xuICAgIGlmIChiaXJ0aERhdGUpIHtcbiAgICAgIHJlc3VsdC5zZXRFdmVudERhdGUoYmlydGhEYXRlKTtcbiAgICAgIHJlc3VsdC5zZXRCaXJ0aERhdGUoYmlydGhEYXRlKTtcbiAgICB9XG5cbiAgICBsZXQgZXZlbnRQbGFjZSA9IGdldENsZWFuVmFsdWVGb3JSZWNvcmREYXRhTGlzdChkYXRhLCBbXCJCaXJ0aCBQbGFjZVwiLCBcIkJpcnRocGxhY2VcIiwgXCJSZWdpc3RyYXRpb24gUGxhY2VcIl0pO1xuICAgIGlmIChldmVudFBsYWNlKSB7XG4gICAgICByZXN1bHQuc2V0QmlydGhQbGFjZShldmVudFBsYWNlKTtcbiAgICAgIHJlc3VsdC5zZXRFdmVudFBsYWNlKGV2ZW50UGxhY2UpO1xuICAgIH1cbiAgICByZXN1bHQubGFzdE5hbWVBdEJpcnRoID0gcmVzdWx0LmluZmVyTGFzdE5hbWUoKTtcbiAgICBidWlsZFBhcmVudHMoZGF0YSwgcmVzdWx0KTtcblxuICAgIGlmIChyZXN1bHQucm9sZSAmJiByZXN1bHQucm9sZSA9PSBSb2xlLlBhcmVudCkge1xuICAgICAgbGV0IHNwb3VzZU5hbWUgPSBnZXRDbGVhblZhbHVlRm9yUmVjb3JkRGF0YUxpc3QoZGF0YSwgW1wiU3BvdXNlXCJdKTtcbiAgICAgIGlmIChzcG91c2VOYW1lKSB7XG4gICAgICAgIGxldCBuYW1lID0gbmV3IFd0c05hbWUoKTtcblxuICAgICAgICBpZiAoc3BvdXNlTmFtZSkge1xuICAgICAgICAgIG5hbWUubmFtZSA9IHNwb3VzZU5hbWU7XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgc3BvdXNlID0ge1xuICAgICAgICAgIG5hbWU6IG5hbWUsXG4gICAgICAgIH07XG5cbiAgICAgICAgcmVzdWx0LnNwb3VzZXMgPSBbc3BvdXNlXTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBsZXQgbW1uID0gZ2V0Q2xlYW5WYWx1ZUZvclJlY29yZERhdGFMaXN0KGRhdGEsIFtcIk1vdGhlciBNYWlkZW4gTmFtZVwiXSk7XG4gICAgaWYgKG1tbikge1xuICAgICAgcmVzdWx0Lm1vdGhlcnNNYWlkZW5OYW1lID0gbW1uO1xuICAgIH1cbiAgfSBlbHNlIGlmIChyZXN1bHQucmVjb3JkVHlwZSA9PSBSVC5EZWF0aFJlZ2lzdHJhdGlvbikge1xuICAgIGxldCBkZWF0aERhdGUgPSBnZXRDbGVhblZhbHVlRm9yUmVjb3JkRGF0YUxpc3QoXG4gICAgICBkYXRhLFxuICAgICAgW1wiRGVhdGggRGF0ZVwiLCBcIkRlYXRoIFJlZ2lzdHJhdGlvbiBEYXRlXCIsIFwiRGVhdGggUmVnaXN0cmF0aW9uIFllYXJcIl0sXG4gICAgICBcImRhdGVcIlxuICAgICk7XG4gICAgaWYgKGRlYXRoRGF0ZSkge1xuICAgICAgcmVzdWx0LnNldEV2ZW50RGF0ZShkZWF0aERhdGUpO1xuICAgICAgcmVzdWx0LnNldERlYXRoRGF0ZShkZWF0aERhdGUpO1xuICAgIH0gZWxzZSBpZiAocmVzdWx0LmV2ZW50RGF0ZSkge1xuICAgICAgLy8gcmVzdWx0LmV2ZW50RGF0ZSBtYXkgYmUgc2V0IGZyb20gXCJSZWdpc3RyYXRpb24gWWVhclwiXG4gICAgICByZXN1bHQuZGVhdGhEYXRlID0gcmVzdWx0LmV2ZW50RGF0ZTtcbiAgICB9XG5cbiAgICBsZXQgZXZlbnRQbGFjZSA9IGdldENsZWFuVmFsdWVGb3JSZWNvcmREYXRhTGlzdChkYXRhLCBbXCJEZWF0aCBSZWdpc3RyYXRpb24gUGxhY2VcIiwgXCJSZWdpc3RyYXRpb24gUGxhY2VcIl0pO1xuICAgIGlmIChldmVudFBsYWNlKSB7XG4gICAgICBpZiAoIXJlc3VsdC5yZWdpc3RyYXRpb25EaXN0cmljdCkge1xuICAgICAgICBsZXQgcGxhY2UgPSBldmVudFBsYWNlO1xuICAgICAgICBsZXQgY29tbWFJbmRleCA9IHBsYWNlLmluZGV4T2YoYCxgKTtcbiAgICAgICAgaWYgKGNvbW1hSW5kZXggIT0gLTEpIHtcbiAgICAgICAgICBwbGFjZSA9IHBsYWNlLnN1YnN0cmluZygwLCBjb21tYUluZGV4KTtcbiAgICAgICAgfVxuICAgICAgICByZXN1bHQucmVnaXN0cmF0aW9uRGlzdHJpY3QgPSBwbGFjZTtcbiAgICAgIH1cblxuICAgICAgbGV0IGNvdW50eSA9IGdldENsZWFuUmVjb3JkRGF0YVZhbHVlKGRhdGEsIFwiSW5mZXJyZWQgQ291bnR5XCIpO1xuICAgICAgaWYgKGNvdW50eSAmJiAhZXZlbnRQbGFjZS5pbmNsdWRlcyhjb3VudHkpKSB7XG4gICAgICAgIGV2ZW50UGxhY2UgKz0gXCIsIFwiICsgY291bnR5O1xuICAgICAgfVxuICAgICAgcmVzdWx0LnNldEV2ZW50UGxhY2UoZXZlbnRQbGFjZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGxldCBldmVudFBsYWNlID0gZ2V0Q2xlYW5WYWx1ZUZvclJlY29yZERhdGFMaXN0KGRhdGEsIFtcIkRlYXRoIFBsYWNlXCIsIFwiRGVhdGggQ291bnR5XCIsIFwiUmVzaWRlbmNlIFBsYWNlXCJdKTtcbiAgICAgIHJlc3VsdC5zZXRFdmVudFBsYWNlKGV2ZW50UGxhY2UpO1xuICAgIH1cblxuICAgIHJlc3VsdC5sYXN0TmFtZUF0RGVhdGggPSByZXN1bHQuaW5mZXJMYXN0TmFtZSgpO1xuICAgIHJlc3VsdC5hZ2VBdERlYXRoID0gZ2V0Q2xlYW5WYWx1ZUZvclJlY29yZERhdGFMaXN0KGRhdGEsIFtcIkFnZSBhdCBEZWF0aFwiLCBcIkRlYXRoIEFnZVwiLCBcIkFnZVwiXSk7XG5cbiAgICAvLyBsYXRlciBFbmdsYW5kIERlYXRoIFJlZ2lzdHJhdGlvbiBpbmNsdWRlIGV4YWN0IGJpcnRoIGRhdGVcbiAgICBsZXQgYmlydGhEYXRlID0gZ2V0Q2xlYW5WYWx1ZUZvclJlY29yZERhdGFMaXN0KGRhdGEsIFtcIkJpcnRoIERhdGVcIl0sIFwiZGF0ZVwiKTtcbiAgICBpZiAoYmlydGhEYXRlKSB7XG4gICAgICByZXN1bHQuc2V0QmlydGhEYXRlKGJpcnRoRGF0ZSk7XG4gICAgfVxuICB9IGVsc2UgaWYgKHJlc3VsdC5yZWNvcmRUeXBlID09IFJULkRlYXRoKSB7XG4gICAgbGV0IGRlYXRoRGF0ZSA9IGdldENsZWFuVmFsdWVGb3JSZWNvcmREYXRhTGlzdChcbiAgICAgIGRhdGEsXG4gICAgICBbXCJEZWF0aCBEYXRlXCIsIFwiVHJhbnNsYXRlZCBEZWF0aCBEYXRlXCIsIFwiRGVhdGggRGF0ZSBvbiBJbWFnZVwiLCBcIkRlYXRoIFllYXJcIl0sXG4gICAgICBcImRhdGVcIlxuICAgICk7XG4gICAgaWYgKGRlYXRoRGF0ZSkge1xuICAgICAgcmVzdWx0LnNldEV2ZW50RGF0ZShkZWF0aERhdGUpO1xuICAgICAgcmVzdWx0LnNldERlYXRoRGF0ZShkZWF0aERhdGUpO1xuICAgIH0gZWxzZSBpZiAocmVzdWx0LmV2ZW50RGF0ZSkge1xuICAgICAgLy8gcmVzdWx0LmV2ZW50RGF0ZSBtYXkgYmUgc2V0IGZyb20gXCJSZWdpc3RyYXRpb24gWWVhclwiXG4gICAgICByZXN1bHQuZGVhdGhEYXRlID0gcmVzdWx0LmV2ZW50RGF0ZTtcbiAgICB9XG5cbiAgICBsZXQgZXZlbnRQbGFjZSA9IGdldENsZWFuVmFsdWVGb3JSZWNvcmREYXRhTGlzdChkYXRhLCBbXCJEZWF0aCBQbGFjZVwiLCBcIkRlYXRoIENvdW50eVwiLCBcIkRlYXRoIENvdW50cnlcIiwgXCJTdGF0ZVwiXSk7XG4gICAgcmVzdWx0LnNldEV2ZW50UGxhY2UoZXZlbnRQbGFjZSk7XG5cbiAgICBsZXQgcmVzaWRlbmNlUGxhY2UgPSBnZXRDbGVhblZhbHVlRm9yUmVjb3JkRGF0YUxpc3QoZGF0YSwgW1xuICAgICAgXCJSZXNpZGVuY2UgUGxhY2VcIixcbiAgICAgIFwiTGFzdCBSZXNpZGVuY2UgUGxhY2VcIixcbiAgICAgIFwiTGFzdCBSZXNpZGVuY2VcIixcbiAgICAgIFwiUmVzaWRlbmNlXCIsXG4gICAgXSk7XG4gICAgcmVzdWx0LnNldFJlc2lkZW5jZVBsYWNlKHJlc2lkZW5jZVBsYWNlKTtcblxuICAgIHJlc3VsdC5sYXN0TmFtZUF0RGVhdGggPSByZXN1bHQuaW5mZXJMYXN0TmFtZSgpO1xuXG4gICAgbGV0IG1haWRlbk5hbWUgPSBnZXRDbGVhblZhbHVlRm9yUmVjb3JkRGF0YUxpc3QoZGF0YSwgW1wiTWFpZGVuIE5hbWVcIl0pO1xuICAgIGlmIChtYWlkZW5OYW1lKSB7XG4gICAgICByZXN1bHQubGFzdE5hbWVBdEJpcnRoID0gbWFpZGVuTmFtZTtcbiAgICB9XG5cbiAgICBsZXQgYWdlQXREZWF0aCA9IGdldENsZWFuVmFsdWVGb3JSZWNvcmREYXRhTGlzdChkYXRhLCBbXCJBZ2UgYXQgRGVhdGhcIiwgXCJEZWF0aCBBZ2VcIiwgXCJBZ2VcIl0pO1xuICAgIGlmIChhZ2VBdERlYXRoKSB7XG4gICAgICByZXN1bHQuYWdlQXREZWF0aCA9IGFnZUF0RGVhdGg7XG4gICAgfVxuXG4gICAgLy8gbGF0ZXIgRW5nbGFuZCBEZWF0aCBSZWdpc3RyYXRpb24gaW5jbHVkZSBleGFjdCBiaXJ0aCBkYXRlXG4gICAgbGV0IGJpcnRoRGF0ZSA9IGdldENsZWFuVmFsdWVGb3JSZWNvcmREYXRhTGlzdChkYXRhLCBbXCJCaXJ0aCBEYXRlXCIsIFwiQmlydGggWWVhclwiXSwgXCJkYXRlXCIpO1xuICAgIGlmIChiaXJ0aERhdGUpIHtcbiAgICAgIHJlc3VsdC5zZXRCaXJ0aERhdGUoYmlydGhEYXRlKTtcbiAgICB9XG5cbiAgICBidWlsZFBhcmVudHMoZGF0YSwgcmVzdWx0KTtcbiAgfSBlbHNlIGlmIChyZXN1bHQucmVjb3JkVHlwZSA9PSBSVC5DZW5zdXMpIHtcbiAgICBmdW5jdGlvbiBidWlsZEhvdXNlaG9sZEFycmF5KCkge1xuICAgICAgY29uc3Qgc3RkRmllbGROYW1lcyA9IFtcbiAgICAgICAge1xuICAgICAgICAgIHN0ZE5hbWU6IFwibmFtZVwiLFxuICAgICAgICAgIGFuY2VzdHJ5SGVhZGluZ3M6IFtcIk5hbWVcIiwgXCJIb3VzZWhvbGQgTWVtYmVyc1wiLCBcIkhvdXNlaG9sZCBNZW1iZXIocylcIiwgXCJIb3VzZWhvbGQgTWVtYmVycyAoTmFtZSlcIl0sXG4gICAgICAgIH0sXG4gICAgICAgIHsgc3RkTmFtZTogXCJhZ2VcIiwgYW5jZXN0cnlIZWFkaW5nczogW1wiQWdlXCJdIH0sXG4gICAgICAgIHsgc3RkTmFtZTogXCJyZWxhdGlvbnNoaXBcIiwgYW5jZXN0cnlIZWFkaW5nczogW1wiUmVsYXRpb25zaGlwXCJdIH0sXG4gICAgICBdO1xuICAgICAgZnVuY3Rpb24gaGVhZGluZ1RvU3RkTmFtZShoZWFkaW5nKSB7XG4gICAgICAgIGZvciAobGV0IGVudHJ5IG9mIHN0ZEZpZWxkTmFtZXMpIHtcbiAgICAgICAgICBpZiAoZW50cnkuYW5jZXN0cnlIZWFkaW5ncy5pbmNsdWRlcyhoZWFkaW5nKSkge1xuICAgICAgICAgICAgcmV0dXJuIGVudHJ5LnN0ZE5hbWU7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgICBpZiAoZGF0YS5ob3VzZWhvbGQgJiYgZGF0YS5ob3VzZWhvbGQubWVtYmVycyAmJiBkYXRhLmhvdXNlaG9sZC5tZW1iZXJzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgbGV0IGhlYWRpbmdzID0gZGF0YS5ob3VzZWhvbGQuaGVhZGluZ3M7XG4gICAgICAgIGxldCBtZW1iZXJzID0gZGF0YS5ob3VzZWhvbGQubWVtYmVycztcbiAgICAgICAgaWYgKGhlYWRpbmdzICYmIG1lbWJlcnMpIHtcbiAgICAgICAgICByZXN1bHQuaG91c2Vob2xkQXJyYXlGaWVsZHMgPSBbXTtcblxuICAgICAgICAgIC8vIGNoZWNrIHRoYXQgd2UgaGF2ZSBhIGhlYWRpbmcgdGhhdCBtYXBzIHRvIG5hbWUsIGlmIG5vdCB3ZSBkbyBzb21lIGV4dHJhIHdvcmsgbGF0ZXJcbiAgICAgICAgICBsZXQgaGF2ZUFOYW1lSGVhZGluZyA9IGZhbHNlO1xuICAgICAgICAgIGZvciAobGV0IGhlYWRpbmcgb2YgaGVhZGluZ3MpIHtcbiAgICAgICAgICAgIGxldCBmaWVsZE5hbWUgPSBoZWFkaW5nVG9TdGROYW1lKGhlYWRpbmcpO1xuICAgICAgICAgICAgaWYgKGZpZWxkTmFtZSAmJiBmaWVsZE5hbWUgPT0gXCJuYW1lXCIpIHtcbiAgICAgICAgICAgICAgaGF2ZUFOYW1lSGVhZGluZyA9IHRydWU7XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cblxuICAgICAgICAgIGxldCBob3VzZWhvbGRBcnJheSA9IFtdO1xuICAgICAgICAgIGZvciAobGV0IG1lbWJlciBvZiBtZW1iZXJzKSB7XG4gICAgICAgICAgICBsZXQgaG91c2Vob2xkTWVtYmVyID0ge307XG4gICAgICAgICAgICBpZiAobWVtYmVyLmlzQ2xvc2VkKSB7XG4gICAgICAgICAgICAgIGhvdXNlaG9sZE1lbWJlci5pc0Nsb3NlZCA9IHRydWU7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBmb3IgKGxldCBoZWFkaW5nSW5kZXggPSAwOyBoZWFkaW5nSW5kZXggPCBoZWFkaW5ncy5sZW5ndGg7IGhlYWRpbmdJbmRleCsrKSB7XG4gICAgICAgICAgICAgICAgbGV0IGhlYWRpbmcgPSBoZWFkaW5nc1toZWFkaW5nSW5kZXhdO1xuICAgICAgICAgICAgICAgIGxldCBmaWVsZE5hbWUgPSBoZWFkaW5nVG9TdGROYW1lKGhlYWRpbmcpO1xuXG4gICAgICAgICAgICAgICAgLy8gVGhpcyBjb3VsZCBiZSB0aGUgbmFtZSBjb2x1bW4gYXMgQW5jZXN0cnkga2VlcHMgY2hhbmdpbmcgaXRzIG5hbWVcbiAgICAgICAgICAgICAgICBpZiAoIWZpZWxkTmFtZSAmJiAhaGF2ZUFOYW1lSGVhZGluZyAmJiBoZWFkaW5nSW5kZXggPT0gMCkge1xuICAgICAgICAgICAgICAgICAgZmllbGROYW1lID0gXCJuYW1lXCI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChmaWVsZE5hbWUpIHtcbiAgICAgICAgICAgICAgICAgIGxldCBmaWVsZFZhbHVlID0gbWVtYmVyW2hlYWRpbmddO1xuICAgICAgICAgICAgICAgICAgaWYgKGZpZWxkVmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZpZWxkTmFtZSA9PSBcInJlbGF0aW9uc2hpcFwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgZmllbGRWYWx1ZSA9IEdELnN0YW5kYXJkaXplUmVsYXRpb25zaGlwVG9IZWFkKGZpZWxkVmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGhvdXNlaG9sZE1lbWJlcltmaWVsZE5hbWVdID0gZmllbGRWYWx1ZTtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgbGV0IGlzU2VsZWN0ZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgaWYgKCFtZW1iZXIucmVjb3JkSWQgfHwgbWVtYmVyLnJlY29yZElkID09IGRhdGEucmVjb3JkSWQpIHtcbiAgICAgICAgICAgICAgICBpc1NlbGVjdGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBpZiAoaXNTZWxlY3RlZCkge1xuICAgICAgICAgICAgICAgIGhvdXNlaG9sZE1lbWJlci5pc1NlbGVjdGVkID0gaXNTZWxlY3RlZDtcblxuICAgICAgICAgICAgICAgIHNldEV4dHJhR2RIb3VzZWhvbGRGaWVsZHMoZGF0YSwgaG91c2Vob2xkTWVtYmVyLCByZXN1bHQuaG91c2Vob2xkQXJyYXlGaWVsZHMpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGlmIChtZW1iZXIubGluaykge1xuICAgICAgICAgICAgICAgIC8vIHdlIG5lZWQgYSB3YXkgb2YgY29tcGFyaW5nIGJhY2sgdG8gZXh0cmFjdGVkRGF0YSB3aGVuIHdlXG4gICAgICAgICAgICAgICAgLy8gZmV0Y2ggYWRkaXRpb25hbCByZWNvcmRzXG4gICAgICAgICAgICAgICAgaG91c2Vob2xkTWVtYmVyLnVpZCA9IG1lbWJlci5saW5rO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBob3VzZWhvbGRBcnJheS5wdXNoKGhvdXNlaG9sZE1lbWJlcik7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJlc3VsdC5ob3VzZWhvbGRBcnJheSA9IGhvdXNlaG9sZEFycmF5O1xuXG4gICAgICAgICAgbGV0IGhvdXNlaG9sZEFycmF5RmllbGRzID0gW107XG4gICAgICAgICAgZm9yIChsZXQgaGVhZGluZ0luZGV4ID0gMDsgaGVhZGluZ0luZGV4IDwgaGVhZGluZ3MubGVuZ3RoOyBoZWFkaW5nSW5kZXgrKykge1xuICAgICAgICAgICAgbGV0IGhlYWRpbmcgPSBoZWFkaW5nc1toZWFkaW5nSW5kZXhdO1xuICAgICAgICAgICAgbGV0IGZpZWxkTmFtZSA9IGhlYWRpbmdUb1N0ZE5hbWUoaGVhZGluZyk7XG5cbiAgICAgICAgICAgIC8vIFRoaXMgY291bGQgYmUgdGhlIG5hbWUgY29sdW1uIGFzIEFuY2VzdHJ5IGtlZXBzIGNoYW5naW5nIGl0cyBuYW1lXG4gICAgICAgICAgICBpZiAoIWZpZWxkTmFtZSAmJiAhaGF2ZUFOYW1lSGVhZGluZyAmJiBoZWFkaW5nSW5kZXggPT0gMCkge1xuICAgICAgICAgICAgICBmaWVsZE5hbWUgPSBcIm5hbWVcIjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGZpZWxkTmFtZSkge1xuICAgICAgICAgICAgICBob3VzZWhvbGRBcnJheUZpZWxkcy5wdXNoKGZpZWxkTmFtZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIHJlc3VsdC5ob3VzZWhvbGRBcnJheUZpZWxkcyA9IGhvdXNlaG9sZEFycmF5RmllbGRzO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKGRhdGEudGl0bGVDb2xsZWN0aW9uICYmIGRhdGEudGl0bGVDb2xsZWN0aW9uLmluY2x1ZGVzKFwiMTkzOVwiKSkge1xuICAgICAgcmVzdWx0LnNldEV2ZW50WWVhcihcIjE5MzlcIik7XG5cbiAgICAgIGxldCBiaXJ0aERhdGUgPSBnZXRDbGVhblZhbHVlRm9yUmVjb3JkRGF0YUxpc3QoZGF0YSwgW1wiQmlydGggRGF0ZVwiXSwgXCJkYXRlXCIpO1xuICAgICAgcmVzdWx0LnNldEJpcnRoRGF0ZShiaXJ0aERhdGUpO1xuXG4gICAgICBsZXQgbWFyaXRhbFN0YXR1cyA9IGdldENsZWFuVmFsdWVGb3JSZWNvcmREYXRhTGlzdChkYXRhLCBbXCJNYXJpdGFsIFN0YXR1c1wiLCBcIk1hcml0YWwgc3RhdHVzXCJdKTtcbiAgICAgIHJlc3VsdC5zZXRNYXJpdGFsU3RhdHVzKG1hcml0YWxTdGF0dXMpO1xuXG4gICAgICBsZXQgc3RyZWV0QWRkcmVzcyA9IGdldENsZWFuUmVjb3JkRGF0YVZhbHVlKGRhdGEsIFwiQWRkcmVzc1wiKTtcbiAgICAgIGxldCBwbGFjZSA9IGdldENsZWFuUmVjb3JkRGF0YVZhbHVlKGRhdGEsIFwiUmVzaWRlbmNlIFBsYWNlXCIpO1xuICAgICAgbGV0IHBsYWNlU3RyaW5nID0gXCJcIjtcbiAgICAgIGlmIChzdHJlZXRBZGRyZXNzKSB7XG4gICAgICAgIHBsYWNlU3RyaW5nICs9IHN0cmVldEFkZHJlc3M7XG4gICAgICB9XG4gICAgICBpZiAocGxhY2UpIHtcbiAgICAgICAgaWYgKHBsYWNlU3RyaW5nKSB7XG4gICAgICAgICAgcGxhY2VTdHJpbmcgKz0gXCIsIFwiO1xuICAgICAgICB9XG4gICAgICAgIHBsYWNlU3RyaW5nICs9IHBsYWNlO1xuICAgICAgfVxuICAgICAgcmVzdWx0LnNldEV2ZW50UGxhY2UocGxhY2VTdHJpbmcpO1xuXG4gICAgICBsZXQgb2NjdXBhdGlvbiA9IGdldENsZWFuUmVjb3JkRGF0YVZhbHVlKGRhdGEsIFwiT2NjdXBhdGlvblwiKTtcbiAgICAgIGlmIChvY2N1cGF0aW9uICYmIG9jY3VwYXRpb24gIT0gXCJOb25lXCIpIHtcbiAgICAgICAgcmVzdWx0Lm9jY3VwYXRpb24gPSBvY2N1cGF0aW9uO1xuICAgICAgfVxuXG4gICAgICBsZXQgcG9zaXRpb25JbkhvdXNlaG9sZCA9IGdldENsZWFuUmVjb3JkRGF0YVZhbHVlKGRhdGEsIFwiU3ViIFNjaGVkdWxlIE51bWJlclwiKTtcbiAgICAgIGlmIChwb3NpdGlvbkluSG91c2Vob2xkKSB7XG4gICAgICAgIGlmIChwb3NpdGlvbkluSG91c2Vob2xkID09IDEpIHtcbiAgICAgICAgICByZXN1bHQucmVsYXRpb25zaGlwVG9IZWFkID0gXCJoZWFkXCI7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgYnVpbGRIb3VzZWhvbGRBcnJheSgpO1xuICAgIH0gZWxzZSB7XG4gICAgICBsZXQgYmlydGhZZWFyID0gZ2V0Q2xlYW5WYWx1ZUZvclJlY29yZERhdGFMaXN0KGRhdGEsIFtcIkVzdGltYXRlZCBCaXJ0aCBZZWFyXCIsIFwiQmlydGggWWVhclwiXSk7XG5cbiAgICAgIGlmIChiaXJ0aFllYXIpIHtcbiAgICAgICAgbGV0IGVzdFllYXIgPSBiaXJ0aFllYXI7XG4gICAgICAgIGlmIChlc3RZZWFyLnN0YXJ0c1dpdGgoXCJhYnQgXCIpKSB7XG4gICAgICAgICAgZXN0WWVhciA9IGVzdFllYXIuc3Vic3RyaW5nKDQpO1xuICAgICAgICB9XG4gICAgICAgIHJlc3VsdC5zZXRCaXJ0aFllYXIoZXN0WWVhcik7XG4gICAgICAgIHJlc3VsdC5iaXJ0aERhdGUucXVhbGlmaWVyID0gZGF0ZVF1YWxpZmllcnMuQUJPVVQ7XG4gICAgICB9XG5cbiAgICAgIGxldCBiaXJ0aFBsYWNlID0gZ2V0Q2xlYW5WYWx1ZUZvclJlY29yZERhdGFMaXN0KGRhdGEsIFtcbiAgICAgICAgXCJXaGVyZSBib3JuXCIsXG4gICAgICAgIFwiV2hlcmUgQm9yblwiLFxuICAgICAgICBcIkJpcnRoIFBsYWNlXCIsXG4gICAgICAgIFwiQmlydGggcGxhY2VcIixcbiAgICAgICAgXCJCaXJ0aHBsYWNlXCIsXG4gICAgICBdKTtcbiAgICAgIGlmIChiaXJ0aFBsYWNlKSB7XG4gICAgICAgIHJlc3VsdC5zZXRCaXJ0aFBsYWNlKGJpcnRoUGxhY2UpO1xuICAgICAgfVxuXG4gICAgICBpZiAoIXJlc3VsdC5ldmVudERhdGUgfHwgKCFyZXN1bHQuZXZlbnREYXRlLmRhdGVTdHJpbmcgJiYgIXJlc3VsdC5ldmVudERhdGUueWVhclN0cmluZykpIHtcbiAgICAgICAgLy8gc2VlIGlmIHdlIGNhbiBnZXQgdGhlIGNlbnN1cyB5ZWFyIGZyb20gYSBmaWVsZFxuICAgICAgICBsZXQgeWVhclN0cmluZyA9IGdldENsZWFuVmFsdWVGb3JSZWNvcmREYXRhTGlzdChkYXRhLCBbXCJFbnVtZXJhdGlvbiBZZWFyXCIsIFwiUmVzaWRlbmNlIFllYXJcIiwgXCJDZW5zdXMgWWVhclwiXSk7XG4gICAgICAgIGlmICh5ZWFyU3RyaW5nKSB7XG4gICAgICAgICAgcmVzdWx0LnNldEV2ZW50WWVhcih5ZWFyU3RyaW5nKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBsZXQgZGF0ZVN0cmluZyA9IGdldENsZWFuVmFsdWVGb3JSZWNvcmREYXRhTGlzdChkYXRhLCBbXCJFbnVtZXJhdGlvbiBEYXRlXCIsIFwiUmVzaWRlbmNlIERhdGVcIiwgXCJDZW5zdXMgRGF0ZVwiXSk7XG4gICAgICAgICAgaWYgKGRhdGVTdHJpbmcpIHtcbiAgICAgICAgICAgIHJlc3VsdC5zZXRFdmVudERhdGUoZGF0ZVN0cmluZyk7XG4gICAgICAgICAgfSBlbHNlIGlmIChkYXRhLnRpdGxlQ29sbGVjdGlvbikge1xuICAgICAgICAgICAgLy8gZXh0cmFjdCB0aGUgeWVhciBmcm9tIHRoZSBjb2xsZWN0aW9uIHRpdGxlLCBpZiBpdCBpcyBhIHJhbmdlIHRyZWF0IHRoYXQgc3BlY2lhbGx5XG4gICAgICAgICAgICBsZXQgeWVhclJhbmdlU3RyaW5nID0gZGF0YS50aXRsZUNvbGxlY3Rpb24ucmVwbGFjZSgvXi4qKFxcZFxcZFxcZFxcZFxcLVxcZFxcZFxcZFxcZCkuKiQvLCBcIiQxXCIpO1xuICAgICAgICAgICAgaWYgKHllYXJSYW5nZVN0cmluZyAmJiB5ZWFyUmFuZ2VTdHJpbmcgIT0gZGF0YS50aXRsZUNvbGxlY3Rpb24pIHtcbiAgICAgICAgICAgICAgcmVzdWx0LnNldEV2ZW50WWVhcih5ZWFyUmFuZ2VTdHJpbmcpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgeWVhclN0cmluZyA9IGRhdGEudGl0bGVDb2xsZWN0aW9uLnJlcGxhY2UoL14uKihcXGRcXGRcXGRcXGQpLiokLywgXCIkMVwiKTtcbiAgICAgICAgICAgICAgaWYgKHllYXJTdHJpbmcgJiYgeWVhclN0cmluZyAhPSBkYXRhLnRpdGxlQ29sbGVjdGlvbikge1xuICAgICAgICAgICAgICAgIHJlc3VsdC5zZXRFdmVudFllYXIoeWVhclN0cmluZyk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgYnVpbGRFdmVudFBsYWNlKGRhdGEsIHJlc3VsdCwgdHJ1ZSk7XG5cbiAgICAgIGxldCBvY2N1cGF0aW9uID0gZ2V0Q2xlYW5SZWNvcmREYXRhVmFsdWUoZGF0YSwgXCJPY2N1cGF0aW9uXCIpO1xuICAgICAgaWYgKG9jY3VwYXRpb24gJiYgb2NjdXBhdGlvbiAhPSBcIk5vbmVcIikge1xuICAgICAgICByZXN1bHQub2NjdXBhdGlvbiA9IG9jY3VwYXRpb247XG4gICAgICB9XG5cbiAgICAgIGxldCBhZ2UgPSBnZXRDbGVhblZhbHVlRm9yUmVjb3JkRGF0YUxpc3QoZGF0YSwgW1wiQWdlXCJdKTtcbiAgICAgIGlmICghYWdlKSB7XG4gICAgICAgIGlmIChyZXN1bHQuZXZlbnREYXRlICYmIHJlc3VsdC5ldmVudERhdGUueWVhclN0cmluZykge1xuICAgICAgICAgIGxldCBsYWJlbCA9IFwiQWdlIGluIFwiICsgcmVzdWx0LmV2ZW50RGF0ZS55ZWFyU3RyaW5nO1xuICAgICAgICAgIGFnZSA9IGdldENsZWFuUmVjb3JkRGF0YVZhbHVlKGRhdGEsIGxhYmVsKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKGFnZSkge1xuICAgICAgICByZXN1bHQuYWdlQXRFdmVudCA9IGFnZTtcbiAgICAgIH1cbiAgICAgIGxldCBtYXJpdGFsU3RhdHVzID0gZ2V0Q2xlYW5WYWx1ZUZvclJlY29yZERhdGFMaXN0KGRhdGEsIFtcIk1hcml0YWwgU3RhdHVzXCIsIFwiTWFyaXRhbCBzdGF0dXNcIl0pO1xuICAgICAgcmVzdWx0LnNldE1hcml0YWxTdGF0dXMobWFyaXRhbFN0YXR1cyk7XG4gICAgICBsZXQgcmVsYXRpb25zaGlwVG9IZWFkID0gZ2V0Q2xlYW5WYWx1ZUZvclJlY29yZERhdGFMaXN0KGRhdGEsIFtcbiAgICAgICAgXCJSZWxhdGlvbnNoaXAgdG8gSGVhZFwiLFxuICAgICAgICBcIlJlbGF0aW9uIHRvIEhlYWRcIixcbiAgICAgICAgXCJSZWxhdGlvbiB0byBIZWFkIG9mIEhvdXNlXCIsXG4gICAgICAgIFwiUmVsYXRpb25zaGlwXCIsXG4gICAgICAgIFwiUmVsYXRpb25cIixcbiAgICAgIF0pO1xuXG4gICAgICByZXN1bHQuc2V0UmVsYXRpb25zaGlwVG9IZWFkKHJlbGF0aW9uc2hpcFRvSGVhZCk7XG5cbiAgICAgIGJ1aWxkSG91c2Vob2xkQXJyYXkoKTtcblxuICAgICAgLy8gV2UgY2FuIGFsc28gZGV0ZXJtaW5lIHBhcmVudHMgYW5kIHNwb3VzZSBpbiBzb21lIGNhc2VzXG4gICAgICAvLyBOb3RlOiBUaGlzIGlzIGEgYml0IGxpbWl0ZWQgZm9yIEFuY2VzdHJ5IGJlY2F1c2Ugd2UgZG8gbm90IGRvIHRoZSBkZWVwIGRpdmUgb2YgZmV0Y2hpbmcgb3RoZXJcbiAgICAgIC8vIHJlY29yZHMgdW5sZXNzIHdlIGFyZSBidWlsZGluZyBhIGhvdXNlaG9sZCB0YWJsZS5cbiAgICAgIHJlc3VsdC5hZGRTcG91c2VPclBhcmVudHNGb3JTZWxlY3RlZEhvdXNlaG9sZE1lbWJlcigpO1xuICAgIH1cbiAgfSBlbHNlIGlmIChyZXN1bHQucmVjb3JkVHlwZSA9PSBSVC5Ob25wb3B1bGF0aW9uQ2Vuc3VzKSB7XG4gICAgcmVzdWx0LnNldEV2ZW50RGF0ZShnZXRDbGVhblZhbHVlRm9yUmVjb3JkRGF0YUxpc3QoZGF0YSwgW1wiRW51bWVyYXRpb24gRGF0ZVwiXSwgXCJkYXRlXCIpKTtcbiAgICByZXN1bHQuc2V0RXZlbnRQbGFjZShnZXRDbGVhblZhbHVlRm9yUmVjb3JkRGF0YUxpc3QoZGF0YSwgW1wiUGxhY2VcIl0pKTtcbiAgfSBlbHNlIGlmIChyZXN1bHQucmVjb3JkVHlwZSA9PSBSVC5NYXJyaWFnZSkge1xuICAgIHJlc3VsdC5zZXRFdmVudERhdGUoXG4gICAgICBnZXRDbGVhblZhbHVlRm9yUmVjb3JkRGF0YUxpc3QoXG4gICAgICAgIGRhdGEsXG4gICAgICAgIFtcbiAgICAgICAgICBcIk1hcnJpYWdlIERhdGVcIixcbiAgICAgICAgICBcIk1hcnJpYWdlIG9yIEJhbm4gRGF0ZVwiLFxuICAgICAgICAgIFwiTWFycmlhZ2UgQmFubnMgRGF0ZVwiLFxuICAgICAgICAgIFwiTWFycmlhZ2UgTGljZW5zZSBEYXRlXCIsXG4gICAgICAgICAgXCJCb25kIERhdGVcIixcbiAgICAgICAgICBcIlJlY29yZGluZyBEYXRlXCIsXG4gICAgICAgICAgXCJMaWNlbnNlIERhdGVcIixcbiAgICAgICAgICBcIkV2ZW50IERhdGVcIixcbiAgICAgICAgICBcIlRyYW5zbGF0ZWQgTWFycmlhZ2UgRGF0ZVwiLFxuICAgICAgICAgIFwiTWFycmlhZ2UgWWVhclwiLFxuICAgICAgICAgIFwiTWFycmlhZ2UgRGF0ZSBvbiBJbWFnZVwiLFxuICAgICAgICBdLFxuICAgICAgICBcImRhdGVcIlxuICAgICAgKVxuICAgICk7XG5cbiAgICBsZXQgbWFycmlhZ2VQbGFjZSA9IGdldENsZWFuVmFsdWVGb3JSZWNvcmREYXRhTGlzdChkYXRhLCBbXG4gICAgICBcIk1hcnJpYWdlIFBsYWNlXCIsXG4gICAgICBcIk1hcnJpYWdlIG9yIEJhbm4gUGxhY2VcIixcbiAgICAgIFwiTWFycmlhZ2UgQmFubnMgUGxhY2VcIixcbiAgICAgIFwiTWFycmlhZ2UgTGljZW5zZSBQbGFjZVwiLFxuICAgICAgXCJSZWNvcmRpbmcgUGxhY2VcIixcbiAgICAgIFwiTGljZW5zZSBQbGFjZVwiLFxuICAgICAgXCJNYXJyaWFnZSBTdGF0ZVwiLFxuICAgICAgXCJNYXJyaWFnZSBDaXR5XCIsXG4gICAgXSk7XG4gICAgaWYgKG1hcnJpYWdlUGxhY2UpIHtcbiAgICAgIHJlc3VsdC5zZXRFdmVudFBsYWNlKG1hcnJpYWdlUGxhY2UpO1xuICAgIH0gZWxzZSB7XG4gICAgICBidWlsZEV2ZW50UGxhY2UoZGF0YSwgcmVzdWx0KTtcbiAgICB9XG4gICAgcmVzdWx0LnNldEZpZWxkSWZWYWx1ZUV4aXN0cyhcImFnZUF0RXZlbnRcIiwgZ2V0Q2xlYW5WYWx1ZUZvclJlY29yZERhdGFMaXN0KGRhdGEsIFtcIk1hcnJpYWdlIEFnZVwiLCBcIkFnZVwiXSkpO1xuICAgIGJ1aWxkUGFyZW50cyhkYXRhLCByZXN1bHQpO1xuXG4gICAgbGV0IHNwb3VzZU5hbWUgPSBnZXRDbGVhblZhbHVlRm9yUmVjb3JkRGF0YUxpc3QoZGF0YSwgW1wiU3BvdXNlXCIsIFwiU3BvdXNlIE5hbWVcIiwgXCJTcG91c2UncyBOYW1lXCJdKTtcblxuICAgIC8vIG9jY2FzaW9uYWxseSB0aGVyZSBpcyBubyBmaWVsZCBmb3IgdGhlIHNwb3VzZSBuYW1lIGJ1dCB0aGVyZSBpcyBhIEhvdXNlaG9sZCBNZW1iZXJzIHNlY3Rpb25zXG4gICAgLy8gdGhhdCBsaXN0cyB0aGUgYnJpZGUgYW5kIGdyb29tLiB1c19wYV9tYXJyaWFnZV8xNzYxX3BhdGllbmNlX2Jyb3duIGlzIGFuIGV4YW1wbGUuXG4gICAgaWYgKCFzcG91c2VOYW1lKSB7XG4gICAgICBpZiAoZGF0YS5ob3VzZWhvbGQgJiYgZGF0YS5ob3VzZWhvbGQuaGVhZGluZ3MgJiYgZGF0YS5ob3VzZWhvbGQubWVtYmVycykge1xuICAgICAgICBpZiAoZGF0YS5ob3VzZWhvbGQuaGVhZGluZ3NbMF0gPT0gXCJOYW1lXCIgJiYgZGF0YS5ob3VzZWhvbGQuaGVhZGluZ3NbMV0gPT0gXCJSb2xlXCIpIHtcbiAgICAgICAgICBpZiAoZGF0YS5ob3VzZWhvbGQubWVtYmVycy5sZW5ndGggPj0gMikge1xuICAgICAgICAgICAgbGV0IHRoaXNQZXJzb25Sb2xlID0gZGF0YS5yZWNvcmREYXRhW1wiUm9sZVwiXTtcbiAgICAgICAgICAgIGlmICh0aGlzUGVyc29uUm9sZSkge1xuICAgICAgICAgICAgICBmb3IgKGxldCBtZW1iZXIgb2YgZGF0YS5ob3VzZWhvbGQubWVtYmVycykge1xuICAgICAgICAgICAgICAgIGxldCByb2xlID0gbWVtYmVyLlJvbGU7XG4gICAgICAgICAgICAgICAgaWYgKHJvbGUgIT0gdGhpc1BlcnNvblJvbGUgJiYgKHJvbGUgPT0gXCJCcmlkZVwiIHx8IHJvbGUgPT0gXCJHcm9vbVwiKSkge1xuICAgICAgICAgICAgICAgICAgaWYgKG1lbWJlci5OYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgIHNwb3VzZU5hbWUgPSBtZW1iZXIuTmFtZTtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoKHNwb3VzZU5hbWUgfHwgcmVzdWx0LmV2ZW50RGF0ZSkgJiYgKCFyZXN1bHQucm9sZSB8fCByZXN1bHQucm9sZSA9PSBSb2xlLlByaW1hcnkpKSB7XG4gICAgICBsZXQgbmFtZSA9IG5ldyBXdHNOYW1lKCk7XG5cbiAgICAgIGlmIChzcG91c2VOYW1lKSB7XG4gICAgICAgIG5hbWUubmFtZSA9IHNwb3VzZU5hbWU7XG4gICAgICB9XG5cbiAgICAgIGxldCBzcG91c2UgPSB7XG4gICAgICAgIG5hbWU6IG5hbWUsXG4gICAgICB9O1xuXG4gICAgICBpZiAocmVzdWx0LmV2ZW50RGF0ZSkge1xuICAgICAgICBzcG91c2UubWFycmlhZ2VEYXRlID0gcmVzdWx0LmV2ZW50RGF0ZTtcbiAgICAgIH1cblxuICAgICAgaWYgKHJlc3VsdC5ldmVudFBsYWNlKSB7XG4gICAgICAgIHNwb3VzZS5tYXJyaWFnZVBsYWNlID0gcmVzdWx0LmV2ZW50UGxhY2U7XG4gICAgICB9XG5cbiAgICAgIGxldCBzcG91c2VBZ2UgPSBnZXRDbGVhblZhbHVlRm9yUmVjb3JkRGF0YUxpc3QoZGF0YSwgW1wiU3BvdXNlJ3MgQWdlXCJdKTtcbiAgICAgIGlmIChzcG91c2VBZ2UpIHtcbiAgICAgICAgc3BvdXNlLmFnZSA9IHNwb3VzZUFnZTtcbiAgICAgIH1cblxuICAgICAgcmVzdWx0LnNwb3VzZXMgPSBbc3BvdXNlXTtcblxuICAgICAgaWYgKHJlc3VsdC5wZXJzb25HZW5kZXIgPT0gXCJmZW1hbGVcIikge1xuICAgICAgICByZXN1bHQubGFzdE5hbWVBdERlYXRoID0gbmFtZS5pbmZlckxhc3ROYW1lKCk7XG4gICAgICB9XG4gICAgfVxuICB9IGVsc2UgaWYgKHJlc3VsdC5yZWNvcmRUeXBlID09IFJULk1hcnJpYWdlUmVnaXN0cmF0aW9uKSB7XG4gICAgcmVzdWx0LnNldEV2ZW50RGF0ZShcbiAgICAgIGdldENsZWFuVmFsdWVGb3JSZWNvcmREYXRhTGlzdChcbiAgICAgICAgZGF0YSxcbiAgICAgICAgW1xuICAgICAgICAgIFwiTWFycmlhZ2UgUmVnaXN0cmF0aW9uIERhdGVcIixcbiAgICAgICAgICBcIk1hcnJpYWdlIFJlZ2lzdHJhdGlvbiBZZWFyXCIsXG4gICAgICAgICAgXCJNYXJyaWFnZSBEYXRlXCIsXG4gICAgICAgICAgXCJNYXJyaWFnZSBMaWNlbnNlIERhdGVcIixcbiAgICAgICAgICBcIk1hcnJpYWdlIFllYXJcIixcbiAgICAgICAgXSxcbiAgICAgICAgXCJkYXRlXCJcbiAgICAgIClcbiAgICApO1xuXG4gICAgbGV0IG1hcnJpYWdlUmVnaXN0cmF0aW9uUGxhY2UgPSBnZXRDbGVhblZhbHVlRm9yUmVjb3JkRGF0YUxpc3QoZGF0YSwgW1xuICAgICAgXCJNYXJyaWFnZSBSZWdpc3RyYXRpb24gUGxhY2VcIixcbiAgICAgIFwiUmVnaXN0cmF0aW9uIFBsYWNlXCIsXG4gICAgXSk7XG4gICAgaWYgKG1hcnJpYWdlUmVnaXN0cmF0aW9uUGxhY2UgJiYgIXJlc3VsdC5yZWdpc3RyYXRpb25EaXN0cmljdCkge1xuICAgICAgbGV0IHBsYWNlID0gbWFycmlhZ2VSZWdpc3RyYXRpb25QbGFjZTtcbiAgICAgIGxldCBjb21tYUluZGV4ID0gcGxhY2UuaW5kZXhPZihgLGApO1xuICAgICAgaWYgKGNvbW1hSW5kZXggIT0gLTEpIHtcbiAgICAgICAgcGxhY2UgPSBwbGFjZS5zdWJzdHJpbmcoMCwgY29tbWFJbmRleCk7XG4gICAgICB9XG4gICAgICByZXN1bHQucmVnaXN0cmF0aW9uRGlzdHJpY3QgPSBwbGFjZTtcbiAgICB9XG5cbiAgICBsZXQgbWFycmlhZ2VQbGFjZSA9IGdldENsZWFuVmFsdWVGb3JSZWNvcmREYXRhTGlzdChkYXRhLCBbXG4gICAgICBcIk1hcnJpYWdlIFJlZ2lzdHJhdGlvbiBQbGFjZVwiLFxuICAgICAgXCJNYXJyaWFnZSBQbGFjZVwiLFxuICAgICAgXCJSZWdpc3RyYXRpb24gUGxhY2VcIixcbiAgICBdKTtcbiAgICBpZiAobWFycmlhZ2VQbGFjZSkge1xuICAgICAgcmVzdWx0LnNldEV2ZW50UGxhY2UobWFycmlhZ2VQbGFjZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGJ1aWxkRXZlbnRQbGFjZShkYXRhLCByZXN1bHQpO1xuICAgIH1cbiAgICByZXN1bHQuc2V0RmllbGRJZlZhbHVlRXhpc3RzKFwiYWdlQXRFdmVudFwiLCBnZXRDbGVhblZhbHVlRm9yUmVjb3JkRGF0YUxpc3QoZGF0YSwgW1wiTWFycmlhZ2UgQWdlXCIsIFwiQWdlXCJdKSk7XG5cbiAgICBsZXQgc3BvdXNlTmFtZSA9IGdldENsZWFuVmFsdWVGb3JSZWNvcmREYXRhTGlzdChkYXRhLCBbXCJTcG91c2VcIiwgXCJTcG91c2UgTmFtZVwiXSk7XG5cbiAgICBpZiAoIXNwb3VzZU5hbWUpIHtcbiAgICAgIC8vIEZvciBhIFVLIG1hcnJpYWdlIHJlZ2lzdHJhdGlvbiwgaWYgdGhlcmUgYXJlIG9ubHkgdHdvIHJlY29yZHMgb24gcGFnZSwgd2UgY2FuIGluZmVyIHNwb3VzZVxuICAgICAgaWYgKGRhdGEucmVjb3JkRGF0YSkge1xuICAgICAgICBsZXQgcmVjb3JkcyA9IGRhdGEucmVjb3JkRGF0YVtcIlJlY29yZHMgb24gUGFnZVwiXTtcbiAgICAgICAgbGV0IG5hbWUgPSBkYXRhLnJlY29yZERhdGFbXCJOYW1lXCJdO1xuICAgICAgICBpZiAocmVjb3JkcyAmJiBuYW1lKSB7XG4gICAgICAgICAgaWYgKHJlY29yZHMuaW5jbHVkZXMoXCI8YnIvPlwiKSkge1xuICAgICAgICAgICAgbGV0IG5hbWVzID0gcmVjb3Jkcy5zcGxpdChcIjxici8+XCIpO1xuICAgICAgICAgICAgaWYgKG5hbWVzLmxlbmd0aCA9PSAyKSB7XG4gICAgICAgICAgICAgIGlmIChuYW1lc1swXSA9PSBuYW1lKSB7XG4gICAgICAgICAgICAgICAgc3BvdXNlTmFtZSA9IG5hbWVzWzFdO1xuICAgICAgICAgICAgICB9IGVsc2UgaWYgKG5hbWVzWzFdID09IG5hbWUpIHtcbiAgICAgICAgICAgICAgICBzcG91c2VOYW1lID0gbmFtZXNbMF07XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKHNwb3VzZU5hbWUgfHwgcmVzdWx0LmV2ZW50RGF0ZSkge1xuICAgICAgbGV0IG5hbWUgPSBuZXcgV3RzTmFtZSgpO1xuXG4gICAgICBpZiAoc3BvdXNlTmFtZSkge1xuICAgICAgICBuYW1lLm5hbWUgPSBzcG91c2VOYW1lO1xuICAgICAgfVxuXG4gICAgICBsZXQgc3BvdXNlID0ge1xuICAgICAgICBuYW1lOiBuYW1lLFxuICAgICAgfTtcblxuICAgICAgaWYgKHJlc3VsdC5ldmVudERhdGUpIHtcbiAgICAgICAgc3BvdXNlLm1hcnJpYWdlRGF0ZSA9IHJlc3VsdC5ldmVudERhdGU7XG4gICAgICB9XG5cbiAgICAgIGlmIChyZXN1bHQuZXZlbnRQbGFjZSkge1xuICAgICAgICBzcG91c2UubWFycmlhZ2VQbGFjZSA9IHJlc3VsdC5ldmVudFBsYWNlO1xuICAgICAgfVxuXG4gICAgICByZXN1bHQuc3BvdXNlcyA9IFtzcG91c2VdO1xuXG4gICAgICBpZiAocmVzdWx0LnBlcnNvbkdlbmRlciA9PSBcImZlbWFsZVwiKSB7XG4gICAgICAgIHJlc3VsdC5sYXN0TmFtZUF0RGVhdGggPSBuYW1lLmluZmVyTGFzdE5hbWUoKTtcbiAgICAgIH1cbiAgICB9XG4gIH0gZWxzZSBpZiAocmVzdWx0LnJlY29yZFR5cGUgPT0gUlQuQmFwdGlzbSkge1xuICAgIGxldCBiaXJ0aERhdGUgPSBnZXRDbGVhblJlY29yZERhdGFWYWx1ZShkYXRhLCBcIkJpcnRoIERhdGVcIiwgXCJkYXRlXCIpO1xuICAgIGxldCBiYXB0aXNtRGF0ZSA9IGdldENsZWFuVmFsdWVGb3JSZWNvcmREYXRhTGlzdChkYXRhLCBbXCJCYXB0aXNtIERhdGVcIiwgXCJDaHJpc3RlbmluZyBEYXRlXCJdLCBcImRhdGVcIik7XG4gICAgaWYgKGJpcnRoRGF0ZSkge1xuICAgICAgcmVzdWx0LnNldEJpcnRoRGF0ZShiaXJ0aERhdGUpO1xuICAgIH1cbiAgICBpZiAoYmFwdGlzbURhdGUpIHtcbiAgICAgIHJlc3VsdC5zZXRFdmVudERhdGUoYmFwdGlzbURhdGUpO1xuICAgIH1cblxuICAgIC8vIG9jY2FzaW9uYWxseSBhIGJhcHRpc20gcmVjb3JkIGFsc28gaGFzIGEgZGVhdGggZGF0ZSAodXN1YWxseSBmb3IgYW4gaW5mYW50IGRlYXRoKVxuICAgIHJlc3VsdC5zZXREZWF0aERhdGUoZ2V0Q2xlYW5SZWNvcmREYXRhVmFsdWUoZGF0YSwgXCJEZWF0aCBEYXRlXCIsIFwiZGF0ZVwiKSk7XG5cbiAgICBsZXQgZXZlbnRQbGFjZSA9IGdldENsZWFuVmFsdWVGb3JSZWNvcmREYXRhTGlzdChkYXRhLCBbXCJCYXB0aXNtIFBsYWNlXCIsIFwiQ2hyaXN0ZW5pbmcgUGxhY2VcIiwgXCJQYXJpc2hcIl0pO1xuICAgIGlmIChldmVudFBsYWNlKSB7XG4gICAgICByZXN1bHQuc2V0RXZlbnRQbGFjZShldmVudFBsYWNlKTtcbiAgICAgIHJlc3VsdC5zZXRCaXJ0aFBsYWNlKGV2ZW50UGxhY2UpO1xuICAgIH1cbiAgICByZXN1bHQubGFzdE5hbWVBdEJpcnRoID0gcmVzdWx0LmluZmVyTGFzdE5hbWUoKTtcblxuICAgIGxldCBhZ2UgPSBnZXRDbGVhblZhbHVlRm9yUmVjb3JkRGF0YUxpc3QoZGF0YSwgW1wiQWdlXCIsIFwiQmFwdGlzbSBBZ2VcIiwgXCJDaHJpc3RlbmluZyBBZ2VcIl0pO1xuICAgIGlmIChhZ2UpIHtcbiAgICAgIHJlc3VsdC5hZ2VBdEV2ZW50ID0gYWdlO1xuICAgIH1cblxuICAgIGxldCBmYXRoZXJOYW1lID0gZ2V0Q2xlYW5SZWNvcmREYXRhVmFsdWUoZGF0YSwgXCJGYXRoZXJcIik7XG4gICAgaWYgKGZhdGhlck5hbWUpIHtcbiAgICAgIGxldCBmYXRoZXIgPSByZXN1bHQuYWRkRmF0aGVyKCk7XG4gICAgICBmYXRoZXIubmFtZS5uYW1lID0gZmF0aGVyTmFtZTtcbiAgICB9XG4gICAgbGV0IG1vdGhlck5hbWUgPSBnZXRDbGVhblJlY29yZERhdGFWYWx1ZShkYXRhLCBcIk1vdGhlclwiKTtcbiAgICBpZiAobW90aGVyTmFtZSkge1xuICAgICAgbGV0IG1vdGhlciA9IHJlc3VsdC5hZGRNb3RoZXIoKTtcbiAgICAgIG1vdGhlci5uYW1lLm5hbWUgPSBtb3RoZXJOYW1lO1xuICAgIH1cbiAgfSBlbHNlIGlmIChyZXN1bHQucmVjb3JkVHlwZSA9PSBSVC5CdXJpYWwpIHtcbiAgICBsZXQgYmlydGhEYXRlID0gZ2V0Q2xlYW5SZWNvcmREYXRhVmFsdWUoZGF0YSwgXCJCaXJ0aCBEYXRlXCIsIFwiZGF0ZVwiKTtcbiAgICBsZXQgZGVhdGhEYXRlID0gZ2V0Q2xlYW5SZWNvcmREYXRhVmFsdWUoZGF0YSwgXCJEZWF0aCBEYXRlXCIsIFwiZGF0ZVwiKTtcbiAgICBsZXQgZXZlbnREYXRlID0gZ2V0Q2xlYW5WYWx1ZUZvclJlY29yZERhdGFMaXN0KFxuICAgICAgZGF0YSxcbiAgICAgIFtcIkJ1cmlhbCBEYXRlXCIsIFwiQnVyaWFsIG9yIENyZW1hdGlvbiBEYXRlXCIsIFwiSW50ZXJtZW50IERhdGVcIiwgXCJCdXJpYWwgWWVhclwiXSxcbiAgICAgIFwiZGF0ZVwiXG4gICAgKTtcblxuICAgIGlmIChiaXJ0aERhdGUpIHtcbiAgICAgIHJlc3VsdC5zZXRCaXJ0aERhdGUoYmlydGhEYXRlKTtcbiAgICB9XG4gICAgaWYgKGRlYXRoRGF0ZSkge1xuICAgICAgcmVzdWx0LnNldERlYXRoRGF0ZShkZWF0aERhdGUpO1xuICAgIH1cbiAgICBpZiAoZXZlbnREYXRlKSB7XG4gICAgICByZXN1bHQuc2V0RXZlbnREYXRlKGV2ZW50RGF0ZSk7XG4gICAgfVxuXG4gICAgbGV0IGV2ZW50UGxhY2UgPSBnZXRDbGVhblZhbHVlRm9yUmVjb3JkRGF0YUxpc3QoZGF0YSwgW1xuICAgICAgXCJCdXJpYWwgUGxhY2VcIixcbiAgICAgIFwiQnVyaWFsIG9yIENyZW1hdGlvbiBQbGFjZVwiLFxuICAgICAgXCJJbnRlcm1lbnQgUGxhY2VcIixcbiAgICAgIFwiQ2VtZXRlcnkgTG9jYXRpb25cIixcbiAgICAgIFwiQ2VtZXRlcnkgTmFtZVwiLFxuICAgICAgXCJDZW1ldGVyeVwiLFxuICAgIF0pO1xuICAgIGxldCBsYXJnZXJQbGFjZSA9IGdldENsZWFuVmFsdWVGb3JSZWNvcmREYXRhTGlzdChkYXRhLCBbXCJMb2NhdGlvblwiXSk7XG4gICAgaWYgKGxhcmdlclBsYWNlKSB7XG4gICAgICBpZiAoIWV2ZW50UGxhY2UpIHtcbiAgICAgICAgZXZlbnRQbGFjZSA9IGxhcmdlclBsYWNlO1xuICAgICAgfSBlbHNlIGlmIChldmVudFBsYWNlICE9IGxhcmdlclBsYWNlKSB7XG4gICAgICAgIGV2ZW50UGxhY2UgPSBldmVudFBsYWNlICsgXCIsIFwiICsgbGFyZ2VyUGxhY2U7XG4gICAgICB9XG4gICAgfVxuICAgIGlmIChldmVudFBsYWNlKSB7XG4gICAgICByZXN1bHQuc2V0RXZlbnRQbGFjZShldmVudFBsYWNlKTtcbiAgICAgIHJlc3VsdC5zZXREZWF0aFBsYWNlKGV2ZW50UGxhY2UpO1xuICAgIH1cbiAgICByZXN1bHQubGFzdE5hbWVBdERlYXRoID0gcmVzdWx0LmluZmVyTGFzdE5hbWUoKTtcblxuICAgIGxldCBhZ2UgPSBnZXRDbGVhblJlY29yZERhdGFWYWx1ZShkYXRhLCBcIkFnZVwiKTtcbiAgICBpZiAoYWdlKSB7XG4gICAgICByZXN1bHQuYWdlQXREZWF0aCA9IGFnZTtcbiAgICB9XG4gIH0gZWxzZSBpZiAocmVzdWx0LnJlY29yZFR5cGUgPT0gUlQuQ3JlbWF0aW9uKSB7XG4gICAgbGV0IGJpcnRoRGF0ZSA9IGdldENsZWFuUmVjb3JkRGF0YVZhbHVlKGRhdGEsIFwiQmlydGggRGF0ZVwiLCBcImRhdGVcIik7XG4gICAgbGV0IGRlYXRoRGF0ZSA9IGdldENsZWFuUmVjb3JkRGF0YVZhbHVlKGRhdGEsIFwiRGVhdGggRGF0ZVwiLCBcImRhdGVcIik7XG4gICAgbGV0IGV2ZW50RGF0ZSA9IGdldENsZWFuVmFsdWVGb3JSZWNvcmREYXRhTGlzdChkYXRhLCBbXCJDcmVtYXRpb24gRGF0ZVwiLCBcIkJ1cmlhbCBvciBDcmVtYXRpb24gRGF0ZVwiXSwgXCJkYXRlXCIpO1xuXG4gICAgaWYgKGJpcnRoRGF0ZSkge1xuICAgICAgcmVzdWx0LnNldEJpcnRoRGF0ZShiaXJ0aERhdGUpO1xuICAgIH1cbiAgICBpZiAoZGVhdGhEYXRlKSB7XG4gICAgICByZXN1bHQuc2V0RGVhdGhEYXRlKGRlYXRoRGF0ZSk7XG4gICAgfVxuICAgIGlmIChldmVudERhdGUpIHtcbiAgICAgIHJlc3VsdC5zZXRFdmVudERhdGUoZXZlbnREYXRlKTtcbiAgICB9XG5cbiAgICBsZXQgZXZlbnRQbGFjZSA9IGdldENsZWFuVmFsdWVGb3JSZWNvcmREYXRhTGlzdChkYXRhLCBbXG4gICAgICBcIkNyZW1hdGlvbiBQbGFjZVwiLFxuICAgICAgXCJCdXJpYWwgb3IgQ3JlbWF0aW9uIFBsYWNlXCIsXG4gICAgICBcIkJ1cmlhbCBQbGFjZVwiLFxuICAgIF0pO1xuICAgIGlmIChldmVudFBsYWNlKSB7XG4gICAgICByZXN1bHQuc2V0RXZlbnRQbGFjZShldmVudFBsYWNlKTtcbiAgICAgIHJlc3VsdC5zZXREZWF0aFBsYWNlKGV2ZW50UGxhY2UpO1xuICAgIH1cbiAgICByZXN1bHQubGFzdE5hbWVBdERlYXRoID0gcmVzdWx0LmluZmVyTGFzdE5hbWUoKTtcblxuICAgIGxldCBhZ2UgPSBnZXRDbGVhblJlY29yZERhdGFWYWx1ZShkYXRhLCBcIkFnZVwiKTtcbiAgICBpZiAoYWdlKSB7XG4gICAgICByZXN1bHQuYWdlQXREZWF0aCA9IGFnZTtcbiAgICB9XG4gIH0gZWxzZSBpZiAocmVzdWx0LnJlY29yZFR5cGUgPT0gUlQuT2JpdHVhcnkpIHtcbiAgICAvLyBpZiB0aGVyZSBpcyBhIGRlYXRoIG9yIGJ1cmlhbCBkYXRlIGV0YyB0aGVuIHRoaXMgaXMgbGlrZWx5IGEgcmVjb3JkIGZvciB0aGlzIHBlcnNvbiBub3QgYVxuICAgIC8vIGNoaWxkIG9yIHNwb3VzZVxuICAgIGxldCBiaXJ0aERhdGUgPSBnZXRDbGVhblZhbHVlRm9yUmVjb3JkRGF0YUxpc3QoZGF0YSwgW1wiQmlydGggRGF0ZVwiXSwgXCJkYXRlXCIpO1xuICAgIGxldCBkZWF0aERhdGUgPSBnZXRDbGVhblZhbHVlRm9yUmVjb3JkRGF0YUxpc3QoZGF0YSwgW1wiRGVhdGggRGF0ZVwiXSwgXCJkYXRlXCIpO1xuICAgIGxldCBkZWF0aFBsYWNlID0gZ2V0Q2xlYW5WYWx1ZUZvclJlY29yZERhdGFMaXN0KGRhdGEsIFtcIkRlYXRoIFBsYWNlXCIsIFwiRGVhdGggQ291bnR5XCJdKTtcbiAgICBsZXQgZXZlbnREYXRlID0gZ2V0Q2xlYW5WYWx1ZUZvclJlY29yZERhdGFMaXN0KGRhdGEsIFtcIk9iaXR1YXJ5IERhdGVcIiwgXCJEYXRlXCIsIFwiTmV3c3BhcGVyIERhdGVcIl0sIFwiZGF0ZVwiKTtcbiAgICBsZXQgZXZlbnRQbGFjZSA9IGdldENsZWFuVmFsdWVGb3JSZWNvcmREYXRhTGlzdChkYXRhLCBbXCJPYml0dWFyeSBQbGFjZVwiLCBcIk5ld3NwYXBlciBQbGFjZVwiLCBcIlBsYWNlXCJdKTtcblxuICAgIGlmIChiaXJ0aERhdGUpIHtcbiAgICAgIHJlc3VsdC5zZXRCaXJ0aERhdGUoYmlydGhEYXRlKTtcbiAgICB9XG4gICAgaWYgKGRlYXRoRGF0ZSkge1xuICAgICAgcmVzdWx0LnNldERlYXRoRGF0ZShkZWF0aERhdGUpO1xuICAgIH1cbiAgICBpZiAoZGVhdGhQbGFjZSkge1xuICAgICAgcmVzdWx0LnNldERlYXRoUGxhY2UoZGVhdGhQbGFjZSk7XG4gICAgfVxuICAgIGlmIChldmVudERhdGUpIHtcbiAgICAgIHJlc3VsdC5zZXRFdmVudERhdGUoZXZlbnREYXRlKTtcbiAgICB9XG4gICAgaWYgKGV2ZW50UGxhY2UpIHtcbiAgICAgIHJlc3VsdC5zZXRFdmVudFBsYWNlKGV2ZW50UGxhY2UpO1xuICAgIH1cbiAgICByZXN1bHQubGFzdE5hbWVBdERlYXRoID0gcmVzdWx0LmluZmVyTGFzdE5hbWUoKTtcblxuICAgIGxldCBhZ2UgPSBnZXRDbGVhblZhbHVlRm9yUmVjb3JkRGF0YUxpc3QoZGF0YSwgW1wiQWdlXCIsIFwiRGVhdGggQWdlXCJdKTtcbiAgICBpZiAoYWdlKSB7XG4gICAgICByZXN1bHQuYWdlQXREZWF0aCA9IGFnZTtcbiAgICB9XG4gIH0gZWxzZSBpZiAocmVzdWx0LnJlY29yZFR5cGUgPT0gUlQuV2lsbCB8fCByZXN1bHQucmVjb3JkVHlwZSA9PSBSVC5Qcm9iYXRlKSB7XG4gICAgcmVzdWx0LnNldERlYXRoRGF0ZShnZXRDbGVhblJlY29yZERhdGFWYWx1ZShkYXRhLCBcIkRlYXRoIERhdGVcIiwgXCJkYXRlXCIpKTtcbiAgICByZXN1bHQuc2V0RGVhdGhZZWFyKGdldENsZWFuUmVjb3JkRGF0YVZhbHVlKGRhdGEsIFwiRGVhdGggWWVhclwiKSk7XG4gICAgcmVzdWx0LnNldEV2ZW50RGF0ZShcbiAgICAgIGdldENsZWFuVmFsdWVGb3JSZWNvcmREYXRhTGlzdChkYXRhLCBbXCJQcm9iYXRlIERhdGVcIiwgXCJXaWxsIFByb3ZlZCBEYXRlXCIsIFwiR3JhbnQgRGF0ZVwiXSwgXCJkYXRlXCIpXG4gICAgKTtcbiAgICByZXN1bHQuc2V0RXZlbnRZZWFyKGdldENsZWFuUmVjb3JkRGF0YVZhbHVlKGRhdGEsIFwiUHJvYmF0ZSBZZWFyXCIpKTtcblxuICAgIGlmIChyZXN1bHQucmVjb3JkVHlwZSA9PSBSVC5XaWxsKSB7XG4gICAgICByZXN1bHQucmVjb3JkU3VidHlwZSA9IFwiUHJvYmF0ZVwiOyAvLyBmb3Igbm93IGFzc3VtZSBBbmNlc3RyeSBXaWxsIHJlY29yZHMgaGF2ZSBwcm9iYXRlIGRhdGVcbiAgICB9XG5cbiAgICBsZXQgZXZlbnRQbGFjZSA9IGdldENsZWFuVmFsdWVGb3JSZWNvcmREYXRhTGlzdChkYXRhLCBbXCJQcm9iYXRlIFJlZ2lzdHJ5XCJdKTtcbiAgICBpZiAoZXZlbnRQbGFjZSkge1xuICAgICAgcmVzdWx0LnNldEV2ZW50UGxhY2UoZXZlbnRQbGFjZSk7XG4gICAgfVxuICAgIGxldCBkZWF0aFBsYWNlID0gZ2V0Q2xlYW5WYWx1ZUZvclJlY29yZERhdGFMaXN0KGRhdGEsIFtcIlJlc2lkZW5jZVwiLCBcIkRlYXRoIFBsYWNlXCIsIFwiRGVhdGggQ291bnR5XCJdKTtcbiAgICBpZiAoZGVhdGhQbGFjZSkge1xuICAgICAgcmVzdWx0LnNldERlYXRoUGxhY2UoZGVhdGhQbGFjZSk7XG4gICAgfVxuXG4gICAgbGV0IHJvbGUgPSBnZXRDbGVhblJlY29yZERhdGFWYWx1ZShkYXRhLCBcIlJvbGVcIik7XG4gICAgaWYgKHJvbGUpIHtcbiAgICAgIC8vIFByaW1hcnkgcGVyc29uJ3Mgcm9sZSBmaWVsZCBtYXkgYmUgXCJEZWNlZGVudFwiXG4gICAgICBpZiAocm9sZSA9PSBcIkNoaWxkXCIgfHwgcm9sZSA9PSBcIkRhdWdodGVyXCIgfHwgcm9sZSA9PSBcIlNvblwiKSB7XG4gICAgICAgIHJlc3VsdC5yb2xlID0gUm9sZS5DaGlsZDtcbiAgICAgIH0gZWxzZSBpZiAocm9sZSA9PSBcIlBhcmVudFwiIHx8IHJvbGUgPT0gXCJGYXRoZXJcIiB8fCByb2xlID09IFwiTW90aGVyXCIpIHtcbiAgICAgICAgcmVzdWx0LnJvbGUgPSBSb2xlLlBhcmVudDtcbiAgICAgIH0gZWxzZSBpZiAocm9sZSA9PSBcIlNwb3VzZVwiIHx8IHJvbGUgPT0gXCJIdXNiYW5kXCIgfHwgcm9sZSA9PSBcIldpZmVcIikge1xuICAgICAgICByZXN1bHQucm9sZSA9IFJvbGUuU3BvdXNlO1xuICAgICAgfSBlbHNlIGlmIChyb2xlID09IFwiV2l0bmVzc1wiKSB7XG4gICAgICAgIHJlc3VsdC5yb2xlID0gUm9sZS5XaXRuZXNzO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIFNvbWUgcHJvYmF0ZSByZWNvcmRzIGhhdmUgb2NjdXBhdGlvbiAoZS5nLiBWaWN0b3JpYSwgQXVzdHJhbGlhLCBXaWxscyBhbmQgUHJvYmF0ZSBSZWNvcmRzLCAxODQxLTIwMDkpXG4gICAgbGV0IG9jY3VwYXRpb24gPSBnZXRDbGVhblJlY29yZERhdGFWYWx1ZShkYXRhLCBcIk9jY3VwYXRpb25cIik7XG4gICAgaWYgKG9jY3VwYXRpb24gJiYgb2NjdXBhdGlvbiAhPSBcIk5vbmVcIikge1xuICAgICAgcmVzdWx0Lm9jY3VwYXRpb24gPSBvY2N1cGF0aW9uO1xuICAgIH1cblxuICAgIHJlc3VsdC5sYXN0TmFtZUF0RGVhdGggPSByZXN1bHQuaW5mZXJMYXN0TmFtZSgpO1xuICB9IGVsc2UgaWYgKHJlc3VsdC5yZWNvcmRUeXBlID09IFJULkRpdm9yY2UpIHtcbiAgICByZXN1bHQuc2V0RXZlbnREYXRlKGdldENsZWFuVmFsdWVGb3JSZWNvcmREYXRhTGlzdChkYXRhLCBbXCJEaXZvcmNlIERhdGVcIiwgXCJQZXRpdGlvbiBEYXRlXCIsIFwiRGF0ZVwiXSwgXCJkYXRlXCIpKTtcbiAgICByZXN1bHQuc2V0RXZlbnRQbGFjZShnZXRDbGVhblZhbHVlRm9yUmVjb3JkRGF0YUxpc3QoZGF0YSwgW1wiRGl2b3JjZSBQbGFjZVwiLCBcIkxvY2F0aW9uXCJdKSk7XG5cbiAgICBsZXQgc3BvdXNlTmFtZSA9IGdldENsZWFuVmFsdWVGb3JSZWNvcmREYXRhTGlzdChkYXRhLCBbXCJTcG91c2VcIiwgXCJTcG91c2UgTmFtZVwiXSk7XG5cbiAgICBpZiAoc3BvdXNlTmFtZSkge1xuICAgICAgbGV0IG5hbWUgPSBuZXcgV3RzTmFtZSgpO1xuICAgICAgbmFtZS5uYW1lID0gc3BvdXNlTmFtZTtcbiAgICAgIGxldCBzcG91c2UgPSB7XG4gICAgICAgIG5hbWU6IG5hbWUsXG4gICAgICB9O1xuXG4gICAgICBsZXQgbWFycmlhZ2VEYXRlID0gZ2V0Q2xlYW5WYWx1ZUZvclJlY29yZERhdGFMaXN0KGRhdGEsIFtcIk1hcnJpYWdlIERhdGVcIiwgXCJNYXJyaWFnZSBZZWFyXCJdLCBcImRhdGVcIik7XG4gICAgICBpZiAobWFycmlhZ2VEYXRlKSB7XG4gICAgICAgIHNwb3VzZS5tYXJyaWFnZURhdGUgPSBuZXcgV3RzRGF0ZSgpO1xuICAgICAgICBzcG91c2UubWFycmlhZ2VEYXRlLmRhdGVTdHJpbmcgPSBtYXJyaWFnZURhdGU7XG4gICAgICB9XG5cbiAgICAgIHJlc3VsdC5zcG91c2VzID0gW3Nwb3VzZV07XG4gICAgfVxuICB9IGVsc2UgaWYgKHJlc3VsdC5yZWNvcmRUeXBlID09IFJULkJpcnRoT3JCYXB0aXNtKSB7XG4gICAgbGV0IGJpcnRoRGF0ZSA9IGdldENsZWFuUmVjb3JkRGF0YVZhbHVlKGRhdGEsIFwiQmlydGggRGF0ZVwiLCBcImRhdGVcIik7XG4gICAgbGV0IGJhcHRpc21EYXRlID0gZ2V0Q2xlYW5WYWx1ZUZvclJlY29yZERhdGFMaXN0KGRhdGEsIFtcIkJhcHRpc20gRGF0ZVwiLCBcIkNocmlzdGVuaW5nIERhdGVcIl0sIFwiZGF0ZVwiKTtcbiAgICBpZiAoYmlydGhEYXRlKSB7XG4gICAgICByZXN1bHQuc2V0QmlydGhEYXRlKGJpcnRoRGF0ZSk7XG4gICAgfVxuICAgIGlmIChiYXB0aXNtRGF0ZSkge1xuICAgICAgcmVzdWx0LnNldEV2ZW50RGF0ZShiYXB0aXNtRGF0ZSk7XG4gICAgfSBlbHNlIGlmIChiaXJ0aERhdGUpIHtcbiAgICAgIHJlc3VsdC5zZXRFdmVudERhdGUoYmlydGhEYXRlKTtcbiAgICB9XG5cbiAgICAvLyBvY2Nhc2lvbmFsbHkgYSBiYXB0aXNtIHJlY29yZCBhbHNvIGhhcyBhIGRlYXRoIGRhdGUgKHVzdWFsbHkgZm9yIGFuIGluZmFudCBkZWF0aClcbiAgICByZXN1bHQuc2V0RGVhdGhEYXRlKGdldENsZWFuUmVjb3JkRGF0YVZhbHVlKGRhdGEsIFwiRGVhdGggRGF0ZVwiLCBcImRhdGVcIikpO1xuXG4gICAgbGV0IGV2ZW50UGxhY2UgPSBnZXRDbGVhblZhbHVlRm9yUmVjb3JkRGF0YUxpc3QoZGF0YSwgW1wiQmFwdGlzbSBQbGFjZVwiLCBcIkNocmlzdGVuaW5nIFBsYWNlXCIsIFwiQmlydGggUGxhY2VcIl0pO1xuICAgIGlmIChldmVudFBsYWNlKSB7XG4gICAgICByZXN1bHQuc2V0RXZlbnRQbGFjZShldmVudFBsYWNlKTtcbiAgICAgIHJlc3VsdC5zZXRCaXJ0aFBsYWNlKGV2ZW50UGxhY2UpO1xuICAgIH1cbiAgICByZXN1bHQubGFzdE5hbWVBdEJpcnRoID0gcmVzdWx0LmluZmVyTGFzdE5hbWUoKTtcblxuICAgIGxldCBhZ2UgPSBnZXRDbGVhblZhbHVlRm9yUmVjb3JkRGF0YUxpc3QoZGF0YSwgW1wiQWdlXCIsIFwiQmFwdGlzbSBBZ2VcIiwgXCJDaHJpc3RlbmluZyBBZ2VcIl0pO1xuICAgIGlmIChhZ2UpIHtcbiAgICAgIHJlc3VsdC5hZ2VBdEV2ZW50ID0gYWdlO1xuICAgIH1cblxuICAgIGlmIChyZXN1bHQucm9sZSAhPSBSb2xlLlBhcmVudCkge1xuICAgICAgbGV0IGZhdGhlck5hbWUgPSBnZXRDbGVhblJlY29yZERhdGFWYWx1ZShkYXRhLCBcIkZhdGhlclwiKTtcbiAgICAgIGlmIChmYXRoZXJOYW1lKSB7XG4gICAgICAgIGxldCBmYXRoZXIgPSByZXN1bHQuYWRkRmF0aGVyKCk7XG4gICAgICAgIGZhdGhlci5uYW1lLm5hbWUgPSBmYXRoZXJOYW1lO1xuICAgICAgfVxuICAgICAgbGV0IG1vdGhlck5hbWUgPSBnZXRDbGVhblJlY29yZERhdGFWYWx1ZShkYXRhLCBcIk1vdGhlclwiKTtcbiAgICAgIGlmIChtb3RoZXJOYW1lKSB7XG4gICAgICAgIGxldCBtb3RoZXIgPSByZXN1bHQuYWRkTW90aGVyKCk7XG4gICAgICAgIG1vdGhlci5uYW1lLm5hbWUgPSBtb3RoZXJOYW1lO1xuICAgICAgfVxuICAgIH1cbiAgfSBlbHNlIGlmIChyZXN1bHQucmVjb3JkVHlwZSA9PSBSVC5NaWxpdGFyeSkge1xuICAgIHJlc3VsdC5zZXRFdmVudERhdGUoXG4gICAgICBnZXRDbGVhblZhbHVlRm9yUmVjb3JkRGF0YUxpc3QoXG4gICAgICAgIGRhdGEsXG4gICAgICAgIFtcbiAgICAgICAgICBcIkV2ZW50IERhdGVcIixcbiAgICAgICAgICBcIkRhdGVcIixcbiAgICAgICAgICBcIkVubGlzdG1lbnQgRGF0ZVwiLFxuICAgICAgICAgIFwiU2VydmljZSBTdGFydCBEYXRlXCIsXG4gICAgICAgICAgXCJGaXJzdCBTZXJ2aWNlIERhdGVcIixcbiAgICAgICAgICBcIlNlcnZpY2UgRGF0ZVwiLFxuICAgICAgICAgIFwiTGFzdCBTZXJ2aWNlIERhdGVcIixcbiAgICAgICAgICBcIk11c3RlciBEYXRlXCIsXG4gICAgICAgICAgXCJNaWxpdGFyeSBEYXRlXCIsXG4gICAgICAgICAgXCJSZXNpZGVuY2UgRGF0ZVwiLFxuICAgICAgICBdLFxuICAgICAgICBcImRhdGVcIlxuICAgICAgKVxuICAgICk7XG4gICAgcmVzdWx0LnNldEJpcnRoRGF0ZShnZXRDbGVhblZhbHVlRm9yUmVjb3JkRGF0YUxpc3QoZGF0YSwgW1wiQmlydGggRGF0ZVwiXSwgXCJkYXRlXCIpKTtcbiAgICByZXN1bHQuc2V0RGVhdGhEYXRlKGdldENsZWFuVmFsdWVGb3JSZWNvcmREYXRhTGlzdChkYXRhLCBbXCJEZWF0aCBEYXRlXCJdLCBcImRhdGVcIikpO1xuICAgIHJlc3VsdC5zZXRFdmVudFllYXIoXG4gICAgICBnZXRDbGVhblZhbHVlRm9yUmVjb3JkRGF0YUxpc3QoZGF0YSwgW1xuICAgICAgICBcIkV2ZW50IFllYXJcIixcbiAgICAgICAgXCJZZWFyXCIsXG4gICAgICAgIFwiRW5saXN0bWVudCBZZWFyXCIsXG4gICAgICAgIFwiU2VydmljZSBZZWFyXCIsXG4gICAgICAgIFwiWWVhciBSYW5nZVwiLFxuICAgICAgICBcIlllYXIgcmFuZ2VcIixcbiAgICAgIF0pXG4gICAgKTtcbiAgICByZXN1bHQuc2V0RXZlbnRQbGFjZShcbiAgICAgIGdldENsZWFuVmFsdWVGb3JSZWNvcmREYXRhTGlzdChkYXRhLCBbXG4gICAgICAgIFwiRXZlbnQgUGxhY2VcIixcbiAgICAgICAgXCJEZWF0aCBQbGFjZVwiLFxuICAgICAgICBcIlBsYWNlXCIsXG4gICAgICAgIFwiTG9jYXRpb25cIixcbiAgICAgICAgXCJFbmxpc3RtZW50IFBsYWNlXCIsXG4gICAgICAgIFwiUmVzaWRlbmNlXCIsXG4gICAgICAgIFwiUmVzaWRlbmNlIFBsYWNlXCIsXG4gICAgICAgIFwiUmVzaWRlbmNlIExvY2F0aW9uXCIsXG4gICAgICAgIFwiTWlsaXRhcnkgRW5saXN0bWVudCBQbGFjZVwiLFxuICAgICAgICBcIlNlcnZpY2UgU3RhcnQgUGxhY2VcIixcbiAgICAgICAgXCJNaWxpdGFyeSBTZXJ2aWNlIExvY2F0aW9uXCIsXG4gICAgICAgIFwiUGVuc2lvbiBPZmZpY2UgUGxhY2VcIixcbiAgICAgICAgXCJNaWxpdGFyeSBQbGFjZVwiLFxuICAgICAgICBcIlN0YXRpb24gb3IgUmVzaWRlbmNlIFBsYWNlXCIsXG4gICAgICAgIFwiU3RhdGUgb3IgVGVycml0b3J5XCIsXG4gICAgICBdKVxuICAgICk7XG5cbiAgICBsZXQgZGlzY2hhcmdlRGF0ZSA9IGdldENsZWFuVmFsdWVGb3JSZWNvcmREYXRhTGlzdChkYXRhLCBbXCJEaXNjaGFyZ2UgRGF0ZVwiXSwgXCJkYXRlXCIpO1xuICAgIGlmIChkaXNjaGFyZ2VEYXRlKSB7XG4gICAgICByZXN1bHQuZGlzY2hhcmdlRGF0ZSA9IGRpc2NoYXJnZURhdGU7XG4gICAgfVxuXG4gICAgbGV0IHNlcnZpY2VOdW1iZXIgPSBnZXRDbGVhblZhbHVlRm9yUmVjb3JkRGF0YUxpc3QoZGF0YSwgW1wiU2VydmljZSBOdW1iZXJcIiwgXCJSZWdpbWVudGFsIE51bWJlclwiXSk7XG4gICAgaWYgKHNlcnZpY2VOdW1iZXIpIHtcbiAgICAgIHJlc3VsdC5zZXJ2aWNlTnVtYmVyID0gc2VydmljZU51bWJlcjtcbiAgICB9XG4gICAgbGV0IHJhbmsgPSBnZXRDbGVhblZhbHVlRm9yUmVjb3JkRGF0YUxpc3QoZGF0YSwgW1wiUmFua1wiXSk7XG4gICAgaWYgKHJhbmspIHtcbiAgICAgIHJlc3VsdC5yYW5rID0gcmFuaztcbiAgICB9XG4gICAgbGV0IHVuaXQgPSBnZXRDbGVhblZhbHVlRm9yUmVjb3JkRGF0YUxpc3QoZGF0YSwgW1wiQ29ycHMsIFJlZ2ltZW50IG9yIFVuaXRcIiwgXCJSZWdpbWVudFwiLCBcIk1pbGl0YXJ5IFVuaXRcIiwgXCJVbml0XCJdKTtcbiAgICBpZiAodW5pdCkge1xuICAgICAgcmVzdWx0LnVuaXQgPSB1bml0O1xuICAgIH1cbiAgICBsZXQgbWlsaXRhcnlCcmFuY2ggPSBnZXRDbGVhblZhbHVlRm9yUmVjb3JkRGF0YUxpc3QoZGF0YSwgW1wiRW5saXN0bWVudCBCcmFuY2hcIiwgXCJCcmFuY2ggb2YgU2VydmljZVwiXSk7XG4gICAgaWYgKG1pbGl0YXJ5QnJhbmNoKSB7XG4gICAgICByZXN1bHQubWlsaXRhcnlCcmFuY2ggPSBtaWxpdGFyeUJyYW5jaDtcbiAgICB9XG4gICAgbGV0IG5leHRPZktpbiA9IGdldENsZWFuVmFsdWVGb3JSZWNvcmREYXRhTGlzdChkYXRhLCBbXCJOZXh0IG9mIEtpblwiXSk7XG4gICAgaWYgKG5leHRPZktpbikge1xuICAgICAgcmVzdWx0Lm5leHRPZktpbiA9IG5leHRPZktpbjtcbiAgICB9XG5cbiAgICAvLyBzb21ldGltZXMgYSBtaWxpdGFyeSByZWNvcmQgY2FuIGNvbnRhaW4gYSBzcG91c2UgbmFtZSBhbmQgcG9zc2libHkgYSBtYXJyaWFnZSBkYXRlXG4gICAgbGV0IHNwb3VzZU5hbWUgPSBnZXRDbGVhblZhbHVlRm9yUmVjb3JkRGF0YUxpc3QoZGF0YSwgW1wiU3BvdXNlXCIsIFwiU3BvdXNlIE5hbWVcIiwgXCJTcG91c2UncyBOYW1lXCJdKTtcbiAgICBpZiAoc3BvdXNlTmFtZSkge1xuICAgICAgbGV0IG5hbWUgPSBuZXcgV3RzTmFtZSgpO1xuICAgICAgbmFtZS5uYW1lID0gc3BvdXNlTmFtZTtcblxuICAgICAgbGV0IHNwb3VzZSA9IHtcbiAgICAgICAgbmFtZTogbmFtZSxcbiAgICAgIH07XG5cbiAgICAgIGxldCBtYXJyaWFnZURhdGUgPSBnZXRDbGVhblZhbHVlRm9yUmVjb3JkRGF0YUxpc3QoZGF0YSwgW1wiTWFycmlhZ2UgRGF0ZVwiXSk7XG4gICAgICBsZXQgbWFycmlhZ2VQbGFjZSA9IGdldENsZWFuVmFsdWVGb3JSZWNvcmREYXRhTGlzdChkYXRhLCBbXCJNYXJyaWFnZSBQbGFjZVwiXSk7XG5cbiAgICAgIGlmIChtYXJyaWFnZURhdGUpIHtcbiAgICAgICAgc3BvdXNlLm1hcnJpYWdlRGF0ZSA9IG5ldyBXdHNEYXRlKCk7XG4gICAgICAgIHNwb3VzZS5tYXJyaWFnZURhdGUuZGF0ZVN0cmluZyA9IG1hcnJpYWdlRGF0ZTtcbiAgICAgIH1cblxuICAgICAgaWYgKG1hcnJpYWdlUGxhY2UpIHtcbiAgICAgICAgc3BvdXNlLm1hcnJpYWdlUGxhY2UgPSBuZXcgV3RzUGxhY2UoKTtcbiAgICAgICAgc3BvdXNlLm1hcnJpYWdlUGxhY2UucGxhY2VTdHJpbmcgPSBtYXJyaWFnZVBsYWNlO1xuICAgICAgfVxuXG4gICAgICByZXN1bHQuc3BvdXNlcyA9IFtzcG91c2VdO1xuICAgIH1cbiAgfSBlbHNlIGlmIChyZXN1bHQucmVjb3JkVHlwZSA9PSBSVC5TY2hvb2xSZWNvcmRzKSB7XG4gICAgcmVzdWx0LnNldEV2ZW50RGF0ZShnZXRDbGVhblZhbHVlRm9yUmVjb3JkRGF0YUxpc3QoZGF0YSwgW1wiWWVhcmJvb2sgRGF0ZVwiLCBcIkFkbWlzc2lvbiBEYXRlXCJdLCBcImRhdGVcIikpO1xuXG4gICAgcmVzdWx0LnNldEJpcnRoRGF0ZShnZXRDbGVhblZhbHVlRm9yUmVjb3JkRGF0YUxpc3QoZGF0YSwgW1wiQmlydGggRGF0ZVwiXSwgXCJkYXRlXCIpKTtcbiAgICByZXN1bHQuc2V0QmlydGhZZWFyKGdldENsZWFuVmFsdWVGb3JSZWNvcmREYXRhTGlzdChkYXRhLCBbXCJCaXJ0aCBZZWFyXCJdKSk7XG5cbiAgICBsZXQgc2Nob29sTG9jYXRpb24gPSBnZXRDbGVhblZhbHVlRm9yUmVjb3JkRGF0YUxpc3QoZGF0YSwgW1wiU2Nob29sIExvY2F0aW9uXCJdKTtcbiAgICBsZXQgc2Nob29sTmFtZSA9IGdldENsZWFuVmFsdWVGb3JSZWNvcmREYXRhTGlzdChkYXRhLCBbXCJTY2hvb2xcIl0pO1xuXG4gICAgcmVzdWx0LnNldEV2ZW50UGxhY2Uoc2Nob29sTG9jYXRpb24pO1xuXG4gICAgaWYgKHNjaG9vbE5hbWUpIHtcbiAgICAgIHJlc3VsdC5zY2hvb2xOYW1lID0gc2Nob29sTmFtZTtcbiAgICB9XG5cbiAgICBsZXQgYWdlID0gZ2V0Q2xlYW5WYWx1ZUZvclJlY29yZERhdGFMaXN0KGRhdGEsIFtcIkFnZVwiLCBcIkVzdGltYXRlZCBBZ2VcIl0pO1xuICAgIGlmIChhZ2UpIHtcbiAgICAgIHJlc3VsdC5hZ2VBdEV2ZW50ID0gYWdlO1xuICAgIH1cblxuICAgIGxldCBmYXRoZXJOYW1lID0gZ2V0Q2xlYW5SZWNvcmREYXRhVmFsdWUoZGF0YSwgXCJGYXRoZXJcIik7XG4gICAgaWYgKGZhdGhlck5hbWUpIHtcbiAgICAgIGxldCBmYXRoZXIgPSByZXN1bHQuYWRkRmF0aGVyKCk7XG4gICAgICBmYXRoZXIubmFtZS5uYW1lID0gZmF0aGVyTmFtZTtcbiAgICB9XG4gICAgbGV0IG1vdGhlck5hbWUgPSBnZXRDbGVhblJlY29yZERhdGFWYWx1ZShkYXRhLCBcIk1vdGhlclwiKTtcbiAgICBpZiAobW90aGVyTmFtZSkge1xuICAgICAgbGV0IG1vdGhlciA9IHJlc3VsdC5hZGRNb3RoZXIoKTtcbiAgICAgIG1vdGhlci5uYW1lLm5hbWUgPSBtb3RoZXJOYW1lO1xuICAgIH1cbiAgfSBlbHNlIGlmIChyZXN1bHQucmVjb3JkVHlwZSA9PSBSVC5QYXNzZW5nZXJMaXN0KSB7XG4gICAgbGV0IGRlcGFydHVyZURhdGUgPSBnZXRDbGVhblZhbHVlRm9yUmVjb3JkRGF0YUxpc3QoZGF0YSwgW1wiRGVwYXJ0dXJlIERhdGVcIiwgXCJEZXBhcnR1cmUgWWVhclwiXSwgXCJkYXRlXCIpO1xuICAgIGxldCBhcnJpdmFsRGF0ZSA9IGdldENsZWFuVmFsdWVGb3JSZWNvcmREYXRhTGlzdChkYXRhLCBbXCJBcnJpdmFsIERhdGVcIiwgXCJBcnJpdmFsIFllYXJcIiwgXCJBcnJpdmFsIHllYXJcIl0sIFwiZGF0ZVwiKTtcbiAgICBsZXQgZGVwYXJ0dXJlUGxhY2UgPSBnZXRDbGVhblZhbHVlRm9yUmVjb3JkRGF0YUxpc3QoZGF0YSwgW1wiRGVwYXJ0dXJlIFBsYWNlXCJdKTtcbiAgICBsZXQgYXJyaXZhbFBsYWNlID0gZ2V0Q2xlYW5WYWx1ZUZvclJlY29yZERhdGFMaXN0KGRhdGEsIFtcIkFycml2YWwgUGxhY2VcIiwgXCJBcnJpdmFsIENvdW50cnlcIl0pO1xuXG4gICAgcmVzdWx0LnNldEZpZWxkSWZWYWx1ZUV4aXN0cyhcImRlcGFydHVyZURhdGVcIiwgZGVwYXJ0dXJlRGF0ZSk7XG4gICAgcmVzdWx0LnNldEZpZWxkSWZWYWx1ZUV4aXN0cyhcImRlcGFydHVyZVBsYWNlXCIsIGRlcGFydHVyZVBsYWNlKTtcbiAgICByZXN1bHQuc2V0RmllbGRJZlZhbHVlRXhpc3RzKFwiYXJyaXZhbERhdGVcIiwgYXJyaXZhbERhdGUpO1xuICAgIHJlc3VsdC5zZXRGaWVsZElmVmFsdWVFeGlzdHMoXCJhcnJpdmFsUGxhY2VcIiwgYXJyaXZhbFBsYWNlKTtcblxuICAgIGlmIChkYXRhLnRpdGxlQ29sbGVjdGlvbi50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKFwiYXJyaXZcIikpIHtcbiAgICAgIHJlc3VsdC5zZXRFdmVudERhdGUoYXJyaXZhbERhdGUpO1xuICAgICAgcmVzdWx0LnNldEV2ZW50UGxhY2UoYXJyaXZhbFBsYWNlKTtcbiAgICB9IGVsc2UgaWYgKGRhdGEudGl0bGVDb2xsZWN0aW9uLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoXCJkZXBhcnRcIikpIHtcbiAgICAgIHJlc3VsdC5zZXRFdmVudERhdGUoZGVwYXJ0dXJlRGF0ZSk7XG4gICAgICByZXN1bHQuc2V0RXZlbnRQbGFjZShkZXBhcnR1cmVQbGFjZSk7XG4gICAgfSBlbHNlIGlmIChhcnJpdmFsRGF0ZSB8fCBhcnJpdmFsUGxhY2UpIHtcbiAgICAgIHJlc3VsdC5zZXRFdmVudERhdGUoYXJyaXZhbERhdGUpO1xuICAgICAgcmVzdWx0LnNldEV2ZW50UGxhY2UoYXJyaXZhbFBsYWNlKTtcbiAgICB9IGVsc2UgaWYgKGRlcGFydHVyZURhdGUgfHwgZGVwYXJ0dXJlUGxhY2UpIHtcbiAgICAgIHJlc3VsdC5zZXRFdmVudERhdGUoZGVwYXJ0dXJlRGF0ZSk7XG4gICAgICByZXN1bHQuc2V0RXZlbnRQbGFjZShkZXBhcnR1cmVQbGFjZSk7XG4gICAgfVxuXG4gICAgcmVzdWx0LnNldEZpZWxkSWZWYWx1ZUV4aXN0cyhcInNoaXBOYW1lXCIsIGdldENsZWFuVmFsdWVGb3JSZWNvcmREYXRhTGlzdChkYXRhLCBbXCJTaGlwXCJdKSk7XG5cbiAgICByZXN1bHQuc2V0RmllbGRJZlZhbHVlRXhpc3RzKFxuICAgICAgXCJhZ2VBdEV2ZW50XCIsXG4gICAgICBnZXRDbGVhblZhbHVlRm9yUmVjb3JkRGF0YUxpc3QoZGF0YSwgW1wiQWdlXCIsIFwiRGVwYXJ0dXJlIEFnZVwiLCBcIkFycml2YWwgQWdlXCJdKVxuICAgICk7XG4gIH0gZWxzZSBpZiAocmVzdWx0LnJlY29yZFR5cGUgPT0gUlQuTmF0dXJhbGl6YXRpb24pIHtcbiAgICByZXN1bHQuc2V0RXZlbnREYXRlKFxuICAgICAgZ2V0Q2xlYW5WYWx1ZUZvclJlY29yZERhdGFMaXN0KFxuICAgICAgICBkYXRhLFxuICAgICAgICBbXCJFdmVudCBEYXRlXCIsIFwiRGF0ZVwiLCBcIlBldGl0aW9uIERhdGVcIiwgXCJEZWNsYXJhdGlvbiBEYXRlXCIsIFwiQ2VydGlmaWNhdGUgRGF0ZVwiXSxcbiAgICAgICAgXCJkYXRlXCJcbiAgICAgIClcbiAgICApO1xuICAgIHJlc3VsdC5zZXRFdmVudFBsYWNlKFxuICAgICAgZ2V0Q2xlYW5WYWx1ZUZvclJlY29yZERhdGFMaXN0KGRhdGEsIFtcbiAgICAgICAgXCJQZXRpdGlvbiBQbGFjZVwiLFxuICAgICAgICBcIkRlY2xhcmF0aW9uIFBsYWNlXCIsXG4gICAgICAgIFwiRXZlbnQgUGxhY2VcIixcbiAgICAgICAgXCJQbGFjZVwiLFxuICAgICAgICBcIkxvY2F0aW9uXCIsXG4gICAgICAgIFwiUmVzaWRlbmNlXCIsXG4gICAgICAgIFwiUmVzaWRlbmNlIFBsYWNlXCIsXG4gICAgICAgIFwiUmVzaWRlbmNlIExvY2F0aW9uXCIsXG4gICAgICAgIFwiTmF0dXJhbGlzYXRpb24gUGxhY2VcIixcbiAgICAgICAgXCJBcnJpdmFsIFBsYWNlXCIsXG4gICAgICBdKVxuICAgICk7XG4gICAgbGV0IGFnZUF0RXZlbnQgPSBnZXRDbGVhblZhbHVlRm9yUmVjb3JkRGF0YUxpc3QoZGF0YSwgW1wiQWdlXCIsIFwiUGV0aXRpb24gQWdlXCIsIFwiRGVjbGFyYXRpb24gQWdlXCJdKTtcbiAgICBpZiAoYWdlQXRFdmVudCkge1xuICAgICAgcmVzdWx0LmFnZUF0RXZlbnQgPSBhZ2VBdEV2ZW50O1xuICAgIH1cbiAgICByZXN1bHQuc2V0QmlydGhEYXRlKGdldENsZWFuVmFsdWVGb3JSZWNvcmREYXRhTGlzdChkYXRhLCBbXCJCaXJ0aCBEYXRlXCJdLCBcImRhdGVcIikpO1xuICAgIHJlc3VsdC5zZXRCaXJ0aFBsYWNlKGdldENsZWFuVmFsdWVGb3JSZWNvcmREYXRhTGlzdChkYXRhLCBbXCJCaXJ0aCBQbGFjZVwiXSkpO1xuICAgIGxldCBhcnJpdmFsRGF0ZSA9IGdldENsZWFuVmFsdWVGb3JSZWNvcmREYXRhTGlzdChkYXRhLCBbXCJBcnJpdmFsIERhdGVcIl0pO1xuICAgIGlmIChhcnJpdmFsRGF0ZSkge1xuICAgICAgcmVzdWx0LmFycml2YWxEYXRlID0gYXJyaXZhbERhdGU7XG4gICAgfVxuICAgIGxldCBhcnJpdmFsUGxhY2UgPSBnZXRDbGVhblZhbHVlRm9yUmVjb3JkRGF0YUxpc3QoZGF0YSwgW1wiQXJyaXZhbCBQbGFjZVwiXSk7XG4gICAgaWYgKGFycml2YWxQbGFjZSkge1xuICAgICAgcmVzdWx0LmFycml2YWxQbGFjZSA9IGFycml2YWxQbGFjZTtcbiAgICB9XG4gICAgbGV0IG5hdGl2ZVBsYWNlID0gZ2V0Q2xlYW5WYWx1ZUZvclJlY29yZERhdGFMaXN0KGRhdGEsIFtcIk5hdGl2ZSBQbGFjZVwiXSk7XG4gICAgaWYgKG5hdGl2ZVBsYWNlKSB7XG4gICAgICByZXN1bHQubmF0aXZlUGxhY2UgPSBuYXRpdmVQbGFjZTtcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgLy8gZ2VuZXJpYyByZWNvcmQgdHlwZSBzdXBwb3J0XG4gICAgcmVzdWx0LnNldEV2ZW50RGF0ZShcbiAgICAgIGdldENsZWFuVmFsdWVGb3JSZWNvcmREYXRhTGlzdChcbiAgICAgICAgZGF0YSxcbiAgICAgICAgW1xuICAgICAgICAgIFwiRXZlbnQgRGF0ZVwiLFxuICAgICAgICAgIFwiRGF0ZVwiLFxuICAgICAgICAgIFwiUmVzaWRlbmNlIERhdGVcIixcbiAgICAgICAgICBcIlBheW1lbnQgRGF0ZVwiLFxuICAgICAgICAgIFwiT2JpdHVhcnkgRGF0ZVwiLFxuICAgICAgICAgIFwiRGVwYXJ0dXJlIERhdGVcIixcbiAgICAgICAgICBcIkFycml2YWwgRGF0ZVwiLFxuICAgICAgICAgIFwiRWxlY3RvcmFsIERhdGVcIixcbiAgICAgICAgICBcIkFwcG9pbnRlZCBEYXRlXCIsXG4gICAgICAgICAgXCJBcHBsaWNhdGlvbiBEYXRlXCIsXG4gICAgICAgICAgXCJXYXJyYW50IERhdGVcIixcbiAgICAgICAgICBcIklzc3VlIERhdGVcIixcbiAgICAgICAgICBcIkFwcG9pbnRtZW50IERhdGVcIixcbiAgICAgICAgICBcIkRpc2NoYXJnZSBEYXRlXCIsXG4gICAgICAgICAgXCJEZWF0aCBEYXRlXCIsXG4gICAgICAgICAgXCJIaXJlIERhdGVcIixcbiAgICAgICAgICBcIlJlY29yZCBEYXRlXCIsXG4gICAgICAgICAgXCJBcnJpdmFsIFllYXJcIixcbiAgICAgICAgICBcIkRhdGUgUmVjZWl2ZWRcIixcbiAgICAgICAgICBcIlBhc3Nwb3J0IElzc3VlIERhdGVcIixcbiAgICAgICAgXSxcbiAgICAgICAgXCJkYXRlXCJcbiAgICAgIClcbiAgICApO1xuICAgIHJlc3VsdC5zZXRFdmVudFllYXIoXG4gICAgICBnZXRDbGVhblZhbHVlRm9yUmVjb3JkRGF0YUxpc3QoZGF0YSwgW1xuICAgICAgICBcIkV2ZW50IFllYXJcIixcbiAgICAgICAgXCJZZWFyXCIsXG4gICAgICAgIFwiUHVibGljYXRpb24gWWVhclwiLFxuICAgICAgICBcIkVubGlzdG1lbnQgWWVhclwiLFxuICAgICAgICBcIlJlc2lkZW5jZSBZZWFyXCIsXG4gICAgICBdKVxuICAgICk7XG4gICAgbGV0IGV2ZW50UGxhY2UgPSBnZXRDbGVhblZhbHVlRm9yUmVjb3JkRGF0YUxpc3QoZGF0YSwgW1xuICAgICAgXCJPYml0dWFyeSBQbGFjZVwiLFxuICAgICAgXCJFdmVudCBQbGFjZVwiLFxuICAgICAgXCJQbGFjZVwiLFxuICAgICAgXCJMb2NhdGlvblwiLFxuICAgICAgXCJSZXNpZGVuY2VcIixcbiAgICAgIFwiUmVzaWRlbmNlIFBsYWNlXCIsXG4gICAgICBcIlJlc2lkZW5jZSBMb2NhdGlvblwiLFxuICAgICAgXCJNaWxpdGFyeSBFbmxpc3RtZW50IFBsYWNlXCIsXG4gICAgICBcIkRlcGFydHVyZSBQbGFjZVwiLFxuICAgICAgXCJBcnJpdmFsIFBsYWNlXCIsXG4gICAgICBcIkFwcG9pbnRlZCBQbGFjZVwiLFxuICAgICAgXCJEZWF0aCBQbGFjZVwiLFxuICAgICAgXCJXYXJyYW50IExvY2F0aW9uXCIsXG4gICAgICBcIkxhc3QgUmVzaWRlbmNlIFBsYWNlXCIsXG4gICAgICBcIklzc3VlIFBvcnRcIixcbiAgICAgIFwiUG9zdCBPZmZpY2UgTG9jYXRpb25cIixcbiAgICAgIFwiUmVjb3JkIFBsYWNlXCIsXG4gICAgICBcIlBsYWNlIE1vb3JlZFwiLFxuICAgICAgXCJFbGVjdG9yYWwgUGxhY2VcIixcbiAgICAgIFwiRGVhdGggQ291bnR5XCIsXG4gICAgXSk7XG5cbiAgICBpZiAoIWV2ZW50UGxhY2UpIHtcbiAgICAgIGlmICh0cnVlKSB7XG4gICAgICAgIC8vIHRyeWluZyB0aGlzIG91dCBpbnN0ZWFkICgyIEFwciAyMDIyKVxuICAgICAgICBidWlsZEV2ZW50UGxhY2UoZGF0YSwgcmVzdWx0LCB0cnVlKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXN1bHQuc2V0RXZlbnRQbGFjZShldmVudFBsYWNlKTtcblxuICAgIC8vIGxvdHMgb2YgcmVjb3JkIGhhdmUgYSBiaXJ0aCBkYXRlLiBUaGUgbmFycmF0aXZlIG1heSBub3QgdXNlIGl0IGJ1dCBzZWFyY2ggY2FuLlxuICAgIHJlc3VsdC5zZXRCaXJ0aERhdGUoZ2V0Q2xlYW5WYWx1ZUZvclJlY29yZERhdGFMaXN0KGRhdGEsIFtcIkJpcnRoIERhdGVcIl0sIFwiZGF0ZVwiKSk7XG4gICAgcmVzdWx0LnNldEJpcnRoUGxhY2UoZ2V0Q2xlYW5WYWx1ZUZvclJlY29yZERhdGFMaXN0KGRhdGEsIFtcIkJpcnRoIFBsYWNlXCJdKSk7XG5cbiAgICBsZXQgYWdlQXRFdmVudCA9IGdldENsZWFuVmFsdWVGb3JSZWNvcmREYXRhTGlzdChkYXRhLCBbXCJBZ2VcIiwgXCJEZXBhcnR1cmUgQWdlXCIsIFwiQXJyaXZhbCBBZ2VcIl0pO1xuICAgIGlmIChhZ2VBdEV2ZW50KSB7XG4gICAgICByZXN1bHQuYWdlQXRFdmVudCA9IGFnZUF0RXZlbnQ7XG4gICAgfVxuICB9XG59XG5cbi8vIFRoaXMgZnVuY3Rpb24gZ2VuZXJhbGl6ZXMgdGhlIGRhdGEgZXh0cmFjdGVkIGZyb20gYW4gQW5jZXN0cnkgcGFnZS5cbi8vIFdlIGtub3cgd2hhdCBmaWVsZHMgY2FuIGJlIHRoZXJlLiBBbmQgd2Uga25vdyB0aGUgb25lcyB3ZSB3YW50IGluIGdlbmVyYWxpemVkRGF0YS5cbmZ1bmN0aW9uIGdlbmVyYWxpemVSZWNvcmREYXRhKGlucHV0LCByZXN1bHQpIHtcbiAgbGV0IGRhdGEgPSBpbnB1dC5leHRyYWN0ZWREYXRhO1xuXG4gIHJlc3VsdC5zb3VyY2VUeXBlID0gXCJyZWNvcmRcIjtcbiAgZGV0ZXJtaW5lUmVjb3JkVHlwZUFuZFJvbGUoZGF0YSwgcmVzdWx0KTtcblxuICByZXN1bHQuc291cmNlT2ZEYXRhID0gXCJhbmNlc3RyeVwiO1xuXG4gIC8vIGZyb20gYW4gQW5jZXN0cnkgcmVjb3JkIHdlIG9mdGVuIGRvIG5vdCBoYXZlIHRoZSBuYW1lIGJyb2tlbiBkb3duIGludG8gcGFydHMuXG4gIGxldCBmdWxsTmFtZSA9IGRhdGEudGl0bGVOYW1lO1xuICBpZiAoIWZ1bGxOYW1lICYmIGRhdGEucmVjb3JkRGF0YSkge1xuICAgIGZ1bGxOYW1lID0gZ2V0Q2xlYW5SZWNvcmREYXRhVmFsdWUoZGF0YSwgXCJOYW1lXCIpO1xuICB9XG5cbiAgcmVzdWx0LnNldEZ1bGxOYW1lKGZ1bGxOYW1lKTtcblxuICBpZiAoZGF0YS5yZWNvcmREYXRhICE9IHVuZGVmaW5lZCkge1xuICAgIHJlc3VsdC5zZXRQZXJzb25HZW5kZXIoZ2V0Q2xlYW5SZWNvcmREYXRhVmFsdWUoZGF0YSwgXCJHZW5kZXJcIikpO1xuXG4gICAgcmVzdWx0LnNldEV2ZW50Q291bnRyeShnZXRDbGVhblJlY29yZERhdGFWYWx1ZShkYXRhLCBcIkNvdW50cnlcIikpO1xuICAgIHJlc3VsdC5zZXRFdmVudENvdW50eShnZXRDbGVhblZhbHVlRm9yUmVjb3JkRGF0YUxpc3QoZGF0YSwgW1wiQ291bnR5XCIsIFwiSW5mZXJyZWQgQ291bnR5XCJdKSk7XG5cbiAgICBsZXQgcmVnaXN0cmF0aW9uRGF0ZSA9IGdldENsZWFuVmFsdWVGb3JSZWNvcmREYXRhTGlzdChkYXRhLCBbXCJSZWdpc3RyYXRpb24gRGF0ZVwiLCBcIkRhdGUgb2YgUmVnaXN0cmF0aW9uXCJdLCBcImRhdGVcIik7XG4gICAgaWYgKHJlZ2lzdHJhdGlvbkRhdGUpIHtcbiAgICAgIC8vIHNwZWNpYWwgY2FzZSwgZGF0ZSBjb3VsZCBiZSBvZiBmb3JtIFwiMTkzMyBKYW4tRmViLU1hclwiXG4gICAgICAvLyBlLmcuIGh0dHBzOi8vd3d3LmFuY2VzdHJ5LmNvbS9kaXNjb3Zlcnl1aS1jb250ZW50L3ZpZXcvNjQwNzQxNjoyNTM0XG4gICAgICBpZiAoL15cXGRcXGRcXGRcXGQgK1xcd1xcd1xcd1xcLVxcd1xcd1xcd1xcLVxcd1xcd1xcdyQvLnRlc3QocmVnaXN0cmF0aW9uRGF0ZSkpIHtcbiAgICAgICAgbGV0IHllYXJTdHJpbmcgPSByZWdpc3RyYXRpb25EYXRlLnJlcGxhY2UoL14oXFxkXFxkXFxkXFxkKSArXFx3XFx3XFx3XFwtXFx3XFx3XFx3XFwtXFx3XFx3XFx3JC8sIFwiJDFcIik7XG4gICAgICAgIGxldCBhbmNlc3RyeVF1YXJ0ZXIgPSByZWdpc3RyYXRpb25EYXRlLnJlcGxhY2UoL15cXGRcXGRcXGRcXGQgKyhcXHdcXHdcXHdcXC1cXHdcXHdcXHdcXC1cXHdcXHdcXHcpJC8sIFwiJDFcIik7XG4gICAgICAgIGlmICh5ZWFyU3RyaW5nICYmIHllYXJTdHJpbmcgIT0gcmVnaXN0cmF0aW9uRGF0ZSAmJiBhbmNlc3RyeVF1YXJ0ZXIgJiYgYW5jZXN0cnlRdWFydGVyICE9IHJlZ2lzdHJhdGlvbkRhdGUpIHtcbiAgICAgICAgICBsZXQgcXVhcnRlciA9IC0xO1xuICAgICAgICAgIGZvciAobGV0IHF1YXJ0ZXJOYW1lIG9mIGFuY2VzdHJ5UXVhcnRlck5hbWVzKSB7XG4gICAgICAgICAgICBpZiAoYW5jZXN0cnlRdWFydGVyID09IHF1YXJ0ZXJOYW1lLm5hbWUpIHtcbiAgICAgICAgICAgICAgcXVhcnRlciA9IHF1YXJ0ZXJOYW1lLnZhbHVlO1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKHF1YXJ0ZXIgIT0gLTEpIHtcbiAgICAgICAgICAgIHJlc3VsdC5zZXRFdmVudFllYXIoeWVhclN0cmluZyk7XG4gICAgICAgICAgICByZXN1bHQuc2V0RXZlbnRRdWFydGVyKHF1YXJ0ZXIpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmVzdWx0LnNldEV2ZW50RGF0ZShyZWdpc3RyYXRpb25EYXRlKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgbGV0IHJlZ2lzdHJhdGlvblllYXIgPSBnZXRDbGVhblJlY29yZERhdGFWYWx1ZShkYXRhLCBcIlJlZ2lzdHJhdGlvbiBZZWFyXCIpO1xuICAgICAgaWYgKHJlZ2lzdHJhdGlvblllYXIpIHtcbiAgICAgICAgcmVzdWx0LnNldEV2ZW50WWVhcihyZWdpc3RyYXRpb25ZZWFyKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBsZXQgcmVnaXN0cmF0aW9uRGlzdHJpY3QgPSBnZXRDbGVhblZhbHVlRm9yUmVjb3JkRGF0YUxpc3QoZGF0YSwgW1wiUmVnaXN0cmF0aW9uIERpc3RyaWN0XCIsIFwiUmVnaXN0cmF0aW9uIGRpc3RyaWN0XCJdKTtcbiAgICBpZiAocmVnaXN0cmF0aW9uRGlzdHJpY3QpIHtcbiAgICAgIHJlc3VsdC5yZWdpc3RyYXRpb25EaXN0cmljdCA9IHJlZ2lzdHJhdGlvbkRpc3RyaWN0O1xuICAgIH1cblxuICAgIGxldCBhbmNlc3RyeVF1YXJ0ZXIgPSBnZXRDbGVhblZhbHVlRm9yUmVjb3JkRGF0YUxpc3QoZGF0YSwgW1wiUmVnaXN0cmF0aW9uIFF1YXJ0ZXJcIiwgXCJRdWFydGVyIG9mIHRoZSBZZWFyXCJdKTtcbiAgICBpZiAoYW5jZXN0cnlRdWFydGVyKSB7XG4gICAgICBsZXQgcXVhcnRlciA9IC0xO1xuICAgICAgZm9yIChsZXQgcXVhcnRlck5hbWUgb2YgYW5jZXN0cnlRdWFydGVyTmFtZXMpIHtcbiAgICAgICAgaWYgKGFuY2VzdHJ5UXVhcnRlciA9PSBxdWFydGVyTmFtZS5uYW1lKSB7XG4gICAgICAgICAgcXVhcnRlciA9IHF1YXJ0ZXJOYW1lLnZhbHVlO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBpZiAocXVhcnRlciAhPSAtMSkge1xuICAgICAgICByZXN1bHQuc2V0RXZlbnRRdWFydGVyKHF1YXJ0ZXIpO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAocmVnaXN0cmF0aW9uRGF0ZSkge1xuICAgICAgaWYgKC9eXFx3XFx3XFx3IFxcZFxcZFxcZFxcZCQvLnRlc3QocmVnaXN0cmF0aW9uRGF0ZSkpIHtcbiAgICAgICAgbGV0IHllYXJTdHJpbmcgPSByZWdpc3RyYXRpb25EYXRlLnJlcGxhY2UoL15cXHdcXHdcXHcgKFxcZFxcZFxcZFxcZCkkLywgXCIkMVwiKTtcbiAgICAgICAgbGV0IGFuY2VzdHJ5UXVhcnRlciA9IHJlZ2lzdHJhdGlvbkRhdGUucmVwbGFjZSgvXihcXHdcXHdcXHcpIFxcZFxcZFxcZFxcZCQvLCBcIiQxXCIpO1xuXG4gICAgICAgIGlmICh5ZWFyU3RyaW5nICYmIHllYXJTdHJpbmcgIT0gcmVnaXN0cmF0aW9uRGF0ZSAmJiBhbmNlc3RyeVF1YXJ0ZXIgJiYgYW5jZXN0cnlRdWFydGVyICE9IHJlZ2lzdHJhdGlvbkRhdGUpIHtcbiAgICAgICAgICBsZXQgcXVhcnRlciA9IC0xO1xuICAgICAgICAgIGZvciAobGV0IHF1YXJ0ZXJOYW1lIG9mIGFuY2VzdHJ5UXVhcnRlck1vbnRoTmFtZXMpIHtcbiAgICAgICAgICAgIGlmIChhbmNlc3RyeVF1YXJ0ZXIgPT0gcXVhcnRlck5hbWUubmFtZSkge1xuICAgICAgICAgICAgICBxdWFydGVyID0gcXVhcnRlck5hbWUudmFsdWU7XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAocXVhcnRlciAhPSAtMSkge1xuICAgICAgICAgICAgcmVzdWx0LnNldEV2ZW50UXVhcnRlcihxdWFydGVyKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICBnZW5lcmFsaXplRGF0YUdpdmVuUmVjb3JkVHlwZShkYXRhLCByZXN1bHQpO1xuICB9XG5cbiAgLy8gQ29sbGVjdGlvblxuICBpZiAoZGF0YS5kYklkKSB7XG4gICAgLy8gc29tZXRpbWUgdGhlIGRiSWQgaXMgdGhlIHRleHQgdmVyc2lvbiBhbmQgbm90IHRoZSBudW1iZXIuXG4gICAgLy8gZS5nLiAxOTExRW5nbGFuZCBpbnN0ZWFkIG9mIDIzNTJcbiAgICBsZXQgY29sbGVjdGlvbklkID0gZGF0YS5kYklkO1xuICAgIGxldCBhbHRJZENvbGxlY3Rpb24gPSBSQy5maW5kQ29sbGVjdGlvbkJ5QWx0SWQoXCJhbmNlc3RyeVwiLCBkYXRhLmRiSWQpO1xuICAgIGlmIChhbHRJZENvbGxlY3Rpb24pIHtcbiAgICAgIGNvbGxlY3Rpb25JZCA9IGFsdElkQ29sbGVjdGlvbi5zaXRlc1tcImFuY2VzdHJ5XCJdLmlkO1xuICAgIH1cbiAgICByZXN1bHQuY29sbGVjdGlvbkRhdGEgPSB7XG4gICAgICBpZDogY29sbGVjdGlvbklkLFxuICAgIH07XG5cbiAgICBpZiAoZGF0YS5yZWNvcmREYXRhKSB7XG4gICAgICAvLyBjb3VsZCBiZSBhbiBpbWFnZSBwYWdlXG4gICAgICBsZXQgdm9sdW1lID0gZ2V0Q2xlYW5WYWx1ZUZvclJlY29yZERhdGFMaXN0KGRhdGEsIFtcIlZvbHVtZVwiLCBcIlZvbHVtZSBOdW1iZXJcIiwgXCJWb2x1bWUgbnVtYmVyXCJdKTtcbiAgICAgIGlmICh2b2x1bWUpIHtcbiAgICAgICAgcmVzdWx0LmNvbGxlY3Rpb25EYXRhLnZvbHVtZSA9IHZvbHVtZTtcbiAgICAgIH1cbiAgICAgIGxldCBwYWdlID0gZ2V0Q2xlYW5WYWx1ZUZvclJlY29yZERhdGFMaXN0KGRhdGEsIFtcIlBhZ2VcIiwgXCJQYWdlIG51bWJlclwiLCBcIlBhZ2UgTnVtYmVyXCJdKTtcbiAgICAgIGlmIChwYWdlKSB7XG4gICAgICAgIHJlc3VsdC5jb2xsZWN0aW9uRGF0YS5wYWdlID0gcGFnZTtcbiAgICAgIH1cbiAgICAgIGxldCBmb2xpbyA9IGdldENsZWFuUmVjb3JkRGF0YVZhbHVlKGRhdGEsIFwiRm9saW9cIik7XG4gICAgICBpZiAoZm9saW8pIHtcbiAgICAgICAgcmVzdWx0LmNvbGxlY3Rpb25EYXRhLmZvbGlvID0gZm9saW87XG4gICAgICB9XG4gICAgICBsZXQgcGllY2UgPSBnZXRDbGVhblJlY29yZERhdGFWYWx1ZShkYXRhLCBcIlBpZWNlXCIpO1xuICAgICAgaWYgKHBpZWNlKSB7XG4gICAgICAgIHJlc3VsdC5jb2xsZWN0aW9uRGF0YS5waWVjZSA9IHBpZWNlO1xuICAgICAgfVxuICAgICAgbGV0IHNjaGVkdWxlID0gZ2V0Q2xlYW5WYWx1ZUZvclJlY29yZERhdGFMaXN0KGRhdGEsIFtcIlNjaGVkdWxlIE51bWJlclwiLCBcIkhvdXNlaG9sZCBTY2hlZHVsZSBOdW1iZXJcIl0pO1xuICAgICAgaWYgKHNjaGVkdWxlKSB7XG4gICAgICAgIHJlc3VsdC5jb2xsZWN0aW9uRGF0YS5zY2hlZHVsZSA9IHNjaGVkdWxlO1xuICAgICAgfVxuICAgICAgbGV0IHBhcmlzaCA9IGdldENsZWFuVmFsdWVGb3JSZWNvcmREYXRhTGlzdChkYXRhLCBbXCJDaXZpbCBQYXJpc2hcIiwgXCJQYXJpc2hcIl0pO1xuICAgICAgaWYgKHBhcmlzaCkge1xuICAgICAgICByZXN1bHQuY29sbGVjdGlvbkRhdGEucGFyaXNoID0gcGFyaXNoO1xuICAgICAgfVxuICAgICAgbGV0IGNvdW50eSA9IGdldENsZWFuVmFsdWVGb3JSZWNvcmREYXRhTGlzdChkYXRhLCBbXCJDb3VudHkvSXNsYW5kXCIsIFwiQ291bnR5XCJdKTtcbiAgICAgIGlmIChjb3VudHkpIHtcbiAgICAgICAgcmVzdWx0LmNvbGxlY3Rpb25EYXRhLmNvdW50eSA9IGNvdW50eTtcbiAgICAgIH1cbiAgICAgIGxldCBib3JvdWdoID0gZ2V0Q2xlYW5WYWx1ZUZvclJlY29yZERhdGFMaXN0KGRhdGEsIFtcIkJvcm91Z2hcIl0pO1xuICAgICAgaWYgKGJvcm91Z2gpIHtcbiAgICAgICAgcmVzdWx0LmNvbGxlY3Rpb25EYXRhLmJvcm91Z2ggPSBib3JvdWdoO1xuICAgICAgfVxuICAgIH1cbiAgfVxufVxuXG5mdW5jdGlvbiBnZW5lcmFsaXplUHJvZmlsZURhdGEoaW5wdXQsIHJlc3VsdCkge1xuICBsZXQgZGF0YSA9IGlucHV0LmV4dHJhY3RlZERhdGE7XG5cbiAgcmVzdWx0LnNvdXJjZVR5cGUgPSBcInByb2ZpbGVcIjtcbiAgcmVzdWx0LnNvdXJjZU9mRGF0YSA9IFwiYW5jZXN0cnlcIjtcblxuICByZXN1bHQuc2V0RnVsbE5hbWUoZGF0YS50aXRsZU5hbWUpO1xuXG4gIHJlc3VsdC5zZXRCaXJ0aERhdGUoZGF0YS5iaXJ0aERhdGUpO1xuICByZXN1bHQuc2V0QmlydGhQbGFjZShkYXRhLmJpcnRoUGxhY2UpO1xuICByZXN1bHQuc2V0RGVhdGhEYXRlKGRhdGEuZGVhdGhEYXRlKTtcbiAgcmVzdWx0LnNldERlYXRoUGxhY2UoZGF0YS5kZWF0aFBsYWNlKTtcblxuICByZXN1bHQuc2V0UGVyc29uR2VuZGVyKGRhdGEuZ2VuZGVyKTtcblxuICBpZiAoZGF0YS5tYXJyaWFnZXMpIHtcbiAgICBmb3IgKGxldCBtYXJyaWFnZSBvZiBkYXRhLm1hcnJpYWdlcykge1xuICAgICAgbGV0IHNwb3VzZSA9IHJlc3VsdC5hZGRTcG91c2UoKTtcbiAgICAgIHNwb3VzZS5uYW1lLnNldEZ1bGxOYW1lKG1hcnJpYWdlLnNwb3VzZU5hbWUpO1xuICAgICAgc3BvdXNlLm1hcnJpYWdlRGF0ZS5kYXRlU3RyaW5nID0gbWFycmlhZ2UuZGF0ZTtcbiAgICAgIHNwb3VzZS5tYXJyaWFnZVBsYWNlLnBsYWNlU3RyaW5nID0gbWFycmlhZ2UucGxhY2U7XG4gICAgfVxuICB9XG5cbiAgaWYgKGRhdGEuZmF0aGVyTmFtZSkge1xuICAgIGxldCBmYXRoZXIgPSByZXN1bHQuYWRkRmF0aGVyKCk7XG4gICAgZmF0aGVyLm5hbWUuc2V0RnVsbE5hbWUoZGF0YS5mYXRoZXJOYW1lKTtcbiAgfVxuICBpZiAoZGF0YS5tb3RoZXJOYW1lKSB7XG4gICAgbGV0IG1vdGhlciA9IHJlc3VsdC5hZGRNb3RoZXIoKTtcbiAgICBtb3RoZXIubmFtZS5zZXRGdWxsTmFtZShkYXRhLm1vdGhlck5hbWUpO1xuICB9XG5cbiAgLy8gYW5hbHl6ZSB0aGUgc3VybmFtZSAtIHNvbWV0aW1lcyBBbmNlc3RyeSB1c2VycyBwdXQgdGhlIExOQUIgaW4gcGFyZW5zXG4gIGxldCBzdXJuYW1lID0gZGF0YS5zdXJuYW1lO1xuICBjb25zdCBvcGVuUGFyZW5JbmRleCA9IHN1cm5hbWUuaW5kZXhPZihcIihcIik7XG4gIGlmIChyZXN1bHQubmFtZSAmJiBvcGVuUGFyZW5JbmRleCA9PSAwKSB7XG4gICAgY29uc3QgY2xvc2VQYXJlbkluZGV4ID0gc3VybmFtZS5pbmRleE9mKFwiKVwiLCBvcGVuUGFyZW5JbmRleCk7XG4gICAgaWYgKGNsb3NlUGFyZW5JbmRleCAhPSAtMSkge1xuICAgICAgbGV0IGxuYWIgPSBzdXJuYW1lLnN1YnN0cmluZyhvcGVuUGFyZW5JbmRleCArIDEsIGNsb3NlUGFyZW5JbmRleCkudHJpbSgpO1xuICAgICAgbGV0IHJlbWFpbmRlciA9IHN1cm5hbWUuc3Vic3RyaW5nKGNsb3NlUGFyZW5JbmRleCArIDEpLnRyaW0oKTtcbiAgICAgIGlmIChsbmFiICYmIHJlbWFpbmRlcikge1xuICAgICAgICByZXN1bHQubGFzdE5hbWVBdEJpcnRoID0gbG5hYjtcbiAgICAgICAgc3VybmFtZSA9IGxuYWI7XG4gICAgICAgIGNvbnN0IHNwYWNlSW5kZXggPSByZW1haW5kZXIuaW5kZXhPZihcIiBcIik7XG4gICAgICAgIGlmIChzcGFjZUluZGV4ID09IC0xKSB7XG4gICAgICAgICAgcmVzdWx0Lmxhc3ROYW1lQXREZWF0aCA9IHJlbWFpbmRlcjtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyB0aGVyZSBhcmUgbXVsdGlwbGUgbmFtZXMgYWZ0ZXIgY2xvc2UgcGFyZW5cbiAgICAgICAgICAvLyBUaGVzZSBjb3VsZCBiZSBsYXN0IG5hbWUgYXQgZGVhdGggZm9sbG9lZCBieSBvdGhlciBtYXJyaWVkIG5hbWVzXG4gICAgICAgICAgLy8gQ291bGQgY2hlY2sgbmFtZXMgb2Ygc3BvdXNlcyB0byBnZXQgbW9yZSBpbmZvXG4gICAgICAgICAgY29uc3QgY2xuID0gcmVtYWluZGVyLnN1YnN0cmluZygwLCBzcGFjZUluZGV4KTtcbiAgICAgICAgICBpZiAoY2xuKSB7XG4gICAgICAgICAgICByZXN1bHQubGFzdE5hbWVBdERlYXRoID0gcmVtYWluZGVyO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuICByZXN1bHQuc2V0TGFzdE5hbWVBbmRGb3JlTmFtZXMoc3VybmFtZSwgZGF0YS5naXZlbk5hbWUpO1xufVxuXG4vLyBUaGlzIGZ1bmN0aW9uIGdlbmVyYWxpemVzIHRoZSBkYXRhIGV4dHJhY3RlZCBmcm9tIGFuIEFuY2VzdHJ5IHBhZ2UuXG4vLyBXZSBrbm93IHdoYXQgZmllbGRzIGNhbiBiZSB0aGVyZS4gQW5kIHdlIGtub3cgdGhlIG9uZXMgd2Ugd2FudCBpbiBnZW5lcmFsaXplZERhdGEuXG5mdW5jdGlvbiBnZW5lcmFsaXplRGF0YShpbnB1dCkge1xuICBsZXQgZGF0YSA9IGlucHV0LmV4dHJhY3RlZERhdGE7XG5cbiAgbGV0IHJlc3VsdCA9IG5ldyBHZW5lcmFsaXplZERhdGEoKTtcblxuICBpZiAoZGF0YS5wYWdlVHlwZSA9PSBcInBlcnNvbkZhY3RzXCIpIHtcbiAgICBnZW5lcmFsaXplUHJvZmlsZURhdGEoaW5wdXQsIHJlc3VsdCk7XG4gIH0gZWxzZSB7XG4gICAgZ2VuZXJhbGl6ZVJlY29yZERhdGEoaW5wdXQsIHJlc3VsdCk7XG4gIH1cblxuICByZXN1bHQuaGFzVmFsaWREYXRhID0gdHJ1ZTtcblxuICAvL2NvbnNvbGUubG9nKFwiRW5kIG9mIEFuY2VzdHJ5IGdlbmVyYWxpemVEYXRhLCByZXN1bHQgaXM6XCIpO1xuICAvL2NvbnNvbGUubG9nKHJlc3VsdCk7XG5cbiAgcmV0dXJuIHJlc3VsdDtcbn1cblxuZnVuY3Rpb24gc2V0RXh0cmFHZEhvdXNlaG9sZEZpZWxkcyhleHRyYWN0ZWREYXRhLCBnZW5lcmFsaXplZE1lbWJlciwgZmllbGROYW1lcykge1xuICBmdW5jdGlvbiBzZXRNZW1iZXJEYXRhKHByb3BlcnR5TmFtZSwgcmVjb3JkRGF0YU5hbWVzLCBzdGFuZGFyZGl6ZUZ1bmN0aW9uKSB7XG4gICAgaWYgKCFnZW5lcmFsaXplZE1lbWJlcltwcm9wZXJ0eU5hbWVdKSB7XG4gICAgICBsZXQgdmFsdWUgPSBnZXRDbGVhblZhbHVlRm9yUmVjb3JkRGF0YUxpc3QoZXh0cmFjdGVkRGF0YSwgcmVjb3JkRGF0YU5hbWVzKTtcbiAgICAgIGlmICh2YWx1ZSkge1xuICAgICAgICBpZiAoc3RhbmRhcmRpemVGdW5jdGlvbikge1xuICAgICAgICAgIHZhbHVlID0gc3RhbmRhcmRpemVGdW5jdGlvbih2YWx1ZSk7XG4gICAgICAgIH1cbiAgICAgICAgZ2VuZXJhbGl6ZWRNZW1iZXJbcHJvcGVydHlOYW1lXSA9IHZhbHVlO1xuXG4gICAgICAgIGlmICghZmllbGROYW1lcy5pbmNsdWRlcyhwcm9wZXJ0eU5hbWUpKSB7XG4gICAgICAgICAgZmllbGROYW1lcy5wdXNoKHByb3BlcnR5TmFtZSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBzZXRNZW1iZXJEYXRhKFxuICAgIFwicmVsYXRpb25zaGlwXCIsXG4gICAgW1wiUmVsYXRpb25zaGlwIHRvIEhlYWRcIiwgXCJSZWxhdGlvbiB0byBIZWFkXCIsIFwiUmVsYXRpb24gdG8gSGVhZCBvZiBIb3VzZVwiLCBcIlJlbGF0aW9uc2hpcFwiLCBcIlJlbGF0aW9uXCJdLFxuICAgIEdELnN0YW5kYXJkaXplUmVsYXRpb25zaGlwVG9IZWFkXG4gICk7XG4gIHNldE1lbWJlckRhdGEoXCJtYXJpdGFsU3RhdHVzXCIsIFtcIk1hcml0YWwgU3RhdHVzXCIsIFwiTWFyaXRhbCBzdGF0dXNcIl0sIEdELnN0YW5kYXJkaXplTWFyaXRhbFN0YXR1cyk7XG4gIHNldE1lbWJlckRhdGEoXCJnZW5kZXJcIiwgW1wiR2VuZGVyXCJdLCBHRC5zdGFuZGFyZGl6ZUdlbmRlcik7XG4gIHNldE1lbWJlckRhdGEoXCJvY2N1cGF0aW9uXCIsIFtcIk9jY3VwYXRpb25cIl0pO1xuICBzZXRNZW1iZXJEYXRhKFwiYmlydGhEYXRlXCIsIFtcIkJpcnRoIERhdGVcIiwgXCJET0JcIl0pO1xuICBzZXRNZW1iZXJEYXRhKFwiYmlydGhQbGFjZVwiLCBbXCJXaGVyZSBib3JuXCIsIFwiV2hlcmUgQm9yblwiLCBcIkJpcnRoIFBsYWNlXCIsIFwiQmlydGhwbGFjZVwiLCBcIkJpcnRoIHBsYWNlXCJdKTtcbiAgc2V0TWVtYmVyRGF0YShcImJpcnRoWWVhclwiLCBbXCJFc3RpbWF0ZWQgQmlydGggWWVhclwiLCBcIkJpcnRoIFllYXJcIl0pO1xuICBzZXRNZW1iZXJEYXRhKFwiZW1wbG95ZXJcIiwgW1wiRW1wbG95ZXJcIl0pO1xufVxuXG5mdW5jdGlvbiByZWdlbmVyYWxpemVEYXRhV2l0aExpbmtlZFJlY29yZHMoaW5wdXQpIHtcbiAgbGV0IGRhdGEgPSBpbnB1dC5leHRyYWN0ZWREYXRhO1xuICBsZXQgcmVzdWx0ID0gaW5wdXQuZ2VuZXJhbGl6ZWREYXRhO1xuICBsZXQgbGlua2VkUmVjb3JkcyA9IGlucHV0LmxpbmtlZFJlY29yZHM7XG5cbiAgLy9jb25zb2xlLmxvZyhcInJlZ2VuZXJhbGl6ZURhdGFXaXRoTGlua2VkUmVjb3JkcywgZGF0YSBpczpcIik7XG4gIC8vY29uc29sZS5sb2coZGF0YSk7XG4gIC8vY29uc29sZS5sb2coXCJyZWdlbmVyYWxpemVEYXRhV2l0aExpbmtlZFJlY29yZHMsIHJlc3VsdCBpczpcIik7XG4gIC8vY29uc29sZS5sb2cocmVzdWx0KTtcbiAgLy9jb25zb2xlLmxvZyhcInJlZ2VuZXJhbGl6ZURhdGFXaXRoTGlua2VkUmVjb3JkcywgbGlua2VkUmVjb3JkcyBpczpcIik7XG4gIC8vY29uc29sZS5sb2cobGlua2VkUmVjb3Jkcyk7XG5cbiAgaWYgKGRhdGEuaG91c2Vob2xkKSB7XG4gICAgZm9yIChsZXQgZXh0cmFjdGVkTWVtYmVyIG9mIGRhdGEuaG91c2Vob2xkLm1lbWJlcnMpIHtcbiAgICAgIGlmIChleHRyYWN0ZWRNZW1iZXIubGluaykge1xuICAgICAgICAvLyBmaW5kIHRoZSBzYW1lIG1lbWJlciBpbiB0aGUgZ2VuZXJhbGl6ZWQgZGF0YVxuICAgICAgICBsZXQgZ2VuZXJhbGl6ZWRNZW1iZXIgPSB1bmRlZmluZWQ7XG4gICAgICAgIGZvciAobGV0IG1lbWJlciBvZiByZXN1bHQuaG91c2Vob2xkQXJyYXkpIHtcbiAgICAgICAgICAvL2NvbnNvbGUubG9nKFwicmVnZW5lcmFsaXplRGF0YVdpdGhMaW5rZWRSZWNvcmRzIGV4dHJhY3RlZE1lbWJlci5saW5rIGlzOlwiICsgZXh0cmFjdGVkTWVtYmVyLmxpbmspO1xuICAgICAgICAgIGlmIChtZW1iZXIudWlkID09IGV4dHJhY3RlZE1lbWJlci5saW5rKSB7XG4gICAgICAgICAgICBnZW5lcmFsaXplZE1lbWJlciA9IG1lbWJlcjtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChnZW5lcmFsaXplZE1lbWJlcikge1xuICAgICAgICAgIGxldCBtZW1iZXJEYXRhID0gdW5kZWZpbmVkO1xuICAgICAgICAgIGlmIChnZW5lcmFsaXplZE1lbWJlci5pc1NlbGVjdGVkKSB7XG4gICAgICAgICAgICAvLyB3ZSBkb24ndCBoYXZlIGEgbGlua2VkIHJlY29yZCBmb3IgdGhlIHByaW1hcnkgbWVtYmVyXG4gICAgICAgICAgICAvLyBCdXQgd2Ugd2FudCB0byBkbyBzb21lIHNpbWlsYXIgZmlsbGluZyBvdXQgb2YgZmllbGRzXG4gICAgICAgICAgICAvL2NvbnNvbGUubG9nKFwicmVnZW5lcmFsaXplRGF0YVdpdGhMaW5rZWRSZWNvcmRzIG1lbWJlciBpcyBzZWxlY3RlZFwiKTtcbiAgICAgICAgICAgIG1lbWJlckRhdGEgPSBkYXRhO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBsZXQgbWVtYmVyTGlua2VkUmVjb3JkID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgZm9yIChsZXQgbGlua2VkUmVjb3JkIG9mIGxpbmtlZFJlY29yZHMpIHtcbiAgICAgICAgICAgICAgaWYgKGxpbmtlZFJlY29yZC5saW5rID09IGV4dHJhY3RlZE1lbWJlci5saW5rKSB7XG4gICAgICAgICAgICAgICAgbWVtYmVyTGlua2VkUmVjb3JkID0gbGlua2VkUmVjb3JkO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAobWVtYmVyTGlua2VkUmVjb3JkKSB7XG4gICAgICAgICAgICAgIG1lbWJlckRhdGEgPSBtZW1iZXJMaW5rZWRSZWNvcmQuZXh0cmFjdGVkRGF0YTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG5cbiAgICAgICAgICBpZiAobWVtYmVyRGF0YSkge1xuICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhcInJlZ2VuZXJhbGl6ZURhdGFXaXRoTGlua2VkUmVjb3JkcyBmb3VuZCBtYXRjaGluZyBtZW1iZXIuIE5hbWUgaXM6XCIgKyBnZW5lcmFsaXplZE1lbWJlci5uYW1lKTtcbiAgICAgICAgICAgIC8vY29uc29sZS5sb2coXCJyZWdlbmVyYWxpemVEYXRhV2l0aExpbmtlZFJlY29yZHMuIEV4dHJhY3RlZCBkYXRhIGlzIDpcIik7XG4gICAgICAgICAgICAvL2NvbnNvbGUubG9nKG1lbWJlckRhdGEpO1xuICAgICAgICAgICAgc2V0RXh0cmFHZEhvdXNlaG9sZEZpZWxkcyhtZW1iZXJEYXRhLCBnZW5lcmFsaXplZE1lbWJlciwgcmVzdWx0LmhvdXNlaG9sZEFycmF5RmllbGRzKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH0gZWxzZSBpZiAoZGF0YS5saW5rRGF0YSAmJiByZXN1bHQucm9sZSkge1xuICAgIC8vIGlmIHRoZXJlIGFyZSBsaW5rRGF0YSBhbmQgdGhpcyBwZXJzb24gaXMgbm90IHRoZSBwcmltYXJ5IHBlcnNvbiBvbiB0aGUgcmVjb3JkXG4gICAgLy8gd2Ugc2hvdWxkIGJlIGFibGUgdG8gZ2V0IG1vcmUgZGV0YWlsIGZyb20gdGhlIGxpbkRhdGEgb2YgdGhlIHByaW1hcnkgcGVyc29uXG5cbiAgICAvLyBOb3RlIHRoZSBjb2RlIGJlbG93IG1heSBiZSByZWR1bmRhbnQgYmVjYXVzZSB0aGUgY29kZSB0aGF0IGFkZHMgdGhlIGxpbmtlZCByZWNvcmRzXG4gICAgLy8gb25seSBhZGRzIHRoZSBvbmUgdGhhdCBpcyBuZWVkZWQgc28gd2UgYXJlIGR1cGxpY2F0aW5nIHRoaW5ncyBoZXJlXG4gICAgbGV0IHByaW1hcnlMaW5rID0gdW5kZWZpbmVkO1xuICAgIGlmIChyZXN1bHQucm9sZSA9PSBcIlBhcmVudFwiKSB7XG4gICAgICBsZXQgbGluayA9IGRhdGEubGlua0RhdGFbXCJDaGlsZFwiXTtcbiAgICAgIGlmIChsaW5rKSB7XG4gICAgICAgIHByaW1hcnlMaW5rID0gbGluaztcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKHJlc3VsdC5yb2xlID09IFwiQ2hpbGRcIikge1xuICAgICAgbGV0IGxpbmsgPSBkYXRhLmxpbmtEYXRhW1wiUGFyZW50XCJdO1xuICAgICAgaWYgKGxpbmspIHtcbiAgICAgICAgcHJpbWFyeUxpbmsgPSBsaW5rO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbGV0IGxpbmsgPSBkYXRhLmxpbmtEYXRhW1wiRmF0aGVyXCJdO1xuICAgICAgICBpZiAobGluaykge1xuICAgICAgICAgIHByaW1hcnlMaW5rID0gbGluaztcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBsZXQgbGluayA9IGRhdGEubGlua0RhdGFbXCJNb3RoZXJcIl07XG4gICAgICAgICAgaWYgKGxpbmspIHtcbiAgICAgICAgICAgIHByaW1hcnlMaW5rID0gbGluaztcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKHJlc3VsdC5yb2xlID09IFwiU2libGluZ1wiKSB7XG4gICAgICBsZXQgbGluayA9IGRhdGEubGlua0RhdGFbXCJTaWJsaW5nc1wiXTtcbiAgICAgIGlmIChsaW5rKSB7XG4gICAgICAgIHByaW1hcnlMaW5rID0gbGluaztcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvL2NvbnNvbGUubG9nKFwicmVnZW5lcmFsaXplRGF0YVdpdGhMaW5rZWRSZWNvcmRzLCBwcmltYXJ5TGluayBpczpcIik7XG4gICAgLy9jb25zb2xlLmxvZyhwcmltYXJ5TGluayk7XG5cbiAgICBpZiAocHJpbWFyeUxpbmspIHtcbiAgICAgIGxldCBwcmltYXJ5TGlua2VkUmVjb3JkID0gdW5kZWZpbmVkO1xuICAgICAgZm9yIChsZXQgbGlua2VkUmVjb3JkIG9mIGxpbmtlZFJlY29yZHMpIHtcbiAgICAgICAgaWYgKGxpbmtlZFJlY29yZC5saW5rID09IHByaW1hcnlMaW5rKSB7XG4gICAgICAgICAgcHJpbWFyeUxpbmtlZFJlY29yZCA9IGxpbmtlZFJlY29yZDtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpZiAocHJpbWFyeUxpbmtlZFJlY29yZCkge1xuICAgICAgICAvL2NvbnNvbGUubG9nKFwicmVnZW5lcmFsaXplRGF0YVdpdGhMaW5rZWRSZWNvcmRzLCBwcmltYXJ5TGlua2VkUmVjb3JkLmV4dHJhY3RlZERhdGEgaXM6XCIpO1xuICAgICAgICAvL2NvbnNvbGUubG9nKHByaW1hcnlMaW5rZWRSZWNvcmQuZXh0cmFjdGVkRGF0YSk7XG5cbiAgICAgICAgLy8gTm93IHdlIGNhbiBsb29rIGZvciBleHRyYSBkYXRhXG4gICAgICAgIGxldCBnZElucHV0ID0ge307XG4gICAgICAgIGdkSW5wdXQuZXh0cmFjdGVkRGF0YSA9IHByaW1hcnlMaW5rZWRSZWNvcmQuZXh0cmFjdGVkRGF0YTtcbiAgICAgICAgbGV0IGdlbmVyYWxpemVkRGF0YSA9IGdlbmVyYWxpemVEYXRhKGdkSW5wdXQpO1xuXG4gICAgICAgIC8vY29uc29sZS5sb2coXCJyZWdlbmVyYWxpemVEYXRhV2l0aExpbmtlZFJlY29yZHMsIHByaW1hcnlMaW5rZWRSZWNvcmQgZ2VuZXJhbGl6ZWREYXRhIGlzOlwiKTtcbiAgICAgICAgLy9jb25zb2xlLmxvZyhnZW5lcmFsaXplZERhdGEpO1xuXG4gICAgICAgIC8vIGV2ZW4gaWYgd2UgaGF2ZSBhbiBldmVudCBkYXRlIGFuZCBwbGFjZSB0aGUgb25lIGZyb20gdGhlIGxpbmtlZCByZWNvcmQgc2hvdWxkIGJlIGJldHRlci5cbiAgICAgICAgLy8gRm9yIGV4YW1wbGUgdGhlIHBhcmVudCBpbiBhIGNoaWxkIGJpcnQgcmVjb3JkIGNhbiBoYXZlIGEgYmlydGggcGxhY2Ugd2hpY2ggaGFzIGJlZW5cbiAgICAgICAgLy8gaW50ZXJwcmV0ZWQgYXMgdGhlIGV2ZW50IHBsYWNlIGluY29ycmVjdGx5IGUuZy46XG4gICAgICAgIC8vIGh0dHBzOi8vd3d3LmFuY2VzdHJ5LmNvbS9kaXNjb3Zlcnl1aS1jb250ZW50L3ZpZXcvMzAwMDY1NjIzOjg3MDNcbiAgICAgICAgaWYgKGdlbmVyYWxpemVkRGF0YS5ldmVudFBsYWNlKSB7XG4gICAgICAgICAgcmVzdWx0LmV2ZW50UGxhY2UgPSBnZW5lcmFsaXplZERhdGEuZXZlbnRQbGFjZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZ2VuZXJhbGl6ZWREYXRhLmV2ZW50RGF0ZSkge1xuICAgICAgICAgIHJlc3VsdC5ldmVudERhdGUgPSBnZW5lcmFsaXplZERhdGEuZXZlbnREYXRlO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gYmVjYXVzZSB0aGUgbGlua2VkIHJlY29yZCBoYXMgbW9yZSBkYXRhIGl0IHdpbGwgaGF2ZSBhIG1vcmUgYWNjdXJhdGUgcmVjb3JkVHlwZVxuICAgICAgICAvLyBGb3IgZXhhbXBsZSB0aGUgZXhpc3Rpbmcgb25lIG1pZ2h0IGJlIEJpcnRoT3JCYXB0aXNtIGJ1dCB0aGUgbGlua2VkIG9uZSBtYXkgaGF2ZVxuICAgICAgICAvLyBCYXB0aXNtIGJlY2F1c2UgaXQgaGFzIGEgQmFwdGlzbURhdGUuXG4gICAgICAgIC8vIEJ1dCB3ZSBoYXZlIHRvIGJlIGNhcmVmdWwgaW4gY2FzZSBpdCBpcyBhbiB1bmNsYXNzaWZpZWQgZXZlbnRcbiAgICAgICAgaWYgKGdlbmVyYWxpemVkRGF0YS5yZWNvcmRUeXBlICYmIGdlbmVyYWxpemVkRGF0YS5yZWNvcmRUeXBlICE9IFJULlVuY2xhc3NpZmllZCkge1xuICAgICAgICAgIHJlc3VsdC5yZWNvcmRUeXBlID0gZ2VuZXJhbGl6ZWREYXRhLnJlY29yZFR5cGU7XG5cbiAgICAgICAgICBpZiAocmVzdWx0Lm92ZXJyaWRlUmVmVGl0bGUpIHtcbiAgICAgICAgICAgIC8vIHRoaXMgbWVhbnMgdGhhdCB3ZSBhc2tlZCB0aGUgdXNlciB0byBzcGVjaWZ5IHRoZSByZWNvcmRUeXBlIGJlY2F1c2UgaXQgd2FzIHVuY2xhc3NpZmllZFxuICAgICAgICAgICAgLy8gQnV0IG5vdyB3ZSBoYXZlIGEgcmVjb3JkVHlwZSBmcm9tIHRoZSBsaW5rZWRSZWNvcmQuXG4gICAgICAgICAgICAvLyBTbyB3ZSBkaWRuJ3QgbmVlZCB0byBhc2suIElmIHdlIGxlYXZlIHRoZSBvdmVycmlkZVJlZlRpdGxlIHdlIGNhbiBlbmQgdXAgd2l0aFxuICAgICAgICAgICAgLy8gY29udHJhZGljdG9yeSBkYXRhIGluIHRoZSBjaXRhdGlvbiBpZiB0aGV5IHBpY2tlZCB0aGUgd3JvbmcgdHlwZS5cbiAgICAgICAgICAgIGRlbGV0ZSByZXN1bHQub3ZlcnJpZGVSZWZUaXRsZTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoZ2VuZXJhbGl6ZWREYXRhLnBlcnNvbkdlbmRlciAmJiAhcmVzdWx0LnByaW1hcnlQZXJzb25HZW5kZXIpIHtcbiAgICAgICAgICByZXN1bHQucHJpbWFyeVBlcnNvbkdlbmRlciA9IGdlbmVyYWxpemVkRGF0YS5wZXJzb25HZW5kZXI7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBGb3IgYSBjaGlsZCBtYXJyaWFnZSB3ZSB3YW50IHRvIGdldCB0aGUgc3BvdXNlLFxuICAgICAgICAvLyBUaGlzIGlzIGEgYml0IGNvbmZ1c2luZyAtIHdlIHN0b3JlIHRoaXMgaW4gcmVzdWx0LnNwb3VzZXMgZXZlbiB0aG91Z2ggaXQgaXNcbiAgICAgICAgLy8gdGhlIHNwb3VzZSBvZiB0aGUgY2hpbGQgbm90IHRoaXMgcGVyc29uXG4gICAgICAgIGlmIChnZW5lcmFsaXplZERhdGEuc3BvdXNlcykge1xuICAgICAgICAgIHJlc3VsdC5zcG91c2VzID0gZ2VuZXJhbGl6ZWREYXRhLnNwb3VzZXM7XG5cbiAgICAgICAgICBpZiAoZ2VuZXJhbGl6ZWREYXRhLmFnZUF0RXZlbnQpIHtcbiAgICAgICAgICAgIHJlc3VsdC5wcmltYXJ5UGVyc29uQWdlID0gZ2VuZXJhbGl6ZWREYXRhLmFnZUF0RXZlbnQ7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIGZvciBhIGNoaWxkIGJpcnRoL2JhcHRpc20gd2Ugd2FudCB0byBnZXQgdGhlIG90aGVyIHBhcmVudCBhbmQgcHV0IHRoYXQgaW4gc3BvdXNlc1xuICAgICAgICAgIGxldCBvdGhlclBhcmVudCA9IHVuZGVmaW5lZDtcbiAgICAgICAgICBpZiAoZ2VuZXJhbGl6ZWREYXRhLnBhcmVudHMpIHtcbiAgICAgICAgICAgIGlmIChyZXN1bHQucGVyc29uR2VuZGVyID09IFwibWFsZVwiKSB7XG4gICAgICAgICAgICAgIGlmIChnZW5lcmFsaXplZERhdGEucGFyZW50cy5tb3RoZXIpIHtcbiAgICAgICAgICAgICAgICBvdGhlclBhcmVudCA9IGdlbmVyYWxpemVkRGF0YS5wYXJlbnRzLm1vdGhlcjtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIGlmIChyZXN1bHQucGVyc29uR2VuZGVyID09IFwiZmVtYWxlXCIpIHtcbiAgICAgICAgICAgICAgaWYgKGdlbmVyYWxpemVkRGF0YS5wYXJlbnRzLmZhdGhlcikge1xuICAgICAgICAgICAgICAgIG90aGVyUGFyZW50ID0gZ2VuZXJhbGl6ZWREYXRhLnBhcmVudHMuZmF0aGVyO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHJlc3VsdC5uYW1lICYmIHJlc3VsdC5uYW1lLm5hbWUpIHtcbiAgICAgICAgICAgICAgLy8gZG9uJ3Qga25vdyBnZW5kZXIgc28gaGF2ZSB0byBjb21wYXJlIG91ciBuYW1lIHdpdGggcGFyZW50IG5hbWVzXG4gICAgICAgICAgICAgIGxldCBmYXRoZXJOYW1lID0gXCJcIjtcbiAgICAgICAgICAgICAgbGV0IG1vdGhlck5hbWUgPSBcIlwiO1xuICAgICAgICAgICAgICBpZiAoZ2VuZXJhbGl6ZWREYXRhLnBhcmVudHMuZmF0aGVyICYmIGdlbmVyYWxpemVkRGF0YS5wYXJlbnRzLmZhdGhlci5uYW1lKSB7XG4gICAgICAgICAgICAgICAgZmF0aGVyTmFtZSA9IGdlbmVyYWxpemVkRGF0YS5wYXJlbnRzLmZhdGhlci5uYW1lLm5hbWU7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgaWYgKGdlbmVyYWxpemVkRGF0YS5wYXJlbnRzLm1vdGhlciAmJiBnZW5lcmFsaXplZERhdGEucGFyZW50cy5tb3RoZXIubmFtZSkge1xuICAgICAgICAgICAgICAgIG1vdGhlck5hbWUgPSBnZW5lcmFsaXplZERhdGEucGFyZW50cy5tb3RoZXIubmFtZS5uYW1lO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGlmIChyZXN1bHQubmFtZS5uYW1lID09IGZhdGhlck5hbWUgJiYgZ2VuZXJhbGl6ZWREYXRhLnBhcmVudHMubW90aGVyKSB7XG4gICAgICAgICAgICAgICAgb3RoZXJQYXJlbnQgPSBnZW5lcmFsaXplZERhdGEucGFyZW50cy5tb3RoZXI7XG4gICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzdWx0Lm5hbWUubmFtZSA9PSBtb3RoZXJOYW1lICYmIGdlbmVyYWxpemVkRGF0YS5wYXJlbnRzLmZhdGhlcikge1xuICAgICAgICAgICAgICAgIG90aGVyUGFyZW50ID0gZ2VuZXJhbGl6ZWREYXRhLnBhcmVudHMuZmF0aGVyO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgaWYgKG90aGVyUGFyZW50ICYmIG90aGVyUGFyZW50Lm5hbWUpIHtcbiAgICAgICAgICAgIHJlc3VsdC5zcG91c2VzID0gW107XG4gICAgICAgICAgICByZXN1bHQuc3BvdXNlcy5wdXNoKG90aGVyUGFyZW50KTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvL2NvbnNvbGUubG9nKFwicmVnZW5lcmFsaXplRGF0YVdpdGhMaW5rZWRSZWNvcmRzLCByZXN1bHQgaXM6XCIpO1xuICAvL2NvbnNvbGUubG9nKHJlc3VsdCk7XG59XG5cbmV4cG9ydCB7XG4gIGdlbmVyYWxpemVEYXRhLFxuICBnZW5lcmFsaXplRGF0YUdpdmVuUmVjb3JkVHlwZSxcbiAgcmVnZW5lcmFsaXplRGF0YVdpdGhMaW5rZWRSZWNvcmRzLFxuICBHZW5lcmFsaXplZERhdGEsXG4gIGRhdGVRdWFsaWZpZXJzLFxufTtcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./extension/site/ancestry/core/ancestry_generalize_data.mjs\n");

/***/ }),

/***/ "./extension/site/ancestry/core/ancestry_options.mjs":
/*!***********************************************************!*\
  !*** ./extension/site/ancestry/core/ancestry_options.mjs ***!
  \***********************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _base_core_options_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../base/core/options/options_registry.mjs */ \"./extension/base/core/options/options_registry.mjs\");\n/*\nMIT License\n\nCopyright (c) 2020 Robert M Pavey\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.\n*/\n\n\n\nconst searchOptionsGroup = {\n  category: \"search\",\n  subcategory: \"ancestry\",\n  tab: \"search\",\n  subsection: \"ancestry\",\n  subheading: \"parameters\",\n  options: [\n    {\n      optionName: \"domain\",\n      type: \"select\",\n      label: \"Domain to use for searches (where is your subscription?)\",\n      comment:\n        \"NOTE: If you are trying to follow an Ancestry link/template that points to a different domain\" +\n        ' you can right click on the link and use the context menu item \"Sourcer: Open Link in New Tab\".' +\n        \" This will redirect to the domain selected above.\",\n      values: [\n        { value: \"ancestry.com\", text: \"ancestry.com\" },\n        { value: \"ancestry.co.uk\", text: \"ancestry.co.uk\" },\n        { value: \"ancestry.ca\", text: \"ancestry.ca\" },\n        { value: \"ancestry.com.au\", text: \"ancestry.com.au\" },\n        { value: \"ancestry.de\", text: \"ancestry.de\" },\n        { value: \"ancestry.it\", text: \"ancestry.it\" },\n        { value: \"ancestry.fr\", text: \"ancestry.fr\" },\n        { value: \"ancestry.se\", text: \"ancestry.se\" },\n        { value: \"ancestry.mx\", text: \"ancestry.mx\" },\n        { value: \"ancestrylibrary.com\", text: \"ancestrylibrary.com\" },\n        {\n          value: \"ancestrylibraryedition.co.uk\",\n          text: \"ancestrylibraryedition.co.uk\",\n        },\n        { value: \"ancestrylibrary.ca\", text: \"ancestrylibrary.ca\" },\n        { value: \"ancestrylibrary.com.au\", text: \"ancestrylibrary.com.au\" },\n      ],\n      defaultValue: \"ancestry.com\",\n    },\n  ],\n};\n\nconst citationOptionsGroup = {\n  category: \"citation\",\n  subcategory: \"ancestry\",\n  tab: \"citation\",\n  subsection: \"ancestry\",\n  options: [\n    {\n      optionName: \"dataStyle\",\n      type: \"select\",\n      label: \"Include record data at end of citation as\",\n      values: [\n        { value: \"none\", text: \"Do not include data\" },\n        {\n          value: \"string\",\n          text: \"Sentence (fall back to list if no sentence)\",\n        },\n        { value: \"list\", text: \"List of field names/values\" },\n        { value: \"table\", text: \"Table of field names/values\" },\n      ],\n      defaultValue: \"string\",\n      unitTestValue: \"table\",\n    },\n    {\n      optionName: \"recordTemplateDomain\",\n      type: \"select\",\n      label: \"Ancestry Record template domain\",\n      values: [\n        { value: \"fromRecord\", text: \"Use the domain from record being cited\" },\n        { value: \"ancestry.com\", text: \"ancestry.com (no 3rd parameter)\" },\n        { value: \"ancestry.co.uk\", text: \"ancestry.co.uk\" },\n        { value: \"ancestry.ca\", text: \"ancestry.ca\" },\n        { value: \"ancestry.com.au\", text: \"ancestry.com.au\" },\n        { value: \"ancestry.de\", text: \"ancestry.de\" },\n        { value: \"ancestry.it\", text: \"ancestry.it\" },\n        { value: \"ancestry.fr\", text: \"ancestry.fr\" },\n        { value: \"ancestry.se\", text: \"ancestry.se\" },\n        { value: \"ancestry.mx\", text: \"ancestry.mx\" },\n      ],\n      defaultValue: \"fromRecord\",\n    },\n    {\n      optionName: \"subscriptionRequired\",\n      type: \"select\",\n      label: \"Indicate that a subscription is required with link\",\n      values: [\n        { value: \"none\", text: \"Do not add any such indication\" },\n        {\n          value: \"subscriptionRequired\",\n          text: 'Include the text \"subscription required\"',\n        },\n        {\n          value: \"requiresSubscription\",\n          text: 'Include the text \"requires subscription\"',\n        },\n        { value: \"dollar\", text: 'Include the text \"$\"' },\n        { value: \"paywall\", text: 'Include the text \"paywall\"' },\n      ],\n      defaultValue: \"none\",\n    },\n    {\n      optionName: \"includeSharingTemplate\",\n      type: \"checkbox\",\n      label: \"Include a sharing template to the original image if available\",\n      defaultValue: true,\n    },\n    {\n      optionName: \"addEditCitationButton\",\n      type: \"checkbox\",\n      label: \"On Ancestry image pages add a button to edit citation in panel\",\n      defaultValue: true,\n    },\n  ],\n};\n\n(0,_base_core_options_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerSubsectionForOptions)(\"search\", \"ancestry\", \"Ancestry\");\n(0,_base_core_options_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerSiteSearchPopupOptionsGroup)(\"ancestry\", 1, 1);\n(0,_base_core_options_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerSubheadingForOptions)(\"search\", \"ancestry\", \"parameters\", \"Search Parameters\");\n(0,_base_core_options_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerOptionsGroup)(searchOptionsGroup);\n\n(0,_base_core_options_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerSubsectionForOptions)(\"citation\", \"ancestry\", \"Ancestry\");\n(0,_base_core_options_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerOptionsGroup)(citationOptionsGroup);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9leHRlbnNpb24vc2l0ZS9hbmNlc3RyeS9jb3JlL2FuY2VzdHJ5X29wdGlvbnMubWpzLmpzIiwibWFwcGluZ3MiOiI7O0FBQUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQU95RDs7QUFFekQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVLDZDQUE2QztBQUN2RCxVQUFVLGlEQUFpRDtBQUMzRCxVQUFVLDJDQUEyQztBQUNyRCxVQUFVLG1EQUFtRDtBQUM3RCxVQUFVLDJDQUEyQztBQUNyRCxVQUFVLDJDQUEyQztBQUNyRCxVQUFVLDJDQUEyQztBQUNyRCxVQUFVLDJDQUEyQztBQUNyRCxVQUFVLDJDQUEyQztBQUNyRCxVQUFVLDJEQUEyRDtBQUNyRTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1QsVUFBVSx5REFBeUQ7QUFDbkUsVUFBVSxpRUFBaUU7QUFDM0U7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVLDRDQUE0QztBQUN0RDtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1QsVUFBVSxtREFBbUQ7QUFDN0QsVUFBVSxxREFBcUQ7QUFDL0Q7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVLHFFQUFxRTtBQUMvRSxVQUFVLGdFQUFnRTtBQUMxRSxVQUFVLGlEQUFpRDtBQUMzRCxVQUFVLDJDQUEyQztBQUNyRCxVQUFVLG1EQUFtRDtBQUM3RCxVQUFVLDJDQUEyQztBQUNyRCxVQUFVLDJDQUEyQztBQUNyRCxVQUFVLDJDQUEyQztBQUNyRCxVQUFVLDJDQUEyQztBQUNyRCxVQUFVLDJDQUEyQztBQUNyRDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVLHVEQUF1RDtBQUNqRTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNULFVBQVUsK0NBQStDO0FBQ3pELFVBQVUsc0RBQXNEO0FBQ2hFO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7O0FBRUEscUdBQTRCO0FBQzVCLDRHQUFtQztBQUNuQyxxR0FBNEI7QUFDNUIsNkZBQW9COztBQUVwQixxR0FBNEI7QUFDNUIsNkZBQW9CIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vQ2l0YXRpb25FeHRyYWN0b3IvLi9leHRlbnNpb24vc2l0ZS9hbmNlc3RyeS9jb3JlL2FuY2VzdHJ5X29wdGlvbnMubWpzP2IyZjAiXSwic291cmNlc0NvbnRlbnQiOlsiLypcbk1JVCBMaWNlbnNlXG5cbkNvcHlyaWdodCAoYykgMjAyMCBSb2JlcnQgTSBQYXZleVxuXG5QZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYSBjb3B5XG5vZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSBcIlNvZnR3YXJlXCIpLCB0byBkZWFsXG5pbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzXG50byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsXG5jb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXNcbmZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6XG5cblRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkIGluIGFsbFxuY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS5cblxuVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEIFwiQVMgSVNcIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUlxuSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksXG5GSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEVcbkFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVJcbkxJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sXG5PVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOIFRIRVxuU09GVFdBUkUuXG4qL1xuXG5pbXBvcnQge1xuICByZWdpc3RlclN1YnNlY3Rpb25Gb3JPcHRpb25zLFxuICByZWdpc3RlclN1YmhlYWRpbmdGb3JPcHRpb25zLFxuICByZWdpc3Rlck9wdGlvbnNHcm91cCxcbiAgcmVnaXN0ZXJTaXRlU2VhcmNoUG9wdXBPcHRpb25zR3JvdXAsXG59IGZyb20gXCIuLi8uLi8uLi9iYXNlL2NvcmUvb3B0aW9ucy9vcHRpb25zX3JlZ2lzdHJ5Lm1qc1wiO1xuXG5jb25zdCBzZWFyY2hPcHRpb25zR3JvdXAgPSB7XG4gIGNhdGVnb3J5OiBcInNlYXJjaFwiLFxuICBzdWJjYXRlZ29yeTogXCJhbmNlc3RyeVwiLFxuICB0YWI6IFwic2VhcmNoXCIsXG4gIHN1YnNlY3Rpb246IFwiYW5jZXN0cnlcIixcbiAgc3ViaGVhZGluZzogXCJwYXJhbWV0ZXJzXCIsXG4gIG9wdGlvbnM6IFtcbiAgICB7XG4gICAgICBvcHRpb25OYW1lOiBcImRvbWFpblwiLFxuICAgICAgdHlwZTogXCJzZWxlY3RcIixcbiAgICAgIGxhYmVsOiBcIkRvbWFpbiB0byB1c2UgZm9yIHNlYXJjaGVzICh3aGVyZSBpcyB5b3VyIHN1YnNjcmlwdGlvbj8pXCIsXG4gICAgICBjb21tZW50OlxuICAgICAgICBcIk5PVEU6IElmIHlvdSBhcmUgdHJ5aW5nIHRvIGZvbGxvdyBhbiBBbmNlc3RyeSBsaW5rL3RlbXBsYXRlIHRoYXQgcG9pbnRzIHRvIGEgZGlmZmVyZW50IGRvbWFpblwiICtcbiAgICAgICAgJyB5b3UgY2FuIHJpZ2h0IGNsaWNrIG9uIHRoZSBsaW5rIGFuZCB1c2UgdGhlIGNvbnRleHQgbWVudSBpdGVtIFwiU291cmNlcjogT3BlbiBMaW5rIGluIE5ldyBUYWJcIi4nICtcbiAgICAgICAgXCIgVGhpcyB3aWxsIHJlZGlyZWN0IHRvIHRoZSBkb21haW4gc2VsZWN0ZWQgYWJvdmUuXCIsXG4gICAgICB2YWx1ZXM6IFtcbiAgICAgICAgeyB2YWx1ZTogXCJhbmNlc3RyeS5jb21cIiwgdGV4dDogXCJhbmNlc3RyeS5jb21cIiB9LFxuICAgICAgICB7IHZhbHVlOiBcImFuY2VzdHJ5LmNvLnVrXCIsIHRleHQ6IFwiYW5jZXN0cnkuY28udWtcIiB9LFxuICAgICAgICB7IHZhbHVlOiBcImFuY2VzdHJ5LmNhXCIsIHRleHQ6IFwiYW5jZXN0cnkuY2FcIiB9LFxuICAgICAgICB7IHZhbHVlOiBcImFuY2VzdHJ5LmNvbS5hdVwiLCB0ZXh0OiBcImFuY2VzdHJ5LmNvbS5hdVwiIH0sXG4gICAgICAgIHsgdmFsdWU6IFwiYW5jZXN0cnkuZGVcIiwgdGV4dDogXCJhbmNlc3RyeS5kZVwiIH0sXG4gICAgICAgIHsgdmFsdWU6IFwiYW5jZXN0cnkuaXRcIiwgdGV4dDogXCJhbmNlc3RyeS5pdFwiIH0sXG4gICAgICAgIHsgdmFsdWU6IFwiYW5jZXN0cnkuZnJcIiwgdGV4dDogXCJhbmNlc3RyeS5mclwiIH0sXG4gICAgICAgIHsgdmFsdWU6IFwiYW5jZXN0cnkuc2VcIiwgdGV4dDogXCJhbmNlc3RyeS5zZVwiIH0sXG4gICAgICAgIHsgdmFsdWU6IFwiYW5jZXN0cnkubXhcIiwgdGV4dDogXCJhbmNlc3RyeS5teFwiIH0sXG4gICAgICAgIHsgdmFsdWU6IFwiYW5jZXN0cnlsaWJyYXJ5LmNvbVwiLCB0ZXh0OiBcImFuY2VzdHJ5bGlicmFyeS5jb21cIiB9LFxuICAgICAgICB7XG4gICAgICAgICAgdmFsdWU6IFwiYW5jZXN0cnlsaWJyYXJ5ZWRpdGlvbi5jby51a1wiLFxuICAgICAgICAgIHRleHQ6IFwiYW5jZXN0cnlsaWJyYXJ5ZWRpdGlvbi5jby51a1wiLFxuICAgICAgICB9LFxuICAgICAgICB7IHZhbHVlOiBcImFuY2VzdHJ5bGlicmFyeS5jYVwiLCB0ZXh0OiBcImFuY2VzdHJ5bGlicmFyeS5jYVwiIH0sXG4gICAgICAgIHsgdmFsdWU6IFwiYW5jZXN0cnlsaWJyYXJ5LmNvbS5hdVwiLCB0ZXh0OiBcImFuY2VzdHJ5bGlicmFyeS5jb20uYXVcIiB9LFxuICAgICAgXSxcbiAgICAgIGRlZmF1bHRWYWx1ZTogXCJhbmNlc3RyeS5jb21cIixcbiAgICB9LFxuICBdLFxufTtcblxuY29uc3QgY2l0YXRpb25PcHRpb25zR3JvdXAgPSB7XG4gIGNhdGVnb3J5OiBcImNpdGF0aW9uXCIsXG4gIHN1YmNhdGVnb3J5OiBcImFuY2VzdHJ5XCIsXG4gIHRhYjogXCJjaXRhdGlvblwiLFxuICBzdWJzZWN0aW9uOiBcImFuY2VzdHJ5XCIsXG4gIG9wdGlvbnM6IFtcbiAgICB7XG4gICAgICBvcHRpb25OYW1lOiBcImRhdGFTdHlsZVwiLFxuICAgICAgdHlwZTogXCJzZWxlY3RcIixcbiAgICAgIGxhYmVsOiBcIkluY2x1ZGUgcmVjb3JkIGRhdGEgYXQgZW5kIG9mIGNpdGF0aW9uIGFzXCIsXG4gICAgICB2YWx1ZXM6IFtcbiAgICAgICAgeyB2YWx1ZTogXCJub25lXCIsIHRleHQ6IFwiRG8gbm90IGluY2x1ZGUgZGF0YVwiIH0sXG4gICAgICAgIHtcbiAgICAgICAgICB2YWx1ZTogXCJzdHJpbmdcIixcbiAgICAgICAgICB0ZXh0OiBcIlNlbnRlbmNlIChmYWxsIGJhY2sgdG8gbGlzdCBpZiBubyBzZW50ZW5jZSlcIixcbiAgICAgICAgfSxcbiAgICAgICAgeyB2YWx1ZTogXCJsaXN0XCIsIHRleHQ6IFwiTGlzdCBvZiBmaWVsZCBuYW1lcy92YWx1ZXNcIiB9LFxuICAgICAgICB7IHZhbHVlOiBcInRhYmxlXCIsIHRleHQ6IFwiVGFibGUgb2YgZmllbGQgbmFtZXMvdmFsdWVzXCIgfSxcbiAgICAgIF0sXG4gICAgICBkZWZhdWx0VmFsdWU6IFwic3RyaW5nXCIsXG4gICAgICB1bml0VGVzdFZhbHVlOiBcInRhYmxlXCIsXG4gICAgfSxcbiAgICB7XG4gICAgICBvcHRpb25OYW1lOiBcInJlY29yZFRlbXBsYXRlRG9tYWluXCIsXG4gICAgICB0eXBlOiBcInNlbGVjdFwiLFxuICAgICAgbGFiZWw6IFwiQW5jZXN0cnkgUmVjb3JkIHRlbXBsYXRlIGRvbWFpblwiLFxuICAgICAgdmFsdWVzOiBbXG4gICAgICAgIHsgdmFsdWU6IFwiZnJvbVJlY29yZFwiLCB0ZXh0OiBcIlVzZSB0aGUgZG9tYWluIGZyb20gcmVjb3JkIGJlaW5nIGNpdGVkXCIgfSxcbiAgICAgICAgeyB2YWx1ZTogXCJhbmNlc3RyeS5jb21cIiwgdGV4dDogXCJhbmNlc3RyeS5jb20gKG5vIDNyZCBwYXJhbWV0ZXIpXCIgfSxcbiAgICAgICAgeyB2YWx1ZTogXCJhbmNlc3RyeS5jby51a1wiLCB0ZXh0OiBcImFuY2VzdHJ5LmNvLnVrXCIgfSxcbiAgICAgICAgeyB2YWx1ZTogXCJhbmNlc3RyeS5jYVwiLCB0ZXh0OiBcImFuY2VzdHJ5LmNhXCIgfSxcbiAgICAgICAgeyB2YWx1ZTogXCJhbmNlc3RyeS5jb20uYXVcIiwgdGV4dDogXCJhbmNlc3RyeS5jb20uYXVcIiB9LFxuICAgICAgICB7IHZhbHVlOiBcImFuY2VzdHJ5LmRlXCIsIHRleHQ6IFwiYW5jZXN0cnkuZGVcIiB9LFxuICAgICAgICB7IHZhbHVlOiBcImFuY2VzdHJ5Lml0XCIsIHRleHQ6IFwiYW5jZXN0cnkuaXRcIiB9LFxuICAgICAgICB7IHZhbHVlOiBcImFuY2VzdHJ5LmZyXCIsIHRleHQ6IFwiYW5jZXN0cnkuZnJcIiB9LFxuICAgICAgICB7IHZhbHVlOiBcImFuY2VzdHJ5LnNlXCIsIHRleHQ6IFwiYW5jZXN0cnkuc2VcIiB9LFxuICAgICAgICB7IHZhbHVlOiBcImFuY2VzdHJ5Lm14XCIsIHRleHQ6IFwiYW5jZXN0cnkubXhcIiB9LFxuICAgICAgXSxcbiAgICAgIGRlZmF1bHRWYWx1ZTogXCJmcm9tUmVjb3JkXCIsXG4gICAgfSxcbiAgICB7XG4gICAgICBvcHRpb25OYW1lOiBcInN1YnNjcmlwdGlvblJlcXVpcmVkXCIsXG4gICAgICB0eXBlOiBcInNlbGVjdFwiLFxuICAgICAgbGFiZWw6IFwiSW5kaWNhdGUgdGhhdCBhIHN1YnNjcmlwdGlvbiBpcyByZXF1aXJlZCB3aXRoIGxpbmtcIixcbiAgICAgIHZhbHVlczogW1xuICAgICAgICB7IHZhbHVlOiBcIm5vbmVcIiwgdGV4dDogXCJEbyBub3QgYWRkIGFueSBzdWNoIGluZGljYXRpb25cIiB9LFxuICAgICAgICB7XG4gICAgICAgICAgdmFsdWU6IFwic3Vic2NyaXB0aW9uUmVxdWlyZWRcIixcbiAgICAgICAgICB0ZXh0OiAnSW5jbHVkZSB0aGUgdGV4dCBcInN1YnNjcmlwdGlvbiByZXF1aXJlZFwiJyxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIHZhbHVlOiBcInJlcXVpcmVzU3Vic2NyaXB0aW9uXCIsXG4gICAgICAgICAgdGV4dDogJ0luY2x1ZGUgdGhlIHRleHQgXCJyZXF1aXJlcyBzdWJzY3JpcHRpb25cIicsXG4gICAgICAgIH0sXG4gICAgICAgIHsgdmFsdWU6IFwiZG9sbGFyXCIsIHRleHQ6ICdJbmNsdWRlIHRoZSB0ZXh0IFwiJFwiJyB9LFxuICAgICAgICB7IHZhbHVlOiBcInBheXdhbGxcIiwgdGV4dDogJ0luY2x1ZGUgdGhlIHRleHQgXCJwYXl3YWxsXCInIH0sXG4gICAgICBdLFxuICAgICAgZGVmYXVsdFZhbHVlOiBcIm5vbmVcIixcbiAgICB9LFxuICAgIHtcbiAgICAgIG9wdGlvbk5hbWU6IFwiaW5jbHVkZVNoYXJpbmdUZW1wbGF0ZVwiLFxuICAgICAgdHlwZTogXCJjaGVja2JveFwiLFxuICAgICAgbGFiZWw6IFwiSW5jbHVkZSBhIHNoYXJpbmcgdGVtcGxhdGUgdG8gdGhlIG9yaWdpbmFsIGltYWdlIGlmIGF2YWlsYWJsZVwiLFxuICAgICAgZGVmYXVsdFZhbHVlOiB0cnVlLFxuICAgIH0sXG4gICAge1xuICAgICAgb3B0aW9uTmFtZTogXCJhZGRFZGl0Q2l0YXRpb25CdXR0b25cIixcbiAgICAgIHR5cGU6IFwiY2hlY2tib3hcIixcbiAgICAgIGxhYmVsOiBcIk9uIEFuY2VzdHJ5IGltYWdlIHBhZ2VzIGFkZCBhIGJ1dHRvbiB0byBlZGl0IGNpdGF0aW9uIGluIHBhbmVsXCIsXG4gICAgICBkZWZhdWx0VmFsdWU6IHRydWUsXG4gICAgfSxcbiAgXSxcbn07XG5cbnJlZ2lzdGVyU3Vic2VjdGlvbkZvck9wdGlvbnMoXCJzZWFyY2hcIiwgXCJhbmNlc3RyeVwiLCBcIkFuY2VzdHJ5XCIpO1xucmVnaXN0ZXJTaXRlU2VhcmNoUG9wdXBPcHRpb25zR3JvdXAoXCJhbmNlc3RyeVwiLCAxLCAxKTtcbnJlZ2lzdGVyU3ViaGVhZGluZ0Zvck9wdGlvbnMoXCJzZWFyY2hcIiwgXCJhbmNlc3RyeVwiLCBcInBhcmFtZXRlcnNcIiwgXCJTZWFyY2ggUGFyYW1ldGVyc1wiKTtcbnJlZ2lzdGVyT3B0aW9uc0dyb3VwKHNlYXJjaE9wdGlvbnNHcm91cCk7XG5cbnJlZ2lzdGVyU3Vic2VjdGlvbkZvck9wdGlvbnMoXCJjaXRhdGlvblwiLCBcImFuY2VzdHJ5XCIsIFwiQW5jZXN0cnlcIik7XG5yZWdpc3Rlck9wdGlvbnNHcm91cChjaXRhdGlvbk9wdGlvbnNHcm91cCk7XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./extension/site/ancestry/core/ancestry_options.mjs\n");

/***/ }),

/***/ "./extension/site/bg/core/bg_options.mjs":
/*!***********************************************!*\
  !*** ./extension/site/bg/core/bg_options.mjs ***!
  \***********************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _base_core_options_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../base/core/options/options_registry.mjs */ \"./extension/base/core/options/options_registry.mjs\");\n/*\nMIT License\n\nCopyright (c) 2020 Robert M Pavey\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.\n*/\n\n\n\nconst searchOptionsGroup = {\n  category: \"search\",\n  subcategory: \"bg\",\n  tab: \"search\",\n  subsection: \"bg\",\n  subheading: \"parameters\",\n  options: [\n    {\n      optionName: \"exactLastName\",\n      type: \"checkbox\",\n      label: \"Exact last name in search\",\n      defaultValue: false,\n    },\n    {\n      optionName: \"includeFirstName\",\n      type: \"checkbox\",\n      label: \"Include first name in search\",\n      defaultValue: true,\n    },\n    {\n      optionName: \"exactFirstNames\",\n      type: \"checkbox\",\n      label: \"Exact first names in search\",\n      defaultValue: false,\n    },\n    {\n      optionName: \"includeMiddleName\",\n      type: \"checkbox\",\n      label: \"Include middle name in search\",\n      defaultValue: true,\n    },    \n    {\n      optionName: \"includeMaidenName\",\n      type: \"checkbox\",\n      label: \"Include maiden name in search\",\n      defaultValue: true,\n    },\n    {\n      optionName: \"exactMaidenName\",\n      type: \"checkbox\",\n      label: \"Exact maiden name in search\",\n      defaultValue: false,\n    },\n    {\n      optionName: \"birthYearExactness\",\n      type: \"select\",\n      label: \"Search exactness to use for birth year\",\n      values: [\n        { value: \"none\", text: \"Do not specify a birth year\" },\n        //{ value: \"auto\", text: \"Set automatically based on source\" },\n        { value: \"0\", text: \"+/- 0 years\" },\n        { value: \"1\", text: \"+/- 1 years\" },        \n        { value: \"2\", text: \"+/- 2 years\" },\n        { value: \"3\", text: \"+/- 3 years\" },\n        { value: \"4\", text: \"+/- 4 years\" },\n        { value: \"5\", text: \"+/- 5 years\" },\n        { value: \"6\", text: \"+/- 6 years\" },\n        { value: \"7\", text: \"+/- 7 years\" },\n        { value: \"8\", text: \"+/- 8 years\" },\n        { value: \"9\", text: \"+/- 9 years\" },\n        { value: \"10\", text: \"+/- 10 years\" },\n      ],\n      defaultValue: \"5\",\n    },\n    {\n      optionName: \"deathYearExactness\",\n      type: \"select\",\n      label: \"Search exactness to use for death year\",\n      values: [\n        { value: \"none\", text: \"Do not specify a death year\" },\n        //{ value: \"auto\", text: \"Set automatically based on source\" },\n        { value: \"0\", text: \"+/- 0 years\" },\n        { value: \"1\", text: \"+/- 1 years\" },        \n        { value: \"2\", text: \"+/- 2 years\" },\n        { value: \"3\", text: \"+/- 3 years\" },\n        { value: \"4\", text: \"+/- 4 years\" },\n        { value: \"5\", text: \"+/- 5 years\" },\n        { value: \"6\", text: \"+/- 6 years\" },\n        { value: \"7\", text: \"+/- 7 years\" },\n        { value: \"8\", text: \"+/- 8 years\" },\n        { value: \"9\", text: \"+/- 9 years\" },\n        { value: \"10\", text: \"+/- 10 years\" },\n      ],\n      defaultValue: \"5\",\n    },\n  ],\n};\n\nconst citationOptionsGroup = {\n  category: \"citation\",\n  subcategory: \"bg\",\n  tab: \"citation\",\n  subsection: \"bg\",\n  options: [\n        {\n      optionName: \"includeTranscriber\",\n      type: \"checkbox\",\n      label: \"Include the transcriber in the citation\",\n      defaultValue: true,\n      unitTestValue: true,\n    },\n    {\n      optionName: \"includePhotographer\",\n      type: \"checkbox\",\n      label: \"Include the photographer in the citation\",\n      defaultValue: true,\n      unitTestValue: true,\n    },\n    {\n      optionName: \"includeRelatives\",\n      type: \"checkbox\",\n      label: \"List others mentioned on memorial (if any)\",\n      defaultValue: false,\n      unitTestValue: true,\n    },\n    {\n      optionName: \"includeEpitaph\",\n      type: \"checkbox\",\n      label: \"Include the epitaph (if any)\",\n      defaultValue: true,\n    },\n    {\n      optionName: \"bracketsRoundName\",\n      type: \"select\",\n      label: \"If the name has a part surrounded by brackets (usually maiden name)\",\n      values: [\n        { \n          value: \"omit\", \n          text: \"Omit that part of name from citation\",\n        },\n        {\n          value: \"bracket\",\n          text: \"Leave that part of name in brackets in citation\",\n        },\n        {\n          value: \"insert\",\n          text: \"Insert before last name. e.g. Mary Smith (Brown) to Mary (Brown) Smith\",\n        },\n      ],\n      defaultValue: \"insert\",\n    },\n  ],\n};\n\n(0,_base_core_options_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerSubsectionForOptions)(\"search\", \"bg\", \"BillionGraves\");\n(0,_base_core_options_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerSiteSearchPopupOptionsGroup)(\"bg\", 4, 4);\n(0,_base_core_options_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerSubheadingForOptions)(\"search\", \"bg\", \"parameters\", \"Search Parameters\");\n(0,_base_core_options_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerOptionsGroup)(searchOptionsGroup);\n\n(0,_base_core_options_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerSubsectionForOptions)(\"citation\", \"bg\", \"BillionGraves\");\n(0,_base_core_options_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerOptionsGroup)(citationOptionsGroup);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9leHRlbnNpb24vc2l0ZS9iZy9jb3JlL2JnX29wdGlvbnMubWpzLmpzIiwibWFwcGluZ3MiOiI7O0FBQUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQU95RDs7QUFFekQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVSxvREFBb0Q7QUFDOUQsWUFBWSwwREFBMEQ7QUFDdEUsVUFBVSxpQ0FBaUM7QUFDM0MsVUFBVSxpQ0FBaUM7QUFDM0MsVUFBVSxpQ0FBaUM7QUFDM0MsVUFBVSxpQ0FBaUM7QUFDM0MsVUFBVSxpQ0FBaUM7QUFDM0MsVUFBVSxpQ0FBaUM7QUFDM0MsVUFBVSxpQ0FBaUM7QUFDM0MsVUFBVSxpQ0FBaUM7QUFDM0MsVUFBVSxpQ0FBaUM7QUFDM0MsVUFBVSxpQ0FBaUM7QUFDM0MsVUFBVSxtQ0FBbUM7QUFDN0M7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVSxvREFBb0Q7QUFDOUQsWUFBWSwwREFBMEQ7QUFDdEUsVUFBVSxpQ0FBaUM7QUFDM0MsVUFBVSxpQ0FBaUM7QUFDM0MsVUFBVSxpQ0FBaUM7QUFDM0MsVUFBVSxpQ0FBaUM7QUFDM0MsVUFBVSxpQ0FBaUM7QUFDM0MsVUFBVSxpQ0FBaUM7QUFDM0MsVUFBVSxpQ0FBaUM7QUFDM0MsVUFBVSxpQ0FBaUM7QUFDM0MsVUFBVSxpQ0FBaUM7QUFDM0MsVUFBVSxpQ0FBaUM7QUFDM0MsVUFBVSxtQ0FBbUM7QUFDN0M7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTs7QUFFQSxxR0FBNEI7QUFDNUIsNEdBQW1DO0FBQ25DLHFHQUE0QjtBQUM1Qiw2RkFBb0I7O0FBRXBCLHFHQUE0QjtBQUM1Qiw2RkFBb0IiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9DaXRhdGlvbkV4dHJhY3Rvci8uL2V4dGVuc2lvbi9zaXRlL2JnL2NvcmUvYmdfb3B0aW9ucy5tanM/NWNjYSJdLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuTUlUIExpY2Vuc2VcblxuQ29weXJpZ2h0IChjKSAyMDIwIFJvYmVydCBNIFBhdmV5XG5cblBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHlcbm9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlIFwiU29mdHdhcmVcIiksIHRvIGRlYWxcbmluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHNcbnRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGxcbmNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQgcGVyc29ucyB0byB3aG9tIHRoZSBTb2Z0d2FyZSBpc1xuZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczpcblxuVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW4gYWxsXG5jb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLlxuXG5USEUgU09GVFdBUkUgSVMgUFJPVklERUQgXCJBUyBJU1wiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SXG5JTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSxcbkZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRVxuQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUlxuTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSxcbk9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4gVEhFXG5TT0ZUV0FSRS5cbiovXG5cbmltcG9ydCB7XG4gIHJlZ2lzdGVyU3Vic2VjdGlvbkZvck9wdGlvbnMsXG4gIHJlZ2lzdGVyU3ViaGVhZGluZ0Zvck9wdGlvbnMsXG4gIHJlZ2lzdGVyT3B0aW9uc0dyb3VwLFxuICByZWdpc3RlclNpdGVTZWFyY2hQb3B1cE9wdGlvbnNHcm91cCxcbn0gZnJvbSBcIi4uLy4uLy4uL2Jhc2UvY29yZS9vcHRpb25zL29wdGlvbnNfcmVnaXN0cnkubWpzXCI7XG5cbmNvbnN0IHNlYXJjaE9wdGlvbnNHcm91cCA9IHtcbiAgY2F0ZWdvcnk6IFwic2VhcmNoXCIsXG4gIHN1YmNhdGVnb3J5OiBcImJnXCIsXG4gIHRhYjogXCJzZWFyY2hcIixcbiAgc3Vic2VjdGlvbjogXCJiZ1wiLFxuICBzdWJoZWFkaW5nOiBcInBhcmFtZXRlcnNcIixcbiAgb3B0aW9uczogW1xuICAgIHtcbiAgICAgIG9wdGlvbk5hbWU6IFwiZXhhY3RMYXN0TmFtZVwiLFxuICAgICAgdHlwZTogXCJjaGVja2JveFwiLFxuICAgICAgbGFiZWw6IFwiRXhhY3QgbGFzdCBuYW1lIGluIHNlYXJjaFwiLFxuICAgICAgZGVmYXVsdFZhbHVlOiBmYWxzZSxcbiAgICB9LFxuICAgIHtcbiAgICAgIG9wdGlvbk5hbWU6IFwiaW5jbHVkZUZpcnN0TmFtZVwiLFxuICAgICAgdHlwZTogXCJjaGVja2JveFwiLFxuICAgICAgbGFiZWw6IFwiSW5jbHVkZSBmaXJzdCBuYW1lIGluIHNlYXJjaFwiLFxuICAgICAgZGVmYXVsdFZhbHVlOiB0cnVlLFxuICAgIH0sXG4gICAge1xuICAgICAgb3B0aW9uTmFtZTogXCJleGFjdEZpcnN0TmFtZXNcIixcbiAgICAgIHR5cGU6IFwiY2hlY2tib3hcIixcbiAgICAgIGxhYmVsOiBcIkV4YWN0IGZpcnN0IG5hbWVzIGluIHNlYXJjaFwiLFxuICAgICAgZGVmYXVsdFZhbHVlOiBmYWxzZSxcbiAgICB9LFxuICAgIHtcbiAgICAgIG9wdGlvbk5hbWU6IFwiaW5jbHVkZU1pZGRsZU5hbWVcIixcbiAgICAgIHR5cGU6IFwiY2hlY2tib3hcIixcbiAgICAgIGxhYmVsOiBcIkluY2x1ZGUgbWlkZGxlIG5hbWUgaW4gc2VhcmNoXCIsXG4gICAgICBkZWZhdWx0VmFsdWU6IHRydWUsXG4gICAgfSwgICAgXG4gICAge1xuICAgICAgb3B0aW9uTmFtZTogXCJpbmNsdWRlTWFpZGVuTmFtZVwiLFxuICAgICAgdHlwZTogXCJjaGVja2JveFwiLFxuICAgICAgbGFiZWw6IFwiSW5jbHVkZSBtYWlkZW4gbmFtZSBpbiBzZWFyY2hcIixcbiAgICAgIGRlZmF1bHRWYWx1ZTogdHJ1ZSxcbiAgICB9LFxuICAgIHtcbiAgICAgIG9wdGlvbk5hbWU6IFwiZXhhY3RNYWlkZW5OYW1lXCIsXG4gICAgICB0eXBlOiBcImNoZWNrYm94XCIsXG4gICAgICBsYWJlbDogXCJFeGFjdCBtYWlkZW4gbmFtZSBpbiBzZWFyY2hcIixcbiAgICAgIGRlZmF1bHRWYWx1ZTogZmFsc2UsXG4gICAgfSxcbiAgICB7XG4gICAgICBvcHRpb25OYW1lOiBcImJpcnRoWWVhckV4YWN0bmVzc1wiLFxuICAgICAgdHlwZTogXCJzZWxlY3RcIixcbiAgICAgIGxhYmVsOiBcIlNlYXJjaCBleGFjdG5lc3MgdG8gdXNlIGZvciBiaXJ0aCB5ZWFyXCIsXG4gICAgICB2YWx1ZXM6IFtcbiAgICAgICAgeyB2YWx1ZTogXCJub25lXCIsIHRleHQ6IFwiRG8gbm90IHNwZWNpZnkgYSBiaXJ0aCB5ZWFyXCIgfSxcbiAgICAgICAgLy97IHZhbHVlOiBcImF1dG9cIiwgdGV4dDogXCJTZXQgYXV0b21hdGljYWxseSBiYXNlZCBvbiBzb3VyY2VcIiB9LFxuICAgICAgICB7IHZhbHVlOiBcIjBcIiwgdGV4dDogXCIrLy0gMCB5ZWFyc1wiIH0sXG4gICAgICAgIHsgdmFsdWU6IFwiMVwiLCB0ZXh0OiBcIisvLSAxIHllYXJzXCIgfSwgICAgICAgIFxuICAgICAgICB7IHZhbHVlOiBcIjJcIiwgdGV4dDogXCIrLy0gMiB5ZWFyc1wiIH0sXG4gICAgICAgIHsgdmFsdWU6IFwiM1wiLCB0ZXh0OiBcIisvLSAzIHllYXJzXCIgfSxcbiAgICAgICAgeyB2YWx1ZTogXCI0XCIsIHRleHQ6IFwiKy8tIDQgeWVhcnNcIiB9LFxuICAgICAgICB7IHZhbHVlOiBcIjVcIiwgdGV4dDogXCIrLy0gNSB5ZWFyc1wiIH0sXG4gICAgICAgIHsgdmFsdWU6IFwiNlwiLCB0ZXh0OiBcIisvLSA2IHllYXJzXCIgfSxcbiAgICAgICAgeyB2YWx1ZTogXCI3XCIsIHRleHQ6IFwiKy8tIDcgeWVhcnNcIiB9LFxuICAgICAgICB7IHZhbHVlOiBcIjhcIiwgdGV4dDogXCIrLy0gOCB5ZWFyc1wiIH0sXG4gICAgICAgIHsgdmFsdWU6IFwiOVwiLCB0ZXh0OiBcIisvLSA5IHllYXJzXCIgfSxcbiAgICAgICAgeyB2YWx1ZTogXCIxMFwiLCB0ZXh0OiBcIisvLSAxMCB5ZWFyc1wiIH0sXG4gICAgICBdLFxuICAgICAgZGVmYXVsdFZhbHVlOiBcIjVcIixcbiAgICB9LFxuICAgIHtcbiAgICAgIG9wdGlvbk5hbWU6IFwiZGVhdGhZZWFyRXhhY3RuZXNzXCIsXG4gICAgICB0eXBlOiBcInNlbGVjdFwiLFxuICAgICAgbGFiZWw6IFwiU2VhcmNoIGV4YWN0bmVzcyB0byB1c2UgZm9yIGRlYXRoIHllYXJcIixcbiAgICAgIHZhbHVlczogW1xuICAgICAgICB7IHZhbHVlOiBcIm5vbmVcIiwgdGV4dDogXCJEbyBub3Qgc3BlY2lmeSBhIGRlYXRoIHllYXJcIiB9LFxuICAgICAgICAvL3sgdmFsdWU6IFwiYXV0b1wiLCB0ZXh0OiBcIlNldCBhdXRvbWF0aWNhbGx5IGJhc2VkIG9uIHNvdXJjZVwiIH0sXG4gICAgICAgIHsgdmFsdWU6IFwiMFwiLCB0ZXh0OiBcIisvLSAwIHllYXJzXCIgfSxcbiAgICAgICAgeyB2YWx1ZTogXCIxXCIsIHRleHQ6IFwiKy8tIDEgeWVhcnNcIiB9LCAgICAgICAgXG4gICAgICAgIHsgdmFsdWU6IFwiMlwiLCB0ZXh0OiBcIisvLSAyIHllYXJzXCIgfSxcbiAgICAgICAgeyB2YWx1ZTogXCIzXCIsIHRleHQ6IFwiKy8tIDMgeWVhcnNcIiB9LFxuICAgICAgICB7IHZhbHVlOiBcIjRcIiwgdGV4dDogXCIrLy0gNCB5ZWFyc1wiIH0sXG4gICAgICAgIHsgdmFsdWU6IFwiNVwiLCB0ZXh0OiBcIisvLSA1IHllYXJzXCIgfSxcbiAgICAgICAgeyB2YWx1ZTogXCI2XCIsIHRleHQ6IFwiKy8tIDYgeWVhcnNcIiB9LFxuICAgICAgICB7IHZhbHVlOiBcIjdcIiwgdGV4dDogXCIrLy0gNyB5ZWFyc1wiIH0sXG4gICAgICAgIHsgdmFsdWU6IFwiOFwiLCB0ZXh0OiBcIisvLSA4IHllYXJzXCIgfSxcbiAgICAgICAgeyB2YWx1ZTogXCI5XCIsIHRleHQ6IFwiKy8tIDkgeWVhcnNcIiB9LFxuICAgICAgICB7IHZhbHVlOiBcIjEwXCIsIHRleHQ6IFwiKy8tIDEwIHllYXJzXCIgfSxcbiAgICAgIF0sXG4gICAgICBkZWZhdWx0VmFsdWU6IFwiNVwiLFxuICAgIH0sXG4gIF0sXG59O1xuXG5jb25zdCBjaXRhdGlvbk9wdGlvbnNHcm91cCA9IHtcbiAgY2F0ZWdvcnk6IFwiY2l0YXRpb25cIixcbiAgc3ViY2F0ZWdvcnk6IFwiYmdcIixcbiAgdGFiOiBcImNpdGF0aW9uXCIsXG4gIHN1YnNlY3Rpb246IFwiYmdcIixcbiAgb3B0aW9uczogW1xuICAgICAgICB7XG4gICAgICBvcHRpb25OYW1lOiBcImluY2x1ZGVUcmFuc2NyaWJlclwiLFxuICAgICAgdHlwZTogXCJjaGVja2JveFwiLFxuICAgICAgbGFiZWw6IFwiSW5jbHVkZSB0aGUgdHJhbnNjcmliZXIgaW4gdGhlIGNpdGF0aW9uXCIsXG4gICAgICBkZWZhdWx0VmFsdWU6IHRydWUsXG4gICAgICB1bml0VGVzdFZhbHVlOiB0cnVlLFxuICAgIH0sXG4gICAge1xuICAgICAgb3B0aW9uTmFtZTogXCJpbmNsdWRlUGhvdG9ncmFwaGVyXCIsXG4gICAgICB0eXBlOiBcImNoZWNrYm94XCIsXG4gICAgICBsYWJlbDogXCJJbmNsdWRlIHRoZSBwaG90b2dyYXBoZXIgaW4gdGhlIGNpdGF0aW9uXCIsXG4gICAgICBkZWZhdWx0VmFsdWU6IHRydWUsXG4gICAgICB1bml0VGVzdFZhbHVlOiB0cnVlLFxuICAgIH0sXG4gICAge1xuICAgICAgb3B0aW9uTmFtZTogXCJpbmNsdWRlUmVsYXRpdmVzXCIsXG4gICAgICB0eXBlOiBcImNoZWNrYm94XCIsXG4gICAgICBsYWJlbDogXCJMaXN0IG90aGVycyBtZW50aW9uZWQgb24gbWVtb3JpYWwgKGlmIGFueSlcIixcbiAgICAgIGRlZmF1bHRWYWx1ZTogZmFsc2UsXG4gICAgICB1bml0VGVzdFZhbHVlOiB0cnVlLFxuICAgIH0sXG4gICAge1xuICAgICAgb3B0aW9uTmFtZTogXCJpbmNsdWRlRXBpdGFwaFwiLFxuICAgICAgdHlwZTogXCJjaGVja2JveFwiLFxuICAgICAgbGFiZWw6IFwiSW5jbHVkZSB0aGUgZXBpdGFwaCAoaWYgYW55KVwiLFxuICAgICAgZGVmYXVsdFZhbHVlOiB0cnVlLFxuICAgIH0sXG4gICAge1xuICAgICAgb3B0aW9uTmFtZTogXCJicmFja2V0c1JvdW5kTmFtZVwiLFxuICAgICAgdHlwZTogXCJzZWxlY3RcIixcbiAgICAgIGxhYmVsOiBcIklmIHRoZSBuYW1lIGhhcyBhIHBhcnQgc3Vycm91bmRlZCBieSBicmFja2V0cyAodXN1YWxseSBtYWlkZW4gbmFtZSlcIixcbiAgICAgIHZhbHVlczogW1xuICAgICAgICB7IFxuICAgICAgICAgIHZhbHVlOiBcIm9taXRcIiwgXG4gICAgICAgICAgdGV4dDogXCJPbWl0IHRoYXQgcGFydCBvZiBuYW1lIGZyb20gY2l0YXRpb25cIixcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIHZhbHVlOiBcImJyYWNrZXRcIixcbiAgICAgICAgICB0ZXh0OiBcIkxlYXZlIHRoYXQgcGFydCBvZiBuYW1lIGluIGJyYWNrZXRzIGluIGNpdGF0aW9uXCIsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICB2YWx1ZTogXCJpbnNlcnRcIixcbiAgICAgICAgICB0ZXh0OiBcIkluc2VydCBiZWZvcmUgbGFzdCBuYW1lLiBlLmcuIE1hcnkgU21pdGggKEJyb3duKSB0byBNYXJ5IChCcm93bikgU21pdGhcIixcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgICBkZWZhdWx0VmFsdWU6IFwiaW5zZXJ0XCIsXG4gICAgfSxcbiAgXSxcbn07XG5cbnJlZ2lzdGVyU3Vic2VjdGlvbkZvck9wdGlvbnMoXCJzZWFyY2hcIiwgXCJiZ1wiLCBcIkJpbGxpb25HcmF2ZXNcIik7XG5yZWdpc3RlclNpdGVTZWFyY2hQb3B1cE9wdGlvbnNHcm91cChcImJnXCIsIDQsIDQpO1xucmVnaXN0ZXJTdWJoZWFkaW5nRm9yT3B0aW9ucyhcInNlYXJjaFwiLCBcImJnXCIsIFwicGFyYW1ldGVyc1wiLCBcIlNlYXJjaCBQYXJhbWV0ZXJzXCIpO1xucmVnaXN0ZXJPcHRpb25zR3JvdXAoc2VhcmNoT3B0aW9uc0dyb3VwKTtcblxucmVnaXN0ZXJTdWJzZWN0aW9uRm9yT3B0aW9ucyhcImNpdGF0aW9uXCIsIFwiYmdcIiwgXCJCaWxsaW9uR3JhdmVzXCIpO1xucmVnaXN0ZXJPcHRpb25zR3JvdXAoY2l0YXRpb25PcHRpb25zR3JvdXApO1xuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./extension/site/bg/core/bg_options.mjs\n");

/***/ }),

/***/ "./extension/site/fg/core/fg_build_citation.mjs":
/*!******************************************************!*\
  !*** ./extension/site/fg/core/fg_build_citation.mjs ***!
  \******************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"buildCitation\": () => (/* binding */ buildCitation)\n/* harmony export */ });\n/* harmony import */ var _base_core_citation_builder_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../base/core/citation_builder.mjs */ \"./extension/base/core/citation_builder.mjs\");\n/*\nMIT License\n\nCopyright (c) 2020 Robert M Pavey\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.\n*/\n\n\n\nfunction buildCoreCitation(data, runDate, builder) {\n  // Example citation:\n  // Burial: Find a Grave.\n  // Citing Oak Grove Cemetery, Hillsdale, Hillsdale County, Michigan, USA\n  // {{FindAGrave|115176143}} (accessed 4 April 2022)\n  // William Henry Pavey (1 Dec 1875–14 Apr 1961)\n\n  let options = builder.getOptions();\n\n  let sourceTitle = \"Find a Grave\";\n\n  builder.databaseHasImages = true;\n\n  if (options.citation_general_addEeItemType) {\n    if (!data.hasImage) {\n      builder.databaseHasImages = false;\n    }\n  } else if (options.citation_fg_includeImageStatus) {\n    if (data.hasImage === true) {\n      sourceTitle += \" (has image)\";\n    } else if (data.hasImage === false) {\n      sourceTitle += \" (no image)\";\n    }\n    builder.putSourceTitleInQuotes = false;\n  }\n  builder.sourceTitle = sourceTitle;\n\n  let recordLink = \"{{FindAGrave|\" + data.memorialId + \"}}\";\n  builder.recordLinkOrTemplate = recordLink;\n\n  // The name string can contain italics\n  let nameString = data.name;\n  if (data.nameHtml && nameString != data.nameHtml && data.nameHtml.includes(\"<i>\")) {\n    // we may have a part in italics\n    if (options.citation_fg_italicsInName != \"plain\") {\n      let html = data.nameHtml;\n      let italicStartIndex = html.indexOf(\"<i>\");\n      let italicEndIndex = html.indexOf(\"</i>\", italicStartIndex);\n      if (italicStartIndex != -1 && italicEndIndex != -1) {\n        let partBefore = html.substring(0, italicStartIndex).trim();\n        let partItalic = html.substring(italicStartIndex + 3, italicEndIndex).trim();\n        let partAfter = html.substring(italicEndIndex + 4).trim();\n\n        if (options.citation_fg_italicsInName == \"omit\") {\n          nameString = partBefore + \" \" + partAfter;\n        } else {\n          nameString = partBefore + \" ''\" + partItalic + \"'' \" + partAfter;\n        }\n      }\n    }\n  }\n\n  let dataString = \"Memorial page for \" + nameString;\n  if (data.deathDate && data.birthDate) {\n    dataString += \" (\" + data.birthDate + \"-\" + data.deathDate + \")\";\n  } else if (data.deathDate) {\n    dataString += \" (d. \" + data.deathDate + \")\";\n  }\n\n  if (data.cemeteryName && data.cemeteryFullAddress) {\n    dataString += \", citing \" + data.cemeteryName + \", \" + data.cemeteryFullAddress;\n\n    if (data.plot && options.citation_fg_includeImageStatus) {\n      dataString += \" (plot: \" + data.plot + \")\";\n    }\n  }\n\n  if (options.citation_fg_includeMaintainer && data.citation) {\n    let indexOfMaintained = data.citation.indexOf(\"Maintained by\");\n    if (indexOfMaintained != -1) {\n      let maintainedString = data.citation.substring(indexOfMaintained);\n      if (maintainedString.endsWith(\".\")) {\n        maintainedString = maintainedString.substring(0, maintainedString.length - 1).trim();\n      }\n      dataString += \"; \" + maintainedString;\n    }\n  }\n\n  dataString += \".\";\n\n  if (data.inscription && options.citation_fg_includeInscription) {\n    if (options.citation_general_addBreaksWithinBody) {\n      dataString += \"<br/>\";\n    } else {\n      dataString += \" \";\n    }\n    if (builder.type != \"source\" && options.citation_general_addNewlinesWithinBody) {\n      dataString += \"\\n\";\n    }\n    let inscription = data.inscription.trim();\n    dataString += \"''\";\n    if (inscription[0] != '\"' && inscription[0] != \"'\") {\n      dataString += '\"';\n    }\n    dataString += inscription;\n    let inscriptionEnd = inscription[inscription.length - 1];\n    if (inscriptionEnd != '\"' && inscriptionEnd != \"'\") {\n      dataString += '\"';\n    }\n    dataString += \"''\";\n  }\n\n  builder.dataString = dataString;\n}\n\nfunction buildCitation(input) {\n  const data = input.extractedData;\n  const gd = input.generalizedData;\n  const runDate = input.runDate;\n  const options = input.options;\n  const type = input.type; // \"inline\", \"narrative\" or \"source\"\n\n  let builder = new _base_core_citation_builder_mjs__WEBPACK_IMPORTED_MODULE_0__.CitationBuilder(type, runDate, options);\n\n  var citation = buildCoreCitation(data, runDate, builder);\n\n  // Assume for now that all memorial pages are for a burial\n  builder.meaningfulTitle = \"Memorial\";\n\n  if (type == \"narrative\") {\n    builder.addNarrative(gd, input.dataCache, options);\n  }\n\n  // now the builder is setup use it to build the citation text\n  let fullCitation = builder.getCitationString();\n\n  //console.log(fullCitation);\n\n  var citationObject = {\n    citation: fullCitation,\n    type: type,\n  };\n\n  return citationObject;\n}\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9leHRlbnNpb24vc2l0ZS9mZy9jb3JlL2ZnX2J1aWxkX2NpdGF0aW9uLm1qcy5qcyIsIm1hcHBpbmdzIjoiOzs7OztBQUFBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFMEU7O0FBRTFFO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTyx1QkFBdUI7QUFDOUI7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBLHNCQUFzQixvQ0FBb0M7QUFDMUQ7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxVQUFVO0FBQ1Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCO0FBQ3ZCO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCOztBQUUzQixvQkFBb0IsNEVBQWU7O0FBRW5DOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFeUIiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9DaXRhdGlvbkV4dHJhY3Rvci8uL2V4dGVuc2lvbi9zaXRlL2ZnL2NvcmUvZmdfYnVpbGRfY2l0YXRpb24ubWpzPzU4YzMiXSwic291cmNlc0NvbnRlbnQiOlsiLypcbk1JVCBMaWNlbnNlXG5cbkNvcHlyaWdodCAoYykgMjAyMCBSb2JlcnQgTSBQYXZleVxuXG5QZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYSBjb3B5XG5vZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSBcIlNvZnR3YXJlXCIpLCB0byBkZWFsXG5pbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzXG50byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsXG5jb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXNcbmZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6XG5cblRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkIGluIGFsbFxuY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS5cblxuVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEIFwiQVMgSVNcIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUlxuSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksXG5GSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEVcbkFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVJcbkxJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sXG5PVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOIFRIRVxuU09GVFdBUkUuXG4qL1xuXG5pbXBvcnQgeyBDaXRhdGlvbkJ1aWxkZXIgfSBmcm9tIFwiLi4vLi4vLi4vYmFzZS9jb3JlL2NpdGF0aW9uX2J1aWxkZXIubWpzXCI7XG5cbmZ1bmN0aW9uIGJ1aWxkQ29yZUNpdGF0aW9uKGRhdGEsIHJ1bkRhdGUsIGJ1aWxkZXIpIHtcbiAgLy8gRXhhbXBsZSBjaXRhdGlvbjpcbiAgLy8gQnVyaWFsOiBGaW5kIGEgR3JhdmUuXG4gIC8vIENpdGluZyBPYWsgR3JvdmUgQ2VtZXRlcnksIEhpbGxzZGFsZSwgSGlsbHNkYWxlIENvdW50eSwgTWljaGlnYW4sIFVTQVxuICAvLyB7e0ZpbmRBR3JhdmV8MTE1MTc2MTQzfX0gKGFjY2Vzc2VkIDQgQXByaWwgMjAyMilcbiAgLy8gV2lsbGlhbSBIZW5yeSBQYXZleSAoMSBEZWMgMTg3NeKAkzE0IEFwciAxOTYxKVxuXG4gIGxldCBvcHRpb25zID0gYnVpbGRlci5nZXRPcHRpb25zKCk7XG5cbiAgbGV0IHNvdXJjZVRpdGxlID0gXCJGaW5kIGEgR3JhdmVcIjtcblxuICBidWlsZGVyLmRhdGFiYXNlSGFzSW1hZ2VzID0gdHJ1ZTtcblxuICBpZiAob3B0aW9ucy5jaXRhdGlvbl9nZW5lcmFsX2FkZEVlSXRlbVR5cGUpIHtcbiAgICBpZiAoIWRhdGEuaGFzSW1hZ2UpIHtcbiAgICAgIGJ1aWxkZXIuZGF0YWJhc2VIYXNJbWFnZXMgPSBmYWxzZTtcbiAgICB9XG4gIH0gZWxzZSBpZiAob3B0aW9ucy5jaXRhdGlvbl9mZ19pbmNsdWRlSW1hZ2VTdGF0dXMpIHtcbiAgICBpZiAoZGF0YS5oYXNJbWFnZSA9PT0gdHJ1ZSkge1xuICAgICAgc291cmNlVGl0bGUgKz0gXCIgKGhhcyBpbWFnZSlcIjtcbiAgICB9IGVsc2UgaWYgKGRhdGEuaGFzSW1hZ2UgPT09IGZhbHNlKSB7XG4gICAgICBzb3VyY2VUaXRsZSArPSBcIiAobm8gaW1hZ2UpXCI7XG4gICAgfVxuICAgIGJ1aWxkZXIucHV0U291cmNlVGl0bGVJblF1b3RlcyA9IGZhbHNlO1xuICB9XG4gIGJ1aWxkZXIuc291cmNlVGl0bGUgPSBzb3VyY2VUaXRsZTtcblxuICBsZXQgcmVjb3JkTGluayA9IFwie3tGaW5kQUdyYXZlfFwiICsgZGF0YS5tZW1vcmlhbElkICsgXCJ9fVwiO1xuICBidWlsZGVyLnJlY29yZExpbmtPclRlbXBsYXRlID0gcmVjb3JkTGluaztcblxuICAvLyBUaGUgbmFtZSBzdHJpbmcgY2FuIGNvbnRhaW4gaXRhbGljc1xuICBsZXQgbmFtZVN0cmluZyA9IGRhdGEubmFtZTtcbiAgaWYgKGRhdGEubmFtZUh0bWwgJiYgbmFtZVN0cmluZyAhPSBkYXRhLm5hbWVIdG1sICYmIGRhdGEubmFtZUh0bWwuaW5jbHVkZXMoXCI8aT5cIikpIHtcbiAgICAvLyB3ZSBtYXkgaGF2ZSBhIHBhcnQgaW4gaXRhbGljc1xuICAgIGlmIChvcHRpb25zLmNpdGF0aW9uX2ZnX2l0YWxpY3NJbk5hbWUgIT0gXCJwbGFpblwiKSB7XG4gICAgICBsZXQgaHRtbCA9IGRhdGEubmFtZUh0bWw7XG4gICAgICBsZXQgaXRhbGljU3RhcnRJbmRleCA9IGh0bWwuaW5kZXhPZihcIjxpPlwiKTtcbiAgICAgIGxldCBpdGFsaWNFbmRJbmRleCA9IGh0bWwuaW5kZXhPZihcIjwvaT5cIiwgaXRhbGljU3RhcnRJbmRleCk7XG4gICAgICBpZiAoaXRhbGljU3RhcnRJbmRleCAhPSAtMSAmJiBpdGFsaWNFbmRJbmRleCAhPSAtMSkge1xuICAgICAgICBsZXQgcGFydEJlZm9yZSA9IGh0bWwuc3Vic3RyaW5nKDAsIGl0YWxpY1N0YXJ0SW5kZXgpLnRyaW0oKTtcbiAgICAgICAgbGV0IHBhcnRJdGFsaWMgPSBodG1sLnN1YnN0cmluZyhpdGFsaWNTdGFydEluZGV4ICsgMywgaXRhbGljRW5kSW5kZXgpLnRyaW0oKTtcbiAgICAgICAgbGV0IHBhcnRBZnRlciA9IGh0bWwuc3Vic3RyaW5nKGl0YWxpY0VuZEluZGV4ICsgNCkudHJpbSgpO1xuXG4gICAgICAgIGlmIChvcHRpb25zLmNpdGF0aW9uX2ZnX2l0YWxpY3NJbk5hbWUgPT0gXCJvbWl0XCIpIHtcbiAgICAgICAgICBuYW1lU3RyaW5nID0gcGFydEJlZm9yZSArIFwiIFwiICsgcGFydEFmdGVyO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIG5hbWVTdHJpbmcgPSBwYXJ0QmVmb3JlICsgXCIgJydcIiArIHBhcnRJdGFsaWMgKyBcIicnIFwiICsgcGFydEFmdGVyO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgbGV0IGRhdGFTdHJpbmcgPSBcIk1lbW9yaWFsIHBhZ2UgZm9yIFwiICsgbmFtZVN0cmluZztcbiAgaWYgKGRhdGEuZGVhdGhEYXRlICYmIGRhdGEuYmlydGhEYXRlKSB7XG4gICAgZGF0YVN0cmluZyArPSBcIiAoXCIgKyBkYXRhLmJpcnRoRGF0ZSArIFwiLVwiICsgZGF0YS5kZWF0aERhdGUgKyBcIilcIjtcbiAgfSBlbHNlIGlmIChkYXRhLmRlYXRoRGF0ZSkge1xuICAgIGRhdGFTdHJpbmcgKz0gXCIgKGQuIFwiICsgZGF0YS5kZWF0aERhdGUgKyBcIilcIjtcbiAgfVxuXG4gIGlmIChkYXRhLmNlbWV0ZXJ5TmFtZSAmJiBkYXRhLmNlbWV0ZXJ5RnVsbEFkZHJlc3MpIHtcbiAgICBkYXRhU3RyaW5nICs9IFwiLCBjaXRpbmcgXCIgKyBkYXRhLmNlbWV0ZXJ5TmFtZSArIFwiLCBcIiArIGRhdGEuY2VtZXRlcnlGdWxsQWRkcmVzcztcblxuICAgIGlmIChkYXRhLnBsb3QgJiYgb3B0aW9ucy5jaXRhdGlvbl9mZ19pbmNsdWRlSW1hZ2VTdGF0dXMpIHtcbiAgICAgIGRhdGFTdHJpbmcgKz0gXCIgKHBsb3Q6IFwiICsgZGF0YS5wbG90ICsgXCIpXCI7XG4gICAgfVxuICB9XG5cbiAgaWYgKG9wdGlvbnMuY2l0YXRpb25fZmdfaW5jbHVkZU1haW50YWluZXIgJiYgZGF0YS5jaXRhdGlvbikge1xuICAgIGxldCBpbmRleE9mTWFpbnRhaW5lZCA9IGRhdGEuY2l0YXRpb24uaW5kZXhPZihcIk1haW50YWluZWQgYnlcIik7XG4gICAgaWYgKGluZGV4T2ZNYWludGFpbmVkICE9IC0xKSB7XG4gICAgICBsZXQgbWFpbnRhaW5lZFN0cmluZyA9IGRhdGEuY2l0YXRpb24uc3Vic3RyaW5nKGluZGV4T2ZNYWludGFpbmVkKTtcbiAgICAgIGlmIChtYWludGFpbmVkU3RyaW5nLmVuZHNXaXRoKFwiLlwiKSkge1xuICAgICAgICBtYWludGFpbmVkU3RyaW5nID0gbWFpbnRhaW5lZFN0cmluZy5zdWJzdHJpbmcoMCwgbWFpbnRhaW5lZFN0cmluZy5sZW5ndGggLSAxKS50cmltKCk7XG4gICAgICB9XG4gICAgICBkYXRhU3RyaW5nICs9IFwiOyBcIiArIG1haW50YWluZWRTdHJpbmc7XG4gICAgfVxuICB9XG5cbiAgZGF0YVN0cmluZyArPSBcIi5cIjtcblxuICBpZiAoZGF0YS5pbnNjcmlwdGlvbiAmJiBvcHRpb25zLmNpdGF0aW9uX2ZnX2luY2x1ZGVJbnNjcmlwdGlvbikge1xuICAgIGlmIChvcHRpb25zLmNpdGF0aW9uX2dlbmVyYWxfYWRkQnJlYWtzV2l0aGluQm9keSkge1xuICAgICAgZGF0YVN0cmluZyArPSBcIjxici8+XCI7XG4gICAgfSBlbHNlIHtcbiAgICAgIGRhdGFTdHJpbmcgKz0gXCIgXCI7XG4gICAgfVxuICAgIGlmIChidWlsZGVyLnR5cGUgIT0gXCJzb3VyY2VcIiAmJiBvcHRpb25zLmNpdGF0aW9uX2dlbmVyYWxfYWRkTmV3bGluZXNXaXRoaW5Cb2R5KSB7XG4gICAgICBkYXRhU3RyaW5nICs9IFwiXFxuXCI7XG4gICAgfVxuICAgIGxldCBpbnNjcmlwdGlvbiA9IGRhdGEuaW5zY3JpcHRpb24udHJpbSgpO1xuICAgIGRhdGFTdHJpbmcgKz0gXCInJ1wiO1xuICAgIGlmIChpbnNjcmlwdGlvblswXSAhPSAnXCInICYmIGluc2NyaXB0aW9uWzBdICE9IFwiJ1wiKSB7XG4gICAgICBkYXRhU3RyaW5nICs9ICdcIic7XG4gICAgfVxuICAgIGRhdGFTdHJpbmcgKz0gaW5zY3JpcHRpb247XG4gICAgbGV0IGluc2NyaXB0aW9uRW5kID0gaW5zY3JpcHRpb25baW5zY3JpcHRpb24ubGVuZ3RoIC0gMV07XG4gICAgaWYgKGluc2NyaXB0aW9uRW5kICE9ICdcIicgJiYgaW5zY3JpcHRpb25FbmQgIT0gXCInXCIpIHtcbiAgICAgIGRhdGFTdHJpbmcgKz0gJ1wiJztcbiAgICB9XG4gICAgZGF0YVN0cmluZyArPSBcIicnXCI7XG4gIH1cblxuICBidWlsZGVyLmRhdGFTdHJpbmcgPSBkYXRhU3RyaW5nO1xufVxuXG5mdW5jdGlvbiBidWlsZENpdGF0aW9uKGlucHV0KSB7XG4gIGNvbnN0IGRhdGEgPSBpbnB1dC5leHRyYWN0ZWREYXRhO1xuICBjb25zdCBnZCA9IGlucHV0LmdlbmVyYWxpemVkRGF0YTtcbiAgY29uc3QgcnVuRGF0ZSA9IGlucHV0LnJ1bkRhdGU7XG4gIGNvbnN0IG9wdGlvbnMgPSBpbnB1dC5vcHRpb25zO1xuICBjb25zdCB0eXBlID0gaW5wdXQudHlwZTsgLy8gXCJpbmxpbmVcIiwgXCJuYXJyYXRpdmVcIiBvciBcInNvdXJjZVwiXG5cbiAgbGV0IGJ1aWxkZXIgPSBuZXcgQ2l0YXRpb25CdWlsZGVyKHR5cGUsIHJ1bkRhdGUsIG9wdGlvbnMpO1xuXG4gIHZhciBjaXRhdGlvbiA9IGJ1aWxkQ29yZUNpdGF0aW9uKGRhdGEsIHJ1bkRhdGUsIGJ1aWxkZXIpO1xuXG4gIC8vIEFzc3VtZSBmb3Igbm93IHRoYXQgYWxsIG1lbW9yaWFsIHBhZ2VzIGFyZSBmb3IgYSBidXJpYWxcbiAgYnVpbGRlci5tZWFuaW5nZnVsVGl0bGUgPSBcIk1lbW9yaWFsXCI7XG5cbiAgaWYgKHR5cGUgPT0gXCJuYXJyYXRpdmVcIikge1xuICAgIGJ1aWxkZXIuYWRkTmFycmF0aXZlKGdkLCBpbnB1dC5kYXRhQ2FjaGUsIG9wdGlvbnMpO1xuICB9XG5cbiAgLy8gbm93IHRoZSBidWlsZGVyIGlzIHNldHVwIHVzZSBpdCB0byBidWlsZCB0aGUgY2l0YXRpb24gdGV4dFxuICBsZXQgZnVsbENpdGF0aW9uID0gYnVpbGRlci5nZXRDaXRhdGlvblN0cmluZygpO1xuXG4gIC8vY29uc29sZS5sb2coZnVsbENpdGF0aW9uKTtcblxuICB2YXIgY2l0YXRpb25PYmplY3QgPSB7XG4gICAgY2l0YXRpb246IGZ1bGxDaXRhdGlvbixcbiAgICB0eXBlOiB0eXBlLFxuICB9O1xuXG4gIHJldHVybiBjaXRhdGlvbk9iamVjdDtcbn1cblxuZXhwb3J0IHsgYnVpbGRDaXRhdGlvbiB9O1xuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./extension/site/fg/core/fg_build_citation.mjs\n");

/***/ }),

/***/ "./extension/site/fg/core/fg_extract_data.mjs":
/*!****************************************************!*\
  !*** ./extension/site/fg/core/fg_extract_data.mjs ***!
  \****************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"extractData\": () => (/* binding */ extractData)\n/* harmony export */ });\n/*\nMIT License\n\nCopyright (c) 2020 Robert M Pavey\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.\n*/\n\nfunction cleanText(inputText) {\n  let text = inputText;\n  if (text) {\n    text = text.trim();\n    text = text.replace(/\\s+/g, \" \");\n    text = text.replace(/\\s([,;.])/g, \"$1\");\n    text = text.replace(/\\u{2013}/gu, \"-\"); // En dash\n  }\n  return text;\n}\n\nfunction setFromLabelWithId(result, parentNode, labelId, fieldName) {\n  const label = parentNode.querySelector(labelId);\n  if (label) {\n    result[fieldName] = cleanText(label.textContent);\n  }\n}\n\nfunction extractInscription(result, document) {\n  const paragraph = document.querySelector(\"#inscriptionValue\");\n  if (paragraph) {\n    let text = paragraph.innerHTML;\n    if (text) {\n      text = text.trim();\n      text = text.replace(/&lt;/g, \"<\");\n      text = text.replace(/&gt;/g, \">\");\n      text = text.replace(/&quot;/g, '\"');\n      text = text.replace(/&#39;/g, \"'\");\n      text = text.replace(/&amp;/g, \"&\");\n      text = text.replace(/\\s+/g, \" \");\n      text = text.replace(/\\s([,;.])/g, \"$1\");\n      text = text.trim();\n      if (text) {\n        result.inscription = text;\n      }\n    }\n  }\n}\n\nfunction extractData(document, url) {\n  var result = {};\n  result.url = url;\n\n  result.success = false;\n\n  setFromLabelWithId(result, document, \"#bio-name\", \"name\");\n\n  // also save the innerHTML for the name because the maiden name can be in italics\n  const nameNode = document.querySelector(\"#bio-name\");\n  if (nameNode) {\n    result.nameHtml = cleanText(nameNode.innerHTML);\n  }\n\n  let memEvents = document.querySelector(\"div.section-bio-cover dl.mem-events\");\n  //console.log(\"memEvents is: \");\n  //console.log(memEvents);\n  if (!memEvents) {\n    // old page format\n    memEvents = document.querySelector(\"div.section-bio-cover table.mem-events\");\n  }\n\n  if (!memEvents) {\n    console.log(\"fg extractData, no memEvents found\");\n    return result;\n  }\n\n  setFromLabelWithId(result, memEvents, \"#birthDateLabel\", \"birthDate\");\n  setFromLabelWithId(result, memEvents, \"#birthLocationLabel\", \"birthPlace\");\n\n  // the death date string actually includes the age also\n  const deathDatelabel = memEvents.querySelector(\"#deathDateLabel\");\n  if (deathDatelabel) {\n    let text = deathDatelabel.textContent;\n    let deathDate = text;\n    let openParenIndex = text.indexOf(\"(\");\n    if (openParenIndex != -1) {\n      deathDate = cleanText(text.substring(0, openParenIndex));\n\n      let closeParenIndex = text.indexOf(\")\", openParenIndex + 1);\n      if (closeParenIndex != -1) {\n        let parenContents = text.substring(openParenIndex + 1, closeParenIndex).trim();\n        const prefix = \"aged\";\n        if (parenContents.startsWith(prefix)) {\n          parenContents = parenContents.substring(prefix.length).trim();\n        }\n        result.ageAtDeath = cleanText(parenContents);\n      }\n    }\n    result.deathDate = cleanText(deathDate);\n  }\n\n  setFromLabelWithId(result, memEvents, \"#deathLocationLabel\", \"deathPlace\");\n\n  setFromLabelWithId(result, memEvents, \"#cemeteryNameLabel\", \"cemeteryName\");\n\n  setFromLabelWithId(result, memEvents, \"#cemeteryCityName\", \"cemeteryCity\");\n  setFromLabelWithId(result, memEvents, \"#cemeteryCountyName\", \"cemeteryCounty\");\n  setFromLabelWithId(result, memEvents, \"#cemeteryStateName\", \"cemeteryState\");\n  setFromLabelWithId(result, memEvents, \"#cemeteryCountryName\", \"cemeteryCountry\");\n\n  // also get the whole address string\n  const placeSpan = memEvents.querySelector(\"span.place[itemprop=address\");\n  if (placeSpan) {\n    result.cemeteryFullAddress = cleanText(placeSpan.textContent);\n  }\n\n  setFromLabelWithId(result, memEvents, \"#plotValueLabel\", \"plot\");\n  setFromLabelWithId(result, memEvents, \"#memNumberLabel\", \"memorialId\");\n\n  extractInscription(result, document);\n\n  // get the source citation string - it includes markup - should we just ignore that and get textContent?\n  setFromLabelWithId(result, document, \"#citationInfo\", \"citation\");\n\n  // check to see if there is an image\n  const mainPhoto = document.querySelector(\"#main-photo\");\n  if (mainPhoto) {\n    result.hasImage = true;\n  } else {\n    result.hasImage = false;\n  }\n\n  result.success = true;\n\n  //console.log(result);\n\n  return result;\n}\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9leHRlbnNpb24vc2l0ZS9mZy9jb3JlL2ZnX2V4dHJhY3RfZGF0YS5tanMuanMiLCJtYXBwaW5ncyI6Ijs7OztBQUFBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsK0JBQStCO0FBQy9CLDRCQUE0QixLQUFLLFdBQVc7QUFDNUM7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQkFBK0I7QUFDL0IsK0JBQStCO0FBQy9CLGlDQUFpQztBQUNqQyxnQ0FBZ0M7QUFDaEMsZ0NBQWdDO0FBQ2hDO0FBQ0EsaUNBQWlDO0FBQ2pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBOztBQUV1QiIsInNvdXJjZXMiOlsid2VicGFjazovL0NpdGF0aW9uRXh0cmFjdG9yLy4vZXh0ZW5zaW9uL3NpdGUvZmcvY29yZS9mZ19leHRyYWN0X2RhdGEubWpzPzAzNzQiXSwic291cmNlc0NvbnRlbnQiOlsiLypcbk1JVCBMaWNlbnNlXG5cbkNvcHlyaWdodCAoYykgMjAyMCBSb2JlcnQgTSBQYXZleVxuXG5QZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYSBjb3B5XG5vZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSBcIlNvZnR3YXJlXCIpLCB0byBkZWFsXG5pbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzXG50byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsXG5jb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXNcbmZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6XG5cblRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkIGluIGFsbFxuY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS5cblxuVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEIFwiQVMgSVNcIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUlxuSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksXG5GSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEVcbkFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVJcbkxJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sXG5PVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOIFRIRVxuU09GVFdBUkUuXG4qL1xuXG5mdW5jdGlvbiBjbGVhblRleHQoaW5wdXRUZXh0KSB7XG4gIGxldCB0ZXh0ID0gaW5wdXRUZXh0O1xuICBpZiAodGV4dCkge1xuICAgIHRleHQgPSB0ZXh0LnRyaW0oKTtcbiAgICB0ZXh0ID0gdGV4dC5yZXBsYWNlKC9cXHMrL2csIFwiIFwiKTtcbiAgICB0ZXh0ID0gdGV4dC5yZXBsYWNlKC9cXHMoWyw7Ll0pL2csIFwiJDFcIik7XG4gICAgdGV4dCA9IHRleHQucmVwbGFjZSgvXFx1ezIwMTN9L2d1LCBcIi1cIik7IC8vIEVuIGRhc2hcbiAgfVxuICByZXR1cm4gdGV4dDtcbn1cblxuZnVuY3Rpb24gc2V0RnJvbUxhYmVsV2l0aElkKHJlc3VsdCwgcGFyZW50Tm9kZSwgbGFiZWxJZCwgZmllbGROYW1lKSB7XG4gIGNvbnN0IGxhYmVsID0gcGFyZW50Tm9kZS5xdWVyeVNlbGVjdG9yKGxhYmVsSWQpO1xuICBpZiAobGFiZWwpIHtcbiAgICByZXN1bHRbZmllbGROYW1lXSA9IGNsZWFuVGV4dChsYWJlbC50ZXh0Q29udGVudCk7XG4gIH1cbn1cblxuZnVuY3Rpb24gZXh0cmFjdEluc2NyaXB0aW9uKHJlc3VsdCwgZG9jdW1lbnQpIHtcbiAgY29uc3QgcGFyYWdyYXBoID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNpbnNjcmlwdGlvblZhbHVlXCIpO1xuICBpZiAocGFyYWdyYXBoKSB7XG4gICAgbGV0IHRleHQgPSBwYXJhZ3JhcGguaW5uZXJIVE1MO1xuICAgIGlmICh0ZXh0KSB7XG4gICAgICB0ZXh0ID0gdGV4dC50cmltKCk7XG4gICAgICB0ZXh0ID0gdGV4dC5yZXBsYWNlKC8mbHQ7L2csIFwiPFwiKTtcbiAgICAgIHRleHQgPSB0ZXh0LnJlcGxhY2UoLyZndDsvZywgXCI+XCIpO1xuICAgICAgdGV4dCA9IHRleHQucmVwbGFjZSgvJnF1b3Q7L2csICdcIicpO1xuICAgICAgdGV4dCA9IHRleHQucmVwbGFjZSgvJiMzOTsvZywgXCInXCIpO1xuICAgICAgdGV4dCA9IHRleHQucmVwbGFjZSgvJmFtcDsvZywgXCImXCIpO1xuICAgICAgdGV4dCA9IHRleHQucmVwbGFjZSgvXFxzKy9nLCBcIiBcIik7XG4gICAgICB0ZXh0ID0gdGV4dC5yZXBsYWNlKC9cXHMoWyw7Ll0pL2csIFwiJDFcIik7XG4gICAgICB0ZXh0ID0gdGV4dC50cmltKCk7XG4gICAgICBpZiAodGV4dCkge1xuICAgICAgICByZXN1bHQuaW5zY3JpcHRpb24gPSB0ZXh0O1xuICAgICAgfVxuICAgIH1cbiAgfVxufVxuXG5mdW5jdGlvbiBleHRyYWN0RGF0YShkb2N1bWVudCwgdXJsKSB7XG4gIHZhciByZXN1bHQgPSB7fTtcbiAgcmVzdWx0LnVybCA9IHVybDtcblxuICByZXN1bHQuc3VjY2VzcyA9IGZhbHNlO1xuXG4gIHNldEZyb21MYWJlbFdpdGhJZChyZXN1bHQsIGRvY3VtZW50LCBcIiNiaW8tbmFtZVwiLCBcIm5hbWVcIik7XG5cbiAgLy8gYWxzbyBzYXZlIHRoZSBpbm5lckhUTUwgZm9yIHRoZSBuYW1lIGJlY2F1c2UgdGhlIG1haWRlbiBuYW1lIGNhbiBiZSBpbiBpdGFsaWNzXG4gIGNvbnN0IG5hbWVOb2RlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNiaW8tbmFtZVwiKTtcbiAgaWYgKG5hbWVOb2RlKSB7XG4gICAgcmVzdWx0Lm5hbWVIdG1sID0gY2xlYW5UZXh0KG5hbWVOb2RlLmlubmVySFRNTCk7XG4gIH1cblxuICBsZXQgbWVtRXZlbnRzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcImRpdi5zZWN0aW9uLWJpby1jb3ZlciBkbC5tZW0tZXZlbnRzXCIpO1xuICAvL2NvbnNvbGUubG9nKFwibWVtRXZlbnRzIGlzOiBcIik7XG4gIC8vY29uc29sZS5sb2cobWVtRXZlbnRzKTtcbiAgaWYgKCFtZW1FdmVudHMpIHtcbiAgICAvLyBvbGQgcGFnZSBmb3JtYXRcbiAgICBtZW1FdmVudHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiZGl2LnNlY3Rpb24tYmlvLWNvdmVyIHRhYmxlLm1lbS1ldmVudHNcIik7XG4gIH1cblxuICBpZiAoIW1lbUV2ZW50cykge1xuICAgIGNvbnNvbGUubG9nKFwiZmcgZXh0cmFjdERhdGEsIG5vIG1lbUV2ZW50cyBmb3VuZFwiKTtcbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgc2V0RnJvbUxhYmVsV2l0aElkKHJlc3VsdCwgbWVtRXZlbnRzLCBcIiNiaXJ0aERhdGVMYWJlbFwiLCBcImJpcnRoRGF0ZVwiKTtcbiAgc2V0RnJvbUxhYmVsV2l0aElkKHJlc3VsdCwgbWVtRXZlbnRzLCBcIiNiaXJ0aExvY2F0aW9uTGFiZWxcIiwgXCJiaXJ0aFBsYWNlXCIpO1xuXG4gIC8vIHRoZSBkZWF0aCBkYXRlIHN0cmluZyBhY3R1YWxseSBpbmNsdWRlcyB0aGUgYWdlIGFsc29cbiAgY29uc3QgZGVhdGhEYXRlbGFiZWwgPSBtZW1FdmVudHMucXVlcnlTZWxlY3RvcihcIiNkZWF0aERhdGVMYWJlbFwiKTtcbiAgaWYgKGRlYXRoRGF0ZWxhYmVsKSB7XG4gICAgbGV0IHRleHQgPSBkZWF0aERhdGVsYWJlbC50ZXh0Q29udGVudDtcbiAgICBsZXQgZGVhdGhEYXRlID0gdGV4dDtcbiAgICBsZXQgb3BlblBhcmVuSW5kZXggPSB0ZXh0LmluZGV4T2YoXCIoXCIpO1xuICAgIGlmIChvcGVuUGFyZW5JbmRleCAhPSAtMSkge1xuICAgICAgZGVhdGhEYXRlID0gY2xlYW5UZXh0KHRleHQuc3Vic3RyaW5nKDAsIG9wZW5QYXJlbkluZGV4KSk7XG5cbiAgICAgIGxldCBjbG9zZVBhcmVuSW5kZXggPSB0ZXh0LmluZGV4T2YoXCIpXCIsIG9wZW5QYXJlbkluZGV4ICsgMSk7XG4gICAgICBpZiAoY2xvc2VQYXJlbkluZGV4ICE9IC0xKSB7XG4gICAgICAgIGxldCBwYXJlbkNvbnRlbnRzID0gdGV4dC5zdWJzdHJpbmcob3BlblBhcmVuSW5kZXggKyAxLCBjbG9zZVBhcmVuSW5kZXgpLnRyaW0oKTtcbiAgICAgICAgY29uc3QgcHJlZml4ID0gXCJhZ2VkXCI7XG4gICAgICAgIGlmIChwYXJlbkNvbnRlbnRzLnN0YXJ0c1dpdGgocHJlZml4KSkge1xuICAgICAgICAgIHBhcmVuQ29udGVudHMgPSBwYXJlbkNvbnRlbnRzLnN1YnN0cmluZyhwcmVmaXgubGVuZ3RoKS50cmltKCk7XG4gICAgICAgIH1cbiAgICAgICAgcmVzdWx0LmFnZUF0RGVhdGggPSBjbGVhblRleHQocGFyZW5Db250ZW50cyk7XG4gICAgICB9XG4gICAgfVxuICAgIHJlc3VsdC5kZWF0aERhdGUgPSBjbGVhblRleHQoZGVhdGhEYXRlKTtcbiAgfVxuXG4gIHNldEZyb21MYWJlbFdpdGhJZChyZXN1bHQsIG1lbUV2ZW50cywgXCIjZGVhdGhMb2NhdGlvbkxhYmVsXCIsIFwiZGVhdGhQbGFjZVwiKTtcblxuICBzZXRGcm9tTGFiZWxXaXRoSWQocmVzdWx0LCBtZW1FdmVudHMsIFwiI2NlbWV0ZXJ5TmFtZUxhYmVsXCIsIFwiY2VtZXRlcnlOYW1lXCIpO1xuXG4gIHNldEZyb21MYWJlbFdpdGhJZChyZXN1bHQsIG1lbUV2ZW50cywgXCIjY2VtZXRlcnlDaXR5TmFtZVwiLCBcImNlbWV0ZXJ5Q2l0eVwiKTtcbiAgc2V0RnJvbUxhYmVsV2l0aElkKHJlc3VsdCwgbWVtRXZlbnRzLCBcIiNjZW1ldGVyeUNvdW50eU5hbWVcIiwgXCJjZW1ldGVyeUNvdW50eVwiKTtcbiAgc2V0RnJvbUxhYmVsV2l0aElkKHJlc3VsdCwgbWVtRXZlbnRzLCBcIiNjZW1ldGVyeVN0YXRlTmFtZVwiLCBcImNlbWV0ZXJ5U3RhdGVcIik7XG4gIHNldEZyb21MYWJlbFdpdGhJZChyZXN1bHQsIG1lbUV2ZW50cywgXCIjY2VtZXRlcnlDb3VudHJ5TmFtZVwiLCBcImNlbWV0ZXJ5Q291bnRyeVwiKTtcblxuICAvLyBhbHNvIGdldCB0aGUgd2hvbGUgYWRkcmVzcyBzdHJpbmdcbiAgY29uc3QgcGxhY2VTcGFuID0gbWVtRXZlbnRzLnF1ZXJ5U2VsZWN0b3IoXCJzcGFuLnBsYWNlW2l0ZW1wcm9wPWFkZHJlc3NcIik7XG4gIGlmIChwbGFjZVNwYW4pIHtcbiAgICByZXN1bHQuY2VtZXRlcnlGdWxsQWRkcmVzcyA9IGNsZWFuVGV4dChwbGFjZVNwYW4udGV4dENvbnRlbnQpO1xuICB9XG5cbiAgc2V0RnJvbUxhYmVsV2l0aElkKHJlc3VsdCwgbWVtRXZlbnRzLCBcIiNwbG90VmFsdWVMYWJlbFwiLCBcInBsb3RcIik7XG4gIHNldEZyb21MYWJlbFdpdGhJZChyZXN1bHQsIG1lbUV2ZW50cywgXCIjbWVtTnVtYmVyTGFiZWxcIiwgXCJtZW1vcmlhbElkXCIpO1xuXG4gIGV4dHJhY3RJbnNjcmlwdGlvbihyZXN1bHQsIGRvY3VtZW50KTtcblxuICAvLyBnZXQgdGhlIHNvdXJjZSBjaXRhdGlvbiBzdHJpbmcgLSBpdCBpbmNsdWRlcyBtYXJrdXAgLSBzaG91bGQgd2UganVzdCBpZ25vcmUgdGhhdCBhbmQgZ2V0IHRleHRDb250ZW50P1xuICBzZXRGcm9tTGFiZWxXaXRoSWQocmVzdWx0LCBkb2N1bWVudCwgXCIjY2l0YXRpb25JbmZvXCIsIFwiY2l0YXRpb25cIik7XG5cbiAgLy8gY2hlY2sgdG8gc2VlIGlmIHRoZXJlIGlzIGFuIGltYWdlXG4gIGNvbnN0IG1haW5QaG90byA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjbWFpbi1waG90b1wiKTtcbiAgaWYgKG1haW5QaG90bykge1xuICAgIHJlc3VsdC5oYXNJbWFnZSA9IHRydWU7XG4gIH0gZWxzZSB7XG4gICAgcmVzdWx0Lmhhc0ltYWdlID0gZmFsc2U7XG4gIH1cblxuICByZXN1bHQuc3VjY2VzcyA9IHRydWU7XG5cbiAgLy9jb25zb2xlLmxvZyhyZXN1bHQpO1xuXG4gIHJldHVybiByZXN1bHQ7XG59XG5cbmV4cG9ydCB7IGV4dHJhY3REYXRhIH07XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./extension/site/fg/core/fg_extract_data.mjs\n");

/***/ }),

/***/ "./extension/site/fg/core/fg_generalize_data.mjs":
/*!*******************************************************!*\
  !*** ./extension/site/fg/core/fg_generalize_data.mjs ***!
  \*******************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"GeneralizedData\": () => (/* reexport safe */ _base_core_generalize_data_utils_mjs__WEBPACK_IMPORTED_MODULE_0__.GeneralizedData),\n/* harmony export */   \"dateQualifiers\": () => (/* reexport safe */ _base_core_generalize_data_utils_mjs__WEBPACK_IMPORTED_MODULE_0__.dateQualifiers),\n/* harmony export */   \"generalizeData\": () => (/* binding */ generalizeData)\n/* harmony export */ });\n/* harmony import */ var _base_core_generalize_data_utils_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../base/core/generalize_data_utils.mjs */ \"./extension/base/core/generalize_data_utils.mjs\");\n/* harmony import */ var _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../base/core/record_type.mjs */ \"./extension/base/core/record_type.mjs\");\n/*\nMIT License\n\nCopyright (c) 2020 Robert M Pavey\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.\n*/\n\n\n\n\nfunction setNames(data, result) {\n  let fgName = data.name;\n  let fullName = fgName;\n  let maidenName = \"\";\n  let cln = \"\";\n\n  // The name string can contain italics\n  if (data.nameHtml && fgName != data.nameHtml && data.nameHtml.includes(\"<i>\")) {\n    // we may have a part in italics\n    let html = data.nameHtml;\n    let italicStartIndex = html.indexOf(\"<i>\");\n    let italicEndIndex = html.indexOf(\"</i>\", italicStartIndex);\n    if (italicStartIndex != -1 && italicEndIndex != -1) {\n      let partBefore = html.substring(0, italicStartIndex).trim();\n      let partItalic = html.substring(italicStartIndex + 3, italicEndIndex).trim();\n      let partAfter = html.substring(italicEndIndex + 4).trim();\n\n      // check there are no more italics\n      let secondItalicStartIndex = html.indexOf(\"<i>\", italicEndIndex);\n      if (secondItalicStartIndex == -1) {\n        fullName = partBefore + \" \" + partAfter;\n        maidenName = partItalic;\n        cln = partAfter;\n      }\n    }\n  }\n\n  result.setFullName(fullName);\n\n  if (!maidenName) {\n    result.lastNameAtDeath = result.inferLastName();\n  } else {\n    result.lastNameAtBirth = maidenName;\n    if (cln) {\n      result.lastNameAtDeath = cln;\n    }\n  }\n}\n\nfunction generalizeData(input) {\n  let data = input.extractedData;\n\n  let result = new _base_core_generalize_data_utils_mjs__WEBPACK_IMPORTED_MODULE_0__.GeneralizedData();\n\n  result.sourceOfData = \"fg\";\n\n  if (!data.success) {\n    return result; //the extract failed\n  }\n\n  result.sourceType = \"record\";\n\n  // If no burial location perhaps it should be a death?\n  result.recordType = _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_1__.RT.Memorial;\n\n  result.setEventDate(data.deathDate);\n  result.setEventPlace(data.cemeteryFullAddress);\n\n  if (result.eventPlace) {\n    result.eventPlace.streetAddress = data.cemeteryName;\n  }\n\n  setNames(data, result);\n\n  result.setDeathDate(data.deathDate);\n  result.setDeathPlace(data.deathPlace);\n\n  if (data.ageAtDeath) {\n    result.ageAtDeath = data.ageAtDeath;\n  }\n\n  result.setBirthDate(data.birthDate);\n  result.setBirthPlace(data.birthPlace);\n\n  // should we use a collection to allow search for same record on Ancestry?\n\n  result.hasValidData = true;\n\n  return result;\n}\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9leHRlbnNpb24vc2l0ZS9mZy9jb3JlL2ZnX2dlbmVyYWxpemVfZGF0YS5tanMuanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRStGO0FBQ3ZDOztBQUV4RDtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBLG1CQUFtQixpRkFBZTs7QUFFbEM7O0FBRUE7QUFDQSxtQkFBbUI7QUFDbkI7O0FBRUE7O0FBRUE7QUFDQSxzQkFBc0IsbUVBQVc7O0FBRWpDO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFMkQiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9DaXRhdGlvbkV4dHJhY3Rvci8uL2V4dGVuc2lvbi9zaXRlL2ZnL2NvcmUvZmdfZ2VuZXJhbGl6ZV9kYXRhLm1qcz9iZGFhIl0sInNvdXJjZXNDb250ZW50IjpbIi8qXG5NSVQgTGljZW5zZVxuXG5Db3B5cmlnaHQgKGMpIDIwMjAgUm9iZXJ0IE0gUGF2ZXlcblxuUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEgY29weVxub2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGUgXCJTb2Z0d2FyZVwiKSwgdG8gZGVhbFxuaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVzdHJpY3Rpb24sIGluY2x1ZGluZyB3aXRob3V0IGxpbWl0YXRpb24gdGhlIHJpZ2h0c1xudG8gdXNlLCBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLCBkaXN0cmlidXRlLCBzdWJsaWNlbnNlLCBhbmQvb3Igc2VsbFxuY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzXG5mdXJuaXNoZWQgdG8gZG8gc28sIHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZyBjb25kaXRpb25zOlxuXG5UaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZCBpbiBhbGxcbmNvcGllcyBvciBzdWJzdGFudGlhbCBwb3J0aW9ucyBvZiB0aGUgU29mdHdhcmUuXG5cblRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCBcIkFTIElTXCIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1JcbklNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLFxuRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFXG5BVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSXG5MSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLFxuT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTiBUSEVcblNPRlRXQVJFLlxuKi9cblxuaW1wb3J0IHsgR2VuZXJhbGl6ZWREYXRhLCBkYXRlUXVhbGlmaWVycyB9IGZyb20gXCIuLi8uLi8uLi9iYXNlL2NvcmUvZ2VuZXJhbGl6ZV9kYXRhX3V0aWxzLm1qc1wiO1xuaW1wb3J0IHsgUlQgfSBmcm9tIFwiLi4vLi4vLi4vYmFzZS9jb3JlL3JlY29yZF90eXBlLm1qc1wiO1xuXG5mdW5jdGlvbiBzZXROYW1lcyhkYXRhLCByZXN1bHQpIHtcbiAgbGV0IGZnTmFtZSA9IGRhdGEubmFtZTtcbiAgbGV0IGZ1bGxOYW1lID0gZmdOYW1lO1xuICBsZXQgbWFpZGVuTmFtZSA9IFwiXCI7XG4gIGxldCBjbG4gPSBcIlwiO1xuXG4gIC8vIFRoZSBuYW1lIHN0cmluZyBjYW4gY29udGFpbiBpdGFsaWNzXG4gIGlmIChkYXRhLm5hbWVIdG1sICYmIGZnTmFtZSAhPSBkYXRhLm5hbWVIdG1sICYmIGRhdGEubmFtZUh0bWwuaW5jbHVkZXMoXCI8aT5cIikpIHtcbiAgICAvLyB3ZSBtYXkgaGF2ZSBhIHBhcnQgaW4gaXRhbGljc1xuICAgIGxldCBodG1sID0gZGF0YS5uYW1lSHRtbDtcbiAgICBsZXQgaXRhbGljU3RhcnRJbmRleCA9IGh0bWwuaW5kZXhPZihcIjxpPlwiKTtcbiAgICBsZXQgaXRhbGljRW5kSW5kZXggPSBodG1sLmluZGV4T2YoXCI8L2k+XCIsIGl0YWxpY1N0YXJ0SW5kZXgpO1xuICAgIGlmIChpdGFsaWNTdGFydEluZGV4ICE9IC0xICYmIGl0YWxpY0VuZEluZGV4ICE9IC0xKSB7XG4gICAgICBsZXQgcGFydEJlZm9yZSA9IGh0bWwuc3Vic3RyaW5nKDAsIGl0YWxpY1N0YXJ0SW5kZXgpLnRyaW0oKTtcbiAgICAgIGxldCBwYXJ0SXRhbGljID0gaHRtbC5zdWJzdHJpbmcoaXRhbGljU3RhcnRJbmRleCArIDMsIGl0YWxpY0VuZEluZGV4KS50cmltKCk7XG4gICAgICBsZXQgcGFydEFmdGVyID0gaHRtbC5zdWJzdHJpbmcoaXRhbGljRW5kSW5kZXggKyA0KS50cmltKCk7XG5cbiAgICAgIC8vIGNoZWNrIHRoZXJlIGFyZSBubyBtb3JlIGl0YWxpY3NcbiAgICAgIGxldCBzZWNvbmRJdGFsaWNTdGFydEluZGV4ID0gaHRtbC5pbmRleE9mKFwiPGk+XCIsIGl0YWxpY0VuZEluZGV4KTtcbiAgICAgIGlmIChzZWNvbmRJdGFsaWNTdGFydEluZGV4ID09IC0xKSB7XG4gICAgICAgIGZ1bGxOYW1lID0gcGFydEJlZm9yZSArIFwiIFwiICsgcGFydEFmdGVyO1xuICAgICAgICBtYWlkZW5OYW1lID0gcGFydEl0YWxpYztcbiAgICAgICAgY2xuID0gcGFydEFmdGVyO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHJlc3VsdC5zZXRGdWxsTmFtZShmdWxsTmFtZSk7XG5cbiAgaWYgKCFtYWlkZW5OYW1lKSB7XG4gICAgcmVzdWx0Lmxhc3ROYW1lQXREZWF0aCA9IHJlc3VsdC5pbmZlckxhc3ROYW1lKCk7XG4gIH0gZWxzZSB7XG4gICAgcmVzdWx0Lmxhc3ROYW1lQXRCaXJ0aCA9IG1haWRlbk5hbWU7XG4gICAgaWYgKGNsbikge1xuICAgICAgcmVzdWx0Lmxhc3ROYW1lQXREZWF0aCA9IGNsbjtcbiAgICB9XG4gIH1cbn1cblxuZnVuY3Rpb24gZ2VuZXJhbGl6ZURhdGEoaW5wdXQpIHtcbiAgbGV0IGRhdGEgPSBpbnB1dC5leHRyYWN0ZWREYXRhO1xuXG4gIGxldCByZXN1bHQgPSBuZXcgR2VuZXJhbGl6ZWREYXRhKCk7XG5cbiAgcmVzdWx0LnNvdXJjZU9mRGF0YSA9IFwiZmdcIjtcblxuICBpZiAoIWRhdGEuc3VjY2Vzcykge1xuICAgIHJldHVybiByZXN1bHQ7IC8vdGhlIGV4dHJhY3QgZmFpbGVkXG4gIH1cblxuICByZXN1bHQuc291cmNlVHlwZSA9IFwicmVjb3JkXCI7XG5cbiAgLy8gSWYgbm8gYnVyaWFsIGxvY2F0aW9uIHBlcmhhcHMgaXQgc2hvdWxkIGJlIGEgZGVhdGg/XG4gIHJlc3VsdC5yZWNvcmRUeXBlID0gUlQuTWVtb3JpYWw7XG5cbiAgcmVzdWx0LnNldEV2ZW50RGF0ZShkYXRhLmRlYXRoRGF0ZSk7XG4gIHJlc3VsdC5zZXRFdmVudFBsYWNlKGRhdGEuY2VtZXRlcnlGdWxsQWRkcmVzcyk7XG5cbiAgaWYgKHJlc3VsdC5ldmVudFBsYWNlKSB7XG4gICAgcmVzdWx0LmV2ZW50UGxhY2Uuc3RyZWV0QWRkcmVzcyA9IGRhdGEuY2VtZXRlcnlOYW1lO1xuICB9XG5cbiAgc2V0TmFtZXMoZGF0YSwgcmVzdWx0KTtcblxuICByZXN1bHQuc2V0RGVhdGhEYXRlKGRhdGEuZGVhdGhEYXRlKTtcbiAgcmVzdWx0LnNldERlYXRoUGxhY2UoZGF0YS5kZWF0aFBsYWNlKTtcblxuICBpZiAoZGF0YS5hZ2VBdERlYXRoKSB7XG4gICAgcmVzdWx0LmFnZUF0RGVhdGggPSBkYXRhLmFnZUF0RGVhdGg7XG4gIH1cblxuICByZXN1bHQuc2V0QmlydGhEYXRlKGRhdGEuYmlydGhEYXRlKTtcbiAgcmVzdWx0LnNldEJpcnRoUGxhY2UoZGF0YS5iaXJ0aFBsYWNlKTtcblxuICAvLyBzaG91bGQgd2UgdXNlIGEgY29sbGVjdGlvbiB0byBhbGxvdyBzZWFyY2ggZm9yIHNhbWUgcmVjb3JkIG9uIEFuY2VzdHJ5P1xuXG4gIHJlc3VsdC5oYXNWYWxpZERhdGEgPSB0cnVlO1xuXG4gIHJldHVybiByZXN1bHQ7XG59XG5cbmV4cG9ydCB7IGdlbmVyYWxpemVEYXRhLCBHZW5lcmFsaXplZERhdGEsIGRhdGVRdWFsaWZpZXJzIH07XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./extension/site/fg/core/fg_generalize_data.mjs\n");

/***/ }),

/***/ "./extension/site/fg/core/fg_options.mjs":
/*!***********************************************!*\
  !*** ./extension/site/fg/core/fg_options.mjs ***!
  \***********************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _base_core_options_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../base/core/options/options_registry.mjs */ \"./extension/base/core/options/options_registry.mjs\");\n/*\nMIT License\n\nCopyright (c) 2020 Robert M Pavey\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.\n*/\n\n\n\nconst searchOptionsGroup = {\n  category: \"search\",\n  subcategory: \"fg\",\n  tab: \"search\",\n  subsection: \"fg\",\n  subheading: \"parameters\",\n  options: [\n    {\n      optionName: \"includeFirstName\",\n      type: \"checkbox\",\n      label: \"Include first name in search\",\n      defaultValue: true,\n    },\n    {\n      optionName: \"includeMiddleName\",\n      type: \"checkbox\",\n      label: \"Include middle name in search\",\n      defaultValue: true,\n    },\n    {\n      optionName: \"includeMaidenName\",\n      type: \"checkbox\",\n      label: \"Include matches with a memorial's maiden name in search\",\n      defaultValue: true,\n    },\n    {\n      optionName: \"birthYearExactness\",\n      type: \"select\",\n      label: \"Search exactness to use for birth year\",\n      values: [\n        { value: \"none\", text: \"Do not specify a birth year\" },\n        { value: \"auto\", text: \"Set automatically based on source\" },\n        { value: \"exact\", text: \"Exact year only\" },\n        { value: \"1\", text: \"+/- 1 years\" },\n        { value: \"3\", text: \"+/- 3 years\" },\n        { value: \"5\", text: \"+/- 5 years\" },\n        { value: \"10\", text: \"+/- 10 years\" },\n        { value: \"25\", text: \"+/- 25 years\" },\n      ],\n      defaultValue: \"auto\",\n    },\n    {\n      optionName: \"deathYearExactness\",\n      type: \"select\",\n      label: \"Search exactness to use for death year\",\n      values: [\n        { value: \"none\", text: \"Do not specify a death year\" },\n        { value: \"auto\", text: \"Set automatically based on source\" },\n        { value: \"exact\", text: \"Exact year only\" },\n        { value: \"1\", text: \"+/- 1 years\" },\n        { value: \"3\", text: \"+/- 3 years\" },\n        { value: \"5\", text: \"+/- 5 years\" },\n        { value: \"10\", text: \"+/- 10 years\" },\n        { value: \"25\", text: \"+/- 25 years\" },\n      ],\n      defaultValue: \"auto\",\n    },\n  ],\n};\n\nconst citationOptionsGroup = {\n  category: \"citation\",\n  subcategory: \"fg\",\n  tab: \"citation\",\n  subsection: \"fg\",\n  options: [\n    {\n      optionName: \"includeImageStatus\",\n      type: \"checkbox\",\n      label: \"Include an indication of whether there is an image or not\",\n      defaultValue: true,\n    },\n    {\n      optionName: \"includePlot\",\n      type: \"checkbox\",\n      label: \"Include the burial plot details if available\",\n      defaultValue: true,\n    },\n    {\n      optionName: \"includeMaintainer\",\n      type: \"checkbox\",\n      label: \"Include the maintainer in the citation\",\n      defaultValue: true,\n    },\n    {\n      optionName: \"includeInscription\",\n      type: \"checkbox\",\n      label: \"Include the inscription in the citation if available\",\n      defaultValue: false,\n      unitTestValue: true,\n    },\n    {\n      optionName: \"italicsInName\",\n      type: \"select\",\n      label: \"If the name has a part in italics (usually maiden name)\",\n      values: [\n        { value: \"omit\", text: \"Omit that part of name from citation\" },\n        {\n          value: \"italic\",\n          text: \"Put that part of name in italics in citation\",\n        },\n        {\n          value: \"plain\",\n          text: \"Make that part of the name plain text in citation\",\n        },\n      ],\n      defaultValue: \"italic\",\n    },\n  ],\n};\n\n(0,_base_core_options_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerSubsectionForOptions)(\"search\", \"fg\", \"Find a Grave\");\n(0,_base_core_options_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerSiteSearchPopupOptionsGroup)(\"fg\", 4, 4);\n(0,_base_core_options_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerSubheadingForOptions)(\"search\", \"fg\", \"parameters\", \"Search Parameters\");\n(0,_base_core_options_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerOptionsGroup)(searchOptionsGroup);\n\n(0,_base_core_options_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerSubsectionForOptions)(\"citation\", \"fg\", \"Find a Grave\");\n(0,_base_core_options_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerOptionsGroup)(citationOptionsGroup);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9leHRlbnNpb24vc2l0ZS9mZy9jb3JlL2ZnX29wdGlvbnMubWpzLmpzIiwibWFwcGluZ3MiOiI7O0FBQUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQU95RDs7QUFFekQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVSxvREFBb0Q7QUFDOUQsVUFBVSwwREFBMEQ7QUFDcEUsVUFBVSx5Q0FBeUM7QUFDbkQsVUFBVSxpQ0FBaUM7QUFDM0MsVUFBVSxpQ0FBaUM7QUFDM0MsVUFBVSxpQ0FBaUM7QUFDM0MsVUFBVSxtQ0FBbUM7QUFDN0MsVUFBVSxtQ0FBbUM7QUFDN0M7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVSxvREFBb0Q7QUFDOUQsVUFBVSwwREFBMEQ7QUFDcEUsVUFBVSx5Q0FBeUM7QUFDbkQsVUFBVSxpQ0FBaUM7QUFDM0MsVUFBVSxpQ0FBaUM7QUFDM0MsVUFBVSxpQ0FBaUM7QUFDM0MsVUFBVSxtQ0FBbUM7QUFDN0MsVUFBVSxtQ0FBbUM7QUFDN0M7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVSw2REFBNkQ7QUFDdkU7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7O0FBRUEscUdBQTRCO0FBQzVCLDRHQUFtQztBQUNuQyxxR0FBNEI7QUFDNUIsNkZBQW9COztBQUVwQixxR0FBNEI7QUFDNUIsNkZBQW9CIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vQ2l0YXRpb25FeHRyYWN0b3IvLi9leHRlbnNpb24vc2l0ZS9mZy9jb3JlL2ZnX29wdGlvbnMubWpzPzg2OGYiXSwic291cmNlc0NvbnRlbnQiOlsiLypcbk1JVCBMaWNlbnNlXG5cbkNvcHlyaWdodCAoYykgMjAyMCBSb2JlcnQgTSBQYXZleVxuXG5QZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYSBjb3B5XG5vZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSBcIlNvZnR3YXJlXCIpLCB0byBkZWFsXG5pbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzXG50byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsXG5jb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXNcbmZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6XG5cblRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkIGluIGFsbFxuY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS5cblxuVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEIFwiQVMgSVNcIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUlxuSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksXG5GSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEVcbkFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVJcbkxJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sXG5PVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOIFRIRVxuU09GVFdBUkUuXG4qL1xuXG5pbXBvcnQge1xuICByZWdpc3RlclN1YnNlY3Rpb25Gb3JPcHRpb25zLFxuICByZWdpc3RlclN1YmhlYWRpbmdGb3JPcHRpb25zLFxuICByZWdpc3Rlck9wdGlvbnNHcm91cCxcbiAgcmVnaXN0ZXJTaXRlU2VhcmNoUG9wdXBPcHRpb25zR3JvdXAsXG59IGZyb20gXCIuLi8uLi8uLi9iYXNlL2NvcmUvb3B0aW9ucy9vcHRpb25zX3JlZ2lzdHJ5Lm1qc1wiO1xuXG5jb25zdCBzZWFyY2hPcHRpb25zR3JvdXAgPSB7XG4gIGNhdGVnb3J5OiBcInNlYXJjaFwiLFxuICBzdWJjYXRlZ29yeTogXCJmZ1wiLFxuICB0YWI6IFwic2VhcmNoXCIsXG4gIHN1YnNlY3Rpb246IFwiZmdcIixcbiAgc3ViaGVhZGluZzogXCJwYXJhbWV0ZXJzXCIsXG4gIG9wdGlvbnM6IFtcbiAgICB7XG4gICAgICBvcHRpb25OYW1lOiBcImluY2x1ZGVGaXJzdE5hbWVcIixcbiAgICAgIHR5cGU6IFwiY2hlY2tib3hcIixcbiAgICAgIGxhYmVsOiBcIkluY2x1ZGUgZmlyc3QgbmFtZSBpbiBzZWFyY2hcIixcbiAgICAgIGRlZmF1bHRWYWx1ZTogdHJ1ZSxcbiAgICB9LFxuICAgIHtcbiAgICAgIG9wdGlvbk5hbWU6IFwiaW5jbHVkZU1pZGRsZU5hbWVcIixcbiAgICAgIHR5cGU6IFwiY2hlY2tib3hcIixcbiAgICAgIGxhYmVsOiBcIkluY2x1ZGUgbWlkZGxlIG5hbWUgaW4gc2VhcmNoXCIsXG4gICAgICBkZWZhdWx0VmFsdWU6IHRydWUsXG4gICAgfSxcbiAgICB7XG4gICAgICBvcHRpb25OYW1lOiBcImluY2x1ZGVNYWlkZW5OYW1lXCIsXG4gICAgICB0eXBlOiBcImNoZWNrYm94XCIsXG4gICAgICBsYWJlbDogXCJJbmNsdWRlIG1hdGNoZXMgd2l0aCBhIG1lbW9yaWFsJ3MgbWFpZGVuIG5hbWUgaW4gc2VhcmNoXCIsXG4gICAgICBkZWZhdWx0VmFsdWU6IHRydWUsXG4gICAgfSxcbiAgICB7XG4gICAgICBvcHRpb25OYW1lOiBcImJpcnRoWWVhckV4YWN0bmVzc1wiLFxuICAgICAgdHlwZTogXCJzZWxlY3RcIixcbiAgICAgIGxhYmVsOiBcIlNlYXJjaCBleGFjdG5lc3MgdG8gdXNlIGZvciBiaXJ0aCB5ZWFyXCIsXG4gICAgICB2YWx1ZXM6IFtcbiAgICAgICAgeyB2YWx1ZTogXCJub25lXCIsIHRleHQ6IFwiRG8gbm90IHNwZWNpZnkgYSBiaXJ0aCB5ZWFyXCIgfSxcbiAgICAgICAgeyB2YWx1ZTogXCJhdXRvXCIsIHRleHQ6IFwiU2V0IGF1dG9tYXRpY2FsbHkgYmFzZWQgb24gc291cmNlXCIgfSxcbiAgICAgICAgeyB2YWx1ZTogXCJleGFjdFwiLCB0ZXh0OiBcIkV4YWN0IHllYXIgb25seVwiIH0sXG4gICAgICAgIHsgdmFsdWU6IFwiMVwiLCB0ZXh0OiBcIisvLSAxIHllYXJzXCIgfSxcbiAgICAgICAgeyB2YWx1ZTogXCIzXCIsIHRleHQ6IFwiKy8tIDMgeWVhcnNcIiB9LFxuICAgICAgICB7IHZhbHVlOiBcIjVcIiwgdGV4dDogXCIrLy0gNSB5ZWFyc1wiIH0sXG4gICAgICAgIHsgdmFsdWU6IFwiMTBcIiwgdGV4dDogXCIrLy0gMTAgeWVhcnNcIiB9LFxuICAgICAgICB7IHZhbHVlOiBcIjI1XCIsIHRleHQ6IFwiKy8tIDI1IHllYXJzXCIgfSxcbiAgICAgIF0sXG4gICAgICBkZWZhdWx0VmFsdWU6IFwiYXV0b1wiLFxuICAgIH0sXG4gICAge1xuICAgICAgb3B0aW9uTmFtZTogXCJkZWF0aFllYXJFeGFjdG5lc3NcIixcbiAgICAgIHR5cGU6IFwic2VsZWN0XCIsXG4gICAgICBsYWJlbDogXCJTZWFyY2ggZXhhY3RuZXNzIHRvIHVzZSBmb3IgZGVhdGggeWVhclwiLFxuICAgICAgdmFsdWVzOiBbXG4gICAgICAgIHsgdmFsdWU6IFwibm9uZVwiLCB0ZXh0OiBcIkRvIG5vdCBzcGVjaWZ5IGEgZGVhdGggeWVhclwiIH0sXG4gICAgICAgIHsgdmFsdWU6IFwiYXV0b1wiLCB0ZXh0OiBcIlNldCBhdXRvbWF0aWNhbGx5IGJhc2VkIG9uIHNvdXJjZVwiIH0sXG4gICAgICAgIHsgdmFsdWU6IFwiZXhhY3RcIiwgdGV4dDogXCJFeGFjdCB5ZWFyIG9ubHlcIiB9LFxuICAgICAgICB7IHZhbHVlOiBcIjFcIiwgdGV4dDogXCIrLy0gMSB5ZWFyc1wiIH0sXG4gICAgICAgIHsgdmFsdWU6IFwiM1wiLCB0ZXh0OiBcIisvLSAzIHllYXJzXCIgfSxcbiAgICAgICAgeyB2YWx1ZTogXCI1XCIsIHRleHQ6IFwiKy8tIDUgeWVhcnNcIiB9LFxuICAgICAgICB7IHZhbHVlOiBcIjEwXCIsIHRleHQ6IFwiKy8tIDEwIHllYXJzXCIgfSxcbiAgICAgICAgeyB2YWx1ZTogXCIyNVwiLCB0ZXh0OiBcIisvLSAyNSB5ZWFyc1wiIH0sXG4gICAgICBdLFxuICAgICAgZGVmYXVsdFZhbHVlOiBcImF1dG9cIixcbiAgICB9LFxuICBdLFxufTtcblxuY29uc3QgY2l0YXRpb25PcHRpb25zR3JvdXAgPSB7XG4gIGNhdGVnb3J5OiBcImNpdGF0aW9uXCIsXG4gIHN1YmNhdGVnb3J5OiBcImZnXCIsXG4gIHRhYjogXCJjaXRhdGlvblwiLFxuICBzdWJzZWN0aW9uOiBcImZnXCIsXG4gIG9wdGlvbnM6IFtcbiAgICB7XG4gICAgICBvcHRpb25OYW1lOiBcImluY2x1ZGVJbWFnZVN0YXR1c1wiLFxuICAgICAgdHlwZTogXCJjaGVja2JveFwiLFxuICAgICAgbGFiZWw6IFwiSW5jbHVkZSBhbiBpbmRpY2F0aW9uIG9mIHdoZXRoZXIgdGhlcmUgaXMgYW4gaW1hZ2Ugb3Igbm90XCIsXG4gICAgICBkZWZhdWx0VmFsdWU6IHRydWUsXG4gICAgfSxcbiAgICB7XG4gICAgICBvcHRpb25OYW1lOiBcImluY2x1ZGVQbG90XCIsXG4gICAgICB0eXBlOiBcImNoZWNrYm94XCIsXG4gICAgICBsYWJlbDogXCJJbmNsdWRlIHRoZSBidXJpYWwgcGxvdCBkZXRhaWxzIGlmIGF2YWlsYWJsZVwiLFxuICAgICAgZGVmYXVsdFZhbHVlOiB0cnVlLFxuICAgIH0sXG4gICAge1xuICAgICAgb3B0aW9uTmFtZTogXCJpbmNsdWRlTWFpbnRhaW5lclwiLFxuICAgICAgdHlwZTogXCJjaGVja2JveFwiLFxuICAgICAgbGFiZWw6IFwiSW5jbHVkZSB0aGUgbWFpbnRhaW5lciBpbiB0aGUgY2l0YXRpb25cIixcbiAgICAgIGRlZmF1bHRWYWx1ZTogdHJ1ZSxcbiAgICB9LFxuICAgIHtcbiAgICAgIG9wdGlvbk5hbWU6IFwiaW5jbHVkZUluc2NyaXB0aW9uXCIsXG4gICAgICB0eXBlOiBcImNoZWNrYm94XCIsXG4gICAgICBsYWJlbDogXCJJbmNsdWRlIHRoZSBpbnNjcmlwdGlvbiBpbiB0aGUgY2l0YXRpb24gaWYgYXZhaWxhYmxlXCIsXG4gICAgICBkZWZhdWx0VmFsdWU6IGZhbHNlLFxuICAgICAgdW5pdFRlc3RWYWx1ZTogdHJ1ZSxcbiAgICB9LFxuICAgIHtcbiAgICAgIG9wdGlvbk5hbWU6IFwiaXRhbGljc0luTmFtZVwiLFxuICAgICAgdHlwZTogXCJzZWxlY3RcIixcbiAgICAgIGxhYmVsOiBcIklmIHRoZSBuYW1lIGhhcyBhIHBhcnQgaW4gaXRhbGljcyAodXN1YWxseSBtYWlkZW4gbmFtZSlcIixcbiAgICAgIHZhbHVlczogW1xuICAgICAgICB7IHZhbHVlOiBcIm9taXRcIiwgdGV4dDogXCJPbWl0IHRoYXQgcGFydCBvZiBuYW1lIGZyb20gY2l0YXRpb25cIiB9LFxuICAgICAgICB7XG4gICAgICAgICAgdmFsdWU6IFwiaXRhbGljXCIsXG4gICAgICAgICAgdGV4dDogXCJQdXQgdGhhdCBwYXJ0IG9mIG5hbWUgaW4gaXRhbGljcyBpbiBjaXRhdGlvblwiLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgdmFsdWU6IFwicGxhaW5cIixcbiAgICAgICAgICB0ZXh0OiBcIk1ha2UgdGhhdCBwYXJ0IG9mIHRoZSBuYW1lIHBsYWluIHRleHQgaW4gY2l0YXRpb25cIixcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgICBkZWZhdWx0VmFsdWU6IFwiaXRhbGljXCIsXG4gICAgfSxcbiAgXSxcbn07XG5cbnJlZ2lzdGVyU3Vic2VjdGlvbkZvck9wdGlvbnMoXCJzZWFyY2hcIiwgXCJmZ1wiLCBcIkZpbmQgYSBHcmF2ZVwiKTtcbnJlZ2lzdGVyU2l0ZVNlYXJjaFBvcHVwT3B0aW9uc0dyb3VwKFwiZmdcIiwgNCwgNCk7XG5yZWdpc3RlclN1YmhlYWRpbmdGb3JPcHRpb25zKFwic2VhcmNoXCIsIFwiZmdcIiwgXCJwYXJhbWV0ZXJzXCIsIFwiU2VhcmNoIFBhcmFtZXRlcnNcIik7XG5yZWdpc3Rlck9wdGlvbnNHcm91cChzZWFyY2hPcHRpb25zR3JvdXApO1xuXG5yZWdpc3RlclN1YnNlY3Rpb25Gb3JPcHRpb25zKFwiY2l0YXRpb25cIiwgXCJmZ1wiLCBcIkZpbmQgYSBHcmF2ZVwiKTtcbnJlZ2lzdGVyT3B0aW9uc0dyb3VwKGNpdGF0aW9uT3B0aW9uc0dyb3VwKTtcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./extension/site/fg/core/fg_options.mjs\n");

/***/ }),

/***/ "./extension/site/fmp/core/fmp_options.mjs":
/*!*************************************************!*\
  !*** ./extension/site/fmp/core/fmp_options.mjs ***!
  \*************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _base_core_options_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../base/core/options/options_registry.mjs */ \"./extension/base/core/options/options_registry.mjs\");\n/*\nMIT License\n\nCopyright (c) 2020 Robert M Pavey\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.\n*/\n\n\n\nconst searchOptionsGroup = {\n  category: \"search\",\n  subcategory: \"fmp\",\n  tab: \"search\",\n  subsection: \"fmp\",\n  subheading: \"parameters\",\n  options: [\n    {\n      optionName: \"domain\",\n      type: \"select\",\n      label: \"Domain to use for searches (where is your subscription?)\",\n      comment:\n        \"NOTE: If you are trying to follow a FindMyPast link that points to a different domain\" +\n        ' you can right click on the link and use the context menu item \"Sourcer: Open Link in New Tab\".' +\n        \" This will redirect to the domain selected above.\",\n      values: [\n        { value: \"findmypast.com\", text: \"findmypast.com\" },\n        { value: \"findmypast.co.uk\", text: \"findmypast.co.uk\" },\n        { value: \"findmypast.ie\", text: \"findmypast.ie\" },\n        { value: \"findmypast.com.au\", text: \"findmypast.com.au\" },\n      ],\n      defaultValue: \"findmypast.co.uk\",\n      unitTestValue: \"findmypast.co.uk\",\n    },\n    {\n      optionName: \"lastNameVariants\",\n      type: \"checkbox\",\n      label: \"Include last name variants in search\",\n      defaultValue: true,\n      unitTestValue: true,\n    },\n  ],\n};\n\nconst citationOptionsGroup = {\n  category: \"citation\",\n  subcategory: \"fmp\",\n  tab: \"citation\",\n  subsection: \"fmp\",\n  options: [\n    {\n      optionName: \"dataStyle\",\n      type: \"select\",\n      label: \"Include record data at end of citation as\",\n      values: [\n        { value: \"none\", text: \"Do not include data\" },\n        {\n          value: \"string\",\n          text: \"Sentence (fall back to list if no sentence)\",\n        },\n        { value: \"list\", text: \"List of field names/values\" },\n        { value: \"table\", text: \"Table of field names/values\" },\n      ],\n      defaultValue: \"string\",\n      unitTestValue: \"string\",\n    },\n    {\n      optionName: \"subscriptionRequired\",\n      type: \"select\",\n      label: \"Indicate that a subscription is required with link\",\n      values: [\n        { value: \"none\", text: \"Do not add any such indication\" },\n        {\n          value: \"subscriptionRequired\",\n          text: 'Include the text \"subscription required\"',\n        },\n        {\n          value: \"requiresSubscription\",\n          text: 'Include the text \"requires subscription\"',\n        },\n        { value: \"dollar\", text: 'Include the text \"$\"' },\n        { value: \"paywall\", text: 'Include the text \"paywall\"' },\n      ],\n      defaultValue: \"none\",\n      unitTestValue: \"none\",\n    },\n    {\n      optionName: \"includeImageLink\",\n      type: \"checkbox\",\n      label: \"Include a link to the original image if available\",\n      defaultValue: true,\n      unitTestValue: true,\n    },\n  ],\n};\n\n(0,_base_core_options_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerSubsectionForOptions)(\"search\", \"fmp\", \"FindMyPast\");\n(0,_base_core_options_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerSiteSearchPopupOptionsGroup)(\"fmp\", 2, 2);\n(0,_base_core_options_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerSubheadingForOptions)(\"search\", \"fmp\", \"parameters\", \"Search Parameters\");\n(0,_base_core_options_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerOptionsGroup)(searchOptionsGroup);\n\n(0,_base_core_options_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerSubsectionForOptions)(\"citation\", \"fmp\", \"FindMyPast\");\n(0,_base_core_options_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerOptionsGroup)(citationOptionsGroup);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9leHRlbnNpb24vc2l0ZS9mbXAvY29yZS9mbXBfb3B0aW9ucy5tanMuanMiLCJtYXBwaW5ncyI6Ijs7QUFBQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBT3lEOztBQUV6RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVUsaURBQWlEO0FBQzNELFVBQVUscURBQXFEO0FBQy9ELFVBQVUsK0NBQStDO0FBQ3pELFVBQVUsdURBQXVEO0FBQ2pFO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVSw0Q0FBNEM7QUFDdEQ7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNULFVBQVUsbURBQW1EO0FBQzdELFVBQVUscURBQXFEO0FBQy9EO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVSx1REFBdUQ7QUFDakU7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVCxVQUFVLCtDQUErQztBQUN6RCxVQUFVLHNEQUFzRDtBQUNoRTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7O0FBRUEscUdBQTRCO0FBQzVCLDRHQUFtQztBQUNuQyxxR0FBNEI7QUFDNUIsNkZBQW9COztBQUVwQixxR0FBNEI7QUFDNUIsNkZBQW9CIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vQ2l0YXRpb25FeHRyYWN0b3IvLi9leHRlbnNpb24vc2l0ZS9mbXAvY29yZS9mbXBfb3B0aW9ucy5tanM/NDEyNyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuTUlUIExpY2Vuc2VcblxuQ29weXJpZ2h0IChjKSAyMDIwIFJvYmVydCBNIFBhdmV5XG5cblBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHlcbm9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlIFwiU29mdHdhcmVcIiksIHRvIGRlYWxcbmluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHNcbnRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGxcbmNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQgcGVyc29ucyB0byB3aG9tIHRoZSBTb2Z0d2FyZSBpc1xuZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczpcblxuVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW4gYWxsXG5jb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLlxuXG5USEUgU09GVFdBUkUgSVMgUFJPVklERUQgXCJBUyBJU1wiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SXG5JTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSxcbkZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRVxuQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUlxuTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSxcbk9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4gVEhFXG5TT0ZUV0FSRS5cbiovXG5cbmltcG9ydCB7XG4gIHJlZ2lzdGVyU3Vic2VjdGlvbkZvck9wdGlvbnMsXG4gIHJlZ2lzdGVyU3ViaGVhZGluZ0Zvck9wdGlvbnMsXG4gIHJlZ2lzdGVyT3B0aW9uc0dyb3VwLFxuICByZWdpc3RlclNpdGVTZWFyY2hQb3B1cE9wdGlvbnNHcm91cCxcbn0gZnJvbSBcIi4uLy4uLy4uL2Jhc2UvY29yZS9vcHRpb25zL29wdGlvbnNfcmVnaXN0cnkubWpzXCI7XG5cbmNvbnN0IHNlYXJjaE9wdGlvbnNHcm91cCA9IHtcbiAgY2F0ZWdvcnk6IFwic2VhcmNoXCIsXG4gIHN1YmNhdGVnb3J5OiBcImZtcFwiLFxuICB0YWI6IFwic2VhcmNoXCIsXG4gIHN1YnNlY3Rpb246IFwiZm1wXCIsXG4gIHN1YmhlYWRpbmc6IFwicGFyYW1ldGVyc1wiLFxuICBvcHRpb25zOiBbXG4gICAge1xuICAgICAgb3B0aW9uTmFtZTogXCJkb21haW5cIixcbiAgICAgIHR5cGU6IFwic2VsZWN0XCIsXG4gICAgICBsYWJlbDogXCJEb21haW4gdG8gdXNlIGZvciBzZWFyY2hlcyAod2hlcmUgaXMgeW91ciBzdWJzY3JpcHRpb24/KVwiLFxuICAgICAgY29tbWVudDpcbiAgICAgICAgXCJOT1RFOiBJZiB5b3UgYXJlIHRyeWluZyB0byBmb2xsb3cgYSBGaW5kTXlQYXN0IGxpbmsgdGhhdCBwb2ludHMgdG8gYSBkaWZmZXJlbnQgZG9tYWluXCIgK1xuICAgICAgICAnIHlvdSBjYW4gcmlnaHQgY2xpY2sgb24gdGhlIGxpbmsgYW5kIHVzZSB0aGUgY29udGV4dCBtZW51IGl0ZW0gXCJTb3VyY2VyOiBPcGVuIExpbmsgaW4gTmV3IFRhYlwiLicgK1xuICAgICAgICBcIiBUaGlzIHdpbGwgcmVkaXJlY3QgdG8gdGhlIGRvbWFpbiBzZWxlY3RlZCBhYm92ZS5cIixcbiAgICAgIHZhbHVlczogW1xuICAgICAgICB7IHZhbHVlOiBcImZpbmRteXBhc3QuY29tXCIsIHRleHQ6IFwiZmluZG15cGFzdC5jb21cIiB9LFxuICAgICAgICB7IHZhbHVlOiBcImZpbmRteXBhc3QuY28udWtcIiwgdGV4dDogXCJmaW5kbXlwYXN0LmNvLnVrXCIgfSxcbiAgICAgICAgeyB2YWx1ZTogXCJmaW5kbXlwYXN0LmllXCIsIHRleHQ6IFwiZmluZG15cGFzdC5pZVwiIH0sXG4gICAgICAgIHsgdmFsdWU6IFwiZmluZG15cGFzdC5jb20uYXVcIiwgdGV4dDogXCJmaW5kbXlwYXN0LmNvbS5hdVwiIH0sXG4gICAgICBdLFxuICAgICAgZGVmYXVsdFZhbHVlOiBcImZpbmRteXBhc3QuY28udWtcIixcbiAgICAgIHVuaXRUZXN0VmFsdWU6IFwiZmluZG15cGFzdC5jby51a1wiLFxuICAgIH0sXG4gICAge1xuICAgICAgb3B0aW9uTmFtZTogXCJsYXN0TmFtZVZhcmlhbnRzXCIsXG4gICAgICB0eXBlOiBcImNoZWNrYm94XCIsXG4gICAgICBsYWJlbDogXCJJbmNsdWRlIGxhc3QgbmFtZSB2YXJpYW50cyBpbiBzZWFyY2hcIixcbiAgICAgIGRlZmF1bHRWYWx1ZTogdHJ1ZSxcbiAgICAgIHVuaXRUZXN0VmFsdWU6IHRydWUsXG4gICAgfSxcbiAgXSxcbn07XG5cbmNvbnN0IGNpdGF0aW9uT3B0aW9uc0dyb3VwID0ge1xuICBjYXRlZ29yeTogXCJjaXRhdGlvblwiLFxuICBzdWJjYXRlZ29yeTogXCJmbXBcIixcbiAgdGFiOiBcImNpdGF0aW9uXCIsXG4gIHN1YnNlY3Rpb246IFwiZm1wXCIsXG4gIG9wdGlvbnM6IFtcbiAgICB7XG4gICAgICBvcHRpb25OYW1lOiBcImRhdGFTdHlsZVwiLFxuICAgICAgdHlwZTogXCJzZWxlY3RcIixcbiAgICAgIGxhYmVsOiBcIkluY2x1ZGUgcmVjb3JkIGRhdGEgYXQgZW5kIG9mIGNpdGF0aW9uIGFzXCIsXG4gICAgICB2YWx1ZXM6IFtcbiAgICAgICAgeyB2YWx1ZTogXCJub25lXCIsIHRleHQ6IFwiRG8gbm90IGluY2x1ZGUgZGF0YVwiIH0sXG4gICAgICAgIHtcbiAgICAgICAgICB2YWx1ZTogXCJzdHJpbmdcIixcbiAgICAgICAgICB0ZXh0OiBcIlNlbnRlbmNlIChmYWxsIGJhY2sgdG8gbGlzdCBpZiBubyBzZW50ZW5jZSlcIixcbiAgICAgICAgfSxcbiAgICAgICAgeyB2YWx1ZTogXCJsaXN0XCIsIHRleHQ6IFwiTGlzdCBvZiBmaWVsZCBuYW1lcy92YWx1ZXNcIiB9LFxuICAgICAgICB7IHZhbHVlOiBcInRhYmxlXCIsIHRleHQ6IFwiVGFibGUgb2YgZmllbGQgbmFtZXMvdmFsdWVzXCIgfSxcbiAgICAgIF0sXG4gICAgICBkZWZhdWx0VmFsdWU6IFwic3RyaW5nXCIsXG4gICAgICB1bml0VGVzdFZhbHVlOiBcInN0cmluZ1wiLFxuICAgIH0sXG4gICAge1xuICAgICAgb3B0aW9uTmFtZTogXCJzdWJzY3JpcHRpb25SZXF1aXJlZFwiLFxuICAgICAgdHlwZTogXCJzZWxlY3RcIixcbiAgICAgIGxhYmVsOiBcIkluZGljYXRlIHRoYXQgYSBzdWJzY3JpcHRpb24gaXMgcmVxdWlyZWQgd2l0aCBsaW5rXCIsXG4gICAgICB2YWx1ZXM6IFtcbiAgICAgICAgeyB2YWx1ZTogXCJub25lXCIsIHRleHQ6IFwiRG8gbm90IGFkZCBhbnkgc3VjaCBpbmRpY2F0aW9uXCIgfSxcbiAgICAgICAge1xuICAgICAgICAgIHZhbHVlOiBcInN1YnNjcmlwdGlvblJlcXVpcmVkXCIsXG4gICAgICAgICAgdGV4dDogJ0luY2x1ZGUgdGhlIHRleHQgXCJzdWJzY3JpcHRpb24gcmVxdWlyZWRcIicsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICB2YWx1ZTogXCJyZXF1aXJlc1N1YnNjcmlwdGlvblwiLFxuICAgICAgICAgIHRleHQ6ICdJbmNsdWRlIHRoZSB0ZXh0IFwicmVxdWlyZXMgc3Vic2NyaXB0aW9uXCInLFxuICAgICAgICB9LFxuICAgICAgICB7IHZhbHVlOiBcImRvbGxhclwiLCB0ZXh0OiAnSW5jbHVkZSB0aGUgdGV4dCBcIiRcIicgfSxcbiAgICAgICAgeyB2YWx1ZTogXCJwYXl3YWxsXCIsIHRleHQ6ICdJbmNsdWRlIHRoZSB0ZXh0IFwicGF5d2FsbFwiJyB9LFxuICAgICAgXSxcbiAgICAgIGRlZmF1bHRWYWx1ZTogXCJub25lXCIsXG4gICAgICB1bml0VGVzdFZhbHVlOiBcIm5vbmVcIixcbiAgICB9LFxuICAgIHtcbiAgICAgIG9wdGlvbk5hbWU6IFwiaW5jbHVkZUltYWdlTGlua1wiLFxuICAgICAgdHlwZTogXCJjaGVja2JveFwiLFxuICAgICAgbGFiZWw6IFwiSW5jbHVkZSBhIGxpbmsgdG8gdGhlIG9yaWdpbmFsIGltYWdlIGlmIGF2YWlsYWJsZVwiLFxuICAgICAgZGVmYXVsdFZhbHVlOiB0cnVlLFxuICAgICAgdW5pdFRlc3RWYWx1ZTogdHJ1ZSxcbiAgICB9LFxuICBdLFxufTtcblxucmVnaXN0ZXJTdWJzZWN0aW9uRm9yT3B0aW9ucyhcInNlYXJjaFwiLCBcImZtcFwiLCBcIkZpbmRNeVBhc3RcIik7XG5yZWdpc3RlclNpdGVTZWFyY2hQb3B1cE9wdGlvbnNHcm91cChcImZtcFwiLCAyLCAyKTtcbnJlZ2lzdGVyU3ViaGVhZGluZ0Zvck9wdGlvbnMoXCJzZWFyY2hcIiwgXCJmbXBcIiwgXCJwYXJhbWV0ZXJzXCIsIFwiU2VhcmNoIFBhcmFtZXRlcnNcIik7XG5yZWdpc3Rlck9wdGlvbnNHcm91cChzZWFyY2hPcHRpb25zR3JvdXApO1xuXG5yZWdpc3RlclN1YnNlY3Rpb25Gb3JPcHRpb25zKFwiY2l0YXRpb25cIiwgXCJmbXBcIiwgXCJGaW5kTXlQYXN0XCIpO1xucmVnaXN0ZXJPcHRpb25zR3JvdXAoY2l0YXRpb25PcHRpb25zR3JvdXApO1xuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./extension/site/fmp/core/fmp_options.mjs\n");

/***/ }),

/***/ "./extension/site/freebmd/core/freebmd_options.mjs":
/*!*********************************************************!*\
  !*** ./extension/site/freebmd/core/freebmd_options.mjs ***!
  \*********************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _base_core_options_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../base/core/options/options_registry.mjs */ \"./extension/base/core/options/options_registry.mjs\");\n/*\nMIT License\n\nCopyright (c) 2020 Robert M Pavey\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.\n*/\n\n\n\nconst citationOptionsGroup = {\n  category: \"citation\",\n  subcategory: \"freebmd\",\n  tab: \"citation\",\n  subsection: \"freebmd\",\n  options: [\n    {\n      optionName: \"changeNamesToInitialCaps\",\n      type: \"checkbox\",\n      label: \"Change any person and place names in all caps to initial caps\",\n      defaultValue: true,\n    },\n    {\n      optionName: \"referenceInItalics\",\n      type: \"checkbox\",\n      label: 'Put the text \"GRO Reference\" in italics',\n      defaultValue: true,\n    },\n    {\n      optionName: \"useDistrictUrl\",\n      type: \"checkbox\",\n      label: \"Add a link to the registration district page on ukbmd.org.uk (Not currently implemented)\",\n      defaultValue: true,\n    },\n  ],\n};\n\n(0,_base_core_options_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerSubsectionForOptions)(\"search\", \"freebmd\", \"FreeBMD (UK)\");\n(0,_base_core_options_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerSiteSearchPopupOptionsGroup)(\"freebmd\", 7, 7);\n\n(0,_base_core_options_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerSubsectionForOptions)(\"citation\", \"freebmd\", \"FreeBMD (UK)\");\n(0,_base_core_options_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerOptionsGroup)(citationOptionsGroup);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9leHRlbnNpb24vc2l0ZS9mcmVlYm1kL2NvcmUvZnJlZWJtZF9vcHRpb25zLm1qcy5qcyIsIm1hcHBpbmdzIjoiOztBQUFBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFNeUQ7O0FBRXpEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7O0FBRUEscUdBQTRCO0FBQzVCLDRHQUFtQzs7QUFFbkMscUdBQTRCO0FBQzVCLDZGQUFvQiIsInNvdXJjZXMiOlsid2VicGFjazovL0NpdGF0aW9uRXh0cmFjdG9yLy4vZXh0ZW5zaW9uL3NpdGUvZnJlZWJtZC9jb3JlL2ZyZWVibWRfb3B0aW9ucy5tanM/ZGE0NyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuTUlUIExpY2Vuc2VcblxuQ29weXJpZ2h0IChjKSAyMDIwIFJvYmVydCBNIFBhdmV5XG5cblBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHlcbm9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlIFwiU29mdHdhcmVcIiksIHRvIGRlYWxcbmluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHNcbnRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGxcbmNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQgcGVyc29ucyB0byB3aG9tIHRoZSBTb2Z0d2FyZSBpc1xuZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczpcblxuVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW4gYWxsXG5jb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLlxuXG5USEUgU09GVFdBUkUgSVMgUFJPVklERUQgXCJBUyBJU1wiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SXG5JTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSxcbkZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRVxuQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUlxuTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSxcbk9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4gVEhFXG5TT0ZUV0FSRS5cbiovXG5cbmltcG9ydCB7XG4gIHJlZ2lzdGVyU3Vic2VjdGlvbkZvck9wdGlvbnMsXG4gIHJlZ2lzdGVyT3B0aW9uc0dyb3VwLFxuICByZWdpc3RlclNpdGVTZWFyY2hQb3B1cE9wdGlvbnNHcm91cCxcbn0gZnJvbSBcIi4uLy4uLy4uL2Jhc2UvY29yZS9vcHRpb25zL29wdGlvbnNfcmVnaXN0cnkubWpzXCI7XG5cbmNvbnN0IGNpdGF0aW9uT3B0aW9uc0dyb3VwID0ge1xuICBjYXRlZ29yeTogXCJjaXRhdGlvblwiLFxuICBzdWJjYXRlZ29yeTogXCJmcmVlYm1kXCIsXG4gIHRhYjogXCJjaXRhdGlvblwiLFxuICBzdWJzZWN0aW9uOiBcImZyZWVibWRcIixcbiAgb3B0aW9uczogW1xuICAgIHtcbiAgICAgIG9wdGlvbk5hbWU6IFwiY2hhbmdlTmFtZXNUb0luaXRpYWxDYXBzXCIsXG4gICAgICB0eXBlOiBcImNoZWNrYm94XCIsXG4gICAgICBsYWJlbDogXCJDaGFuZ2UgYW55IHBlcnNvbiBhbmQgcGxhY2UgbmFtZXMgaW4gYWxsIGNhcHMgdG8gaW5pdGlhbCBjYXBzXCIsXG4gICAgICBkZWZhdWx0VmFsdWU6IHRydWUsXG4gICAgfSxcbiAgICB7XG4gICAgICBvcHRpb25OYW1lOiBcInJlZmVyZW5jZUluSXRhbGljc1wiLFxuICAgICAgdHlwZTogXCJjaGVja2JveFwiLFxuICAgICAgbGFiZWw6ICdQdXQgdGhlIHRleHQgXCJHUk8gUmVmZXJlbmNlXCIgaW4gaXRhbGljcycsXG4gICAgICBkZWZhdWx0VmFsdWU6IHRydWUsXG4gICAgfSxcbiAgICB7XG4gICAgICBvcHRpb25OYW1lOiBcInVzZURpc3RyaWN0VXJsXCIsXG4gICAgICB0eXBlOiBcImNoZWNrYm94XCIsXG4gICAgICBsYWJlbDogXCJBZGQgYSBsaW5rIHRvIHRoZSByZWdpc3RyYXRpb24gZGlzdHJpY3QgcGFnZSBvbiB1a2JtZC5vcmcudWsgKE5vdCBjdXJyZW50bHkgaW1wbGVtZW50ZWQpXCIsXG4gICAgICBkZWZhdWx0VmFsdWU6IHRydWUsXG4gICAgfSxcbiAgXSxcbn07XG5cbnJlZ2lzdGVyU3Vic2VjdGlvbkZvck9wdGlvbnMoXCJzZWFyY2hcIiwgXCJmcmVlYm1kXCIsIFwiRnJlZUJNRCAoVUspXCIpO1xucmVnaXN0ZXJTaXRlU2VhcmNoUG9wdXBPcHRpb25zR3JvdXAoXCJmcmVlYm1kXCIsIDcsIDcpO1xuXG5yZWdpc3RlclN1YnNlY3Rpb25Gb3JPcHRpb25zKFwiY2l0YXRpb25cIiwgXCJmcmVlYm1kXCIsIFwiRnJlZUJNRCAoVUspXCIpO1xucmVnaXN0ZXJPcHRpb25zR3JvdXAoY2l0YXRpb25PcHRpb25zR3JvdXApO1xuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./extension/site/freebmd/core/freebmd_options.mjs\n");

/***/ }),

/***/ "./extension/site/freecen/core/freecen_options.mjs":
/*!*********************************************************!*\
  !*** ./extension/site/freecen/core/freecen_options.mjs ***!
  \*********************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _base_core_options_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../base/core/options/options_registry.mjs */ \"./extension/base/core/options/options_registry.mjs\");\n/*\nMIT License\n\nCopyright (c) 2020 Robert M Pavey\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.\n*/\n\n\n\nconst searchOptionsGroup = {\n  category: \"search\",\n  subcategory: \"freecen\",\n  tab: \"search\",\n  subsection: \"freecen\",\n  subheading: \"parameters\",\n  options: [\n    {\n      optionName: \"fuzzyInDefault\",\n      type: \"checkbox\",\n      label: \"Use Name Soundex (when not searching same collection)\",\n      defaultValue: true,\n    },\n    {\n      optionName: \"fuzzyInSameCollection\",\n      type: \"checkbox\",\n      label: \"Use Name Soundex (when searching same collection)\",\n      defaultValue: true,\n    },\n    {\n      optionName: \"birthYearRangeDefault\",\n      type: \"select\",\n      label: \"Search range to use for birth year (when not searching same collection)\",\n      values: [\n        { value: \"none\", text: \"Do not specify a birth year\" },\n        { value: \"auto\", text: \"Set automatically based on source\" },\n        { value: \"exact\", text: \"Exact year only\" },\n        { value: \"2\", text: \"+/- 2 years\" },\n        { value: \"5\", text: \"+/- 5 years\" },\n        { value: \"10\", text: \"+/- 10 years\" },\n      ],\n      defaultValue: \"auto\",\n    },\n    {\n      optionName: \"birthYearRangeSameCollection\",\n      type: \"select\",\n      label: \"Search range to use for birth year (when searching same collection)\",\n      values: [\n        { value: \"none\", text: \"Do not specify a birth year\" },\n        { value: \"auto\", text: \"Set automatically based on source\" },\n        { value: \"exact\", text: \"Exact year only\" },\n        { value: \"2\", text: \"+/- 2 years\" },\n        { value: \"5\", text: \"+/- 5 years\" },\n        { value: \"10\", text: \"+/- 10 years\" },\n      ],\n      defaultValue: \"exact\",\n    },\n    {\n      optionName: \"includeBirthCounty\",\n      type: \"checkbox\",\n      label: \"Include birth county in search (if known)\",\n      defaultValue: true,\n    },\n    {\n      optionName: \"includeCensusCounty\",\n      type: \"checkbox\",\n      label: \"Include census county when searching same collection (if known)\",\n      defaultValue: true,\n    },\n  ],\n};\n\nconst citationOptionsGroup = {\n  category: \"citation\",\n  subcategory: \"freecen\",\n  tab: \"citation\",\n  subsection: \"freecen\",\n  options: [\n    {\n      optionName: \"dataStyle\",\n      type: \"select\",\n      label: \"Include record data at end of citation as\",\n      values: [\n        { value: \"none\", text: \"Do not include data\" },\n        {\n          value: \"string\",\n          text: \"Sentence (fall back to list if no sentence)\",\n        },\n        { value: \"list\", text: \"List of field names/values\" },\n        { value: \"table\", text: \"Table of field names/values\" },\n      ],\n      defaultValue: \"string\",\n      unitTestValue: \"table\",\n    },\n    {\n      optionName: \"includeNationalArchivesLink\",\n      type: \"checkbox\",\n      label: \"Include a link to to the National Archives page for the census if known\",\n      defaultValue: true,\n    },\n  ],\n};\n\n(0,_base_core_options_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerSubsectionForOptions)(\"search\", \"freecen\", \"FreeCen (UK)\");\n(0,_base_core_options_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerSiteSearchPopupOptionsGroup)(\"freecen\", 6, 6);\n(0,_base_core_options_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerSubheadingForOptions)(\"search\", \"freecen\", \"parameters\", \"Search Parameters\");\n(0,_base_core_options_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerOptionsGroup)(searchOptionsGroup);\n\n(0,_base_core_options_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerSubsectionForOptions)(\"citation\", \"freecen\", \"FreeCen (UK)\");\n(0,_base_core_options_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerOptionsGroup)(citationOptionsGroup);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9leHRlbnNpb24vc2l0ZS9mcmVlY2VuL2NvcmUvZnJlZWNlbl9vcHRpb25zLm1qcy5qcyIsIm1hcHBpbmdzIjoiOztBQUFBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFPeUQ7O0FBRXpEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVLG9EQUFvRDtBQUM5RCxVQUFVLDBEQUEwRDtBQUNwRSxVQUFVLHlDQUF5QztBQUNuRCxVQUFVLGlDQUFpQztBQUMzQyxVQUFVLGlDQUFpQztBQUMzQyxVQUFVLG1DQUFtQztBQUM3QztBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVLG9EQUFvRDtBQUM5RCxVQUFVLDBEQUEwRDtBQUNwRSxVQUFVLHlDQUF5QztBQUNuRCxVQUFVLGlDQUFpQztBQUMzQyxVQUFVLGlDQUFpQztBQUMzQyxVQUFVLG1DQUFtQztBQUM3QztBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVLDRDQUE0QztBQUN0RDtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1QsVUFBVSxtREFBbUQ7QUFDN0QsVUFBVSxxREFBcUQ7QUFDL0Q7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTs7QUFFQSxxR0FBNEI7QUFDNUIsNEdBQW1DO0FBQ25DLHFHQUE0QjtBQUM1Qiw2RkFBb0I7O0FBRXBCLHFHQUE0QjtBQUM1Qiw2RkFBb0IiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9DaXRhdGlvbkV4dHJhY3Rvci8uL2V4dGVuc2lvbi9zaXRlL2ZyZWVjZW4vY29yZS9mcmVlY2VuX29wdGlvbnMubWpzPzQ5NDgiXSwic291cmNlc0NvbnRlbnQiOlsiLypcbk1JVCBMaWNlbnNlXG5cbkNvcHlyaWdodCAoYykgMjAyMCBSb2JlcnQgTSBQYXZleVxuXG5QZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYSBjb3B5XG5vZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSBcIlNvZnR3YXJlXCIpLCB0byBkZWFsXG5pbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzXG50byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsXG5jb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXNcbmZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6XG5cblRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkIGluIGFsbFxuY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS5cblxuVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEIFwiQVMgSVNcIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUlxuSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksXG5GSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEVcbkFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVJcbkxJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sXG5PVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOIFRIRVxuU09GVFdBUkUuXG4qL1xuXG5pbXBvcnQge1xuICByZWdpc3RlclN1YnNlY3Rpb25Gb3JPcHRpb25zLFxuICByZWdpc3RlclN1YmhlYWRpbmdGb3JPcHRpb25zLFxuICByZWdpc3Rlck9wdGlvbnNHcm91cCxcbiAgcmVnaXN0ZXJTaXRlU2VhcmNoUG9wdXBPcHRpb25zR3JvdXAsXG59IGZyb20gXCIuLi8uLi8uLi9iYXNlL2NvcmUvb3B0aW9ucy9vcHRpb25zX3JlZ2lzdHJ5Lm1qc1wiO1xuXG5jb25zdCBzZWFyY2hPcHRpb25zR3JvdXAgPSB7XG4gIGNhdGVnb3J5OiBcInNlYXJjaFwiLFxuICBzdWJjYXRlZ29yeTogXCJmcmVlY2VuXCIsXG4gIHRhYjogXCJzZWFyY2hcIixcbiAgc3Vic2VjdGlvbjogXCJmcmVlY2VuXCIsXG4gIHN1YmhlYWRpbmc6IFwicGFyYW1ldGVyc1wiLFxuICBvcHRpb25zOiBbXG4gICAge1xuICAgICAgb3B0aW9uTmFtZTogXCJmdXp6eUluRGVmYXVsdFwiLFxuICAgICAgdHlwZTogXCJjaGVja2JveFwiLFxuICAgICAgbGFiZWw6IFwiVXNlIE5hbWUgU291bmRleCAod2hlbiBub3Qgc2VhcmNoaW5nIHNhbWUgY29sbGVjdGlvbilcIixcbiAgICAgIGRlZmF1bHRWYWx1ZTogdHJ1ZSxcbiAgICB9LFxuICAgIHtcbiAgICAgIG9wdGlvbk5hbWU6IFwiZnV6enlJblNhbWVDb2xsZWN0aW9uXCIsXG4gICAgICB0eXBlOiBcImNoZWNrYm94XCIsXG4gICAgICBsYWJlbDogXCJVc2UgTmFtZSBTb3VuZGV4ICh3aGVuIHNlYXJjaGluZyBzYW1lIGNvbGxlY3Rpb24pXCIsXG4gICAgICBkZWZhdWx0VmFsdWU6IHRydWUsXG4gICAgfSxcbiAgICB7XG4gICAgICBvcHRpb25OYW1lOiBcImJpcnRoWWVhclJhbmdlRGVmYXVsdFwiLFxuICAgICAgdHlwZTogXCJzZWxlY3RcIixcbiAgICAgIGxhYmVsOiBcIlNlYXJjaCByYW5nZSB0byB1c2UgZm9yIGJpcnRoIHllYXIgKHdoZW4gbm90IHNlYXJjaGluZyBzYW1lIGNvbGxlY3Rpb24pXCIsXG4gICAgICB2YWx1ZXM6IFtcbiAgICAgICAgeyB2YWx1ZTogXCJub25lXCIsIHRleHQ6IFwiRG8gbm90IHNwZWNpZnkgYSBiaXJ0aCB5ZWFyXCIgfSxcbiAgICAgICAgeyB2YWx1ZTogXCJhdXRvXCIsIHRleHQ6IFwiU2V0IGF1dG9tYXRpY2FsbHkgYmFzZWQgb24gc291cmNlXCIgfSxcbiAgICAgICAgeyB2YWx1ZTogXCJleGFjdFwiLCB0ZXh0OiBcIkV4YWN0IHllYXIgb25seVwiIH0sXG4gICAgICAgIHsgdmFsdWU6IFwiMlwiLCB0ZXh0OiBcIisvLSAyIHllYXJzXCIgfSxcbiAgICAgICAgeyB2YWx1ZTogXCI1XCIsIHRleHQ6IFwiKy8tIDUgeWVhcnNcIiB9LFxuICAgICAgICB7IHZhbHVlOiBcIjEwXCIsIHRleHQ6IFwiKy8tIDEwIHllYXJzXCIgfSxcbiAgICAgIF0sXG4gICAgICBkZWZhdWx0VmFsdWU6IFwiYXV0b1wiLFxuICAgIH0sXG4gICAge1xuICAgICAgb3B0aW9uTmFtZTogXCJiaXJ0aFllYXJSYW5nZVNhbWVDb2xsZWN0aW9uXCIsXG4gICAgICB0eXBlOiBcInNlbGVjdFwiLFxuICAgICAgbGFiZWw6IFwiU2VhcmNoIHJhbmdlIHRvIHVzZSBmb3IgYmlydGggeWVhciAod2hlbiBzZWFyY2hpbmcgc2FtZSBjb2xsZWN0aW9uKVwiLFxuICAgICAgdmFsdWVzOiBbXG4gICAgICAgIHsgdmFsdWU6IFwibm9uZVwiLCB0ZXh0OiBcIkRvIG5vdCBzcGVjaWZ5IGEgYmlydGggeWVhclwiIH0sXG4gICAgICAgIHsgdmFsdWU6IFwiYXV0b1wiLCB0ZXh0OiBcIlNldCBhdXRvbWF0aWNhbGx5IGJhc2VkIG9uIHNvdXJjZVwiIH0sXG4gICAgICAgIHsgdmFsdWU6IFwiZXhhY3RcIiwgdGV4dDogXCJFeGFjdCB5ZWFyIG9ubHlcIiB9LFxuICAgICAgICB7IHZhbHVlOiBcIjJcIiwgdGV4dDogXCIrLy0gMiB5ZWFyc1wiIH0sXG4gICAgICAgIHsgdmFsdWU6IFwiNVwiLCB0ZXh0OiBcIisvLSA1IHllYXJzXCIgfSxcbiAgICAgICAgeyB2YWx1ZTogXCIxMFwiLCB0ZXh0OiBcIisvLSAxMCB5ZWFyc1wiIH0sXG4gICAgICBdLFxuICAgICAgZGVmYXVsdFZhbHVlOiBcImV4YWN0XCIsXG4gICAgfSxcbiAgICB7XG4gICAgICBvcHRpb25OYW1lOiBcImluY2x1ZGVCaXJ0aENvdW50eVwiLFxuICAgICAgdHlwZTogXCJjaGVja2JveFwiLFxuICAgICAgbGFiZWw6IFwiSW5jbHVkZSBiaXJ0aCBjb3VudHkgaW4gc2VhcmNoIChpZiBrbm93bilcIixcbiAgICAgIGRlZmF1bHRWYWx1ZTogdHJ1ZSxcbiAgICB9LFxuICAgIHtcbiAgICAgIG9wdGlvbk5hbWU6IFwiaW5jbHVkZUNlbnN1c0NvdW50eVwiLFxuICAgICAgdHlwZTogXCJjaGVja2JveFwiLFxuICAgICAgbGFiZWw6IFwiSW5jbHVkZSBjZW5zdXMgY291bnR5IHdoZW4gc2VhcmNoaW5nIHNhbWUgY29sbGVjdGlvbiAoaWYga25vd24pXCIsXG4gICAgICBkZWZhdWx0VmFsdWU6IHRydWUsXG4gICAgfSxcbiAgXSxcbn07XG5cbmNvbnN0IGNpdGF0aW9uT3B0aW9uc0dyb3VwID0ge1xuICBjYXRlZ29yeTogXCJjaXRhdGlvblwiLFxuICBzdWJjYXRlZ29yeTogXCJmcmVlY2VuXCIsXG4gIHRhYjogXCJjaXRhdGlvblwiLFxuICBzdWJzZWN0aW9uOiBcImZyZWVjZW5cIixcbiAgb3B0aW9uczogW1xuICAgIHtcbiAgICAgIG9wdGlvbk5hbWU6IFwiZGF0YVN0eWxlXCIsXG4gICAgICB0eXBlOiBcInNlbGVjdFwiLFxuICAgICAgbGFiZWw6IFwiSW5jbHVkZSByZWNvcmQgZGF0YSBhdCBlbmQgb2YgY2l0YXRpb24gYXNcIixcbiAgICAgIHZhbHVlczogW1xuICAgICAgICB7IHZhbHVlOiBcIm5vbmVcIiwgdGV4dDogXCJEbyBub3QgaW5jbHVkZSBkYXRhXCIgfSxcbiAgICAgICAge1xuICAgICAgICAgIHZhbHVlOiBcInN0cmluZ1wiLFxuICAgICAgICAgIHRleHQ6IFwiU2VudGVuY2UgKGZhbGwgYmFjayB0byBsaXN0IGlmIG5vIHNlbnRlbmNlKVwiLFxuICAgICAgICB9LFxuICAgICAgICB7IHZhbHVlOiBcImxpc3RcIiwgdGV4dDogXCJMaXN0IG9mIGZpZWxkIG5hbWVzL3ZhbHVlc1wiIH0sXG4gICAgICAgIHsgdmFsdWU6IFwidGFibGVcIiwgdGV4dDogXCJUYWJsZSBvZiBmaWVsZCBuYW1lcy92YWx1ZXNcIiB9LFxuICAgICAgXSxcbiAgICAgIGRlZmF1bHRWYWx1ZTogXCJzdHJpbmdcIixcbiAgICAgIHVuaXRUZXN0VmFsdWU6IFwidGFibGVcIixcbiAgICB9LFxuICAgIHtcbiAgICAgIG9wdGlvbk5hbWU6IFwiaW5jbHVkZU5hdGlvbmFsQXJjaGl2ZXNMaW5rXCIsXG4gICAgICB0eXBlOiBcImNoZWNrYm94XCIsXG4gICAgICBsYWJlbDogXCJJbmNsdWRlIGEgbGluayB0byB0byB0aGUgTmF0aW9uYWwgQXJjaGl2ZXMgcGFnZSBmb3IgdGhlIGNlbnN1cyBpZiBrbm93blwiLFxuICAgICAgZGVmYXVsdFZhbHVlOiB0cnVlLFxuICAgIH0sXG4gIF0sXG59O1xuXG5yZWdpc3RlclN1YnNlY3Rpb25Gb3JPcHRpb25zKFwic2VhcmNoXCIsIFwiZnJlZWNlblwiLCBcIkZyZWVDZW4gKFVLKVwiKTtcbnJlZ2lzdGVyU2l0ZVNlYXJjaFBvcHVwT3B0aW9uc0dyb3VwKFwiZnJlZWNlblwiLCA2LCA2KTtcbnJlZ2lzdGVyU3ViaGVhZGluZ0Zvck9wdGlvbnMoXCJzZWFyY2hcIiwgXCJmcmVlY2VuXCIsIFwicGFyYW1ldGVyc1wiLCBcIlNlYXJjaCBQYXJhbWV0ZXJzXCIpO1xucmVnaXN0ZXJPcHRpb25zR3JvdXAoc2VhcmNoT3B0aW9uc0dyb3VwKTtcblxucmVnaXN0ZXJTdWJzZWN0aW9uRm9yT3B0aW9ucyhcImNpdGF0aW9uXCIsIFwiZnJlZWNlblwiLCBcIkZyZWVDZW4gKFVLKVwiKTtcbnJlZ2lzdGVyT3B0aW9uc0dyb3VwKGNpdGF0aW9uT3B0aW9uc0dyb3VwKTtcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./extension/site/freecen/core/freecen_options.mjs\n");

/***/ }),

/***/ "./extension/site/freereg/core/freereg_options.mjs":
/*!*********************************************************!*\
  !*** ./extension/site/freereg/core/freereg_options.mjs ***!
  \*********************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _base_core_options_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../base/core/options/options_registry.mjs */ \"./extension/base/core/options/options_registry.mjs\");\n/*\nMIT License\n\nCopyright (c) 2020 Robert M Pavey\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.\n*/\n\n\n\nconst searchOptionsGroup = {\n  category: \"search\",\n  subcategory: \"freereg\",\n  tab: \"search\",\n  subsection: \"freereg\",\n  subheading: \"parameters\",\n  options: [\n    {\n      optionName: \"fuzzy\",\n      type: \"checkbox\",\n      label: \"Use Name Soundex\",\n      defaultValue: true,\n    },\n    {\n      optionName: \"yearRange\",\n      type: \"select\",\n      label: \"Search range to use for event year\",\n      values: [\n        { value: \"none\", text: \"Do not specify a year\" },\n        { value: \"auto\", text: \"Set automatically based on source\" },\n        { value: \"exact\", text: \"Exact year only\" },\n        { value: \"2\", text: \"+/- 2 years\" },\n        { value: \"5\", text: \"+/- 5 years\" },\n        { value: \"10\", text: \"+/- 10 years\" },\n      ],\n      defaultValue: \"auto\",\n    },\n    {\n      optionName: \"includeCounty\",\n      type: \"checkbox\",\n      label: \"Include county in search (if known)\",\n      defaultValue: true,\n    },\n  ],\n};\n\nconst citationOptionsGroup = {\n  category: \"citation\",\n  subcategory: \"freereg\",\n  tab: \"citation\",\n  subsection: \"freereg\",\n  options: [\n    {\n      optionName: \"dataStyle\",\n      type: \"select\",\n      label: \"Include record data at end of citation as\",\n      values: [\n        { value: \"none\", text: \"Do not include data\" },\n        {\n          value: \"string\",\n          text: \"Sentence (fall back to list if no sentence)\",\n        },\n        { value: \"list\", text: \"List of field names/values\" },\n        { value: \"table\", text: \"Table of field names/values\" },\n      ],\n      defaultValue: \"string\",\n      unitTestValue: \"table\",\n    },\n  ],\n};\n\n(0,_base_core_options_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerSubsectionForOptions)(\"search\", \"freereg\", \"FreeReg (UK)\");\n(0,_base_core_options_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerSiteSearchPopupOptionsGroup)(\"freereg\", 8, 8);\n(0,_base_core_options_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerSubheadingForOptions)(\"search\", \"freereg\", \"parameters\", \"Search Parameters\");\n(0,_base_core_options_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerOptionsGroup)(searchOptionsGroup);\n\n(0,_base_core_options_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerSubsectionForOptions)(\"citation\", \"freereg\", \"FreeReg (UK)\");\n(0,_base_core_options_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerOptionsGroup)(citationOptionsGroup);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9leHRlbnNpb24vc2l0ZS9mcmVlcmVnL2NvcmUvZnJlZXJlZ19vcHRpb25zLm1qcy5qcyIsIm1hcHBpbmdzIjoiOztBQUFBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFPeUQ7O0FBRXpEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVSw4Q0FBOEM7QUFDeEQsVUFBVSwwREFBMEQ7QUFDcEUsVUFBVSx5Q0FBeUM7QUFDbkQsVUFBVSxpQ0FBaUM7QUFDM0MsVUFBVSxpQ0FBaUM7QUFDM0MsVUFBVSxtQ0FBbUM7QUFDN0M7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVUsNENBQTRDO0FBQ3REO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVCxVQUFVLG1EQUFtRDtBQUM3RCxVQUFVLHFEQUFxRDtBQUMvRDtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTs7QUFFQSxxR0FBNEI7QUFDNUIsNEdBQW1DO0FBQ25DLHFHQUE0QjtBQUM1Qiw2RkFBb0I7O0FBRXBCLHFHQUE0QjtBQUM1Qiw2RkFBb0IiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9DaXRhdGlvbkV4dHJhY3Rvci8uL2V4dGVuc2lvbi9zaXRlL2ZyZWVyZWcvY29yZS9mcmVlcmVnX29wdGlvbnMubWpzP2ZjZGQiXSwic291cmNlc0NvbnRlbnQiOlsiLypcbk1JVCBMaWNlbnNlXG5cbkNvcHlyaWdodCAoYykgMjAyMCBSb2JlcnQgTSBQYXZleVxuXG5QZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYSBjb3B5XG5vZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSBcIlNvZnR3YXJlXCIpLCB0byBkZWFsXG5pbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzXG50byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsXG5jb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXNcbmZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6XG5cblRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkIGluIGFsbFxuY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS5cblxuVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEIFwiQVMgSVNcIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUlxuSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksXG5GSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEVcbkFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVJcbkxJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sXG5PVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOIFRIRVxuU09GVFdBUkUuXG4qL1xuXG5pbXBvcnQge1xuICByZWdpc3RlclN1YnNlY3Rpb25Gb3JPcHRpb25zLFxuICByZWdpc3RlclN1YmhlYWRpbmdGb3JPcHRpb25zLFxuICByZWdpc3Rlck9wdGlvbnNHcm91cCxcbiAgcmVnaXN0ZXJTaXRlU2VhcmNoUG9wdXBPcHRpb25zR3JvdXAsXG59IGZyb20gXCIuLi8uLi8uLi9iYXNlL2NvcmUvb3B0aW9ucy9vcHRpb25zX3JlZ2lzdHJ5Lm1qc1wiO1xuXG5jb25zdCBzZWFyY2hPcHRpb25zR3JvdXAgPSB7XG4gIGNhdGVnb3J5OiBcInNlYXJjaFwiLFxuICBzdWJjYXRlZ29yeTogXCJmcmVlcmVnXCIsXG4gIHRhYjogXCJzZWFyY2hcIixcbiAgc3Vic2VjdGlvbjogXCJmcmVlcmVnXCIsXG4gIHN1YmhlYWRpbmc6IFwicGFyYW1ldGVyc1wiLFxuICBvcHRpb25zOiBbXG4gICAge1xuICAgICAgb3B0aW9uTmFtZTogXCJmdXp6eVwiLFxuICAgICAgdHlwZTogXCJjaGVja2JveFwiLFxuICAgICAgbGFiZWw6IFwiVXNlIE5hbWUgU291bmRleFwiLFxuICAgICAgZGVmYXVsdFZhbHVlOiB0cnVlLFxuICAgIH0sXG4gICAge1xuICAgICAgb3B0aW9uTmFtZTogXCJ5ZWFyUmFuZ2VcIixcbiAgICAgIHR5cGU6IFwic2VsZWN0XCIsXG4gICAgICBsYWJlbDogXCJTZWFyY2ggcmFuZ2UgdG8gdXNlIGZvciBldmVudCB5ZWFyXCIsXG4gICAgICB2YWx1ZXM6IFtcbiAgICAgICAgeyB2YWx1ZTogXCJub25lXCIsIHRleHQ6IFwiRG8gbm90IHNwZWNpZnkgYSB5ZWFyXCIgfSxcbiAgICAgICAgeyB2YWx1ZTogXCJhdXRvXCIsIHRleHQ6IFwiU2V0IGF1dG9tYXRpY2FsbHkgYmFzZWQgb24gc291cmNlXCIgfSxcbiAgICAgICAgeyB2YWx1ZTogXCJleGFjdFwiLCB0ZXh0OiBcIkV4YWN0IHllYXIgb25seVwiIH0sXG4gICAgICAgIHsgdmFsdWU6IFwiMlwiLCB0ZXh0OiBcIisvLSAyIHllYXJzXCIgfSxcbiAgICAgICAgeyB2YWx1ZTogXCI1XCIsIHRleHQ6IFwiKy8tIDUgeWVhcnNcIiB9LFxuICAgICAgICB7IHZhbHVlOiBcIjEwXCIsIHRleHQ6IFwiKy8tIDEwIHllYXJzXCIgfSxcbiAgICAgIF0sXG4gICAgICBkZWZhdWx0VmFsdWU6IFwiYXV0b1wiLFxuICAgIH0sXG4gICAge1xuICAgICAgb3B0aW9uTmFtZTogXCJpbmNsdWRlQ291bnR5XCIsXG4gICAgICB0eXBlOiBcImNoZWNrYm94XCIsXG4gICAgICBsYWJlbDogXCJJbmNsdWRlIGNvdW50eSBpbiBzZWFyY2ggKGlmIGtub3duKVwiLFxuICAgICAgZGVmYXVsdFZhbHVlOiB0cnVlLFxuICAgIH0sXG4gIF0sXG59O1xuXG5jb25zdCBjaXRhdGlvbk9wdGlvbnNHcm91cCA9IHtcbiAgY2F0ZWdvcnk6IFwiY2l0YXRpb25cIixcbiAgc3ViY2F0ZWdvcnk6IFwiZnJlZXJlZ1wiLFxuICB0YWI6IFwiY2l0YXRpb25cIixcbiAgc3Vic2VjdGlvbjogXCJmcmVlcmVnXCIsXG4gIG9wdGlvbnM6IFtcbiAgICB7XG4gICAgICBvcHRpb25OYW1lOiBcImRhdGFTdHlsZVwiLFxuICAgICAgdHlwZTogXCJzZWxlY3RcIixcbiAgICAgIGxhYmVsOiBcIkluY2x1ZGUgcmVjb3JkIGRhdGEgYXQgZW5kIG9mIGNpdGF0aW9uIGFzXCIsXG4gICAgICB2YWx1ZXM6IFtcbiAgICAgICAgeyB2YWx1ZTogXCJub25lXCIsIHRleHQ6IFwiRG8gbm90IGluY2x1ZGUgZGF0YVwiIH0sXG4gICAgICAgIHtcbiAgICAgICAgICB2YWx1ZTogXCJzdHJpbmdcIixcbiAgICAgICAgICB0ZXh0OiBcIlNlbnRlbmNlIChmYWxsIGJhY2sgdG8gbGlzdCBpZiBubyBzZW50ZW5jZSlcIixcbiAgICAgICAgfSxcbiAgICAgICAgeyB2YWx1ZTogXCJsaXN0XCIsIHRleHQ6IFwiTGlzdCBvZiBmaWVsZCBuYW1lcy92YWx1ZXNcIiB9LFxuICAgICAgICB7IHZhbHVlOiBcInRhYmxlXCIsIHRleHQ6IFwiVGFibGUgb2YgZmllbGQgbmFtZXMvdmFsdWVzXCIgfSxcbiAgICAgIF0sXG4gICAgICBkZWZhdWx0VmFsdWU6IFwic3RyaW5nXCIsXG4gICAgICB1bml0VGVzdFZhbHVlOiBcInRhYmxlXCIsXG4gICAgfSxcbiAgXSxcbn07XG5cbnJlZ2lzdGVyU3Vic2VjdGlvbkZvck9wdGlvbnMoXCJzZWFyY2hcIiwgXCJmcmVlcmVnXCIsIFwiRnJlZVJlZyAoVUspXCIpO1xucmVnaXN0ZXJTaXRlU2VhcmNoUG9wdXBPcHRpb25zR3JvdXAoXCJmcmVlcmVnXCIsIDgsIDgpO1xucmVnaXN0ZXJTdWJoZWFkaW5nRm9yT3B0aW9ucyhcInNlYXJjaFwiLCBcImZyZWVyZWdcIiwgXCJwYXJhbWV0ZXJzXCIsIFwiU2VhcmNoIFBhcmFtZXRlcnNcIik7XG5yZWdpc3Rlck9wdGlvbnNHcm91cChzZWFyY2hPcHRpb25zR3JvdXApO1xuXG5yZWdpc3RlclN1YnNlY3Rpb25Gb3JPcHRpb25zKFwiY2l0YXRpb25cIiwgXCJmcmVlcmVnXCIsIFwiRnJlZVJlZyAoVUspXCIpO1xucmVnaXN0ZXJPcHRpb25zR3JvdXAoY2l0YXRpb25PcHRpb25zR3JvdXApO1xuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./extension/site/freereg/core/freereg_options.mjs\n");

/***/ }),

/***/ "./extension/site/fs/core/fs_build_citation.mjs":
/*!******************************************************!*\
  !*** ./extension/site/fs/core/fs_build_citation.mjs ***!
  \******************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"buildCitation\": () => (/* binding */ buildCitation)\n/* harmony export */ });\n/* harmony import */ var _base_core_citation_builder_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../base/core/citation_builder.mjs */ \"./extension/base/core/citation_builder.mjs\");\n/* harmony import */ var _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../base/core/record_type.mjs */ \"./extension/base/core/record_type.mjs\");\n/* harmony import */ var _base_core_data_string_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../base/core/data_string.mjs */ \"./extension/base/core/data_string.mjs\");\n/*\nMIT License\n\nCopyright (c) 2020 Robert M Pavey\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.\n*/\n\n\n\n\n\nfunction buildFsCitationDataString(data) {\n  if (data.citation) {\n    // citation string looks like this (for example):\n    /*\n    \"England and Wales Census, 1841,\" database with images,\n    <i>FamilySearch</i> (https://familysearch.org/ark:/61903/1:1:MQTV-YB9 : 23 May 2019),\n    Isabella Pavey in household of William Pavey, East Stonehouse, Devon, England, United Kingdom;\n    from \"1841 England, Scotland and Wales census,\" database and images,\n    <i>findmypast</i> (http://www.findmypast.com : n.d.);\n    citing PRO HO 107, The National Archives, Kew, Surrey.\n    */\n    // find the middle part like:\n    // \"Isabella Pavey in household of William Pavey, East Stonehouse, Devon, England, United Kingdom\"\n\n    let dataString = data.citation.replace(/^.*\\<i\\>FamilySearch\\<\\/i\\>\\s+\\([^\\)]+\\)\\,\\s*([^\\;]+).*$/, \"$1\");\n    if (dataString && dataString != data.citation) {\n      // Sometimes there are commas with no space after them, fix that.\n      dataString = dataString.replace(/\\,(\\w)/g, \", $1\");\n      return dataString;\n    }\n  }\n\n  return \"\";\n}\n\nfunction removeUnwantedKeysForTable(keys, recordData) {\n  // for the moment they are the same\n  return removeUnwantedKeysForDataString(keys, recordData);\n}\n\nfunction removeUnwantedKeysForDataString(keys, recordData) {\n  const exactMatchesToExclude = [\n    \"Page\",\n    \"Page number\",\n    \"Folio\",\n    \"Piece number\",\n    \"Schedule\",\n    \"Rolls\",\n\n    \"Unique Identifier\",\n    \"Source Volume\",\n    \"Source Page\",\n    \"Event Place Level1Type\",\n    \"Event Place Level2Type\",\n    \"Event Place Level3Type\",\n    \"Evquarter\",\n    \"Ppq Id\",\n    \"Record Group\",\n    \"Sort Key\",\n  ];\n  function isKeyWanted(key) {\n    for (let match of exactMatchesToExclude) {\n      if (match == key) {\n        return false;\n      }\n    }\n\n    // if there is a year plus a date for the same thing exclude the year\n    const yearEnding = \" year\";\n    if (key.endsWith(yearEnding)) {\n      let dateKey = key.substring(0, key.length - yearEnding.length) + \" date\";\n      if (keys.includes(dateKey)) {\n        return false;\n      }\n    }\n\n    return true;\n  }\n\n  let newKeys = [];\n\n  for (let key of keys) {\n    if (isKeyWanted(key)) {\n      newKeys.push(key);\n    }\n  }\n\n  return newKeys;\n}\n\nfunction buildDataString(data, gd, dataStyle, builder) {\n  let options = builder.options;\n\n  let dataString = \"\";\n\n  if (dataStyle == \"string\") {\n    let input = {\n      generalizedData: gd,\n      options: options,\n    };\n    dataString = _base_core_data_string_mjs__WEBPACK_IMPORTED_MODULE_2__.DataString.buildDataString(input);\n    if (dataString) {\n      return dataString;\n    }\n  } else if (dataStyle == \"fsCitation\") {\n    let dataString = buildFsCitationDataString(data);\n    if (dataString) {\n      return dataString;\n    }\n\n    // if no citation on the FS page fallback to string formst\n    let input = {\n      generalizedData: gd,\n      options: options,\n    };\n    dataString = _base_core_data_string_mjs__WEBPACK_IMPORTED_MODULE_2__.DataString.buildDataString(input);\n    if (dataString) {\n      return dataString;\n    }\n\n    if (data.sourceTitleForPerson) {\n      let dataString = data.sourceTitleForPerson.replace(/^([^\\,]*)\\,.*$/, \"$1\");\n      return dataString;\n    }\n\n    if (data.fullName && data.eventDate) {\n      let dataString = data.fullName + \" \" + data.eventDate;\n      return dataString;\n    }\n  }\n\n  let recordData = data.recordData;\n\n  dataString = \"\";\n\n  // I don't think this will ever happen\n  if (!recordData) {\n    let date = gd.inferEventDate();\n    let place = gd.inferEventPlace();\n    dataString = date;\n    if (place) {\n      if (date) {\n        dataString += \", \";\n      }\n      dataString += place;\n    }\n    return dataString;\n  }\n\n  dataString = builder.buildDataList(recordData, removeUnwantedKeysForDataString);\n\n  return dataString;\n}\n\nfunction getAdditionalInfo(data, gd, builder) {\n  let citationType = builder.type;\n  let options = builder.options;\n\n  let dataStyle = options.citation_fs_dataStyle;\n  if (dataStyle == \"none\") {\n    return \"\";\n  } else if (dataStyle == \"table\") {\n    if (options.citation_general_referencePosition == \"atEnd\") {\n      dataStyle = \"string\";\n    } else if (citationType == \"source\") {\n      dataStyle = \"list\";\n    }\n  }\n\n  if (dataStyle == \"string\" || dataStyle == \"list\" || dataStyle == \"fsCitation\") {\n    return buildDataString(data, gd, dataStyle, builder);\n  }\n\n  // style must be table\n  var result = \"\";\n  let recordData = data.recordData;\n  if (recordData) {\n    let keys = Object.keys(recordData);\n\n    keys = removeUnwantedKeysForTable(keys, recordData);\n    if (keys.length > 0) {\n      // start table\n      result = '{| border=\"1\"\\n';\n      let firstRow = true;\n\n      for (let key of keys) {\n        if (firstRow) {\n          firstRow = false;\n        } else {\n          result += \"|-\\n\";\n        }\n        result += \"| \" + key + \" || \" + recordData[key] + \"\\n\";\n      }\n\n      result += \"|}\";\n    }\n  }\n\n  return result;\n}\n\nfunction buildSourceReferenceFromRecord(data, gd, options) {\n  let dataString = \"\";\n\n  function addValue(title, value) {\n    if (value) {\n      if (dataString != \"\") {\n        dataString += \" \";\n      }\n      dataString += title + \": \" + value + \";\";\n    }\n  }\n\n  function addRecordDataValue(title, keyArray) {\n    let value = undefined;\n    if (data.recordData) {\n      for (let key of keyArray) {\n        value = data.recordData[key];\n        if (value) {\n          break;\n        }\n      }\n    }\n    if (value) {\n      if (dataString != \"\") {\n        dataString += \" \";\n      }\n      dataString += title + \": \" + value + \";\";\n    }\n  }\n\n  let refData = data.referenceData;\n\n  if (gd.isRecordInCountry(\"United Kingdom\")) {\n    if (gd.recordType == _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_1__.RT.Census && data.collectionTitle.startsWith(\"England and Wales Census\")) {\n      // The Ancestry reference would look like:\n      // Class: HO107; Piece: 276; Book: 6; Civil Parish: East Stonehouse; County: Devon; Enumeration District: 6; Folio: 21; Page: 37; Line: 20; GSU roll: 241335<br/>\n\n      dataString += \"The National Archives of the UK\";\n      if (refData) {\n        addValue(\"Class\", refData.sourceRegNbr);\n        addValue(\"Piece/Folio\", refData.sourcePieceFolio);\n        addValue(\"Page\", refData.sourcePageNbr);\n        addValue(\"Line\", refData.sourceLineNbr);\n      }\n    } else if (\n      gd.recordType == _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_1__.RT.BirthRegistration ||\n      gd.recordType == _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_1__.RT.DeathRegistration ||\n      gd.recordType == _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_1__.RT.MarriageRegistration\n    ) {\n      // FS citation would say:\n      // Citing 1937, quarter 2, vol. 9D, p. 519, Hull, Yorkshire, England, General Register Office, Southport, England.\n\n      dataString += \"UK General Register Office.\";\n      addValue(\"District\", data.registrationDistrict);\n      if (refData) {\n        addValue(\"Volume\", refData.sourceVolume);\n        addValue(\"Page\", refData.sourcePageNbr);\n        // there can be a line number but we don't want that as it is line num on FMP printout\n        addValue(\"Entry\", refData.sourceEntryNbr);\n      }\n    }\n\n    if (dataString) {\n      dataString = \"citing \" + dataString;\n    }\n    return dataString;\n  }\n\n  // not a special case, just add everything that could be part of reference\n  addValue(\"District\", data.registrationDistrict);\n  if (refData) {\n    addValue(\"Volume\", refData.sourceVolume);\n    addValue(\"Piece/Folio\", refData.sourcePieceFolio);\n    addValue(\"Page\", refData.sourcePageNbr);\n\n    addValue(\"Affiliate Publication Title\", refData.externalPublicationTitle);\n    addValue(\"Affiliate Publication Number\", refData.externalPublicationNumber);\n    addValue(\"Affiliate Film Number\", refData.externalFilmNumber);\n\n    if (refData.sourceLineNbr) {\n      addValue(\"Line\", refData.sourceLineNbr);\n    } else {\n      addValue(\"Affiliate Line Number\", refData.externalLineNumber);\n    }\n    addValue(\"Entry\", refData.sourceEntryNbr);\n\n    addValue(\"Reference\", refData.referenceId);\n    addValue(\"FHL microfilm\", refData.filmNumber);\n    addValue(\"Record number\", refData.recordNumber);\n  }\n\n  if (dataString) {\n    dataString = \"citing \" + dataString;\n  }\n  return dataString;\n}\n\nfunction buildSourceReferenceFromFsCitation(data, options) {\n  if (data.citation) {\n    // citation string looks like this (for example):\n    /*\n    \"England and Wales Census, 1841,\" database with images,\n    <i>FamilySearch</i> (https://familysearch.org/ark:/61903/1:1:MQTV-YB9 : 23 May 2019),\n    Isabella Pavey in household of William Pavey, East Stonehouse, Devon, England, United Kingdom;\n    from \"1841 England, Scotland and Wales census,\" database and images,\n    <i>findmypast</i> (http://www.findmypast.com : n.d.);\n    citing PRO HO 107, The National Archives, Kew, Surrey.\n    */\n    const citingString = \"citing \";\n    let citingIndex = data.citation.indexOf(citingString);\n    if (citingIndex != -1) {\n      citingIndex += citingString.length;\n\n      let refString = data.citation.substring(citingIndex);\n      const fromString = \"from \";\n\n      if (options.citation_fs_sourceRef == \"fsCitationShort\") {\n        // there can be more than one \"citing\". Sometimes that is OK, other times there is too much in\n        // the first citing string (a from)\n        citingIndex = refString.indexOf(citingString);\n        let fromIndex = refString.indexOf(fromString);\n        if (citingIndex != -1 && fromIndex != -1 && fromIndex < citingIndex) {\n          // cut out the part between the from and the second citing\n          let part1 = refString.substring(0, fromIndex).trim();\n          let part2 = refString.substring(citingIndex).trim();\n\n          part1 = part1.replace(/^(.*)[\\;\\,\\.]+$/, \"$1\"); // remove trailing punctuation\n          refString = part1 + \"; \" + part2;\n        }\n      }\n\n      if (refString) {\n        refString = \"citing \" + refString;\n      }\n\n      return refString;\n    }\n  }\n\n  return \"\";\n}\n\nfunction buildSourceReference(data, gd, options) {\n  if (options.citation_fs_sourceRef == \"fsCitationShort\" || options.citation_fs_sourceRef == \"fsCitationLong\") {\n    let refString = buildSourceReferenceFromFsCitation(data, options);\n    if (refString) {\n      return refString;\n    }\n  }\n\n  // build from record\n  return buildSourceReferenceFromRecord(data, gd, options);\n}\n\nfunction extractIdFromFsUrl(url, prefixList, terminatorList) {\n  // the recordUrl should look like:\n  // https://www.familysearch.org/ark:/61903/1:1:XZDY-NHM\n\n  for (let prefix of prefixList) {\n    let prefixIndex = url.indexOf(prefix);\n    if (prefixIndex != -1) {\n      let id = url.substring(prefixIndex + prefix.length);\n      for (let terminator of terminatorList) {\n        let terminatorIndex = id.indexOf(terminator);\n        if (terminatorIndex != -1) {\n          id = id.substring(0, terminatorIndex);\n        }\n      }\n      return id;\n    }\n  }\n\n  return \"\"; // no prefix found\n}\n\nfunction buildFsRecordLink(recordUrl) {\n  // start with the old format link and then try to replace with template\n  let recordLinkOrTemplate = \"[\" + recordUrl + \" FamilySearch\" + \"]\";\n\n  // the recordUrl should look like:\n  // https://www.familysearch.org/ark:/61903/1:1:XZDY-NHM\n  let recordId = extractIdFromFsUrl(recordUrl, [\"ark:/61903/1:1:\"], [\"/\", \"?\"]);\n\n  if (recordId.length > 5) {\n    recordLinkOrTemplate = \"{{FamilySearch Record|\" + recordId + \"}}\";\n  }\n\n  return recordLinkOrTemplate;\n}\n\nfunction buildFsImageLink(imageUrl) {\n  // start with the old format link and then try to replace with template\n  let imageLinkOrTemplate = \"[\" + imageUrl + \" FamilySearch Image]\";\n\n  // the recordUrl should look like one of these:\n  // https://www.familysearch.org/ark:/61903/3:1:33S7-9BSH-9W9B?i=7&cc=1473181\n  // https://www.familysearch.org/ark:/61903/3:1:33S7-9P2P-9D2F?i=1179&cc=1307272&personaUrl=%2Fark%3A%2F61903%2F1%3A1%3AXZDY-NHM\n  let imageId = extractIdFromFsUrl(imageUrl, [\"ark:/61903/3:1:\"], [\"/\", \"?\"]);\n\n  if (imageId.length > 5) {\n    imageLinkOrTemplate = \"{{FamilySearch Image|\" + imageId + \"}}\";\n  }\n\n  return imageLinkOrTemplate;\n}\n\nfunction buildCoreCitation(data, gd, builder) {\n  builder.sourceTitle = data.collectionTitle;\n\n  var recordUrl = data.personRecordUrl;\n\n  if ((data.fsImageUrl || data.externalImageUrl) && data.externalImageUrl != \"bad\") {\n    let text = \"\";\n    if (data.externalImageUrl) {\n      if (builder.options.citation_fs_includeExternalImageLink) {\n        if (data.externalImageUrl.includes(\"findmypast\")) {\n          text += \"[\" + data.externalImageUrl + \" FindMyPast Image]\";\n          let subReqString = builder.getSubReqString(builder.options.citation_fs_subscriptionRequired);\n          if (subReqString) {\n            text += \" (\" + subReqString + \")\";\n          }\n        } else {\n          text += \"[\" + data.externalImageUrl + \" External Image]\";\n        }\n      }\n    } else {\n      builder.databaseHasImages = true;\n\n      text += buildFsImageLink(data.fsImageUrl);\n      if (data.fsImageNumber) {\n        text += \" Image number \" + data.fsImageNumber;\n      }\n    }\n    builder.externalSiteLink = text;\n  } else if (data.digitalArtifact) {\n    // Find A Grave example:   \"digitalArtifact\": \"http://www.findagrave.com/cgi-bin/fg.cgi?page=gr&GRid=30569834\",\n    let url = data.digitalArtifact;\n    const idParam = \"&GRid=\";\n    if (url.includes(\"//www.findagrave.com/cgi-bin\") && url.includes(idParam)) {\n      let paramIndex = url.indexOf(idParam);\n      if (paramIndex != -1) {\n        let nextParamIndex = url.indexOf(\"&\", paramIndex + idParam.length);\n        if (nextParamIndex == -1) {\n          nextParamIndex = url.length;\n        }\n\n        let memorialId = url.substring(paramIndex + idParam.length, nextParamIndex);\n        builder.externalSiteLink = \"{{FindAGrave|\" + memorialId + \"}}\";\n      }\n    } else {\n      builder.externalSiteLink = url;\n    }\n  }\n\n  builder.recordLinkOrTemplate = buildFsRecordLink(recordUrl);\n\n  let additionalInfo = getAdditionalInfo(data, gd, builder);\n  if (additionalInfo) {\n    builder.dataString = additionalInfo;\n  }\n\n  builder.sourceReference = buildSourceReference(data, gd, builder.options);\n}\n\nfunction getImageRefTitle(catalogRecordName, filmTitle) {\n  const catalogRecordNameTightMatches = [\n    { title: \"Marriage\", matches: [\"Marriage records\"] },\n    { title: \"Marriage Bond\", matches: [\"Marriage licence bonds\"] },\n    { title: \"Tax record\", matches: [\"Tax books\"] },\n    {\n      title: \"Personal Property Tax\",\n      matches: [\"Personal property tax lists,\"],\n    },\n    { title: \"Deed\", matches: [\"Deeds,\", \"Deed records,\"] },\n  ];\n\n  const filmTitleTightMatches = [\n    { title: \"Marriage\", matches: [\"County Marriages,\"] },\n    { title: \"Marriage Bond\", matches: [\"Marriage Bond,\"] },\n    { title: \"Deed record\", matches: [\"Deeds\"] },\n    { title: \"Land record\", matches: [\"Land Records,\"] },\n  ];\n\n  const catalogRecordNameLooseMatches = [\n    { title: \"Marriage\", matches: [\"Marriage\"] },\n    { title: \"Property Tax\", matches: [\"property tax\"] },\n    { title: \"Tax record\", matches: [\"Tax\", \"tax\"] },\n  ];\n\n  const filmTitleLooseMatches = [\n    { title: \"Marriage\", matches: [\"Marriage\"] },\n    { title: \"Tax record\", matches: [\"Tax\"] },\n    { title: \"Deed record\", matches: [\"Deed\"] },\n  ];\n\n  function lookup(title, table) {\n    for (let obj of table) {\n      if (obj.matches) {\n        for (let match of obj.matches) {\n          if (title && title.includes(match)) {\n            return obj.title;\n          }\n        }\n      }\n    }\n  }\n\n  if (catalogRecordName) {\n    let refTitle = lookup(catalogRecordName, catalogRecordNameTightMatches);\n    if (refTitle) {\n      return refTitle;\n    }\n  }\n\n  if (filmTitle) {\n    let refTitle = lookup(filmTitle, filmTitleTightMatches);\n    if (refTitle) {\n      return refTitle;\n    }\n  }\n\n  if (catalogRecordName) {\n    let refTitle = lookup(catalogRecordName, catalogRecordNameLooseMatches);\n    if (refTitle) {\n      return refTitle;\n    }\n  }\n\n  if (filmTitle) {\n    let refTitle = lookup(filmTitle, filmTitleLooseMatches);\n    if (refTitle) {\n      return refTitle;\n    }\n  }\n\n  // no matches\n  if (catalogRecordName && filmTitle) {\n    // choose the shorter one\n    return filmTitle.length < catalogRecordName.length ? filmTitle : catalogRecordName;\n  }\n  if (catalogRecordName) {\n    return catalogRecordName;\n  }\n  if (filmTitle) {\n    return filmTitle;\n  }\n\n  return \"Unclassified\";\n}\n\nfunction buildImageCitation(data, gd, builder) {\n  builder.databaseHasImages = true;\n\n  if (data.filmTitle) {\n    builder.sourceTitle = data.filmTitle;\n  } else {\n    builder.sourceTitle = data.catalogRecordName;\n  }\n\n  let imageLink = buildFsImageLink(data.url);\n  builder.recordLinkOrTemplate = imageLink;\n\n  builder.dataString = buildDataString(data, gd, builder.options.citation_fs_dataStyle, builder);\n\n  builder.sourceReference = buildSourceReference(data, gd, builder.options);\n  if (!builder.sourceReference) {\n    builder.sourceReference = \"\";\n  }\n\n  let newSourceReference = \"\";\n  if (data.catalogRecordLink && data.catalogRecordName) {\n    let linkText = data.catalogRecordName;\n    newSourceReference += \"Catalog: \";\n    newSourceReference += \"[\" + data.catalogRecordLink + \" \" + linkText + \"]\";\n\n    if (data.filmNote) {\n      let note = data.filmNote;\n      if (note.startsWith(linkText)) {\n        note = note.substring(linkText).trim();\n      }\n      newSourceReference += \" \" + note;\n    }\n  }\n\n  if (data.filmNumber || data.imageBrowsePath || data.totalImages) {\n    if (newSourceReference) {\n      if (builder.options.citation_general_addBreaksWithinBody) {\n        newSourceReference += \"<br/>\";\n      } else {\n        newSourceReference += \"; \";\n      }\n      if (builder.type != \"source\" && builder.options.citation_general_addNewlinesWithinBody) {\n        newSourceReference += \"\\n\";\n      }\n    }\n    if (data.imageBrowsePath) {\n      newSourceReference += \"Image path: \" + data.imageBrowsePath;\n    } else if (data.filmNumber) {\n      newSourceReference += \"Film number: \" + data.filmNumber;\n    }\n\n    // this is a workaround for Unit Tests. In Unit Tests the imageNumber is empty because of the\n    // way the text input works\n    if (data.totalImages) {\n      let imageNumber = data.imageNumber;\n      if (!imageNumber) {\n        imageNumber = \"?\";\n      }\n      newSourceReference += \" > image \" + imageNumber + \" of \" + data.totalImages;\n    }\n  }\n\n  if (builder.sourceReference) {\n    newSourceReference += \"; \" + builder.sourceReference;\n  }\n\n  builder.sourceReference = newSourceReference;\n\n  builder.meaningfulTitle = getImageRefTitle(data.catalogRecordName, data.filmTitle);\n}\n\nfunction getRefTitle(ed, gd) {\n  const recordTypeToRefTitle = [\n    {\n      type: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_1__.RT.Marriage,\n      defaultTitle: \"Marriage\",\n      titleMatches: [{ title: \"Marriage Bond\", matches: [\"Marriage Bond\"] }],\n    },\n    {\n      type: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_1__.RT.MilitaryService,\n      defaultTitle: \"Military Service\",\n      titleMatches: [{ title: \"Navy Allotment\", matches: [\"Navy Allotment\"] }],\n    },\n    {\n      type: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_1__.RT.ElectoralRegister,\n      defaultTitle: \"Voter Registration\",\n      addYear: true,\n      titleMatches: [{ title: \"Electoral Register\", matches: [\"Electoral Register\"] }],\n    },\n  ];\n\n  let refTitle = gd.getRefTitle(ed.collectionTitle, recordTypeToRefTitle);\n\n  if (refTitle && refTitle != \"Unclassified\") {\n    return refTitle;\n  }\n\n  return \"\";\n}\n\nfunction buildCitation(input) {\n  const data = input.extractedData;\n  const gd = input.generalizedData;\n  const runDate = input.runDate;\n  const options = input.options;\n  const type = input.type; // \"inline\", \"narrative\" or \"source\"\n\n  let builder = new _base_core_citation_builder_mjs__WEBPACK_IMPORTED_MODULE_0__.CitationBuilder(type, runDate, options);\n  builder.householdTableString = input.householdTableString;\n\n  if (data.pageType == \"record\") {\n    var citation = buildCoreCitation(data, gd, builder);\n\n    // Get meaningful title\n    let refTitle = getRefTitle(data, input.generalizedData);\n    builder.meaningfulTitle = refTitle;\n\n    if (type == \"narrative\") {\n      builder.addNarrative(gd, input.dataCache, options);\n    }\n  } else if (data.pageType == \"image\") {\n    buildImageCitation(data, gd, builder);\n  }\n\n  // now the builder is setup use it to build the citation text\n  let fullCitation = builder.getCitationString();\n\n  //console.log(fullCitation);\n\n  var citationObject = {\n    citation: fullCitation,\n    type: type,\n  };\n\n  return citationObject;\n}\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9leHRlbnNpb24vc2l0ZS9mcy9jb3JlL2ZzX2J1aWxkX2NpdGF0aW9uLm1qcy5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUUwRTtBQUNsQjtBQUNROztBQUVoRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSw4RkFBOEY7QUFDOUY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCLGtGQUEwQjtBQUMzQztBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlCQUFpQixrRkFBMEI7QUFDM0M7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7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QUFLO0FBQ0w7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQjs7QUFFM0Isb0JBQW9CLDRFQUFlO0FBQ25DOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFeUIiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9DaXRhdGlvbkV4dHJhY3Rvci8uL2V4dGVuc2lvbi9zaXRlL2ZzL2NvcmUvZnNfYnVpbGRfY2l0YXRpb24ubWpzP2ZmZTgiXSwic291cmNlc0NvbnRlbnQiOlsiLypcbk1JVCBMaWNlbnNlXG5cbkNvcHlyaWdodCAoYykgMjAyMCBSb2JlcnQgTSBQYXZleVxuXG5QZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYSBjb3B5XG5vZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSBcIlNvZnR3YXJlXCIpLCB0byBkZWFsXG5pbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzXG50byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsXG5jb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXNcbmZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6XG5cblRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkIGluIGFsbFxuY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS5cblxuVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEIFwiQVMgSVNcIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUlxuSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksXG5GSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEVcbkFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVJcbkxJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sXG5PVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOIFRIRVxuU09GVFdBUkUuXG4qL1xuXG5pbXBvcnQgeyBDaXRhdGlvbkJ1aWxkZXIgfSBmcm9tIFwiLi4vLi4vLi4vYmFzZS9jb3JlL2NpdGF0aW9uX2J1aWxkZXIubWpzXCI7XG5pbXBvcnQgeyBSVCB9IGZyb20gXCIuLi8uLi8uLi9iYXNlL2NvcmUvcmVjb3JkX3R5cGUubWpzXCI7XG5pbXBvcnQgeyBEYXRhU3RyaW5nIH0gZnJvbSBcIi4uLy4uLy4uL2Jhc2UvY29yZS9kYXRhX3N0cmluZy5tanNcIjtcblxuZnVuY3Rpb24gYnVpbGRGc0NpdGF0aW9uRGF0YVN0cmluZyhkYXRhKSB7XG4gIGlmIChkYXRhLmNpdGF0aW9uKSB7XG4gICAgLy8gY2l0YXRpb24gc3RyaW5nIGxvb2tzIGxpa2UgdGhpcyAoZm9yIGV4YW1wbGUpOlxuICAgIC8qXG4gICAgXCJFbmdsYW5kIGFuZCBXYWxlcyBDZW5zdXMsIDE4NDEsXCIgZGF0YWJhc2Ugd2l0aCBpbWFnZXMsXG4gICAgPGk+RmFtaWx5U2VhcmNoPC9pPiAoaHR0cHM6Ly9mYW1pbHlzZWFyY2gub3JnL2FyazovNjE5MDMvMToxOk1RVFYtWUI5IDogMjMgTWF5IDIwMTkpLFxuICAgIElzYWJlbGxhIFBhdmV5IGluIGhvdXNlaG9sZCBvZiBXaWxsaWFtIFBhdmV5LCBFYXN0IFN0b25laG91c2UsIERldm9uLCBFbmdsYW5kLCBVbml0ZWQgS2luZ2RvbTtcbiAgICBmcm9tIFwiMTg0MSBFbmdsYW5kLCBTY290bGFuZCBhbmQgV2FsZXMgY2Vuc3VzLFwiIGRhdGFiYXNlIGFuZCBpbWFnZXMsXG4gICAgPGk+ZmluZG15cGFzdDwvaT4gKGh0dHA6Ly93d3cuZmluZG15cGFzdC5jb20gOiBuLmQuKTtcbiAgICBjaXRpbmcgUFJPIEhPIDEwNywgVGhlIE5hdGlvbmFsIEFyY2hpdmVzLCBLZXcsIFN1cnJleS5cbiAgICAqL1xuICAgIC8vIGZpbmQgdGhlIG1pZGRsZSBwYXJ0IGxpa2U6XG4gICAgLy8gXCJJc2FiZWxsYSBQYXZleSBpbiBob3VzZWhvbGQgb2YgV2lsbGlhbSBQYXZleSwgRWFzdCBTdG9uZWhvdXNlLCBEZXZvbiwgRW5nbGFuZCwgVW5pdGVkIEtpbmdkb21cIlxuXG4gICAgbGV0IGRhdGFTdHJpbmcgPSBkYXRhLmNpdGF0aW9uLnJlcGxhY2UoL14uKlxcPGlcXD5GYW1pbHlTZWFyY2hcXDxcXC9pXFw+XFxzK1xcKFteXFwpXStcXClcXCxcXHMqKFteXFw7XSspLiokLywgXCIkMVwiKTtcbiAgICBpZiAoZGF0YVN0cmluZyAmJiBkYXRhU3RyaW5nICE9IGRhdGEuY2l0YXRpb24pIHtcbiAgICAgIC8vIFNvbWV0aW1lcyB0aGVyZSBhcmUgY29tbWFzIHdpdGggbm8gc3BhY2UgYWZ0ZXIgdGhlbSwgZml4IHRoYXQuXG4gICAgICBkYXRhU3RyaW5nID0gZGF0YVN0cmluZy5yZXBsYWNlKC9cXCwoXFx3KS9nLCBcIiwgJDFcIik7XG4gICAgICByZXR1cm4gZGF0YVN0cmluZztcbiAgICB9XG4gIH1cblxuICByZXR1cm4gXCJcIjtcbn1cblxuZnVuY3Rpb24gcmVtb3ZlVW53YW50ZWRLZXlzRm9yVGFibGUoa2V5cywgcmVjb3JkRGF0YSkge1xuICAvLyBmb3IgdGhlIG1vbWVudCB0aGV5IGFyZSB0aGUgc2FtZVxuICByZXR1cm4gcmVtb3ZlVW53YW50ZWRLZXlzRm9yRGF0YVN0cmluZyhrZXlzLCByZWNvcmREYXRhKTtcbn1cblxuZnVuY3Rpb24gcmVtb3ZlVW53YW50ZWRLZXlzRm9yRGF0YVN0cmluZyhrZXlzLCByZWNvcmREYXRhKSB7XG4gIGNvbnN0IGV4YWN0TWF0Y2hlc1RvRXhjbHVkZSA9IFtcbiAgICBcIlBhZ2VcIixcbiAgICBcIlBhZ2UgbnVtYmVyXCIsXG4gICAgXCJGb2xpb1wiLFxuICAgIFwiUGllY2UgbnVtYmVyXCIsXG4gICAgXCJTY2hlZHVsZVwiLFxuICAgIFwiUm9sbHNcIixcblxuICAgIFwiVW5pcXVlIElkZW50aWZpZXJcIixcbiAgICBcIlNvdXJjZSBWb2x1bWVcIixcbiAgICBcIlNvdXJjZSBQYWdlXCIsXG4gICAgXCJFdmVudCBQbGFjZSBMZXZlbDFUeXBlXCIsXG4gICAgXCJFdmVudCBQbGFjZSBMZXZlbDJUeXBlXCIsXG4gICAgXCJFdmVudCBQbGFjZSBMZXZlbDNUeXBlXCIsXG4gICAgXCJFdnF1YXJ0ZXJcIixcbiAgICBcIlBwcSBJZFwiLFxuICAgIFwiUmVjb3JkIEdyb3VwXCIsXG4gICAgXCJTb3J0IEtleVwiLFxuICBdO1xuICBmdW5jdGlvbiBpc0tleVdhbnRlZChrZXkpIHtcbiAgICBmb3IgKGxldCBtYXRjaCBvZiBleGFjdE1hdGNoZXNUb0V4Y2x1ZGUpIHtcbiAgICAgIGlmIChtYXRjaCA9PSBrZXkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIGlmIHRoZXJlIGlzIGEgeWVhciBwbHVzIGEgZGF0ZSBmb3IgdGhlIHNhbWUgdGhpbmcgZXhjbHVkZSB0aGUgeWVhclxuICAgIGNvbnN0IHllYXJFbmRpbmcgPSBcIiB5ZWFyXCI7XG4gICAgaWYgKGtleS5lbmRzV2l0aCh5ZWFyRW5kaW5nKSkge1xuICAgICAgbGV0IGRhdGVLZXkgPSBrZXkuc3Vic3RyaW5nKDAsIGtleS5sZW5ndGggLSB5ZWFyRW5kaW5nLmxlbmd0aCkgKyBcIiBkYXRlXCI7XG4gICAgICBpZiAoa2V5cy5pbmNsdWRlcyhkYXRlS2V5KSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICBsZXQgbmV3S2V5cyA9IFtdO1xuXG4gIGZvciAobGV0IGtleSBvZiBrZXlzKSB7XG4gICAgaWYgKGlzS2V5V2FudGVkKGtleSkpIHtcbiAgICAgIG5ld0tleXMucHVzaChrZXkpO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiBuZXdLZXlzO1xufVxuXG5mdW5jdGlvbiBidWlsZERhdGFTdHJpbmcoZGF0YSwgZ2QsIGRhdGFTdHlsZSwgYnVpbGRlcikge1xuICBsZXQgb3B0aW9ucyA9IGJ1aWxkZXIub3B0aW9ucztcblxuICBsZXQgZGF0YVN0cmluZyA9IFwiXCI7XG5cbiAgaWYgKGRhdGFTdHlsZSA9PSBcInN0cmluZ1wiKSB7XG4gICAgbGV0IGlucHV0ID0ge1xuICAgICAgZ2VuZXJhbGl6ZWREYXRhOiBnZCxcbiAgICAgIG9wdGlvbnM6IG9wdGlvbnMsXG4gICAgfTtcbiAgICBkYXRhU3RyaW5nID0gRGF0YVN0cmluZy5idWlsZERhdGFTdHJpbmcoaW5wdXQpO1xuICAgIGlmIChkYXRhU3RyaW5nKSB7XG4gICAgICByZXR1cm4gZGF0YVN0cmluZztcbiAgICB9XG4gIH0gZWxzZSBpZiAoZGF0YVN0eWxlID09IFwiZnNDaXRhdGlvblwiKSB7XG4gICAgbGV0IGRhdGFTdHJpbmcgPSBidWlsZEZzQ2l0YXRpb25EYXRhU3RyaW5nKGRhdGEpO1xuICAgIGlmIChkYXRhU3RyaW5nKSB7XG4gICAgICByZXR1cm4gZGF0YVN0cmluZztcbiAgICB9XG5cbiAgICAvLyBpZiBubyBjaXRhdGlvbiBvbiB0aGUgRlMgcGFnZSBmYWxsYmFjayB0byBzdHJpbmcgZm9ybXN0XG4gICAgbGV0IGlucHV0ID0ge1xuICAgICAgZ2VuZXJhbGl6ZWREYXRhOiBnZCxcbiAgICAgIG9wdGlvbnM6IG9wdGlvbnMsXG4gICAgfTtcbiAgICBkYXRhU3RyaW5nID0gRGF0YVN0cmluZy5idWlsZERhdGFTdHJpbmcoaW5wdXQpO1xuICAgIGlmIChkYXRhU3RyaW5nKSB7XG4gICAgICByZXR1cm4gZGF0YVN0cmluZztcbiAgICB9XG5cbiAgICBpZiAoZGF0YS5zb3VyY2VUaXRsZUZvclBlcnNvbikge1xuICAgICAgbGV0IGRhdGFTdHJpbmcgPSBkYXRhLnNvdXJjZVRpdGxlRm9yUGVyc29uLnJlcGxhY2UoL14oW15cXCxdKilcXCwuKiQvLCBcIiQxXCIpO1xuICAgICAgcmV0dXJuIGRhdGFTdHJpbmc7XG4gICAgfVxuXG4gICAgaWYgKGRhdGEuZnVsbE5hbWUgJiYgZGF0YS5ldmVudERhdGUpIHtcbiAgICAgIGxldCBkYXRhU3RyaW5nID0gZGF0YS5mdWxsTmFtZSArIFwiIFwiICsgZGF0YS5ldmVudERhdGU7XG4gICAgICByZXR1cm4gZGF0YVN0cmluZztcbiAgICB9XG4gIH1cblxuICBsZXQgcmVjb3JkRGF0YSA9IGRhdGEucmVjb3JkRGF0YTtcblxuICBkYXRhU3RyaW5nID0gXCJcIjtcblxuICAvLyBJIGRvbid0IHRoaW5rIHRoaXMgd2lsbCBldmVyIGhhcHBlblxuICBpZiAoIXJlY29yZERhdGEpIHtcbiAgICBsZXQgZGF0ZSA9IGdkLmluZmVyRXZlbnREYXRlKCk7XG4gICAgbGV0IHBsYWNlID0gZ2QuaW5mZXJFdmVudFBsYWNlKCk7XG4gICAgZGF0YVN0cmluZyA9IGRhdGU7XG4gICAgaWYgKHBsYWNlKSB7XG4gICAgICBpZiAoZGF0ZSkge1xuICAgICAgICBkYXRhU3RyaW5nICs9IFwiLCBcIjtcbiAgICAgIH1cbiAgICAgIGRhdGFTdHJpbmcgKz0gcGxhY2U7XG4gICAgfVxuICAgIHJldHVybiBkYXRhU3RyaW5nO1xuICB9XG5cbiAgZGF0YVN0cmluZyA9IGJ1aWxkZXIuYnVpbGREYXRhTGlzdChyZWNvcmREYXRhLCByZW1vdmVVbndhbnRlZEtleXNGb3JEYXRhU3RyaW5nKTtcblxuICByZXR1cm4gZGF0YVN0cmluZztcbn1cblxuZnVuY3Rpb24gZ2V0QWRkaXRpb25hbEluZm8oZGF0YSwgZ2QsIGJ1aWxkZXIpIHtcbiAgbGV0IGNpdGF0aW9uVHlwZSA9IGJ1aWxkZXIudHlwZTtcbiAgbGV0IG9wdGlvbnMgPSBidWlsZGVyLm9wdGlvbnM7XG5cbiAgbGV0IGRhdGFTdHlsZSA9IG9wdGlvbnMuY2l0YXRpb25fZnNfZGF0YVN0eWxlO1xuICBpZiAoZGF0YVN0eWxlID09IFwibm9uZVwiKSB7XG4gICAgcmV0dXJuIFwiXCI7XG4gIH0gZWxzZSBpZiAoZGF0YVN0eWxlID09IFwidGFibGVcIikge1xuICAgIGlmIChvcHRpb25zLmNpdGF0aW9uX2dlbmVyYWxfcmVmZXJlbmNlUG9zaXRpb24gPT0gXCJhdEVuZFwiKSB7XG4gICAgICBkYXRhU3R5bGUgPSBcInN0cmluZ1wiO1xuICAgIH0gZWxzZSBpZiAoY2l0YXRpb25UeXBlID09IFwic291cmNlXCIpIHtcbiAgICAgIGRhdGFTdHlsZSA9IFwibGlzdFwiO1xuICAgIH1cbiAgfVxuXG4gIGlmIChkYXRhU3R5bGUgPT0gXCJzdHJpbmdcIiB8fCBkYXRhU3R5bGUgPT0gXCJsaXN0XCIgfHwgZGF0YVN0eWxlID09IFwiZnNDaXRhdGlvblwiKSB7XG4gICAgcmV0dXJuIGJ1aWxkRGF0YVN0cmluZyhkYXRhLCBnZCwgZGF0YVN0eWxlLCBidWlsZGVyKTtcbiAgfVxuXG4gIC8vIHN0eWxlIG11c3QgYmUgdGFibGVcbiAgdmFyIHJlc3VsdCA9IFwiXCI7XG4gIGxldCByZWNvcmREYXRhID0gZGF0YS5yZWNvcmREYXRhO1xuICBpZiAocmVjb3JkRGF0YSkge1xuICAgIGxldCBrZXlzID0gT2JqZWN0LmtleXMocmVjb3JkRGF0YSk7XG5cbiAgICBrZXlzID0gcmVtb3ZlVW53YW50ZWRLZXlzRm9yVGFibGUoa2V5cywgcmVjb3JkRGF0YSk7XG4gICAgaWYgKGtleXMubGVuZ3RoID4gMCkge1xuICAgICAgLy8gc3RhcnQgdGFibGVcbiAgICAgIHJlc3VsdCA9ICd7fCBib3JkZXI9XCIxXCJcXG4nO1xuICAgICAgbGV0IGZpcnN0Um93ID0gdHJ1ZTtcblxuICAgICAgZm9yIChsZXQga2V5IG9mIGtleXMpIHtcbiAgICAgICAgaWYgKGZpcnN0Um93KSB7XG4gICAgICAgICAgZmlyc3RSb3cgPSBmYWxzZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXN1bHQgKz0gXCJ8LVxcblwiO1xuICAgICAgICB9XG4gICAgICAgIHJlc3VsdCArPSBcInwgXCIgKyBrZXkgKyBcIiB8fCBcIiArIHJlY29yZERhdGFba2V5XSArIFwiXFxuXCI7XG4gICAgICB9XG5cbiAgICAgIHJlc3VsdCArPSBcInx9XCI7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHJlc3VsdDtcbn1cblxuZnVuY3Rpb24gYnVpbGRTb3VyY2VSZWZlcmVuY2VGcm9tUmVjb3JkKGRhdGEsIGdkLCBvcHRpb25zKSB7XG4gIGxldCBkYXRhU3RyaW5nID0gXCJcIjtcblxuICBmdW5jdGlvbiBhZGRWYWx1ZSh0aXRsZSwgdmFsdWUpIHtcbiAgICBpZiAodmFsdWUpIHtcbiAgICAgIGlmIChkYXRhU3RyaW5nICE9IFwiXCIpIHtcbiAgICAgICAgZGF0YVN0cmluZyArPSBcIiBcIjtcbiAgICAgIH1cbiAgICAgIGRhdGFTdHJpbmcgKz0gdGl0bGUgKyBcIjogXCIgKyB2YWx1ZSArIFwiO1wiO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIGFkZFJlY29yZERhdGFWYWx1ZSh0aXRsZSwga2V5QXJyYXkpIHtcbiAgICBsZXQgdmFsdWUgPSB1bmRlZmluZWQ7XG4gICAgaWYgKGRhdGEucmVjb3JkRGF0YSkge1xuICAgICAgZm9yIChsZXQga2V5IG9mIGtleUFycmF5KSB7XG4gICAgICAgIHZhbHVlID0gZGF0YS5yZWNvcmREYXRhW2tleV07XG4gICAgICAgIGlmICh2YWx1ZSkge1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIGlmICh2YWx1ZSkge1xuICAgICAgaWYgKGRhdGFTdHJpbmcgIT0gXCJcIikge1xuICAgICAgICBkYXRhU3RyaW5nICs9IFwiIFwiO1xuICAgICAgfVxuICAgICAgZGF0YVN0cmluZyArPSB0aXRsZSArIFwiOiBcIiArIHZhbHVlICsgXCI7XCI7XG4gICAgfVxuICB9XG5cbiAgbGV0IHJlZkRhdGEgPSBkYXRhLnJlZmVyZW5jZURhdGE7XG5cbiAgaWYgKGdkLmlzUmVjb3JkSW5Db3VudHJ5KFwiVW5pdGVkIEtpbmdkb21cIikpIHtcbiAgICBpZiAoZ2QucmVjb3JkVHlwZSA9PSBSVC5DZW5zdXMgJiYgZGF0YS5jb2xsZWN0aW9uVGl0bGUuc3RhcnRzV2l0aChcIkVuZ2xhbmQgYW5kIFdhbGVzIENlbnN1c1wiKSkge1xuICAgICAgLy8gVGhlIEFuY2VzdHJ5IHJlZmVyZW5jZSB3b3VsZCBsb29rIGxpa2U6XG4gICAgICAvLyBDbGFzczogSE8xMDc7IFBpZWNlOiAyNzY7IEJvb2s6IDY7IENpdmlsIFBhcmlzaDogRWFzdCBTdG9uZWhvdXNlOyBDb3VudHk6IERldm9uOyBFbnVtZXJhdGlvbiBEaXN0cmljdDogNjsgRm9saW86IDIxOyBQYWdlOiAzNzsgTGluZTogMjA7IEdTVSByb2xsOiAyNDEzMzU8YnIvPlxuXG4gICAgICBkYXRhU3RyaW5nICs9IFwiVGhlIE5hdGlvbmFsIEFyY2hpdmVzIG9mIHRoZSBVS1wiO1xuICAgICAgaWYgKHJlZkRhdGEpIHtcbiAgICAgICAgYWRkVmFsdWUoXCJDbGFzc1wiLCByZWZEYXRhLnNvdXJjZVJlZ05icik7XG4gICAgICAgIGFkZFZhbHVlKFwiUGllY2UvRm9saW9cIiwgcmVmRGF0YS5zb3VyY2VQaWVjZUZvbGlvKTtcbiAgICAgICAgYWRkVmFsdWUoXCJQYWdlXCIsIHJlZkRhdGEuc291cmNlUGFnZU5icik7XG4gICAgICAgIGFkZFZhbHVlKFwiTGluZVwiLCByZWZEYXRhLnNvdXJjZUxpbmVOYnIpO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoXG4gICAgICBnZC5yZWNvcmRUeXBlID09IFJULkJpcnRoUmVnaXN0cmF0aW9uIHx8XG4gICAgICBnZC5yZWNvcmRUeXBlID09IFJULkRlYXRoUmVnaXN0cmF0aW9uIHx8XG4gICAgICBnZC5yZWNvcmRUeXBlID09IFJULk1hcnJpYWdlUmVnaXN0cmF0aW9uXG4gICAgKSB7XG4gICAgICAvLyBGUyBjaXRhdGlvbiB3b3VsZCBzYXk6XG4gICAgICAvLyBDaXRpbmcgMTkzNywgcXVhcnRlciAyLCB2b2wuIDlELCBwLiA1MTksIEh1bGwsIFlvcmtzaGlyZSwgRW5nbGFuZCwgR2VuZXJhbCBSZWdpc3RlciBPZmZpY2UsIFNvdXRocG9ydCwgRW5nbGFuZC5cblxuICAgICAgZGF0YVN0cmluZyArPSBcIlVLIEdlbmVyYWwgUmVnaXN0ZXIgT2ZmaWNlLlwiO1xuICAgICAgYWRkVmFsdWUoXCJEaXN0cmljdFwiLCBkYXRhLnJlZ2lzdHJhdGlvbkRpc3RyaWN0KTtcbiAgICAgIGlmIChyZWZEYXRhKSB7XG4gICAgICAgIGFkZFZhbHVlKFwiVm9sdW1lXCIsIHJlZkRhdGEuc291cmNlVm9sdW1lKTtcbiAgICAgICAgYWRkVmFsdWUoXCJQYWdlXCIsIHJlZkRhdGEuc291cmNlUGFnZU5icik7XG4gICAgICAgIC8vIHRoZXJlIGNhbiBiZSBhIGxpbmUgbnVtYmVyIGJ1dCB3ZSBkb24ndCB3YW50IHRoYXQgYXMgaXQgaXMgbGluZSBudW0gb24gRk1QIHByaW50b3V0XG4gICAgICAgIGFkZFZhbHVlKFwiRW50cnlcIiwgcmVmRGF0YS5zb3VyY2VFbnRyeU5icik7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKGRhdGFTdHJpbmcpIHtcbiAgICAgIGRhdGFTdHJpbmcgPSBcImNpdGluZyBcIiArIGRhdGFTdHJpbmc7XG4gICAgfVxuICAgIHJldHVybiBkYXRhU3RyaW5nO1xuICB9XG5cbiAgLy8gbm90IGEgc3BlY2lhbCBjYXNlLCBqdXN0IGFkZCBldmVyeXRoaW5nIHRoYXQgY291bGQgYmUgcGFydCBvZiByZWZlcmVuY2VcbiAgYWRkVmFsdWUoXCJEaXN0cmljdFwiLCBkYXRhLnJlZ2lzdHJhdGlvbkRpc3RyaWN0KTtcbiAgaWYgKHJlZkRhdGEpIHtcbiAgICBhZGRWYWx1ZShcIlZvbHVtZVwiLCByZWZEYXRhLnNvdXJjZVZvbHVtZSk7XG4gICAgYWRkVmFsdWUoXCJQaWVjZS9Gb2xpb1wiLCByZWZEYXRhLnNvdXJjZVBpZWNlRm9saW8pO1xuICAgIGFkZFZhbHVlKFwiUGFnZVwiLCByZWZEYXRhLnNvdXJjZVBhZ2VOYnIpO1xuXG4gICAgYWRkVmFsdWUoXCJBZmZpbGlhdGUgUHVibGljYXRpb24gVGl0bGVcIiwgcmVmRGF0YS5leHRlcm5hbFB1YmxpY2F0aW9uVGl0bGUpO1xuICAgIGFkZFZhbHVlKFwiQWZmaWxpYXRlIFB1YmxpY2F0aW9uIE51bWJlclwiLCByZWZEYXRhLmV4dGVybmFsUHVibGljYXRpb25OdW1iZXIpO1xuICAgIGFkZFZhbHVlKFwiQWZmaWxpYXRlIEZpbG0gTnVtYmVyXCIsIHJlZkRhdGEuZXh0ZXJuYWxGaWxtTnVtYmVyKTtcblxuICAgIGlmIChyZWZEYXRhLnNvdXJjZUxpbmVOYnIpIHtcbiAgICAgIGFkZFZhbHVlKFwiTGluZVwiLCByZWZEYXRhLnNvdXJjZUxpbmVOYnIpO1xuICAgIH0gZWxzZSB7XG4gICAgICBhZGRWYWx1ZShcIkFmZmlsaWF0ZSBMaW5lIE51bWJlclwiLCByZWZEYXRhLmV4dGVybmFsTGluZU51bWJlcik7XG4gICAgfVxuICAgIGFkZFZhbHVlKFwiRW50cnlcIiwgcmVmRGF0YS5zb3VyY2VFbnRyeU5icik7XG5cbiAgICBhZGRWYWx1ZShcIlJlZmVyZW5jZVwiLCByZWZEYXRhLnJlZmVyZW5jZUlkKTtcbiAgICBhZGRWYWx1ZShcIkZITCBtaWNyb2ZpbG1cIiwgcmVmRGF0YS5maWxtTnVtYmVyKTtcbiAgICBhZGRWYWx1ZShcIlJlY29yZCBudW1iZXJcIiwgcmVmRGF0YS5yZWNvcmROdW1iZXIpO1xuICB9XG5cbiAgaWYgKGRhdGFTdHJpbmcpIHtcbiAgICBkYXRhU3RyaW5nID0gXCJjaXRpbmcgXCIgKyBkYXRhU3RyaW5nO1xuICB9XG4gIHJldHVybiBkYXRhU3RyaW5nO1xufVxuXG5mdW5jdGlvbiBidWlsZFNvdXJjZVJlZmVyZW5jZUZyb21Gc0NpdGF0aW9uKGRhdGEsIG9wdGlvbnMpIHtcbiAgaWYgKGRhdGEuY2l0YXRpb24pIHtcbiAgICAvLyBjaXRhdGlvbiBzdHJpbmcgbG9va3MgbGlrZSB0aGlzIChmb3IgZXhhbXBsZSk6XG4gICAgLypcbiAgICBcIkVuZ2xhbmQgYW5kIFdhbGVzIENlbnN1cywgMTg0MSxcIiBkYXRhYmFzZSB3aXRoIGltYWdlcyxcbiAgICA8aT5GYW1pbHlTZWFyY2g8L2k+IChodHRwczovL2ZhbWlseXNlYXJjaC5vcmcvYXJrOi82MTkwMy8xOjE6TVFUVi1ZQjkgOiAyMyBNYXkgMjAxOSksXG4gICAgSXNhYmVsbGEgUGF2ZXkgaW4gaG91c2Vob2xkIG9mIFdpbGxpYW0gUGF2ZXksIEVhc3QgU3RvbmVob3VzZSwgRGV2b24sIEVuZ2xhbmQsIFVuaXRlZCBLaW5nZG9tO1xuICAgIGZyb20gXCIxODQxIEVuZ2xhbmQsIFNjb3RsYW5kIGFuZCBXYWxlcyBjZW5zdXMsXCIgZGF0YWJhc2UgYW5kIGltYWdlcyxcbiAgICA8aT5maW5kbXlwYXN0PC9pPiAoaHR0cDovL3d3dy5maW5kbXlwYXN0LmNvbSA6IG4uZC4pO1xuICAgIGNpdGluZyBQUk8gSE8gMTA3LCBUaGUgTmF0aW9uYWwgQXJjaGl2ZXMsIEtldywgU3VycmV5LlxuICAgICovXG4gICAgY29uc3QgY2l0aW5nU3RyaW5nID0gXCJjaXRpbmcgXCI7XG4gICAgbGV0IGNpdGluZ0luZGV4ID0gZGF0YS5jaXRhdGlvbi5pbmRleE9mKGNpdGluZ1N0cmluZyk7XG4gICAgaWYgKGNpdGluZ0luZGV4ICE9IC0xKSB7XG4gICAgICBjaXRpbmdJbmRleCArPSBjaXRpbmdTdHJpbmcubGVuZ3RoO1xuXG4gICAgICBsZXQgcmVmU3RyaW5nID0gZGF0YS5jaXRhdGlvbi5zdWJzdHJpbmcoY2l0aW5nSW5kZXgpO1xuICAgICAgY29uc3QgZnJvbVN0cmluZyA9IFwiZnJvbSBcIjtcblxuICAgICAgaWYgKG9wdGlvbnMuY2l0YXRpb25fZnNfc291cmNlUmVmID09IFwiZnNDaXRhdGlvblNob3J0XCIpIHtcbiAgICAgICAgLy8gdGhlcmUgY2FuIGJlIG1vcmUgdGhhbiBvbmUgXCJjaXRpbmdcIi4gU29tZXRpbWVzIHRoYXQgaXMgT0ssIG90aGVyIHRpbWVzIHRoZXJlIGlzIHRvbyBtdWNoIGluXG4gICAgICAgIC8vIHRoZSBmaXJzdCBjaXRpbmcgc3RyaW5nIChhIGZyb20pXG4gICAgICAgIGNpdGluZ0luZGV4ID0gcmVmU3RyaW5nLmluZGV4T2YoY2l0aW5nU3RyaW5nKTtcbiAgICAgICAgbGV0IGZyb21JbmRleCA9IHJlZlN0cmluZy5pbmRleE9mKGZyb21TdHJpbmcpO1xuICAgICAgICBpZiAoY2l0aW5nSW5kZXggIT0gLTEgJiYgZnJvbUluZGV4ICE9IC0xICYmIGZyb21JbmRleCA8IGNpdGluZ0luZGV4KSB7XG4gICAgICAgICAgLy8gY3V0IG91dCB0aGUgcGFydCBiZXR3ZWVuIHRoZSBmcm9tIGFuZCB0aGUgc2Vjb25kIGNpdGluZ1xuICAgICAgICAgIGxldCBwYXJ0MSA9IHJlZlN0cmluZy5zdWJzdHJpbmcoMCwgZnJvbUluZGV4KS50cmltKCk7XG4gICAgICAgICAgbGV0IHBhcnQyID0gcmVmU3RyaW5nLnN1YnN0cmluZyhjaXRpbmdJbmRleCkudHJpbSgpO1xuXG4gICAgICAgICAgcGFydDEgPSBwYXJ0MS5yZXBsYWNlKC9eKC4qKVtcXDtcXCxcXC5dKyQvLCBcIiQxXCIpOyAvLyByZW1vdmUgdHJhaWxpbmcgcHVuY3R1YXRpb25cbiAgICAgICAgICByZWZTdHJpbmcgPSBwYXJ0MSArIFwiOyBcIiArIHBhcnQyO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGlmIChyZWZTdHJpbmcpIHtcbiAgICAgICAgcmVmU3RyaW5nID0gXCJjaXRpbmcgXCIgKyByZWZTdHJpbmc7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiByZWZTdHJpbmc7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIFwiXCI7XG59XG5cbmZ1bmN0aW9uIGJ1aWxkU291cmNlUmVmZXJlbmNlKGRhdGEsIGdkLCBvcHRpb25zKSB7XG4gIGlmIChvcHRpb25zLmNpdGF0aW9uX2ZzX3NvdXJjZVJlZiA9PSBcImZzQ2l0YXRpb25TaG9ydFwiIHx8IG9wdGlvbnMuY2l0YXRpb25fZnNfc291cmNlUmVmID09IFwiZnNDaXRhdGlvbkxvbmdcIikge1xuICAgIGxldCByZWZTdHJpbmcgPSBidWlsZFNvdXJjZVJlZmVyZW5jZUZyb21Gc0NpdGF0aW9uKGRhdGEsIG9wdGlvbnMpO1xuICAgIGlmIChyZWZTdHJpbmcpIHtcbiAgICAgIHJldHVybiByZWZTdHJpbmc7XG4gICAgfVxuICB9XG5cbiAgLy8gYnVpbGQgZnJvbSByZWNvcmRcbiAgcmV0dXJuIGJ1aWxkU291cmNlUmVmZXJlbmNlRnJvbVJlY29yZChkYXRhLCBnZCwgb3B0aW9ucyk7XG59XG5cbmZ1bmN0aW9uIGV4dHJhY3RJZEZyb21Gc1VybCh1cmwsIHByZWZpeExpc3QsIHRlcm1pbmF0b3JMaXN0KSB7XG4gIC8vIHRoZSByZWNvcmRVcmwgc2hvdWxkIGxvb2sgbGlrZTpcbiAgLy8gaHR0cHM6Ly93d3cuZmFtaWx5c2VhcmNoLm9yZy9hcms6LzYxOTAzLzE6MTpYWkRZLU5ITVxuXG4gIGZvciAobGV0IHByZWZpeCBvZiBwcmVmaXhMaXN0KSB7XG4gICAgbGV0IHByZWZpeEluZGV4ID0gdXJsLmluZGV4T2YocHJlZml4KTtcbiAgICBpZiAocHJlZml4SW5kZXggIT0gLTEpIHtcbiAgICAgIGxldCBpZCA9IHVybC5zdWJzdHJpbmcocHJlZml4SW5kZXggKyBwcmVmaXgubGVuZ3RoKTtcbiAgICAgIGZvciAobGV0IHRlcm1pbmF0b3Igb2YgdGVybWluYXRvckxpc3QpIHtcbiAgICAgICAgbGV0IHRlcm1pbmF0b3JJbmRleCA9IGlkLmluZGV4T2YodGVybWluYXRvcik7XG4gICAgICAgIGlmICh0ZXJtaW5hdG9ySW5kZXggIT0gLTEpIHtcbiAgICAgICAgICBpZCA9IGlkLnN1YnN0cmluZygwLCB0ZXJtaW5hdG9ySW5kZXgpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gaWQ7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIFwiXCI7IC8vIG5vIHByZWZpeCBmb3VuZFxufVxuXG5mdW5jdGlvbiBidWlsZEZzUmVjb3JkTGluayhyZWNvcmRVcmwpIHtcbiAgLy8gc3RhcnQgd2l0aCB0aGUgb2xkIGZvcm1hdCBsaW5rIGFuZCB0aGVuIHRyeSB0byByZXBsYWNlIHdpdGggdGVtcGxhdGVcbiAgbGV0IHJlY29yZExpbmtPclRlbXBsYXRlID0gXCJbXCIgKyByZWNvcmRVcmwgKyBcIiBGYW1pbHlTZWFyY2hcIiArIFwiXVwiO1xuXG4gIC8vIHRoZSByZWNvcmRVcmwgc2hvdWxkIGxvb2sgbGlrZTpcbiAgLy8gaHR0cHM6Ly93d3cuZmFtaWx5c2VhcmNoLm9yZy9hcms6LzYxOTAzLzE6MTpYWkRZLU5ITVxuICBsZXQgcmVjb3JkSWQgPSBleHRyYWN0SWRGcm9tRnNVcmwocmVjb3JkVXJsLCBbXCJhcms6LzYxOTAzLzE6MTpcIl0sIFtcIi9cIiwgXCI/XCJdKTtcblxuICBpZiAocmVjb3JkSWQubGVuZ3RoID4gNSkge1xuICAgIHJlY29yZExpbmtPclRlbXBsYXRlID0gXCJ7e0ZhbWlseVNlYXJjaCBSZWNvcmR8XCIgKyByZWNvcmRJZCArIFwifX1cIjtcbiAgfVxuXG4gIHJldHVybiByZWNvcmRMaW5rT3JUZW1wbGF0ZTtcbn1cblxuZnVuY3Rpb24gYnVpbGRGc0ltYWdlTGluayhpbWFnZVVybCkge1xuICAvLyBzdGFydCB3aXRoIHRoZSBvbGQgZm9ybWF0IGxpbmsgYW5kIHRoZW4gdHJ5IHRvIHJlcGxhY2Ugd2l0aCB0ZW1wbGF0ZVxuICBsZXQgaW1hZ2VMaW5rT3JUZW1wbGF0ZSA9IFwiW1wiICsgaW1hZ2VVcmwgKyBcIiBGYW1pbHlTZWFyY2ggSW1hZ2VdXCI7XG5cbiAgLy8gdGhlIHJlY29yZFVybCBzaG91bGQgbG9vayBsaWtlIG9uZSBvZiB0aGVzZTpcbiAgLy8gaHR0cHM6Ly93d3cuZmFtaWx5c2VhcmNoLm9yZy9hcms6LzYxOTAzLzM6MTozM1M3LTlCU0gtOVc5Qj9pPTcmY2M9MTQ3MzE4MVxuICAvLyBodHRwczovL3d3dy5mYW1pbHlzZWFyY2gub3JnL2FyazovNjE5MDMvMzoxOjMzUzctOVAyUC05RDJGP2k9MTE3OSZjYz0xMzA3MjcyJnBlcnNvbmFVcmw9JTJGYXJrJTNBJTJGNjE5MDMlMkYxJTNBMSUzQVhaRFktTkhNXG4gIGxldCBpbWFnZUlkID0gZXh0cmFjdElkRnJvbUZzVXJsKGltYWdlVXJsLCBbXCJhcms6LzYxOTAzLzM6MTpcIl0sIFtcIi9cIiwgXCI/XCJdKTtcblxuICBpZiAoaW1hZ2VJZC5sZW5ndGggPiA1KSB7XG4gICAgaW1hZ2VMaW5rT3JUZW1wbGF0ZSA9IFwie3tGYW1pbHlTZWFyY2ggSW1hZ2V8XCIgKyBpbWFnZUlkICsgXCJ9fVwiO1xuICB9XG5cbiAgcmV0dXJuIGltYWdlTGlua09yVGVtcGxhdGU7XG59XG5cbmZ1bmN0aW9uIGJ1aWxkQ29yZUNpdGF0aW9uKGRhdGEsIGdkLCBidWlsZGVyKSB7XG4gIGJ1aWxkZXIuc291cmNlVGl0bGUgPSBkYXRhLmNvbGxlY3Rpb25UaXRsZTtcblxuICB2YXIgcmVjb3JkVXJsID0gZGF0YS5wZXJzb25SZWNvcmRVcmw7XG5cbiAgaWYgKChkYXRhLmZzSW1hZ2VVcmwgfHwgZGF0YS5leHRlcm5hbEltYWdlVXJsKSAmJiBkYXRhLmV4dGVybmFsSW1hZ2VVcmwgIT0gXCJiYWRcIikge1xuICAgIGxldCB0ZXh0ID0gXCJcIjtcbiAgICBpZiAoZGF0YS5leHRlcm5hbEltYWdlVXJsKSB7XG4gICAgICBpZiAoYnVpbGRlci5vcHRpb25zLmNpdGF0aW9uX2ZzX2luY2x1ZGVFeHRlcm5hbEltYWdlTGluaykge1xuICAgICAgICBpZiAoZGF0YS5leHRlcm5hbEltYWdlVXJsLmluY2x1ZGVzKFwiZmluZG15cGFzdFwiKSkge1xuICAgICAgICAgIHRleHQgKz0gXCJbXCIgKyBkYXRhLmV4dGVybmFsSW1hZ2VVcmwgKyBcIiBGaW5kTXlQYXN0IEltYWdlXVwiO1xuICAgICAgICAgIGxldCBzdWJSZXFTdHJpbmcgPSBidWlsZGVyLmdldFN1YlJlcVN0cmluZyhidWlsZGVyLm9wdGlvbnMuY2l0YXRpb25fZnNfc3Vic2NyaXB0aW9uUmVxdWlyZWQpO1xuICAgICAgICAgIGlmIChzdWJSZXFTdHJpbmcpIHtcbiAgICAgICAgICAgIHRleHQgKz0gXCIgKFwiICsgc3ViUmVxU3RyaW5nICsgXCIpXCI7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRleHQgKz0gXCJbXCIgKyBkYXRhLmV4dGVybmFsSW1hZ2VVcmwgKyBcIiBFeHRlcm5hbCBJbWFnZV1cIjtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBidWlsZGVyLmRhdGFiYXNlSGFzSW1hZ2VzID0gdHJ1ZTtcblxuICAgICAgdGV4dCArPSBidWlsZEZzSW1hZ2VMaW5rKGRhdGEuZnNJbWFnZVVybCk7XG4gICAgICBpZiAoZGF0YS5mc0ltYWdlTnVtYmVyKSB7XG4gICAgICAgIHRleHQgKz0gXCIgSW1hZ2UgbnVtYmVyIFwiICsgZGF0YS5mc0ltYWdlTnVtYmVyO1xuICAgICAgfVxuICAgIH1cbiAgICBidWlsZGVyLmV4dGVybmFsU2l0ZUxpbmsgPSB0ZXh0O1xuICB9IGVsc2UgaWYgKGRhdGEuZGlnaXRhbEFydGlmYWN0KSB7XG4gICAgLy8gRmluZCBBIEdyYXZlIGV4YW1wbGU6ICAgXCJkaWdpdGFsQXJ0aWZhY3RcIjogXCJodHRwOi8vd3d3LmZpbmRhZ3JhdmUuY29tL2NnaS1iaW4vZmcuY2dpP3BhZ2U9Z3ImR1JpZD0zMDU2OTgzNFwiLFxuICAgIGxldCB1cmwgPSBkYXRhLmRpZ2l0YWxBcnRpZmFjdDtcbiAgICBjb25zdCBpZFBhcmFtID0gXCImR1JpZD1cIjtcbiAgICBpZiAodXJsLmluY2x1ZGVzKFwiLy93d3cuZmluZGFncmF2ZS5jb20vY2dpLWJpblwiKSAmJiB1cmwuaW5jbHVkZXMoaWRQYXJhbSkpIHtcbiAgICAgIGxldCBwYXJhbUluZGV4ID0gdXJsLmluZGV4T2YoaWRQYXJhbSk7XG4gICAgICBpZiAocGFyYW1JbmRleCAhPSAtMSkge1xuICAgICAgICBsZXQgbmV4dFBhcmFtSW5kZXggPSB1cmwuaW5kZXhPZihcIiZcIiwgcGFyYW1JbmRleCArIGlkUGFyYW0ubGVuZ3RoKTtcbiAgICAgICAgaWYgKG5leHRQYXJhbUluZGV4ID09IC0xKSB7XG4gICAgICAgICAgbmV4dFBhcmFtSW5kZXggPSB1cmwubGVuZ3RoO1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IG1lbW9yaWFsSWQgPSB1cmwuc3Vic3RyaW5nKHBhcmFtSW5kZXggKyBpZFBhcmFtLmxlbmd0aCwgbmV4dFBhcmFtSW5kZXgpO1xuICAgICAgICBidWlsZGVyLmV4dGVybmFsU2l0ZUxpbmsgPSBcInt7RmluZEFHcmF2ZXxcIiArIG1lbW9yaWFsSWQgKyBcIn19XCI7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGJ1aWxkZXIuZXh0ZXJuYWxTaXRlTGluayA9IHVybDtcbiAgICB9XG4gIH1cblxuICBidWlsZGVyLnJlY29yZExpbmtPclRlbXBsYXRlID0gYnVpbGRGc1JlY29yZExpbmsocmVjb3JkVXJsKTtcblxuICBsZXQgYWRkaXRpb25hbEluZm8gPSBnZXRBZGRpdGlvbmFsSW5mbyhkYXRhLCBnZCwgYnVpbGRlcik7XG4gIGlmIChhZGRpdGlvbmFsSW5mbykge1xuICAgIGJ1aWxkZXIuZGF0YVN0cmluZyA9IGFkZGl0aW9uYWxJbmZvO1xuICB9XG5cbiAgYnVpbGRlci5zb3VyY2VSZWZlcmVuY2UgPSBidWlsZFNvdXJjZVJlZmVyZW5jZShkYXRhLCBnZCwgYnVpbGRlci5vcHRpb25zKTtcbn1cblxuZnVuY3Rpb24gZ2V0SW1hZ2VSZWZUaXRsZShjYXRhbG9nUmVjb3JkTmFtZSwgZmlsbVRpdGxlKSB7XG4gIGNvbnN0IGNhdGFsb2dSZWNvcmROYW1lVGlnaHRNYXRjaGVzID0gW1xuICAgIHsgdGl0bGU6IFwiTWFycmlhZ2VcIiwgbWF0Y2hlczogW1wiTWFycmlhZ2UgcmVjb3Jkc1wiXSB9LFxuICAgIHsgdGl0bGU6IFwiTWFycmlhZ2UgQm9uZFwiLCBtYXRjaGVzOiBbXCJNYXJyaWFnZSBsaWNlbmNlIGJvbmRzXCJdIH0sXG4gICAgeyB0aXRsZTogXCJUYXggcmVjb3JkXCIsIG1hdGNoZXM6IFtcIlRheCBib29rc1wiXSB9LFxuICAgIHtcbiAgICAgIHRpdGxlOiBcIlBlcnNvbmFsIFByb3BlcnR5IFRheFwiLFxuICAgICAgbWF0Y2hlczogW1wiUGVyc29uYWwgcHJvcGVydHkgdGF4IGxpc3RzLFwiXSxcbiAgICB9LFxuICAgIHsgdGl0bGU6IFwiRGVlZFwiLCBtYXRjaGVzOiBbXCJEZWVkcyxcIiwgXCJEZWVkIHJlY29yZHMsXCJdIH0sXG4gIF07XG5cbiAgY29uc3QgZmlsbVRpdGxlVGlnaHRNYXRjaGVzID0gW1xuICAgIHsgdGl0bGU6IFwiTWFycmlhZ2VcIiwgbWF0Y2hlczogW1wiQ291bnR5IE1hcnJpYWdlcyxcIl0gfSxcbiAgICB7IHRpdGxlOiBcIk1hcnJpYWdlIEJvbmRcIiwgbWF0Y2hlczogW1wiTWFycmlhZ2UgQm9uZCxcIl0gfSxcbiAgICB7IHRpdGxlOiBcIkRlZWQgcmVjb3JkXCIsIG1hdGNoZXM6IFtcIkRlZWRzXCJdIH0sXG4gICAgeyB0aXRsZTogXCJMYW5kIHJlY29yZFwiLCBtYXRjaGVzOiBbXCJMYW5kIFJlY29yZHMsXCJdIH0sXG4gIF07XG5cbiAgY29uc3QgY2F0YWxvZ1JlY29yZE5hbWVMb29zZU1hdGNoZXMgPSBbXG4gICAgeyB0aXRsZTogXCJNYXJyaWFnZVwiLCBtYXRjaGVzOiBbXCJNYXJyaWFnZVwiXSB9LFxuICAgIHsgdGl0bGU6IFwiUHJvcGVydHkgVGF4XCIsIG1hdGNoZXM6IFtcInByb3BlcnR5IHRheFwiXSB9LFxuICAgIHsgdGl0bGU6IFwiVGF4IHJlY29yZFwiLCBtYXRjaGVzOiBbXCJUYXhcIiwgXCJ0YXhcIl0gfSxcbiAgXTtcblxuICBjb25zdCBmaWxtVGl0bGVMb29zZU1hdGNoZXMgPSBbXG4gICAgeyB0aXRsZTogXCJNYXJyaWFnZVwiLCBtYXRjaGVzOiBbXCJNYXJyaWFnZVwiXSB9LFxuICAgIHsgdGl0bGU6IFwiVGF4IHJlY29yZFwiLCBtYXRjaGVzOiBbXCJUYXhcIl0gfSxcbiAgICB7IHRpdGxlOiBcIkRlZWQgcmVjb3JkXCIsIG1hdGNoZXM6IFtcIkRlZWRcIl0gfSxcbiAgXTtcblxuICBmdW5jdGlvbiBsb29rdXAodGl0bGUsIHRhYmxlKSB7XG4gICAgZm9yIChsZXQgb2JqIG9mIHRhYmxlKSB7XG4gICAgICBpZiAob2JqLm1hdGNoZXMpIHtcbiAgICAgICAgZm9yIChsZXQgbWF0Y2ggb2Ygb2JqLm1hdGNoZXMpIHtcbiAgICAgICAgICBpZiAodGl0bGUgJiYgdGl0bGUuaW5jbHVkZXMobWF0Y2gpKSB7XG4gICAgICAgICAgICByZXR1cm4gb2JqLnRpdGxlO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGlmIChjYXRhbG9nUmVjb3JkTmFtZSkge1xuICAgIGxldCByZWZUaXRsZSA9IGxvb2t1cChjYXRhbG9nUmVjb3JkTmFtZSwgY2F0YWxvZ1JlY29yZE5hbWVUaWdodE1hdGNoZXMpO1xuICAgIGlmIChyZWZUaXRsZSkge1xuICAgICAgcmV0dXJuIHJlZlRpdGxlO1xuICAgIH1cbiAgfVxuXG4gIGlmIChmaWxtVGl0bGUpIHtcbiAgICBsZXQgcmVmVGl0bGUgPSBsb29rdXAoZmlsbVRpdGxlLCBmaWxtVGl0bGVUaWdodE1hdGNoZXMpO1xuICAgIGlmIChyZWZUaXRsZSkge1xuICAgICAgcmV0dXJuIHJlZlRpdGxlO1xuICAgIH1cbiAgfVxuXG4gIGlmIChjYXRhbG9nUmVjb3JkTmFtZSkge1xuICAgIGxldCByZWZUaXRsZSA9IGxvb2t1cChjYXRhbG9nUmVjb3JkTmFtZSwgY2F0YWxvZ1JlY29yZE5hbWVMb29zZU1hdGNoZXMpO1xuICAgIGlmIChyZWZUaXRsZSkge1xuICAgICAgcmV0dXJuIHJlZlRpdGxlO1xuICAgIH1cbiAgfVxuXG4gIGlmIChmaWxtVGl0bGUpIHtcbiAgICBsZXQgcmVmVGl0bGUgPSBsb29rdXAoZmlsbVRpdGxlLCBmaWxtVGl0bGVMb29zZU1hdGNoZXMpO1xuICAgIGlmIChyZWZUaXRsZSkge1xuICAgICAgcmV0dXJuIHJlZlRpdGxlO1xuICAgIH1cbiAgfVxuXG4gIC8vIG5vIG1hdGNoZXNcbiAgaWYgKGNhdGFsb2dSZWNvcmROYW1lICYmIGZpbG1UaXRsZSkge1xuICAgIC8vIGNob29zZSB0aGUgc2hvcnRlciBvbmVcbiAgICByZXR1cm4gZmlsbVRpdGxlLmxlbmd0aCA8IGNhdGFsb2dSZWNvcmROYW1lLmxlbmd0aCA/IGZpbG1UaXRsZSA6IGNhdGFsb2dSZWNvcmROYW1lO1xuICB9XG4gIGlmIChjYXRhbG9nUmVjb3JkTmFtZSkge1xuICAgIHJldHVybiBjYXRhbG9nUmVjb3JkTmFtZTtcbiAgfVxuICBpZiAoZmlsbVRpdGxlKSB7XG4gICAgcmV0dXJuIGZpbG1UaXRsZTtcbiAgfVxuXG4gIHJldHVybiBcIlVuY2xhc3NpZmllZFwiO1xufVxuXG5mdW5jdGlvbiBidWlsZEltYWdlQ2l0YXRpb24oZGF0YSwgZ2QsIGJ1aWxkZXIpIHtcbiAgYnVpbGRlci5kYXRhYmFzZUhhc0ltYWdlcyA9IHRydWU7XG5cbiAgaWYgKGRhdGEuZmlsbVRpdGxlKSB7XG4gICAgYnVpbGRlci5zb3VyY2VUaXRsZSA9IGRhdGEuZmlsbVRpdGxlO1xuICB9IGVsc2Uge1xuICAgIGJ1aWxkZXIuc291cmNlVGl0bGUgPSBkYXRhLmNhdGFsb2dSZWNvcmROYW1lO1xuICB9XG5cbiAgbGV0IGltYWdlTGluayA9IGJ1aWxkRnNJbWFnZUxpbmsoZGF0YS51cmwpO1xuICBidWlsZGVyLnJlY29yZExpbmtPclRlbXBsYXRlID0gaW1hZ2VMaW5rO1xuXG4gIGJ1aWxkZXIuZGF0YVN0cmluZyA9IGJ1aWxkRGF0YVN0cmluZyhkYXRhLCBnZCwgYnVpbGRlci5vcHRpb25zLmNpdGF0aW9uX2ZzX2RhdGFTdHlsZSwgYnVpbGRlcik7XG5cbiAgYnVpbGRlci5zb3VyY2VSZWZlcmVuY2UgPSBidWlsZFNvdXJjZVJlZmVyZW5jZShkYXRhLCBnZCwgYnVpbGRlci5vcHRpb25zKTtcbiAgaWYgKCFidWlsZGVyLnNvdXJjZVJlZmVyZW5jZSkge1xuICAgIGJ1aWxkZXIuc291cmNlUmVmZXJlbmNlID0gXCJcIjtcbiAgfVxuXG4gIGxldCBuZXdTb3VyY2VSZWZlcmVuY2UgPSBcIlwiO1xuICBpZiAoZGF0YS5jYXRhbG9nUmVjb3JkTGluayAmJiBkYXRhLmNhdGFsb2dSZWNvcmROYW1lKSB7XG4gICAgbGV0IGxpbmtUZXh0ID0gZGF0YS5jYXRhbG9nUmVjb3JkTmFtZTtcbiAgICBuZXdTb3VyY2VSZWZlcmVuY2UgKz0gXCJDYXRhbG9nOiBcIjtcbiAgICBuZXdTb3VyY2VSZWZlcmVuY2UgKz0gXCJbXCIgKyBkYXRhLmNhdGFsb2dSZWNvcmRMaW5rICsgXCIgXCIgKyBsaW5rVGV4dCArIFwiXVwiO1xuXG4gICAgaWYgKGRhdGEuZmlsbU5vdGUpIHtcbiAgICAgIGxldCBub3RlID0gZGF0YS5maWxtTm90ZTtcbiAgICAgIGlmIChub3RlLnN0YXJ0c1dpdGgobGlua1RleHQpKSB7XG4gICAgICAgIG5vdGUgPSBub3RlLnN1YnN0cmluZyhsaW5rVGV4dCkudHJpbSgpO1xuICAgICAgfVxuICAgICAgbmV3U291cmNlUmVmZXJlbmNlICs9IFwiIFwiICsgbm90ZTtcbiAgICB9XG4gIH1cblxuICBpZiAoZGF0YS5maWxtTnVtYmVyIHx8IGRhdGEuaW1hZ2VCcm93c2VQYXRoIHx8IGRhdGEudG90YWxJbWFnZXMpIHtcbiAgICBpZiAobmV3U291cmNlUmVmZXJlbmNlKSB7XG4gICAgICBpZiAoYnVpbGRlci5vcHRpb25zLmNpdGF0aW9uX2dlbmVyYWxfYWRkQnJlYWtzV2l0aGluQm9keSkge1xuICAgICAgICBuZXdTb3VyY2VSZWZlcmVuY2UgKz0gXCI8YnIvPlwiO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbmV3U291cmNlUmVmZXJlbmNlICs9IFwiOyBcIjtcbiAgICAgIH1cbiAgICAgIGlmIChidWlsZGVyLnR5cGUgIT0gXCJzb3VyY2VcIiAmJiBidWlsZGVyLm9wdGlvbnMuY2l0YXRpb25fZ2VuZXJhbF9hZGROZXdsaW5lc1dpdGhpbkJvZHkpIHtcbiAgICAgICAgbmV3U291cmNlUmVmZXJlbmNlICs9IFwiXFxuXCI7XG4gICAgICB9XG4gICAgfVxuICAgIGlmIChkYXRhLmltYWdlQnJvd3NlUGF0aCkge1xuICAgICAgbmV3U291cmNlUmVmZXJlbmNlICs9IFwiSW1hZ2UgcGF0aDogXCIgKyBkYXRhLmltYWdlQnJvd3NlUGF0aDtcbiAgICB9IGVsc2UgaWYgKGRhdGEuZmlsbU51bWJlcikge1xuICAgICAgbmV3U291cmNlUmVmZXJlbmNlICs9IFwiRmlsbSBudW1iZXI6IFwiICsgZGF0YS5maWxtTnVtYmVyO1xuICAgIH1cblxuICAgIC8vIHRoaXMgaXMgYSB3b3JrYXJvdW5kIGZvciBVbml0IFRlc3RzLiBJbiBVbml0IFRlc3RzIHRoZSBpbWFnZU51bWJlciBpcyBlbXB0eSBiZWNhdXNlIG9mIHRoZVxuICAgIC8vIHdheSB0aGUgdGV4dCBpbnB1dCB3b3Jrc1xuICAgIGlmIChkYXRhLnRvdGFsSW1hZ2VzKSB7XG4gICAgICBsZXQgaW1hZ2VOdW1iZXIgPSBkYXRhLmltYWdlTnVtYmVyO1xuICAgICAgaWYgKCFpbWFnZU51bWJlcikge1xuICAgICAgICBpbWFnZU51bWJlciA9IFwiP1wiO1xuICAgICAgfVxuICAgICAgbmV3U291cmNlUmVmZXJlbmNlICs9IFwiID4gaW1hZ2UgXCIgKyBpbWFnZU51bWJlciArIFwiIG9mIFwiICsgZGF0YS50b3RhbEltYWdlcztcbiAgICB9XG4gIH1cblxuICBpZiAoYnVpbGRlci5zb3VyY2VSZWZlcmVuY2UpIHtcbiAgICBuZXdTb3VyY2VSZWZlcmVuY2UgKz0gXCI7IFwiICsgYnVpbGRlci5zb3VyY2VSZWZlcmVuY2U7XG4gIH1cblxuICBidWlsZGVyLnNvdXJjZVJlZmVyZW5jZSA9IG5ld1NvdXJjZVJlZmVyZW5jZTtcblxuICBidWlsZGVyLm1lYW5pbmdmdWxUaXRsZSA9IGdldEltYWdlUmVmVGl0bGUoZGF0YS5jYXRhbG9nUmVjb3JkTmFtZSwgZGF0YS5maWxtVGl0bGUpO1xufVxuXG5mdW5jdGlvbiBnZXRSZWZUaXRsZShlZCwgZ2QpIHtcbiAgY29uc3QgcmVjb3JkVHlwZVRvUmVmVGl0bGUgPSBbXG4gICAge1xuICAgICAgdHlwZTogUlQuTWFycmlhZ2UsXG4gICAgICBkZWZhdWx0VGl0bGU6IFwiTWFycmlhZ2VcIixcbiAgICAgIHRpdGxlTWF0Y2hlczogW3sgdGl0bGU6IFwiTWFycmlhZ2UgQm9uZFwiLCBtYXRjaGVzOiBbXCJNYXJyaWFnZSBCb25kXCJdIH1dLFxuICAgIH0sXG4gICAge1xuICAgICAgdHlwZTogUlQuTWlsaXRhcnlTZXJ2aWNlLFxuICAgICAgZGVmYXVsdFRpdGxlOiBcIk1pbGl0YXJ5IFNlcnZpY2VcIixcbiAgICAgIHRpdGxlTWF0Y2hlczogW3sgdGl0bGU6IFwiTmF2eSBBbGxvdG1lbnRcIiwgbWF0Y2hlczogW1wiTmF2eSBBbGxvdG1lbnRcIl0gfV0sXG4gICAgfSxcbiAgICB7XG4gICAgICB0eXBlOiBSVC5FbGVjdG9yYWxSZWdpc3RlcixcbiAgICAgIGRlZmF1bHRUaXRsZTogXCJWb3RlciBSZWdpc3RyYXRpb25cIixcbiAgICAgIGFkZFllYXI6IHRydWUsXG4gICAgICB0aXRsZU1hdGNoZXM6IFt7IHRpdGxlOiBcIkVsZWN0b3JhbCBSZWdpc3RlclwiLCBtYXRjaGVzOiBbXCJFbGVjdG9yYWwgUmVnaXN0ZXJcIl0gfV0sXG4gICAgfSxcbiAgXTtcblxuICBsZXQgcmVmVGl0bGUgPSBnZC5nZXRSZWZUaXRsZShlZC5jb2xsZWN0aW9uVGl0bGUsIHJlY29yZFR5cGVUb1JlZlRpdGxlKTtcblxuICBpZiAocmVmVGl0bGUgJiYgcmVmVGl0bGUgIT0gXCJVbmNsYXNzaWZpZWRcIikge1xuICAgIHJldHVybiByZWZUaXRsZTtcbiAgfVxuXG4gIHJldHVybiBcIlwiO1xufVxuXG5mdW5jdGlvbiBidWlsZENpdGF0aW9uKGlucHV0KSB7XG4gIGNvbnN0IGRhdGEgPSBpbnB1dC5leHRyYWN0ZWREYXRhO1xuICBjb25zdCBnZCA9IGlucHV0LmdlbmVyYWxpemVkRGF0YTtcbiAgY29uc3QgcnVuRGF0ZSA9IGlucHV0LnJ1bkRhdGU7XG4gIGNvbnN0IG9wdGlvbnMgPSBpbnB1dC5vcHRpb25zO1xuICBjb25zdCB0eXBlID0gaW5wdXQudHlwZTsgLy8gXCJpbmxpbmVcIiwgXCJuYXJyYXRpdmVcIiBvciBcInNvdXJjZVwiXG5cbiAgbGV0IGJ1aWxkZXIgPSBuZXcgQ2l0YXRpb25CdWlsZGVyKHR5cGUsIHJ1bkRhdGUsIG9wdGlvbnMpO1xuICBidWlsZGVyLmhvdXNlaG9sZFRhYmxlU3RyaW5nID0gaW5wdXQuaG91c2Vob2xkVGFibGVTdHJpbmc7XG5cbiAgaWYgKGRhdGEucGFnZVR5cGUgPT0gXCJyZWNvcmRcIikge1xuICAgIHZhciBjaXRhdGlvbiA9IGJ1aWxkQ29yZUNpdGF0aW9uKGRhdGEsIGdkLCBidWlsZGVyKTtcblxuICAgIC8vIEdldCBtZWFuaW5nZnVsIHRpdGxlXG4gICAgbGV0IHJlZlRpdGxlID0gZ2V0UmVmVGl0bGUoZGF0YSwgaW5wdXQuZ2VuZXJhbGl6ZWREYXRhKTtcbiAgICBidWlsZGVyLm1lYW5pbmdmdWxUaXRsZSA9IHJlZlRpdGxlO1xuXG4gICAgaWYgKHR5cGUgPT0gXCJuYXJyYXRpdmVcIikge1xuICAgICAgYnVpbGRlci5hZGROYXJyYXRpdmUoZ2QsIGlucHV0LmRhdGFDYWNoZSwgb3B0aW9ucyk7XG4gICAgfVxuICB9IGVsc2UgaWYgKGRhdGEucGFnZVR5cGUgPT0gXCJpbWFnZVwiKSB7XG4gICAgYnVpbGRJbWFnZUNpdGF0aW9uKGRhdGEsIGdkLCBidWlsZGVyKTtcbiAgfVxuXG4gIC8vIG5vdyB0aGUgYnVpbGRlciBpcyBzZXR1cCB1c2UgaXQgdG8gYnVpbGQgdGhlIGNpdGF0aW9uIHRleHRcbiAgbGV0IGZ1bGxDaXRhdGlvbiA9IGJ1aWxkZXIuZ2V0Q2l0YXRpb25TdHJpbmcoKTtcblxuICAvL2NvbnNvbGUubG9nKGZ1bGxDaXRhdGlvbik7XG5cbiAgdmFyIGNpdGF0aW9uT2JqZWN0ID0ge1xuICAgIGNpdGF0aW9uOiBmdWxsQ2l0YXRpb24sXG4gICAgdHlwZTogdHlwZSxcbiAgfTtcblxuICByZXR1cm4gY2l0YXRpb25PYmplY3Q7XG59XG5cbmV4cG9ydCB7IGJ1aWxkQ2l0YXRpb24gfTtcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./extension/site/fs/core/fs_build_citation.mjs\n");

/***/ }),

/***/ "./extension/site/fs/core/fs_extract_data.mjs":
/*!****************************************************!*\
  !*** ./extension/site/fs/core/fs_extract_data.mjs ***!
  \****************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"extractData\": () => (/* binding */ extractData),\n/* harmony export */   \"extractDataFromFetch\": () => (/* binding */ extractDataFromFetch)\n/* harmony export */ });\n/*\nMIT License\n\nCopyright (c) 2020 Robert M Pavey\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.\n*/\n\nconst useOldSystem = false;\n\nfunction cleanText(text) {\n  if (!text) {\n    return \"\";\n  }\n\n  text = text.replace(/\\s+/g, \" \"); // eliminate nbsp and multiple spaces etc\n\n  // sometimes the text is something like \"Zachariah Davey[Zechariah Pavey]\"\n  // in that case add a space before the [\n  text = text.replace(/([^\\s])\\[/, \"$1 [\");\n\n  text = text.trim();\n\n  return text;\n}\n\nfunction cleanLabel(text) {\n  if (!text) {\n    return \"\";\n  }\n\n  text = text.replace(/\\s/g, \" \"); // eliminate nbsp etc\n  text = text.trim();\n\n  // remove trailing :\n  text = text.replace(/\\s*\\:+$/, \"\");\n\n  return text;\n}\n\nfunction getVisibleTextInNode(node) {\n  let text = \"\";\n\n  if (query.length > 0) {\n    // loop over all the contents (which includes text nodes) and add in only the visbile ones\n    let contents = node.childNodes;\n    if (contents) {\n      for (let childIndex = 0; childIndex < contents.length; childIndex++) {\n        let child = contents[childIndex];\n\n        if (child.getAttribute(\"style\") != \"display: none;\") {\n          text += child.textContent;\n        }\n      }\n    }\n  }\n\n  return text;\n}\n\nfunction extractRecordData(table, result) {\n  var recordDataRows = table.querySelectorAll(\"tr\");\n\n  result.recordData = Object.create(null);\n  let recordData = result.recordData;\n\n  if (!recordDataRows) {\n    return;\n  }\n\n  for (let rowIndex = 0; rowIndex < recordDataRows.length; rowIndex++) {\n    let row = recordDataRows[rowIndex];\n\n    if (row.getAttribute(\"style\") == \"display: none;\") {\n      // There can be rows for many records present if this is a model popup dialog\n      // and multiple records have been clicked on one after the other\n      continue;\n    }\n\n    if (row.getAttribute(\"class\") == \"non-principal-info\") {\n      result.otherPersonRecordData = Object.create(null);\n      recordData = result.otherPersonRecordData;\n    }\n\n    // Get the label of the row (must be immediate child)\n    let label = row.querySelector(\"> th\").textContent;\n    if (label != \"\") {\n      label = cleanLabel(label);\n      let numChildren = row.querySelector(\"td\").children.length;\n\n      if (numChildren == 0) {\n        let value = row.querySelector(\"td\").textContent;\n        value = value.replace(/\\s+/g, \" \").trim();\n        recordData[label] = value;\n      } else {\n        // there are children. There are several cases to handle here\n        if (numChildren == 1) {\n          // sometimes there is a shadowRoot\n          let child = row.querySelector(\"td\").children[0];\n          if (child.shadowRoot) {\n            let span = child.shadowRoot.querySelector(\"span\");\n\n            let value = getVisibleTextInNode(span);\n            value = cleanText(value);\n            if (value != \"\") {\n              recordData[label] = value;\n            }\n          } else {\n            // for now just get the text of all the children, this can happen for \"Name:\" in death reg\n            // If can also happen for \"Inferred Spouse:\" in 1939 reg.\n            let value = getVisibleTextInNode(row.querySelector(\"td\"));\n            value = cleanText(value);\n            if (value != \"\") {\n              recordData[label] = value;\n            }\n          }\n        } else {\n          //console.log(\"Num children = \" + numChildren + \". \" + label);\n          // for now just use the text of the TD itself and not children (if any)\n          let value = getVisibleTextInNode(row.querySelector(\"td\"));\n          value = cleanText(value);\n          if (value) {\n            recordData[label] = value;\n          } else {\n            console.log(\"Unhandled case: Num children = \" + numChildren + \". \" + label);\n          }\n        }\n      }\n    } else {\n      // this row doesn't have a <th> label. Could be something like \"Household members\"\n      if (row.classList.contains(\"tableContainerRow\")) {\n        let table = row.querySelector(\"table\");\n\n        // collect all the headings and put them in a string with line breaks between them\n        let headings = table.querySelectorAll.find(\"thead tr th\");\n        let label = \"\";\n        if (headings) {\n          for (let colIndex = 0; colIndex < headings.length; colIndex++) {\n            let headingQ = headings[colIndex];\n            if (label) {\n              label += \"<br/>\";\n            }\n            label += cleanText(heading.textContent);\n          }\n        }\n\n        // now get each row of data and put them all in one string with line breaks between rows\n        let subTableRows = table.querySelectorAll(\"tbody tr\");\n        if (subTableRows) {\n          let value = \"\";\n          for (let subRowIndex = 0; subRowIndex < subTableRows.length; subRowIndex++) {\n            let subRow = subTableRows[subRowIndex];\n            if (value) {\n              value += \"<br/>\";\n            }\n            value += cleanText(subRow.textContent);\n          }\n          if (value) {\n            recordData[label] = value;\n          }\n        }\n      }\n    }\n  }\n}\n\nfunction extractRelatives(relatives, result) {\n  if (relatives.length > 0) {\n    let rows = relatives.querySelectorAll(\"div.relative\");\n\n    if (rows && rows.length > 0) {\n      result.relatives = [];\n\n      for (let rowIndex = 0; rowIndex < rows.length; rowIndex++) {\n        let row = rows[rowIndex];\n\n        if (row.getAttribute(\"style\") == \"display: none;\") {\n          // There can be rows for many records present if this is a model popup dialog\n          // and multiple records have been clicked on one after the other\n          continue;\n        }\n\n        let cells = row.querySelectorAll(\"div[role=gridcell]\");\n        if (cells && cells.length > 0) {\n          let rowObject = Object.create(null);\n          result.relatives.push(rowObject);\n\n          for (let cellIndex = 0; cellIndex < cells.length; cellIndex++) {\n            let cell = cells[cellIndex];\n\n            let label = cell.getAttribute(\"aria-label\");\n            let value = cleanText(cell.textContent);\n\n            if (label != \"\") {\n              rowObject[label] = value;\n            }\n          }\n        }\n      }\n    }\n  }\n}\n\nfunction extractDataForImage(filmViewerNode, result) {\n  // Example images:\n\n  // This one has transcribed data under \"Image Index\"\n  // https://www.familysearch.org/ark:/61903/3:1:S3HT-DR17-4Y9?i=5&wc=M8VJ-GZ9%3A160750101%2C160953901%2C161035601&cc=1824690\n\n  // No index on this one from Whiting-2417\n  // https://www.familysearch.org/ark:/61903/3:1:3QS7-89WL-VKSC?i=379&wc=M7CD-S6D%3A358132901%2C360400601&cc=2078654\n\n  // Hood-6574 has many images cited.\n  // This one has transcription:\n  // https://www.familysearch.org/ark:/61903/3:1:3QS7-89SS-998T?i=31&cc=1804888\n\n  // This one does not:\n  // https://www.familysearch.org/ark:/61903/3:1:3Q9M-CS3J-D77F-1?cat=157396\n\n  let filmNumberNode = filmViewerNode.querySelector(\"div.film-number\");\n  if (filmNumberNode) {\n    let filmNumberText = filmNumberNode.textContent;\n    result.filmNumber = filmNumberText.replace(/^Film\\s*\\#\\s*/, \"\").trim();\n  }\n\n  let crumbsNode = filmViewerNode.querySelector(\"fs-waypoint-crumbs\");\n  if (crumbsNode) {\n    let browsePath = \"\";\n    let crumbList = crumbsNode.querySelector(\"nav > ul\");\n    if (crumbList) {\n      let children = crumbList.children;\n      for (let index = 0; index < children.length; index++) {\n        let child = children[index];\n        let childDataNgRepeat = child.getAttribute(\"data-ng-repeat\");\n        if (childDataNgRepeat && childDataNgRepeat.includes(\"crumb in crumbs\")) {\n          let childTitle = child.getAttribute(\"title\");\n          if (childTitle) {\n            if (browsePath) {\n              browsePath += \" > \";\n            }\n            browsePath += childTitle;\n          }\n        }\n      }\n    }\n    if (browsePath) {\n      result.imageBrowsePath = browsePath;\n    }\n\n    let titleNode = crumbsNode.querySelector(\"li.visible-phone > span\");\n    //console.log(\"titleQ.length = \" + titleQ.length);\n    if (titleNode) {\n      result.filmTitle = titleNode.textContent;\n    }\n    if (!result.filmNumber) {\n      filmNumberNode = crumbsNode.querySelector(\"li.hidden-phone > span.ng-scope\");\n      if (filmNumberNode) {\n        result.filmNumber = titleNode.textContent;\n      }\n    }\n  }\n\n  let pager = filmViewerNode.querySelector(\"div.openSDPager\");\n  if (pager) {\n    let input = pager.querySelector(\"input[name=currentTileNumber]\");\n    if (input) {\n      result.imageNumber = input.value;\n    }\n    let afterInput = pager.querySelector(\"label.afterInput\");\n    if (afterInput) {\n      let totalText = afterInput.textContent;\n      result.totalImages = totalText.replace(/^of\\s*/, \"\").trim();\n    }\n  }\n\n  let imageInfo = filmViewerNode.querySelector(\"fs-image-info-panel\");\n  if (imageInfo) {\n    let table = imageInfo.querySelector(\"table[data-ng-if=imageInfo\\\\.filmNotes]\");\n    if (table) {\n      let tableRows = table.querySelectorAll(\"tr.ng-scope\");\n      if (tableRows) {\n        if (tableRows.length == 1) {\n          let catalogLink = tableRows[0].querySelector(\"a.ng-binding\");\n          if (catalogLink) {\n            result.catalogRecordName = catalogLink.textContent;\n            // this link is relative to https://www.familysearch.org\n            result.catalogRecordLink = \"https://www.familysearch.org\" + catalogLink.getAttribute(\"href\");\n          }\n\n          let imageInfoCols = tableRows[0].querySelectorAll(\"td\");\n          if (imageInfoCols.length > 1) {\n            let itemNumberCol = imageInfoCols[1];\n            let itemNumber = itemNumberCol.textContent;\n            if (itemNumber) {\n              result.itemNumber = itemNumber;\n            }\n          }\n          if (imageInfoCols.length > 2) {\n            let noteCol = imageInfoCols[2];\n            let note = noteCol.textContent;\n            if (note) {\n              result.filmNote = note;\n            }\n          }\n        } else {\n          // there are multiple rows. See if they are all the same catalog\n          let catalogRecordName = \"\";\n          let catalogRecordLink = \"\";\n          let allAreTheSame = true;\n          for (let index = 0; index < tableRows.length; index++) {\n            let row = tableRows[index];\n            let catalogLink = row.querySelector(\"a.ng-binding\");\n            if (catalogLink) {\n              let newCatalogRecordName = catalogLink.textContent;\n              // this link is sometime relative to https://www.familysearch.org\n              let newCatalogRecordLink = catalogLink.getAttribute(\"href\");\n              if (!newCatalogRecordLink.startsWith(\"http\")) {\n                newCatalogRecordLink = \"https://www.familysearch.org\" + newCatalogRecordLink;\n              }\n\n              if (catalogRecordName == \"\" && catalogRecordLink == \"\") {\n                catalogRecordName = newCatalogRecordName;\n                catalogRecordLink = newCatalogRecordLink;\n              } else {\n                if (catalogRecordName != newCatalogRecordName || catalogRecordLink != newCatalogRecordLink) {\n                  allAreTheSame = false;\n                  break;\n                }\n              }\n            }\n          }\n\n          if (allAreTheSame) {\n            result.catalogRecordName = catalogRecordName;\n            result.catalogRecordLink = catalogRecordLink;\n          }\n        }\n      }\n    }\n\n    let citationNode = imageInfo.querySelector(\"p#image-citation\");\n    if (citationNode) {\n      result.citation = citationNode.textContent;\n    }\n  }\n\n  //console.log(\"extractDataForImage, result is:\");\n  //console.log(result);\n\n  if (result.filmNumber || result.imageNumber) {\n    result.pageType = \"image\";\n  } else {\n    // FS is an example of a site that says it's page load is complete but the data may not be\n    // there to extract.\n    //console.log(\"FS extractData, treating as incomplete\");\n    result.dataMayBeIncomplete = true;\n    result.pageType = \"unknown\";\n  }\n}\n\nfunction extractDataForPersonPage(document, result) {\n  function extractDateAndPlaceFromVitalsSection(cardSection, prefix) {\n    let dateElement = cardSection.querySelector(\"div.display-date\");\n    if (dateElement) {\n      let moreLessElement = dateElement.querySelector(\"fs-more-less\");\n      if (moreLessElement) {\n        let date = moreLessElement.getAttribute(\"title\");\n        //console.log(\"moreLessElement is :\");\n        //console.log(moreLessElement);\n        if (date) {\n          //console.log(\"date is :\");\n          //console.log(date);\n          result[prefix + \"Date\"] = date;\n        }\n\n        if (moreLessElement.shadowRoot) {\n          let spanElement = moreLessElement.shadowRoot.querySelector(\"span[data-test-more-less-text]\");\n          if (spanElement) {\n            let originalDate = spanElement.textContent;\n            if (originalDate && originalDate != \"false\") {\n              result[prefix + \"DateOriginal\"] = originalDate;\n            }\n          }\n        }\n      }\n    }\n    let placeElement = cardSection.querySelector(\"div.display-place\");\n    if (placeElement) {\n      let valueElement = placeElement.querySelector(\"[data-test-place]\");\n      if (valueElement) {\n        // can also use textContent to get place as entered.\n        let standardizedPlace = valueElement.getAttribute(\"title\");\n        if (standardizedPlace) {\n          result[prefix + \"Place\"] = standardizedPlace;\n        }\n        let originalPlace = valueElement.textContent;\n        if (originalPlace && originalPlace != \"false\") {\n          result[prefix + \"PlaceOriginal\"] = originalPlace;\n        }\n      }\n    }\n  }\n\n  function extractNamesFromFsTreePerson(fsTreePersonElement, resultObject) {\n    let nameDiv = fsTreePersonElement.querySelector(\"div.fs-person__name\");\n    if (nameDiv) {\n      let givenNameElement = nameDiv.querySelector(\"span.fs-person__given-name\");\n      if (givenNameElement) {\n        resultObject.givenName = givenNameElement.textContent;\n      }\n      let familyNameElement = nameDiv.querySelector(\"span.fs-person__family-name\");\n      if (familyNameElement) {\n        resultObject.surname = familyNameElement.textContent;\n      }\n      let fullNameElement = nameDiv.querySelector(\"span.fs-person__full-name\");\n      if (fullNameElement) {\n        resultObject.fullName = fullNameElement.textContent;\n      }\n    }\n  }\n\n  //console.log(\"extractDataForPersonPage:\");\n\n  result.pageType = \"person\";\n\n  let personPageElement = document.querySelector(\"fs-person-page\");\n  if (personPageElement && personPageElement.shadowRoot) {\n    // there are two places to get the person's name, one in header and one in vitals\n    let personElement = personPageElement.shadowRoot.querySelector(\"div.person-header-container > fs-tree-person\");\n    if (personElement) {\n      extractNamesFromFsTreePerson(personElement, result);\n    }\n\n    let detailsElement = personPageElement.shadowRoot.querySelector(\"#pages > fs-tree-person-details\");\n\n    if (detailsElement && detailsElement.shadowRoot) {\n      let vitalsElement = detailsElement.shadowRoot.querySelector(\"fs-tree-person-vitals\");\n\n      if (vitalsElement && vitalsElement.shadowRoot) {\n        //console.log(\"vitalsElement is :\");\n        //console.log(vitalsElement);\n\n        let cardElement = vitalsElement.shadowRoot.querySelector(\"fs-tree-collapsable-card.vitals\");\n\n        if (cardElement) {\n          //console.log(\"cardElement is :\");\n          //console.log(cardElement);\n\n          let listItems = cardElement.querySelectorAll(\"li\");\n          for (let listItem of listItems) {\n            //console.log(\"listItem is :\");\n            //console.log(listItem);\n\n            //console.log(\"listItem.style.display is :\");\n            //console.log(listItem.style.display);\n\n            // There can be random list items from previous people that have their display style set to none!\n            if (listItem.style.display != \"none\") {\n              let cardItem = listItem.querySelector(\"fs-tree-conclusion\");\n              if (cardItem) {\n                //console.log(\"cardItem is :\");\n                //console.log(cardItem);\n\n                if (cardItem.shadowRoot) {\n                  let cardSection = cardItem.shadowRoot.querySelector(\"section\");\n                  if (cardSection) {\n                    //console.log(\"cardSection is :\");\n                    //console.log(cardSection);\n\n                    let conclusionType = cardSection.getAttribute(\"data-test-conclusion-type\");\n\n                    if (conclusionType == \"NAME\") {\n                      let nameElement = cardSection.querySelector(\"div.display-name\");\n                      if (nameElement) {\n                        let name = nameElement.textContent;\n                        // we may already have name from header\n                        if (!result.fullName) {\n                          result.fullName = name;\n                        }\n                      }\n                    } else if (conclusionType == \"GENDER\") {\n                      let genderElement = cardSection.querySelector(\"div.display-gender\");\n                      if (genderElement) {\n                        let gender = genderElement.textContent;\n                        result.gender = gender;\n                      }\n                    } else if (conclusionType == \"BIRTH\") {\n                      extractDateAndPlaceFromVitalsSection(cardSection, \"birth\");\n                    } else if (conclusionType == \"DEATH\") {\n                      extractDateAndPlaceFromVitalsSection(cardSection, \"death\");\n                    }\n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n\n      let familyElement = detailsElement.shadowRoot.querySelector(\"fs-tree-person-family\");\n\n      if (familyElement && familyElement.shadowRoot) {\n        let cardElement = familyElement.shadowRoot.querySelector(\"fs-tree-collapsable-card.family\");\n\n        if (cardElement) {\n          let familyMembersElement = cardElement.querySelector(\"fs-family-members\");\n\n          if (familyMembersElement && familyMembersElement.shadowRoot) {\n            // Get spouses\n\n            let spousesElement = familyMembersElement.shadowRoot.querySelector(\"#spouses\");\n\n            if (spousesElement) {\n              let spouses = spousesElement.querySelectorAll(\"fs-family-members-block\");\n              for (let spouseBlockElement of spouses) {\n                if (spouseBlockElement.shadowRoot) {\n                  let familyBlock = spouseBlockElement.shadowRoot.querySelector(\"div.family-block\");\n                  if (familyBlock) {\n                    let couple = familyBlock.querySelector(\"fs-family-members-couple\");\n                    if (couple && couple.shadowRoot) {\n                      let spouse = {};\n\n                      let spouseElement = couple.shadowRoot.querySelector(\"fs-tree-person:not(.focusPerson)\");\n                      if (spouseElement) {\n                        extractNamesFromFsTreePerson(spouseElement, spouse);\n                      }\n\n                      let marriageDateElement = couple.shadowRoot.querySelector(\"span.marriage-date\");\n                      if (marriageDateElement) {\n                        let dateString = marriageDateElement.textContent;\n                        if (dateString) {\n                          dateString = dateString.replace(/^Marriage\\:\\s*/, \"\");\n                          spouse.marriageDateOriginal = dateString.trim();\n                        }\n                        let stdDateString = marriageDateElement.getAttribute(\"title\");\n                        if (stdDateString) {\n                          stdDateString = stdDateString.replace(/^Standard\\:\\s*/, \"\");\n                          spouse.marriageDate = stdDateString.trim();\n                        }\n                      }\n\n                      let marriagePlaceElement = couple.shadowRoot.querySelector(\"span.marriage-place\");\n                      if (marriagePlaceElement) {\n                        let placeString = marriagePlaceElement.textContent;\n                        if (placeString) {\n                          spouse.marriagePlaceOriginal = placeString.trim();\n                        }\n                        let stdPlaceString = marriagePlaceElement.getAttribute(\"title\");\n                        if (stdPlaceString) {\n                          stdPlaceString = stdPlaceString.replace(/^Standard\\:\\s*/, \"\");\n                          spouse.marriagePlace = stdPlaceString.trim();\n                        }\n                      }\n\n                      // add the spouse\n                      if (!result.spouses) {\n                        result.spouses = [];\n                      }\n                      result.spouses.push(spouse);\n                    }\n                  }\n                }\n              }\n            }\n\n            // Get parents\n\n            let parentsElement = familyMembersElement.shadowRoot.querySelector(\"#parents\");\n            if (parentsElement) {\n              let familyMembersBlock = parentsElement.querySelector(\"fs-family-members-block\");\n              if (familyMembersBlock && familyMembersBlock.shadowRoot) {\n                let familyBlock = familyMembersBlock.shadowRoot.querySelector(\"div.family-block\");\n                if (familyBlock) {\n                  let couple = familyBlock.querySelector(\"fs-family-members-couple\");\n                  if (couple && couple.shadowRoot) {\n                    let fatherElement = couple.shadowRoot.querySelector(\"fs-tree-person.male\");\n                    if (fatherElement) {\n                      let father = {};\n                      extractNamesFromFsTreePerson(fatherElement, father);\n                      result.father = father;\n                    }\n\n                    let motherElement = couple.shadowRoot.querySelector(\"fs-tree-person.female\");\n                    if (motherElement) {\n                      let mother = {};\n                      extractNamesFromFsTreePerson(motherElement, mother);\n                      result.mother = mother;\n                    }\n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n\n  //console.log(result);\n}\n\n// As of 12 Sep 2022  this new format page is an option from the old format page\nfunction extractDataForPersonPageFormat2(document, personId, result) {\n  function extractDateAndPlaceFromVitalsSection(conclusionElement, resultObject, prefix) {\n    let dateElement = conclusionElement.querySelector(\"span[data-testid='conclusion-date']\");\n    if (dateElement) {\n      let date = dateElement.textContent;\n      if (date) {\n        //console.log(\"date is :\");\n        //console.log(date);\n        if (prefix) {\n          resultObject[prefix + \"Date\"] = date;\n        } else {\n          resultObject[\"date\"] = date;\n        }\n      }\n    }\n    let placeElement = conclusionElement.querySelector(\"span[data-testid='conclusion-place']\");\n    if (placeElement) {\n      let place = placeElement.textContent;\n      if (place) {\n        if (prefix) {\n          resultObject[prefix + \"Place\"] = place;\n        } else {\n          resultObject[\"place\"] = place;\n        }\n      }\n    }\n  }\n\n  function extractNamesFromPersonItem(personItemElement, resultObject) {\n    let nameSpan = personItemElement.querySelector(\"span[data-testid='fullName']\");\n    if (nameSpan) {\n      resultObject.fullName = nameSpan.textContent;\n    }\n  }\n\n  //console.log(\"extractDataForPersonPageFormat2:\");\n\n  let mainContentNode = document.querySelector(\"main#main\");\n  if (!mainContentNode) {\n    return;\n  }\n\n  result.pageType = \"person\";\n\n  let vitalsElement = mainContentNode.querySelector(\"div[data-testid='section-card-vitals']\");\n  if (vitalsElement) {\n    //console.log(\"vitalsElement:\");\n    //console.log(vitalsElement);\n\n    let nameConclusionElement = vitalsElement.querySelector(\"div[data-testid='conclusionDisplay:NAME']\");\n    if (nameConclusionElement) {\n      let nameElement = nameConclusionElement.querySelector(\"span[data-testid='conclusion-name-template']\");\n      if (nameElement) {\n        result.fullName = nameElement.textContent;\n      }\n    }\n\n    let genderConclusionElement = vitalsElement.querySelector(\"div[data-testid='conclusionDisplay:GENDER']\");\n    if (genderConclusionElement) {\n      let genderElement = genderConclusionElement.querySelector(\"span[data-testid='conclusion-gender']\");\n      if (genderElement) {\n        result.gender = genderElement.textContent;\n      }\n    }\n\n    let birthConclusionElement = vitalsElement.querySelector(\"div[data-testid='conclusionDisplay:BIRTH']\");\n    if (birthConclusionElement) {\n      extractDateAndPlaceFromVitalsSection(birthConclusionElement, result, \"birth\");\n    }\n\n    let deathConclusionElement = vitalsElement.querySelector(\"div[data-testid='conclusionDisplay:DEATH']\");\n    if (deathConclusionElement) {\n      extractDateAndPlaceFromVitalsSection(deathConclusionElement, result, \"death\");\n    }\n  }\n\n  let familyElement = mainContentNode.querySelector(\"div[data-testid='section-card-family']\");\n  if (familyElement) {\n    let families = familyElement.querySelectorAll(\"div[data-testid^='family-']\");\n    for (let family of families) {\n      let familyId = family.getAttribute(\"data-testid\");\n      if (familyId.includes(personId)) {\n        // this is a spouse and children\n        let coupleElement = family.querySelector(\"ul[data-testid='couple-persons']\");\n        if (coupleElement) {\n          let couplePersons = coupleElement.querySelectorAll(\"li[data-testid='person-item']\");\n          if (couplePersons.length == 2) {\n            let spouseElement = undefined;\n            for (let person of couplePersons) {\n              if (!person.hasAttribute(\"focus-person\")) {\n                spouseElement = person;\n                break;\n              }\n            }\n            if (spouseElement) {\n              let spouse = {};\n              extractNamesFromPersonItem(spouseElement, spouse);\n\n              extractDateAndPlaceFromVitalsSection(coupleElement, spouse, \"marriage\");\n\n              if (!result.spouses) {\n                result.spouses = [];\n              }\n              result.spouses.push(spouse);\n            }\n          }\n        }\n      } else {\n        // this must be parents and siblings\n        let coupleElement = family.querySelector(\"ul[data-testid='couple-persons']\");\n        if (coupleElement) {\n          let couplePersons = coupleElement.querySelectorAll(\"li[data-testid='person-item']\");\n          if (couplePersons.length == 2) {\n            let fatherElement = couplePersons[0];\n            let motherElement = couplePersons[1];\n\n            let father = {};\n            extractNamesFromPersonItem(fatherElement, father);\n            result.father = father;\n\n            let mother = {};\n            extractNamesFromPersonItem(motherElement, mother);\n            result.mother = mother;\n          }\n        }\n      }\n    }\n  }\n\n  //console.log(result);\n}\n\nfunction extractDataForPopup(searchArtifactResults, result) {\n  let shadowRoot1 = searchArtifactResults.shadowRoot;\n\n  let fsRecordDetailsModal = shadowRoot1.querySelector(\"fs-record-details-modal\");\n\n  if (fsRecordDetailsModal) {\n    let shadowRoot2 = fsRecordDetailsModal.shadowRoot;\n\n    let fsRecordDetails = shadowRoot2.querySelector(\"fs-record-details\");\n\n    if (fsRecordDetails) {\n      let shadowRoot3 = fsRecordDetails.shadowRoot;\n\n      let recordDetails = shadowRoot3.querySelector(\"record-details\");\n\n      if (recordDetails) {\n        let shadowRoot4 = recordDetails.shadowRoot;\n\n        result.pageType = \"record popup\";\n\n        //  Document Info\n\n        let rdDocumentInfo = shadowRoot4.querySelector(\"rd-document-info\");\n        if (rdDocumentInfo) {\n          let shadowRoot5 = rdDocumentInfo.shadowRoot;\n\n          let collectionLink = shadowRoot5.querySelector(\"a.collection-link\");\n\n          if (collectionLink) {\n            result.collectionName = collectionLink.textContent;\n            // this link is relative to familysearch.org\n            result.collectionLink = collectionLink.getAttribute(\"href\");\n          }\n\n          let documentInfoFields = shadowRoot5.querySelector(\"div.document-info-inner > table.fields\");\n          if (documentInfoFields) {\n            var docTableResult = {};\n            extractRecordData(documentInfoFields, docTableResult);\n\n            result.docInfoData = docTableResult.recordData;\n          }\n\n          let citationNode = shadowRoot5.querySelector(\"p.citation\");\n\n          if (citationNode) {\n            result.citation = citationNode.textContent;\n          }\n        }\n\n        // Record details\n\n        let rdPerson = shadowRoot4.querySelector(\"rd-person\");\n        if (rdPerson) {\n          let shadowRoot5 = rdPerson.shadowRoot;\n\n          // Not sure if we need the person header - it gives the gender, name and collection title\n          // unless in the record of someone else (like a child) in which case it says that\n          let personHeader = shadowRoot5.querySelector(\"div.person-header\");\n\n          // get the main table data\n          let table = shadowRoot5.querySelector(\"table.fields\");\n          if (table) {\n            extractRecordData(table, result);\n          }\n\n          // sometimes (e.g. a census) there are relatives in a pseudo table\n          let relatives = shadowRoot5.querySelector(\"div.relatives\");\n          if (relatives) {\n            extractRelatives(relatives, result);\n          }\n        }\n      }\n    }\n  }\n}\n\nfunction extractData(document, url) {\n  //console.log(\"fs extractData, url = \" + url);\n\n  var result = {};\n\n  result.url = url;\n\n  // first determine what kind of page we are in.\n\n  let mainContent = document.querySelector(\"#main-content-section\");\n\n  //console.log(\"mainContent is\");\n  //console.log(mainContent);\n\n  if (mainContent) {\n    let filmViewerNode = mainContent.querySelector(\"fs-film-viewer\");\n    if (filmViewerNode) {\n      extractDataForImage(filmViewerNode, result);\n      return result;\n    } else if (url.startsWith(\"https://www.familysearch.org/tree/person/details/\")) {\n      // it is a person page\n      //console.log(\"extractData, it is a person:\");\n\n      extractDataForPersonPage(document, result);\n      return result;\n    }\n  } else {\n    mainContent = document.querySelector(\"#main\");\n    if (mainContent) {\n      // this is a newer format page, only supported for person pages currently\n      if (url.startsWith(\"https://www.familysearch.org/tree/person/details/\")) {\n        // it is a person page\n        //console.log(\"extractData, it is a person:\");\n\n        let personId = url.replace(\"https://www.familysearch.org/tree/person/details/\", \"\");\n\n        extractDataForPersonPageFormat2(document, personId, result);\n        return result;\n      } else {\n        console.log(\"page type is unknown but has a #main element\");\n        result.pageType = \"unknown\";\n      }\n    } else {\n      // page may be partially loaded\n      console.log(\"page type is unknown\");\n\n      result.pageType = \"unknown\";\n      result.dataMayBeIncomplete = true;\n    }\n  }\n\n  return result;\n\n  // Currently it never gets this far because we use fetch for non-image pages\n  // The below has been converted to not use jQuery but not tested\n  /*\n  let searchArtifactResults = document.querySelector(\"#main-content-section > div.full-width > search-artifact-results\");\n  if (searchArtifactResults) {\n    extractDataForPopup(searchArtifactResults, result)\n  }\n  else {\n    \n    let recordSection = document.querySelector(\"#main > div.css-1c8s46c-appCss > div > div > div.css-1psu6mv-readyCss\");\n\n    let header = recordSection.querySelector(\"> div > div.css-13hiha-headerCss\");\n    let leftSide = recordSection.querySelector(\"> div > div.css-dqaew8-recordCss > div > div:nth-child(1)\");\n    let rightSide = recordSection.querySelector(\"> div > div.css-dqaew8-recordCss > div > div:nth-child(2)\");\n\n    // left side\n    let mainPersonTable = leftSide.querySelector(\"> table\");\n\n    let additionalPersonsTable = document.querySelector(\"#additionalPersons > div > div.css-mt5p7h-additionalPersonRowCss > div.css-dfawkr-lowerBorderCss > div > div > table\");\n\n    let citationQ = rightSide.querySelector(\"#citation\");\n    result.citation = citation.textContent;\n\n\n    result.recordSection = recordSection;\n    result.header = header;\n    result.leftSide = leftSide;\n    result.rightSide = rightSide;\n    result.mainPersonTable = mainPersonTable;\n    result.additionalPersonsTable = additionalPersonsTable;\n  }\n\n  return result;\n  */\n}\n\nfunction getDateValueFromDate(date, fieldTypeEnding, labelId) {\n  if (date.values) {\n    for (let value of date.values) {\n      if (value.labelId == labelId) {\n        result.eventYear = value.text;\n      }\n    }\n  }\n  let closeMatch = undefined;\n  if (date.fields) {\n    for (let field of date.fields) {\n      let type = field.type;\n      if (type && type.endsWith(fieldTypeEnding)) {\n        for (let value of field.values) {\n          if (value.labelId == labelId) {\n            return value.text; // matches both type and labelId\n          }\n        }\n\n        if (!closeMatch && field.values.length > 0) {\n          closeMatch = field.values[0].text;\n        }\n      } else {\n        if (field.values) {\n          for (let value of field.values) {\n            if (value.labelId == labelId) {\n              if (!closeMatch && field.values.length > 0) {\n                closeMatch = field.values[0].text;\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n\n  return closeMatch;\n}\n\nfunction getCleanDateValueFromDate(date, fieldTypeEnding, labelId) {\n  let value = getDateValueFromDate(date, fieldTypeEnding, labelId);\n  if (value) {\n    // clean date\n    value = value.trim();\n    if (/^0\\d\\s/.test(value)) {\n      // remove leading zero\n      value = value.substring(1);\n    }\n    if (/^from /.test(value)) {\n      // can be like \"from 1861 to 1865\" in which case change to \"1861-1865\"\n      value = value.replace(/from (\\d+) to (\\d+)/, \"$1-$2\");\n    }\n  }\n  return value;\n}\n\nfunction setFieldFromDate(date, fieldTypeEnding, labelId, result, resultFieldName) {\n  let value = getCleanDateValueFromDate(date, fieldTypeEnding, labelId);\n  if (value) {\n    result[resultFieldName] = value;\n  }\n}\n\nfunction getPlaceValueFromPlace(place, fieldTypeEnding, labelId) {\n  if (place.values) {\n    if (labelId) {\n      for (let value of place.values) {\n        if (value.labelId == labelId) {\n          return value.text;\n        }\n      }\n    } else if (!fieldTypeEnding) {\n      if (values.length == 1) {\n        return values[0].text;\n      }\n    }\n  }\n  if (place.fields) {\n    for (let field of place.fields) {\n      if (field.values) {\n        let type = field.type;\n        for (let value of field.values) {\n          if ((type && fieldTypeEnding && type.endsWith(fieldTypeEnding)) || value.labelId == labelId) {\n            return value.text;\n          } else if (!fieldTypeEnding && !labelId) {\n            if (value.text) {\n              return value.text;\n            }\n          }\n        }\n      }\n    }\n  }\n\n  return undefined;\n}\n\nfunction cleanPlaceString(value) {\n  if (!value) {\n    return value;\n  }\n\n  while (value.startsWith(\",\")) {\n    value = value.substring(1).trim();\n  }\n\n  while (value.endsWith(\",\")) {\n    value = value.substring(0, value.length - 1).trim();\n  }\n\n  return value;\n}\n\nfunction getCleanPlaceValueFromPlace(place, fieldTypeEnding, labelId) {\n  let value = getPlaceValueFromPlace(place, fieldTypeEnding, labelId);\n  if (value) {\n    value = cleanPlaceString(value);\n  }\n  return value;\n}\n\nfunction setFieldFromPlace(place, fieldTypeEnding, labelId, result, resultFieldName) {\n  let value = getCleanPlaceValueFromPlace(place, fieldTypeEnding, labelId);\n  if (value) {\n    result[resultFieldName] = value;\n  }\n}\n\nfunction setFieldFromPlaceWithLabels(place, labelIdList, result, resultFieldName) {\n  for (let labelId of labelIdList) {\n    let value = getCleanPlaceValueFromPlace(place, \"\", labelId);\n    if (value) {\n      result[resultFieldName] = value;\n      return;\n    }\n  }\n}\n\nfunction checkForBadFmpLinks(result) {\n  // It seems pretty impossible to fix bad image links since within one document they can be off by varying\n  // offsets. I'm guessing that at some point the FMP document had multiple scans of the same page and that\n  // these were then removed which threw all the image numbers off.\n  // So perhaps the best solution is to make a list of document numbers that have issues and do not include\n  // FMP links for those.\n\n  const fmpDocsWithBadLinksFromFs = [\"GBC/1851/4307762/\"];\n\n  let url = result.externalImageUrl;\n\n  if (!url) {\n    return;\n  }\n\n  if (url.indexOf(\"findmypast.\") == -1) {\n    return;\n  }\n\n  // example FMP URL\n  // https://search.findmypast.co.uk/record?id=GBC/1851/4294847/01287&parentid=GBC/1851/0012732317\n\n  let queryIndex = url.indexOf(\"?\");\n  if (queryIndex != -1) {\n    let query = url.substring(queryIndex);\n\n    let idString = query.replace(/\\?id\\=([^&]+).*/, \"$1\");\n    //console.log(\"idString = \" + idString);\n    if (!idString || idString == query) {\n      return;\n    }\n\n    for (let badDoc of fmpDocsWithBadLinksFromFs) {\n      if (idString.startsWith(badDoc)) {\n        // do not use the FMP link - it is bad\n        //console.log(\"bad link\");\n        result.externalImageUrl = \"bad\";\n        return;\n      }\n    }\n  }\n}\n\nfunction isUrlAValidFullOrPartialFmpImageLink(url) {\n  // URL can be something like this:   \"GBC/1841/0276/0192&parentid=GBC/1841/0000933316\"\n  // In which case it requires some work to make this into a valid FMP url like\n  // https://search.findmypast.co.uk/record?id=GBC%2F1841%2F0276%2F0192&parentid=GBC%2F1841%2F0000933316\n  // Sometimes it is something like: \"GBC/1871/3907/0156\"\n  // In which case it needs an extra \"browse\" in the URL:\n  // https://search.findmypast.co.uk/record/browse?id=GBC/1871/3907/0156\n  // Sometimes it is not a valid FindMyPast image partial URL. Examples:\n  // \"43004_162028006053_0100-00630.j2k\"  (on a US Virginia death which does have a valid FS image)\n  // \"TNA%2FR39%2F1041%2F1041C%2F011%2F15\"  (on a UK 1939 register record)\n\n  if (!url) {\n    return false;\n  }\n\n  let isFindMyPast = false;\n\n  // Check for known formats that would not be valid\n  // example non-FMP link: \"D3608/1/4\"\n  let badFormats = [\n    /^\\w\\d+\\/\\d+\\/\\d+$/, // e.g. \"D3608/1/4\"\n    /^\\d+$/, // e.g. \"84\"\n    /^[\\w\\d]+$/, // e.g. \"D3608\"\n    /^[\\w\\d]+\\/$/, // e.g. \"nai001442165/\"\n  ];\n\n  let isBadArchiveIdFormat = false;\n  for (let regex of badFormats) {\n    if (regex.test(url)) {\n      isBadArchiveIdFormat = true;\n      break;\n    }\n  }\n\n  let hadParentId = false;\n\n  let parentIdIndex = url.toLowerCase().indexOf(\"parentid\");\n  if (parentIdIndex != -1) {\n    url = url.substring(0, parentIdIndex);\n    hadParentId = true;\n  }\n\n  if (!isBadArchiveIdFormat) {\n    let percentIndex = url.indexOf(\"%\");\n    let dotIndex = url.indexOf(\".\");\n    if (percentIndex == -1 && dotIndex == -1) {\n      // there may be more tests that we could do but for now say this is valid FMP\n      isFindMyPast = true;\n    }\n  }\n\n  return isFindMyPast;\n}\n\nfunction processImageLinks(document, result, options) {\n  let externalImageId = result.externalImageId;\n  let extImageUrl = result.extImageUrl;\n  let externalImageReference = result.externalImageReference;\n  let externalRecordSeqOrig = result.externalRecordSeqOrig;\n\n  let externalFilmNumber = undefined;\n  if (result.referenceData) {\n    externalFilmNumber = result.referenceData.externalFilmNumber;\n  }\n\n  if (result.digitalArtifact) {\n    const arkString = \"ark:/61903/3:1:\";\n    if (result.fsImageUrl) {\n      // we have both, delete the digitalArtifact if it is the same as the fsImageUrl\n      let iuArkIndex = result.fsImageUrl.indexOf(arkString);\n      let daArkIndex = result.digitalArtifact.indexOf(arkString);\n      if (iuArkIndex != -1 && daArkIndex != -1) {\n        let iuId = result.fsImageUrl.substring(iuArkIndex);\n        let daId = result.digitalArtifact.substring(daArkIndex);\n        let iuTermIndex = iuId.search(/[\\/\\?\\&]/);\n        if (iuTermIndex != -1) {\n          iuId = iuId.substring(0, iuTermIndex);\n        }\n        let daTermIndex = daId.search(/[\\/\\?\\&]/);\n        if (daTermIndex != -1) {\n          daId = daId.substring(0, daTermIndex);\n        }\n        if (iuId == daId) {\n          delete result.digitalArtifact;\n        }\n      }\n    } else {\n      let daArkIndex = result.digitalArtifact.indexOf(arkString);\n      let daFsIndex = result.digitalArtifact.indexOf(\"familysearch\");\n\n      if (daArkIndex != -1 && daFsIndex != -1) {\n        result.fsImageUrl = result.digitalArtifact;\n        delete result.digitalArtifact;\n      } else {\n        // it could be an FMP link like:\n        // http://search.findmypast.co.uk/record?id=GBC/1911/RG14/06751/0025&parentid=GBC/1911/RG14/06751/0025/4\n        // or an Ancestry link like:\n        // http://search.ancestry.com/iexec?htx=View&r=an&dbid=2703&iid=32848_B094051-00469\n\n        let fmpIndex = result.digitalArtifact.indexOf(\"findmypast\");\n        let ancestryIndex = result.digitalArtifact.indexOf(\".ancestry.\");\n        if (fmpIndex != -1 && !extImageUrl) {\n          extImageUrl = result.digitalArtifact;\n          delete result.digitalArtifact;\n        } else if (ancestryIndex != -1 && !extImageUrl) {\n          extImageUrl = result.digitalArtifact;\n          delete result.digitalArtifact;\n        } else {\n          // leave digitalArtifact for now, it may be related to the externalImageUrl\n        }\n      }\n    }\n  }\n\n  if (document) {\n    // use the document to determine if there is a valid image thumbnail\n    let restrictedImageThumb = document.querySelector(\"button[class*=restrictedImageThumbCss]\");\n    let imageThumb = document.querySelector(\"img[class*=-imageThumbCss]\");\n\n    if (result.fsImageUrl && imageThumb && restrictedImageThumb) {\n      // this implies that there is a valid FamilySearch image - so do not set externalImageUrl\n      return;\n    }\n  }\n\n  if (extImageUrl) {\n    // if it is an FMP link and starts with http then change it to https\n    let prefix = \"http://search.findmypast.\";\n    let prefixIndex = extImageUrl.indexOf(prefix);\n    if (prefixIndex != -1) {\n      let remainder = extImageUrl.substring(prefix.length);\n      extImageUrl = \"https://search.findmypast.\" + remainder;\n    }\n\n    result.externalImageUrl = extImageUrl;\n  } else if (externalImageId || externalFilmNumber) {\n    if (externalImageId && externalImageId.startsWith(\"http\")) {\n      result.externalImageUrl = externalImageId;\n    } else if (externalFilmNumber && externalFilmNumber.startsWith(\"http\")) {\n      result.externalImageUrl = externalFilmNumber;\n    } else {\n      let isFindMyPast = false;\n      let url = externalImageId;\n\n      if (result.citation.includes(\"findmypast\")) {\n        isFindMyPast = true;\n      } else {\n        if (isUrlAValidFullOrPartialFmpImageLink(externalImageId)) {\n          isFindMyPast = true;\n        }\n        // The code below was when I though the externalFilmNumber could be a value FMP partial URL\n        // I was looking at this FS record: england_baptism_1810_john_abberley\n        // But it turns out in that case it is a partial RECORD link\n        //else if (isUrlAValidFullOrPartialFmpImageLink(externalFilmNumber)) {\n        //  isFindMyPast = true;\n        //  url = externalFilmNumber;\n        //}\n      }\n\n      if (isFindMyPast) {\n        // is is possible that an externalUir of \"971304\" means FMP, have not confirmed yet\n        // Just assume the link is FMP for now\n        let domain = \"findmypast.co.uk\";\n        if (options && options.search_fmp_domain && options.search_fmp_domain != \"none\") {\n          domain = options.search_fmp_domain;\n        }\n\n        // sometimes the externalImageId actuall points to the record not the image.\n        // Example from england_baptism_1902_ella_giles\n        // \"externalImageId\": \"GBPRS/CANT/B/96288131\",\n        // \"externalImageReference\": \"GBPRS/CANT/005265403/00684\",\n        // \"externalRecordSeqOrig\": \"96288131\",\n        // In this case we want to use \"GBPRS/CANT/005265403/00684\"\n        if (externalImageReference && externalRecordSeqOrig) {\n          if (externalImageId.includes(externalRecordSeqOrig)) {\n            url = externalImageReference;\n          }\n          delete result.externalImageReference;\n          delete result.externalRecordSeqOrig;\n        }\n\n        let uriQuery = encodeURI(url);\n\n        let prefix = \"https://search.\" + domain + \"/record?id=\";\n\n        // if there is no parentId on the URL then the \"/browse\" part is required\n        if (!uriQuery.toLowerCase().includes(\"parentid\")) {\n          prefix = \"https://search.\" + domain + \"/record/browse?id=\";\n        }\n\n        let uri = prefix + uriQuery;\n        result.externalImageUrl = uri;\n      }\n    }\n\n    checkForBadFmpLinks(result);\n  }\n\n  if (result.digitalArtifact) {\n    if (result.digitalArtifact == result.externalImageUrl) {\n      delete result.digitalArtifact;\n    } else {\n      // In the cases I have seen that get here digitalArtifact is a variation of a findmypast link\n      // Sometimes it is a better link - i.e. externalImageUrl doesn't resolve but digitalArtifact does.\n      // But we don't have a way to test that. For now rmove it if it contains findmypast\n      if (result.digitalArtifact.indexOf(\"findmypast\") != -1) {\n        delete result.digitalArtifact;\n      }\n    }\n  }\n}\n\nfunction addRecordDataForFact(result, fact, factType) {\n  let factTypeWithSpaces = factType.replace(/([a-z])([A-Z])/g, \"$1 $2\");\n  if (fact.date) {\n    if (fact.date.original) {\n      let label = factTypeWithSpaces + \" Date\";\n      let value = fact.date.original;\n      result.recordData[label] = value;\n    }\n  }\n  if (fact.place) {\n    const placeLabelIdsToOverrideForFacts = {\n      Death: [{ label: \"LAST_RESIDENCE\", overrideKey: \"Last Residence\" }],\n    };\n\n    let labelIdsToOverride = placeLabelIdsToOverrideForFacts[factType];\n    let overrideKey = \"\";\n    if (labelIdsToOverride) {\n      let fieldLabelId = \"\";\n      if (fact.place.fields && fact.place.fields.length == 1) {\n        let values = fact.place.fields[0].values;\n        if (values && values.length == 1) {\n          fieldLabelId = values[0].labelId;\n        }\n      }\n      if (fieldLabelId) {\n        for (let labelToOverride of labelIdsToOverride) {\n          if (labelToOverride.label == fieldLabelId) {\n            overrideKey = labelToOverride.overrideKey;\n            break;\n          }\n        }\n      }\n    }\n\n    if (fact.place.original) {\n      let label = factTypeWithSpaces + \" Place\";\n      if (overrideKey) {\n        label = overrideKey;\n      }\n      let value = fact.place.original;\n      result.recordData[label] = value;\n    }\n  }\n  if (fact.value) {\n    let label = factTypeWithSpaces;\n    let value = fact.value;\n    result.recordData[label] = value;\n  }\n}\n\n// Identifying a field:\n//  fieldFsType, fieldGcType\n//  fieldFsTypePrefix, fieldGcTypePrefix\n//  sourceSection - the section containing fields (\"topLevel\", \"primaryPerson\", \"primaryFact\", \"otherFact\", \"relationship\")\n// Selecting a value in the field (if none specified first is used)\n//  valueType - this is a preference if there are multiple\n//  labelId\n//  labelIdPrefix\n// Specifying where to put value:\n//  recordDataField\n//  dataField\n//  referenceDataField\n// if none of the above exist then the field is ignored\n// As soon a a match is found later entries in fieldData are ignored?\n\nconst fieldData = [\n  // data and record data fields\n  {\n    fieldFsType: \"EventRegQtr\",\n    dataField: \"registrationQuarter\",\n    recordDataField: \"Registration Quarter\",\n  },\n  {\n    fieldFsType: \"EventRegDate\",\n    dataField: \"registrationDate\",\n    recordDataField: \"Registration Date\",\n  },\n  {\n    fieldGcType: \"Age\",\n    sourceSection: \"primaryPerson\",\n    valueType: \"Interpreted\",\n    dataField: \"age\",\n    recordDataField: \"Age\",\n  },\n\n  //  data fields\n  { fieldFsType: \"ExternalImageId\", dataField: \"externalImageId\" },\n  { fieldFsType: \"ExtImageReference\", dataField: \"externalImageReference\" },\n  { fieldFsType: \"ExtRecordSeqOrig\", dataField: \"externalRecordSeqOrig\" },\n  { fieldFsType: \"ExtImageUrl\", dataField: \"extImageUrl\" },\n  { fieldFsType: \"ExtRecordId\", dataField: \"externalRecordId\" },\n  { fieldFsType: \"ExtRecordType\", dataField: \"externalRecordType\" },\n  { fieldFsType: \"ExtUir\", dataField: \"externalUir\" },\n\n  { fieldFsType: \"ImageArk\", dataField: \"fsImageUrl\" },\n  { fieldFsType: \"ImageNumber\", dataField: \"fsImageNumber\" },\n  { fieldFsType: \"CollectionId\", dataField: \"fsCollectionId\" },\n\n  // record data fields\n  {\n    fieldFsType: \"MilBeginRank\",\n    valueType: \"Interpreted\",\n    recordDataField: \"Miitary Beginning Rank\",\n  },\n  {\n    fieldFsType: \"MilEndRank\",\n    valueType: \"Interpreted\",\n    recordDataField: \"Miitary Final Rank\",\n  },\n  {\n    fieldFsType: \"MilSide\",\n    valueType: \"Interpreted\",\n    recordDataField: \"Miitary Side\",\n  },\n  {\n    fieldFsType: \"MilUnit\",\n    valueType: \"Interpreted\",\n    recordDataField: \"Miitary Unit\",\n  },\n  {\n    fieldFsType: \"MilCompany\",\n    valueType: \"Interpreted\",\n    recordDataField: \"Military Company\",\n  },\n  // reference fields\n  {\n    fieldFsType: \"SourceScheduleType\",\n    referenceDataField: \"sourceScheduleType\",\n  },\n  { fieldFsType: \"SourcePieceFolio\", referenceDataField: \"sourcePieceFolio\" },\n  { fieldFsType: \"SourceVolume\", referenceDataField: \"sourceVolume\" },\n  { fieldFsType: \"SourcePage\", referenceDataField: \"sourcePageNbr\" },\n  { fieldFsType: \"SourcePageNbr\", referenceDataField: \"sourcePageNbr\" },\n  { fieldFsType: \"SourceLineNbr\", referenceDataField: \"sourceLineNbr\" },\n  { fieldFsType: \"SourceEntryNbr\", referenceDataField: \"sourceEntryNbr\" },\n  { fieldFsType: \"SourceRegNbr\", referenceDataField: \"sourceRegNbr\" },\n  { fieldFsType: \"LineNbr\", referenceDataField: \"lineNumber\" },\n  { fieldFsType: \"RefId\", referenceDataField: \"referenceId\" },\n  { fieldFsType: \"RecNbr\", referenceDataField: \"recordNumber\" },\n  { fieldFsType: \"RecNumber\", referenceDataField: \"recordNumber\" },\n  { fieldFsType: \"RecordNumber\", referenceDataField: \"recordNumber\" },\n  { fieldFsType: \"FileNumber\", referenceDataField: \"fileNumber\" },\n\n  { fieldFsType: \"DigitalFilmNumber\", referenceDataField: \"digitalFilmNumber\" },\n  { fieldFsType: \"FilmNumber\", referenceDataField: \"filmNumber\" },\n  { fieldFsType: \"ImageNbr\", referenceDataField: \"imageNumber\" },\n\n  { fieldFsType: \"PacketLtr\", referenceDataField: \"packetLetter\" },\n  { fieldFsType: \"PacketLetter\", referenceDataField: \"packetLetter\" },\n  { fieldFsType: \"SheetNumberLetter\", referenceDataField: \"sheetNumberLetter\" },\n  { fieldFsType: \"SheetNumber\", referenceDataField: \"sheetNumber\" },\n  { fieldFsType: \"SheetLtr\", referenceDataField: \"sheetLetter\" },\n  { fieldFsType: \"SourceSheetNbrLtr\", referenceDataField: \"sheetNumberLetter\" },\n  { fieldFsType: \"SourceSheetNbr\", referenceDataField: \"sheetNumber\" },\n  { fieldFsType: \"SourceSheetLtr\", referenceDataField: \"sheetLetter\" },\n\n  { fieldFsType: \"ExtFilmNbr\", referenceDataField: \"externalFilmNumber\" },\n  { fieldFsType: \"ExtPubNbr\", referenceDataField: \"externalPublicationNumber\" },\n  {\n    fieldFsType: \"ExtPubTitle\",\n    referenceDataField: \"externalPublicationTitle\",\n  },\n  { fieldFsType: \"ExtLineNbr\", referenceDataField: \"externalLineNumber\" },\n\n  // fields to ignore\n  { fieldFsType: \"UniqueId\" },\n  { fieldFsType: \"UniqueIdentifier\" },\n\n  { fieldFsType: \"EventPlaceLevel1Type\" },\n  { fieldFsType: \"EventPlaceLevel2Type\" },\n  { fieldFsType: \"EventPlaceLevel3Type\" },\n  { fieldFsType: \"EventPlaceLevel4Type\" },\n  { fieldFsType: \"EventPlaceLevel5Type\" },\n  { fieldFsType: \"EventPlaceLevelType\" },\n\n  { fieldFsType: \"EventPlaceLowestLevel\" },\n  { fieldFsType: \"EventCountry\", dataField: \"eventCountry\" },\n  { fieldFsType: \"EventCounty\", dataField: \"eventCounty\" },\n  { fieldFsType: \"EventState\", dataField: \"eventState\" },\n  { fieldFsType: \"EventDistrict\", dataField: \"eventDistrict\" },\n  { fieldFsType: \"EventCity\", dataField: \"eventCity\" },\n  { fieldFsType: \"MinorCivilDivision\" },\n\n  { fieldFsType: \"Evquarter\" },\n\n  { fieldFsType: \"ExtCountyCode\" },\n  { fieldFsType: \"CountyCode\" },\n  { fieldFsType: \"CountyId\" },\n  { fieldFsType: \"FolioNo\" },\n  { fieldFsType: \"DigitalFilmNumber\" },\n  { fieldFsType: \"FilmNumber\" },\n  { fieldFsType: \"ImageApid\" },\n  { fieldFsType: \"ImageId\" },\n  { fieldFsType: \"PpqId\" },\n  { fieldFsType: \"RecordGroup\" },\n  { fieldFsType: \"SortKey\" },\n  { fieldFsType: \"HouseholdId\" },\n  { fieldFsType: \"RelationshipToHeadCode\" },\n  { fieldFsType: \"SourceHouseholdId\" },\n\n  { fieldFsType: \"ExtData\" },\n  { fieldFsType: \"ExtLineNbrSuf\" },\n  { fieldFsType: \"ExtOccupationCode\" },\n  { fieldFsType: \"ExtPrBirPlaceCode\" },\n  { fieldFsType: \"ExtUarn\" },\n  { fieldFsType: \"ExtUrn\" },\n  { fieldFsType: \"ExtUrprn\" },\n\n  { fieldFsType: \"ExtAdditionalEntryFlag\" },\n  { fieldFsType: \"ExtLineNbr\" },\n  { fieldFsType: \"ExtPageCode\" },\n  { fieldFsType: \"ExtRefNbr\" },\n  { fieldFsType: \"AdditionalRelativesFlag\" },\n  { fieldFsType: \"TravelerTitle\" },\n  { fieldFsType: \"TravelerName\" },\n\n  { fieldFsType: \"Names\" }, // used for \"OTHER_NAMES\" label text\n\n  { fieldFsType: \"SourceDocumentType\" },\n  { fieldFsType: \"SourcePageType\" },\n  { fieldFsType: \"SourcePieceNbr\" },\n  { fieldFsType: \"SourceRecordType\" },\n  { fieldFsType: \"SourceScheduleType\" },\n  { fieldFsType: \"SourceComposite\" },\n  { fieldFsType: \"SourceBookNbr\" },\n  { fieldFsType: \"SourcePostalCode\" },\n  { fieldFsType: \"SystemOfOrigin\" },\n\n  { fieldFsType: \"RecordVersion\" },\n  { fieldFsType: \"UserModified\" },\n  { fieldFsType: \"CdsBatchId\" },\n  { fieldFsType: \"PublicationStatus\" },\n  { fieldFsType: \"PublishableUnit\" },\n\n  { fieldFsType: \"UdeBatchNumber\" },\n  { fieldFsType: \"BatchId\" },\n  { fieldFsType: \"BatchLocality\" },\n  { fieldFsType: \"Folder\" },\n  { fieldFsType: \"FolderImageSequence\" },\n  { fieldFsType: \"FolderImageSeq\" },\n\n  { fieldFsType: \"DasVerify\" }, // a date\n  { fieldFsType: \"EasyImageId\" },\n  { fieldFsType: \"RecordId\" },\n  { fieldFsType: \"ProjectId\" },\n  { fieldFsType: \"CtlFileId\" },\n  { fieldFsType: \"ImsImageId\" },\n  { fieldFsType: \"Language\" },\n  { fieldFsType: \"VerifyOrProofCode\" },\n  { fieldFsType: \"VerifyOrProofCode\" },\n\n  { fieldFsTypeRegEx: /^Pr[A-Z]/ },\n  { fieldFsTypeRegEx: /^Ed[A-Z]/ },\n  { fieldFsTypeRegEx: /Css$/ }, // fields with type ending \"Css\" can be ignored\n\n  { fieldFsTypePrefix: \"OtherOnPageNameGn\" },\n  { fieldFsTypePrefix: \"OtherOnPageNameSurn\" },\n  { fieldFsTypePrefix: \"OtherOnPageUrl\" },\n\n  { fieldFsTypePrefix: \"Ext\" },\n  { fieldFsTypePrefix: \"Fs\" },\n  { fieldFsTypePrefix: \"Idx\" },\n  { fieldFsTypePrefix: \"Nara\" },\n\n  // catchAll\n  {\n    recordDataFieldUseFsType: true,\n    recordDataFieldUseGcType: true,\n    valueType: \"Interpreted\",\n  },\n];\n\nfunction doesFieldDataMatch(entry, result, field, sourceSection) {\n  if (entry.sourceSection) {\n    if (entry.sourceSection != sourceSection) {\n      return false;\n    }\n  }\n\n  if (entry.fieldFsType) {\n    let match = false;\n    const fsTypePrefix = \"http://familysearch.org/types/fields/\";\n    if (field.type && field.type.startsWith(fsTypePrefix)) {\n      let fieldFsType = field.type.substring(fsTypePrefix.length);\n      if (fieldFsType == entry.fieldFsType) {\n        match = true;\n      }\n    }\n    if (!match) {\n      return false;\n    }\n  }\n\n  if (entry.fieldFsTypePrefix) {\n    let match = false;\n    const fsTypePrefix = \"http://familysearch.org/types/fields/\";\n    if (field.type && field.type.startsWith(fsTypePrefix)) {\n      let fieldFsType = field.type.substring(fsTypePrefix.length);\n      if (fieldFsType.startsWith(entry.fieldFsTypePrefix)) {\n        match = true;\n      }\n    }\n    if (!match) {\n      return false;\n    }\n  }\n\n  if (entry.fieldFsTypeRegEx) {\n    let match = false;\n    const fsTypePrefix = \"http://familysearch.org/types/fields/\";\n    if (field.type && field.type.startsWith(fsTypePrefix)) {\n      let fieldFsType = field.type.substring(fsTypePrefix.length);\n      if (entry.fieldFsTypeRegEx.test(fieldFsType)) {\n        match = true;\n      }\n    }\n    if (!match) {\n      return false;\n    }\n  }\n\n  if (entry.fieldGcType) {\n    let match = false;\n    const gcTypePrefix = \"http://gedcomx.org/\";\n    if (field.type && field.type.startsWith(gcTypePrefix)) {\n      let fieldGcType = field.type.substring(gcTypePrefix.length);\n      if (fieldGcType == entry.fieldGcType) {\n        match = true;\n      }\n    }\n    if (!match) {\n      return false;\n    }\n  }\n\n  return true;\n}\n\nfunction determineFieldValue(entry, field) {\n  if (!field.values || field.values.length < 1) {\n    return undefined;\n  }\n\n  let valueObj = field.values[0];\n  if (field.values.length > 1 && entry.valueType) {\n    // there can be an orig and an interpreted for example\n    for (let value of field.values) {\n      let valueType = value.type;\n      const gcTypePrefix = \"http://gedcomx.org/\";\n      if (valueType.startsWith(gcTypePrefix)) {\n        valueType = valueType.substring(gcTypePrefix.length);\n      }\n      if (valueType == entry.valueType) {\n        valueObj = value;\n        break;\n      }\n    }\n  }\n\n  return valueObj;\n}\n\nfunction addFieldDataValue(entry, result, field, valueObj) {\n  let value = valueObj.text;\n  if (!value) {\n    return;\n  }\n\n  if (entry.dataField) {\n    result[entry.dataField] = value;\n  }\n\n  let recordDataAdded = false;\n  if (entry.recordDataField) {\n    if (!result.recordData) {\n      result.recordData = {};\n    }\n    result.recordData[entry.recordDataField] = value;\n    recordDataAdded = true;\n  }\n\n  if (!recordDataAdded && entry.recordDataFieldUseFsType) {\n    let fieldType = undefined;\n    const fsTypePrefix = \"http://familysearch.org/types/fields/\";\n    if (field.type && field.type.startsWith(fsTypePrefix)) {\n      fieldType = field.type.substring(fsTypePrefix.length);\n    }\n\n    if (fieldType) {\n      let fieldName = fieldType.replace(/([a-z])([A-Z])/g, \"$1 $2\");\n\n      if (!result.recordData) {\n        result.recordData = {};\n      }\n      result.recordData[fieldName] = value;\n      recordDataAdded = true;\n    }\n  }\n\n  if (!recordDataAdded && entry.recordDataFieldUseGcType) {\n    let fieldType = undefined;\n    const gcTypePrefix = \"http://gedcomx.org/\";\n    if (field.type && field.type.startsWith(gcTypePrefix)) {\n      fieldType = field.type.substring(gcTypePrefix.length);\n    }\n\n    if (fieldType) {\n      let fieldName = fieldType.replace(/([a-z])([A-Z])/g, \"$1 $2\");\n\n      if (!result.recordData) {\n        result.recordData = {};\n      }\n      result.recordData[fieldName] = value;\n      recordDataAdded = true;\n    }\n  }\n\n  if (entry.referenceDataField) {\n    if (!result.referenceData) {\n      result.referenceData = {};\n    }\n    result.referenceData[entry.referenceDataField] = value;\n  }\n}\n\nfunction processField(result, field, sourceSection) {\n  for (let entry of fieldData) {\n    if (doesFieldDataMatch(entry, result, field, sourceSection)) {\n      let valueObj = determineFieldValue(entry, field);\n      if (valueObj) {\n        addFieldDataValue(entry, result, field, valueObj);\n        break;\n      }\n    }\n  }\n}\n\nfunction processFields(result, fields, sourceSection) {\n  if (!fields) {\n    return;\n  }\n\n  for (let field of fields) {\n    processField(result, field, sourceSection);\n  }\n}\n\nfunction isFieldTypeValidForRecordData(type) {\n  const typesToExclude = [\n    \"SourcePieceFolio\",\n    \"SourceLineNbr\",\n    \"SourceRegNbr\",\n    \"SourceEntryNbr\",\n    \"SourcePageNbr\",\n    \"SourceBookNbr\",\n    \"SourceHouseholdId\",\n    \"HouseholdId\",\n    \"FolioNo\",\n    \"CountyId\",\n    \"RelationshipToHead\",\n    \"RelationshipToHeadCode\",\n  ];\n\n  for (let fieldType of typesToExclude) {\n    if (type == fieldType) {\n      return false;\n    }\n  }\n\n  return true;\n}\n\nfunction getFactType(fact) {\n  let factType = fact.type;\n  const fsTypePrefix = \"http://familysearch.org/types/facts/\";\n  const gcTypePrefix = \"http://gedcomx.org/\";\n  if (factType.startsWith(fsTypePrefix)) {\n    factType = factType.substring(fsTypePrefix.length);\n  } else if (factType.startsWith(gcTypePrefix)) {\n    factType = factType.substring(gcTypePrefix.length);\n  }\n  return factType;\n}\n\nfunction getFactTypeFromRecordType(recordType) {\n  let factType = recordType;\n  const gcTypePrefix = \"http://gedcomx.org/\";\n  if (factType.startsWith(gcTypePrefix)) {\n    factType = factType.substring(gcTypePrefix.length);\n  }\n  return factType;\n}\n\nfunction setEventDateAndPlaceForFact(result, fact) {\n  if (fact.date) {\n    if (fact.date.original) {\n      result.eventDateOriginal = fact.date.original;\n    }\n    setFieldFromDate(fact.date, \"/Date\", \"EVENT_DATE\", result, \"eventDate\");\n    setFieldFromDate(fact.date, \"/Year\", \"EVENT_YEAR\", result, \"eventYear\");\n  }\n  if (fact.place) {\n    if (fact.place.original) {\n      result.eventPlaceOriginal = fact.place.original;\n    }\n    setFieldFromPlace(fact.place, \"\", \"EVENT_PLACE\", result, \"eventPlace\");\n    setFieldFromPlace(fact.place, \"/RegistrationDistrict\", \"\", result, \"registrationDistrict\");\n    setFieldFromPlace(fact.place, \"\", \"EVENT_PLACE_LEVEL_3\", result, \"eventPlaceL3\");\n    setFieldFromPlace(fact.place, \"/County\", \"EVENT_PLACE_LEVEL_2\", result, \"eventPlaceL2\");\n    setFieldFromPlace(fact.place, \"/Country\", \"EVENT_PLACE_LEVEL_1\", result, \"eventPlaceL1\");\n  }\n}\n\nfunction setDateAndPlaceForAdditionalFact(result, fact) {\n  let factType = getFactType(fact);\n  let prefix = factType;\n  if (fact.date) {\n    let date = getCleanDateValueFromDate(fact.date, \"/Date\", \"EVENT_DATE\");\n    if (date) {\n      result.recordData[prefix + \" Date\"] = date;\n    }\n\n    if (fact.date.original && fact.date.original != date) {\n      result.recordData[prefix + \" Date (Original)\"] = fact.date.original;\n    }\n\n    if (!fact.date.original && !date) {\n      let year = getCleanDateValueFromDate(fact.date, \"/Year\", \"EVENT_YEAR\");\n      if (year) {\n        result.recordData[prefix + \" Year\"] = year;\n      }\n    }\n  }\n  if (fact.place) {\n    let place = getCleanPlaceValueFromPlace(fact.place, \"\", \"EVENT_PLACE\");\n    if (place) {\n      result.recordData[prefix + \" Place\"] = place;\n    }\n\n    if (fact.place.original && fact.place.original != place) {\n      result.recordData[prefix + \" Place (Original)\"] = fact.place.original;\n    }\n  }\n}\n\nfunction doesLabelOverride(labelId, usedLabelId) {\n  const overrides = {\n    PR_AGE: [\"PR_AGE_ORIG\", \"PR_AGE_IN_YEARS_ORIG\"],\n    PR_RELATIONSHIP_TO_HEAD: [\"PR_RELATIONSHIP_TO_HEAD_ORIG\"],\n  };\n\n  if (!labelId) {\n    return false;\n  }\n\n  if (!usedLabelId) {\n    return true;\n  }\n\n  let labelOverrides = overrides[labelId];\n  if (labelOverrides && labelOverrides.includes(usedLabelId)) {\n    return true;\n  }\n\n  return false;\n}\n\nvar usedLabelIds = {};\n\nfunction extractFields(result, fields, map) {\n  if (!fields) {\n    return;\n  }\n\n  for (let field of fields) {\n    let fieldType = field.type;\n    if (fieldType && field.values && field.values.length > 0) {\n      const fsTypePrefix = \"http://familysearch.org/types/fields/\";\n      const gcTypePrefix = \"http://gedcomx.org/\";\n      if (fieldType.startsWith(fsTypePrefix)) {\n        fieldType = fieldType.substring(fsTypePrefix.length);\n      } else if (fieldType.startsWith(gcTypePrefix)) {\n        fieldType = fieldType.substring(gcTypePrefix.length);\n      }\n\n      let resultProperty = map[fieldType];\n      if (resultProperty) {\n        for (let value of field.values) {\n          const labelId = value.labelId;\n          let doesOverride = doesLabelOverride(labelId, usedLabelIds[resultProperty]);\n\n          if (!result[resultProperty] || doesOverride) {\n            result[resultProperty] = value.text;\n            usedLabelIds[resultProperty] = labelId;\n          }\n        }\n      }\n    }\n  }\n}\n\nfunction findPersonById(dataObj, personId) {\n  let persons = dataObj.persons;\n  if (persons) {\n    for (let person of persons) {\n      if (person.id == personId) {\n        return person;\n      }\n    }\n  }\n}\n\nfunction getPrimaryNameForm(person) {\n  let nameForms = [];\n  let nameArray = person.names;\n  if (nameArray && nameArray.length > 0) {\n    for (let name of nameArray) {\n      // this usually seems to be \"http://gedcomx.org/BirthName\" but can also be\n      // \"http://gedcomx.org/AlsoKnownAs\" which we ignore\n      let nameType = name.type;\n      if (nameType == \"http://gedcomx.org/BirthName\") {\n        for (let nameForm of name.nameForms) {\n          if (nameForm.parts) {\n            nameForms.push(nameForm);\n            break;\n          }\n        }\n      }\n    }\n  }\n\n  if (nameForms.length == 0) {\n    // for some record there are no parts - just a full name\n    if (nameArray && nameArray.length > 0) {\n      for (let name of nameArray) {\n        let nameType = name.type; // this always seems to be \"http://gedcomx.org/BirthName\"\n        if (name.nameForms && name.nameForms.length > 0) {\n          for (let nameForm of name.nameForms) {\n            if (nameForm.fields) {\n              nameForms.push(nameForm);\n              break;\n            }\n          }\n        }\n      }\n    }\n  }\n\n  if (nameForms.length == 0) {\n    return undefined;\n  }\n  if (nameForms.length == 1) {\n    return nameForms[0];\n  }\n\n  // there was more than one. The later ones could be corrected names. But sometimes the\n  // corrected one is missing fields like fullName\n  let firstNameForm = nameForms[0];\n  let lastNameForm = nameForms[nameForms.length - 1];\n\n  if (!lastNameForm.fullText) {\n    let lastParts = {};\n    if (lastNameForm.parts) {\n      for (let part of lastNameForm.parts) {\n        if (part.type.endsWith(\"Given\")) {\n          lastParts.givenName = part.value;\n        } else if (part.type.endsWith(\"Surname\")) {\n          lastParts.surname = part.value;\n        }\n      }\n    }\n    if (lastParts.givenName && lastParts.surname) {\n      lastNameForm.fullText = lastParts.givenName + \" \" + lastParts.surname;\n    } else {\n      let firstParts = {};\n      if (firstNameForm.parts) {\n        for (let part of firstNameForm.parts) {\n          if (part.type.endsWith(\"Given\")) {\n            firstParts.givenName = part.value;\n          } else if (part.type.endsWith(\"Surname\")) {\n            firstParts.surname = part.value;\n          }\n        }\n      }\n\n      if (!lastParts.givenName && firstParts.givenName) {\n        lastParts.givenName = firstParts.givenName;\n      }\n      if (!lastParts.surname && firstParts.surname) {\n        lastParts.surname = firstParts.surname;\n      }\n\n      if (lastParts.givenName && lastParts.surname) {\n        lastNameForm.fullText = lastParts.givenName + \" \" + lastParts.surname;\n      } else {\n        // still can't make full name\n        if (firstNameForm.fullText) {\n          lastNameForm.fullText = firstNameForm.fullText;\n        }\n      }\n    }\n  }\n\n  return lastNameForm;\n}\n\nfunction getNameForPersonObj(person, result) {\n  let nameForm = getPrimaryNameForm(person);\n  if (nameForm) {\n    if (nameForm.fullText) {\n      result.fullName = nameForm.fullText;\n    }\n    if (nameForm.parts) {\n      for (let part of nameForm.parts) {\n        if (part.value) {\n          if (part.type.endsWith(\"Given\")) {\n            result.givenName = part.value;\n          } else if (part.type.endsWith(\"Surname\")) {\n            result.surname = part.value;\n          } else if (part.type.endsWith(\"Prefix\")) {\n            result.prefix = part.value;\n          } else if (part.type.endsWith(\"Suffix\")) {\n            result.suffix = part.value;\n          }\n        }\n      }\n    }\n  }\n}\n\nfunction getGenderForPersonObj(person, result) {\n  // get gender\n  if (person.gender) {\n    if (person.gender.type.endsWith(\"/Male\")) {\n      result.gender = \"male\";\n    } else if (person.gender.type.endsWith(\"/Female\")) {\n      result.gender = \"female\";\n    }\n  }\n}\n\nfunction processRecordDataFactsForPersonObj(person, result) {\n  // check the facts of this primary person for this persons vitals\n  if (person.facts) {\n    for (let fact of person.facts) {\n      // the fact contains the place etc\n      // it gets complicated when there is more than one person.\n      // .principal seems to be whether they are one of the people being recorded\n      // In a census all the people in the household are principals\n      // In a birth registration the child is a principal and the mother is not\n      if (fact.type) {\n        let factType = getFactType(fact);\n        if (fact.primary) {\n          result.factType = factType;\n          setEventDateAndPlaceForFact(result, fact);\n        }\n\n        //console.log(\"factType is \" + factType);\n        if (factType == \"Birth\") {\n          //console.log(\"type is birth\");\n          if (fact.date) {\n            if (fact.date.original) {\n              result.birthDateOriginal = fact.date.original;\n            }\n            setFieldFromDate(fact.date, \"/Date\", \"PR_BIR_DATE_EST\", result, \"birthDate\");\n            setFieldFromDate(fact.date, \"/Year\", \"PR_BIR_YEAR_EST\", result, \"birthYear\");\n          }\n          if (fact.place) {\n            setFieldFromPlaceWithLabels(\n              fact.place,\n              [\n                \"PR_BIR_PLACE\",\n                \"PR_BIR_PLACE_ORIG\",\n                \"PR_BIRTH_PLACE\",\n                \"PR_BIRTH_PLACE_ORIG\",\n                \"BIRTH_PLACE\",\n                \"BIRTH_PLACE_ORIG\",\n              ],\n              result,\n              \"birthPlace\"\n            );\n            if (!result.birthPlace && !person.principal) {\n              // this birth information about a non-principal. e.g. the birth place of father\n              // in a child's birth or death record. The label could be something like:\n              // PR_FTHR_BIRTH_PLACE\n              setFieldFromPlace(fact.place, \"\", \"\", result, \"birthPlace\");\n            }\n          }\n        } else if (factType == \"Death\") {\n          if (fact.date) {\n            if (fact.date.original) {\n              result.deathDateOriginal = fact.date.original;\n            }\n            setFieldFromDate(fact.date, \"/Date\", \"PR_DEA_DATE\", result, \"deathDate\");\n            if (!result.deathDate) {\n              setFieldFromDate(fact.date, \"/Date\", \"PR_DEA_DATE_EST\", result, \"deathDate\");\n            }\n            if (!result.deathDate) {\n              setFieldFromDate(fact.date, \"/Date\", \"PR_DEA_DATE_ORIG\", result, \"deathDate\");\n            }\n            setFieldFromDate(fact.date, \"/Year\", \"PR_DEA_YEAR_EST\", result, \"deathYear\");\n            setFieldFromDate(fact.date, \"/Month\", \"PR_DEA_MONTH\", result, \"deathMonth\");\n          }\n          if (fact.place) {\n            setFieldFromPlace(fact.place, \"\", \"PR_DEA_PLACE\", result, \"deathPlace\");\n          }\n        } else if (factType == \"Residence\" || factType == \"Census\") {\n          if (fact.place) {\n            setFieldFromPlace(fact.place, \"\", \"NOTE_PR_RES_PLACE\", result, \"residence\");\n          }\n        }\n\n        // build up record data that could be included in a data table\n        addRecordDataForFact(result, fact, factType);\n      }\n    }\n  }\n}\n\nfunction processPersonPageFactsForPersonObj(person, result) {\n  // check the facts of this primary person for this persons vitals\n  if (person.facts) {\n    for (let fact of person.facts) {\n      // the fact contains the place etc\n      // it gets complicated when there is more than one person.\n      // .principal seems to be whether they are one of the people being recorded\n      // In a census all the people in the household are principals\n      // In a birth registration the child is a principal and the mother is not\n      if (fact.type) {\n        let factType = getFactType(fact);\n\n        //console.log(\"factType is \" + factType);\n        if (factType == \"Birth\") {\n          //console.log(\"type is birth\");\n          if (fact.date) {\n            if (fact.date.original) {\n              result.birthDateOriginal = fact.date.original;\n            }\n            setFieldFromDate(fact.date, \"/Date\", \"PR_BIR_DATE_EST\", result, \"birthDate\");\n            setFieldFromDate(fact.date, \"/Year\", \"PR_BIR_YEAR_EST\", result, \"birthYear\");\n          }\n          if (fact.place) {\n            if (fact.place.original) {\n              result.birthPlaceOriginal = fact.place.original;\n            }\n            setFieldFromPlaceWithLabels(\n              fact.place,\n              [\n                \"PR_BIR_PLACE\",\n                \"PR_BIR_PLACE_ORIG\",\n                \"PR_BIRTH_PLACE\",\n                \"PR_BIRTH_PLACE_ORIG\",\n                \"BIRTH_PLACE\",\n                \"BIRTH_PLACE_ORIG\",\n              ],\n              result,\n              \"birthPlace\"\n            );\n          }\n        } else if (factType == \"Death\") {\n          if (fact.date) {\n            if (fact.date.original) {\n              result.deathDateOriginal = fact.date.original;\n            }\n            setFieldFromDate(fact.date, \"/Date\", \"PR_DEA_DATE\", result, \"deathDate\");\n            if (!result.deathDate) {\n              setFieldFromDate(fact.date, \"/Date\", \"PR_DEA_DATE_EST\", result, \"deathDate\");\n            }\n            if (!result.deathDate) {\n              setFieldFromDate(fact.date, \"/Date\", \"PR_DEA_DATE_ORIG\", result, \"deathDate\");\n            }\n            setFieldFromDate(fact.date, \"/Year\", \"PR_DEA_YEAR_EST\", result, \"deathYear\");\n            setFieldFromDate(fact.date, \"/Month\", \"PR_DEA_MONTH\", result, \"deathMonth\");\n          }\n          if (fact.place) {\n            if (fact.place.original) {\n              result.deathPlaceOriginal = fact.place.original;\n            }\n            setFieldFromPlace(fact.place, \"\", \"PR_DEA_PLACE\", result, \"deathPlace\");\n          }\n        }\n      }\n    }\n  }\n}\n\nfunction addParentFromPerson(otherPerson, result) {\n  // look for their name\n  let parent = {};\n  let nameForm = getPrimaryNameForm(otherPerson);\n  if (nameForm) {\n    parent.fullName = nameForm.fullText;\n    if (nameForm.parts) {\n      for (let part of nameForm.parts) {\n        if (part.type.endsWith(\"Given\")) {\n          parent.givenName = part.value;\n        } else if (part.type.endsWith(\"Surname\")) {\n          parent.surname = part.value;\n        }\n      }\n    }\n  }\n\n  if (otherPerson.gender) {\n    if (otherPerson.gender.type.endsWith(\"/Male\")) {\n      // it is the father\n      result.father = parent;\n    } else if (otherPerson.gender.type.endsWith(\"/Female\")) {\n      result.mother = parent;\n    }\n  }\n}\n\nfunction extractPersonDataFromFetch(document, dataObj, options) {\n  let result = {};\n\n  if (document) {\n    result.url = document.URL;\n  }\n\n  // there could be many people in this data, the description is one way to find out which\n  // is the one that is being focused on\n  let description = dataObj.description;\n\n  if (!description) {\n    // this could be an image page which is not handled currently\n    return result;\n  }\n\n  // For a person page the descript will be something like: \"#SD-G8S8-5FJ\" meaning the personId is:\n  // \"G8S8-5FJ\"\n  let personId = description.replace(/^\\#SD\\-/, \"\");\n\n  if (!dataObj.persons || dataObj.persons.length < 1) {\n    return result;\n  }\n\n  let person = dataObj.persons[0];\n\n  if (person.id != personId) {\n    return result;\n  }\n\n  getNameForPersonObj(person, result);\n  getGenderForPersonObj(person, result);\n  processPersonPageFactsForPersonObj(person, result);\n\n  // now look for relationships for spouse and parents\n  if (dataObj.relationships) {\n    for (let relationship of dataObj.relationships) {\n      let otherPersonId = \"\";\n      let type = relationship.type;\n      if (relationship.person1.resourceId == personId) {\n        otherPersonId = relationship.person2.resourceId;\n      } else if (relationship.person2.resourceId == personId) {\n        otherPersonId = relationship.person1.resourceId;\n      }\n\n      if (otherPersonId) {\n        let otherPerson = findPersonById(dataObj, otherPersonId);\n\n        if (type == \"http://gedcomx.org/Couple\") {\n          let spouse = {};\n          getNameForPersonObj(otherPerson, spouse);\n\n          if (relationship.facts) {\n            for (let fact of relationship.facts) {\n              if (fact.type == \"http://gedcomx.org/Marriage\") {\n                if (fact.date) {\n                  if (fact.date.original) {\n                    spouse.marriageDateOriginal = fact.date.original;\n                  }\n                  if (fact.date.normalized) {\n                    for (let normDate of fact.date.normalized) {\n                      if (normDate.value && normDate.lang == \"en\") {\n                        spouse.marriageDate = normDate.value;\n                        break;\n                      }\n                    }\n                  }\n                }\n                if (fact.place) {\n                  if (fact.place.original) {\n                    spouse.marriagePlaceOriginal = fact.place.original;\n                  }\n                  if (fact.place.normalized) {\n                    for (let normPlace of fact.place.normalized) {\n                      if (normPlace.value && normPlace.lang == \"en\") {\n                        spouse.marriagePlace = normPlace.value;\n                        break;\n                      }\n                    }\n                  }\n                }\n              }\n            }\n          }\n\n          if (!result.spouses) {\n            result.spouses = [];\n          }\n          result.spouses.push(spouse);\n        } else if (type == \"http://gedcomx.org/ParentChild\") {\n          if (relationship.person2.resourceId == personId) {\n            // this person is the child\n            addParentFromPerson(otherPerson, result);\n          }\n        }\n      }\n    }\n  }\n\n  result.pageType = \"person\";\n  return result;\n}\n\nfunction extractDataFromFetch(document, dataObj, fetchType, options) {\n\n    console.log(\"enter fs.extractDataFromFetch, fetchType=\" + fetchType)\n    console.log(dataObj);\n\n  usedLabelIds = {};\n\n  let result = {};\n\n  if (document) {\n    result.url = document.URL;\n  }\n\n  if (fetchType == \"person\") {\n    return extractPersonDataFromFetch(document, dataObj, options);\n  }\n\n  // there could be many people in this data, the description is one way to find out which\n  // is the one that is being focused on\n  let description = dataObj.description;\n\n  if (!description) {\n    // this could be an image page which is not handled currently\n    return result;\n  }\n\n  let personId = description.replace(/^.*(p_\\d*)$/, \"$1\");\n\n  let personIdWithRelatedFact = undefined;\n  let relatedPersonFactType = undefined;\n\n  result.recordData = {};\n\n  let thisPersonIsAPrincipal = false;\n\n  let persons = dataObj.persons;\n  if (persons) {\n    for (let person of persons) {\n      if (person.id == personId) {\n        // this is the person that the page is about\n        getNameForPersonObj(person, result);\n        if (result.fullName) {\n          result.recordData[\"Name\"] = result.fullName;\n        }\n\n        getGenderForPersonObj(person, result);\n        processRecordDataFactsForPersonObj(person, result);\n\n        // check the fields associated with this person\n        if (person.fields) {\n          processFields(result, person.fields, \"primaryPerson\");\n        }\n      }\n      if (person.facts) {\n        for (let fact of person.facts) {\n          // the fact contains the place etc\n          // it gets complicated when there is more than one person.\n          // .principal seems to be whether they are one of the people being recorded\n          // In a census all the people in the household are principals\n          // In a birth registration the child is a principal and the mother is not\n          if (fact.type) {\n            let factType = getFactType(fact);\n\n            if (fact.primary) {\n              setEventDateAndPlaceForFact(result, fact);\n\n              if (person.principal) {\n                if (person.id == personId) {\n                  thisPersonIsAPrincipal = true;\n                  // forget any other person who was a principal\n                  personIdWithRelatedFact = undefined;\n                  relatedPersonFactType = undefined;\n                } else if (!thisPersonIsAPrincipal && !personIdWithRelatedFact) {\n                  // We have a fact type but it is not for the person of interest\n                  // This is the first such case we have found\n                  relatedPersonFactType = factType;\n                  personIdWithRelatedFact = person.id;\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n\n  let relationships = dataObj.relationships;\n  if (relationships) {\n    let personIdWithRelatedFact2 = undefined;\n    // go through thelist one looking for relationships with facts\n    // we need to do this before looking at the relationships with no facts since we need the\n    // factType to process those.\n    for (let relationship of relationships) {\n      if (relationship.facts) {\n        for (let fact of relationship.facts) {\n          if (fact.type && !result.factType) {\n            let factType = getFactType(fact);\n\n            if (fact.primary) {\n              setEventDateAndPlaceForFact(result, fact);\n            }\n\n            // if one of the people in this fact is the selected person\n            if (relationship.person1.resourceId == personId || relationship.person2.resourceId == personId) {\n              result.factType = factType;\n\n              // build up record data that could be included in a data table\n              addRecordDataForFact(result, fact, factType);\n\n              // if this is a marriage then add a spouse if possible\n              if (factType.startsWith(\"Marriage\")) {\n                let otherPersonId = relationship.person2.resourceId;\n                if (relationship.person2.resourceId == personId) {\n                  otherPersonId = relationship.person1.resourceId;\n                }\n\n                let otherPerson = findPersonById(dataObj, otherPersonId);\n\n                if (otherPerson) {\n                  // look for their name\n                  let nameForm = getPrimaryNameForm(otherPerson);\n                  if (nameForm) {\n                    result.spouseFullName = nameForm.fullText;\n                    if (nameForm.parts) {\n                      for (let part of nameForm.parts) {\n                        if (part.type.endsWith(\"Given\")) {\n                          result.spouseGivenName = part.value;\n                        } else if (part.type.endsWith(\"Surname\")) {\n                          result.spouseSurname = part.value;\n                        }\n                      }\n                    }\n                  }\n\n                  if (otherPerson.fields) {\n                    const personFieldsMap = {\n                      Age: \"spouseAge\",\n                    };\n                    extractFields(result, otherPerson.fields, personFieldsMap);\n                  }\n                }\n              }\n            } else if (!personIdWithRelatedFact) {\n              relatedPersonFactType = factType;\n              personIdWithRelatedFact = relationship.person1.resourceId;\n              personIdWithRelatedFact2 = relationship.person2.resourceId;\n            }\n          } else if (fact.type) {\n            // we already have a factType for the result and we have found a new fact\n            // It could contain useful dates and places so don't ignore it. For example:\n            // https://www.familysearch.org/ark:/61903/1:1:QVJ8-SFH9?from=lynx1UIV8&treeref=L8PL-J4M\n            // The main (primary) fact (MarriageRegistration) has no date. But there is a Marriage\n            // fact with a date.\n            setDateAndPlaceForAdditionalFact(result, fact);\n          }\n        }\n      }\n    }\n\n    // go through the list a second time looking for relationships with no facts\n    for (let relationship of relationships) {\n      if (!relationship.facts) {\n        // relationship has no fact. this tends to be the case for a baptism or christening and\n        // we need these relationships to find the parents\n        if (\n          result.factType == \"Christening\" ||\n          result.factType == \"Baptism\" ||\n          result.factType == \"Birth\" ||\n          result.factType == \"Death\" ||\n          result.factType == \"Marriage\"\n        ) {\n          // if one of the people in this fact is the selected person\n          let otherPersonId = undefined;\n          if (relationship.person1.resourceId == personId) {\n            otherPersonId = relationship.person2.resourceId;\n          } else if (relationship.person2.resourceId == personId) {\n            otherPersonId = relationship.person1.resourceId;\n          }\n          if (otherPersonId) {\n            let otherPerson = findPersonById(dataObj, otherPersonId);\n            if (otherPerson) {\n              let relationType = relationship.type;\n              if (relationType.endsWith(\"/ParentChild\")) {\n                // other person is either father or mother\n                addParentFromPerson(otherPerson, result);\n              } else if (relationType.endsWith(\"/Couple\")) {\n                // other person is spouse\n                // look for their name\n                let nameForm = getPrimaryNameForm(otherPerson);\n                if (nameForm) {\n                  result.spouseFullName = nameForm.fullText;\n                  if (nameForm.parts) {\n                    for (let part of nameForm.parts) {\n                      if (part.type.endsWith(\"Given\")) {\n                        result.spouseGivenName = part.value;\n                      } else if (part.type.endsWith(\"Surname\")) {\n                        result.spouseSurname = part.value;\n                      }\n                    }\n                  }\n                }\n                if (otherPerson.fields) {\n                  const personFieldsMap = {\n                    Age: \"spouseAge\",\n                  };\n                  extractFields(result, otherPerson.fields, personFieldsMap);\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n\n    if (relatedPersonFactType) {\n      // go through relationships again looking for the relationship\n      // We have three possible person IDs that are principal to the fact:\n      // personIdWithRelatedFact (usually set for a child death/baptism, or could be bride or groom)\n      // personIdWithRelatedFact2 (usually set for a child marriage - will be bride or groom)\n      result.relatedPersonFactType = relatedPersonFactType;\n\n      let otherPersonId = undefined;\n      for (let relationship of relationships) {\n        let relationType = undefined;\n        if (relationship.person1.resourceId == personId) {\n          // This relationship involves the selected person\n          otherPersonId = relationship.person2.resourceId;\n          if (otherPersonId == personIdWithRelatedFact || otherPersonId == personIdWithRelatedFact2) {\n            // person 2 of this relationship is the person that the fact is about and is related to our person\n            relationType = relationship.type;\n            if (relationType.endsWith(\"/ParentChild\")) {\n              result.relationshipToFactPerson = \"Parent\";\n            } else if (relationType.endsWith(\"/Couple\")) {\n              result.relationshipToFactPerson = \"Spouse\";\n            }\n          }\n        } else if (relationship.person2.resourceId == personId) {\n          otherPersonId = relationship.person1.resourceId;\n          if (otherPersonId == personIdWithRelatedFact || otherPersonId == personIdWithRelatedFact2) {\n            // person 1 of this relationship is the person that the fact is about and is related to our person\n            relationType = relationship.type;\n            if (relationType.endsWith(\"/ParentChild\")) {\n              result.relationshipToFactPerson = \"Child\";\n            } else if (relationType.endsWith(\"/Couple\")) {\n              result.relationshipToFactPerson = \"Spouse\";\n            }\n          }\n        }\n\n        if (result.relationshipToFactPerson) {\n          let otherPerson = findPersonById(dataObj, otherPersonId);\n\n          if (otherPerson) {\n            // look for their name\n            let nameForm = getPrimaryNameForm(otherPerson);\n            if (nameForm) {\n              result.relatedPersonFullName = nameForm.fullText;\n              if (nameForm.parts) {\n                for (let part of nameForm.parts) {\n                  if (part.type.endsWith(\"Given\")) {\n                    result.relatedPersonGivenName = part.value;\n                  } else if (part.type.endsWith(\"Surname\")) {\n                    result.relatedPersonSurname = part.value;\n                  }\n                }\n              }\n            }\n\n            // get gender\n            if (otherPerson.gender) {\n              if (otherPerson.gender.type.endsWith(\"/Male\")) {\n                result.relatedPersonGender = \"male\";\n              } else if (otherPerson.gender.type.endsWith(\"/Female\")) {\n                result.relatedPersonGender = \"female\";\n              }\n            }\n\n            if (relatedPersonFactType == \"Marriage\") {\n              let spouse = undefined;\n\n              if (otherPersonId == personIdWithRelatedFact && personIdWithRelatedFact2) {\n                spouse = findPersonById(dataObj, personIdWithRelatedFact2);\n              } else if (otherPersonId == personIdWithRelatedFact2 && personIdWithRelatedFact) {\n                spouse = findPersonById(dataObj, personIdWithRelatedFact);\n              }\n\n              if (spouse) {\n                let nameForm = getPrimaryNameForm(spouse);\n                if (nameForm) {\n                  result.relatedPersonSpouseFullName = nameForm.fullText;\n                  if (nameForm.parts) {\n                    for (let part of nameForm.parts) {\n                      if (part.type.endsWith(\"Given\")) {\n                        result.relatedPersonSpouseGivenName = part.value;\n                      } else if (part.type.endsWith(\"Surname\")) {\n                        result.relatedPersonSpouseSurname = part.value;\n                      }\n                    }\n                  }\n                }\n              }\n            }\n          }\n          break; // we have found the relationship and set relationshipToFactPerson\n        }\n      }\n    }\n  }\n\n  // build household table for census\n  if (result.factType == \"Census\" || (result.factType == \"Residence\" && persons.length > 1)) {\n    let persons = dataObj.persons;\n\n    result.household = {};\n    result.household.headings = [\n      \"fullName\",\n      \"givenName\",\n      \"surname\",\n      \"relationship\",\n      \"maritalStatus\",\n      \"gender\",\n      \"age\",\n      \"occupation\",\n      \"birthDateOriginal\",\n      \"birthYear\",\n      \"birthPlaceOriginal\",\n      \"birthPlace\",\n    ];\n    result.household.members = [];\n\n    for (let person of persons) {\n      let member = {};\n\n      if (person.id == personId) {\n        member.isSelected = true;\n      }\n\n      // look for their name\n      if (person.names) {\n        let nameForm = getPrimaryNameForm(person);\n        if (nameForm) {\n          member.fullName = nameForm.fullText;\n          if (nameForm.parts) {\n            for (let part of nameForm.parts) {\n              if (part.type.endsWith(\"Given\")) {\n                member.givenName = part.value;\n              } else if (part.type.endsWith(\"Surname\")) {\n                member.surname = part.value;\n              }\n            }\n          }\n        }\n      } else {\n        member.isClosed = true;\n      }\n\n      // get gender\n      if (person.gender) {\n        if (person.gender.type.endsWith(\"/Male\")) {\n          member.gender = \"male\";\n        } else if (person.gender.type.endsWith(\"/Female\")) {\n          member.gender = \"female\";\n        }\n      }\n\n      // check the facts of this primary person for this persons vitals\n      if (person.facts) {\n        for (let fact of person.facts) {\n          if (fact.type) {\n            let factType = getFactType(fact);\n\n            //console.log(\"factType is \" + factType);\n            if (factType == \"Birth\") {\n              //console.log(\"type is birth\");\n              if (fact.date) {\n                if (fact.date.original) {\n                  member.birthDateOriginal = fact.date.original;\n                }\n                setFieldFromDate(fact.date, \"/Date\", \"PR_BIR_DATE_EST\", member, \"birthDate\");\n                setFieldFromDate(fact.date, \"/Year\", \"PR_BIR_YEAR_EST\", member, \"birthYear\");\n              }\n              if (fact.place) {\n                if (fact.place.original) {\n                  member.birthPlaceOriginal = fact.place.original;\n                }\n                setFieldFromPlace(fact.place, \"\", \"PR_BIR_PLACE\", member, \"birthPlace\");\n              }\n            } else if (factType == \"MaritalStatus\") {\n              if (fact.value) {\n                member.maritalStatus = fact.value;\n              }\n            } else if (factType == \"Occupation\") {\n              if (fact.value) {\n                member.occupation = fact.value;\n              }\n            } else if (factType == \"Age\") {\n              if (fact.values) {\n                for (let value of fact.values) {\n                  if (value.labelId == \"PR_AGE\") {\n                    member.age = value.text;\n                  }\n                }\n              }\n            } else if (factType == \"RelationshipToHead\") {\n              if (fact.values) {\n                for (let value of fact.values) {\n                  if (value.labelId == \"PR_RELATIONSHIP_TO_HEAD_ORIG\") {\n                    member.relationship = value.text;\n                  }\n                }\n              }\n            } else if (factType == \"RelationshipToHeadCode\" && !member.relationship) {\n              if (fact.values) {\n                for (let value of fact.values) {\n                  if (value.labelId == \"PR_RELATIONSHIP_CODE\") {\n                    member.relationship = value.text;\n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n\n      if (person.fields) {\n        const personFieldsMap = {\n          Age: \"age\",\n          RelationshipToHeadCode: \"relationship\",\n          RelationshipToHead: \"relationship\",\n          Relationship: \"relationship\",\n          SourceSheetNbr: \"sheetNumber\",\n          SourceLineNbr: \"lineNumber\",\n        };\n        extractFields(member, person.fields, personFieldsMap);\n      }\n\n      result.household.members.push(member);\n    }\n\n    // The members can be in a different order to how they appear in the census\n    // I have only seen this in the US 1940 Federal Census. E.g. us_census_1940_addie_bullock\n    // if we have line numbers we can reorder them\n    let hasLineNumbers = true;\n    for (let member of result.household.members) {\n      if (!member.lineNumber) {\n        hasLineNumbers = false;\n        break;\n      }\n      if (isNaN(Number(member.lineNumber))) {\n        hasLineNumbers = false;\n        break;\n      }\n    }\n    let hasSheetNumbers = true;\n    for (let member of result.household.members) {\n      if (!member.sheetNumber) {\n        hasSheetNumbers = false;\n        break;\n      }\n      if (isNaN(Number(member.sheetNumber))) {\n        hasSheetNumbers = false;\n        break;\n      }\n    }\n\n    if (hasLineNumbers && hasSheetNumbers) {\n      // sort by line number\n      result.household.members.sort(function (a, b) {\n        let sheetDiff = Number(a.sheetNumber) - Number(b.sheetNumber);\n        let lineDiff = Number(a.lineNumber) - Number(b.lineNumber);\n        if (sheetDiff === 0) {\n          return lineDiff;\n        }\n        return sheetDiff;\n      });\n    } else if (hasLineNumbers) {\n      // sort by line number\n      result.household.members.sort((a, b) => (Number(a.lineNumber) > Number(b.lineNumber) ? 1 : -1));\n    }\n\n    // now remove any line numbers as we don't need them in the extracted data\n    for (let member of result.household.members) {\n      delete member.lineNumber;\n      delete member.sheetNumber;\n    }\n  }\n\n  processFields(result, dataObj.fields, \"topLevel\");\n\n  if (dataObj.sourceDescriptions) {\n    for (let source of dataObj.sourceDescriptions) {\n      // there are different source descriptions for different people or records\n      if (source.id && source.id.endsWith(personId)) {\n        if (source.citations && source.citations.length > 0) {\n          result.citation = source.citations[0].value.trim();\n        }\n        if (source.titles && source.titles.length > 0) {\n          result.sourceTitleForPerson = source.titles[0].value;\n        }\n        result.personRecordUrl = source.about;\n      }\n\n      if (source.resourceType) {\n        if (source.resourceType.endsWith(\"Collection\")) {\n          if (source.titles && source.titles.length > 0) {\n            result.collectionTitle = source.titles[0].value;\n          }\n          // The US 1950 census doesn't have the collection Id in the normal place\n          if (!result.fsCollectionId) {\n            if (source.about && source.about.indexOf(\"/records/collections/\") != -1) {\n              let collectionId = source.about.replace(/^.*\\/records\\/collections\\/(\\d+)$/, \"$1\");\n              if (collectionId && collectionId != source.about) {\n                result.fsCollectionId = collectionId;\n              }\n            }\n          }\n          if (!result.fsCollectionId) {\n            // example:\n            //       \"http://gedcomx.org/Primary\" : [ \"https://api.familysearch.org/platform/records/collections/4464515\" ]\n            if (source.identifiers && source.identifiers[\"http://gedcomx.org/Primary\"]) {\n              let idArray = source.identifiers[\"http://gedcomx.org/Primary\"];\n              if (idArray.length > 0 && idArray[0]) {\n                let collectionId = idArray[0].replace(/^.*\\/records\\/collections\\/(\\d+)$/, \"$1\");\n                if (collectionId && collectionId != idArray[0]) {\n                  result.fsCollectionId = collectionId;\n                }\n              }\n            }\n          }\n        }\n\n        if (source.resourceType.endsWith(\"Record\")) {\n          result.recordUrl = source.about;\n        }\n\n        if (source.resourceType.endsWith(\"DigitalArtifact\") && !result.digitalArtifact) {\n          // digitalArtifact property will get deleted later in processImageLinks in all but rare cases\n          // There can be multiple digitalArctifact sources, we just use the first for now\n          // An example is a census (see england_census_1911_peter_delamotte), there can be an image link\n          // to the same image for each houshold member, not obvious how to find the one for the primary person\n          result.digitalArtifact = source.about;\n        }\n      }\n    }\n  }\n\n  processImageLinks(document, result, options);\n\n  result.pageType = \"record\";\n\n  //console.log(\"extractDataFromFetch result is:\");\n  //console.log(result);\n\n  return result;\n}\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9leHRlbnNpb24vc2l0ZS9mcy9jb3JlL2ZzX2V4dHJhY3RfZGF0YS5tanMuanMiLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsb0NBQW9DOztBQUVwQztBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxtQ0FBbUM7QUFDbkM7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQkFBK0IsOEJBQThCO0FBQzdEOztBQUVBLDBEQUEwRDtBQUMxRDtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQSx5QkFBeUIsa0NBQWtDO0FBQzNEOztBQUVBLG9EQUFvRDtBQUNwRDtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWTtBQUNaO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVO0FBQ1Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWTtBQUNaO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlDQUFpQyw0QkFBNEI7QUFDN0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQ0FBb0MsbUNBQW1DO0FBQ3ZFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUEsNkJBQTZCLHdCQUF3QjtBQUNyRDs7QUFFQSx3REFBd0Q7QUFDeEQ7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsa0NBQWtDLDBCQUEwQjtBQUM1RDs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBCQUEwQix5QkFBeUI7QUFDbkQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVO0FBQ1Y7QUFDQTtBQUNBO0FBQ0E7QUFDQSw4QkFBOEIsMEJBQTBCO0FBQ3hEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0I7QUFDaEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQkFBc0I7QUFDdEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNCQUFzQjtBQUN0QjtBQUNBLHNCQUFzQjtBQUN0QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVO0FBQ1Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVO0FBQ1Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRO0FBQ1I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7OztBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQkFBK0I7QUFDL0I7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxRQUFRO0FBQ1I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWTtBQUNaO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVO0FBQ1Y7QUFDQTtBQUNBLFVBQVU7QUFDVjtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBLElBQUk7QUFDSjtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCLHdEQUF3RDtBQUN4RTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7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QUF5QjtBQUM3QixJQUFJLDBCQUEwQjtBQUM5QixJQUFJLDJCQUEyQjs7QUFFL0I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7QUFDSDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtDQUFrQztBQUNsQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVO0FBQ1Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZO0FBQ1o7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxRQUFRO0FBQ1I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsWUFBWTtBQUNaO0FBQ0EsWUFBWTtBQUNaO0FBQ0EsWUFBWTtBQUNaO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVTtBQUNWO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVO0FBQ1Y7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVO0FBQ1Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVO0FBQ1Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVU7QUFDVjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGtCQUFrQjtBQUNsQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBCQUEwQjtBQUMxQjtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxjQUFjO0FBQ2Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZO0FBQ1o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFZO0FBQ1o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0JBQWdCO0FBQ2hCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QjtBQUN4QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsY0FBYztBQUNkO0FBQ0E7QUFDQTtBQUNBLFVBQVU7QUFDVjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxjQUFjO0FBQ2Q7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQkFBb0I7QUFDcEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQjtBQUNoQjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0EsZ0JBQWdCO0FBQ2hCO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QjtBQUN4QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQkFBZ0I7QUFDaEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVE7QUFDUjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVTtBQUNWO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsY0FBYztBQUNkO0FBQ0E7QUFDQTtBQUNBLGNBQWM7QUFDZDtBQUNBO0FBQ0E7QUFDQSxjQUFjO0FBQ2Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxjQUFjO0FBQ2Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxjQUFjO0FBQ2Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTztBQUNQLE1BQU07QUFDTjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUU2QyIsInNvdXJjZXMiOlsid2VicGFjazovL0NpdGF0aW9uRXh0cmFjdG9yLy4vZXh0ZW5zaW9uL3NpdGUvZnMvY29yZS9mc19leHRyYWN0X2RhdGEubWpzP2RiYmUiXSwic291cmNlc0NvbnRlbnQiOlsiLypcbk1JVCBMaWNlbnNlXG5cbkNvcHlyaWdodCAoYykgMjAyMCBSb2JlcnQgTSBQYXZleVxuXG5QZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYSBjb3B5XG5vZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSBcIlNvZnR3YXJlXCIpLCB0byBkZWFsXG5pbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzXG50byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsXG5jb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXNcbmZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6XG5cblRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkIGluIGFsbFxuY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS5cblxuVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEIFwiQVMgSVNcIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUlxuSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksXG5GSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEVcbkFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVJcbkxJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sXG5PVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOIFRIRVxuU09GVFdBUkUuXG4qL1xuXG5jb25zdCB1c2VPbGRTeXN0ZW0gPSBmYWxzZTtcblxuZnVuY3Rpb24gY2xlYW5UZXh0KHRleHQpIHtcbiAgaWYgKCF0ZXh0KSB7XG4gICAgcmV0dXJuIFwiXCI7XG4gIH1cblxuICB0ZXh0ID0gdGV4dC5yZXBsYWNlKC9cXHMrL2csIFwiIFwiKTsgLy8gZWxpbWluYXRlIG5ic3AgYW5kIG11bHRpcGxlIHNwYWNlcyBldGNcblxuICAvLyBzb21ldGltZXMgdGhlIHRleHQgaXMgc29tZXRoaW5nIGxpa2UgXCJaYWNoYXJpYWggRGF2ZXlbWmVjaGFyaWFoIFBhdmV5XVwiXG4gIC8vIGluIHRoYXQgY2FzZSBhZGQgYSBzcGFjZSBiZWZvcmUgdGhlIFtcbiAgdGV4dCA9IHRleHQucmVwbGFjZSgvKFteXFxzXSlcXFsvLCBcIiQxIFtcIik7XG5cbiAgdGV4dCA9IHRleHQudHJpbSgpO1xuXG4gIHJldHVybiB0ZXh0O1xufVxuXG5mdW5jdGlvbiBjbGVhbkxhYmVsKHRleHQpIHtcbiAgaWYgKCF0ZXh0KSB7XG4gICAgcmV0dXJuIFwiXCI7XG4gIH1cblxuICB0ZXh0ID0gdGV4dC5yZXBsYWNlKC9cXHMvZywgXCIgXCIpOyAvLyBlbGltaW5hdGUgbmJzcCBldGNcbiAgdGV4dCA9IHRleHQudHJpbSgpO1xuXG4gIC8vIHJlbW92ZSB0cmFpbGluZyA6XG4gIHRleHQgPSB0ZXh0LnJlcGxhY2UoL1xccypcXDorJC8sIFwiXCIpO1xuXG4gIHJldHVybiB0ZXh0O1xufVxuXG5mdW5jdGlvbiBnZXRWaXNpYmxlVGV4dEluTm9kZShub2RlKSB7XG4gIGxldCB0ZXh0ID0gXCJcIjtcblxuICBpZiAocXVlcnkubGVuZ3RoID4gMCkge1xuICAgIC8vIGxvb3Agb3ZlciBhbGwgdGhlIGNvbnRlbnRzICh3aGljaCBpbmNsdWRlcyB0ZXh0IG5vZGVzKSBhbmQgYWRkIGluIG9ubHkgdGhlIHZpc2JpbGUgb25lc1xuICAgIGxldCBjb250ZW50cyA9IG5vZGUuY2hpbGROb2RlcztcbiAgICBpZiAoY29udGVudHMpIHtcbiAgICAgIGZvciAobGV0IGNoaWxkSW5kZXggPSAwOyBjaGlsZEluZGV4IDwgY29udGVudHMubGVuZ3RoOyBjaGlsZEluZGV4KyspIHtcbiAgICAgICAgbGV0IGNoaWxkID0gY29udGVudHNbY2hpbGRJbmRleF07XG5cbiAgICAgICAgaWYgKGNoaWxkLmdldEF0dHJpYnV0ZShcInN0eWxlXCIpICE9IFwiZGlzcGxheTogbm9uZTtcIikge1xuICAgICAgICAgIHRleHQgKz0gY2hpbGQudGV4dENvbnRlbnQ7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICByZXR1cm4gdGV4dDtcbn1cblxuZnVuY3Rpb24gZXh0cmFjdFJlY29yZERhdGEodGFibGUsIHJlc3VsdCkge1xuICB2YXIgcmVjb3JkRGF0YVJvd3MgPSB0YWJsZS5xdWVyeVNlbGVjdG9yQWxsKFwidHJcIik7XG5cbiAgcmVzdWx0LnJlY29yZERhdGEgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuICBsZXQgcmVjb3JkRGF0YSA9IHJlc3VsdC5yZWNvcmREYXRhO1xuXG4gIGlmICghcmVjb3JkRGF0YVJvd3MpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBmb3IgKGxldCByb3dJbmRleCA9IDA7IHJvd0luZGV4IDwgcmVjb3JkRGF0YVJvd3MubGVuZ3RoOyByb3dJbmRleCsrKSB7XG4gICAgbGV0IHJvdyA9IHJlY29yZERhdGFSb3dzW3Jvd0luZGV4XTtcblxuICAgIGlmIChyb3cuZ2V0QXR0cmlidXRlKFwic3R5bGVcIikgPT0gXCJkaXNwbGF5OiBub25lO1wiKSB7XG4gICAgICAvLyBUaGVyZSBjYW4gYmUgcm93cyBmb3IgbWFueSByZWNvcmRzIHByZXNlbnQgaWYgdGhpcyBpcyBhIG1vZGVsIHBvcHVwIGRpYWxvZ1xuICAgICAgLy8gYW5kIG11bHRpcGxlIHJlY29yZHMgaGF2ZSBiZWVuIGNsaWNrZWQgb24gb25lIGFmdGVyIHRoZSBvdGhlclxuICAgICAgY29udGludWU7XG4gICAgfVxuXG4gICAgaWYgKHJvdy5nZXRBdHRyaWJ1dGUoXCJjbGFzc1wiKSA9PSBcIm5vbi1wcmluY2lwYWwtaW5mb1wiKSB7XG4gICAgICByZXN1bHQub3RoZXJQZXJzb25SZWNvcmREYXRhID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiAgICAgIHJlY29yZERhdGEgPSByZXN1bHQub3RoZXJQZXJzb25SZWNvcmREYXRhO1xuICAgIH1cblxuICAgIC8vIEdldCB0aGUgbGFiZWwgb2YgdGhlIHJvdyAobXVzdCBiZSBpbW1lZGlhdGUgY2hpbGQpXG4gICAgbGV0IGxhYmVsID0gcm93LnF1ZXJ5U2VsZWN0b3IoXCI+IHRoXCIpLnRleHRDb250ZW50O1xuICAgIGlmIChsYWJlbCAhPSBcIlwiKSB7XG4gICAgICBsYWJlbCA9IGNsZWFuTGFiZWwobGFiZWwpO1xuICAgICAgbGV0IG51bUNoaWxkcmVuID0gcm93LnF1ZXJ5U2VsZWN0b3IoXCJ0ZFwiKS5jaGlsZHJlbi5sZW5ndGg7XG5cbiAgICAgIGlmIChudW1DaGlsZHJlbiA9PSAwKSB7XG4gICAgICAgIGxldCB2YWx1ZSA9IHJvdy5xdWVyeVNlbGVjdG9yKFwidGRcIikudGV4dENvbnRlbnQ7XG4gICAgICAgIHZhbHVlID0gdmFsdWUucmVwbGFjZSgvXFxzKy9nLCBcIiBcIikudHJpbSgpO1xuICAgICAgICByZWNvcmREYXRhW2xhYmVsXSA9IHZhbHVlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gdGhlcmUgYXJlIGNoaWxkcmVuLiBUaGVyZSBhcmUgc2V2ZXJhbCBjYXNlcyB0byBoYW5kbGUgaGVyZVxuICAgICAgICBpZiAobnVtQ2hpbGRyZW4gPT0gMSkge1xuICAgICAgICAgIC8vIHNvbWV0aW1lcyB0aGVyZSBpcyBhIHNoYWRvd1Jvb3RcbiAgICAgICAgICBsZXQgY2hpbGQgPSByb3cucXVlcnlTZWxlY3RvcihcInRkXCIpLmNoaWxkcmVuWzBdO1xuICAgICAgICAgIGlmIChjaGlsZC5zaGFkb3dSb290KSB7XG4gICAgICAgICAgICBsZXQgc3BhbiA9IGNoaWxkLnNoYWRvd1Jvb3QucXVlcnlTZWxlY3RvcihcInNwYW5cIik7XG5cbiAgICAgICAgICAgIGxldCB2YWx1ZSA9IGdldFZpc2libGVUZXh0SW5Ob2RlKHNwYW4pO1xuICAgICAgICAgICAgdmFsdWUgPSBjbGVhblRleHQodmFsdWUpO1xuICAgICAgICAgICAgaWYgKHZhbHVlICE9IFwiXCIpIHtcbiAgICAgICAgICAgICAgcmVjb3JkRGF0YVtsYWJlbF0gPSB2YWx1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gZm9yIG5vdyBqdXN0IGdldCB0aGUgdGV4dCBvZiBhbGwgdGhlIGNoaWxkcmVuLCB0aGlzIGNhbiBoYXBwZW4gZm9yIFwiTmFtZTpcIiBpbiBkZWF0aCByZWdcbiAgICAgICAgICAgIC8vIElmIGNhbiBhbHNvIGhhcHBlbiBmb3IgXCJJbmZlcnJlZCBTcG91c2U6XCIgaW4gMTkzOSByZWcuXG4gICAgICAgICAgICBsZXQgdmFsdWUgPSBnZXRWaXNpYmxlVGV4dEluTm9kZShyb3cucXVlcnlTZWxlY3RvcihcInRkXCIpKTtcbiAgICAgICAgICAgIHZhbHVlID0gY2xlYW5UZXh0KHZhbHVlKTtcbiAgICAgICAgICAgIGlmICh2YWx1ZSAhPSBcIlwiKSB7XG4gICAgICAgICAgICAgIHJlY29yZERhdGFbbGFiZWxdID0gdmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vY29uc29sZS5sb2coXCJOdW0gY2hpbGRyZW4gPSBcIiArIG51bUNoaWxkcmVuICsgXCIuIFwiICsgbGFiZWwpO1xuICAgICAgICAgIC8vIGZvciBub3cganVzdCB1c2UgdGhlIHRleHQgb2YgdGhlIFREIGl0c2VsZiBhbmQgbm90IGNoaWxkcmVuIChpZiBhbnkpXG4gICAgICAgICAgbGV0IHZhbHVlID0gZ2V0VmlzaWJsZVRleHRJbk5vZGUocm93LnF1ZXJ5U2VsZWN0b3IoXCJ0ZFwiKSk7XG4gICAgICAgICAgdmFsdWUgPSBjbGVhblRleHQodmFsdWUpO1xuICAgICAgICAgIGlmICh2YWx1ZSkge1xuICAgICAgICAgICAgcmVjb3JkRGF0YVtsYWJlbF0gPSB2YWx1ZTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJVbmhhbmRsZWQgY2FzZTogTnVtIGNoaWxkcmVuID0gXCIgKyBudW1DaGlsZHJlbiArIFwiLiBcIiArIGxhYmVsKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgLy8gdGhpcyByb3cgZG9lc24ndCBoYXZlIGEgPHRoPiBsYWJlbC4gQ291bGQgYmUgc29tZXRoaW5nIGxpa2UgXCJIb3VzZWhvbGQgbWVtYmVyc1wiXG4gICAgICBpZiAocm93LmNsYXNzTGlzdC5jb250YWlucyhcInRhYmxlQ29udGFpbmVyUm93XCIpKSB7XG4gICAgICAgIGxldCB0YWJsZSA9IHJvdy5xdWVyeVNlbGVjdG9yKFwidGFibGVcIik7XG5cbiAgICAgICAgLy8gY29sbGVjdCBhbGwgdGhlIGhlYWRpbmdzIGFuZCBwdXQgdGhlbSBpbiBhIHN0cmluZyB3aXRoIGxpbmUgYnJlYWtzIGJldHdlZW4gdGhlbVxuICAgICAgICBsZXQgaGVhZGluZ3MgPSB0YWJsZS5xdWVyeVNlbGVjdG9yQWxsLmZpbmQoXCJ0aGVhZCB0ciB0aFwiKTtcbiAgICAgICAgbGV0IGxhYmVsID0gXCJcIjtcbiAgICAgICAgaWYgKGhlYWRpbmdzKSB7XG4gICAgICAgICAgZm9yIChsZXQgY29sSW5kZXggPSAwOyBjb2xJbmRleCA8IGhlYWRpbmdzLmxlbmd0aDsgY29sSW5kZXgrKykge1xuICAgICAgICAgICAgbGV0IGhlYWRpbmdRID0gaGVhZGluZ3NbY29sSW5kZXhdO1xuICAgICAgICAgICAgaWYgKGxhYmVsKSB7XG4gICAgICAgICAgICAgIGxhYmVsICs9IFwiPGJyLz5cIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGxhYmVsICs9IGNsZWFuVGV4dChoZWFkaW5nLnRleHRDb250ZW50KTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyBub3cgZ2V0IGVhY2ggcm93IG9mIGRhdGEgYW5kIHB1dCB0aGVtIGFsbCBpbiBvbmUgc3RyaW5nIHdpdGggbGluZSBicmVha3MgYmV0d2VlbiByb3dzXG4gICAgICAgIGxldCBzdWJUYWJsZVJvd3MgPSB0YWJsZS5xdWVyeVNlbGVjdG9yQWxsKFwidGJvZHkgdHJcIik7XG4gICAgICAgIGlmIChzdWJUYWJsZVJvd3MpIHtcbiAgICAgICAgICBsZXQgdmFsdWUgPSBcIlwiO1xuICAgICAgICAgIGZvciAobGV0IHN1YlJvd0luZGV4ID0gMDsgc3ViUm93SW5kZXggPCBzdWJUYWJsZVJvd3MubGVuZ3RoOyBzdWJSb3dJbmRleCsrKSB7XG4gICAgICAgICAgICBsZXQgc3ViUm93ID0gc3ViVGFibGVSb3dzW3N1YlJvd0luZGV4XTtcbiAgICAgICAgICAgIGlmICh2YWx1ZSkge1xuICAgICAgICAgICAgICB2YWx1ZSArPSBcIjxici8+XCI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YWx1ZSArPSBjbGVhblRleHQoc3ViUm93LnRleHRDb250ZW50KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKHZhbHVlKSB7XG4gICAgICAgICAgICByZWNvcmREYXRhW2xhYmVsXSA9IHZhbHVlO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxufVxuXG5mdW5jdGlvbiBleHRyYWN0UmVsYXRpdmVzKHJlbGF0aXZlcywgcmVzdWx0KSB7XG4gIGlmIChyZWxhdGl2ZXMubGVuZ3RoID4gMCkge1xuICAgIGxldCByb3dzID0gcmVsYXRpdmVzLnF1ZXJ5U2VsZWN0b3JBbGwoXCJkaXYucmVsYXRpdmVcIik7XG5cbiAgICBpZiAocm93cyAmJiByb3dzLmxlbmd0aCA+IDApIHtcbiAgICAgIHJlc3VsdC5yZWxhdGl2ZXMgPSBbXTtcblxuICAgICAgZm9yIChsZXQgcm93SW5kZXggPSAwOyByb3dJbmRleCA8IHJvd3MubGVuZ3RoOyByb3dJbmRleCsrKSB7XG4gICAgICAgIGxldCByb3cgPSByb3dzW3Jvd0luZGV4XTtcblxuICAgICAgICBpZiAocm93LmdldEF0dHJpYnV0ZShcInN0eWxlXCIpID09IFwiZGlzcGxheTogbm9uZTtcIikge1xuICAgICAgICAgIC8vIFRoZXJlIGNhbiBiZSByb3dzIGZvciBtYW55IHJlY29yZHMgcHJlc2VudCBpZiB0aGlzIGlzIGEgbW9kZWwgcG9wdXAgZGlhbG9nXG4gICAgICAgICAgLy8gYW5kIG11bHRpcGxlIHJlY29yZHMgaGF2ZSBiZWVuIGNsaWNrZWQgb24gb25lIGFmdGVyIHRoZSBvdGhlclxuICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IGNlbGxzID0gcm93LnF1ZXJ5U2VsZWN0b3JBbGwoXCJkaXZbcm9sZT1ncmlkY2VsbF1cIik7XG4gICAgICAgIGlmIChjZWxscyAmJiBjZWxscy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgbGV0IHJvd09iamVjdCA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG4gICAgICAgICAgcmVzdWx0LnJlbGF0aXZlcy5wdXNoKHJvd09iamVjdCk7XG5cbiAgICAgICAgICBmb3IgKGxldCBjZWxsSW5kZXggPSAwOyBjZWxsSW5kZXggPCBjZWxscy5sZW5ndGg7IGNlbGxJbmRleCsrKSB7XG4gICAgICAgICAgICBsZXQgY2VsbCA9IGNlbGxzW2NlbGxJbmRleF07XG5cbiAgICAgICAgICAgIGxldCBsYWJlbCA9IGNlbGwuZ2V0QXR0cmlidXRlKFwiYXJpYS1sYWJlbFwiKTtcbiAgICAgICAgICAgIGxldCB2YWx1ZSA9IGNsZWFuVGV4dChjZWxsLnRleHRDb250ZW50KTtcblxuICAgICAgICAgICAgaWYgKGxhYmVsICE9IFwiXCIpIHtcbiAgICAgICAgICAgICAgcm93T2JqZWN0W2xhYmVsXSA9IHZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxufVxuXG5mdW5jdGlvbiBleHRyYWN0RGF0YUZvckltYWdlKGZpbG1WaWV3ZXJOb2RlLCByZXN1bHQpIHtcbiAgLy8gRXhhbXBsZSBpbWFnZXM6XG5cbiAgLy8gVGhpcyBvbmUgaGFzIHRyYW5zY3JpYmVkIGRhdGEgdW5kZXIgXCJJbWFnZSBJbmRleFwiXG4gIC8vIGh0dHBzOi8vd3d3LmZhbWlseXNlYXJjaC5vcmcvYXJrOi82MTkwMy8zOjE6UzNIVC1EUjE3LTRZOT9pPTUmd2M9TThWSi1HWjklM0ExNjA3NTAxMDElMkMxNjA5NTM5MDElMkMxNjEwMzU2MDEmY2M9MTgyNDY5MFxuXG4gIC8vIE5vIGluZGV4IG9uIHRoaXMgb25lIGZyb20gV2hpdGluZy0yNDE3XG4gIC8vIGh0dHBzOi8vd3d3LmZhbWlseXNlYXJjaC5vcmcvYXJrOi82MTkwMy8zOjE6M1FTNy04OVdMLVZLU0M/aT0zNzkmd2M9TTdDRC1TNkQlM0EzNTgxMzI5MDElMkMzNjA0MDA2MDEmY2M9MjA3ODY1NFxuXG4gIC8vIEhvb2QtNjU3NCBoYXMgbWFueSBpbWFnZXMgY2l0ZWQuXG4gIC8vIFRoaXMgb25lIGhhcyB0cmFuc2NyaXB0aW9uOlxuICAvLyBodHRwczovL3d3dy5mYW1pbHlzZWFyY2gub3JnL2FyazovNjE5MDMvMzoxOjNRUzctODlTUy05OThUP2k9MzEmY2M9MTgwNDg4OFxuXG4gIC8vIFRoaXMgb25lIGRvZXMgbm90OlxuICAvLyBodHRwczovL3d3dy5mYW1pbHlzZWFyY2gub3JnL2FyazovNjE5MDMvMzoxOjNROU0tQ1MzSi1ENzdGLTE/Y2F0PTE1NzM5NlxuXG4gIGxldCBmaWxtTnVtYmVyTm9kZSA9IGZpbG1WaWV3ZXJOb2RlLnF1ZXJ5U2VsZWN0b3IoXCJkaXYuZmlsbS1udW1iZXJcIik7XG4gIGlmIChmaWxtTnVtYmVyTm9kZSkge1xuICAgIGxldCBmaWxtTnVtYmVyVGV4dCA9IGZpbG1OdW1iZXJOb2RlLnRleHRDb250ZW50O1xuICAgIHJlc3VsdC5maWxtTnVtYmVyID0gZmlsbU51bWJlclRleHQucmVwbGFjZSgvXkZpbG1cXHMqXFwjXFxzKi8sIFwiXCIpLnRyaW0oKTtcbiAgfVxuXG4gIGxldCBjcnVtYnNOb2RlID0gZmlsbVZpZXdlck5vZGUucXVlcnlTZWxlY3RvcihcImZzLXdheXBvaW50LWNydW1ic1wiKTtcbiAgaWYgKGNydW1ic05vZGUpIHtcbiAgICBsZXQgYnJvd3NlUGF0aCA9IFwiXCI7XG4gICAgbGV0IGNydW1iTGlzdCA9IGNydW1ic05vZGUucXVlcnlTZWxlY3RvcihcIm5hdiA+IHVsXCIpO1xuICAgIGlmIChjcnVtYkxpc3QpIHtcbiAgICAgIGxldCBjaGlsZHJlbiA9IGNydW1iTGlzdC5jaGlsZHJlbjtcbiAgICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCBjaGlsZHJlbi5sZW5ndGg7IGluZGV4KyspIHtcbiAgICAgICAgbGV0IGNoaWxkID0gY2hpbGRyZW5baW5kZXhdO1xuICAgICAgICBsZXQgY2hpbGREYXRhTmdSZXBlYXQgPSBjaGlsZC5nZXRBdHRyaWJ1dGUoXCJkYXRhLW5nLXJlcGVhdFwiKTtcbiAgICAgICAgaWYgKGNoaWxkRGF0YU5nUmVwZWF0ICYmIGNoaWxkRGF0YU5nUmVwZWF0LmluY2x1ZGVzKFwiY3J1bWIgaW4gY3J1bWJzXCIpKSB7XG4gICAgICAgICAgbGV0IGNoaWxkVGl0bGUgPSBjaGlsZC5nZXRBdHRyaWJ1dGUoXCJ0aXRsZVwiKTtcbiAgICAgICAgICBpZiAoY2hpbGRUaXRsZSkge1xuICAgICAgICAgICAgaWYgKGJyb3dzZVBhdGgpIHtcbiAgICAgICAgICAgICAgYnJvd3NlUGF0aCArPSBcIiA+IFwiO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYnJvd3NlUGF0aCArPSBjaGlsZFRpdGxlO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICBpZiAoYnJvd3NlUGF0aCkge1xuICAgICAgcmVzdWx0LmltYWdlQnJvd3NlUGF0aCA9IGJyb3dzZVBhdGg7XG4gICAgfVxuXG4gICAgbGV0IHRpdGxlTm9kZSA9IGNydW1ic05vZGUucXVlcnlTZWxlY3RvcihcImxpLnZpc2libGUtcGhvbmUgPiBzcGFuXCIpO1xuICAgIC8vY29uc29sZS5sb2coXCJ0aXRsZVEubGVuZ3RoID0gXCIgKyB0aXRsZVEubGVuZ3RoKTtcbiAgICBpZiAodGl0bGVOb2RlKSB7XG4gICAgICByZXN1bHQuZmlsbVRpdGxlID0gdGl0bGVOb2RlLnRleHRDb250ZW50O1xuICAgIH1cbiAgICBpZiAoIXJlc3VsdC5maWxtTnVtYmVyKSB7XG4gICAgICBmaWxtTnVtYmVyTm9kZSA9IGNydW1ic05vZGUucXVlcnlTZWxlY3RvcihcImxpLmhpZGRlbi1waG9uZSA+IHNwYW4ubmctc2NvcGVcIik7XG4gICAgICBpZiAoZmlsbU51bWJlck5vZGUpIHtcbiAgICAgICAgcmVzdWx0LmZpbG1OdW1iZXIgPSB0aXRsZU5vZGUudGV4dENvbnRlbnQ7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgbGV0IHBhZ2VyID0gZmlsbVZpZXdlck5vZGUucXVlcnlTZWxlY3RvcihcImRpdi5vcGVuU0RQYWdlclwiKTtcbiAgaWYgKHBhZ2VyKSB7XG4gICAgbGV0IGlucHV0ID0gcGFnZXIucXVlcnlTZWxlY3RvcihcImlucHV0W25hbWU9Y3VycmVudFRpbGVOdW1iZXJdXCIpO1xuICAgIGlmIChpbnB1dCkge1xuICAgICAgcmVzdWx0LmltYWdlTnVtYmVyID0gaW5wdXQudmFsdWU7XG4gICAgfVxuICAgIGxldCBhZnRlcklucHV0ID0gcGFnZXIucXVlcnlTZWxlY3RvcihcImxhYmVsLmFmdGVySW5wdXRcIik7XG4gICAgaWYgKGFmdGVySW5wdXQpIHtcbiAgICAgIGxldCB0b3RhbFRleHQgPSBhZnRlcklucHV0LnRleHRDb250ZW50O1xuICAgICAgcmVzdWx0LnRvdGFsSW1hZ2VzID0gdG90YWxUZXh0LnJlcGxhY2UoL15vZlxccyovLCBcIlwiKS50cmltKCk7XG4gICAgfVxuICB9XG5cbiAgbGV0IGltYWdlSW5mbyA9IGZpbG1WaWV3ZXJOb2RlLnF1ZXJ5U2VsZWN0b3IoXCJmcy1pbWFnZS1pbmZvLXBhbmVsXCIpO1xuICBpZiAoaW1hZ2VJbmZvKSB7XG4gICAgbGV0IHRhYmxlID0gaW1hZ2VJbmZvLnF1ZXJ5U2VsZWN0b3IoXCJ0YWJsZVtkYXRhLW5nLWlmPWltYWdlSW5mb1xcXFwuZmlsbU5vdGVzXVwiKTtcbiAgICBpZiAodGFibGUpIHtcbiAgICAgIGxldCB0YWJsZVJvd3MgPSB0YWJsZS5xdWVyeVNlbGVjdG9yQWxsKFwidHIubmctc2NvcGVcIik7XG4gICAgICBpZiAodGFibGVSb3dzKSB7XG4gICAgICAgIGlmICh0YWJsZVJvd3MubGVuZ3RoID09IDEpIHtcbiAgICAgICAgICBsZXQgY2F0YWxvZ0xpbmsgPSB0YWJsZVJvd3NbMF0ucXVlcnlTZWxlY3RvcihcImEubmctYmluZGluZ1wiKTtcbiAgICAgICAgICBpZiAoY2F0YWxvZ0xpbmspIHtcbiAgICAgICAgICAgIHJlc3VsdC5jYXRhbG9nUmVjb3JkTmFtZSA9IGNhdGFsb2dMaW5rLnRleHRDb250ZW50O1xuICAgICAgICAgICAgLy8gdGhpcyBsaW5rIGlzIHJlbGF0aXZlIHRvIGh0dHBzOi8vd3d3LmZhbWlseXNlYXJjaC5vcmdcbiAgICAgICAgICAgIHJlc3VsdC5jYXRhbG9nUmVjb3JkTGluayA9IFwiaHR0cHM6Ly93d3cuZmFtaWx5c2VhcmNoLm9yZ1wiICsgY2F0YWxvZ0xpbmsuZ2V0QXR0cmlidXRlKFwiaHJlZlwiKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBsZXQgaW1hZ2VJbmZvQ29scyA9IHRhYmxlUm93c1swXS5xdWVyeVNlbGVjdG9yQWxsKFwidGRcIik7XG4gICAgICAgICAgaWYgKGltYWdlSW5mb0NvbHMubGVuZ3RoID4gMSkge1xuICAgICAgICAgICAgbGV0IGl0ZW1OdW1iZXJDb2wgPSBpbWFnZUluZm9Db2xzWzFdO1xuICAgICAgICAgICAgbGV0IGl0ZW1OdW1iZXIgPSBpdGVtTnVtYmVyQ29sLnRleHRDb250ZW50O1xuICAgICAgICAgICAgaWYgKGl0ZW1OdW1iZXIpIHtcbiAgICAgICAgICAgICAgcmVzdWx0Lml0ZW1OdW1iZXIgPSBpdGVtTnVtYmVyO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoaW1hZ2VJbmZvQ29scy5sZW5ndGggPiAyKSB7XG4gICAgICAgICAgICBsZXQgbm90ZUNvbCA9IGltYWdlSW5mb0NvbHNbMl07XG4gICAgICAgICAgICBsZXQgbm90ZSA9IG5vdGVDb2wudGV4dENvbnRlbnQ7XG4gICAgICAgICAgICBpZiAobm90ZSkge1xuICAgICAgICAgICAgICByZXN1bHQuZmlsbU5vdGUgPSBub3RlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyB0aGVyZSBhcmUgbXVsdGlwbGUgcm93cy4gU2VlIGlmIHRoZXkgYXJlIGFsbCB0aGUgc2FtZSBjYXRhbG9nXG4gICAgICAgICAgbGV0IGNhdGFsb2dSZWNvcmROYW1lID0gXCJcIjtcbiAgICAgICAgICBsZXQgY2F0YWxvZ1JlY29yZExpbmsgPSBcIlwiO1xuICAgICAgICAgIGxldCBhbGxBcmVUaGVTYW1lID0gdHJ1ZTtcbiAgICAgICAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgdGFibGVSb3dzLmxlbmd0aDsgaW5kZXgrKykge1xuICAgICAgICAgICAgbGV0IHJvdyA9IHRhYmxlUm93c1tpbmRleF07XG4gICAgICAgICAgICBsZXQgY2F0YWxvZ0xpbmsgPSByb3cucXVlcnlTZWxlY3RvcihcImEubmctYmluZGluZ1wiKTtcbiAgICAgICAgICAgIGlmIChjYXRhbG9nTGluaykge1xuICAgICAgICAgICAgICBsZXQgbmV3Q2F0YWxvZ1JlY29yZE5hbWUgPSBjYXRhbG9nTGluay50ZXh0Q29udGVudDtcbiAgICAgICAgICAgICAgLy8gdGhpcyBsaW5rIGlzIHNvbWV0aW1lIHJlbGF0aXZlIHRvIGh0dHBzOi8vd3d3LmZhbWlseXNlYXJjaC5vcmdcbiAgICAgICAgICAgICAgbGV0IG5ld0NhdGFsb2dSZWNvcmRMaW5rID0gY2F0YWxvZ0xpbmsuZ2V0QXR0cmlidXRlKFwiaHJlZlwiKTtcbiAgICAgICAgICAgICAgaWYgKCFuZXdDYXRhbG9nUmVjb3JkTGluay5zdGFydHNXaXRoKFwiaHR0cFwiKSkge1xuICAgICAgICAgICAgICAgIG5ld0NhdGFsb2dSZWNvcmRMaW5rID0gXCJodHRwczovL3d3dy5mYW1pbHlzZWFyY2gub3JnXCIgKyBuZXdDYXRhbG9nUmVjb3JkTGluaztcbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIGlmIChjYXRhbG9nUmVjb3JkTmFtZSA9PSBcIlwiICYmIGNhdGFsb2dSZWNvcmRMaW5rID09IFwiXCIpIHtcbiAgICAgICAgICAgICAgICBjYXRhbG9nUmVjb3JkTmFtZSA9IG5ld0NhdGFsb2dSZWNvcmROYW1lO1xuICAgICAgICAgICAgICAgIGNhdGFsb2dSZWNvcmRMaW5rID0gbmV3Q2F0YWxvZ1JlY29yZExpbms7XG4gICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKGNhdGFsb2dSZWNvcmROYW1lICE9IG5ld0NhdGFsb2dSZWNvcmROYW1lIHx8IGNhdGFsb2dSZWNvcmRMaW5rICE9IG5ld0NhdGFsb2dSZWNvcmRMaW5rKSB7XG4gICAgICAgICAgICAgICAgICBhbGxBcmVUaGVTYW1lID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG5cbiAgICAgICAgICBpZiAoYWxsQXJlVGhlU2FtZSkge1xuICAgICAgICAgICAgcmVzdWx0LmNhdGFsb2dSZWNvcmROYW1lID0gY2F0YWxvZ1JlY29yZE5hbWU7XG4gICAgICAgICAgICByZXN1bHQuY2F0YWxvZ1JlY29yZExpbmsgPSBjYXRhbG9nUmVjb3JkTGluaztcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICBsZXQgY2l0YXRpb25Ob2RlID0gaW1hZ2VJbmZvLnF1ZXJ5U2VsZWN0b3IoXCJwI2ltYWdlLWNpdGF0aW9uXCIpO1xuICAgIGlmIChjaXRhdGlvbk5vZGUpIHtcbiAgICAgIHJlc3VsdC5jaXRhdGlvbiA9IGNpdGF0aW9uTm9kZS50ZXh0Q29udGVudDtcbiAgICB9XG4gIH1cblxuICAvL2NvbnNvbGUubG9nKFwiZXh0cmFjdERhdGFGb3JJbWFnZSwgcmVzdWx0IGlzOlwiKTtcbiAgLy9jb25zb2xlLmxvZyhyZXN1bHQpO1xuXG4gIGlmIChyZXN1bHQuZmlsbU51bWJlciB8fCByZXN1bHQuaW1hZ2VOdW1iZXIpIHtcbiAgICByZXN1bHQucGFnZVR5cGUgPSBcImltYWdlXCI7XG4gIH0gZWxzZSB7XG4gICAgLy8gRlMgaXMgYW4gZXhhbXBsZSBvZiBhIHNpdGUgdGhhdCBzYXlzIGl0J3MgcGFnZSBsb2FkIGlzIGNvbXBsZXRlIGJ1dCB0aGUgZGF0YSBtYXkgbm90IGJlXG4gICAgLy8gdGhlcmUgdG8gZXh0cmFjdC5cbiAgICAvL2NvbnNvbGUubG9nKFwiRlMgZXh0cmFjdERhdGEsIHRyZWF0aW5nIGFzIGluY29tcGxldGVcIik7XG4gICAgcmVzdWx0LmRhdGFNYXlCZUluY29tcGxldGUgPSB0cnVlO1xuICAgIHJlc3VsdC5wYWdlVHlwZSA9IFwidW5rbm93blwiO1xuICB9XG59XG5cbmZ1bmN0aW9uIGV4dHJhY3REYXRhRm9yUGVyc29uUGFnZShkb2N1bWVudCwgcmVzdWx0KSB7XG4gIGZ1bmN0aW9uIGV4dHJhY3REYXRlQW5kUGxhY2VGcm9tVml0YWxzU2VjdGlvbihjYXJkU2VjdGlvbiwgcHJlZml4KSB7XG4gICAgbGV0IGRhdGVFbGVtZW50ID0gY2FyZFNlY3Rpb24ucXVlcnlTZWxlY3RvcihcImRpdi5kaXNwbGF5LWRhdGVcIik7XG4gICAgaWYgKGRhdGVFbGVtZW50KSB7XG4gICAgICBsZXQgbW9yZUxlc3NFbGVtZW50ID0gZGF0ZUVsZW1lbnQucXVlcnlTZWxlY3RvcihcImZzLW1vcmUtbGVzc1wiKTtcbiAgICAgIGlmIChtb3JlTGVzc0VsZW1lbnQpIHtcbiAgICAgICAgbGV0IGRhdGUgPSBtb3JlTGVzc0VsZW1lbnQuZ2V0QXR0cmlidXRlKFwidGl0bGVcIik7XG4gICAgICAgIC8vY29uc29sZS5sb2coXCJtb3JlTGVzc0VsZW1lbnQgaXMgOlwiKTtcbiAgICAgICAgLy9jb25zb2xlLmxvZyhtb3JlTGVzc0VsZW1lbnQpO1xuICAgICAgICBpZiAoZGF0ZSkge1xuICAgICAgICAgIC8vY29uc29sZS5sb2coXCJkYXRlIGlzIDpcIik7XG4gICAgICAgICAgLy9jb25zb2xlLmxvZyhkYXRlKTtcbiAgICAgICAgICByZXN1bHRbcHJlZml4ICsgXCJEYXRlXCJdID0gZGF0ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChtb3JlTGVzc0VsZW1lbnQuc2hhZG93Um9vdCkge1xuICAgICAgICAgIGxldCBzcGFuRWxlbWVudCA9IG1vcmVMZXNzRWxlbWVudC5zaGFkb3dSb290LnF1ZXJ5U2VsZWN0b3IoXCJzcGFuW2RhdGEtdGVzdC1tb3JlLWxlc3MtdGV4dF1cIik7XG4gICAgICAgICAgaWYgKHNwYW5FbGVtZW50KSB7XG4gICAgICAgICAgICBsZXQgb3JpZ2luYWxEYXRlID0gc3BhbkVsZW1lbnQudGV4dENvbnRlbnQ7XG4gICAgICAgICAgICBpZiAob3JpZ2luYWxEYXRlICYmIG9yaWdpbmFsRGF0ZSAhPSBcImZhbHNlXCIpIHtcbiAgICAgICAgICAgICAgcmVzdWx0W3ByZWZpeCArIFwiRGF0ZU9yaWdpbmFsXCJdID0gb3JpZ2luYWxEYXRlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICBsZXQgcGxhY2VFbGVtZW50ID0gY2FyZFNlY3Rpb24ucXVlcnlTZWxlY3RvcihcImRpdi5kaXNwbGF5LXBsYWNlXCIpO1xuICAgIGlmIChwbGFjZUVsZW1lbnQpIHtcbiAgICAgIGxldCB2YWx1ZUVsZW1lbnQgPSBwbGFjZUVsZW1lbnQucXVlcnlTZWxlY3RvcihcIltkYXRhLXRlc3QtcGxhY2VdXCIpO1xuICAgICAgaWYgKHZhbHVlRWxlbWVudCkge1xuICAgICAgICAvLyBjYW4gYWxzbyB1c2UgdGV4dENvbnRlbnQgdG8gZ2V0IHBsYWNlIGFzIGVudGVyZWQuXG4gICAgICAgIGxldCBzdGFuZGFyZGl6ZWRQbGFjZSA9IHZhbHVlRWxlbWVudC5nZXRBdHRyaWJ1dGUoXCJ0aXRsZVwiKTtcbiAgICAgICAgaWYgKHN0YW5kYXJkaXplZFBsYWNlKSB7XG4gICAgICAgICAgcmVzdWx0W3ByZWZpeCArIFwiUGxhY2VcIl0gPSBzdGFuZGFyZGl6ZWRQbGFjZTtcbiAgICAgICAgfVxuICAgICAgICBsZXQgb3JpZ2luYWxQbGFjZSA9IHZhbHVlRWxlbWVudC50ZXh0Q29udGVudDtcbiAgICAgICAgaWYgKG9yaWdpbmFsUGxhY2UgJiYgb3JpZ2luYWxQbGFjZSAhPSBcImZhbHNlXCIpIHtcbiAgICAgICAgICByZXN1bHRbcHJlZml4ICsgXCJQbGFjZU9yaWdpbmFsXCJdID0gb3JpZ2luYWxQbGFjZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIGV4dHJhY3ROYW1lc0Zyb21Gc1RyZWVQZXJzb24oZnNUcmVlUGVyc29uRWxlbWVudCwgcmVzdWx0T2JqZWN0KSB7XG4gICAgbGV0IG5hbWVEaXYgPSBmc1RyZWVQZXJzb25FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCJkaXYuZnMtcGVyc29uX19uYW1lXCIpO1xuICAgIGlmIChuYW1lRGl2KSB7XG4gICAgICBsZXQgZ2l2ZW5OYW1lRWxlbWVudCA9IG5hbWVEaXYucXVlcnlTZWxlY3RvcihcInNwYW4uZnMtcGVyc29uX19naXZlbi1uYW1lXCIpO1xuICAgICAgaWYgKGdpdmVuTmFtZUVsZW1lbnQpIHtcbiAgICAgICAgcmVzdWx0T2JqZWN0LmdpdmVuTmFtZSA9IGdpdmVuTmFtZUVsZW1lbnQudGV4dENvbnRlbnQ7XG4gICAgICB9XG4gICAgICBsZXQgZmFtaWx5TmFtZUVsZW1lbnQgPSBuYW1lRGl2LnF1ZXJ5U2VsZWN0b3IoXCJzcGFuLmZzLXBlcnNvbl9fZmFtaWx5LW5hbWVcIik7XG4gICAgICBpZiAoZmFtaWx5TmFtZUVsZW1lbnQpIHtcbiAgICAgICAgcmVzdWx0T2JqZWN0LnN1cm5hbWUgPSBmYW1pbHlOYW1lRWxlbWVudC50ZXh0Q29udGVudDtcbiAgICAgIH1cbiAgICAgIGxldCBmdWxsTmFtZUVsZW1lbnQgPSBuYW1lRGl2LnF1ZXJ5U2VsZWN0b3IoXCJzcGFuLmZzLXBlcnNvbl9fZnVsbC1uYW1lXCIpO1xuICAgICAgaWYgKGZ1bGxOYW1lRWxlbWVudCkge1xuICAgICAgICByZXN1bHRPYmplY3QuZnVsbE5hbWUgPSBmdWxsTmFtZUVsZW1lbnQudGV4dENvbnRlbnQ7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLy9jb25zb2xlLmxvZyhcImV4dHJhY3REYXRhRm9yUGVyc29uUGFnZTpcIik7XG5cbiAgcmVzdWx0LnBhZ2VUeXBlID0gXCJwZXJzb25cIjtcblxuICBsZXQgcGVyc29uUGFnZUVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiZnMtcGVyc29uLXBhZ2VcIik7XG4gIGlmIChwZXJzb25QYWdlRWxlbWVudCAmJiBwZXJzb25QYWdlRWxlbWVudC5zaGFkb3dSb290KSB7XG4gICAgLy8gdGhlcmUgYXJlIHR3byBwbGFjZXMgdG8gZ2V0IHRoZSBwZXJzb24ncyBuYW1lLCBvbmUgaW4gaGVhZGVyIGFuZCBvbmUgaW4gdml0YWxzXG4gICAgbGV0IHBlcnNvbkVsZW1lbnQgPSBwZXJzb25QYWdlRWxlbWVudC5zaGFkb3dSb290LnF1ZXJ5U2VsZWN0b3IoXCJkaXYucGVyc29uLWhlYWRlci1jb250YWluZXIgPiBmcy10cmVlLXBlcnNvblwiKTtcbiAgICBpZiAocGVyc29uRWxlbWVudCkge1xuICAgICAgZXh0cmFjdE5hbWVzRnJvbUZzVHJlZVBlcnNvbihwZXJzb25FbGVtZW50LCByZXN1bHQpO1xuICAgIH1cblxuICAgIGxldCBkZXRhaWxzRWxlbWVudCA9IHBlcnNvblBhZ2VFbGVtZW50LnNoYWRvd1Jvb3QucXVlcnlTZWxlY3RvcihcIiNwYWdlcyA+IGZzLXRyZWUtcGVyc29uLWRldGFpbHNcIik7XG5cbiAgICBpZiAoZGV0YWlsc0VsZW1lbnQgJiYgZGV0YWlsc0VsZW1lbnQuc2hhZG93Um9vdCkge1xuICAgICAgbGV0IHZpdGFsc0VsZW1lbnQgPSBkZXRhaWxzRWxlbWVudC5zaGFkb3dSb290LnF1ZXJ5U2VsZWN0b3IoXCJmcy10cmVlLXBlcnNvbi12aXRhbHNcIik7XG5cbiAgICAgIGlmICh2aXRhbHNFbGVtZW50ICYmIHZpdGFsc0VsZW1lbnQuc2hhZG93Um9vdCkge1xuICAgICAgICAvL2NvbnNvbGUubG9nKFwidml0YWxzRWxlbWVudCBpcyA6XCIpO1xuICAgICAgICAvL2NvbnNvbGUubG9nKHZpdGFsc0VsZW1lbnQpO1xuXG4gICAgICAgIGxldCBjYXJkRWxlbWVudCA9IHZpdGFsc0VsZW1lbnQuc2hhZG93Um9vdC5xdWVyeVNlbGVjdG9yKFwiZnMtdHJlZS1jb2xsYXBzYWJsZS1jYXJkLnZpdGFsc1wiKTtcblxuICAgICAgICBpZiAoY2FyZEVsZW1lbnQpIHtcbiAgICAgICAgICAvL2NvbnNvbGUubG9nKFwiY2FyZEVsZW1lbnQgaXMgOlwiKTtcbiAgICAgICAgICAvL2NvbnNvbGUubG9nKGNhcmRFbGVtZW50KTtcblxuICAgICAgICAgIGxldCBsaXN0SXRlbXMgPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKFwibGlcIik7XG4gICAgICAgICAgZm9yIChsZXQgbGlzdEl0ZW0gb2YgbGlzdEl0ZW1zKSB7XG4gICAgICAgICAgICAvL2NvbnNvbGUubG9nKFwibGlzdEl0ZW0gaXMgOlwiKTtcbiAgICAgICAgICAgIC8vY29uc29sZS5sb2cobGlzdEl0ZW0pO1xuXG4gICAgICAgICAgICAvL2NvbnNvbGUubG9nKFwibGlzdEl0ZW0uc3R5bGUuZGlzcGxheSBpcyA6XCIpO1xuICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhsaXN0SXRlbS5zdHlsZS5kaXNwbGF5KTtcblxuICAgICAgICAgICAgLy8gVGhlcmUgY2FuIGJlIHJhbmRvbSBsaXN0IGl0ZW1zIGZyb20gcHJldmlvdXMgcGVvcGxlIHRoYXQgaGF2ZSB0aGVpciBkaXNwbGF5IHN0eWxlIHNldCB0byBub25lIVxuICAgICAgICAgICAgaWYgKGxpc3RJdGVtLnN0eWxlLmRpc3BsYXkgIT0gXCJub25lXCIpIHtcbiAgICAgICAgICAgICAgbGV0IGNhcmRJdGVtID0gbGlzdEl0ZW0ucXVlcnlTZWxlY3RvcihcImZzLXRyZWUtY29uY2x1c2lvblwiKTtcbiAgICAgICAgICAgICAgaWYgKGNhcmRJdGVtKSB7XG4gICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhcImNhcmRJdGVtIGlzIDpcIik7XG4gICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhjYXJkSXRlbSk7XG5cbiAgICAgICAgICAgICAgICBpZiAoY2FyZEl0ZW0uc2hhZG93Um9vdCkge1xuICAgICAgICAgICAgICAgICAgbGV0IGNhcmRTZWN0aW9uID0gY2FyZEl0ZW0uc2hhZG93Um9vdC5xdWVyeVNlbGVjdG9yKFwic2VjdGlvblwiKTtcbiAgICAgICAgICAgICAgICAgIGlmIChjYXJkU2VjdGlvbikge1xuICAgICAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKFwiY2FyZFNlY3Rpb24gaXMgOlwiKTtcbiAgICAgICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhjYXJkU2VjdGlvbik7XG5cbiAgICAgICAgICAgICAgICAgICAgbGV0IGNvbmNsdXNpb25UeXBlID0gY2FyZFNlY3Rpb24uZ2V0QXR0cmlidXRlKFwiZGF0YS10ZXN0LWNvbmNsdXNpb24tdHlwZVwiKTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoY29uY2x1c2lvblR5cGUgPT0gXCJOQU1FXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICBsZXQgbmFtZUVsZW1lbnQgPSBjYXJkU2VjdGlvbi5xdWVyeVNlbGVjdG9yKFwiZGl2LmRpc3BsYXktbmFtZVwiKTtcbiAgICAgICAgICAgICAgICAgICAgICBpZiAobmFtZUVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBuYW1lID0gbmFtZUVsZW1lbnQudGV4dENvbnRlbnQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyB3ZSBtYXkgYWxyZWFkeSBoYXZlIG5hbWUgZnJvbSBoZWFkZXJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghcmVzdWx0LmZ1bGxOYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5mdWxsTmFtZSA9IG5hbWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGNvbmNsdXNpb25UeXBlID09IFwiR0VOREVSXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICBsZXQgZ2VuZGVyRWxlbWVudCA9IGNhcmRTZWN0aW9uLnF1ZXJ5U2VsZWN0b3IoXCJkaXYuZGlzcGxheS1nZW5kZXJcIik7XG4gICAgICAgICAgICAgICAgICAgICAgaWYgKGdlbmRlckVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBnZW5kZXIgPSBnZW5kZXJFbGVtZW50LnRleHRDb250ZW50O1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LmdlbmRlciA9IGdlbmRlcjtcbiAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoY29uY2x1c2lvblR5cGUgPT0gXCJCSVJUSFwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgZXh0cmFjdERhdGVBbmRQbGFjZUZyb21WaXRhbHNTZWN0aW9uKGNhcmRTZWN0aW9uLCBcImJpcnRoXCIpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGNvbmNsdXNpb25UeXBlID09IFwiREVBVEhcIikge1xuICAgICAgICAgICAgICAgICAgICAgIGV4dHJhY3REYXRlQW5kUGxhY2VGcm9tVml0YWxzU2VjdGlvbihjYXJkU2VjdGlvbiwgXCJkZWF0aFwiKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBsZXQgZmFtaWx5RWxlbWVudCA9IGRldGFpbHNFbGVtZW50LnNoYWRvd1Jvb3QucXVlcnlTZWxlY3RvcihcImZzLXRyZWUtcGVyc29uLWZhbWlseVwiKTtcblxuICAgICAgaWYgKGZhbWlseUVsZW1lbnQgJiYgZmFtaWx5RWxlbWVudC5zaGFkb3dSb290KSB7XG4gICAgICAgIGxldCBjYXJkRWxlbWVudCA9IGZhbWlseUVsZW1lbnQuc2hhZG93Um9vdC5xdWVyeVNlbGVjdG9yKFwiZnMtdHJlZS1jb2xsYXBzYWJsZS1jYXJkLmZhbWlseVwiKTtcblxuICAgICAgICBpZiAoY2FyZEVsZW1lbnQpIHtcbiAgICAgICAgICBsZXQgZmFtaWx5TWVtYmVyc0VsZW1lbnQgPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiZnMtZmFtaWx5LW1lbWJlcnNcIik7XG5cbiAgICAgICAgICBpZiAoZmFtaWx5TWVtYmVyc0VsZW1lbnQgJiYgZmFtaWx5TWVtYmVyc0VsZW1lbnQuc2hhZG93Um9vdCkge1xuICAgICAgICAgICAgLy8gR2V0IHNwb3VzZXNcblxuICAgICAgICAgICAgbGV0IHNwb3VzZXNFbGVtZW50ID0gZmFtaWx5TWVtYmVyc0VsZW1lbnQuc2hhZG93Um9vdC5xdWVyeVNlbGVjdG9yKFwiI3Nwb3VzZXNcIik7XG5cbiAgICAgICAgICAgIGlmIChzcG91c2VzRWxlbWVudCkge1xuICAgICAgICAgICAgICBsZXQgc3BvdXNlcyA9IHNwb3VzZXNFbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCJmcy1mYW1pbHktbWVtYmVycy1ibG9ja1wiKTtcbiAgICAgICAgICAgICAgZm9yIChsZXQgc3BvdXNlQmxvY2tFbGVtZW50IG9mIHNwb3VzZXMpIHtcbiAgICAgICAgICAgICAgICBpZiAoc3BvdXNlQmxvY2tFbGVtZW50LnNoYWRvd1Jvb3QpIHtcbiAgICAgICAgICAgICAgICAgIGxldCBmYW1pbHlCbG9jayA9IHNwb3VzZUJsb2NrRWxlbWVudC5zaGFkb3dSb290LnF1ZXJ5U2VsZWN0b3IoXCJkaXYuZmFtaWx5LWJsb2NrXCIpO1xuICAgICAgICAgICAgICAgICAgaWYgKGZhbWlseUJsb2NrKSB7XG4gICAgICAgICAgICAgICAgICAgIGxldCBjb3VwbGUgPSBmYW1pbHlCbG9jay5xdWVyeVNlbGVjdG9yKFwiZnMtZmFtaWx5LW1lbWJlcnMtY291cGxlXCIpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoY291cGxlICYmIGNvdXBsZS5zaGFkb3dSb290KSB7XG4gICAgICAgICAgICAgICAgICAgICAgbGV0IHNwb3VzZSA9IHt9O1xuXG4gICAgICAgICAgICAgICAgICAgICAgbGV0IHNwb3VzZUVsZW1lbnQgPSBjb3VwbGUuc2hhZG93Um9vdC5xdWVyeVNlbGVjdG9yKFwiZnMtdHJlZS1wZXJzb246bm90KC5mb2N1c1BlcnNvbilcIik7XG4gICAgICAgICAgICAgICAgICAgICAgaWYgKHNwb3VzZUVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGV4dHJhY3ROYW1lc0Zyb21Gc1RyZWVQZXJzb24oc3BvdXNlRWxlbWVudCwgc3BvdXNlKTtcbiAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICBsZXQgbWFycmlhZ2VEYXRlRWxlbWVudCA9IGNvdXBsZS5zaGFkb3dSb290LnF1ZXJ5U2VsZWN0b3IoXCJzcGFuLm1hcnJpYWdlLWRhdGVcIik7XG4gICAgICAgICAgICAgICAgICAgICAgaWYgKG1hcnJpYWdlRGF0ZUVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBkYXRlU3RyaW5nID0gbWFycmlhZ2VEYXRlRWxlbWVudC50ZXh0Q29udGVudDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRlU3RyaW5nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGVTdHJpbmcgPSBkYXRlU3RyaW5nLnJlcGxhY2UoL15NYXJyaWFnZVxcOlxccyovLCBcIlwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgc3BvdXNlLm1hcnJpYWdlRGF0ZU9yaWdpbmFsID0gZGF0ZVN0cmluZy50cmltKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgc3RkRGF0ZVN0cmluZyA9IG1hcnJpYWdlRGF0ZUVsZW1lbnQuZ2V0QXR0cmlidXRlKFwidGl0bGVcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3RkRGF0ZVN0cmluZykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICBzdGREYXRlU3RyaW5nID0gc3RkRGF0ZVN0cmluZy5yZXBsYWNlKC9eU3RhbmRhcmRcXDpcXHMqLywgXCJcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIHNwb3VzZS5tYXJyaWFnZURhdGUgPSBzdGREYXRlU3RyaW5nLnRyaW0oKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICBsZXQgbWFycmlhZ2VQbGFjZUVsZW1lbnQgPSBjb3VwbGUuc2hhZG93Um9vdC5xdWVyeVNlbGVjdG9yKFwic3Bhbi5tYXJyaWFnZS1wbGFjZVwiKTtcbiAgICAgICAgICAgICAgICAgICAgICBpZiAobWFycmlhZ2VQbGFjZUVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBwbGFjZVN0cmluZyA9IG1hcnJpYWdlUGxhY2VFbGVtZW50LnRleHRDb250ZW50O1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBsYWNlU3RyaW5nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIHNwb3VzZS5tYXJyaWFnZVBsYWNlT3JpZ2luYWwgPSBwbGFjZVN0cmluZy50cmltKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgc3RkUGxhY2VTdHJpbmcgPSBtYXJyaWFnZVBsYWNlRWxlbWVudC5nZXRBdHRyaWJ1dGUoXCJ0aXRsZVwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdGRQbGFjZVN0cmluZykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICBzdGRQbGFjZVN0cmluZyA9IHN0ZFBsYWNlU3RyaW5nLnJlcGxhY2UoL15TdGFuZGFyZFxcOlxccyovLCBcIlwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgc3BvdXNlLm1hcnJpYWdlUGxhY2UgPSBzdGRQbGFjZVN0cmluZy50cmltKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgLy8gYWRkIHRoZSBzcG91c2VcbiAgICAgICAgICAgICAgICAgICAgICBpZiAoIXJlc3VsdC5zcG91c2VzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQuc3BvdXNlcyA9IFtdO1xuICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICByZXN1bHQuc3BvdXNlcy5wdXNoKHNwb3VzZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gR2V0IHBhcmVudHNcblxuICAgICAgICAgICAgbGV0IHBhcmVudHNFbGVtZW50ID0gZmFtaWx5TWVtYmVyc0VsZW1lbnQuc2hhZG93Um9vdC5xdWVyeVNlbGVjdG9yKFwiI3BhcmVudHNcIik7XG4gICAgICAgICAgICBpZiAocGFyZW50c0VsZW1lbnQpIHtcbiAgICAgICAgICAgICAgbGV0IGZhbWlseU1lbWJlcnNCbG9jayA9IHBhcmVudHNFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCJmcy1mYW1pbHktbWVtYmVycy1ibG9ja1wiKTtcbiAgICAgICAgICAgICAgaWYgKGZhbWlseU1lbWJlcnNCbG9jayAmJiBmYW1pbHlNZW1iZXJzQmxvY2suc2hhZG93Um9vdCkge1xuICAgICAgICAgICAgICAgIGxldCBmYW1pbHlCbG9jayA9IGZhbWlseU1lbWJlcnNCbG9jay5zaGFkb3dSb290LnF1ZXJ5U2VsZWN0b3IoXCJkaXYuZmFtaWx5LWJsb2NrXCIpO1xuICAgICAgICAgICAgICAgIGlmIChmYW1pbHlCbG9jaykge1xuICAgICAgICAgICAgICAgICAgbGV0IGNvdXBsZSA9IGZhbWlseUJsb2NrLnF1ZXJ5U2VsZWN0b3IoXCJmcy1mYW1pbHktbWVtYmVycy1jb3VwbGVcIik7XG4gICAgICAgICAgICAgICAgICBpZiAoY291cGxlICYmIGNvdXBsZS5zaGFkb3dSb290KSB7XG4gICAgICAgICAgICAgICAgICAgIGxldCBmYXRoZXJFbGVtZW50ID0gY291cGxlLnNoYWRvd1Jvb3QucXVlcnlTZWxlY3RvcihcImZzLXRyZWUtcGVyc29uLm1hbGVcIik7XG4gICAgICAgICAgICAgICAgICAgIGlmIChmYXRoZXJFbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgICAgICAgbGV0IGZhdGhlciA9IHt9O1xuICAgICAgICAgICAgICAgICAgICAgIGV4dHJhY3ROYW1lc0Zyb21Gc1RyZWVQZXJzb24oZmF0aGVyRWxlbWVudCwgZmF0aGVyKTtcbiAgICAgICAgICAgICAgICAgICAgICByZXN1bHQuZmF0aGVyID0gZmF0aGVyO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgbGV0IG1vdGhlckVsZW1lbnQgPSBjb3VwbGUuc2hhZG93Um9vdC5xdWVyeVNlbGVjdG9yKFwiZnMtdHJlZS1wZXJzb24uZmVtYWxlXCIpO1xuICAgICAgICAgICAgICAgICAgICBpZiAobW90aGVyRWxlbWVudCkge1xuICAgICAgICAgICAgICAgICAgICAgIGxldCBtb3RoZXIgPSB7fTtcbiAgICAgICAgICAgICAgICAgICAgICBleHRyYWN0TmFtZXNGcm9tRnNUcmVlUGVyc29uKG1vdGhlckVsZW1lbnQsIG1vdGhlcik7XG4gICAgICAgICAgICAgICAgICAgICAgcmVzdWx0Lm1vdGhlciA9IG1vdGhlcjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8vY29uc29sZS5sb2cocmVzdWx0KTtcbn1cblxuLy8gQXMgb2YgMTIgU2VwIDIwMjIgIHRoaXMgbmV3IGZvcm1hdCBwYWdlIGlzIGFuIG9wdGlvbiBmcm9tIHRoZSBvbGQgZm9ybWF0IHBhZ2VcbmZ1bmN0aW9uIGV4dHJhY3REYXRhRm9yUGVyc29uUGFnZUZvcm1hdDIoZG9jdW1lbnQsIHBlcnNvbklkLCByZXN1bHQpIHtcbiAgZnVuY3Rpb24gZXh0cmFjdERhdGVBbmRQbGFjZUZyb21WaXRhbHNTZWN0aW9uKGNvbmNsdXNpb25FbGVtZW50LCByZXN1bHRPYmplY3QsIHByZWZpeCkge1xuICAgIGxldCBkYXRlRWxlbWVudCA9IGNvbmNsdXNpb25FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCJzcGFuW2RhdGEtdGVzdGlkPSdjb25jbHVzaW9uLWRhdGUnXVwiKTtcbiAgICBpZiAoZGF0ZUVsZW1lbnQpIHtcbiAgICAgIGxldCBkYXRlID0gZGF0ZUVsZW1lbnQudGV4dENvbnRlbnQ7XG4gICAgICBpZiAoZGF0ZSkge1xuICAgICAgICAvL2NvbnNvbGUubG9nKFwiZGF0ZSBpcyA6XCIpO1xuICAgICAgICAvL2NvbnNvbGUubG9nKGRhdGUpO1xuICAgICAgICBpZiAocHJlZml4KSB7XG4gICAgICAgICAgcmVzdWx0T2JqZWN0W3ByZWZpeCArIFwiRGF0ZVwiXSA9IGRhdGU7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmVzdWx0T2JqZWN0W1wiZGF0ZVwiXSA9IGRhdGU7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgbGV0IHBsYWNlRWxlbWVudCA9IGNvbmNsdXNpb25FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCJzcGFuW2RhdGEtdGVzdGlkPSdjb25jbHVzaW9uLXBsYWNlJ11cIik7XG4gICAgaWYgKHBsYWNlRWxlbWVudCkge1xuICAgICAgbGV0IHBsYWNlID0gcGxhY2VFbGVtZW50LnRleHRDb250ZW50O1xuICAgICAgaWYgKHBsYWNlKSB7XG4gICAgICAgIGlmIChwcmVmaXgpIHtcbiAgICAgICAgICByZXN1bHRPYmplY3RbcHJlZml4ICsgXCJQbGFjZVwiXSA9IHBsYWNlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJlc3VsdE9iamVjdFtcInBsYWNlXCJdID0gcGxhY2U7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBleHRyYWN0TmFtZXNGcm9tUGVyc29uSXRlbShwZXJzb25JdGVtRWxlbWVudCwgcmVzdWx0T2JqZWN0KSB7XG4gICAgbGV0IG5hbWVTcGFuID0gcGVyc29uSXRlbUVsZW1lbnQucXVlcnlTZWxlY3RvcihcInNwYW5bZGF0YS10ZXN0aWQ9J2Z1bGxOYW1lJ11cIik7XG4gICAgaWYgKG5hbWVTcGFuKSB7XG4gICAgICByZXN1bHRPYmplY3QuZnVsbE5hbWUgPSBuYW1lU3Bhbi50ZXh0Q29udGVudDtcbiAgICB9XG4gIH1cblxuICAvL2NvbnNvbGUubG9nKFwiZXh0cmFjdERhdGFGb3JQZXJzb25QYWdlRm9ybWF0MjpcIik7XG5cbiAgbGV0IG1haW5Db250ZW50Tm9kZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCJtYWluI21haW5cIik7XG4gIGlmICghbWFpbkNvbnRlbnROb2RlKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgcmVzdWx0LnBhZ2VUeXBlID0gXCJwZXJzb25cIjtcblxuICBsZXQgdml0YWxzRWxlbWVudCA9IG1haW5Db250ZW50Tm9kZS5xdWVyeVNlbGVjdG9yKFwiZGl2W2RhdGEtdGVzdGlkPSdzZWN0aW9uLWNhcmQtdml0YWxzJ11cIik7XG4gIGlmICh2aXRhbHNFbGVtZW50KSB7XG4gICAgLy9jb25zb2xlLmxvZyhcInZpdGFsc0VsZW1lbnQ6XCIpO1xuICAgIC8vY29uc29sZS5sb2codml0YWxzRWxlbWVudCk7XG5cbiAgICBsZXQgbmFtZUNvbmNsdXNpb25FbGVtZW50ID0gdml0YWxzRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiZGl2W2RhdGEtdGVzdGlkPSdjb25jbHVzaW9uRGlzcGxheTpOQU1FJ11cIik7XG4gICAgaWYgKG5hbWVDb25jbHVzaW9uRWxlbWVudCkge1xuICAgICAgbGV0IG5hbWVFbGVtZW50ID0gbmFtZUNvbmNsdXNpb25FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCJzcGFuW2RhdGEtdGVzdGlkPSdjb25jbHVzaW9uLW5hbWUtdGVtcGxhdGUnXVwiKTtcbiAgICAgIGlmIChuYW1lRWxlbWVudCkge1xuICAgICAgICByZXN1bHQuZnVsbE5hbWUgPSBuYW1lRWxlbWVudC50ZXh0Q29udGVudDtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBsZXQgZ2VuZGVyQ29uY2x1c2lvbkVsZW1lbnQgPSB2aXRhbHNFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCJkaXZbZGF0YS10ZXN0aWQ9J2NvbmNsdXNpb25EaXNwbGF5OkdFTkRFUiddXCIpO1xuICAgIGlmIChnZW5kZXJDb25jbHVzaW9uRWxlbWVudCkge1xuICAgICAgbGV0IGdlbmRlckVsZW1lbnQgPSBnZW5kZXJDb25jbHVzaW9uRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwic3BhbltkYXRhLXRlc3RpZD0nY29uY2x1c2lvbi1nZW5kZXInXVwiKTtcbiAgICAgIGlmIChnZW5kZXJFbGVtZW50KSB7XG4gICAgICAgIHJlc3VsdC5nZW5kZXIgPSBnZW5kZXJFbGVtZW50LnRleHRDb250ZW50O1xuICAgICAgfVxuICAgIH1cblxuICAgIGxldCBiaXJ0aENvbmNsdXNpb25FbGVtZW50ID0gdml0YWxzRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiZGl2W2RhdGEtdGVzdGlkPSdjb25jbHVzaW9uRGlzcGxheTpCSVJUSCddXCIpO1xuICAgIGlmIChiaXJ0aENvbmNsdXNpb25FbGVtZW50KSB7XG4gICAgICBleHRyYWN0RGF0ZUFuZFBsYWNlRnJvbVZpdGFsc1NlY3Rpb24oYmlydGhDb25jbHVzaW9uRWxlbWVudCwgcmVzdWx0LCBcImJpcnRoXCIpO1xuICAgIH1cblxuICAgIGxldCBkZWF0aENvbmNsdXNpb25FbGVtZW50ID0gdml0YWxzRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiZGl2W2RhdGEtdGVzdGlkPSdjb25jbHVzaW9uRGlzcGxheTpERUFUSCddXCIpO1xuICAgIGlmIChkZWF0aENvbmNsdXNpb25FbGVtZW50KSB7XG4gICAgICBleHRyYWN0RGF0ZUFuZFBsYWNlRnJvbVZpdGFsc1NlY3Rpb24oZGVhdGhDb25jbHVzaW9uRWxlbWVudCwgcmVzdWx0LCBcImRlYXRoXCIpO1xuICAgIH1cbiAgfVxuXG4gIGxldCBmYW1pbHlFbGVtZW50ID0gbWFpbkNvbnRlbnROb2RlLnF1ZXJ5U2VsZWN0b3IoXCJkaXZbZGF0YS10ZXN0aWQ9J3NlY3Rpb24tY2FyZC1mYW1pbHknXVwiKTtcbiAgaWYgKGZhbWlseUVsZW1lbnQpIHtcbiAgICBsZXQgZmFtaWxpZXMgPSBmYW1pbHlFbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCJkaXZbZGF0YS10ZXN0aWRePSdmYW1pbHktJ11cIik7XG4gICAgZm9yIChsZXQgZmFtaWx5IG9mIGZhbWlsaWVzKSB7XG4gICAgICBsZXQgZmFtaWx5SWQgPSBmYW1pbHkuZ2V0QXR0cmlidXRlKFwiZGF0YS10ZXN0aWRcIik7XG4gICAgICBpZiAoZmFtaWx5SWQuaW5jbHVkZXMocGVyc29uSWQpKSB7XG4gICAgICAgIC8vIHRoaXMgaXMgYSBzcG91c2UgYW5kIGNoaWxkcmVuXG4gICAgICAgIGxldCBjb3VwbGVFbGVtZW50ID0gZmFtaWx5LnF1ZXJ5U2VsZWN0b3IoXCJ1bFtkYXRhLXRlc3RpZD0nY291cGxlLXBlcnNvbnMnXVwiKTtcbiAgICAgICAgaWYgKGNvdXBsZUVsZW1lbnQpIHtcbiAgICAgICAgICBsZXQgY291cGxlUGVyc29ucyA9IGNvdXBsZUVsZW1lbnQucXVlcnlTZWxlY3RvckFsbChcImxpW2RhdGEtdGVzdGlkPSdwZXJzb24taXRlbSddXCIpO1xuICAgICAgICAgIGlmIChjb3VwbGVQZXJzb25zLmxlbmd0aCA9PSAyKSB7XG4gICAgICAgICAgICBsZXQgc3BvdXNlRWxlbWVudCA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIGZvciAobGV0IHBlcnNvbiBvZiBjb3VwbGVQZXJzb25zKSB7XG4gICAgICAgICAgICAgIGlmICghcGVyc29uLmhhc0F0dHJpYnV0ZShcImZvY3VzLXBlcnNvblwiKSkge1xuICAgICAgICAgICAgICAgIHNwb3VzZUVsZW1lbnQgPSBwZXJzb247XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChzcG91c2VFbGVtZW50KSB7XG4gICAgICAgICAgICAgIGxldCBzcG91c2UgPSB7fTtcbiAgICAgICAgICAgICAgZXh0cmFjdE5hbWVzRnJvbVBlcnNvbkl0ZW0oc3BvdXNlRWxlbWVudCwgc3BvdXNlKTtcblxuICAgICAgICAgICAgICBleHRyYWN0RGF0ZUFuZFBsYWNlRnJvbVZpdGFsc1NlY3Rpb24oY291cGxlRWxlbWVudCwgc3BvdXNlLCBcIm1hcnJpYWdlXCIpO1xuXG4gICAgICAgICAgICAgIGlmICghcmVzdWx0LnNwb3VzZXMpIHtcbiAgICAgICAgICAgICAgICByZXN1bHQuc3BvdXNlcyA9IFtdO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIHJlc3VsdC5zcG91c2VzLnB1c2goc3BvdXNlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIHRoaXMgbXVzdCBiZSBwYXJlbnRzIGFuZCBzaWJsaW5nc1xuICAgICAgICBsZXQgY291cGxlRWxlbWVudCA9IGZhbWlseS5xdWVyeVNlbGVjdG9yKFwidWxbZGF0YS10ZXN0aWQ9J2NvdXBsZS1wZXJzb25zJ11cIik7XG4gICAgICAgIGlmIChjb3VwbGVFbGVtZW50KSB7XG4gICAgICAgICAgbGV0IGNvdXBsZVBlcnNvbnMgPSBjb3VwbGVFbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCJsaVtkYXRhLXRlc3RpZD0ncGVyc29uLWl0ZW0nXVwiKTtcbiAgICAgICAgICBpZiAoY291cGxlUGVyc29ucy5sZW5ndGggPT0gMikge1xuICAgICAgICAgICAgbGV0IGZhdGhlckVsZW1lbnQgPSBjb3VwbGVQZXJzb25zWzBdO1xuICAgICAgICAgICAgbGV0IG1vdGhlckVsZW1lbnQgPSBjb3VwbGVQZXJzb25zWzFdO1xuXG4gICAgICAgICAgICBsZXQgZmF0aGVyID0ge307XG4gICAgICAgICAgICBleHRyYWN0TmFtZXNGcm9tUGVyc29uSXRlbShmYXRoZXJFbGVtZW50LCBmYXRoZXIpO1xuICAgICAgICAgICAgcmVzdWx0LmZhdGhlciA9IGZhdGhlcjtcblxuICAgICAgICAgICAgbGV0IG1vdGhlciA9IHt9O1xuICAgICAgICAgICAgZXh0cmFjdE5hbWVzRnJvbVBlcnNvbkl0ZW0obW90aGVyRWxlbWVudCwgbW90aGVyKTtcbiAgICAgICAgICAgIHJlc3VsdC5tb3RoZXIgPSBtb3RoZXI7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLy9jb25zb2xlLmxvZyhyZXN1bHQpO1xufVxuXG5mdW5jdGlvbiBleHRyYWN0RGF0YUZvclBvcHVwKHNlYXJjaEFydGlmYWN0UmVzdWx0cywgcmVzdWx0KSB7XG4gIGxldCBzaGFkb3dSb290MSA9IHNlYXJjaEFydGlmYWN0UmVzdWx0cy5zaGFkb3dSb290O1xuXG4gIGxldCBmc1JlY29yZERldGFpbHNNb2RhbCA9IHNoYWRvd1Jvb3QxLnF1ZXJ5U2VsZWN0b3IoXCJmcy1yZWNvcmQtZGV0YWlscy1tb2RhbFwiKTtcblxuICBpZiAoZnNSZWNvcmREZXRhaWxzTW9kYWwpIHtcbiAgICBsZXQgc2hhZG93Um9vdDIgPSBmc1JlY29yZERldGFpbHNNb2RhbC5zaGFkb3dSb290O1xuXG4gICAgbGV0IGZzUmVjb3JkRGV0YWlscyA9IHNoYWRvd1Jvb3QyLnF1ZXJ5U2VsZWN0b3IoXCJmcy1yZWNvcmQtZGV0YWlsc1wiKTtcblxuICAgIGlmIChmc1JlY29yZERldGFpbHMpIHtcbiAgICAgIGxldCBzaGFkb3dSb290MyA9IGZzUmVjb3JkRGV0YWlscy5zaGFkb3dSb290O1xuXG4gICAgICBsZXQgcmVjb3JkRGV0YWlscyA9IHNoYWRvd1Jvb3QzLnF1ZXJ5U2VsZWN0b3IoXCJyZWNvcmQtZGV0YWlsc1wiKTtcblxuICAgICAgaWYgKHJlY29yZERldGFpbHMpIHtcbiAgICAgICAgbGV0IHNoYWRvd1Jvb3Q0ID0gcmVjb3JkRGV0YWlscy5zaGFkb3dSb290O1xuXG4gICAgICAgIHJlc3VsdC5wYWdlVHlwZSA9IFwicmVjb3JkIHBvcHVwXCI7XG5cbiAgICAgICAgLy8gIERvY3VtZW50IEluZm9cblxuICAgICAgICBsZXQgcmREb2N1bWVudEluZm8gPSBzaGFkb3dSb290NC5xdWVyeVNlbGVjdG9yKFwicmQtZG9jdW1lbnQtaW5mb1wiKTtcbiAgICAgICAgaWYgKHJkRG9jdW1lbnRJbmZvKSB7XG4gICAgICAgICAgbGV0IHNoYWRvd1Jvb3Q1ID0gcmREb2N1bWVudEluZm8uc2hhZG93Um9vdDtcblxuICAgICAgICAgIGxldCBjb2xsZWN0aW9uTGluayA9IHNoYWRvd1Jvb3Q1LnF1ZXJ5U2VsZWN0b3IoXCJhLmNvbGxlY3Rpb24tbGlua1wiKTtcblxuICAgICAgICAgIGlmIChjb2xsZWN0aW9uTGluaykge1xuICAgICAgICAgICAgcmVzdWx0LmNvbGxlY3Rpb25OYW1lID0gY29sbGVjdGlvbkxpbmsudGV4dENvbnRlbnQ7XG4gICAgICAgICAgICAvLyB0aGlzIGxpbmsgaXMgcmVsYXRpdmUgdG8gZmFtaWx5c2VhcmNoLm9yZ1xuICAgICAgICAgICAgcmVzdWx0LmNvbGxlY3Rpb25MaW5rID0gY29sbGVjdGlvbkxpbmsuZ2V0QXR0cmlidXRlKFwiaHJlZlwiKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBsZXQgZG9jdW1lbnRJbmZvRmllbGRzID0gc2hhZG93Um9vdDUucXVlcnlTZWxlY3RvcihcImRpdi5kb2N1bWVudC1pbmZvLWlubmVyID4gdGFibGUuZmllbGRzXCIpO1xuICAgICAgICAgIGlmIChkb2N1bWVudEluZm9GaWVsZHMpIHtcbiAgICAgICAgICAgIHZhciBkb2NUYWJsZVJlc3VsdCA9IHt9O1xuICAgICAgICAgICAgZXh0cmFjdFJlY29yZERhdGEoZG9jdW1lbnRJbmZvRmllbGRzLCBkb2NUYWJsZVJlc3VsdCk7XG5cbiAgICAgICAgICAgIHJlc3VsdC5kb2NJbmZvRGF0YSA9IGRvY1RhYmxlUmVzdWx0LnJlY29yZERhdGE7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgbGV0IGNpdGF0aW9uTm9kZSA9IHNoYWRvd1Jvb3Q1LnF1ZXJ5U2VsZWN0b3IoXCJwLmNpdGF0aW9uXCIpO1xuXG4gICAgICAgICAgaWYgKGNpdGF0aW9uTm9kZSkge1xuICAgICAgICAgICAgcmVzdWx0LmNpdGF0aW9uID0gY2l0YXRpb25Ob2RlLnRleHRDb250ZW50O1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFJlY29yZCBkZXRhaWxzXG5cbiAgICAgICAgbGV0IHJkUGVyc29uID0gc2hhZG93Um9vdDQucXVlcnlTZWxlY3RvcihcInJkLXBlcnNvblwiKTtcbiAgICAgICAgaWYgKHJkUGVyc29uKSB7XG4gICAgICAgICAgbGV0IHNoYWRvd1Jvb3Q1ID0gcmRQZXJzb24uc2hhZG93Um9vdDtcblxuICAgICAgICAgIC8vIE5vdCBzdXJlIGlmIHdlIG5lZWQgdGhlIHBlcnNvbiBoZWFkZXIgLSBpdCBnaXZlcyB0aGUgZ2VuZGVyLCBuYW1lIGFuZCBjb2xsZWN0aW9uIHRpdGxlXG4gICAgICAgICAgLy8gdW5sZXNzIGluIHRoZSByZWNvcmQgb2Ygc29tZW9uZSBlbHNlIChsaWtlIGEgY2hpbGQpIGluIHdoaWNoIGNhc2UgaXQgc2F5cyB0aGF0XG4gICAgICAgICAgbGV0IHBlcnNvbkhlYWRlciA9IHNoYWRvd1Jvb3Q1LnF1ZXJ5U2VsZWN0b3IoXCJkaXYucGVyc29uLWhlYWRlclwiKTtcblxuICAgICAgICAgIC8vIGdldCB0aGUgbWFpbiB0YWJsZSBkYXRhXG4gICAgICAgICAgbGV0IHRhYmxlID0gc2hhZG93Um9vdDUucXVlcnlTZWxlY3RvcihcInRhYmxlLmZpZWxkc1wiKTtcbiAgICAgICAgICBpZiAodGFibGUpIHtcbiAgICAgICAgICAgIGV4dHJhY3RSZWNvcmREYXRhKHRhYmxlLCByZXN1bHQpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIC8vIHNvbWV0aW1lcyAoZS5nLiBhIGNlbnN1cykgdGhlcmUgYXJlIHJlbGF0aXZlcyBpbiBhIHBzZXVkbyB0YWJsZVxuICAgICAgICAgIGxldCByZWxhdGl2ZXMgPSBzaGFkb3dSb290NS5xdWVyeVNlbGVjdG9yKFwiZGl2LnJlbGF0aXZlc1wiKTtcbiAgICAgICAgICBpZiAocmVsYXRpdmVzKSB7XG4gICAgICAgICAgICBleHRyYWN0UmVsYXRpdmVzKHJlbGF0aXZlcywgcmVzdWx0KTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cbn1cblxuZnVuY3Rpb24gZXh0cmFjdERhdGEoZG9jdW1lbnQsIHVybCkge1xuICAvL2NvbnNvbGUubG9nKFwiZnMgZXh0cmFjdERhdGEsIHVybCA9IFwiICsgdXJsKTtcblxuICB2YXIgcmVzdWx0ID0ge307XG5cbiAgcmVzdWx0LnVybCA9IHVybDtcblxuICAvLyBmaXJzdCBkZXRlcm1pbmUgd2hhdCBraW5kIG9mIHBhZ2Ugd2UgYXJlIGluLlxuXG4gIGxldCBtYWluQ29udGVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjbWFpbi1jb250ZW50LXNlY3Rpb25cIik7XG5cbiAgLy9jb25zb2xlLmxvZyhcIm1haW5Db250ZW50IGlzXCIpO1xuICAvL2NvbnNvbGUubG9nKG1haW5Db250ZW50KTtcblxuICBpZiAobWFpbkNvbnRlbnQpIHtcbiAgICBsZXQgZmlsbVZpZXdlck5vZGUgPSBtYWluQ29udGVudC5xdWVyeVNlbGVjdG9yKFwiZnMtZmlsbS12aWV3ZXJcIik7XG4gICAgaWYgKGZpbG1WaWV3ZXJOb2RlKSB7XG4gICAgICBleHRyYWN0RGF0YUZvckltYWdlKGZpbG1WaWV3ZXJOb2RlLCByZXN1bHQpO1xuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9IGVsc2UgaWYgKHVybC5zdGFydHNXaXRoKFwiaHR0cHM6Ly93d3cuZmFtaWx5c2VhcmNoLm9yZy90cmVlL3BlcnNvbi9kZXRhaWxzL1wiKSkge1xuICAgICAgLy8gaXQgaXMgYSBwZXJzb24gcGFnZVxuICAgICAgLy9jb25zb2xlLmxvZyhcImV4dHJhY3REYXRhLCBpdCBpcyBhIHBlcnNvbjpcIik7XG5cbiAgICAgIGV4dHJhY3REYXRhRm9yUGVyc29uUGFnZShkb2N1bWVudCwgcmVzdWx0KTtcbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIG1haW5Db250ZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNtYWluXCIpO1xuICAgIGlmIChtYWluQ29udGVudCkge1xuICAgICAgLy8gdGhpcyBpcyBhIG5ld2VyIGZvcm1hdCBwYWdlLCBvbmx5IHN1cHBvcnRlZCBmb3IgcGVyc29uIHBhZ2VzIGN1cnJlbnRseVxuICAgICAgaWYgKHVybC5zdGFydHNXaXRoKFwiaHR0cHM6Ly93d3cuZmFtaWx5c2VhcmNoLm9yZy90cmVlL3BlcnNvbi9kZXRhaWxzL1wiKSkge1xuICAgICAgICAvLyBpdCBpcyBhIHBlcnNvbiBwYWdlXG4gICAgICAgIC8vY29uc29sZS5sb2coXCJleHRyYWN0RGF0YSwgaXQgaXMgYSBwZXJzb246XCIpO1xuXG4gICAgICAgIGxldCBwZXJzb25JZCA9IHVybC5yZXBsYWNlKFwiaHR0cHM6Ly93d3cuZmFtaWx5c2VhcmNoLm9yZy90cmVlL3BlcnNvbi9kZXRhaWxzL1wiLCBcIlwiKTtcblxuICAgICAgICBleHRyYWN0RGF0YUZvclBlcnNvblBhZ2VGb3JtYXQyKGRvY3VtZW50LCBwZXJzb25JZCwgcmVzdWx0KTtcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwicGFnZSB0eXBlIGlzIHVua25vd24gYnV0IGhhcyBhICNtYWluIGVsZW1lbnRcIik7XG4gICAgICAgIHJlc3VsdC5wYWdlVHlwZSA9IFwidW5rbm93blwiO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICAvLyBwYWdlIG1heSBiZSBwYXJ0aWFsbHkgbG9hZGVkXG4gICAgICBjb25zb2xlLmxvZyhcInBhZ2UgdHlwZSBpcyB1bmtub3duXCIpO1xuXG4gICAgICByZXN1bHQucGFnZVR5cGUgPSBcInVua25vd25cIjtcbiAgICAgIHJlc3VsdC5kYXRhTWF5QmVJbmNvbXBsZXRlID0gdHJ1ZTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gcmVzdWx0O1xuXG4gIC8vIEN1cnJlbnRseSBpdCBuZXZlciBnZXRzIHRoaXMgZmFyIGJlY2F1c2Ugd2UgdXNlIGZldGNoIGZvciBub24taW1hZ2UgcGFnZXNcbiAgLy8gVGhlIGJlbG93IGhhcyBiZWVuIGNvbnZlcnRlZCB0byBub3QgdXNlIGpRdWVyeSBidXQgbm90IHRlc3RlZFxuICAvKlxuICBsZXQgc2VhcmNoQXJ0aWZhY3RSZXN1bHRzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNtYWluLWNvbnRlbnQtc2VjdGlvbiA+IGRpdi5mdWxsLXdpZHRoID4gc2VhcmNoLWFydGlmYWN0LXJlc3VsdHNcIik7XG4gIGlmIChzZWFyY2hBcnRpZmFjdFJlc3VsdHMpIHtcbiAgICBleHRyYWN0RGF0YUZvclBvcHVwKHNlYXJjaEFydGlmYWN0UmVzdWx0cywgcmVzdWx0KVxuICB9XG4gIGVsc2Uge1xuICAgIFxuICAgIGxldCByZWNvcmRTZWN0aW9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNtYWluID4gZGl2LmNzcy0xYzhzNDZjLWFwcENzcyA+IGRpdiA+IGRpdiA+IGRpdi5jc3MtMXBzdTZtdi1yZWFkeUNzc1wiKTtcblxuICAgIGxldCBoZWFkZXIgPSByZWNvcmRTZWN0aW9uLnF1ZXJ5U2VsZWN0b3IoXCI+IGRpdiA+IGRpdi5jc3MtMTNoaWhhLWhlYWRlckNzc1wiKTtcbiAgICBsZXQgbGVmdFNpZGUgPSByZWNvcmRTZWN0aW9uLnF1ZXJ5U2VsZWN0b3IoXCI+IGRpdiA+IGRpdi5jc3MtZHFhZXc4LXJlY29yZENzcyA+IGRpdiA+IGRpdjpudGgtY2hpbGQoMSlcIik7XG4gICAgbGV0IHJpZ2h0U2lkZSA9IHJlY29yZFNlY3Rpb24ucXVlcnlTZWxlY3RvcihcIj4gZGl2ID4gZGl2LmNzcy1kcWFldzgtcmVjb3JkQ3NzID4gZGl2ID4gZGl2Om50aC1jaGlsZCgyKVwiKTtcblxuICAgIC8vIGxlZnQgc2lkZVxuICAgIGxldCBtYWluUGVyc29uVGFibGUgPSBsZWZ0U2lkZS5xdWVyeVNlbGVjdG9yKFwiPiB0YWJsZVwiKTtcblxuICAgIGxldCBhZGRpdGlvbmFsUGVyc29uc1RhYmxlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNhZGRpdGlvbmFsUGVyc29ucyA+IGRpdiA+IGRpdi5jc3MtbXQ1cDdoLWFkZGl0aW9uYWxQZXJzb25Sb3dDc3MgPiBkaXYuY3NzLWRmYXdrci1sb3dlckJvcmRlckNzcyA+IGRpdiA+IGRpdiA+IHRhYmxlXCIpO1xuXG4gICAgbGV0IGNpdGF0aW9uUSA9IHJpZ2h0U2lkZS5xdWVyeVNlbGVjdG9yKFwiI2NpdGF0aW9uXCIpO1xuICAgIHJlc3VsdC5jaXRhdGlvbiA9IGNpdGF0aW9uLnRleHRDb250ZW50O1xuXG5cbiAgICByZXN1bHQucmVjb3JkU2VjdGlvbiA9IHJlY29yZFNlY3Rpb247XG4gICAgcmVzdWx0LmhlYWRlciA9IGhlYWRlcjtcbiAgICByZXN1bHQubGVmdFNpZGUgPSBsZWZ0U2lkZTtcbiAgICByZXN1bHQucmlnaHRTaWRlID0gcmlnaHRTaWRlO1xuICAgIHJlc3VsdC5tYWluUGVyc29uVGFibGUgPSBtYWluUGVyc29uVGFibGU7XG4gICAgcmVzdWx0LmFkZGl0aW9uYWxQZXJzb25zVGFibGUgPSBhZGRpdGlvbmFsUGVyc29uc1RhYmxlO1xuICB9XG5cbiAgcmV0dXJuIHJlc3VsdDtcbiAgKi9cbn1cblxuZnVuY3Rpb24gZ2V0RGF0ZVZhbHVlRnJvbURhdGUoZGF0ZSwgZmllbGRUeXBlRW5kaW5nLCBsYWJlbElkKSB7XG4gIGlmIChkYXRlLnZhbHVlcykge1xuICAgIGZvciAobGV0IHZhbHVlIG9mIGRhdGUudmFsdWVzKSB7XG4gICAgICBpZiAodmFsdWUubGFiZWxJZCA9PSBsYWJlbElkKSB7XG4gICAgICAgIHJlc3VsdC5ldmVudFllYXIgPSB2YWx1ZS50ZXh0O1xuICAgICAgfVxuICAgIH1cbiAgfVxuICBsZXQgY2xvc2VNYXRjaCA9IHVuZGVmaW5lZDtcbiAgaWYgKGRhdGUuZmllbGRzKSB7XG4gICAgZm9yIChsZXQgZmllbGQgb2YgZGF0ZS5maWVsZHMpIHtcbiAgICAgIGxldCB0eXBlID0gZmllbGQudHlwZTtcbiAgICAgIGlmICh0eXBlICYmIHR5cGUuZW5kc1dpdGgoZmllbGRUeXBlRW5kaW5nKSkge1xuICAgICAgICBmb3IgKGxldCB2YWx1ZSBvZiBmaWVsZC52YWx1ZXMpIHtcbiAgICAgICAgICBpZiAodmFsdWUubGFiZWxJZCA9PSBsYWJlbElkKSB7XG4gICAgICAgICAgICByZXR1cm4gdmFsdWUudGV4dDsgLy8gbWF0Y2hlcyBib3RoIHR5cGUgYW5kIGxhYmVsSWRcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIWNsb3NlTWF0Y2ggJiYgZmllbGQudmFsdWVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICBjbG9zZU1hdGNoID0gZmllbGQudmFsdWVzWzBdLnRleHQ7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmIChmaWVsZC52YWx1ZXMpIHtcbiAgICAgICAgICBmb3IgKGxldCB2YWx1ZSBvZiBmaWVsZC52YWx1ZXMpIHtcbiAgICAgICAgICAgIGlmICh2YWx1ZS5sYWJlbElkID09IGxhYmVsSWQpIHtcbiAgICAgICAgICAgICAgaWYgKCFjbG9zZU1hdGNoICYmIGZpZWxkLnZhbHVlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgY2xvc2VNYXRjaCA9IGZpZWxkLnZhbHVlc1swXS50ZXh0O1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIGNsb3NlTWF0Y2g7XG59XG5cbmZ1bmN0aW9uIGdldENsZWFuRGF0ZVZhbHVlRnJvbURhdGUoZGF0ZSwgZmllbGRUeXBlRW5kaW5nLCBsYWJlbElkKSB7XG4gIGxldCB2YWx1ZSA9IGdldERhdGVWYWx1ZUZyb21EYXRlKGRhdGUsIGZpZWxkVHlwZUVuZGluZywgbGFiZWxJZCk7XG4gIGlmICh2YWx1ZSkge1xuICAgIC8vIGNsZWFuIGRhdGVcbiAgICB2YWx1ZSA9IHZhbHVlLnRyaW0oKTtcbiAgICBpZiAoL14wXFxkXFxzLy50ZXN0KHZhbHVlKSkge1xuICAgICAgLy8gcmVtb3ZlIGxlYWRpbmcgemVyb1xuICAgICAgdmFsdWUgPSB2YWx1ZS5zdWJzdHJpbmcoMSk7XG4gICAgfVxuICAgIGlmICgvXmZyb20gLy50ZXN0KHZhbHVlKSkge1xuICAgICAgLy8gY2FuIGJlIGxpa2UgXCJmcm9tIDE4NjEgdG8gMTg2NVwiIGluIHdoaWNoIGNhc2UgY2hhbmdlIHRvIFwiMTg2MS0xODY1XCJcbiAgICAgIHZhbHVlID0gdmFsdWUucmVwbGFjZSgvZnJvbSAoXFxkKykgdG8gKFxcZCspLywgXCIkMS0kMlwiKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHZhbHVlO1xufVxuXG5mdW5jdGlvbiBzZXRGaWVsZEZyb21EYXRlKGRhdGUsIGZpZWxkVHlwZUVuZGluZywgbGFiZWxJZCwgcmVzdWx0LCByZXN1bHRGaWVsZE5hbWUpIHtcbiAgbGV0IHZhbHVlID0gZ2V0Q2xlYW5EYXRlVmFsdWVGcm9tRGF0ZShkYXRlLCBmaWVsZFR5cGVFbmRpbmcsIGxhYmVsSWQpO1xuICBpZiAodmFsdWUpIHtcbiAgICByZXN1bHRbcmVzdWx0RmllbGROYW1lXSA9IHZhbHVlO1xuICB9XG59XG5cbmZ1bmN0aW9uIGdldFBsYWNlVmFsdWVGcm9tUGxhY2UocGxhY2UsIGZpZWxkVHlwZUVuZGluZywgbGFiZWxJZCkge1xuICBpZiAocGxhY2UudmFsdWVzKSB7XG4gICAgaWYgKGxhYmVsSWQpIHtcbiAgICAgIGZvciAobGV0IHZhbHVlIG9mIHBsYWNlLnZhbHVlcykge1xuICAgICAgICBpZiAodmFsdWUubGFiZWxJZCA9PSBsYWJlbElkKSB7XG4gICAgICAgICAgcmV0dXJuIHZhbHVlLnRleHQ7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKCFmaWVsZFR5cGVFbmRpbmcpIHtcbiAgICAgIGlmICh2YWx1ZXMubGVuZ3RoID09IDEpIHtcbiAgICAgICAgcmV0dXJuIHZhbHVlc1swXS50ZXh0O1xuICAgICAgfVxuICAgIH1cbiAgfVxuICBpZiAocGxhY2UuZmllbGRzKSB7XG4gICAgZm9yIChsZXQgZmllbGQgb2YgcGxhY2UuZmllbGRzKSB7XG4gICAgICBpZiAoZmllbGQudmFsdWVzKSB7XG4gICAgICAgIGxldCB0eXBlID0gZmllbGQudHlwZTtcbiAgICAgICAgZm9yIChsZXQgdmFsdWUgb2YgZmllbGQudmFsdWVzKSB7XG4gICAgICAgICAgaWYgKCh0eXBlICYmIGZpZWxkVHlwZUVuZGluZyAmJiB0eXBlLmVuZHNXaXRoKGZpZWxkVHlwZUVuZGluZykpIHx8IHZhbHVlLmxhYmVsSWQgPT0gbGFiZWxJZCkge1xuICAgICAgICAgICAgcmV0dXJuIHZhbHVlLnRleHQ7XG4gICAgICAgICAgfSBlbHNlIGlmICghZmllbGRUeXBlRW5kaW5nICYmICFsYWJlbElkKSB7XG4gICAgICAgICAgICBpZiAodmFsdWUudGV4dCkge1xuICAgICAgICAgICAgICByZXR1cm4gdmFsdWUudGV4dDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICByZXR1cm4gdW5kZWZpbmVkO1xufVxuXG5mdW5jdGlvbiBjbGVhblBsYWNlU3RyaW5nKHZhbHVlKSB7XG4gIGlmICghdmFsdWUpIHtcbiAgICByZXR1cm4gdmFsdWU7XG4gIH1cblxuICB3aGlsZSAodmFsdWUuc3RhcnRzV2l0aChcIixcIikpIHtcbiAgICB2YWx1ZSA9IHZhbHVlLnN1YnN0cmluZygxKS50cmltKCk7XG4gIH1cblxuICB3aGlsZSAodmFsdWUuZW5kc1dpdGgoXCIsXCIpKSB7XG4gICAgdmFsdWUgPSB2YWx1ZS5zdWJzdHJpbmcoMCwgdmFsdWUubGVuZ3RoIC0gMSkudHJpbSgpO1xuICB9XG5cbiAgcmV0dXJuIHZhbHVlO1xufVxuXG5mdW5jdGlvbiBnZXRDbGVhblBsYWNlVmFsdWVGcm9tUGxhY2UocGxhY2UsIGZpZWxkVHlwZUVuZGluZywgbGFiZWxJZCkge1xuICBsZXQgdmFsdWUgPSBnZXRQbGFjZVZhbHVlRnJvbVBsYWNlKHBsYWNlLCBmaWVsZFR5cGVFbmRpbmcsIGxhYmVsSWQpO1xuICBpZiAodmFsdWUpIHtcbiAgICB2YWx1ZSA9IGNsZWFuUGxhY2VTdHJpbmcodmFsdWUpO1xuICB9XG4gIHJldHVybiB2YWx1ZTtcbn1cblxuZnVuY3Rpb24gc2V0RmllbGRGcm9tUGxhY2UocGxhY2UsIGZpZWxkVHlwZUVuZGluZywgbGFiZWxJZCwgcmVzdWx0LCByZXN1bHRGaWVsZE5hbWUpIHtcbiAgbGV0IHZhbHVlID0gZ2V0Q2xlYW5QbGFjZVZhbHVlRnJvbVBsYWNlKHBsYWNlLCBmaWVsZFR5cGVFbmRpbmcsIGxhYmVsSWQpO1xuICBpZiAodmFsdWUpIHtcbiAgICByZXN1bHRbcmVzdWx0RmllbGROYW1lXSA9IHZhbHVlO1xuICB9XG59XG5cbmZ1bmN0aW9uIHNldEZpZWxkRnJvbVBsYWNlV2l0aExhYmVscyhwbGFjZSwgbGFiZWxJZExpc3QsIHJlc3VsdCwgcmVzdWx0RmllbGROYW1lKSB7XG4gIGZvciAobGV0IGxhYmVsSWQgb2YgbGFiZWxJZExpc3QpIHtcbiAgICBsZXQgdmFsdWUgPSBnZXRDbGVhblBsYWNlVmFsdWVGcm9tUGxhY2UocGxhY2UsIFwiXCIsIGxhYmVsSWQpO1xuICAgIGlmICh2YWx1ZSkge1xuICAgICAgcmVzdWx0W3Jlc3VsdEZpZWxkTmFtZV0gPSB2YWx1ZTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gIH1cbn1cblxuZnVuY3Rpb24gY2hlY2tGb3JCYWRGbXBMaW5rcyhyZXN1bHQpIHtcbiAgLy8gSXQgc2VlbXMgcHJldHR5IGltcG9zc2libGUgdG8gZml4IGJhZCBpbWFnZSBsaW5rcyBzaW5jZSB3aXRoaW4gb25lIGRvY3VtZW50IHRoZXkgY2FuIGJlIG9mZiBieSB2YXJ5aW5nXG4gIC8vIG9mZnNldHMuIEknbSBndWVzc2luZyB0aGF0IGF0IHNvbWUgcG9pbnQgdGhlIEZNUCBkb2N1bWVudCBoYWQgbXVsdGlwbGUgc2NhbnMgb2YgdGhlIHNhbWUgcGFnZSBhbmQgdGhhdFxuICAvLyB0aGVzZSB3ZXJlIHRoZW4gcmVtb3ZlZCB3aGljaCB0aHJldyBhbGwgdGhlIGltYWdlIG51bWJlcnMgb2ZmLlxuICAvLyBTbyBwZXJoYXBzIHRoZSBiZXN0IHNvbHV0aW9uIGlzIHRvIG1ha2UgYSBsaXN0IG9mIGRvY3VtZW50IG51bWJlcnMgdGhhdCBoYXZlIGlzc3VlcyBhbmQgZG8gbm90IGluY2x1ZGVcbiAgLy8gRk1QIGxpbmtzIGZvciB0aG9zZS5cblxuICBjb25zdCBmbXBEb2NzV2l0aEJhZExpbmtzRnJvbUZzID0gW1wiR0JDLzE4NTEvNDMwNzc2Mi9cIl07XG5cbiAgbGV0IHVybCA9IHJlc3VsdC5leHRlcm5hbEltYWdlVXJsO1xuXG4gIGlmICghdXJsKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgaWYgKHVybC5pbmRleE9mKFwiZmluZG15cGFzdC5cIikgPT0gLTEpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyBleGFtcGxlIEZNUCBVUkxcbiAgLy8gaHR0cHM6Ly9zZWFyY2guZmluZG15cGFzdC5jby51ay9yZWNvcmQ/aWQ9R0JDLzE4NTEvNDI5NDg0Ny8wMTI4NyZwYXJlbnRpZD1HQkMvMTg1MS8wMDEyNzMyMzE3XG5cbiAgbGV0IHF1ZXJ5SW5kZXggPSB1cmwuaW5kZXhPZihcIj9cIik7XG4gIGlmIChxdWVyeUluZGV4ICE9IC0xKSB7XG4gICAgbGV0IHF1ZXJ5ID0gdXJsLnN1YnN0cmluZyhxdWVyeUluZGV4KTtcblxuICAgIGxldCBpZFN0cmluZyA9IHF1ZXJ5LnJlcGxhY2UoL1xcP2lkXFw9KFteJl0rKS4qLywgXCIkMVwiKTtcbiAgICAvL2NvbnNvbGUubG9nKFwiaWRTdHJpbmcgPSBcIiArIGlkU3RyaW5nKTtcbiAgICBpZiAoIWlkU3RyaW5nIHx8IGlkU3RyaW5nID09IHF1ZXJ5KSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgZm9yIChsZXQgYmFkRG9jIG9mIGZtcERvY3NXaXRoQmFkTGlua3NGcm9tRnMpIHtcbiAgICAgIGlmIChpZFN0cmluZy5zdGFydHNXaXRoKGJhZERvYykpIHtcbiAgICAgICAgLy8gZG8gbm90IHVzZSB0aGUgRk1QIGxpbmsgLSBpdCBpcyBiYWRcbiAgICAgICAgLy9jb25zb2xlLmxvZyhcImJhZCBsaW5rXCIpO1xuICAgICAgICByZXN1bHQuZXh0ZXJuYWxJbWFnZVVybCA9IFwiYmFkXCI7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICB9XG4gIH1cbn1cblxuZnVuY3Rpb24gaXNVcmxBVmFsaWRGdWxsT3JQYXJ0aWFsRm1wSW1hZ2VMaW5rKHVybCkge1xuICAvLyBVUkwgY2FuIGJlIHNvbWV0aGluZyBsaWtlIHRoaXM6ICAgXCJHQkMvMTg0MS8wMjc2LzAxOTImcGFyZW50aWQ9R0JDLzE4NDEvMDAwMDkzMzMxNlwiXG4gIC8vIEluIHdoaWNoIGNhc2UgaXQgcmVxdWlyZXMgc29tZSB3b3JrIHRvIG1ha2UgdGhpcyBpbnRvIGEgdmFsaWQgRk1QIHVybCBsaWtlXG4gIC8vIGh0dHBzOi8vc2VhcmNoLmZpbmRteXBhc3QuY28udWsvcmVjb3JkP2lkPUdCQyUyRjE4NDElMkYwMjc2JTJGMDE5MiZwYXJlbnRpZD1HQkMlMkYxODQxJTJGMDAwMDkzMzMxNlxuICAvLyBTb21ldGltZXMgaXQgaXMgc29tZXRoaW5nIGxpa2U6IFwiR0JDLzE4NzEvMzkwNy8wMTU2XCJcbiAgLy8gSW4gd2hpY2ggY2FzZSBpdCBuZWVkcyBhbiBleHRyYSBcImJyb3dzZVwiIGluIHRoZSBVUkw6XG4gIC8vIGh0dHBzOi8vc2VhcmNoLmZpbmRteXBhc3QuY28udWsvcmVjb3JkL2Jyb3dzZT9pZD1HQkMvMTg3MS8zOTA3LzAxNTZcbiAgLy8gU29tZXRpbWVzIGl0IGlzIG5vdCBhIHZhbGlkIEZpbmRNeVBhc3QgaW1hZ2UgcGFydGlhbCBVUkwuIEV4YW1wbGVzOlxuICAvLyBcIjQzMDA0XzE2MjAyODAwNjA1M18wMTAwLTAwNjMwLmoya1wiICAob24gYSBVUyBWaXJnaW5pYSBkZWF0aCB3aGljaCBkb2VzIGhhdmUgYSB2YWxpZCBGUyBpbWFnZSlcbiAgLy8gXCJUTkElMkZSMzklMkYxMDQxJTJGMTA0MUMlMkYwMTElMkYxNVwiICAob24gYSBVSyAxOTM5IHJlZ2lzdGVyIHJlY29yZClcblxuICBpZiAoIXVybCkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIGxldCBpc0ZpbmRNeVBhc3QgPSBmYWxzZTtcblxuICAvLyBDaGVjayBmb3Iga25vd24gZm9ybWF0cyB0aGF0IHdvdWxkIG5vdCBiZSB2YWxpZFxuICAvLyBleGFtcGxlIG5vbi1GTVAgbGluazogXCJEMzYwOC8xLzRcIlxuICBsZXQgYmFkRm9ybWF0cyA9IFtcbiAgICAvXlxcd1xcZCtcXC9cXGQrXFwvXFxkKyQvLCAvLyBlLmcuIFwiRDM2MDgvMS80XCJcbiAgICAvXlxcZCskLywgLy8gZS5nLiBcIjg0XCJcbiAgICAvXltcXHdcXGRdKyQvLCAvLyBlLmcuIFwiRDM2MDhcIlxuICAgIC9eW1xcd1xcZF0rXFwvJC8sIC8vIGUuZy4gXCJuYWkwMDE0NDIxNjUvXCJcbiAgXTtcblxuICBsZXQgaXNCYWRBcmNoaXZlSWRGb3JtYXQgPSBmYWxzZTtcbiAgZm9yIChsZXQgcmVnZXggb2YgYmFkRm9ybWF0cykge1xuICAgIGlmIChyZWdleC50ZXN0KHVybCkpIHtcbiAgICAgIGlzQmFkQXJjaGl2ZUlkRm9ybWF0ID0gdHJ1ZTtcbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgfVxuXG4gIGxldCBoYWRQYXJlbnRJZCA9IGZhbHNlO1xuXG4gIGxldCBwYXJlbnRJZEluZGV4ID0gdXJsLnRvTG93ZXJDYXNlKCkuaW5kZXhPZihcInBhcmVudGlkXCIpO1xuICBpZiAocGFyZW50SWRJbmRleCAhPSAtMSkge1xuICAgIHVybCA9IHVybC5zdWJzdHJpbmcoMCwgcGFyZW50SWRJbmRleCk7XG4gICAgaGFkUGFyZW50SWQgPSB0cnVlO1xuICB9XG5cbiAgaWYgKCFpc0JhZEFyY2hpdmVJZEZvcm1hdCkge1xuICAgIGxldCBwZXJjZW50SW5kZXggPSB1cmwuaW5kZXhPZihcIiVcIik7XG4gICAgbGV0IGRvdEluZGV4ID0gdXJsLmluZGV4T2YoXCIuXCIpO1xuICAgIGlmIChwZXJjZW50SW5kZXggPT0gLTEgJiYgZG90SW5kZXggPT0gLTEpIHtcbiAgICAgIC8vIHRoZXJlIG1heSBiZSBtb3JlIHRlc3RzIHRoYXQgd2UgY291bGQgZG8gYnV0IGZvciBub3cgc2F5IHRoaXMgaXMgdmFsaWQgRk1QXG4gICAgICBpc0ZpbmRNeVBhc3QgPSB0cnVlO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiBpc0ZpbmRNeVBhc3Q7XG59XG5cbmZ1bmN0aW9uIHByb2Nlc3NJbWFnZUxpbmtzKGRvY3VtZW50LCByZXN1bHQsIG9wdGlvbnMpIHtcbiAgbGV0IGV4dGVybmFsSW1hZ2VJZCA9IHJlc3VsdC5leHRlcm5hbEltYWdlSWQ7XG4gIGxldCBleHRJbWFnZVVybCA9IHJlc3VsdC5leHRJbWFnZVVybDtcbiAgbGV0IGV4dGVybmFsSW1hZ2VSZWZlcmVuY2UgPSByZXN1bHQuZXh0ZXJuYWxJbWFnZVJlZmVyZW5jZTtcbiAgbGV0IGV4dGVybmFsUmVjb3JkU2VxT3JpZyA9IHJlc3VsdC5leHRlcm5hbFJlY29yZFNlcU9yaWc7XG5cbiAgbGV0IGV4dGVybmFsRmlsbU51bWJlciA9IHVuZGVmaW5lZDtcbiAgaWYgKHJlc3VsdC5yZWZlcmVuY2VEYXRhKSB7XG4gICAgZXh0ZXJuYWxGaWxtTnVtYmVyID0gcmVzdWx0LnJlZmVyZW5jZURhdGEuZXh0ZXJuYWxGaWxtTnVtYmVyO1xuICB9XG5cbiAgaWYgKHJlc3VsdC5kaWdpdGFsQXJ0aWZhY3QpIHtcbiAgICBjb25zdCBhcmtTdHJpbmcgPSBcImFyazovNjE5MDMvMzoxOlwiO1xuICAgIGlmIChyZXN1bHQuZnNJbWFnZVVybCkge1xuICAgICAgLy8gd2UgaGF2ZSBib3RoLCBkZWxldGUgdGhlIGRpZ2l0YWxBcnRpZmFjdCBpZiBpdCBpcyB0aGUgc2FtZSBhcyB0aGUgZnNJbWFnZVVybFxuICAgICAgbGV0IGl1QXJrSW5kZXggPSByZXN1bHQuZnNJbWFnZVVybC5pbmRleE9mKGFya1N0cmluZyk7XG4gICAgICBsZXQgZGFBcmtJbmRleCA9IHJlc3VsdC5kaWdpdGFsQXJ0aWZhY3QuaW5kZXhPZihhcmtTdHJpbmcpO1xuICAgICAgaWYgKGl1QXJrSW5kZXggIT0gLTEgJiYgZGFBcmtJbmRleCAhPSAtMSkge1xuICAgICAgICBsZXQgaXVJZCA9IHJlc3VsdC5mc0ltYWdlVXJsLnN1YnN0cmluZyhpdUFya0luZGV4KTtcbiAgICAgICAgbGV0IGRhSWQgPSByZXN1bHQuZGlnaXRhbEFydGlmYWN0LnN1YnN0cmluZyhkYUFya0luZGV4KTtcbiAgICAgICAgbGV0IGl1VGVybUluZGV4ID0gaXVJZC5zZWFyY2goL1tcXC9cXD9cXCZdLyk7XG4gICAgICAgIGlmIChpdVRlcm1JbmRleCAhPSAtMSkge1xuICAgICAgICAgIGl1SWQgPSBpdUlkLnN1YnN0cmluZygwLCBpdVRlcm1JbmRleCk7XG4gICAgICAgIH1cbiAgICAgICAgbGV0IGRhVGVybUluZGV4ID0gZGFJZC5zZWFyY2goL1tcXC9cXD9cXCZdLyk7XG4gICAgICAgIGlmIChkYVRlcm1JbmRleCAhPSAtMSkge1xuICAgICAgICAgIGRhSWQgPSBkYUlkLnN1YnN0cmluZygwLCBkYVRlcm1JbmRleCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGl1SWQgPT0gZGFJZCkge1xuICAgICAgICAgIGRlbGV0ZSByZXN1bHQuZGlnaXRhbEFydGlmYWN0O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGxldCBkYUFya0luZGV4ID0gcmVzdWx0LmRpZ2l0YWxBcnRpZmFjdC5pbmRleE9mKGFya1N0cmluZyk7XG4gICAgICBsZXQgZGFGc0luZGV4ID0gcmVzdWx0LmRpZ2l0YWxBcnRpZmFjdC5pbmRleE9mKFwiZmFtaWx5c2VhcmNoXCIpO1xuXG4gICAgICBpZiAoZGFBcmtJbmRleCAhPSAtMSAmJiBkYUZzSW5kZXggIT0gLTEpIHtcbiAgICAgICAgcmVzdWx0LmZzSW1hZ2VVcmwgPSByZXN1bHQuZGlnaXRhbEFydGlmYWN0O1xuICAgICAgICBkZWxldGUgcmVzdWx0LmRpZ2l0YWxBcnRpZmFjdDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIGl0IGNvdWxkIGJlIGFuIEZNUCBsaW5rIGxpa2U6XG4gICAgICAgIC8vIGh0dHA6Ly9zZWFyY2guZmluZG15cGFzdC5jby51ay9yZWNvcmQ/aWQ9R0JDLzE5MTEvUkcxNC8wNjc1MS8wMDI1JnBhcmVudGlkPUdCQy8xOTExL1JHMTQvMDY3NTEvMDAyNS80XG4gICAgICAgIC8vIG9yIGFuIEFuY2VzdHJ5IGxpbmsgbGlrZTpcbiAgICAgICAgLy8gaHR0cDovL3NlYXJjaC5hbmNlc3RyeS5jb20vaWV4ZWM/aHR4PVZpZXcmcj1hbiZkYmlkPTI3MDMmaWlkPTMyODQ4X0IwOTQwNTEtMDA0NjlcblxuICAgICAgICBsZXQgZm1wSW5kZXggPSByZXN1bHQuZGlnaXRhbEFydGlmYWN0LmluZGV4T2YoXCJmaW5kbXlwYXN0XCIpO1xuICAgICAgICBsZXQgYW5jZXN0cnlJbmRleCA9IHJlc3VsdC5kaWdpdGFsQXJ0aWZhY3QuaW5kZXhPZihcIi5hbmNlc3RyeS5cIik7XG4gICAgICAgIGlmIChmbXBJbmRleCAhPSAtMSAmJiAhZXh0SW1hZ2VVcmwpIHtcbiAgICAgICAgICBleHRJbWFnZVVybCA9IHJlc3VsdC5kaWdpdGFsQXJ0aWZhY3Q7XG4gICAgICAgICAgZGVsZXRlIHJlc3VsdC5kaWdpdGFsQXJ0aWZhY3Q7XG4gICAgICAgIH0gZWxzZSBpZiAoYW5jZXN0cnlJbmRleCAhPSAtMSAmJiAhZXh0SW1hZ2VVcmwpIHtcbiAgICAgICAgICBleHRJbWFnZVVybCA9IHJlc3VsdC5kaWdpdGFsQXJ0aWZhY3Q7XG4gICAgICAgICAgZGVsZXRlIHJlc3VsdC5kaWdpdGFsQXJ0aWZhY3Q7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy8gbGVhdmUgZGlnaXRhbEFydGlmYWN0IGZvciBub3csIGl0IG1heSBiZSByZWxhdGVkIHRvIHRoZSBleHRlcm5hbEltYWdlVXJsXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBpZiAoZG9jdW1lbnQpIHtcbiAgICAvLyB1c2UgdGhlIGRvY3VtZW50IHRvIGRldGVybWluZSBpZiB0aGVyZSBpcyBhIHZhbGlkIGltYWdlIHRodW1ibmFpbFxuICAgIGxldCByZXN0cmljdGVkSW1hZ2VUaHVtYiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCJidXR0b25bY2xhc3MqPXJlc3RyaWN0ZWRJbWFnZVRodW1iQ3NzXVwiKTtcbiAgICBsZXQgaW1hZ2VUaHVtYiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCJpbWdbY2xhc3MqPS1pbWFnZVRodW1iQ3NzXVwiKTtcblxuICAgIGlmIChyZXN1bHQuZnNJbWFnZVVybCAmJiBpbWFnZVRodW1iICYmIHJlc3RyaWN0ZWRJbWFnZVRodW1iKSB7XG4gICAgICAvLyB0aGlzIGltcGxpZXMgdGhhdCB0aGVyZSBpcyBhIHZhbGlkIEZhbWlseVNlYXJjaCBpbWFnZSAtIHNvIGRvIG5vdCBzZXQgZXh0ZXJuYWxJbWFnZVVybFxuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgfVxuXG4gIGlmIChleHRJbWFnZVVybCkge1xuICAgIC8vIGlmIGl0IGlzIGFuIEZNUCBsaW5rIGFuZCBzdGFydHMgd2l0aCBodHRwIHRoZW4gY2hhbmdlIGl0IHRvIGh0dHBzXG4gICAgbGV0IHByZWZpeCA9IFwiaHR0cDovL3NlYXJjaC5maW5kbXlwYXN0LlwiO1xuICAgIGxldCBwcmVmaXhJbmRleCA9IGV4dEltYWdlVXJsLmluZGV4T2YocHJlZml4KTtcbiAgICBpZiAocHJlZml4SW5kZXggIT0gLTEpIHtcbiAgICAgIGxldCByZW1haW5kZXIgPSBleHRJbWFnZVVybC5zdWJzdHJpbmcocHJlZml4Lmxlbmd0aCk7XG4gICAgICBleHRJbWFnZVVybCA9IFwiaHR0cHM6Ly9zZWFyY2guZmluZG15cGFzdC5cIiArIHJlbWFpbmRlcjtcbiAgICB9XG5cbiAgICByZXN1bHQuZXh0ZXJuYWxJbWFnZVVybCA9IGV4dEltYWdlVXJsO1xuICB9IGVsc2UgaWYgKGV4dGVybmFsSW1hZ2VJZCB8fCBleHRlcm5hbEZpbG1OdW1iZXIpIHtcbiAgICBpZiAoZXh0ZXJuYWxJbWFnZUlkICYmIGV4dGVybmFsSW1hZ2VJZC5zdGFydHNXaXRoKFwiaHR0cFwiKSkge1xuICAgICAgcmVzdWx0LmV4dGVybmFsSW1hZ2VVcmwgPSBleHRlcm5hbEltYWdlSWQ7XG4gICAgfSBlbHNlIGlmIChleHRlcm5hbEZpbG1OdW1iZXIgJiYgZXh0ZXJuYWxGaWxtTnVtYmVyLnN0YXJ0c1dpdGgoXCJodHRwXCIpKSB7XG4gICAgICByZXN1bHQuZXh0ZXJuYWxJbWFnZVVybCA9IGV4dGVybmFsRmlsbU51bWJlcjtcbiAgICB9IGVsc2Uge1xuICAgICAgbGV0IGlzRmluZE15UGFzdCA9IGZhbHNlO1xuICAgICAgbGV0IHVybCA9IGV4dGVybmFsSW1hZ2VJZDtcblxuICAgICAgaWYgKHJlc3VsdC5jaXRhdGlvbi5pbmNsdWRlcyhcImZpbmRteXBhc3RcIikpIHtcbiAgICAgICAgaXNGaW5kTXlQYXN0ID0gdHJ1ZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmIChpc1VybEFWYWxpZEZ1bGxPclBhcnRpYWxGbXBJbWFnZUxpbmsoZXh0ZXJuYWxJbWFnZUlkKSkge1xuICAgICAgICAgIGlzRmluZE15UGFzdCA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgLy8gVGhlIGNvZGUgYmVsb3cgd2FzIHdoZW4gSSB0aG91Z2ggdGhlIGV4dGVybmFsRmlsbU51bWJlciBjb3VsZCBiZSBhIHZhbHVlIEZNUCBwYXJ0aWFsIFVSTFxuICAgICAgICAvLyBJIHdhcyBsb29raW5nIGF0IHRoaXMgRlMgcmVjb3JkOiBlbmdsYW5kX2JhcHRpc21fMTgxMF9qb2huX2FiYmVybGV5XG4gICAgICAgIC8vIEJ1dCBpdCB0dXJucyBvdXQgaW4gdGhhdCBjYXNlIGl0IGlzIGEgcGFydGlhbCBSRUNPUkQgbGlua1xuICAgICAgICAvL2Vsc2UgaWYgKGlzVXJsQVZhbGlkRnVsbE9yUGFydGlhbEZtcEltYWdlTGluayhleHRlcm5hbEZpbG1OdW1iZXIpKSB7XG4gICAgICAgIC8vICBpc0ZpbmRNeVBhc3QgPSB0cnVlO1xuICAgICAgICAvLyAgdXJsID0gZXh0ZXJuYWxGaWxtTnVtYmVyO1xuICAgICAgICAvL31cbiAgICAgIH1cblxuICAgICAgaWYgKGlzRmluZE15UGFzdCkge1xuICAgICAgICAvLyBpcyBpcyBwb3NzaWJsZSB0aGF0IGFuIGV4dGVybmFsVWlyIG9mIFwiOTcxMzA0XCIgbWVhbnMgRk1QLCBoYXZlIG5vdCBjb25maXJtZWQgeWV0XG4gICAgICAgIC8vIEp1c3QgYXNzdW1lIHRoZSBsaW5rIGlzIEZNUCBmb3Igbm93XG4gICAgICAgIGxldCBkb21haW4gPSBcImZpbmRteXBhc3QuY28udWtcIjtcbiAgICAgICAgaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5zZWFyY2hfZm1wX2RvbWFpbiAmJiBvcHRpb25zLnNlYXJjaF9mbXBfZG9tYWluICE9IFwibm9uZVwiKSB7XG4gICAgICAgICAgZG9tYWluID0gb3B0aW9ucy5zZWFyY2hfZm1wX2RvbWFpbjtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIHNvbWV0aW1lcyB0aGUgZXh0ZXJuYWxJbWFnZUlkIGFjdHVhbGwgcG9pbnRzIHRvIHRoZSByZWNvcmQgbm90IHRoZSBpbWFnZS5cbiAgICAgICAgLy8gRXhhbXBsZSBmcm9tIGVuZ2xhbmRfYmFwdGlzbV8xOTAyX2VsbGFfZ2lsZXNcbiAgICAgICAgLy8gXCJleHRlcm5hbEltYWdlSWRcIjogXCJHQlBSUy9DQU5UL0IvOTYyODgxMzFcIixcbiAgICAgICAgLy8gXCJleHRlcm5hbEltYWdlUmVmZXJlbmNlXCI6IFwiR0JQUlMvQ0FOVC8wMDUyNjU0MDMvMDA2ODRcIixcbiAgICAgICAgLy8gXCJleHRlcm5hbFJlY29yZFNlcU9yaWdcIjogXCI5NjI4ODEzMVwiLFxuICAgICAgICAvLyBJbiB0aGlzIGNhc2Ugd2Ugd2FudCB0byB1c2UgXCJHQlBSUy9DQU5ULzAwNTI2NTQwMy8wMDY4NFwiXG4gICAgICAgIGlmIChleHRlcm5hbEltYWdlUmVmZXJlbmNlICYmIGV4dGVybmFsUmVjb3JkU2VxT3JpZykge1xuICAgICAgICAgIGlmIChleHRlcm5hbEltYWdlSWQuaW5jbHVkZXMoZXh0ZXJuYWxSZWNvcmRTZXFPcmlnKSkge1xuICAgICAgICAgICAgdXJsID0gZXh0ZXJuYWxJbWFnZVJlZmVyZW5jZTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZGVsZXRlIHJlc3VsdC5leHRlcm5hbEltYWdlUmVmZXJlbmNlO1xuICAgICAgICAgIGRlbGV0ZSByZXN1bHQuZXh0ZXJuYWxSZWNvcmRTZXFPcmlnO1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IHVyaVF1ZXJ5ID0gZW5jb2RlVVJJKHVybCk7XG5cbiAgICAgICAgbGV0IHByZWZpeCA9IFwiaHR0cHM6Ly9zZWFyY2guXCIgKyBkb21haW4gKyBcIi9yZWNvcmQ/aWQ9XCI7XG5cbiAgICAgICAgLy8gaWYgdGhlcmUgaXMgbm8gcGFyZW50SWQgb24gdGhlIFVSTCB0aGVuIHRoZSBcIi9icm93c2VcIiBwYXJ0IGlzIHJlcXVpcmVkXG4gICAgICAgIGlmICghdXJpUXVlcnkudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhcInBhcmVudGlkXCIpKSB7XG4gICAgICAgICAgcHJlZml4ID0gXCJodHRwczovL3NlYXJjaC5cIiArIGRvbWFpbiArIFwiL3JlY29yZC9icm93c2U/aWQ9XCI7XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgdXJpID0gcHJlZml4ICsgdXJpUXVlcnk7XG4gICAgICAgIHJlc3VsdC5leHRlcm5hbEltYWdlVXJsID0gdXJpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGNoZWNrRm9yQmFkRm1wTGlua3MocmVzdWx0KTtcbiAgfVxuXG4gIGlmIChyZXN1bHQuZGlnaXRhbEFydGlmYWN0KSB7XG4gICAgaWYgKHJlc3VsdC5kaWdpdGFsQXJ0aWZhY3QgPT0gcmVzdWx0LmV4dGVybmFsSW1hZ2VVcmwpIHtcbiAgICAgIGRlbGV0ZSByZXN1bHQuZGlnaXRhbEFydGlmYWN0O1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBJbiB0aGUgY2FzZXMgSSBoYXZlIHNlZW4gdGhhdCBnZXQgaGVyZSBkaWdpdGFsQXJ0aWZhY3QgaXMgYSB2YXJpYXRpb24gb2YgYSBmaW5kbXlwYXN0IGxpbmtcbiAgICAgIC8vIFNvbWV0aW1lcyBpdCBpcyBhIGJldHRlciBsaW5rIC0gaS5lLiBleHRlcm5hbEltYWdlVXJsIGRvZXNuJ3QgcmVzb2x2ZSBidXQgZGlnaXRhbEFydGlmYWN0IGRvZXMuXG4gICAgICAvLyBCdXQgd2UgZG9uJ3QgaGF2ZSBhIHdheSB0byB0ZXN0IHRoYXQuIEZvciBub3cgcm1vdmUgaXQgaWYgaXQgY29udGFpbnMgZmluZG15cGFzdFxuICAgICAgaWYgKHJlc3VsdC5kaWdpdGFsQXJ0aWZhY3QuaW5kZXhPZihcImZpbmRteXBhc3RcIikgIT0gLTEpIHtcbiAgICAgICAgZGVsZXRlIHJlc3VsdC5kaWdpdGFsQXJ0aWZhY3Q7XG4gICAgICB9XG4gICAgfVxuICB9XG59XG5cbmZ1bmN0aW9uIGFkZFJlY29yZERhdGFGb3JGYWN0KHJlc3VsdCwgZmFjdCwgZmFjdFR5cGUpIHtcbiAgbGV0IGZhY3RUeXBlV2l0aFNwYWNlcyA9IGZhY3RUeXBlLnJlcGxhY2UoLyhbYS16XSkoW0EtWl0pL2csIFwiJDEgJDJcIik7XG4gIGlmIChmYWN0LmRhdGUpIHtcbiAgICBpZiAoZmFjdC5kYXRlLm9yaWdpbmFsKSB7XG4gICAgICBsZXQgbGFiZWwgPSBmYWN0VHlwZVdpdGhTcGFjZXMgKyBcIiBEYXRlXCI7XG4gICAgICBsZXQgdmFsdWUgPSBmYWN0LmRhdGUub3JpZ2luYWw7XG4gICAgICByZXN1bHQucmVjb3JkRGF0YVtsYWJlbF0gPSB2YWx1ZTtcbiAgICB9XG4gIH1cbiAgaWYgKGZhY3QucGxhY2UpIHtcbiAgICBjb25zdCBwbGFjZUxhYmVsSWRzVG9PdmVycmlkZUZvckZhY3RzID0ge1xuICAgICAgRGVhdGg6IFt7IGxhYmVsOiBcIkxBU1RfUkVTSURFTkNFXCIsIG92ZXJyaWRlS2V5OiBcIkxhc3QgUmVzaWRlbmNlXCIgfV0sXG4gICAgfTtcblxuICAgIGxldCBsYWJlbElkc1RvT3ZlcnJpZGUgPSBwbGFjZUxhYmVsSWRzVG9PdmVycmlkZUZvckZhY3RzW2ZhY3RUeXBlXTtcbiAgICBsZXQgb3ZlcnJpZGVLZXkgPSBcIlwiO1xuICAgIGlmIChsYWJlbElkc1RvT3ZlcnJpZGUpIHtcbiAgICAgIGxldCBmaWVsZExhYmVsSWQgPSBcIlwiO1xuICAgICAgaWYgKGZhY3QucGxhY2UuZmllbGRzICYmIGZhY3QucGxhY2UuZmllbGRzLmxlbmd0aCA9PSAxKSB7XG4gICAgICAgIGxldCB2YWx1ZXMgPSBmYWN0LnBsYWNlLmZpZWxkc1swXS52YWx1ZXM7XG4gICAgICAgIGlmICh2YWx1ZXMgJiYgdmFsdWVzLmxlbmd0aCA9PSAxKSB7XG4gICAgICAgICAgZmllbGRMYWJlbElkID0gdmFsdWVzWzBdLmxhYmVsSWQ7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmIChmaWVsZExhYmVsSWQpIHtcbiAgICAgICAgZm9yIChsZXQgbGFiZWxUb092ZXJyaWRlIG9mIGxhYmVsSWRzVG9PdmVycmlkZSkge1xuICAgICAgICAgIGlmIChsYWJlbFRvT3ZlcnJpZGUubGFiZWwgPT0gZmllbGRMYWJlbElkKSB7XG4gICAgICAgICAgICBvdmVycmlkZUtleSA9IGxhYmVsVG9PdmVycmlkZS5vdmVycmlkZUtleTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChmYWN0LnBsYWNlLm9yaWdpbmFsKSB7XG4gICAgICBsZXQgbGFiZWwgPSBmYWN0VHlwZVdpdGhTcGFjZXMgKyBcIiBQbGFjZVwiO1xuICAgICAgaWYgKG92ZXJyaWRlS2V5KSB7XG4gICAgICAgIGxhYmVsID0gb3ZlcnJpZGVLZXk7XG4gICAgICB9XG4gICAgICBsZXQgdmFsdWUgPSBmYWN0LnBsYWNlLm9yaWdpbmFsO1xuICAgICAgcmVzdWx0LnJlY29yZERhdGFbbGFiZWxdID0gdmFsdWU7XG4gICAgfVxuICB9XG4gIGlmIChmYWN0LnZhbHVlKSB7XG4gICAgbGV0IGxhYmVsID0gZmFjdFR5cGVXaXRoU3BhY2VzO1xuICAgIGxldCB2YWx1ZSA9IGZhY3QudmFsdWU7XG4gICAgcmVzdWx0LnJlY29yZERhdGFbbGFiZWxdID0gdmFsdWU7XG4gIH1cbn1cblxuLy8gSWRlbnRpZnlpbmcgYSBmaWVsZDpcbi8vICBmaWVsZEZzVHlwZSwgZmllbGRHY1R5cGVcbi8vICBmaWVsZEZzVHlwZVByZWZpeCwgZmllbGRHY1R5cGVQcmVmaXhcbi8vICBzb3VyY2VTZWN0aW9uIC0gdGhlIHNlY3Rpb24gY29udGFpbmluZyBmaWVsZHMgKFwidG9wTGV2ZWxcIiwgXCJwcmltYXJ5UGVyc29uXCIsIFwicHJpbWFyeUZhY3RcIiwgXCJvdGhlckZhY3RcIiwgXCJyZWxhdGlvbnNoaXBcIilcbi8vIFNlbGVjdGluZyBhIHZhbHVlIGluIHRoZSBmaWVsZCAoaWYgbm9uZSBzcGVjaWZpZWQgZmlyc3QgaXMgdXNlZClcbi8vICB2YWx1ZVR5cGUgLSB0aGlzIGlzIGEgcHJlZmVyZW5jZSBpZiB0aGVyZSBhcmUgbXVsdGlwbGVcbi8vICBsYWJlbElkXG4vLyAgbGFiZWxJZFByZWZpeFxuLy8gU3BlY2lmeWluZyB3aGVyZSB0byBwdXQgdmFsdWU6XG4vLyAgcmVjb3JkRGF0YUZpZWxkXG4vLyAgZGF0YUZpZWxkXG4vLyAgcmVmZXJlbmNlRGF0YUZpZWxkXG4vLyBpZiBub25lIG9mIHRoZSBhYm92ZSBleGlzdCB0aGVuIHRoZSBmaWVsZCBpcyBpZ25vcmVkXG4vLyBBcyBzb29uIGEgYSBtYXRjaCBpcyBmb3VuZCBsYXRlciBlbnRyaWVzIGluIGZpZWxkRGF0YSBhcmUgaWdub3JlZD9cblxuY29uc3QgZmllbGREYXRhID0gW1xuICAvLyBkYXRhIGFuZCByZWNvcmQgZGF0YSBmaWVsZHNcbiAge1xuICAgIGZpZWxkRnNUeXBlOiBcIkV2ZW50UmVnUXRyXCIsXG4gICAgZGF0YUZpZWxkOiBcInJlZ2lzdHJhdGlvblF1YXJ0ZXJcIixcbiAgICByZWNvcmREYXRhRmllbGQ6IFwiUmVnaXN0cmF0aW9uIFF1YXJ0ZXJcIixcbiAgfSxcbiAge1xuICAgIGZpZWxkRnNUeXBlOiBcIkV2ZW50UmVnRGF0ZVwiLFxuICAgIGRhdGFGaWVsZDogXCJyZWdpc3RyYXRpb25EYXRlXCIsXG4gICAgcmVjb3JkRGF0YUZpZWxkOiBcIlJlZ2lzdHJhdGlvbiBEYXRlXCIsXG4gIH0sXG4gIHtcbiAgICBmaWVsZEdjVHlwZTogXCJBZ2VcIixcbiAgICBzb3VyY2VTZWN0aW9uOiBcInByaW1hcnlQZXJzb25cIixcbiAgICB2YWx1ZVR5cGU6IFwiSW50ZXJwcmV0ZWRcIixcbiAgICBkYXRhRmllbGQ6IFwiYWdlXCIsXG4gICAgcmVjb3JkRGF0YUZpZWxkOiBcIkFnZVwiLFxuICB9LFxuXG4gIC8vICBkYXRhIGZpZWxkc1xuICB7IGZpZWxkRnNUeXBlOiBcIkV4dGVybmFsSW1hZ2VJZFwiLCBkYXRhRmllbGQ6IFwiZXh0ZXJuYWxJbWFnZUlkXCIgfSxcbiAgeyBmaWVsZEZzVHlwZTogXCJFeHRJbWFnZVJlZmVyZW5jZVwiLCBkYXRhRmllbGQ6IFwiZXh0ZXJuYWxJbWFnZVJlZmVyZW5jZVwiIH0sXG4gIHsgZmllbGRGc1R5cGU6IFwiRXh0UmVjb3JkU2VxT3JpZ1wiLCBkYXRhRmllbGQ6IFwiZXh0ZXJuYWxSZWNvcmRTZXFPcmlnXCIgfSxcbiAgeyBmaWVsZEZzVHlwZTogXCJFeHRJbWFnZVVybFwiLCBkYXRhRmllbGQ6IFwiZXh0SW1hZ2VVcmxcIiB9LFxuICB7IGZpZWxkRnNUeXBlOiBcIkV4dFJlY29yZElkXCIsIGRhdGFGaWVsZDogXCJleHRlcm5hbFJlY29yZElkXCIgfSxcbiAgeyBmaWVsZEZzVHlwZTogXCJFeHRSZWNvcmRUeXBlXCIsIGRhdGFGaWVsZDogXCJleHRlcm5hbFJlY29yZFR5cGVcIiB9LFxuICB7IGZpZWxkRnNUeXBlOiBcIkV4dFVpclwiLCBkYXRhRmllbGQ6IFwiZXh0ZXJuYWxVaXJcIiB9LFxuXG4gIHsgZmllbGRGc1R5cGU6IFwiSW1hZ2VBcmtcIiwgZGF0YUZpZWxkOiBcImZzSW1hZ2VVcmxcIiB9LFxuICB7IGZpZWxkRnNUeXBlOiBcIkltYWdlTnVtYmVyXCIsIGRhdGFGaWVsZDogXCJmc0ltYWdlTnVtYmVyXCIgfSxcbiAgeyBmaWVsZEZzVHlwZTogXCJDb2xsZWN0aW9uSWRcIiwgZGF0YUZpZWxkOiBcImZzQ29sbGVjdGlvbklkXCIgfSxcblxuICAvLyByZWNvcmQgZGF0YSBmaWVsZHNcbiAge1xuICAgIGZpZWxkRnNUeXBlOiBcIk1pbEJlZ2luUmFua1wiLFxuICAgIHZhbHVlVHlwZTogXCJJbnRlcnByZXRlZFwiLFxuICAgIHJlY29yZERhdGFGaWVsZDogXCJNaWl0YXJ5IEJlZ2lubmluZyBSYW5rXCIsXG4gIH0sXG4gIHtcbiAgICBmaWVsZEZzVHlwZTogXCJNaWxFbmRSYW5rXCIsXG4gICAgdmFsdWVUeXBlOiBcIkludGVycHJldGVkXCIsXG4gICAgcmVjb3JkRGF0YUZpZWxkOiBcIk1paXRhcnkgRmluYWwgUmFua1wiLFxuICB9LFxuICB7XG4gICAgZmllbGRGc1R5cGU6IFwiTWlsU2lkZVwiLFxuICAgIHZhbHVlVHlwZTogXCJJbnRlcnByZXRlZFwiLFxuICAgIHJlY29yZERhdGFGaWVsZDogXCJNaWl0YXJ5IFNpZGVcIixcbiAgfSxcbiAge1xuICAgIGZpZWxkRnNUeXBlOiBcIk1pbFVuaXRcIixcbiAgICB2YWx1ZVR5cGU6IFwiSW50ZXJwcmV0ZWRcIixcbiAgICByZWNvcmREYXRhRmllbGQ6IFwiTWlpdGFyeSBVbml0XCIsXG4gIH0sXG4gIHtcbiAgICBmaWVsZEZzVHlwZTogXCJNaWxDb21wYW55XCIsXG4gICAgdmFsdWVUeXBlOiBcIkludGVycHJldGVkXCIsXG4gICAgcmVjb3JkRGF0YUZpZWxkOiBcIk1pbGl0YXJ5IENvbXBhbnlcIixcbiAgfSxcbiAgLy8gcmVmZXJlbmNlIGZpZWxkc1xuICB7XG4gICAgZmllbGRGc1R5cGU6IFwiU291cmNlU2NoZWR1bGVUeXBlXCIsXG4gICAgcmVmZXJlbmNlRGF0YUZpZWxkOiBcInNvdXJjZVNjaGVkdWxlVHlwZVwiLFxuICB9LFxuICB7IGZpZWxkRnNUeXBlOiBcIlNvdXJjZVBpZWNlRm9saW9cIiwgcmVmZXJlbmNlRGF0YUZpZWxkOiBcInNvdXJjZVBpZWNlRm9saW9cIiB9LFxuICB7IGZpZWxkRnNUeXBlOiBcIlNvdXJjZVZvbHVtZVwiLCByZWZlcmVuY2VEYXRhRmllbGQ6IFwic291cmNlVm9sdW1lXCIgfSxcbiAgeyBmaWVsZEZzVHlwZTogXCJTb3VyY2VQYWdlXCIsIHJlZmVyZW5jZURhdGFGaWVsZDogXCJzb3VyY2VQYWdlTmJyXCIgfSxcbiAgeyBmaWVsZEZzVHlwZTogXCJTb3VyY2VQYWdlTmJyXCIsIHJlZmVyZW5jZURhdGFGaWVsZDogXCJzb3VyY2VQYWdlTmJyXCIgfSxcbiAgeyBmaWVsZEZzVHlwZTogXCJTb3VyY2VMaW5lTmJyXCIsIHJlZmVyZW5jZURhdGFGaWVsZDogXCJzb3VyY2VMaW5lTmJyXCIgfSxcbiAgeyBmaWVsZEZzVHlwZTogXCJTb3VyY2VFbnRyeU5iclwiLCByZWZlcmVuY2VEYXRhRmllbGQ6IFwic291cmNlRW50cnlOYnJcIiB9LFxuICB7IGZpZWxkRnNUeXBlOiBcIlNvdXJjZVJlZ05iclwiLCByZWZlcmVuY2VEYXRhRmllbGQ6IFwic291cmNlUmVnTmJyXCIgfSxcbiAgeyBmaWVsZEZzVHlwZTogXCJMaW5lTmJyXCIsIHJlZmVyZW5jZURhdGFGaWVsZDogXCJsaW5lTnVtYmVyXCIgfSxcbiAgeyBmaWVsZEZzVHlwZTogXCJSZWZJZFwiLCByZWZlcmVuY2VEYXRhRmllbGQ6IFwicmVmZXJlbmNlSWRcIiB9LFxuICB7IGZpZWxkRnNUeXBlOiBcIlJlY05iclwiLCByZWZlcmVuY2VEYXRhRmllbGQ6IFwicmVjb3JkTnVtYmVyXCIgfSxcbiAgeyBmaWVsZEZzVHlwZTogXCJSZWNOdW1iZXJcIiwgcmVmZXJlbmNlRGF0YUZpZWxkOiBcInJlY29yZE51bWJlclwiIH0sXG4gIHsgZmllbGRGc1R5cGU6IFwiUmVjb3JkTnVtYmVyXCIsIHJlZmVyZW5jZURhdGFGaWVsZDogXCJyZWNvcmROdW1iZXJcIiB9LFxuICB7IGZpZWxkRnNUeXBlOiBcIkZpbGVOdW1iZXJcIiwgcmVmZXJlbmNlRGF0YUZpZWxkOiBcImZpbGVOdW1iZXJcIiB9LFxuXG4gIHsgZmllbGRGc1R5cGU6IFwiRGlnaXRhbEZpbG1OdW1iZXJcIiwgcmVmZXJlbmNlRGF0YUZpZWxkOiBcImRpZ2l0YWxGaWxtTnVtYmVyXCIgfSxcbiAgeyBmaWVsZEZzVHlwZTogXCJGaWxtTnVtYmVyXCIsIHJlZmVyZW5jZURhdGFGaWVsZDogXCJmaWxtTnVtYmVyXCIgfSxcbiAgeyBmaWVsZEZzVHlwZTogXCJJbWFnZU5iclwiLCByZWZlcmVuY2VEYXRhRmllbGQ6IFwiaW1hZ2VOdW1iZXJcIiB9LFxuXG4gIHsgZmllbGRGc1R5cGU6IFwiUGFja2V0THRyXCIsIHJlZmVyZW5jZURhdGFGaWVsZDogXCJwYWNrZXRMZXR0ZXJcIiB9LFxuICB7IGZpZWxkRnNUeXBlOiBcIlBhY2tldExldHRlclwiLCByZWZlcmVuY2VEYXRhRmllbGQ6IFwicGFja2V0TGV0dGVyXCIgfSxcbiAgeyBmaWVsZEZzVHlwZTogXCJTaGVldE51bWJlckxldHRlclwiLCByZWZlcmVuY2VEYXRhRmllbGQ6IFwic2hlZXROdW1iZXJMZXR0ZXJcIiB9LFxuICB7IGZpZWxkRnNUeXBlOiBcIlNoZWV0TnVtYmVyXCIsIHJlZmVyZW5jZURhdGFGaWVsZDogXCJzaGVldE51bWJlclwiIH0sXG4gIHsgZmllbGRGc1R5cGU6IFwiU2hlZXRMdHJcIiwgcmVmZXJlbmNlRGF0YUZpZWxkOiBcInNoZWV0TGV0dGVyXCIgfSxcbiAgeyBmaWVsZEZzVHlwZTogXCJTb3VyY2VTaGVldE5ickx0clwiLCByZWZlcmVuY2VEYXRhRmllbGQ6IFwic2hlZXROdW1iZXJMZXR0ZXJcIiB9LFxuICB7IGZpZWxkRnNUeXBlOiBcIlNvdXJjZVNoZWV0TmJyXCIsIHJlZmVyZW5jZURhdGFGaWVsZDogXCJzaGVldE51bWJlclwiIH0sXG4gIHsgZmllbGRGc1R5cGU6IFwiU291cmNlU2hlZXRMdHJcIiwgcmVmZXJlbmNlRGF0YUZpZWxkOiBcInNoZWV0TGV0dGVyXCIgfSxcblxuICB7IGZpZWxkRnNUeXBlOiBcIkV4dEZpbG1OYnJcIiwgcmVmZXJlbmNlRGF0YUZpZWxkOiBcImV4dGVybmFsRmlsbU51bWJlclwiIH0sXG4gIHsgZmllbGRGc1R5cGU6IFwiRXh0UHViTmJyXCIsIHJlZmVyZW5jZURhdGFGaWVsZDogXCJleHRlcm5hbFB1YmxpY2F0aW9uTnVtYmVyXCIgfSxcbiAge1xuICAgIGZpZWxkRnNUeXBlOiBcIkV4dFB1YlRpdGxlXCIsXG4gICAgcmVmZXJlbmNlRGF0YUZpZWxkOiBcImV4dGVybmFsUHVibGljYXRpb25UaXRsZVwiLFxuICB9LFxuICB7IGZpZWxkRnNUeXBlOiBcIkV4dExpbmVOYnJcIiwgcmVmZXJlbmNlRGF0YUZpZWxkOiBcImV4dGVybmFsTGluZU51bWJlclwiIH0sXG5cbiAgLy8gZmllbGRzIHRvIGlnbm9yZVxuICB7IGZpZWxkRnNUeXBlOiBcIlVuaXF1ZUlkXCIgfSxcbiAgeyBmaWVsZEZzVHlwZTogXCJVbmlxdWVJZGVudGlmaWVyXCIgfSxcblxuICB7IGZpZWxkRnNUeXBlOiBcIkV2ZW50UGxhY2VMZXZlbDFUeXBlXCIgfSxcbiAgeyBmaWVsZEZzVHlwZTogXCJFdmVudFBsYWNlTGV2ZWwyVHlwZVwiIH0sXG4gIHsgZmllbGRGc1R5cGU6IFwiRXZlbnRQbGFjZUxldmVsM1R5cGVcIiB9LFxuICB7IGZpZWxkRnNUeXBlOiBcIkV2ZW50UGxhY2VMZXZlbDRUeXBlXCIgfSxcbiAgeyBmaWVsZEZzVHlwZTogXCJFdmVudFBsYWNlTGV2ZWw1VHlwZVwiIH0sXG4gIHsgZmllbGRGc1R5cGU6IFwiRXZlbnRQbGFjZUxldmVsVHlwZVwiIH0sXG5cbiAgeyBmaWVsZEZzVHlwZTogXCJFdmVudFBsYWNlTG93ZXN0TGV2ZWxcIiB9LFxuICB7IGZpZWxkRnNUeXBlOiBcIkV2ZW50Q291bnRyeVwiLCBkYXRhRmllbGQ6IFwiZXZlbnRDb3VudHJ5XCIgfSxcbiAgeyBmaWVsZEZzVHlwZTogXCJFdmVudENvdW50eVwiLCBkYXRhRmllbGQ6IFwiZXZlbnRDb3VudHlcIiB9LFxuICB7IGZpZWxkRnNUeXBlOiBcIkV2ZW50U3RhdGVcIiwgZGF0YUZpZWxkOiBcImV2ZW50U3RhdGVcIiB9LFxuICB7IGZpZWxkRnNUeXBlOiBcIkV2ZW50RGlzdHJpY3RcIiwgZGF0YUZpZWxkOiBcImV2ZW50RGlzdHJpY3RcIiB9LFxuICB7IGZpZWxkRnNUeXBlOiBcIkV2ZW50Q2l0eVwiLCBkYXRhRmllbGQ6IFwiZXZlbnRDaXR5XCIgfSxcbiAgeyBmaWVsZEZzVHlwZTogXCJNaW5vckNpdmlsRGl2aXNpb25cIiB9LFxuXG4gIHsgZmllbGRGc1R5cGU6IFwiRXZxdWFydGVyXCIgfSxcblxuICB7IGZpZWxkRnNUeXBlOiBcIkV4dENvdW50eUNvZGVcIiB9LFxuICB7IGZpZWxkRnNUeXBlOiBcIkNvdW50eUNvZGVcIiB9LFxuICB7IGZpZWxkRnNUeXBlOiBcIkNvdW50eUlkXCIgfSxcbiAgeyBmaWVsZEZzVHlwZTogXCJGb2xpb05vXCIgfSxcbiAgeyBmaWVsZEZzVHlwZTogXCJEaWdpdGFsRmlsbU51bWJlclwiIH0sXG4gIHsgZmllbGRGc1R5cGU6IFwiRmlsbU51bWJlclwiIH0sXG4gIHsgZmllbGRGc1R5cGU6IFwiSW1hZ2VBcGlkXCIgfSxcbiAgeyBmaWVsZEZzVHlwZTogXCJJbWFnZUlkXCIgfSxcbiAgeyBmaWVsZEZzVHlwZTogXCJQcHFJZFwiIH0sXG4gIHsgZmllbGRGc1R5cGU6IFwiUmVjb3JkR3JvdXBcIiB9LFxuICB7IGZpZWxkRnNUeXBlOiBcIlNvcnRLZXlcIiB9LFxuICB7IGZpZWxkRnNUeXBlOiBcIkhvdXNlaG9sZElkXCIgfSxcbiAgeyBmaWVsZEZzVHlwZTogXCJSZWxhdGlvbnNoaXBUb0hlYWRDb2RlXCIgfSxcbiAgeyBmaWVsZEZzVHlwZTogXCJTb3VyY2VIb3VzZWhvbGRJZFwiIH0sXG5cbiAgeyBmaWVsZEZzVHlwZTogXCJFeHREYXRhXCIgfSxcbiAgeyBmaWVsZEZzVHlwZTogXCJFeHRMaW5lTmJyU3VmXCIgfSxcbiAgeyBmaWVsZEZzVHlwZTogXCJFeHRPY2N1cGF0aW9uQ29kZVwiIH0sXG4gIHsgZmllbGRGc1R5cGU6IFwiRXh0UHJCaXJQbGFjZUNvZGVcIiB9LFxuICB7IGZpZWxkRnNUeXBlOiBcIkV4dFVhcm5cIiB9LFxuICB7IGZpZWxkRnNUeXBlOiBcIkV4dFVyblwiIH0sXG4gIHsgZmllbGRGc1R5cGU6IFwiRXh0VXJwcm5cIiB9LFxuXG4gIHsgZmllbGRGc1R5cGU6IFwiRXh0QWRkaXRpb25hbEVudHJ5RmxhZ1wiIH0sXG4gIHsgZmllbGRGc1R5cGU6IFwiRXh0TGluZU5iclwiIH0sXG4gIHsgZmllbGRGc1R5cGU6IFwiRXh0UGFnZUNvZGVcIiB9LFxuICB7IGZpZWxkRnNUeXBlOiBcIkV4dFJlZk5iclwiIH0sXG4gIHsgZmllbGRGc1R5cGU6IFwiQWRkaXRpb25hbFJlbGF0aXZlc0ZsYWdcIiB9LFxuICB7IGZpZWxkRnNUeXBlOiBcIlRyYXZlbGVyVGl0bGVcIiB9LFxuICB7IGZpZWxkRnNUeXBlOiBcIlRyYXZlbGVyTmFtZVwiIH0sXG5cbiAgeyBmaWVsZEZzVHlwZTogXCJOYW1lc1wiIH0sIC8vIHVzZWQgZm9yIFwiT1RIRVJfTkFNRVNcIiBsYWJlbCB0ZXh0XG5cbiAgeyBmaWVsZEZzVHlwZTogXCJTb3VyY2VEb2N1bWVudFR5cGVcIiB9LFxuICB7IGZpZWxkRnNUeXBlOiBcIlNvdXJjZVBhZ2VUeXBlXCIgfSxcbiAgeyBmaWVsZEZzVHlwZTogXCJTb3VyY2VQaWVjZU5iclwiIH0sXG4gIHsgZmllbGRGc1R5cGU6IFwiU291cmNlUmVjb3JkVHlwZVwiIH0sXG4gIHsgZmllbGRGc1R5cGU6IFwiU291cmNlU2NoZWR1bGVUeXBlXCIgfSxcbiAgeyBmaWVsZEZzVHlwZTogXCJTb3VyY2VDb21wb3NpdGVcIiB9LFxuICB7IGZpZWxkRnNUeXBlOiBcIlNvdXJjZUJvb2tOYnJcIiB9LFxuICB7IGZpZWxkRnNUeXBlOiBcIlNvdXJjZVBvc3RhbENvZGVcIiB9LFxuICB7IGZpZWxkRnNUeXBlOiBcIlN5c3RlbU9mT3JpZ2luXCIgfSxcblxuICB7IGZpZWxkRnNUeXBlOiBcIlJlY29yZFZlcnNpb25cIiB9LFxuICB7IGZpZWxkRnNUeXBlOiBcIlVzZXJNb2RpZmllZFwiIH0sXG4gIHsgZmllbGRGc1R5cGU6IFwiQ2RzQmF0Y2hJZFwiIH0sXG4gIHsgZmllbGRGc1R5cGU6IFwiUHVibGljYXRpb25TdGF0dXNcIiB9LFxuICB7IGZpZWxkRnNUeXBlOiBcIlB1Ymxpc2hhYmxlVW5pdFwiIH0sXG5cbiAgeyBmaWVsZEZzVHlwZTogXCJVZGVCYXRjaE51bWJlclwiIH0sXG4gIHsgZmllbGRGc1R5cGU6IFwiQmF0Y2hJZFwiIH0sXG4gIHsgZmllbGRGc1R5cGU6IFwiQmF0Y2hMb2NhbGl0eVwiIH0sXG4gIHsgZmllbGRGc1R5cGU6IFwiRm9sZGVyXCIgfSxcbiAgeyBmaWVsZEZzVHlwZTogXCJGb2xkZXJJbWFnZVNlcXVlbmNlXCIgfSxcbiAgeyBmaWVsZEZzVHlwZTogXCJGb2xkZXJJbWFnZVNlcVwiIH0sXG5cbiAgeyBmaWVsZEZzVHlwZTogXCJEYXNWZXJpZnlcIiB9LCAvLyBhIGRhdGVcbiAgeyBmaWVsZEZzVHlwZTogXCJFYXN5SW1hZ2VJZFwiIH0sXG4gIHsgZmllbGRGc1R5cGU6IFwiUmVjb3JkSWRcIiB9LFxuICB7IGZpZWxkRnNUeXBlOiBcIlByb2plY3RJZFwiIH0sXG4gIHsgZmllbGRGc1R5cGU6IFwiQ3RsRmlsZUlkXCIgfSxcbiAgeyBmaWVsZEZzVHlwZTogXCJJbXNJbWFnZUlkXCIgfSxcbiAgeyBmaWVsZEZzVHlwZTogXCJMYW5ndWFnZVwiIH0sXG4gIHsgZmllbGRGc1R5cGU6IFwiVmVyaWZ5T3JQcm9vZkNvZGVcIiB9LFxuICB7IGZpZWxkRnNUeXBlOiBcIlZlcmlmeU9yUHJvb2ZDb2RlXCIgfSxcblxuICB7IGZpZWxkRnNUeXBlUmVnRXg6IC9eUHJbQS1aXS8gfSxcbiAgeyBmaWVsZEZzVHlwZVJlZ0V4OiAvXkVkW0EtWl0vIH0sXG4gIHsgZmllbGRGc1R5cGVSZWdFeDogL0NzcyQvIH0sIC8vIGZpZWxkcyB3aXRoIHR5cGUgZW5kaW5nIFwiQ3NzXCIgY2FuIGJlIGlnbm9yZWRcblxuICB7IGZpZWxkRnNUeXBlUHJlZml4OiBcIk90aGVyT25QYWdlTmFtZUduXCIgfSxcbiAgeyBmaWVsZEZzVHlwZVByZWZpeDogXCJPdGhlck9uUGFnZU5hbWVTdXJuXCIgfSxcbiAgeyBmaWVsZEZzVHlwZVByZWZpeDogXCJPdGhlck9uUGFnZVVybFwiIH0sXG5cbiAgeyBmaWVsZEZzVHlwZVByZWZpeDogXCJFeHRcIiB9LFxuICB7IGZpZWxkRnNUeXBlUHJlZml4OiBcIkZzXCIgfSxcbiAgeyBmaWVsZEZzVHlwZVByZWZpeDogXCJJZHhcIiB9LFxuICB7IGZpZWxkRnNUeXBlUHJlZml4OiBcIk5hcmFcIiB9LFxuXG4gIC8vIGNhdGNoQWxsXG4gIHtcbiAgICByZWNvcmREYXRhRmllbGRVc2VGc1R5cGU6IHRydWUsXG4gICAgcmVjb3JkRGF0YUZpZWxkVXNlR2NUeXBlOiB0cnVlLFxuICAgIHZhbHVlVHlwZTogXCJJbnRlcnByZXRlZFwiLFxuICB9LFxuXTtcblxuZnVuY3Rpb24gZG9lc0ZpZWxkRGF0YU1hdGNoKGVudHJ5LCByZXN1bHQsIGZpZWxkLCBzb3VyY2VTZWN0aW9uKSB7XG4gIGlmIChlbnRyeS5zb3VyY2VTZWN0aW9uKSB7XG4gICAgaWYgKGVudHJ5LnNvdXJjZVNlY3Rpb24gIT0gc291cmNlU2VjdGlvbikge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIGlmIChlbnRyeS5maWVsZEZzVHlwZSkge1xuICAgIGxldCBtYXRjaCA9IGZhbHNlO1xuICAgIGNvbnN0IGZzVHlwZVByZWZpeCA9IFwiaHR0cDovL2ZhbWlseXNlYXJjaC5vcmcvdHlwZXMvZmllbGRzL1wiO1xuICAgIGlmIChmaWVsZC50eXBlICYmIGZpZWxkLnR5cGUuc3RhcnRzV2l0aChmc1R5cGVQcmVmaXgpKSB7XG4gICAgICBsZXQgZmllbGRGc1R5cGUgPSBmaWVsZC50eXBlLnN1YnN0cmluZyhmc1R5cGVQcmVmaXgubGVuZ3RoKTtcbiAgICAgIGlmIChmaWVsZEZzVHlwZSA9PSBlbnRyeS5maWVsZEZzVHlwZSkge1xuICAgICAgICBtYXRjaCA9IHRydWU7XG4gICAgICB9XG4gICAgfVxuICAgIGlmICghbWF0Y2gpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH1cblxuICBpZiAoZW50cnkuZmllbGRGc1R5cGVQcmVmaXgpIHtcbiAgICBsZXQgbWF0Y2ggPSBmYWxzZTtcbiAgICBjb25zdCBmc1R5cGVQcmVmaXggPSBcImh0dHA6Ly9mYW1pbHlzZWFyY2gub3JnL3R5cGVzL2ZpZWxkcy9cIjtcbiAgICBpZiAoZmllbGQudHlwZSAmJiBmaWVsZC50eXBlLnN0YXJ0c1dpdGgoZnNUeXBlUHJlZml4KSkge1xuICAgICAgbGV0IGZpZWxkRnNUeXBlID0gZmllbGQudHlwZS5zdWJzdHJpbmcoZnNUeXBlUHJlZml4Lmxlbmd0aCk7XG4gICAgICBpZiAoZmllbGRGc1R5cGUuc3RhcnRzV2l0aChlbnRyeS5maWVsZEZzVHlwZVByZWZpeCkpIHtcbiAgICAgICAgbWF0Y2ggPSB0cnVlO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAoIW1hdGNoKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG5cbiAgaWYgKGVudHJ5LmZpZWxkRnNUeXBlUmVnRXgpIHtcbiAgICBsZXQgbWF0Y2ggPSBmYWxzZTtcbiAgICBjb25zdCBmc1R5cGVQcmVmaXggPSBcImh0dHA6Ly9mYW1pbHlzZWFyY2gub3JnL3R5cGVzL2ZpZWxkcy9cIjtcbiAgICBpZiAoZmllbGQudHlwZSAmJiBmaWVsZC50eXBlLnN0YXJ0c1dpdGgoZnNUeXBlUHJlZml4KSkge1xuICAgICAgbGV0IGZpZWxkRnNUeXBlID0gZmllbGQudHlwZS5zdWJzdHJpbmcoZnNUeXBlUHJlZml4Lmxlbmd0aCk7XG4gICAgICBpZiAoZW50cnkuZmllbGRGc1R5cGVSZWdFeC50ZXN0KGZpZWxkRnNUeXBlKSkge1xuICAgICAgICBtYXRjaCA9IHRydWU7XG4gICAgICB9XG4gICAgfVxuICAgIGlmICghbWF0Y2gpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH1cblxuICBpZiAoZW50cnkuZmllbGRHY1R5cGUpIHtcbiAgICBsZXQgbWF0Y2ggPSBmYWxzZTtcbiAgICBjb25zdCBnY1R5cGVQcmVmaXggPSBcImh0dHA6Ly9nZWRjb214Lm9yZy9cIjtcbiAgICBpZiAoZmllbGQudHlwZSAmJiBmaWVsZC50eXBlLnN0YXJ0c1dpdGgoZ2NUeXBlUHJlZml4KSkge1xuICAgICAgbGV0IGZpZWxkR2NUeXBlID0gZmllbGQudHlwZS5zdWJzdHJpbmcoZ2NUeXBlUHJlZml4Lmxlbmd0aCk7XG4gICAgICBpZiAoZmllbGRHY1R5cGUgPT0gZW50cnkuZmllbGRHY1R5cGUpIHtcbiAgICAgICAgbWF0Y2ggPSB0cnVlO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAoIW1hdGNoKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHRydWU7XG59XG5cbmZ1bmN0aW9uIGRldGVybWluZUZpZWxkVmFsdWUoZW50cnksIGZpZWxkKSB7XG4gIGlmICghZmllbGQudmFsdWVzIHx8IGZpZWxkLnZhbHVlcy5sZW5ndGggPCAxKSB7XG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgfVxuXG4gIGxldCB2YWx1ZU9iaiA9IGZpZWxkLnZhbHVlc1swXTtcbiAgaWYgKGZpZWxkLnZhbHVlcy5sZW5ndGggPiAxICYmIGVudHJ5LnZhbHVlVHlwZSkge1xuICAgIC8vIHRoZXJlIGNhbiBiZSBhbiBvcmlnIGFuZCBhbiBpbnRlcnByZXRlZCBmb3IgZXhhbXBsZVxuICAgIGZvciAobGV0IHZhbHVlIG9mIGZpZWxkLnZhbHVlcykge1xuICAgICAgbGV0IHZhbHVlVHlwZSA9IHZhbHVlLnR5cGU7XG4gICAgICBjb25zdCBnY1R5cGVQcmVmaXggPSBcImh0dHA6Ly9nZWRjb214Lm9yZy9cIjtcbiAgICAgIGlmICh2YWx1ZVR5cGUuc3RhcnRzV2l0aChnY1R5cGVQcmVmaXgpKSB7XG4gICAgICAgIHZhbHVlVHlwZSA9IHZhbHVlVHlwZS5zdWJzdHJpbmcoZ2NUeXBlUHJlZml4Lmxlbmd0aCk7XG4gICAgICB9XG4gICAgICBpZiAodmFsdWVUeXBlID09IGVudHJ5LnZhbHVlVHlwZSkge1xuICAgICAgICB2YWx1ZU9iaiA9IHZhbHVlO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICByZXR1cm4gdmFsdWVPYmo7XG59XG5cbmZ1bmN0aW9uIGFkZEZpZWxkRGF0YVZhbHVlKGVudHJ5LCByZXN1bHQsIGZpZWxkLCB2YWx1ZU9iaikge1xuICBsZXQgdmFsdWUgPSB2YWx1ZU9iai50ZXh0O1xuICBpZiAoIXZhbHVlKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgaWYgKGVudHJ5LmRhdGFGaWVsZCkge1xuICAgIHJlc3VsdFtlbnRyeS5kYXRhRmllbGRdID0gdmFsdWU7XG4gIH1cblxuICBsZXQgcmVjb3JkRGF0YUFkZGVkID0gZmFsc2U7XG4gIGlmIChlbnRyeS5yZWNvcmREYXRhRmllbGQpIHtcbiAgICBpZiAoIXJlc3VsdC5yZWNvcmREYXRhKSB7XG4gICAgICByZXN1bHQucmVjb3JkRGF0YSA9IHt9O1xuICAgIH1cbiAgICByZXN1bHQucmVjb3JkRGF0YVtlbnRyeS5yZWNvcmREYXRhRmllbGRdID0gdmFsdWU7XG4gICAgcmVjb3JkRGF0YUFkZGVkID0gdHJ1ZTtcbiAgfVxuXG4gIGlmICghcmVjb3JkRGF0YUFkZGVkICYmIGVudHJ5LnJlY29yZERhdGFGaWVsZFVzZUZzVHlwZSkge1xuICAgIGxldCBmaWVsZFR5cGUgPSB1bmRlZmluZWQ7XG4gICAgY29uc3QgZnNUeXBlUHJlZml4ID0gXCJodHRwOi8vZmFtaWx5c2VhcmNoLm9yZy90eXBlcy9maWVsZHMvXCI7XG4gICAgaWYgKGZpZWxkLnR5cGUgJiYgZmllbGQudHlwZS5zdGFydHNXaXRoKGZzVHlwZVByZWZpeCkpIHtcbiAgICAgIGZpZWxkVHlwZSA9IGZpZWxkLnR5cGUuc3Vic3RyaW5nKGZzVHlwZVByZWZpeC5sZW5ndGgpO1xuICAgIH1cblxuICAgIGlmIChmaWVsZFR5cGUpIHtcbiAgICAgIGxldCBmaWVsZE5hbWUgPSBmaWVsZFR5cGUucmVwbGFjZSgvKFthLXpdKShbQS1aXSkvZywgXCIkMSAkMlwiKTtcblxuICAgICAgaWYgKCFyZXN1bHQucmVjb3JkRGF0YSkge1xuICAgICAgICByZXN1bHQucmVjb3JkRGF0YSA9IHt9O1xuICAgICAgfVxuICAgICAgcmVzdWx0LnJlY29yZERhdGFbZmllbGROYW1lXSA9IHZhbHVlO1xuICAgICAgcmVjb3JkRGF0YUFkZGVkID0gdHJ1ZTtcbiAgICB9XG4gIH1cblxuICBpZiAoIXJlY29yZERhdGFBZGRlZCAmJiBlbnRyeS5yZWNvcmREYXRhRmllbGRVc2VHY1R5cGUpIHtcbiAgICBsZXQgZmllbGRUeXBlID0gdW5kZWZpbmVkO1xuICAgIGNvbnN0IGdjVHlwZVByZWZpeCA9IFwiaHR0cDovL2dlZGNvbXgub3JnL1wiO1xuICAgIGlmIChmaWVsZC50eXBlICYmIGZpZWxkLnR5cGUuc3RhcnRzV2l0aChnY1R5cGVQcmVmaXgpKSB7XG4gICAgICBmaWVsZFR5cGUgPSBmaWVsZC50eXBlLnN1YnN0cmluZyhnY1R5cGVQcmVmaXgubGVuZ3RoKTtcbiAgICB9XG5cbiAgICBpZiAoZmllbGRUeXBlKSB7XG4gICAgICBsZXQgZmllbGROYW1lID0gZmllbGRUeXBlLnJlcGxhY2UoLyhbYS16XSkoW0EtWl0pL2csIFwiJDEgJDJcIik7XG5cbiAgICAgIGlmICghcmVzdWx0LnJlY29yZERhdGEpIHtcbiAgICAgICAgcmVzdWx0LnJlY29yZERhdGEgPSB7fTtcbiAgICAgIH1cbiAgICAgIHJlc3VsdC5yZWNvcmREYXRhW2ZpZWxkTmFtZV0gPSB2YWx1ZTtcbiAgICAgIHJlY29yZERhdGFBZGRlZCA9IHRydWU7XG4gICAgfVxuICB9XG5cbiAgaWYgKGVudHJ5LnJlZmVyZW5jZURhdGFGaWVsZCkge1xuICAgIGlmICghcmVzdWx0LnJlZmVyZW5jZURhdGEpIHtcbiAgICAgIHJlc3VsdC5yZWZlcmVuY2VEYXRhID0ge307XG4gICAgfVxuICAgIHJlc3VsdC5yZWZlcmVuY2VEYXRhW2VudHJ5LnJlZmVyZW5jZURhdGFGaWVsZF0gPSB2YWx1ZTtcbiAgfVxufVxuXG5mdW5jdGlvbiBwcm9jZXNzRmllbGQocmVzdWx0LCBmaWVsZCwgc291cmNlU2VjdGlvbikge1xuICBmb3IgKGxldCBlbnRyeSBvZiBmaWVsZERhdGEpIHtcbiAgICBpZiAoZG9lc0ZpZWxkRGF0YU1hdGNoKGVudHJ5LCByZXN1bHQsIGZpZWxkLCBzb3VyY2VTZWN0aW9uKSkge1xuICAgICAgbGV0IHZhbHVlT2JqID0gZGV0ZXJtaW5lRmllbGRWYWx1ZShlbnRyeSwgZmllbGQpO1xuICAgICAgaWYgKHZhbHVlT2JqKSB7XG4gICAgICAgIGFkZEZpZWxkRGF0YVZhbHVlKGVudHJ5LCByZXN1bHQsIGZpZWxkLCB2YWx1ZU9iaik7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH1cbiAgfVxufVxuXG5mdW5jdGlvbiBwcm9jZXNzRmllbGRzKHJlc3VsdCwgZmllbGRzLCBzb3VyY2VTZWN0aW9uKSB7XG4gIGlmICghZmllbGRzKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgZm9yIChsZXQgZmllbGQgb2YgZmllbGRzKSB7XG4gICAgcHJvY2Vzc0ZpZWxkKHJlc3VsdCwgZmllbGQsIHNvdXJjZVNlY3Rpb24pO1xuICB9XG59XG5cbmZ1bmN0aW9uIGlzRmllbGRUeXBlVmFsaWRGb3JSZWNvcmREYXRhKHR5cGUpIHtcbiAgY29uc3QgdHlwZXNUb0V4Y2x1ZGUgPSBbXG4gICAgXCJTb3VyY2VQaWVjZUZvbGlvXCIsXG4gICAgXCJTb3VyY2VMaW5lTmJyXCIsXG4gICAgXCJTb3VyY2VSZWdOYnJcIixcbiAgICBcIlNvdXJjZUVudHJ5TmJyXCIsXG4gICAgXCJTb3VyY2VQYWdlTmJyXCIsXG4gICAgXCJTb3VyY2VCb29rTmJyXCIsXG4gICAgXCJTb3VyY2VIb3VzZWhvbGRJZFwiLFxuICAgIFwiSG91c2Vob2xkSWRcIixcbiAgICBcIkZvbGlvTm9cIixcbiAgICBcIkNvdW50eUlkXCIsXG4gICAgXCJSZWxhdGlvbnNoaXBUb0hlYWRcIixcbiAgICBcIlJlbGF0aW9uc2hpcFRvSGVhZENvZGVcIixcbiAgXTtcblxuICBmb3IgKGxldCBmaWVsZFR5cGUgb2YgdHlwZXNUb0V4Y2x1ZGUpIHtcbiAgICBpZiAodHlwZSA9PSBmaWVsZFR5cGUpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gdHJ1ZTtcbn1cblxuZnVuY3Rpb24gZ2V0RmFjdFR5cGUoZmFjdCkge1xuICBsZXQgZmFjdFR5cGUgPSBmYWN0LnR5cGU7XG4gIGNvbnN0IGZzVHlwZVByZWZpeCA9IFwiaHR0cDovL2ZhbWlseXNlYXJjaC5vcmcvdHlwZXMvZmFjdHMvXCI7XG4gIGNvbnN0IGdjVHlwZVByZWZpeCA9IFwiaHR0cDovL2dlZGNvbXgub3JnL1wiO1xuICBpZiAoZmFjdFR5cGUuc3RhcnRzV2l0aChmc1R5cGVQcmVmaXgpKSB7XG4gICAgZmFjdFR5cGUgPSBmYWN0VHlwZS5zdWJzdHJpbmcoZnNUeXBlUHJlZml4Lmxlbmd0aCk7XG4gIH0gZWxzZSBpZiAoZmFjdFR5cGUuc3RhcnRzV2l0aChnY1R5cGVQcmVmaXgpKSB7XG4gICAgZmFjdFR5cGUgPSBmYWN0VHlwZS5zdWJzdHJpbmcoZ2NUeXBlUHJlZml4Lmxlbmd0aCk7XG4gIH1cbiAgcmV0dXJuIGZhY3RUeXBlO1xufVxuXG5mdW5jdGlvbiBnZXRGYWN0VHlwZUZyb21SZWNvcmRUeXBlKHJlY29yZFR5cGUpIHtcbiAgbGV0IGZhY3RUeXBlID0gcmVjb3JkVHlwZTtcbiAgY29uc3QgZ2NUeXBlUHJlZml4ID0gXCJodHRwOi8vZ2VkY29teC5vcmcvXCI7XG4gIGlmIChmYWN0VHlwZS5zdGFydHNXaXRoKGdjVHlwZVByZWZpeCkpIHtcbiAgICBmYWN0VHlwZSA9IGZhY3RUeXBlLnN1YnN0cmluZyhnY1R5cGVQcmVmaXgubGVuZ3RoKTtcbiAgfVxuICByZXR1cm4gZmFjdFR5cGU7XG59XG5cbmZ1bmN0aW9uIHNldEV2ZW50RGF0ZUFuZFBsYWNlRm9yRmFjdChyZXN1bHQsIGZhY3QpIHtcbiAgaWYgKGZhY3QuZGF0ZSkge1xuICAgIGlmIChmYWN0LmRhdGUub3JpZ2luYWwpIHtcbiAgICAgIHJlc3VsdC5ldmVudERhdGVPcmlnaW5hbCA9IGZhY3QuZGF0ZS5vcmlnaW5hbDtcbiAgICB9XG4gICAgc2V0RmllbGRGcm9tRGF0ZShmYWN0LmRhdGUsIFwiL0RhdGVcIiwgXCJFVkVOVF9EQVRFXCIsIHJlc3VsdCwgXCJldmVudERhdGVcIik7XG4gICAgc2V0RmllbGRGcm9tRGF0ZShmYWN0LmRhdGUsIFwiL1llYXJcIiwgXCJFVkVOVF9ZRUFSXCIsIHJlc3VsdCwgXCJldmVudFllYXJcIik7XG4gIH1cbiAgaWYgKGZhY3QucGxhY2UpIHtcbiAgICBpZiAoZmFjdC5wbGFjZS5vcmlnaW5hbCkge1xuICAgICAgcmVzdWx0LmV2ZW50UGxhY2VPcmlnaW5hbCA9IGZhY3QucGxhY2Uub3JpZ2luYWw7XG4gICAgfVxuICAgIHNldEZpZWxkRnJvbVBsYWNlKGZhY3QucGxhY2UsIFwiXCIsIFwiRVZFTlRfUExBQ0VcIiwgcmVzdWx0LCBcImV2ZW50UGxhY2VcIik7XG4gICAgc2V0RmllbGRGcm9tUGxhY2UoZmFjdC5wbGFjZSwgXCIvUmVnaXN0cmF0aW9uRGlzdHJpY3RcIiwgXCJcIiwgcmVzdWx0LCBcInJlZ2lzdHJhdGlvbkRpc3RyaWN0XCIpO1xuICAgIHNldEZpZWxkRnJvbVBsYWNlKGZhY3QucGxhY2UsIFwiXCIsIFwiRVZFTlRfUExBQ0VfTEVWRUxfM1wiLCByZXN1bHQsIFwiZXZlbnRQbGFjZUwzXCIpO1xuICAgIHNldEZpZWxkRnJvbVBsYWNlKGZhY3QucGxhY2UsIFwiL0NvdW50eVwiLCBcIkVWRU5UX1BMQUNFX0xFVkVMXzJcIiwgcmVzdWx0LCBcImV2ZW50UGxhY2VMMlwiKTtcbiAgICBzZXRGaWVsZEZyb21QbGFjZShmYWN0LnBsYWNlLCBcIi9Db3VudHJ5XCIsIFwiRVZFTlRfUExBQ0VfTEVWRUxfMVwiLCByZXN1bHQsIFwiZXZlbnRQbGFjZUwxXCIpO1xuICB9XG59XG5cbmZ1bmN0aW9uIHNldERhdGVBbmRQbGFjZUZvckFkZGl0aW9uYWxGYWN0KHJlc3VsdCwgZmFjdCkge1xuICBsZXQgZmFjdFR5cGUgPSBnZXRGYWN0VHlwZShmYWN0KTtcbiAgbGV0IHByZWZpeCA9IGZhY3RUeXBlO1xuICBpZiAoZmFjdC5kYXRlKSB7XG4gICAgbGV0IGRhdGUgPSBnZXRDbGVhbkRhdGVWYWx1ZUZyb21EYXRlKGZhY3QuZGF0ZSwgXCIvRGF0ZVwiLCBcIkVWRU5UX0RBVEVcIik7XG4gICAgaWYgKGRhdGUpIHtcbiAgICAgIHJlc3VsdC5yZWNvcmREYXRhW3ByZWZpeCArIFwiIERhdGVcIl0gPSBkYXRlO1xuICAgIH1cblxuICAgIGlmIChmYWN0LmRhdGUub3JpZ2luYWwgJiYgZmFjdC5kYXRlLm9yaWdpbmFsICE9IGRhdGUpIHtcbiAgICAgIHJlc3VsdC5yZWNvcmREYXRhW3ByZWZpeCArIFwiIERhdGUgKE9yaWdpbmFsKVwiXSA9IGZhY3QuZGF0ZS5vcmlnaW5hbDtcbiAgICB9XG5cbiAgICBpZiAoIWZhY3QuZGF0ZS5vcmlnaW5hbCAmJiAhZGF0ZSkge1xuICAgICAgbGV0IHllYXIgPSBnZXRDbGVhbkRhdGVWYWx1ZUZyb21EYXRlKGZhY3QuZGF0ZSwgXCIvWWVhclwiLCBcIkVWRU5UX1lFQVJcIik7XG4gICAgICBpZiAoeWVhcikge1xuICAgICAgICByZXN1bHQucmVjb3JkRGF0YVtwcmVmaXggKyBcIiBZZWFyXCJdID0geWVhcjtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgaWYgKGZhY3QucGxhY2UpIHtcbiAgICBsZXQgcGxhY2UgPSBnZXRDbGVhblBsYWNlVmFsdWVGcm9tUGxhY2UoZmFjdC5wbGFjZSwgXCJcIiwgXCJFVkVOVF9QTEFDRVwiKTtcbiAgICBpZiAocGxhY2UpIHtcbiAgICAgIHJlc3VsdC5yZWNvcmREYXRhW3ByZWZpeCArIFwiIFBsYWNlXCJdID0gcGxhY2U7XG4gICAgfVxuXG4gICAgaWYgKGZhY3QucGxhY2Uub3JpZ2luYWwgJiYgZmFjdC5wbGFjZS5vcmlnaW5hbCAhPSBwbGFjZSkge1xuICAgICAgcmVzdWx0LnJlY29yZERhdGFbcHJlZml4ICsgXCIgUGxhY2UgKE9yaWdpbmFsKVwiXSA9IGZhY3QucGxhY2Uub3JpZ2luYWw7XG4gICAgfVxuICB9XG59XG5cbmZ1bmN0aW9uIGRvZXNMYWJlbE92ZXJyaWRlKGxhYmVsSWQsIHVzZWRMYWJlbElkKSB7XG4gIGNvbnN0IG92ZXJyaWRlcyA9IHtcbiAgICBQUl9BR0U6IFtcIlBSX0FHRV9PUklHXCIsIFwiUFJfQUdFX0lOX1lFQVJTX09SSUdcIl0sXG4gICAgUFJfUkVMQVRJT05TSElQX1RPX0hFQUQ6IFtcIlBSX1JFTEFUSU9OU0hJUF9UT19IRUFEX09SSUdcIl0sXG4gIH07XG5cbiAgaWYgKCFsYWJlbElkKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgaWYgKCF1c2VkTGFiZWxJZCkge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgbGV0IGxhYmVsT3ZlcnJpZGVzID0gb3ZlcnJpZGVzW2xhYmVsSWRdO1xuICBpZiAobGFiZWxPdmVycmlkZXMgJiYgbGFiZWxPdmVycmlkZXMuaW5jbHVkZXModXNlZExhYmVsSWQpKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICByZXR1cm4gZmFsc2U7XG59XG5cbnZhciB1c2VkTGFiZWxJZHMgPSB7fTtcblxuZnVuY3Rpb24gZXh0cmFjdEZpZWxkcyhyZXN1bHQsIGZpZWxkcywgbWFwKSB7XG4gIGlmICghZmllbGRzKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgZm9yIChsZXQgZmllbGQgb2YgZmllbGRzKSB7XG4gICAgbGV0IGZpZWxkVHlwZSA9IGZpZWxkLnR5cGU7XG4gICAgaWYgKGZpZWxkVHlwZSAmJiBmaWVsZC52YWx1ZXMgJiYgZmllbGQudmFsdWVzLmxlbmd0aCA+IDApIHtcbiAgICAgIGNvbnN0IGZzVHlwZVByZWZpeCA9IFwiaHR0cDovL2ZhbWlseXNlYXJjaC5vcmcvdHlwZXMvZmllbGRzL1wiO1xuICAgICAgY29uc3QgZ2NUeXBlUHJlZml4ID0gXCJodHRwOi8vZ2VkY29teC5vcmcvXCI7XG4gICAgICBpZiAoZmllbGRUeXBlLnN0YXJ0c1dpdGgoZnNUeXBlUHJlZml4KSkge1xuICAgICAgICBmaWVsZFR5cGUgPSBmaWVsZFR5cGUuc3Vic3RyaW5nKGZzVHlwZVByZWZpeC5sZW5ndGgpO1xuICAgICAgfSBlbHNlIGlmIChmaWVsZFR5cGUuc3RhcnRzV2l0aChnY1R5cGVQcmVmaXgpKSB7XG4gICAgICAgIGZpZWxkVHlwZSA9IGZpZWxkVHlwZS5zdWJzdHJpbmcoZ2NUeXBlUHJlZml4Lmxlbmd0aCk7XG4gICAgICB9XG5cbiAgICAgIGxldCByZXN1bHRQcm9wZXJ0eSA9IG1hcFtmaWVsZFR5cGVdO1xuICAgICAgaWYgKHJlc3VsdFByb3BlcnR5KSB7XG4gICAgICAgIGZvciAobGV0IHZhbHVlIG9mIGZpZWxkLnZhbHVlcykge1xuICAgICAgICAgIGNvbnN0IGxhYmVsSWQgPSB2YWx1ZS5sYWJlbElkO1xuICAgICAgICAgIGxldCBkb2VzT3ZlcnJpZGUgPSBkb2VzTGFiZWxPdmVycmlkZShsYWJlbElkLCB1c2VkTGFiZWxJZHNbcmVzdWx0UHJvcGVydHldKTtcblxuICAgICAgICAgIGlmICghcmVzdWx0W3Jlc3VsdFByb3BlcnR5XSB8fCBkb2VzT3ZlcnJpZGUpIHtcbiAgICAgICAgICAgIHJlc3VsdFtyZXN1bHRQcm9wZXJ0eV0gPSB2YWx1ZS50ZXh0O1xuICAgICAgICAgICAgdXNlZExhYmVsSWRzW3Jlc3VsdFByb3BlcnR5XSA9IGxhYmVsSWQ7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG59XG5cbmZ1bmN0aW9uIGZpbmRQZXJzb25CeUlkKGRhdGFPYmosIHBlcnNvbklkKSB7XG4gIGxldCBwZXJzb25zID0gZGF0YU9iai5wZXJzb25zO1xuICBpZiAocGVyc29ucykge1xuICAgIGZvciAobGV0IHBlcnNvbiBvZiBwZXJzb25zKSB7XG4gICAgICBpZiAocGVyc29uLmlkID09IHBlcnNvbklkKSB7XG4gICAgICAgIHJldHVybiBwZXJzb247XG4gICAgICB9XG4gICAgfVxuICB9XG59XG5cbmZ1bmN0aW9uIGdldFByaW1hcnlOYW1lRm9ybShwZXJzb24pIHtcbiAgbGV0IG5hbWVGb3JtcyA9IFtdO1xuICBsZXQgbmFtZUFycmF5ID0gcGVyc29uLm5hbWVzO1xuICBpZiAobmFtZUFycmF5ICYmIG5hbWVBcnJheS5sZW5ndGggPiAwKSB7XG4gICAgZm9yIChsZXQgbmFtZSBvZiBuYW1lQXJyYXkpIHtcbiAgICAgIC8vIHRoaXMgdXN1YWxseSBzZWVtcyB0byBiZSBcImh0dHA6Ly9nZWRjb214Lm9yZy9CaXJ0aE5hbWVcIiBidXQgY2FuIGFsc28gYmVcbiAgICAgIC8vIFwiaHR0cDovL2dlZGNvbXgub3JnL0Fsc29Lbm93bkFzXCIgd2hpY2ggd2UgaWdub3JlXG4gICAgICBsZXQgbmFtZVR5cGUgPSBuYW1lLnR5cGU7XG4gICAgICBpZiAobmFtZVR5cGUgPT0gXCJodHRwOi8vZ2VkY29teC5vcmcvQmlydGhOYW1lXCIpIHtcbiAgICAgICAgZm9yIChsZXQgbmFtZUZvcm0gb2YgbmFtZS5uYW1lRm9ybXMpIHtcbiAgICAgICAgICBpZiAobmFtZUZvcm0ucGFydHMpIHtcbiAgICAgICAgICAgIG5hbWVGb3Jtcy5wdXNoKG5hbWVGb3JtKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGlmIChuYW1lRm9ybXMubGVuZ3RoID09IDApIHtcbiAgICAvLyBmb3Igc29tZSByZWNvcmQgdGhlcmUgYXJlIG5vIHBhcnRzIC0ganVzdCBhIGZ1bGwgbmFtZVxuICAgIGlmIChuYW1lQXJyYXkgJiYgbmFtZUFycmF5Lmxlbmd0aCA+IDApIHtcbiAgICAgIGZvciAobGV0IG5hbWUgb2YgbmFtZUFycmF5KSB7XG4gICAgICAgIGxldCBuYW1lVHlwZSA9IG5hbWUudHlwZTsgLy8gdGhpcyBhbHdheXMgc2VlbXMgdG8gYmUgXCJodHRwOi8vZ2VkY29teC5vcmcvQmlydGhOYW1lXCJcbiAgICAgICAgaWYgKG5hbWUubmFtZUZvcm1zICYmIG5hbWUubmFtZUZvcm1zLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICBmb3IgKGxldCBuYW1lRm9ybSBvZiBuYW1lLm5hbWVGb3Jtcykge1xuICAgICAgICAgICAgaWYgKG5hbWVGb3JtLmZpZWxkcykge1xuICAgICAgICAgICAgICBuYW1lRm9ybXMucHVzaChuYW1lRm9ybSk7XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGlmIChuYW1lRm9ybXMubGVuZ3RoID09IDApIHtcbiAgICByZXR1cm4gdW5kZWZpbmVkO1xuICB9XG4gIGlmIChuYW1lRm9ybXMubGVuZ3RoID09IDEpIHtcbiAgICByZXR1cm4gbmFtZUZvcm1zWzBdO1xuICB9XG5cbiAgLy8gdGhlcmUgd2FzIG1vcmUgdGhhbiBvbmUuIFRoZSBsYXRlciBvbmVzIGNvdWxkIGJlIGNvcnJlY3RlZCBuYW1lcy4gQnV0IHNvbWV0aW1lcyB0aGVcbiAgLy8gY29ycmVjdGVkIG9uZSBpcyBtaXNzaW5nIGZpZWxkcyBsaWtlIGZ1bGxOYW1lXG4gIGxldCBmaXJzdE5hbWVGb3JtID0gbmFtZUZvcm1zWzBdO1xuICBsZXQgbGFzdE5hbWVGb3JtID0gbmFtZUZvcm1zW25hbWVGb3Jtcy5sZW5ndGggLSAxXTtcblxuICBpZiAoIWxhc3ROYW1lRm9ybS5mdWxsVGV4dCkge1xuICAgIGxldCBsYXN0UGFydHMgPSB7fTtcbiAgICBpZiAobGFzdE5hbWVGb3JtLnBhcnRzKSB7XG4gICAgICBmb3IgKGxldCBwYXJ0IG9mIGxhc3ROYW1lRm9ybS5wYXJ0cykge1xuICAgICAgICBpZiAocGFydC50eXBlLmVuZHNXaXRoKFwiR2l2ZW5cIikpIHtcbiAgICAgICAgICBsYXN0UGFydHMuZ2l2ZW5OYW1lID0gcGFydC52YWx1ZTtcbiAgICAgICAgfSBlbHNlIGlmIChwYXJ0LnR5cGUuZW5kc1dpdGgoXCJTdXJuYW1lXCIpKSB7XG4gICAgICAgICAgbGFzdFBhcnRzLnN1cm5hbWUgPSBwYXJ0LnZhbHVlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIGlmIChsYXN0UGFydHMuZ2l2ZW5OYW1lICYmIGxhc3RQYXJ0cy5zdXJuYW1lKSB7XG4gICAgICBsYXN0TmFtZUZvcm0uZnVsbFRleHQgPSBsYXN0UGFydHMuZ2l2ZW5OYW1lICsgXCIgXCIgKyBsYXN0UGFydHMuc3VybmFtZTtcbiAgICB9IGVsc2Uge1xuICAgICAgbGV0IGZpcnN0UGFydHMgPSB7fTtcbiAgICAgIGlmIChmaXJzdE5hbWVGb3JtLnBhcnRzKSB7XG4gICAgICAgIGZvciAobGV0IHBhcnQgb2YgZmlyc3ROYW1lRm9ybS5wYXJ0cykge1xuICAgICAgICAgIGlmIChwYXJ0LnR5cGUuZW5kc1dpdGgoXCJHaXZlblwiKSkge1xuICAgICAgICAgICAgZmlyc3RQYXJ0cy5naXZlbk5hbWUgPSBwYXJ0LnZhbHVlO1xuICAgICAgICAgIH0gZWxzZSBpZiAocGFydC50eXBlLmVuZHNXaXRoKFwiU3VybmFtZVwiKSkge1xuICAgICAgICAgICAgZmlyc3RQYXJ0cy5zdXJuYW1lID0gcGFydC52YWx1ZTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgaWYgKCFsYXN0UGFydHMuZ2l2ZW5OYW1lICYmIGZpcnN0UGFydHMuZ2l2ZW5OYW1lKSB7XG4gICAgICAgIGxhc3RQYXJ0cy5naXZlbk5hbWUgPSBmaXJzdFBhcnRzLmdpdmVuTmFtZTtcbiAgICAgIH1cbiAgICAgIGlmICghbGFzdFBhcnRzLnN1cm5hbWUgJiYgZmlyc3RQYXJ0cy5zdXJuYW1lKSB7XG4gICAgICAgIGxhc3RQYXJ0cy5zdXJuYW1lID0gZmlyc3RQYXJ0cy5zdXJuYW1lO1xuICAgICAgfVxuXG4gICAgICBpZiAobGFzdFBhcnRzLmdpdmVuTmFtZSAmJiBsYXN0UGFydHMuc3VybmFtZSkge1xuICAgICAgICBsYXN0TmFtZUZvcm0uZnVsbFRleHQgPSBsYXN0UGFydHMuZ2l2ZW5OYW1lICsgXCIgXCIgKyBsYXN0UGFydHMuc3VybmFtZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIHN0aWxsIGNhbid0IG1ha2UgZnVsbCBuYW1lXG4gICAgICAgIGlmIChmaXJzdE5hbWVGb3JtLmZ1bGxUZXh0KSB7XG4gICAgICAgICAgbGFzdE5hbWVGb3JtLmZ1bGxUZXh0ID0gZmlyc3ROYW1lRm9ybS5mdWxsVGV4dDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHJldHVybiBsYXN0TmFtZUZvcm07XG59XG5cbmZ1bmN0aW9uIGdldE5hbWVGb3JQZXJzb25PYmoocGVyc29uLCByZXN1bHQpIHtcbiAgbGV0IG5hbWVGb3JtID0gZ2V0UHJpbWFyeU5hbWVGb3JtKHBlcnNvbik7XG4gIGlmIChuYW1lRm9ybSkge1xuICAgIGlmIChuYW1lRm9ybS5mdWxsVGV4dCkge1xuICAgICAgcmVzdWx0LmZ1bGxOYW1lID0gbmFtZUZvcm0uZnVsbFRleHQ7XG4gICAgfVxuICAgIGlmIChuYW1lRm9ybS5wYXJ0cykge1xuICAgICAgZm9yIChsZXQgcGFydCBvZiBuYW1lRm9ybS5wYXJ0cykge1xuICAgICAgICBpZiAocGFydC52YWx1ZSkge1xuICAgICAgICAgIGlmIChwYXJ0LnR5cGUuZW5kc1dpdGgoXCJHaXZlblwiKSkge1xuICAgICAgICAgICAgcmVzdWx0LmdpdmVuTmFtZSA9IHBhcnQudmFsdWU7XG4gICAgICAgICAgfSBlbHNlIGlmIChwYXJ0LnR5cGUuZW5kc1dpdGgoXCJTdXJuYW1lXCIpKSB7XG4gICAgICAgICAgICByZXN1bHQuc3VybmFtZSA9IHBhcnQudmFsdWU7XG4gICAgICAgICAgfSBlbHNlIGlmIChwYXJ0LnR5cGUuZW5kc1dpdGgoXCJQcmVmaXhcIikpIHtcbiAgICAgICAgICAgIHJlc3VsdC5wcmVmaXggPSBwYXJ0LnZhbHVlO1xuICAgICAgICAgIH0gZWxzZSBpZiAocGFydC50eXBlLmVuZHNXaXRoKFwiU3VmZml4XCIpKSB7XG4gICAgICAgICAgICByZXN1bHQuc3VmZml4ID0gcGFydC52YWx1ZTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cbn1cblxuZnVuY3Rpb24gZ2V0R2VuZGVyRm9yUGVyc29uT2JqKHBlcnNvbiwgcmVzdWx0KSB7XG4gIC8vIGdldCBnZW5kZXJcbiAgaWYgKHBlcnNvbi5nZW5kZXIpIHtcbiAgICBpZiAocGVyc29uLmdlbmRlci50eXBlLmVuZHNXaXRoKFwiL01hbGVcIikpIHtcbiAgICAgIHJlc3VsdC5nZW5kZXIgPSBcIm1hbGVcIjtcbiAgICB9IGVsc2UgaWYgKHBlcnNvbi5nZW5kZXIudHlwZS5lbmRzV2l0aChcIi9GZW1hbGVcIikpIHtcbiAgICAgIHJlc3VsdC5nZW5kZXIgPSBcImZlbWFsZVwiO1xuICAgIH1cbiAgfVxufVxuXG5mdW5jdGlvbiBwcm9jZXNzUmVjb3JkRGF0YUZhY3RzRm9yUGVyc29uT2JqKHBlcnNvbiwgcmVzdWx0KSB7XG4gIC8vIGNoZWNrIHRoZSBmYWN0cyBvZiB0aGlzIHByaW1hcnkgcGVyc29uIGZvciB0aGlzIHBlcnNvbnMgdml0YWxzXG4gIGlmIChwZXJzb24uZmFjdHMpIHtcbiAgICBmb3IgKGxldCBmYWN0IG9mIHBlcnNvbi5mYWN0cykge1xuICAgICAgLy8gdGhlIGZhY3QgY29udGFpbnMgdGhlIHBsYWNlIGV0Y1xuICAgICAgLy8gaXQgZ2V0cyBjb21wbGljYXRlZCB3aGVuIHRoZXJlIGlzIG1vcmUgdGhhbiBvbmUgcGVyc29uLlxuICAgICAgLy8gLnByaW5jaXBhbCBzZWVtcyB0byBiZSB3aGV0aGVyIHRoZXkgYXJlIG9uZSBvZiB0aGUgcGVvcGxlIGJlaW5nIHJlY29yZGVkXG4gICAgICAvLyBJbiBhIGNlbnN1cyBhbGwgdGhlIHBlb3BsZSBpbiB0aGUgaG91c2Vob2xkIGFyZSBwcmluY2lwYWxzXG4gICAgICAvLyBJbiBhIGJpcnRoIHJlZ2lzdHJhdGlvbiB0aGUgY2hpbGQgaXMgYSBwcmluY2lwYWwgYW5kIHRoZSBtb3RoZXIgaXMgbm90XG4gICAgICBpZiAoZmFjdC50eXBlKSB7XG4gICAgICAgIGxldCBmYWN0VHlwZSA9IGdldEZhY3RUeXBlKGZhY3QpO1xuICAgICAgICBpZiAoZmFjdC5wcmltYXJ5KSB7XG4gICAgICAgICAgcmVzdWx0LmZhY3RUeXBlID0gZmFjdFR5cGU7XG4gICAgICAgICAgc2V0RXZlbnREYXRlQW5kUGxhY2VGb3JGYWN0KHJlc3VsdCwgZmFjdCk7XG4gICAgICAgIH1cblxuICAgICAgICAvL2NvbnNvbGUubG9nKFwiZmFjdFR5cGUgaXMgXCIgKyBmYWN0VHlwZSk7XG4gICAgICAgIGlmIChmYWN0VHlwZSA9PSBcIkJpcnRoXCIpIHtcbiAgICAgICAgICAvL2NvbnNvbGUubG9nKFwidHlwZSBpcyBiaXJ0aFwiKTtcbiAgICAgICAgICBpZiAoZmFjdC5kYXRlKSB7XG4gICAgICAgICAgICBpZiAoZmFjdC5kYXRlLm9yaWdpbmFsKSB7XG4gICAgICAgICAgICAgIHJlc3VsdC5iaXJ0aERhdGVPcmlnaW5hbCA9IGZhY3QuZGF0ZS5vcmlnaW5hbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHNldEZpZWxkRnJvbURhdGUoZmFjdC5kYXRlLCBcIi9EYXRlXCIsIFwiUFJfQklSX0RBVEVfRVNUXCIsIHJlc3VsdCwgXCJiaXJ0aERhdGVcIik7XG4gICAgICAgICAgICBzZXRGaWVsZEZyb21EYXRlKGZhY3QuZGF0ZSwgXCIvWWVhclwiLCBcIlBSX0JJUl9ZRUFSX0VTVFwiLCByZXN1bHQsIFwiYmlydGhZZWFyXCIpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoZmFjdC5wbGFjZSkge1xuICAgICAgICAgICAgc2V0RmllbGRGcm9tUGxhY2VXaXRoTGFiZWxzKFxuICAgICAgICAgICAgICBmYWN0LnBsYWNlLFxuICAgICAgICAgICAgICBbXG4gICAgICAgICAgICAgICAgXCJQUl9CSVJfUExBQ0VcIixcbiAgICAgICAgICAgICAgICBcIlBSX0JJUl9QTEFDRV9PUklHXCIsXG4gICAgICAgICAgICAgICAgXCJQUl9CSVJUSF9QTEFDRVwiLFxuICAgICAgICAgICAgICAgIFwiUFJfQklSVEhfUExBQ0VfT1JJR1wiLFxuICAgICAgICAgICAgICAgIFwiQklSVEhfUExBQ0VcIixcbiAgICAgICAgICAgICAgICBcIkJJUlRIX1BMQUNFX09SSUdcIixcbiAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgcmVzdWx0LFxuICAgICAgICAgICAgICBcImJpcnRoUGxhY2VcIlxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIGlmICghcmVzdWx0LmJpcnRoUGxhY2UgJiYgIXBlcnNvbi5wcmluY2lwYWwpIHtcbiAgICAgICAgICAgICAgLy8gdGhpcyBiaXJ0aCBpbmZvcm1hdGlvbiBhYm91dCBhIG5vbi1wcmluY2lwYWwuIGUuZy4gdGhlIGJpcnRoIHBsYWNlIG9mIGZhdGhlclxuICAgICAgICAgICAgICAvLyBpbiBhIGNoaWxkJ3MgYmlydGggb3IgZGVhdGggcmVjb3JkLiBUaGUgbGFiZWwgY291bGQgYmUgc29tZXRoaW5nIGxpa2U6XG4gICAgICAgICAgICAgIC8vIFBSX0ZUSFJfQklSVEhfUExBQ0VcbiAgICAgICAgICAgICAgc2V0RmllbGRGcm9tUGxhY2UoZmFjdC5wbGFjZSwgXCJcIiwgXCJcIiwgcmVzdWx0LCBcImJpcnRoUGxhY2VcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKGZhY3RUeXBlID09IFwiRGVhdGhcIikge1xuICAgICAgICAgIGlmIChmYWN0LmRhdGUpIHtcbiAgICAgICAgICAgIGlmIChmYWN0LmRhdGUub3JpZ2luYWwpIHtcbiAgICAgICAgICAgICAgcmVzdWx0LmRlYXRoRGF0ZU9yaWdpbmFsID0gZmFjdC5kYXRlLm9yaWdpbmFsO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgc2V0RmllbGRGcm9tRGF0ZShmYWN0LmRhdGUsIFwiL0RhdGVcIiwgXCJQUl9ERUFfREFURVwiLCByZXN1bHQsIFwiZGVhdGhEYXRlXCIpO1xuICAgICAgICAgICAgaWYgKCFyZXN1bHQuZGVhdGhEYXRlKSB7XG4gICAgICAgICAgICAgIHNldEZpZWxkRnJvbURhdGUoZmFjdC5kYXRlLCBcIi9EYXRlXCIsIFwiUFJfREVBX0RBVEVfRVNUXCIsIHJlc3VsdCwgXCJkZWF0aERhdGVcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIXJlc3VsdC5kZWF0aERhdGUpIHtcbiAgICAgICAgICAgICAgc2V0RmllbGRGcm9tRGF0ZShmYWN0LmRhdGUsIFwiL0RhdGVcIiwgXCJQUl9ERUFfREFURV9PUklHXCIsIHJlc3VsdCwgXCJkZWF0aERhdGVcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBzZXRGaWVsZEZyb21EYXRlKGZhY3QuZGF0ZSwgXCIvWWVhclwiLCBcIlBSX0RFQV9ZRUFSX0VTVFwiLCByZXN1bHQsIFwiZGVhdGhZZWFyXCIpO1xuICAgICAgICAgICAgc2V0RmllbGRGcm9tRGF0ZShmYWN0LmRhdGUsIFwiL01vbnRoXCIsIFwiUFJfREVBX01PTlRIXCIsIHJlc3VsdCwgXCJkZWF0aE1vbnRoXCIpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoZmFjdC5wbGFjZSkge1xuICAgICAgICAgICAgc2V0RmllbGRGcm9tUGxhY2UoZmFjdC5wbGFjZSwgXCJcIiwgXCJQUl9ERUFfUExBQ0VcIiwgcmVzdWx0LCBcImRlYXRoUGxhY2VcIik7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKGZhY3RUeXBlID09IFwiUmVzaWRlbmNlXCIgfHwgZmFjdFR5cGUgPT0gXCJDZW5zdXNcIikge1xuICAgICAgICAgIGlmIChmYWN0LnBsYWNlKSB7XG4gICAgICAgICAgICBzZXRGaWVsZEZyb21QbGFjZShmYWN0LnBsYWNlLCBcIlwiLCBcIk5PVEVfUFJfUkVTX1BMQUNFXCIsIHJlc3VsdCwgXCJyZXNpZGVuY2VcIik7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gYnVpbGQgdXAgcmVjb3JkIGRhdGEgdGhhdCBjb3VsZCBiZSBpbmNsdWRlZCBpbiBhIGRhdGEgdGFibGVcbiAgICAgICAgYWRkUmVjb3JkRGF0YUZvckZhY3QocmVzdWx0LCBmYWN0LCBmYWN0VHlwZSk7XG4gICAgICB9XG4gICAgfVxuICB9XG59XG5cbmZ1bmN0aW9uIHByb2Nlc3NQZXJzb25QYWdlRmFjdHNGb3JQZXJzb25PYmoocGVyc29uLCByZXN1bHQpIHtcbiAgLy8gY2hlY2sgdGhlIGZhY3RzIG9mIHRoaXMgcHJpbWFyeSBwZXJzb24gZm9yIHRoaXMgcGVyc29ucyB2aXRhbHNcbiAgaWYgKHBlcnNvbi5mYWN0cykge1xuICAgIGZvciAobGV0IGZhY3Qgb2YgcGVyc29uLmZhY3RzKSB7XG4gICAgICAvLyB0aGUgZmFjdCBjb250YWlucyB0aGUgcGxhY2UgZXRjXG4gICAgICAvLyBpdCBnZXRzIGNvbXBsaWNhdGVkIHdoZW4gdGhlcmUgaXMgbW9yZSB0aGFuIG9uZSBwZXJzb24uXG4gICAgICAvLyAucHJpbmNpcGFsIHNlZW1zIHRvIGJlIHdoZXRoZXIgdGhleSBhcmUgb25lIG9mIHRoZSBwZW9wbGUgYmVpbmcgcmVjb3JkZWRcbiAgICAgIC8vIEluIGEgY2Vuc3VzIGFsbCB0aGUgcGVvcGxlIGluIHRoZSBob3VzZWhvbGQgYXJlIHByaW5jaXBhbHNcbiAgICAgIC8vIEluIGEgYmlydGggcmVnaXN0cmF0aW9uIHRoZSBjaGlsZCBpcyBhIHByaW5jaXBhbCBhbmQgdGhlIG1vdGhlciBpcyBub3RcbiAgICAgIGlmIChmYWN0LnR5cGUpIHtcbiAgICAgICAgbGV0IGZhY3RUeXBlID0gZ2V0RmFjdFR5cGUoZmFjdCk7XG5cbiAgICAgICAgLy9jb25zb2xlLmxvZyhcImZhY3RUeXBlIGlzIFwiICsgZmFjdFR5cGUpO1xuICAgICAgICBpZiAoZmFjdFR5cGUgPT0gXCJCaXJ0aFwiKSB7XG4gICAgICAgICAgLy9jb25zb2xlLmxvZyhcInR5cGUgaXMgYmlydGhcIik7XG4gICAgICAgICAgaWYgKGZhY3QuZGF0ZSkge1xuICAgICAgICAgICAgaWYgKGZhY3QuZGF0ZS5vcmlnaW5hbCkge1xuICAgICAgICAgICAgICByZXN1bHQuYmlydGhEYXRlT3JpZ2luYWwgPSBmYWN0LmRhdGUub3JpZ2luYWw7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBzZXRGaWVsZEZyb21EYXRlKGZhY3QuZGF0ZSwgXCIvRGF0ZVwiLCBcIlBSX0JJUl9EQVRFX0VTVFwiLCByZXN1bHQsIFwiYmlydGhEYXRlXCIpO1xuICAgICAgICAgICAgc2V0RmllbGRGcm9tRGF0ZShmYWN0LmRhdGUsIFwiL1llYXJcIiwgXCJQUl9CSVJfWUVBUl9FU1RcIiwgcmVzdWx0LCBcImJpcnRoWWVhclwiKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKGZhY3QucGxhY2UpIHtcbiAgICAgICAgICAgIGlmIChmYWN0LnBsYWNlLm9yaWdpbmFsKSB7XG4gICAgICAgICAgICAgIHJlc3VsdC5iaXJ0aFBsYWNlT3JpZ2luYWwgPSBmYWN0LnBsYWNlLm9yaWdpbmFsO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgc2V0RmllbGRGcm9tUGxhY2VXaXRoTGFiZWxzKFxuICAgICAgICAgICAgICBmYWN0LnBsYWNlLFxuICAgICAgICAgICAgICBbXG4gICAgICAgICAgICAgICAgXCJQUl9CSVJfUExBQ0VcIixcbiAgICAgICAgICAgICAgICBcIlBSX0JJUl9QTEFDRV9PUklHXCIsXG4gICAgICAgICAgICAgICAgXCJQUl9CSVJUSF9QTEFDRVwiLFxuICAgICAgICAgICAgICAgIFwiUFJfQklSVEhfUExBQ0VfT1JJR1wiLFxuICAgICAgICAgICAgICAgIFwiQklSVEhfUExBQ0VcIixcbiAgICAgICAgICAgICAgICBcIkJJUlRIX1BMQUNFX09SSUdcIixcbiAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgcmVzdWx0LFxuICAgICAgICAgICAgICBcImJpcnRoUGxhY2VcIlxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAoZmFjdFR5cGUgPT0gXCJEZWF0aFwiKSB7XG4gICAgICAgICAgaWYgKGZhY3QuZGF0ZSkge1xuICAgICAgICAgICAgaWYgKGZhY3QuZGF0ZS5vcmlnaW5hbCkge1xuICAgICAgICAgICAgICByZXN1bHQuZGVhdGhEYXRlT3JpZ2luYWwgPSBmYWN0LmRhdGUub3JpZ2luYWw7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBzZXRGaWVsZEZyb21EYXRlKGZhY3QuZGF0ZSwgXCIvRGF0ZVwiLCBcIlBSX0RFQV9EQVRFXCIsIHJlc3VsdCwgXCJkZWF0aERhdGVcIik7XG4gICAgICAgICAgICBpZiAoIXJlc3VsdC5kZWF0aERhdGUpIHtcbiAgICAgICAgICAgICAgc2V0RmllbGRGcm9tRGF0ZShmYWN0LmRhdGUsIFwiL0RhdGVcIiwgXCJQUl9ERUFfREFURV9FU1RcIiwgcmVzdWx0LCBcImRlYXRoRGF0ZVwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghcmVzdWx0LmRlYXRoRGF0ZSkge1xuICAgICAgICAgICAgICBzZXRGaWVsZEZyb21EYXRlKGZhY3QuZGF0ZSwgXCIvRGF0ZVwiLCBcIlBSX0RFQV9EQVRFX09SSUdcIiwgcmVzdWx0LCBcImRlYXRoRGF0ZVwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHNldEZpZWxkRnJvbURhdGUoZmFjdC5kYXRlLCBcIi9ZZWFyXCIsIFwiUFJfREVBX1lFQVJfRVNUXCIsIHJlc3VsdCwgXCJkZWF0aFllYXJcIik7XG4gICAgICAgICAgICBzZXRGaWVsZEZyb21EYXRlKGZhY3QuZGF0ZSwgXCIvTW9udGhcIiwgXCJQUl9ERUFfTU9OVEhcIiwgcmVzdWx0LCBcImRlYXRoTW9udGhcIik7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChmYWN0LnBsYWNlKSB7XG4gICAgICAgICAgICBpZiAoZmFjdC5wbGFjZS5vcmlnaW5hbCkge1xuICAgICAgICAgICAgICByZXN1bHQuZGVhdGhQbGFjZU9yaWdpbmFsID0gZmFjdC5wbGFjZS5vcmlnaW5hbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHNldEZpZWxkRnJvbVBsYWNlKGZhY3QucGxhY2UsIFwiXCIsIFwiUFJfREVBX1BMQUNFXCIsIHJlc3VsdCwgXCJkZWF0aFBsYWNlXCIpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxufVxuXG5mdW5jdGlvbiBhZGRQYXJlbnRGcm9tUGVyc29uKG90aGVyUGVyc29uLCByZXN1bHQpIHtcbiAgLy8gbG9vayBmb3IgdGhlaXIgbmFtZVxuICBsZXQgcGFyZW50ID0ge307XG4gIGxldCBuYW1lRm9ybSA9IGdldFByaW1hcnlOYW1lRm9ybShvdGhlclBlcnNvbik7XG4gIGlmIChuYW1lRm9ybSkge1xuICAgIHBhcmVudC5mdWxsTmFtZSA9IG5hbWVGb3JtLmZ1bGxUZXh0O1xuICAgIGlmIChuYW1lRm9ybS5wYXJ0cykge1xuICAgICAgZm9yIChsZXQgcGFydCBvZiBuYW1lRm9ybS5wYXJ0cykge1xuICAgICAgICBpZiAocGFydC50eXBlLmVuZHNXaXRoKFwiR2l2ZW5cIikpIHtcbiAgICAgICAgICBwYXJlbnQuZ2l2ZW5OYW1lID0gcGFydC52YWx1ZTtcbiAgICAgICAgfSBlbHNlIGlmIChwYXJ0LnR5cGUuZW5kc1dpdGgoXCJTdXJuYW1lXCIpKSB7XG4gICAgICAgICAgcGFyZW50LnN1cm5hbWUgPSBwYXJ0LnZhbHVlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgaWYgKG90aGVyUGVyc29uLmdlbmRlcikge1xuICAgIGlmIChvdGhlclBlcnNvbi5nZW5kZXIudHlwZS5lbmRzV2l0aChcIi9NYWxlXCIpKSB7XG4gICAgICAvLyBpdCBpcyB0aGUgZmF0aGVyXG4gICAgICByZXN1bHQuZmF0aGVyID0gcGFyZW50O1xuICAgIH0gZWxzZSBpZiAob3RoZXJQZXJzb24uZ2VuZGVyLnR5cGUuZW5kc1dpdGgoXCIvRmVtYWxlXCIpKSB7XG4gICAgICByZXN1bHQubW90aGVyID0gcGFyZW50O1xuICAgIH1cbiAgfVxufVxuXG5mdW5jdGlvbiBleHRyYWN0UGVyc29uRGF0YUZyb21GZXRjaChkb2N1bWVudCwgZGF0YU9iaiwgb3B0aW9ucykge1xuICBsZXQgcmVzdWx0ID0ge307XG5cbiAgaWYgKGRvY3VtZW50KSB7XG4gICAgcmVzdWx0LnVybCA9IGRvY3VtZW50LlVSTDtcbiAgfVxuXG4gIC8vIHRoZXJlIGNvdWxkIGJlIG1hbnkgcGVvcGxlIGluIHRoaXMgZGF0YSwgdGhlIGRlc2NyaXB0aW9uIGlzIG9uZSB3YXkgdG8gZmluZCBvdXQgd2hpY2hcbiAgLy8gaXMgdGhlIG9uZSB0aGF0IGlzIGJlaW5nIGZvY3VzZWQgb25cbiAgbGV0IGRlc2NyaXB0aW9uID0gZGF0YU9iai5kZXNjcmlwdGlvbjtcblxuICBpZiAoIWRlc2NyaXB0aW9uKSB7XG4gICAgLy8gdGhpcyBjb3VsZCBiZSBhbiBpbWFnZSBwYWdlIHdoaWNoIGlzIG5vdCBoYW5kbGVkIGN1cnJlbnRseVxuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cblxuICAvLyBGb3IgYSBwZXJzb24gcGFnZSB0aGUgZGVzY3JpcHQgd2lsbCBiZSBzb21ldGhpbmcgbGlrZTogXCIjU0QtRzhTOC01RkpcIiBtZWFuaW5nIHRoZSBwZXJzb25JZCBpczpcbiAgLy8gXCJHOFM4LTVGSlwiXG4gIGxldCBwZXJzb25JZCA9IGRlc2NyaXB0aW9uLnJlcGxhY2UoL15cXCNTRFxcLS8sIFwiXCIpO1xuXG4gIGlmICghZGF0YU9iai5wZXJzb25zIHx8IGRhdGFPYmoucGVyc29ucy5sZW5ndGggPCAxKSB7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIGxldCBwZXJzb24gPSBkYXRhT2JqLnBlcnNvbnNbMF07XG5cbiAgaWYgKHBlcnNvbi5pZCAhPSBwZXJzb25JZCkge1xuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cblxuICBnZXROYW1lRm9yUGVyc29uT2JqKHBlcnNvbiwgcmVzdWx0KTtcbiAgZ2V0R2VuZGVyRm9yUGVyc29uT2JqKHBlcnNvbiwgcmVzdWx0KTtcbiAgcHJvY2Vzc1BlcnNvblBhZ2VGYWN0c0ZvclBlcnNvbk9iaihwZXJzb24sIHJlc3VsdCk7XG5cbiAgLy8gbm93IGxvb2sgZm9yIHJlbGF0aW9uc2hpcHMgZm9yIHNwb3VzZSBhbmQgcGFyZW50c1xuICBpZiAoZGF0YU9iai5yZWxhdGlvbnNoaXBzKSB7XG4gICAgZm9yIChsZXQgcmVsYXRpb25zaGlwIG9mIGRhdGFPYmoucmVsYXRpb25zaGlwcykge1xuICAgICAgbGV0IG90aGVyUGVyc29uSWQgPSBcIlwiO1xuICAgICAgbGV0IHR5cGUgPSByZWxhdGlvbnNoaXAudHlwZTtcbiAgICAgIGlmIChyZWxhdGlvbnNoaXAucGVyc29uMS5yZXNvdXJjZUlkID09IHBlcnNvbklkKSB7XG4gICAgICAgIG90aGVyUGVyc29uSWQgPSByZWxhdGlvbnNoaXAucGVyc29uMi5yZXNvdXJjZUlkO1xuICAgICAgfSBlbHNlIGlmIChyZWxhdGlvbnNoaXAucGVyc29uMi5yZXNvdXJjZUlkID09IHBlcnNvbklkKSB7XG4gICAgICAgIG90aGVyUGVyc29uSWQgPSByZWxhdGlvbnNoaXAucGVyc29uMS5yZXNvdXJjZUlkO1xuICAgICAgfVxuXG4gICAgICBpZiAob3RoZXJQZXJzb25JZCkge1xuICAgICAgICBsZXQgb3RoZXJQZXJzb24gPSBmaW5kUGVyc29uQnlJZChkYXRhT2JqLCBvdGhlclBlcnNvbklkKTtcblxuICAgICAgICBpZiAodHlwZSA9PSBcImh0dHA6Ly9nZWRjb214Lm9yZy9Db3VwbGVcIikge1xuICAgICAgICAgIGxldCBzcG91c2UgPSB7fTtcbiAgICAgICAgICBnZXROYW1lRm9yUGVyc29uT2JqKG90aGVyUGVyc29uLCBzcG91c2UpO1xuXG4gICAgICAgICAgaWYgKHJlbGF0aW9uc2hpcC5mYWN0cykge1xuICAgICAgICAgICAgZm9yIChsZXQgZmFjdCBvZiByZWxhdGlvbnNoaXAuZmFjdHMpIHtcbiAgICAgICAgICAgICAgaWYgKGZhY3QudHlwZSA9PSBcImh0dHA6Ly9nZWRjb214Lm9yZy9NYXJyaWFnZVwiKSB7XG4gICAgICAgICAgICAgICAgaWYgKGZhY3QuZGF0ZSkge1xuICAgICAgICAgICAgICAgICAgaWYgKGZhY3QuZGF0ZS5vcmlnaW5hbCkge1xuICAgICAgICAgICAgICAgICAgICBzcG91c2UubWFycmlhZ2VEYXRlT3JpZ2luYWwgPSBmYWN0LmRhdGUub3JpZ2luYWw7XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICBpZiAoZmFjdC5kYXRlLm5vcm1hbGl6ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgbm9ybURhdGUgb2YgZmFjdC5kYXRlLm5vcm1hbGl6ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICBpZiAobm9ybURhdGUudmFsdWUgJiYgbm9ybURhdGUubGFuZyA9PSBcImVuXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNwb3VzZS5tYXJyaWFnZURhdGUgPSBub3JtRGF0ZS52YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoZmFjdC5wbGFjZSkge1xuICAgICAgICAgICAgICAgICAgaWYgKGZhY3QucGxhY2Uub3JpZ2luYWwpIHtcbiAgICAgICAgICAgICAgICAgICAgc3BvdXNlLm1hcnJpYWdlUGxhY2VPcmlnaW5hbCA9IGZhY3QucGxhY2Uub3JpZ2luYWw7XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICBpZiAoZmFjdC5wbGFjZS5ub3JtYWxpemVkKSB7XG4gICAgICAgICAgICAgICAgICAgIGZvciAobGV0IG5vcm1QbGFjZSBvZiBmYWN0LnBsYWNlLm5vcm1hbGl6ZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICBpZiAobm9ybVBsYWNlLnZhbHVlICYmIG5vcm1QbGFjZS5sYW5nID09IFwiZW5cIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgc3BvdXNlLm1hcnJpYWdlUGxhY2UgPSBub3JtUGxhY2UudmFsdWU7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG5cbiAgICAgICAgICBpZiAoIXJlc3VsdC5zcG91c2VzKSB7XG4gICAgICAgICAgICByZXN1bHQuc3BvdXNlcyA9IFtdO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXN1bHQuc3BvdXNlcy5wdXNoKHNwb3VzZSk7XG4gICAgICAgIH0gZWxzZSBpZiAodHlwZSA9PSBcImh0dHA6Ly9nZWRjb214Lm9yZy9QYXJlbnRDaGlsZFwiKSB7XG4gICAgICAgICAgaWYgKHJlbGF0aW9uc2hpcC5wZXJzb24yLnJlc291cmNlSWQgPT0gcGVyc29uSWQpIHtcbiAgICAgICAgICAgIC8vIHRoaXMgcGVyc29uIGlzIHRoZSBjaGlsZFxuICAgICAgICAgICAgYWRkUGFyZW50RnJvbVBlcnNvbihvdGhlclBlcnNvbiwgcmVzdWx0KTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICByZXN1bHQucGFnZVR5cGUgPSBcInBlcnNvblwiO1xuICByZXR1cm4gcmVzdWx0O1xufVxuXG5mdW5jdGlvbiBleHRyYWN0RGF0YUZyb21GZXRjaChkb2N1bWVudCwgZGF0YU9iaiwgZmV0Y2hUeXBlLCBvcHRpb25zKSB7XG5cbiAgICBjb25zb2xlLmxvZyhcImVudGVyIGZzLmV4dHJhY3REYXRhRnJvbUZldGNoLCBmZXRjaFR5cGU9XCIgKyBmZXRjaFR5cGUpXG4gICAgY29uc29sZS5sb2coZGF0YU9iaik7XG5cbiAgdXNlZExhYmVsSWRzID0ge307XG5cbiAgbGV0IHJlc3VsdCA9IHt9O1xuXG4gIGlmIChkb2N1bWVudCkge1xuICAgIHJlc3VsdC51cmwgPSBkb2N1bWVudC5VUkw7XG4gIH1cblxuICBpZiAoZmV0Y2hUeXBlID09IFwicGVyc29uXCIpIHtcbiAgICByZXR1cm4gZXh0cmFjdFBlcnNvbkRhdGFGcm9tRmV0Y2goZG9jdW1lbnQsIGRhdGFPYmosIG9wdGlvbnMpO1xuICB9XG5cbiAgLy8gdGhlcmUgY291bGQgYmUgbWFueSBwZW9wbGUgaW4gdGhpcyBkYXRhLCB0aGUgZGVzY3JpcHRpb24gaXMgb25lIHdheSB0byBmaW5kIG91dCB3aGljaFxuICAvLyBpcyB0aGUgb25lIHRoYXQgaXMgYmVpbmcgZm9jdXNlZCBvblxuICBsZXQgZGVzY3JpcHRpb24gPSBkYXRhT2JqLmRlc2NyaXB0aW9uO1xuXG4gIGlmICghZGVzY3JpcHRpb24pIHtcbiAgICAvLyB0aGlzIGNvdWxkIGJlIGFuIGltYWdlIHBhZ2Ugd2hpY2ggaXMgbm90IGhhbmRsZWQgY3VycmVudGx5XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIGxldCBwZXJzb25JZCA9IGRlc2NyaXB0aW9uLnJlcGxhY2UoL14uKihwX1xcZCopJC8sIFwiJDFcIik7XG5cbiAgbGV0IHBlcnNvbklkV2l0aFJlbGF0ZWRGYWN0ID0gdW5kZWZpbmVkO1xuICBsZXQgcmVsYXRlZFBlcnNvbkZhY3RUeXBlID0gdW5kZWZpbmVkO1xuXG4gIHJlc3VsdC5yZWNvcmREYXRhID0ge307XG5cbiAgbGV0IHRoaXNQZXJzb25Jc0FQcmluY2lwYWwgPSBmYWxzZTtcblxuICBsZXQgcGVyc29ucyA9IGRhdGFPYmoucGVyc29ucztcbiAgaWYgKHBlcnNvbnMpIHtcbiAgICBmb3IgKGxldCBwZXJzb24gb2YgcGVyc29ucykge1xuICAgICAgaWYgKHBlcnNvbi5pZCA9PSBwZXJzb25JZCkge1xuICAgICAgICAvLyB0aGlzIGlzIHRoZSBwZXJzb24gdGhhdCB0aGUgcGFnZSBpcyBhYm91dFxuICAgICAgICBnZXROYW1lRm9yUGVyc29uT2JqKHBlcnNvbiwgcmVzdWx0KTtcbiAgICAgICAgaWYgKHJlc3VsdC5mdWxsTmFtZSkge1xuICAgICAgICAgIHJlc3VsdC5yZWNvcmREYXRhW1wiTmFtZVwiXSA9IHJlc3VsdC5mdWxsTmFtZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGdldEdlbmRlckZvclBlcnNvbk9iaihwZXJzb24sIHJlc3VsdCk7XG4gICAgICAgIHByb2Nlc3NSZWNvcmREYXRhRmFjdHNGb3JQZXJzb25PYmoocGVyc29uLCByZXN1bHQpO1xuXG4gICAgICAgIC8vIGNoZWNrIHRoZSBmaWVsZHMgYXNzb2NpYXRlZCB3aXRoIHRoaXMgcGVyc29uXG4gICAgICAgIGlmIChwZXJzb24uZmllbGRzKSB7XG4gICAgICAgICAgcHJvY2Vzc0ZpZWxkcyhyZXN1bHQsIHBlcnNvbi5maWVsZHMsIFwicHJpbWFyeVBlcnNvblwiKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKHBlcnNvbi5mYWN0cykge1xuICAgICAgICBmb3IgKGxldCBmYWN0IG9mIHBlcnNvbi5mYWN0cykge1xuICAgICAgICAgIC8vIHRoZSBmYWN0IGNvbnRhaW5zIHRoZSBwbGFjZSBldGNcbiAgICAgICAgICAvLyBpdCBnZXRzIGNvbXBsaWNhdGVkIHdoZW4gdGhlcmUgaXMgbW9yZSB0aGFuIG9uZSBwZXJzb24uXG4gICAgICAgICAgLy8gLnByaW5jaXBhbCBzZWVtcyB0byBiZSB3aGV0aGVyIHRoZXkgYXJlIG9uZSBvZiB0aGUgcGVvcGxlIGJlaW5nIHJlY29yZGVkXG4gICAgICAgICAgLy8gSW4gYSBjZW5zdXMgYWxsIHRoZSBwZW9wbGUgaW4gdGhlIGhvdXNlaG9sZCBhcmUgcHJpbmNpcGFsc1xuICAgICAgICAgIC8vIEluIGEgYmlydGggcmVnaXN0cmF0aW9uIHRoZSBjaGlsZCBpcyBhIHByaW5jaXBhbCBhbmQgdGhlIG1vdGhlciBpcyBub3RcbiAgICAgICAgICBpZiAoZmFjdC50eXBlKSB7XG4gICAgICAgICAgICBsZXQgZmFjdFR5cGUgPSBnZXRGYWN0VHlwZShmYWN0KTtcblxuICAgICAgICAgICAgaWYgKGZhY3QucHJpbWFyeSkge1xuICAgICAgICAgICAgICBzZXRFdmVudERhdGVBbmRQbGFjZUZvckZhY3QocmVzdWx0LCBmYWN0KTtcblxuICAgICAgICAgICAgICBpZiAocGVyc29uLnByaW5jaXBhbCkge1xuICAgICAgICAgICAgICAgIGlmIChwZXJzb24uaWQgPT0gcGVyc29uSWQpIHtcbiAgICAgICAgICAgICAgICAgIHRoaXNQZXJzb25Jc0FQcmluY2lwYWwgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgLy8gZm9yZ2V0IGFueSBvdGhlciBwZXJzb24gd2hvIHdhcyBhIHByaW5jaXBhbFxuICAgICAgICAgICAgICAgICAgcGVyc29uSWRXaXRoUmVsYXRlZEZhY3QgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICAgICAgICByZWxhdGVkUGVyc29uRmFjdFR5cGUgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICghdGhpc1BlcnNvbklzQVByaW5jaXBhbCAmJiAhcGVyc29uSWRXaXRoUmVsYXRlZEZhY3QpIHtcbiAgICAgICAgICAgICAgICAgIC8vIFdlIGhhdmUgYSBmYWN0IHR5cGUgYnV0IGl0IGlzIG5vdCBmb3IgdGhlIHBlcnNvbiBvZiBpbnRlcmVzdFxuICAgICAgICAgICAgICAgICAgLy8gVGhpcyBpcyB0aGUgZmlyc3Qgc3VjaCBjYXNlIHdlIGhhdmUgZm91bmRcbiAgICAgICAgICAgICAgICAgIHJlbGF0ZWRQZXJzb25GYWN0VHlwZSA9IGZhY3RUeXBlO1xuICAgICAgICAgICAgICAgICAgcGVyc29uSWRXaXRoUmVsYXRlZEZhY3QgPSBwZXJzb24uaWQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgbGV0IHJlbGF0aW9uc2hpcHMgPSBkYXRhT2JqLnJlbGF0aW9uc2hpcHM7XG4gIGlmIChyZWxhdGlvbnNoaXBzKSB7XG4gICAgbGV0IHBlcnNvbklkV2l0aFJlbGF0ZWRGYWN0MiA9IHVuZGVmaW5lZDtcbiAgICAvLyBnbyB0aHJvdWdoIHRoZWxpc3Qgb25lIGxvb2tpbmcgZm9yIHJlbGF0aW9uc2hpcHMgd2l0aCBmYWN0c1xuICAgIC8vIHdlIG5lZWQgdG8gZG8gdGhpcyBiZWZvcmUgbG9va2luZyBhdCB0aGUgcmVsYXRpb25zaGlwcyB3aXRoIG5vIGZhY3RzIHNpbmNlIHdlIG5lZWQgdGhlXG4gICAgLy8gZmFjdFR5cGUgdG8gcHJvY2VzcyB0aG9zZS5cbiAgICBmb3IgKGxldCByZWxhdGlvbnNoaXAgb2YgcmVsYXRpb25zaGlwcykge1xuICAgICAgaWYgKHJlbGF0aW9uc2hpcC5mYWN0cykge1xuICAgICAgICBmb3IgKGxldCBmYWN0IG9mIHJlbGF0aW9uc2hpcC5mYWN0cykge1xuICAgICAgICAgIGlmIChmYWN0LnR5cGUgJiYgIXJlc3VsdC5mYWN0VHlwZSkge1xuICAgICAgICAgICAgbGV0IGZhY3RUeXBlID0gZ2V0RmFjdFR5cGUoZmFjdCk7XG5cbiAgICAgICAgICAgIGlmIChmYWN0LnByaW1hcnkpIHtcbiAgICAgICAgICAgICAgc2V0RXZlbnREYXRlQW5kUGxhY2VGb3JGYWN0KHJlc3VsdCwgZmFjdCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIGlmIG9uZSBvZiB0aGUgcGVvcGxlIGluIHRoaXMgZmFjdCBpcyB0aGUgc2VsZWN0ZWQgcGVyc29uXG4gICAgICAgICAgICBpZiAocmVsYXRpb25zaGlwLnBlcnNvbjEucmVzb3VyY2VJZCA9PSBwZXJzb25JZCB8fCByZWxhdGlvbnNoaXAucGVyc29uMi5yZXNvdXJjZUlkID09IHBlcnNvbklkKSB7XG4gICAgICAgICAgICAgIHJlc3VsdC5mYWN0VHlwZSA9IGZhY3RUeXBlO1xuXG4gICAgICAgICAgICAgIC8vIGJ1aWxkIHVwIHJlY29yZCBkYXRhIHRoYXQgY291bGQgYmUgaW5jbHVkZWQgaW4gYSBkYXRhIHRhYmxlXG4gICAgICAgICAgICAgIGFkZFJlY29yZERhdGFGb3JGYWN0KHJlc3VsdCwgZmFjdCwgZmFjdFR5cGUpO1xuXG4gICAgICAgICAgICAgIC8vIGlmIHRoaXMgaXMgYSBtYXJyaWFnZSB0aGVuIGFkZCBhIHNwb3VzZSBpZiBwb3NzaWJsZVxuICAgICAgICAgICAgICBpZiAoZmFjdFR5cGUuc3RhcnRzV2l0aChcIk1hcnJpYWdlXCIpKSB7XG4gICAgICAgICAgICAgICAgbGV0IG90aGVyUGVyc29uSWQgPSByZWxhdGlvbnNoaXAucGVyc29uMi5yZXNvdXJjZUlkO1xuICAgICAgICAgICAgICAgIGlmIChyZWxhdGlvbnNoaXAucGVyc29uMi5yZXNvdXJjZUlkID09IHBlcnNvbklkKSB7XG4gICAgICAgICAgICAgICAgICBvdGhlclBlcnNvbklkID0gcmVsYXRpb25zaGlwLnBlcnNvbjEucmVzb3VyY2VJZDtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBsZXQgb3RoZXJQZXJzb24gPSBmaW5kUGVyc29uQnlJZChkYXRhT2JqLCBvdGhlclBlcnNvbklkKTtcblxuICAgICAgICAgICAgICAgIGlmIChvdGhlclBlcnNvbikge1xuICAgICAgICAgICAgICAgICAgLy8gbG9vayBmb3IgdGhlaXIgbmFtZVxuICAgICAgICAgICAgICAgICAgbGV0IG5hbWVGb3JtID0gZ2V0UHJpbWFyeU5hbWVGb3JtKG90aGVyUGVyc29uKTtcbiAgICAgICAgICAgICAgICAgIGlmIChuYW1lRm9ybSkge1xuICAgICAgICAgICAgICAgICAgICByZXN1bHQuc3BvdXNlRnVsbE5hbWUgPSBuYW1lRm9ybS5mdWxsVGV4dDtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG5hbWVGb3JtLnBhcnRzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgcGFydCBvZiBuYW1lRm9ybS5wYXJ0cykge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHBhcnQudHlwZS5lbmRzV2l0aChcIkdpdmVuXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5zcG91c2VHaXZlbk5hbWUgPSBwYXJ0LnZhbHVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChwYXJ0LnR5cGUuZW5kc1dpdGgoXCJTdXJuYW1lXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5zcG91c2VTdXJuYW1lID0gcGFydC52YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgaWYgKG90aGVyUGVyc29uLmZpZWxkcykge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBwZXJzb25GaWVsZHNNYXAgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgQWdlOiBcInNwb3VzZUFnZVwiLFxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICBleHRyYWN0RmllbGRzKHJlc3VsdCwgb3RoZXJQZXJzb24uZmllbGRzLCBwZXJzb25GaWVsZHNNYXApO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIGlmICghcGVyc29uSWRXaXRoUmVsYXRlZEZhY3QpIHtcbiAgICAgICAgICAgICAgcmVsYXRlZFBlcnNvbkZhY3RUeXBlID0gZmFjdFR5cGU7XG4gICAgICAgICAgICAgIHBlcnNvbklkV2l0aFJlbGF0ZWRGYWN0ID0gcmVsYXRpb25zaGlwLnBlcnNvbjEucmVzb3VyY2VJZDtcbiAgICAgICAgICAgICAgcGVyc29uSWRXaXRoUmVsYXRlZEZhY3QyID0gcmVsYXRpb25zaGlwLnBlcnNvbjIucmVzb3VyY2VJZDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGVsc2UgaWYgKGZhY3QudHlwZSkge1xuICAgICAgICAgICAgLy8gd2UgYWxyZWFkeSBoYXZlIGEgZmFjdFR5cGUgZm9yIHRoZSByZXN1bHQgYW5kIHdlIGhhdmUgZm91bmQgYSBuZXcgZmFjdFxuICAgICAgICAgICAgLy8gSXQgY291bGQgY29udGFpbiB1c2VmdWwgZGF0ZXMgYW5kIHBsYWNlcyBzbyBkb24ndCBpZ25vcmUgaXQuIEZvciBleGFtcGxlOlxuICAgICAgICAgICAgLy8gaHR0cHM6Ly93d3cuZmFtaWx5c2VhcmNoLm9yZy9hcms6LzYxOTAzLzE6MTpRVko4LVNGSDk/ZnJvbT1seW54MVVJVjgmdHJlZXJlZj1MOFBMLUo0TVxuICAgICAgICAgICAgLy8gVGhlIG1haW4gKHByaW1hcnkpIGZhY3QgKE1hcnJpYWdlUmVnaXN0cmF0aW9uKSBoYXMgbm8gZGF0ZS4gQnV0IHRoZXJlIGlzIGEgTWFycmlhZ2VcbiAgICAgICAgICAgIC8vIGZhY3Qgd2l0aCBhIGRhdGUuXG4gICAgICAgICAgICBzZXREYXRlQW5kUGxhY2VGb3JBZGRpdGlvbmFsRmFjdChyZXN1bHQsIGZhY3QpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIC8vIGdvIHRocm91Z2ggdGhlIGxpc3QgYSBzZWNvbmQgdGltZSBsb29raW5nIGZvciByZWxhdGlvbnNoaXBzIHdpdGggbm8gZmFjdHNcbiAgICBmb3IgKGxldCByZWxhdGlvbnNoaXAgb2YgcmVsYXRpb25zaGlwcykge1xuICAgICAgaWYgKCFyZWxhdGlvbnNoaXAuZmFjdHMpIHtcbiAgICAgICAgLy8gcmVsYXRpb25zaGlwIGhhcyBubyBmYWN0LiB0aGlzIHRlbmRzIHRvIGJlIHRoZSBjYXNlIGZvciBhIGJhcHRpc20gb3IgY2hyaXN0ZW5pbmcgYW5kXG4gICAgICAgIC8vIHdlIG5lZWQgdGhlc2UgcmVsYXRpb25zaGlwcyB0byBmaW5kIHRoZSBwYXJlbnRzXG4gICAgICAgIGlmIChcbiAgICAgICAgICByZXN1bHQuZmFjdFR5cGUgPT0gXCJDaHJpc3RlbmluZ1wiIHx8XG4gICAgICAgICAgcmVzdWx0LmZhY3RUeXBlID09IFwiQmFwdGlzbVwiIHx8XG4gICAgICAgICAgcmVzdWx0LmZhY3RUeXBlID09IFwiQmlydGhcIiB8fFxuICAgICAgICAgIHJlc3VsdC5mYWN0VHlwZSA9PSBcIkRlYXRoXCIgfHxcbiAgICAgICAgICByZXN1bHQuZmFjdFR5cGUgPT0gXCJNYXJyaWFnZVwiXG4gICAgICAgICkge1xuICAgICAgICAgIC8vIGlmIG9uZSBvZiB0aGUgcGVvcGxlIGluIHRoaXMgZmFjdCBpcyB0aGUgc2VsZWN0ZWQgcGVyc29uXG4gICAgICAgICAgbGV0IG90aGVyUGVyc29uSWQgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgaWYgKHJlbGF0aW9uc2hpcC5wZXJzb24xLnJlc291cmNlSWQgPT0gcGVyc29uSWQpIHtcbiAgICAgICAgICAgIG90aGVyUGVyc29uSWQgPSByZWxhdGlvbnNoaXAucGVyc29uMi5yZXNvdXJjZUlkO1xuICAgICAgICAgIH0gZWxzZSBpZiAocmVsYXRpb25zaGlwLnBlcnNvbjIucmVzb3VyY2VJZCA9PSBwZXJzb25JZCkge1xuICAgICAgICAgICAgb3RoZXJQZXJzb25JZCA9IHJlbGF0aW9uc2hpcC5wZXJzb24xLnJlc291cmNlSWQ7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChvdGhlclBlcnNvbklkKSB7XG4gICAgICAgICAgICBsZXQgb3RoZXJQZXJzb24gPSBmaW5kUGVyc29uQnlJZChkYXRhT2JqLCBvdGhlclBlcnNvbklkKTtcbiAgICAgICAgICAgIGlmIChvdGhlclBlcnNvbikge1xuICAgICAgICAgICAgICBsZXQgcmVsYXRpb25UeXBlID0gcmVsYXRpb25zaGlwLnR5cGU7XG4gICAgICAgICAgICAgIGlmIChyZWxhdGlvblR5cGUuZW5kc1dpdGgoXCIvUGFyZW50Q2hpbGRcIikpIHtcbiAgICAgICAgICAgICAgICAvLyBvdGhlciBwZXJzb24gaXMgZWl0aGVyIGZhdGhlciBvciBtb3RoZXJcbiAgICAgICAgICAgICAgICBhZGRQYXJlbnRGcm9tUGVyc29uKG90aGVyUGVyc29uLCByZXN1bHQpO1xuICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlbGF0aW9uVHlwZS5lbmRzV2l0aChcIi9Db3VwbGVcIikpIHtcbiAgICAgICAgICAgICAgICAvLyBvdGhlciBwZXJzb24gaXMgc3BvdXNlXG4gICAgICAgICAgICAgICAgLy8gbG9vayBmb3IgdGhlaXIgbmFtZVxuICAgICAgICAgICAgICAgIGxldCBuYW1lRm9ybSA9IGdldFByaW1hcnlOYW1lRm9ybShvdGhlclBlcnNvbik7XG4gICAgICAgICAgICAgICAgaWYgKG5hbWVGb3JtKSB7XG4gICAgICAgICAgICAgICAgICByZXN1bHQuc3BvdXNlRnVsbE5hbWUgPSBuYW1lRm9ybS5mdWxsVGV4dDtcbiAgICAgICAgICAgICAgICAgIGlmIChuYW1lRm9ybS5wYXJ0cykge1xuICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBwYXJ0IG9mIG5hbWVGb3JtLnBhcnRzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgaWYgKHBhcnQudHlwZS5lbmRzV2l0aChcIkdpdmVuXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQuc3BvdXNlR2l2ZW5OYW1lID0gcGFydC52YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHBhcnQudHlwZS5lbmRzV2l0aChcIlN1cm5hbWVcIikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5zcG91c2VTdXJuYW1lID0gcGFydC52YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKG90aGVyUGVyc29uLmZpZWxkcykge1xuICAgICAgICAgICAgICAgICAgY29uc3QgcGVyc29uRmllbGRzTWFwID0ge1xuICAgICAgICAgICAgICAgICAgICBBZ2U6IFwic3BvdXNlQWdlXCIsXG4gICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgZXh0cmFjdEZpZWxkcyhyZXN1bHQsIG90aGVyUGVyc29uLmZpZWxkcywgcGVyc29uRmllbGRzTWFwKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAocmVsYXRlZFBlcnNvbkZhY3RUeXBlKSB7XG4gICAgICAvLyBnbyB0aHJvdWdoIHJlbGF0aW9uc2hpcHMgYWdhaW4gbG9va2luZyBmb3IgdGhlIHJlbGF0aW9uc2hpcFxuICAgICAgLy8gV2UgaGF2ZSB0aHJlZSBwb3NzaWJsZSBwZXJzb24gSURzIHRoYXQgYXJlIHByaW5jaXBhbCB0byB0aGUgZmFjdDpcbiAgICAgIC8vIHBlcnNvbklkV2l0aFJlbGF0ZWRGYWN0ICh1c3VhbGx5IHNldCBmb3IgYSBjaGlsZCBkZWF0aC9iYXB0aXNtLCBvciBjb3VsZCBiZSBicmlkZSBvciBncm9vbSlcbiAgICAgIC8vIHBlcnNvbklkV2l0aFJlbGF0ZWRGYWN0MiAodXN1YWxseSBzZXQgZm9yIGEgY2hpbGQgbWFycmlhZ2UgLSB3aWxsIGJlIGJyaWRlIG9yIGdyb29tKVxuICAgICAgcmVzdWx0LnJlbGF0ZWRQZXJzb25GYWN0VHlwZSA9IHJlbGF0ZWRQZXJzb25GYWN0VHlwZTtcblxuICAgICAgbGV0IG90aGVyUGVyc29uSWQgPSB1bmRlZmluZWQ7XG4gICAgICBmb3IgKGxldCByZWxhdGlvbnNoaXAgb2YgcmVsYXRpb25zaGlwcykge1xuICAgICAgICBsZXQgcmVsYXRpb25UeXBlID0gdW5kZWZpbmVkO1xuICAgICAgICBpZiAocmVsYXRpb25zaGlwLnBlcnNvbjEucmVzb3VyY2VJZCA9PSBwZXJzb25JZCkge1xuICAgICAgICAgIC8vIFRoaXMgcmVsYXRpb25zaGlwIGludm9sdmVzIHRoZSBzZWxlY3RlZCBwZXJzb25cbiAgICAgICAgICBvdGhlclBlcnNvbklkID0gcmVsYXRpb25zaGlwLnBlcnNvbjIucmVzb3VyY2VJZDtcbiAgICAgICAgICBpZiAob3RoZXJQZXJzb25JZCA9PSBwZXJzb25JZFdpdGhSZWxhdGVkRmFjdCB8fCBvdGhlclBlcnNvbklkID09IHBlcnNvbklkV2l0aFJlbGF0ZWRGYWN0Mikge1xuICAgICAgICAgICAgLy8gcGVyc29uIDIgb2YgdGhpcyByZWxhdGlvbnNoaXAgaXMgdGhlIHBlcnNvbiB0aGF0IHRoZSBmYWN0IGlzIGFib3V0IGFuZCBpcyByZWxhdGVkIHRvIG91ciBwZXJzb25cbiAgICAgICAgICAgIHJlbGF0aW9uVHlwZSA9IHJlbGF0aW9uc2hpcC50eXBlO1xuICAgICAgICAgICAgaWYgKHJlbGF0aW9uVHlwZS5lbmRzV2l0aChcIi9QYXJlbnRDaGlsZFwiKSkge1xuICAgICAgICAgICAgICByZXN1bHQucmVsYXRpb25zaGlwVG9GYWN0UGVyc29uID0gXCJQYXJlbnRcIjtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAocmVsYXRpb25UeXBlLmVuZHNXaXRoKFwiL0NvdXBsZVwiKSkge1xuICAgICAgICAgICAgICByZXN1bHQucmVsYXRpb25zaGlwVG9GYWN0UGVyc29uID0gXCJTcG91c2VcIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAocmVsYXRpb25zaGlwLnBlcnNvbjIucmVzb3VyY2VJZCA9PSBwZXJzb25JZCkge1xuICAgICAgICAgIG90aGVyUGVyc29uSWQgPSByZWxhdGlvbnNoaXAucGVyc29uMS5yZXNvdXJjZUlkO1xuICAgICAgICAgIGlmIChvdGhlclBlcnNvbklkID09IHBlcnNvbklkV2l0aFJlbGF0ZWRGYWN0IHx8IG90aGVyUGVyc29uSWQgPT0gcGVyc29uSWRXaXRoUmVsYXRlZEZhY3QyKSB7XG4gICAgICAgICAgICAvLyBwZXJzb24gMSBvZiB0aGlzIHJlbGF0aW9uc2hpcCBpcyB0aGUgcGVyc29uIHRoYXQgdGhlIGZhY3QgaXMgYWJvdXQgYW5kIGlzIHJlbGF0ZWQgdG8gb3VyIHBlcnNvblxuICAgICAgICAgICAgcmVsYXRpb25UeXBlID0gcmVsYXRpb25zaGlwLnR5cGU7XG4gICAgICAgICAgICBpZiAocmVsYXRpb25UeXBlLmVuZHNXaXRoKFwiL1BhcmVudENoaWxkXCIpKSB7XG4gICAgICAgICAgICAgIHJlc3VsdC5yZWxhdGlvbnNoaXBUb0ZhY3RQZXJzb24gPSBcIkNoaWxkXCI7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHJlbGF0aW9uVHlwZS5lbmRzV2l0aChcIi9Db3VwbGVcIikpIHtcbiAgICAgICAgICAgICAgcmVzdWx0LnJlbGF0aW9uc2hpcFRvRmFjdFBlcnNvbiA9IFwiU3BvdXNlXCI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHJlc3VsdC5yZWxhdGlvbnNoaXBUb0ZhY3RQZXJzb24pIHtcbiAgICAgICAgICBsZXQgb3RoZXJQZXJzb24gPSBmaW5kUGVyc29uQnlJZChkYXRhT2JqLCBvdGhlclBlcnNvbklkKTtcblxuICAgICAgICAgIGlmIChvdGhlclBlcnNvbikge1xuICAgICAgICAgICAgLy8gbG9vayBmb3IgdGhlaXIgbmFtZVxuICAgICAgICAgICAgbGV0IG5hbWVGb3JtID0gZ2V0UHJpbWFyeU5hbWVGb3JtKG90aGVyUGVyc29uKTtcbiAgICAgICAgICAgIGlmIChuYW1lRm9ybSkge1xuICAgICAgICAgICAgICByZXN1bHQucmVsYXRlZFBlcnNvbkZ1bGxOYW1lID0gbmFtZUZvcm0uZnVsbFRleHQ7XG4gICAgICAgICAgICAgIGlmIChuYW1lRm9ybS5wYXJ0cykge1xuICAgICAgICAgICAgICAgIGZvciAobGV0IHBhcnQgb2YgbmFtZUZvcm0ucGFydHMpIHtcbiAgICAgICAgICAgICAgICAgIGlmIChwYXJ0LnR5cGUuZW5kc1dpdGgoXCJHaXZlblwiKSkge1xuICAgICAgICAgICAgICAgICAgICByZXN1bHQucmVsYXRlZFBlcnNvbkdpdmVuTmFtZSA9IHBhcnQudmFsdWU7XG4gICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHBhcnQudHlwZS5lbmRzV2l0aChcIlN1cm5hbWVcIikpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnJlbGF0ZWRQZXJzb25TdXJuYW1lID0gcGFydC52YWx1ZTtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gZ2V0IGdlbmRlclxuICAgICAgICAgICAgaWYgKG90aGVyUGVyc29uLmdlbmRlcikge1xuICAgICAgICAgICAgICBpZiAob3RoZXJQZXJzb24uZ2VuZGVyLnR5cGUuZW5kc1dpdGgoXCIvTWFsZVwiKSkge1xuICAgICAgICAgICAgICAgIHJlc3VsdC5yZWxhdGVkUGVyc29uR2VuZGVyID0gXCJtYWxlXCI7XG4gICAgICAgICAgICAgIH0gZWxzZSBpZiAob3RoZXJQZXJzb24uZ2VuZGVyLnR5cGUuZW5kc1dpdGgoXCIvRmVtYWxlXCIpKSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0LnJlbGF0ZWRQZXJzb25HZW5kZXIgPSBcImZlbWFsZVwiO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChyZWxhdGVkUGVyc29uRmFjdFR5cGUgPT0gXCJNYXJyaWFnZVwiKSB7XG4gICAgICAgICAgICAgIGxldCBzcG91c2UgPSB1bmRlZmluZWQ7XG5cbiAgICAgICAgICAgICAgaWYgKG90aGVyUGVyc29uSWQgPT0gcGVyc29uSWRXaXRoUmVsYXRlZEZhY3QgJiYgcGVyc29uSWRXaXRoUmVsYXRlZEZhY3QyKSB7XG4gICAgICAgICAgICAgICAgc3BvdXNlID0gZmluZFBlcnNvbkJ5SWQoZGF0YU9iaiwgcGVyc29uSWRXaXRoUmVsYXRlZEZhY3QyKTtcbiAgICAgICAgICAgICAgfSBlbHNlIGlmIChvdGhlclBlcnNvbklkID09IHBlcnNvbklkV2l0aFJlbGF0ZWRGYWN0MiAmJiBwZXJzb25JZFdpdGhSZWxhdGVkRmFjdCkge1xuICAgICAgICAgICAgICAgIHNwb3VzZSA9IGZpbmRQZXJzb25CeUlkKGRhdGFPYmosIHBlcnNvbklkV2l0aFJlbGF0ZWRGYWN0KTtcbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIGlmIChzcG91c2UpIHtcbiAgICAgICAgICAgICAgICBsZXQgbmFtZUZvcm0gPSBnZXRQcmltYXJ5TmFtZUZvcm0oc3BvdXNlKTtcbiAgICAgICAgICAgICAgICBpZiAobmFtZUZvcm0pIHtcbiAgICAgICAgICAgICAgICAgIHJlc3VsdC5yZWxhdGVkUGVyc29uU3BvdXNlRnVsbE5hbWUgPSBuYW1lRm9ybS5mdWxsVGV4dDtcbiAgICAgICAgICAgICAgICAgIGlmIChuYW1lRm9ybS5wYXJ0cykge1xuICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBwYXJ0IG9mIG5hbWVGb3JtLnBhcnRzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgaWYgKHBhcnQudHlwZS5lbmRzV2l0aChcIkdpdmVuXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQucmVsYXRlZFBlcnNvblNwb3VzZUdpdmVuTmFtZSA9IHBhcnQudmFsdWU7XG4gICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChwYXJ0LnR5cGUuZW5kc1dpdGgoXCJTdXJuYW1lXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQucmVsYXRlZFBlcnNvblNwb3VzZVN1cm5hbWUgPSBwYXJ0LnZhbHVlO1xuICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICBicmVhazsgLy8gd2UgaGF2ZSBmb3VuZCB0aGUgcmVsYXRpb25zaGlwIGFuZCBzZXQgcmVsYXRpb25zaGlwVG9GYWN0UGVyc29uXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvLyBidWlsZCBob3VzZWhvbGQgdGFibGUgZm9yIGNlbnN1c1xuICBpZiAocmVzdWx0LmZhY3RUeXBlID09IFwiQ2Vuc3VzXCIgfHwgKHJlc3VsdC5mYWN0VHlwZSA9PSBcIlJlc2lkZW5jZVwiICYmIHBlcnNvbnMubGVuZ3RoID4gMSkpIHtcbiAgICBsZXQgcGVyc29ucyA9IGRhdGFPYmoucGVyc29ucztcblxuICAgIHJlc3VsdC5ob3VzZWhvbGQgPSB7fTtcbiAgICByZXN1bHQuaG91c2Vob2xkLmhlYWRpbmdzID0gW1xuICAgICAgXCJmdWxsTmFtZVwiLFxuICAgICAgXCJnaXZlbk5hbWVcIixcbiAgICAgIFwic3VybmFtZVwiLFxuICAgICAgXCJyZWxhdGlvbnNoaXBcIixcbiAgICAgIFwibWFyaXRhbFN0YXR1c1wiLFxuICAgICAgXCJnZW5kZXJcIixcbiAgICAgIFwiYWdlXCIsXG4gICAgICBcIm9jY3VwYXRpb25cIixcbiAgICAgIFwiYmlydGhEYXRlT3JpZ2luYWxcIixcbiAgICAgIFwiYmlydGhZZWFyXCIsXG4gICAgICBcImJpcnRoUGxhY2VPcmlnaW5hbFwiLFxuICAgICAgXCJiaXJ0aFBsYWNlXCIsXG4gICAgXTtcbiAgICByZXN1bHQuaG91c2Vob2xkLm1lbWJlcnMgPSBbXTtcblxuICAgIGZvciAobGV0IHBlcnNvbiBvZiBwZXJzb25zKSB7XG4gICAgICBsZXQgbWVtYmVyID0ge307XG5cbiAgICAgIGlmIChwZXJzb24uaWQgPT0gcGVyc29uSWQpIHtcbiAgICAgICAgbWVtYmVyLmlzU2VsZWN0ZWQgPSB0cnVlO1xuICAgICAgfVxuXG4gICAgICAvLyBsb29rIGZvciB0aGVpciBuYW1lXG4gICAgICBpZiAocGVyc29uLm5hbWVzKSB7XG4gICAgICAgIGxldCBuYW1lRm9ybSA9IGdldFByaW1hcnlOYW1lRm9ybShwZXJzb24pO1xuICAgICAgICBpZiAobmFtZUZvcm0pIHtcbiAgICAgICAgICBtZW1iZXIuZnVsbE5hbWUgPSBuYW1lRm9ybS5mdWxsVGV4dDtcbiAgICAgICAgICBpZiAobmFtZUZvcm0ucGFydHMpIHtcbiAgICAgICAgICAgIGZvciAobGV0IHBhcnQgb2YgbmFtZUZvcm0ucGFydHMpIHtcbiAgICAgICAgICAgICAgaWYgKHBhcnQudHlwZS5lbmRzV2l0aChcIkdpdmVuXCIpKSB7XG4gICAgICAgICAgICAgICAgbWVtYmVyLmdpdmVuTmFtZSA9IHBhcnQudmFsdWU7XG4gICAgICAgICAgICAgIH0gZWxzZSBpZiAocGFydC50eXBlLmVuZHNXaXRoKFwiU3VybmFtZVwiKSkge1xuICAgICAgICAgICAgICAgIG1lbWJlci5zdXJuYW1lID0gcGFydC52YWx1ZTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbWVtYmVyLmlzQ2xvc2VkID0gdHJ1ZTtcbiAgICAgIH1cblxuICAgICAgLy8gZ2V0IGdlbmRlclxuICAgICAgaWYgKHBlcnNvbi5nZW5kZXIpIHtcbiAgICAgICAgaWYgKHBlcnNvbi5nZW5kZXIudHlwZS5lbmRzV2l0aChcIi9NYWxlXCIpKSB7XG4gICAgICAgICAgbWVtYmVyLmdlbmRlciA9IFwibWFsZVwiO1xuICAgICAgICB9IGVsc2UgaWYgKHBlcnNvbi5nZW5kZXIudHlwZS5lbmRzV2l0aChcIi9GZW1hbGVcIikpIHtcbiAgICAgICAgICBtZW1iZXIuZ2VuZGVyID0gXCJmZW1hbGVcIjtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyBjaGVjayB0aGUgZmFjdHMgb2YgdGhpcyBwcmltYXJ5IHBlcnNvbiBmb3IgdGhpcyBwZXJzb25zIHZpdGFsc1xuICAgICAgaWYgKHBlcnNvbi5mYWN0cykge1xuICAgICAgICBmb3IgKGxldCBmYWN0IG9mIHBlcnNvbi5mYWN0cykge1xuICAgICAgICAgIGlmIChmYWN0LnR5cGUpIHtcbiAgICAgICAgICAgIGxldCBmYWN0VHlwZSA9IGdldEZhY3RUeXBlKGZhY3QpO1xuXG4gICAgICAgICAgICAvL2NvbnNvbGUubG9nKFwiZmFjdFR5cGUgaXMgXCIgKyBmYWN0VHlwZSk7XG4gICAgICAgICAgICBpZiAoZmFjdFR5cGUgPT0gXCJCaXJ0aFwiKSB7XG4gICAgICAgICAgICAgIC8vY29uc29sZS5sb2coXCJ0eXBlIGlzIGJpcnRoXCIpO1xuICAgICAgICAgICAgICBpZiAoZmFjdC5kYXRlKSB7XG4gICAgICAgICAgICAgICAgaWYgKGZhY3QuZGF0ZS5vcmlnaW5hbCkge1xuICAgICAgICAgICAgICAgICAgbWVtYmVyLmJpcnRoRGF0ZU9yaWdpbmFsID0gZmFjdC5kYXRlLm9yaWdpbmFsO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBzZXRGaWVsZEZyb21EYXRlKGZhY3QuZGF0ZSwgXCIvRGF0ZVwiLCBcIlBSX0JJUl9EQVRFX0VTVFwiLCBtZW1iZXIsIFwiYmlydGhEYXRlXCIpO1xuICAgICAgICAgICAgICAgIHNldEZpZWxkRnJvbURhdGUoZmFjdC5kYXRlLCBcIi9ZZWFyXCIsIFwiUFJfQklSX1lFQVJfRVNUXCIsIG1lbWJlciwgXCJiaXJ0aFllYXJcIik7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgaWYgKGZhY3QucGxhY2UpIHtcbiAgICAgICAgICAgICAgICBpZiAoZmFjdC5wbGFjZS5vcmlnaW5hbCkge1xuICAgICAgICAgICAgICAgICAgbWVtYmVyLmJpcnRoUGxhY2VPcmlnaW5hbCA9IGZhY3QucGxhY2Uub3JpZ2luYWw7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHNldEZpZWxkRnJvbVBsYWNlKGZhY3QucGxhY2UsIFwiXCIsIFwiUFJfQklSX1BMQUNFXCIsIG1lbWJlciwgXCJiaXJ0aFBsYWNlXCIpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGZhY3RUeXBlID09IFwiTWFyaXRhbFN0YXR1c1wiKSB7XG4gICAgICAgICAgICAgIGlmIChmYWN0LnZhbHVlKSB7XG4gICAgICAgICAgICAgICAgbWVtYmVyLm1hcml0YWxTdGF0dXMgPSBmYWN0LnZhbHVlO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGZhY3RUeXBlID09IFwiT2NjdXBhdGlvblwiKSB7XG4gICAgICAgICAgICAgIGlmIChmYWN0LnZhbHVlKSB7XG4gICAgICAgICAgICAgICAgbWVtYmVyLm9jY3VwYXRpb24gPSBmYWN0LnZhbHVlO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGZhY3RUeXBlID09IFwiQWdlXCIpIHtcbiAgICAgICAgICAgICAgaWYgKGZhY3QudmFsdWVzKSB7XG4gICAgICAgICAgICAgICAgZm9yIChsZXQgdmFsdWUgb2YgZmFjdC52YWx1ZXMpIHtcbiAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5sYWJlbElkID09IFwiUFJfQUdFXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgbWVtYmVyLmFnZSA9IHZhbHVlLnRleHQ7XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGZhY3RUeXBlID09IFwiUmVsYXRpb25zaGlwVG9IZWFkXCIpIHtcbiAgICAgICAgICAgICAgaWYgKGZhY3QudmFsdWVzKSB7XG4gICAgICAgICAgICAgICAgZm9yIChsZXQgdmFsdWUgb2YgZmFjdC52YWx1ZXMpIHtcbiAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5sYWJlbElkID09IFwiUFJfUkVMQVRJT05TSElQX1RPX0hFQURfT1JJR1wiKSB7XG4gICAgICAgICAgICAgICAgICAgIG1lbWJlci5yZWxhdGlvbnNoaXAgPSB2YWx1ZS50ZXh0O1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIGlmIChmYWN0VHlwZSA9PSBcIlJlbGF0aW9uc2hpcFRvSGVhZENvZGVcIiAmJiAhbWVtYmVyLnJlbGF0aW9uc2hpcCkge1xuICAgICAgICAgICAgICBpZiAoZmFjdC52YWx1ZXMpIHtcbiAgICAgICAgICAgICAgICBmb3IgKGxldCB2YWx1ZSBvZiBmYWN0LnZhbHVlcykge1xuICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlLmxhYmVsSWQgPT0gXCJQUl9SRUxBVElPTlNISVBfQ09ERVwiKSB7XG4gICAgICAgICAgICAgICAgICAgIG1lbWJlci5yZWxhdGlvbnNoaXAgPSB2YWx1ZS50ZXh0O1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpZiAocGVyc29uLmZpZWxkcykge1xuICAgICAgICBjb25zdCBwZXJzb25GaWVsZHNNYXAgPSB7XG4gICAgICAgICAgQWdlOiBcImFnZVwiLFxuICAgICAgICAgIFJlbGF0aW9uc2hpcFRvSGVhZENvZGU6IFwicmVsYXRpb25zaGlwXCIsXG4gICAgICAgICAgUmVsYXRpb25zaGlwVG9IZWFkOiBcInJlbGF0aW9uc2hpcFwiLFxuICAgICAgICAgIFJlbGF0aW9uc2hpcDogXCJyZWxhdGlvbnNoaXBcIixcbiAgICAgICAgICBTb3VyY2VTaGVldE5icjogXCJzaGVldE51bWJlclwiLFxuICAgICAgICAgIFNvdXJjZUxpbmVOYnI6IFwibGluZU51bWJlclwiLFxuICAgICAgICB9O1xuICAgICAgICBleHRyYWN0RmllbGRzKG1lbWJlciwgcGVyc29uLmZpZWxkcywgcGVyc29uRmllbGRzTWFwKTtcbiAgICAgIH1cblxuICAgICAgcmVzdWx0LmhvdXNlaG9sZC5tZW1iZXJzLnB1c2gobWVtYmVyKTtcbiAgICB9XG5cbiAgICAvLyBUaGUgbWVtYmVycyBjYW4gYmUgaW4gYSBkaWZmZXJlbnQgb3JkZXIgdG8gaG93IHRoZXkgYXBwZWFyIGluIHRoZSBjZW5zdXNcbiAgICAvLyBJIGhhdmUgb25seSBzZWVuIHRoaXMgaW4gdGhlIFVTIDE5NDAgRmVkZXJhbCBDZW5zdXMuIEUuZy4gdXNfY2Vuc3VzXzE5NDBfYWRkaWVfYnVsbG9ja1xuICAgIC8vIGlmIHdlIGhhdmUgbGluZSBudW1iZXJzIHdlIGNhbiByZW9yZGVyIHRoZW1cbiAgICBsZXQgaGFzTGluZU51bWJlcnMgPSB0cnVlO1xuICAgIGZvciAobGV0IG1lbWJlciBvZiByZXN1bHQuaG91c2Vob2xkLm1lbWJlcnMpIHtcbiAgICAgIGlmICghbWVtYmVyLmxpbmVOdW1iZXIpIHtcbiAgICAgICAgaGFzTGluZU51bWJlcnMgPSBmYWxzZTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBpZiAoaXNOYU4oTnVtYmVyKG1lbWJlci5saW5lTnVtYmVyKSkpIHtcbiAgICAgICAgaGFzTGluZU51bWJlcnMgPSBmYWxzZTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuICAgIGxldCBoYXNTaGVldE51bWJlcnMgPSB0cnVlO1xuICAgIGZvciAobGV0IG1lbWJlciBvZiByZXN1bHQuaG91c2Vob2xkLm1lbWJlcnMpIHtcbiAgICAgIGlmICghbWVtYmVyLnNoZWV0TnVtYmVyKSB7XG4gICAgICAgIGhhc1NoZWV0TnVtYmVycyA9IGZhbHNlO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIGlmIChpc05hTihOdW1iZXIobWVtYmVyLnNoZWV0TnVtYmVyKSkpIHtcbiAgICAgICAgaGFzU2hlZXROdW1iZXJzID0gZmFsc2U7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChoYXNMaW5lTnVtYmVycyAmJiBoYXNTaGVldE51bWJlcnMpIHtcbiAgICAgIC8vIHNvcnQgYnkgbGluZSBudW1iZXJcbiAgICAgIHJlc3VsdC5ob3VzZWhvbGQubWVtYmVycy5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7XG4gICAgICAgIGxldCBzaGVldERpZmYgPSBOdW1iZXIoYS5zaGVldE51bWJlcikgLSBOdW1iZXIoYi5zaGVldE51bWJlcik7XG4gICAgICAgIGxldCBsaW5lRGlmZiA9IE51bWJlcihhLmxpbmVOdW1iZXIpIC0gTnVtYmVyKGIubGluZU51bWJlcik7XG4gICAgICAgIGlmIChzaGVldERpZmYgPT09IDApIHtcbiAgICAgICAgICByZXR1cm4gbGluZURpZmY7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHNoZWV0RGlmZjtcbiAgICAgIH0pO1xuICAgIH0gZWxzZSBpZiAoaGFzTGluZU51bWJlcnMpIHtcbiAgICAgIC8vIHNvcnQgYnkgbGluZSBudW1iZXJcbiAgICAgIHJlc3VsdC5ob3VzZWhvbGQubWVtYmVycy5zb3J0KChhLCBiKSA9PiAoTnVtYmVyKGEubGluZU51bWJlcikgPiBOdW1iZXIoYi5saW5lTnVtYmVyKSA/IDEgOiAtMSkpO1xuICAgIH1cblxuICAgIC8vIG5vdyByZW1vdmUgYW55IGxpbmUgbnVtYmVycyBhcyB3ZSBkb24ndCBuZWVkIHRoZW0gaW4gdGhlIGV4dHJhY3RlZCBkYXRhXG4gICAgZm9yIChsZXQgbWVtYmVyIG9mIHJlc3VsdC5ob3VzZWhvbGQubWVtYmVycykge1xuICAgICAgZGVsZXRlIG1lbWJlci5saW5lTnVtYmVyO1xuICAgICAgZGVsZXRlIG1lbWJlci5zaGVldE51bWJlcjtcbiAgICB9XG4gIH1cblxuICBwcm9jZXNzRmllbGRzKHJlc3VsdCwgZGF0YU9iai5maWVsZHMsIFwidG9wTGV2ZWxcIik7XG5cbiAgaWYgKGRhdGFPYmouc291cmNlRGVzY3JpcHRpb25zKSB7XG4gICAgZm9yIChsZXQgc291cmNlIG9mIGRhdGFPYmouc291cmNlRGVzY3JpcHRpb25zKSB7XG4gICAgICAvLyB0aGVyZSBhcmUgZGlmZmVyZW50IHNvdXJjZSBkZXNjcmlwdGlvbnMgZm9yIGRpZmZlcmVudCBwZW9wbGUgb3IgcmVjb3Jkc1xuICAgICAgaWYgKHNvdXJjZS5pZCAmJiBzb3VyY2UuaWQuZW5kc1dpdGgocGVyc29uSWQpKSB7XG4gICAgICAgIGlmIChzb3VyY2UuY2l0YXRpb25zICYmIHNvdXJjZS5jaXRhdGlvbnMubGVuZ3RoID4gMCkge1xuICAgICAgICAgIHJlc3VsdC5jaXRhdGlvbiA9IHNvdXJjZS5jaXRhdGlvbnNbMF0udmFsdWUudHJpbSgpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChzb3VyY2UudGl0bGVzICYmIHNvdXJjZS50aXRsZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgIHJlc3VsdC5zb3VyY2VUaXRsZUZvclBlcnNvbiA9IHNvdXJjZS50aXRsZXNbMF0udmFsdWU7XG4gICAgICAgIH1cbiAgICAgICAgcmVzdWx0LnBlcnNvblJlY29yZFVybCA9IHNvdXJjZS5hYm91dDtcbiAgICAgIH1cblxuICAgICAgaWYgKHNvdXJjZS5yZXNvdXJjZVR5cGUpIHtcbiAgICAgICAgaWYgKHNvdXJjZS5yZXNvdXJjZVR5cGUuZW5kc1dpdGgoXCJDb2xsZWN0aW9uXCIpKSB7XG4gICAgICAgICAgaWYgKHNvdXJjZS50aXRsZXMgJiYgc291cmNlLnRpdGxlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICByZXN1bHQuY29sbGVjdGlvblRpdGxlID0gc291cmNlLnRpdGxlc1swXS52YWx1ZTtcbiAgICAgICAgICB9XG4gICAgICAgICAgLy8gVGhlIFVTIDE5NTAgY2Vuc3VzIGRvZXNuJ3QgaGF2ZSB0aGUgY29sbGVjdGlvbiBJZCBpbiB0aGUgbm9ybWFsIHBsYWNlXG4gICAgICAgICAgaWYgKCFyZXN1bHQuZnNDb2xsZWN0aW9uSWQpIHtcbiAgICAgICAgICAgIGlmIChzb3VyY2UuYWJvdXQgJiYgc291cmNlLmFib3V0LmluZGV4T2YoXCIvcmVjb3Jkcy9jb2xsZWN0aW9ucy9cIikgIT0gLTEpIHtcbiAgICAgICAgICAgICAgbGV0IGNvbGxlY3Rpb25JZCA9IHNvdXJjZS5hYm91dC5yZXBsYWNlKC9eLipcXC9yZWNvcmRzXFwvY29sbGVjdGlvbnNcXC8oXFxkKykkLywgXCIkMVwiKTtcbiAgICAgICAgICAgICAgaWYgKGNvbGxlY3Rpb25JZCAmJiBjb2xsZWN0aW9uSWQgIT0gc291cmNlLmFib3V0KSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0LmZzQ29sbGVjdGlvbklkID0gY29sbGVjdGlvbklkO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmICghcmVzdWx0LmZzQ29sbGVjdGlvbklkKSB7XG4gICAgICAgICAgICAvLyBleGFtcGxlOlxuICAgICAgICAgICAgLy8gICAgICAgXCJodHRwOi8vZ2VkY29teC5vcmcvUHJpbWFyeVwiIDogWyBcImh0dHBzOi8vYXBpLmZhbWlseXNlYXJjaC5vcmcvcGxhdGZvcm0vcmVjb3Jkcy9jb2xsZWN0aW9ucy80NDY0NTE1XCIgXVxuICAgICAgICAgICAgaWYgKHNvdXJjZS5pZGVudGlmaWVycyAmJiBzb3VyY2UuaWRlbnRpZmllcnNbXCJodHRwOi8vZ2VkY29teC5vcmcvUHJpbWFyeVwiXSkge1xuICAgICAgICAgICAgICBsZXQgaWRBcnJheSA9IHNvdXJjZS5pZGVudGlmaWVyc1tcImh0dHA6Ly9nZWRjb214Lm9yZy9QcmltYXJ5XCJdO1xuICAgICAgICAgICAgICBpZiAoaWRBcnJheS5sZW5ndGggPiAwICYmIGlkQXJyYXlbMF0pIHtcbiAgICAgICAgICAgICAgICBsZXQgY29sbGVjdGlvbklkID0gaWRBcnJheVswXS5yZXBsYWNlKC9eLipcXC9yZWNvcmRzXFwvY29sbGVjdGlvbnNcXC8oXFxkKykkLywgXCIkMVwiKTtcbiAgICAgICAgICAgICAgICBpZiAoY29sbGVjdGlvbklkICYmIGNvbGxlY3Rpb25JZCAhPSBpZEFycmF5WzBdKSB7XG4gICAgICAgICAgICAgICAgICByZXN1bHQuZnNDb2xsZWN0aW9uSWQgPSBjb2xsZWN0aW9uSWQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHNvdXJjZS5yZXNvdXJjZVR5cGUuZW5kc1dpdGgoXCJSZWNvcmRcIikpIHtcbiAgICAgICAgICByZXN1bHQucmVjb3JkVXJsID0gc291cmNlLmFib3V0O1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHNvdXJjZS5yZXNvdXJjZVR5cGUuZW5kc1dpdGgoXCJEaWdpdGFsQXJ0aWZhY3RcIikgJiYgIXJlc3VsdC5kaWdpdGFsQXJ0aWZhY3QpIHtcbiAgICAgICAgICAvLyBkaWdpdGFsQXJ0aWZhY3QgcHJvcGVydHkgd2lsbCBnZXQgZGVsZXRlZCBsYXRlciBpbiBwcm9jZXNzSW1hZ2VMaW5rcyBpbiBhbGwgYnV0IHJhcmUgY2FzZXNcbiAgICAgICAgICAvLyBUaGVyZSBjYW4gYmUgbXVsdGlwbGUgZGlnaXRhbEFyY3RpZmFjdCBzb3VyY2VzLCB3ZSBqdXN0IHVzZSB0aGUgZmlyc3QgZm9yIG5vd1xuICAgICAgICAgIC8vIEFuIGV4YW1wbGUgaXMgYSBjZW5zdXMgKHNlZSBlbmdsYW5kX2NlbnN1c18xOTExX3BldGVyX2RlbGFtb3R0ZSksIHRoZXJlIGNhbiBiZSBhbiBpbWFnZSBsaW5rXG4gICAgICAgICAgLy8gdG8gdGhlIHNhbWUgaW1hZ2UgZm9yIGVhY2ggaG91c2hvbGQgbWVtYmVyLCBub3Qgb2J2aW91cyBob3cgdG8gZmluZCB0aGUgb25lIGZvciB0aGUgcHJpbWFyeSBwZXJzb25cbiAgICAgICAgICByZXN1bHQuZGlnaXRhbEFydGlmYWN0ID0gc291cmNlLmFib3V0O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcHJvY2Vzc0ltYWdlTGlua3MoZG9jdW1lbnQsIHJlc3VsdCwgb3B0aW9ucyk7XG5cbiAgcmVzdWx0LnBhZ2VUeXBlID0gXCJyZWNvcmRcIjtcblxuICAvL2NvbnNvbGUubG9nKFwiZXh0cmFjdERhdGFGcm9tRmV0Y2ggcmVzdWx0IGlzOlwiKTtcbiAgLy9jb25zb2xlLmxvZyhyZXN1bHQpO1xuXG4gIHJldHVybiByZXN1bHQ7XG59XG5cbmV4cG9ydCB7IGV4dHJhY3REYXRhLCBleHRyYWN0RGF0YUZyb21GZXRjaCB9O1xuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./extension/site/fs/core/fs_extract_data.mjs\n");

/***/ }),

/***/ "./extension/site/fs/core/fs_generalize_data.mjs":
/*!*******************************************************!*\
  !*** ./extension/site/fs/core/fs_generalize_data.mjs ***!
  \*******************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"GeneralizedData\": () => (/* reexport safe */ _base_core_generalize_data_utils_mjs__WEBPACK_IMPORTED_MODULE_0__.GeneralizedData),\n/* harmony export */   \"dateQualifiers\": () => (/* reexport safe */ _base_core_generalize_data_utils_mjs__WEBPACK_IMPORTED_MODULE_0__.dateQualifiers),\n/* harmony export */   \"generalizeData\": () => (/* binding */ generalizeData),\n/* harmony export */   \"generalizeDataGivenRecordType\": () => (/* binding */ generalizeDataGivenRecordType)\n/* harmony export */ });\n/* harmony import */ var _base_core_generalize_data_utils_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../base/core/generalize_data_utils.mjs */ \"./extension/base/core/generalize_data_utils.mjs\");\n/* harmony import */ var _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../../base/core/record_type.mjs */ \"./extension/base/core/record_type.mjs\");\n/* harmony import */ var _base_core_wts_string_mjs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../../base/core/wts_string.mjs */ \"./extension/base/core/wts_string.mjs\");\n/*\nMIT License\n\nCopyright (c) 2020 Robert M Pavey\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.\n*/\n\n\n\n\n\nconst factTypeToRecordType = [\n  {\n    type: undefined,\n    defaultRT: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_1__.RT.Unclassified,\n  },\n  {\n    type: \"Birth\",\n    defaultRT: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_1__.RT.Birth,\n    titleMatches: [\n      {\n        recordType: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_1__.RT.BirthRegistration,\n        matches: [\"England and Wales Birth Registration Index\", \"New Zealand, Civil Records Indexes\"],\n      },\n    ],\n    recordDataMatches: [\n      { recordType: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_1__.RT.BirthRegistration, matches: [\"Registration Number\"] },\n      {\n        recordType: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_1__.RT.BirthRegistration,\n        matches: [\"Baptism Date\", \"Christening Date\"],\n      },\n    ],\n  },\n  {\n    type: \"Death\",\n    defaultRT: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_1__.RT.Death,\n    titleMatches: [\n      {\n        title: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_1__.RT.DeathRegistration,\n        matches: [\"England and Wales Death Registration Index\"],\n      },\n    ],\n  },\n  {\n    type: \"BirthRegistration\",\n    defaultRT: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_1__.RT.BirthRegistration,\n  },\n  {\n    type: \"MarriageRegistration\",\n    defaultRT: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_1__.RT.MarriageRegistration,\n  },\n  {\n    type: \"DeathRegistration\",\n    defaultRT: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_1__.RT.DeathRegistration,\n  },\n  {\n    type: \"Marriage\",\n    defaultRT: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_1__.RT.Marriage,\n    titleMatches: [\n      {\n        recordType: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_1__.RT.MarriageRegistration,\n        matches: [\"England and Wales Marriage Registration Index\"],\n      },\n    ],\n  },\n  {\n    type: \"MarriageNotice\",\n    defaultRT: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_1__.RT.Marriage,\n  },\n  {\n    type: \"MarriageLicense\",\n    defaultRT: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_1__.RT.Marriage,\n  },\n  {\n    type: \"MarriageBanns\",\n    defaultRT: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_1__.RT.Marriage,\n  },\n  {\n    type: \"Divorce\",\n    defaultRT: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_1__.RT.Divorce,\n  },\n  {\n    type: \"Census\",\n    defaultRT: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_1__.RT.Census,\n  },\n  {\n    type: \"Residence\",\n    defaultRT: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_1__.RT.Residence,\n    titleMatches: [\n      { recordType: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_1__.RT.LandTax, matches: [\"Land Tax\"] },\n      { recordType: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_1__.RT.SchoolRecords, matches: [\"School Records\"] },\n      { recordType: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_1__.RT.Census, matches: [\"Census\"] },\n    ],\n  },\n  {\n    type: \"EducationEnrollment\",\n    defaultRT: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_1__.RT.SchoolRecords,\n  },\n  {\n    type: \"Baptism\",\n    defaultRT: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_1__.RT.Baptism,\n  },\n  {\n    type: \"Christening\",\n    defaultRT: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_1__.RT.Baptism,\n  },\n  {\n    type: \"Burial\",\n    defaultRT: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_1__.RT.Burial,\n  },\n  {\n    type: \"Probate\",\n    defaultRT: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_1__.RT.Probate,\n  },\n  {\n    type: \"Obituary\",\n    defaultRT: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_1__.RT.Obituary,\n  },\n  {\n    type: \"Immigration\",\n    defaultRT: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_1__.RT.Immigration,\n    titleMatches: [{ recordType: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_1__.RT.PassengerList, matches: [\"Passenger List\"] }],\n  },\n  {\n    type: \"MilitaryService\",\n    defaultRT: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_1__.RT.Military,\n  },\n  {\n    type: \"MilitaryDraftRegistration\",\n    defaultRT: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_1__.RT.Military,\n  },\n  {\n    type: \"VoterRegistration\",\n    defaultRT: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_1__.RT.ElectoralRegister,\n    titleMatches: [{ recordType: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_1__.RT.ElectoralRegister, matches: [\"Electoral Register\"] }],\n  },\n  {\n    type: \"TaxAssessment\",\n    defaultRT: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_1__.RT.Tax,\n  },\n  {\n    type: \"Pension\",\n    defaultRT: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_1__.RT.Pension,\n  },\n  {\n    type: \"PassportApplication\",\n    defaultRT: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_1__.RT.PassportApplication,\n  },\n];\n\nconst sourceRecordTypeToRecordType = [\n  {\n    type: undefined,\n    defaultRT: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_1__.RT.Unclassified,\n  },\n  {\n    type: \"Marriages\",\n    defaultRT: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_1__.RT.Marriage,\n  },\n];\n\nfunction determineRecordType(extractedData) {\n  const titleMatches = [{ type: _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_1__.RT.Census, matches: [\"Census\"] }];\n\n  //console.log(\"in determineRecordType, factType is\");\n  //console.log(extractedData.factType);\n\n  function lookup(factType, collectionTitle, recordData, table) {\n    for (let obj of table) {\n      if (factType == obj.type) {\n        if (obj.titleMatches && collectionTitle) {\n          for (let titleMatch of obj.titleMatches) {\n            for (let match of titleMatch.matches) {\n              if (collectionTitle.includes(match)) {\n                let recordType = titleMatch.recordType;\n                return recordType;\n              }\n            }\n          }\n        }\n        if (recordData && obj.recordDataMatches) {\n          for (let recordDataMatch of obj.recordDataMatches) {\n            for (let match of recordDataMatch.matches) {\n              if (recordData.hasOwnProperty(match)) {\n                let recordType = recordDataMatch.recordType;\n                return recordType;\n              }\n            }\n          }\n        }\n        let recordType = obj.defaultRT;\n        if (recordType) {\n          return recordType;\n        }\n      }\n    }\n  }\n\n  let sourceTitle = extractedData.sourceTitleForPerson;\n  let recordData = extractedData.recordData;\n\n  // If there is a relatedPersonFactType that implies that it is\n  // the fact type of the primary fact\n  if (extractedData.relatedPersonFactType) {\n    let recordType = lookup(extractedData.relatedPersonFactType, sourceTitle, recordData, factTypeToRecordType);\n    if (recordType != undefined) {\n      return recordType;\n    }\n  }\n\n  if (extractedData.factType) {\n    let recordType = lookup(extractedData.factType, sourceTitle, recordData, factTypeToRecordType);\n    if (recordType != undefined) {\n      return recordType;\n    }\n  }\n\n  if (recordData && recordData[\"Source Record Type\"]) {\n    let sourceRecordType = recordData[\"Source Record Type\"];\n    let recordType = lookup(sourceRecordType, sourceTitle, recordData, sourceRecordTypeToRecordType);\n    if (recordType != undefined) {\n      return recordType;\n    }\n  }\n\n  if (sourceTitle) {\n    for (let titleMatch of titleMatches) {\n      for (let match of titleMatch.matches) {\n        if (sourceTitle.includes(match)) {\n          return titleMatch.type;\n        }\n      }\n    }\n\n    // check for birth or death registration\n    if (sourceTitle.includes(\"Registration\")) {\n      if (sourceTitle.includes(\"Birth\")) {\n        return _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_1__.RT.BirthRegistration;\n      }\n      if (sourceTitle.includes(\"Death\")) {\n        return _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_1__.RT.DeathRegistration;\n      }\n    }\n\n    // check for a marriage\n    if (sourceTitle.includes(\"Marriage\") && extractedData.recordData && extractedData.recordData[\"Marriage Date\"]) {\n      return _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_1__.RT.Marriage;\n    }\n\n    if (sourceTitle.includes(\"Criminal Register\")) {\n      return _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_1__.RT.CriminalRegister;\n    }\n\n    if (sourceTitle.includes(\"Freemason Membership\")) {\n      return _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_1__.RT.FreemasonMembership;\n    }\n  }\n\n  return _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_1__.RT.Unclassified;\n}\n\nfunction determineRecordTypeAndRole(extractedData, result) {\n  let recordType = determineRecordType(extractedData);\n\n  if (extractedData.relatedPersonFactType) {\n    if (extractedData.relationshipToFactPerson) {\n      if (extractedData.relationshipToFactPerson == \"Parent\") {\n        result.role = _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_1__.Role.Parent;\n      } else if (extractedData.relationshipToFactPerson == \"Child\") {\n        result.role = _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_1__.Role.Child;\n      } else if (extractedData.relationshipToFactPerson == \"Spouse\") {\n        result.role = _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_1__.Role.Spouse;\n      }\n      if (extractedData.relatedPersonFullName) {\n        result.primaryPerson = extractedData.relatedPersonFullName;\n      }\n      if (extractedData.relatedPersonGender) {\n        result.primaryPersonGender = extractedData.relatedPersonGender;\n      }\n    }\n  }\n\n  result.recordType = recordType;\n}\n\nfunction cleanOccupation(text) {\n  let newText = text;\n  if (text && /^[^a-z]+$/.test(text)) {\n    // there are no lowercase characters\n    newText = _base_core_wts_string_mjs__WEBPACK_IMPORTED_MODULE_2__.WTS_String.toInitialCapsEachWord(text);\n  }\n  return newText;\n}\n\nfunction setFieldIfDefined(targetObject, fieldName, value) {\n  if (typeof value !== \"undefined\") {\n    targetObject[fieldName] = value;\n  }\n}\n\nconst quarterNames = [\n  {\n    name: \"Jan-Feb-Mar\",\n    value: 1,\n  },\n  {\n    name: \"Apr-May-Jun\",\n    value: 2,\n  },\n  {\n    name: \"Jul-Aug-Sep\",\n    value: 3,\n  },\n  {\n    name: \"Oct-Nov-Dec\",\n    value: 4,\n  },\n];\n\nfunction selectDate(dateString, originalDateString) {\n  if (!dateString) {\n    return originalDateString;\n  }\n  if (!originalDateString) {\n    return dateString;\n  }\n\n  // sometimes date come through in like this:\n  // Birth Date: 11081921\n  // Birth Date\t(Original): 08 Nov 1921\n  // Example is US SS Death Index for 2004\n  if (/\\d\\d\\d\\d\\d\\d\\d\\d/.test(dateString)) {\n    return originalDateString;\n  }\n\n  // sometimes date come through in like this:\n  // Death Date: 05/24/1974\n  // Birth Date\t(Original): 24 May 1974\n  // Example is US CA Death Index\n  if (/\\d?\\d\\/\\d?\\d\\/\\d\\d\\d\\d/.test(dateString)) {\n    return originalDateString;\n  }\n\n  // sometimes date come through in like this:\n  // \"birthDateOriginal\": \"1 Nov 1854\",\n  // \"birthDate\": \"1 11 1854\",\n  // Example is https://www.familysearch.org/ark:/61903/1:1:XBQC-X9Q\n  if (/\\d?\\d\\s+\\d?\\d\\s+\\d\\d\\d\\d/.test(dateString)) {\n    return originalDateString;\n  }\n\n  // sometimes dateString is just a year and originalDateString is the full date\n  if (dateString.length < 6 && originalDateString.length > dateString.length) {\n    return originalDateString;\n  }\n\n  return dateString;\n}\n\nfunction selectPlace(placeString, originalPlaceString) {\n  // sometimes there is no place but there is an original place\n  if (!placeString) {\n    return originalPlaceString;\n  }\n\n  // Sometimes FS puts things in that are not WikiTree approved\n  placeString = placeString.replace(/\\,? *British Colonial America/, \"\");\n\n  return placeString;\n}\n\nfunction generalizeDataGivenRecordType(data, result) {\n  if (data.age) {\n    if (data.age != \"999\") {\n      let age = data.age.replace(/^0*(\\d)/, \"$1\"); // remove leading zeroes (but not a single zero on its own)\n      // occasionally the age has extra text. e.g. \"7 years\"\n      if (age && age.length > 1) {\n        if (age.search(/[^\\d]/) != -1) {\n          age = age.replace(/\\s*years\\s*$/i, \"\");\n        }\n      }\n      if (result.recordType == _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_1__.RT.DeathRegistration || result.recordType == _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_1__.RT.Death) {\n        result.ageAtDeath = age;\n      } else {\n        result.ageAtEvent = age;\n      }\n    }\n  }\n\n  if (data.recordData && data.recordData[\"Occupation\"]) {\n    let occupation = cleanOccupation(data.recordData[\"Occupation\"]);\n    if (occupation) {\n      result.occupation = occupation;\n    }\n  }\n\n  if (\n    result.recordType == _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_1__.RT.Baptism ||\n    result.recordType == _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_1__.RT.Birth ||\n    result.recordType == _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_1__.RT.BirthRegistration ||\n    result.recordType == _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_1__.RT.BirthOrBaptism ||\n    result.recordType == _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_1__.RT.Death ||\n    result.recordType == _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_1__.RT.DeathRegistration\n  ) {\n    if (result.role != _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_1__.Role.Parent) {\n      if (data.father) {\n        let father = result.addFather();\n        setFieldIfDefined(father.name, \"name\", data.father.fullName);\n        setFieldIfDefined(father.name, \"forenames\", data.father.givenName);\n        setFieldIfDefined(father.name, \"lastName\", data.father.surname);\n        setFieldIfDefined(father.name, \"prefix\", data.father.prefix);\n        setFieldIfDefined(father.name, \"suffix\", data.father.suffix);\n      }\n      if (data.mother) {\n        let mother = result.addMother();\n        setFieldIfDefined(mother.name, \"name\", data.mother.fullName);\n        setFieldIfDefined(mother.name, \"forenames\", data.mother.givenName);\n        setFieldIfDefined(mother.name, \"lastName\", data.mother.surname);\n        setFieldIfDefined(mother.name, \"prefix\", data.mother.prefix);\n        setFieldIfDefined(mother.name, \"suffix\", data.mother.suffix);\n      }\n\n      // spouse can be specified on a death record for example\n      if (data.spouseFullName || data.spouseSurname || data.spouseGivenName) {\n        result.spouses = [];\n        let resultSpouse = {};\n        resultSpouse.name = new _base_core_generalize_data_utils_mjs__WEBPACK_IMPORTED_MODULE_0__.WtsName();\n\n        if (data.spouseFullName) {\n          resultSpouse.name.name = data.spouseFullName;\n        }\n        if (data.spouseSurname) {\n          resultSpouse.name.lastName = data.spouseSurname;\n        }\n        if (data.spouseGivenName) {\n          resultSpouse.name.forenames = data.spouseGivenName;\n        }\n        if (data.spousePrefix) {\n          resultSpouse.name.prefix = data.spousePrefix;\n        }\n        if (data.spouseSuffix) {\n          resultSpouse.name.suffix = data.spouseSuffix;\n        }\n        if (data.spouseAge) {\n          resultSpouse.age = data.spouseAge;\n        }\n        result.spouses.push(resultSpouse);\n      }\n    }\n  } else if (result.recordType == _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_1__.RT.Marriage) {\n    result.spouses = [];\n    let resultSpouse = {};\n\n    if (result.role != _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_1__.Role.Parent) {\n      if (data.father) {\n        let father = result.addFather();\n        setFieldIfDefined(father.name, \"name\", data.father.fullName);\n        setFieldIfDefined(father.name, \"forenames\", data.father.givenName);\n        setFieldIfDefined(father.name, \"lastName\", data.father.surname);\n        setFieldIfDefined(father.name, \"prefix\", data.father.prefix);\n        setFieldIfDefined(father.name, \"suffix\", data.father.suffix);\n      }\n      if (data.mother) {\n        let mother = result.addMother();\n        setFieldIfDefined(mother.name, \"name\", data.mother.fullName);\n        setFieldIfDefined(mother.name, \"forenames\", data.mother.givenName);\n        setFieldIfDefined(mother.name, \"lastName\", data.mother.surname);\n        setFieldIfDefined(mother.name, \"prefix\", data.mother.prefix);\n        setFieldIfDefined(mother.name, \"suffix\", data.mother.suffix);\n      }\n    }\n\n    if (data.spouseFullName || data.spouseSurname || data.spouseGivenName) {\n      resultSpouse.name = new _base_core_generalize_data_utils_mjs__WEBPACK_IMPORTED_MODULE_0__.WtsName();\n\n      if (data.spouseFullName) {\n        resultSpouse.name.name = data.spouseFullName;\n      }\n      if (data.spouseSurname) {\n        resultSpouse.name.lastName = data.spouseSurname;\n      }\n      if (data.spouseGivenName) {\n        resultSpouse.name.forenames = data.spouseGivenName;\n      }\n      if (data.spousePrefix) {\n        resultSpouse.name.prefix = data.spousePrefix;\n      }\n      if (data.spouseSuffix) {\n        resultSpouse.name.suffix = data.spouseSuffix;\n      }\n      if (data.spouseAge) {\n        resultSpouse.age = data.spouseAge;\n      }\n    } else if (\n      data.relatedPersonSpouseFullName ||\n      data.relatedPersonSpouseSurname ||\n      data.relatedPersonSpouseGivenName\n    ) {\n      resultSpouse.name = new _base_core_generalize_data_utils_mjs__WEBPACK_IMPORTED_MODULE_0__.WtsName();\n      if (data.relatedPersonSpouseFullName) {\n        resultSpouse.name.name = data.relatedPersonSpouseFullName;\n      }\n      if (data.relatedPersonSpouseSurname) {\n        resultSpouse.name.lastName = data.relatedPersonSpouseSurname;\n      }\n      if (data.relatedPersonSpouseGivenName) {\n        resultSpouse.name.forenames = data.relatedPersonSpouseGivenName;\n      }\n    }\n    if (result.eventDate) {\n      resultSpouse.marriageDate = result.eventDate;\n    }\n    if (result.eventPlace) {\n      resultSpouse.marriagePlace = result.eventPlace;\n    }\n\n    // the marriage record can contain an actual marriage date as well as the event date\n    // If so it is probably more accurate\n    if (\n      data.recordData[\"Marriage Date\"] ||\n      data.recordData[\"Marriage Date (Original)\"] ||\n      data.recordData[\"Marriage Year\"]\n    ) {\n      let marriageDate = new _base_core_generalize_data_utils_mjs__WEBPACK_IMPORTED_MODULE_0__.WtsDate();\n      let dateString = selectDate(data.recordData[\"Marriage Date\"], data.recordData[\"Marriage Date (Original)\"]);\n      if (dateString) {\n        marriageDate.dateString = dateString;\n      }\n      if (data.recordData[\"Marriage Year\"]) {\n        marriageDate.yearString = data.recordData[\"Marriage Year\"];\n      }\n      resultSpouse.marriageDate = marriageDate;\n      result.marriageDate = marriageDate.getDateString();\n    }\n\n    result.spouses.push(resultSpouse);\n  } else if (result.recordType == _base_core_record_type_mjs__WEBPACK_IMPORTED_MODULE_1__.RT.MarriageRegistration) {\n    result.spouses = [];\n    let resultSpouse = {};\n\n    if (data.spouseFullName || data.spouseSurname || data.spouseGivenName) {\n      resultSpouse.name = new _base_core_generalize_data_utils_mjs__WEBPACK_IMPORTED_MODULE_0__.WtsName();\n\n      let spouseFullName = data.spouseFullName;\n      if (spouseFullName == data.spouseSurname) {\n        // there could be more info in record data\n        let recordData = data.recordData;\n        if (recordData) {\n          if (recordData[\"Other On Page Name1\"] && !recordData[\"Other On Page Name2\"]) {\n            if (recordData[\"Other On Page Name Surn1\"] == data.spouseSurname) {\n              spouseFullName = recordData[\"Other On Page Name1\"];\n            } else if (recordData[\"Other On Page Name1\"].endsWith(data.spouseSurname)) {\n              spouseFullName = recordData[\"Other On Page Name1\"];\n            }\n          }\n        }\n      }\n\n      if (spouseFullName) {\n        resultSpouse.name.name = spouseFullName;\n      }\n      if (data.spouseSurname) {\n        resultSpouse.name.lastName = data.spouseSurname;\n      }\n      if (data.spouseGivenName) {\n        resultSpouse.name.forenames = data.spouseGivenName;\n      }\n      if (data.spousePrefix) {\n        resultSpouse.name.prefix = data.spousePrefix;\n      }\n      if (data.spouseSuffix) {\n        resultSpouse.name.suffix = data.spouseSuffix;\n      }\n      if (data.spouseAge) {\n        resultSpouse.age = data.spouseAge;\n      }\n    }\n    if (result.eventDate) {\n      resultSpouse.marriageDate = result.eventDate;\n    }\n    if (result.eventPlace) {\n      resultSpouse.marriagePlace = result.eventPlace;\n    }\n\n    // the marriage registration can contain an actual marriage date\n    if (\n      data.recordData[\"Marriage Date\"] ||\n      data.recordData[\"Marriage Date (Original)\"] ||\n      data.recordData[\"Marriage Year\"]\n    ) {\n      let marriageDate = new _base_core_generalize_data_utils_mjs__WEBPACK_IMPORTED_MODULE_0__.WtsDate();\n      let dateString = selectDate(data.recordData[\"Marriage Date\"], data.recordData[\"Marriage Date (Original)\"]);\n      if (dateString) {\n        marriageDate.dateString = dateString;\n      }\n      if (data.recordData[\"Marriage Year\"]) {\n        marriageDate.yearString = data.recordData[\"Marriage Year\"];\n      }\n      resultSpouse.marriageDate = marriageDate;\n      result.marriageDate = marriageDate.getDateString();\n    }\n\n    result.spouses.push(resultSpouse);\n  }\n\n  if (data.household) {\n    let headings = data.household.headings;\n    let members = data.household.members;\n    if (headings && members) {\n      result.householdArrayFields = [];\n      let fieldsEncountered = {};\n\n      let householdArray = [];\n      for (let member of members) {\n        let householdMember = {};\n        if (member.isClosed) {\n          householdMember.isClosed = true;\n        } else {\n          let name = member.fullName;\n          if (name) {\n            householdMember.name = name;\n            fieldsEncountered.name = true;\n          }\n          let relationship = member.relationship;\n          if (relationship && relationship != \"Unknown\") {\n            householdMember.relationship = _base_core_generalize_data_utils_mjs__WEBPACK_IMPORTED_MODULE_0__.GD.standardizeRelationshipToHead(relationship);\n            fieldsEncountered.relationship = true;\n          }\n          let maritalStatus = _base_core_generalize_data_utils_mjs__WEBPACK_IMPORTED_MODULE_0__.GD.standardizeMaritalStatus(member.maritalStatus);\n          if (maritalStatus) {\n            householdMember.maritalStatus = maritalStatus;\n            fieldsEncountered.maritalStatus = true;\n          }\n          let gender = member.gender;\n          if (gender && gender != \"Unknown\") {\n            householdMember.gender = _base_core_generalize_data_utils_mjs__WEBPACK_IMPORTED_MODULE_0__.GD.standardizeGender(gender);\n            fieldsEncountered.gender = true;\n          }\n          let age = member.age;\n          if (age && age != \"Unknown\" && age != \"999\") {\n            householdMember.age = age;\n            fieldsEncountered.age = true;\n          }\n          let birthYear = member.birthYear;\n          if (birthYear && birthYear != \"Unknown\") {\n            householdMember.birthYear = birthYear;\n            fieldsEncountered.birthYear = true;\n          }\n          let birthDate = member.birthDate;\n          if (birthDate && birthDate != \"Unknown\" && birthDate != birthYear) {\n            householdMember.birthDate = birthDate;\n            fieldsEncountered.birthDate = true;\n          }\n\n          let occupation = cleanOccupation(member.occupation);\n          if (occupation && occupation != \"Unknown\") {\n            householdMember.occupation = occupation;\n            fieldsEncountered.occupation = true;\n          }\n          let birthPlace = member.birthPlace;\n          if (!birthPlace) {\n            birthPlace = member.birthPlaceOriginal;\n          }\n          if (birthPlace && birthPlace != \"Unknown\") {\n            householdMember.birthPlace = birthPlace;\n            fieldsEncountered.birthPlace = true;\n          }\n          let isSelected = member[\"isSelected\"];\n          if (isSelected) {\n            householdMember.isSelected = isSelected;\n          }\n        }\n        householdArray.push(householdMember);\n      }\n      result.householdArray = householdArray;\n\n      let possibleHouseholdArrayFields = [\n        \"name\",\n        \"relationship\",\n        \"maritalStatus\",\n        \"gender\",\n        \"age\",\n        \"birthYear\",\n        \"occupation\",\n        \"birthPlace\",\n      ];\n\n      let householdArrayFields = [];\n      for (let field of possibleHouseholdArrayFields) {\n        if (fieldsEncountered[field]) {\n          householdArrayFields.push(field);\n        }\n      }\n      result.householdArrayFields = householdArrayFields;\n    }\n  }\n}\n\nfunction generalizeDataForPerson(data, result) {\n  function setName(dataObject, resultObject) {\n    if (dataObject.fullName) {\n      resultObject.name.name = dataObject.fullName;\n    }\n    if (dataObject.surname) {\n      resultObject.name.lastName = dataObject.surname;\n    }\n    if (dataObject.givenName) {\n      resultObject.name.forenames = dataObject.givenName;\n    }\n    if (dataObject.prefix) {\n      resultObject.name.prefix = dataObject.prefix;\n    }\n    if (dataObject.suffix) {\n      resultObject.name.suffix = dataObject.suffix;\n    }\n  }\n\n  // we will already have set fullName but try to get the fornames and last names\n  setName(data, result);\n\n  if (data.spouses) {\n    result.spouses = [];\n\n    for (let spouse of data.spouses) {\n      let resultSpouse = {};\n\n      if (spouse.fullName || spouse.surname || spouse.givenName) {\n        resultSpouse.name = new _base_core_generalize_data_utils_mjs__WEBPACK_IMPORTED_MODULE_0__.WtsName();\n        setName(spouse, resultSpouse);\n      }\n\n      if (spouse.marriageDate || spouse.marriageDateOriginal) {\n        resultSpouse.marriageDate = new _base_core_generalize_data_utils_mjs__WEBPACK_IMPORTED_MODULE_0__.WtsDate();\n        resultSpouse.marriageDate.dateString = selectDate(spouse.marriageDate, spouse.marriageDateOriginal);\n      }\n\n      if (spouse.marriagePlace || spouse.marriagePlaceOriginal) {\n        resultSpouse.marriagePlace = new _base_core_generalize_data_utils_mjs__WEBPACK_IMPORTED_MODULE_0__.WtsPlace();\n        resultSpouse.marriagePlace.placeString = selectPlace(spouse.marriagePlace, spouse.marriagePlaceOriginal);\n      }\n\n      result.spouses.push(resultSpouse);\n    }\n  }\n\n  if (data.father) {\n    let father = result.addFather();\n    setName(data.father, father);\n  }\n\n  if (data.mother) {\n    let mother = result.addMother();\n    setName(data.mother, mother);\n  }\n}\n\n// This function generalizes the data extracted from a FamilySearch page.\n// We know what fields can be there. And we know the ones we want in generalizedData.\nfunction generalizeData(input) {\n  let data = input.extractedData;\n\n  let result = new _base_core_generalize_data_utils_mjs__WEBPACK_IMPORTED_MODULE_0__.GeneralizedData();\n\n  if (data.pageType == \"person\") {\n    result.sourceType = \"profile\";\n  } else {\n    result.sourceType = \"record\";\n    determineRecordTypeAndRole(data, result);\n  }\n\n  result.sourceOfData = \"fs\";\n\n  result.setPersonGender(data.gender);\n\n  result.setFullName(data.fullName);\n\n  let birthDate = selectDate(data.birthDate, data.birthDateOriginal);\n  result.setBirthDate(birthDate);\n  result.setBirthYear(data.birthYear);\n  let birthPlace = selectPlace(data.birthPlace, data.birthPlaceOriginal);\n  result.setBirthPlace(birthPlace);\n\n  let deathDate = selectDate(data.deathDate, data.deathDateOriginal);\n  result.setDeathDate(deathDate);\n  result.setDeathYear(data.deathYear);\n\n  let deathPlace = selectPlace(data.deathPlace, data.deathPlaceOriginal);\n  result.setDeathPlace(deathPlace);\n\n  let eventDate = selectDate(data.eventDate, data.eventDateOriginal);\n  result.setEventDate(eventDate);\n  result.setEventYear(data.eventYear);\n\n  let eventPlace = selectPlace(data.eventPlace, data.eventPlaceOriginal);\n\n  if (!eventPlace) {\n    // sometimes the event place info is in other fields\n    eventPlace = \"\";\n    if (data.eventCity) {\n      eventPlace += data.eventCity;\n    }\n    if (data.eventCounty) {\n      if (eventPlace) {\n        eventPlace += \", \";\n      }\n      eventPlace += data.eventCounty;\n    }\n    if (data.eventState) {\n      if (eventPlace) {\n        eventPlace += \", \";\n      }\n      eventPlace += data.eventState;\n    }\n    if (data.eventCountry) {\n      if (eventPlace) {\n        eventPlace += \", \";\n      }\n      eventPlace += data.eventCountry;\n    }\n  }\n\n  result.setEventPlace(eventPlace);\n\n  let residencePlace = data.residence;\n  if (!residencePlace && data.recordData && data.recordData[\"Note Res Place\"]) {\n    // sometimes this is a field that is not on the residence fact\n    residencePlace = data.recordData[\"Note Res Place\"];\n  }\n  if (residencePlace && result.eventPlace) {\n    // at least in 1841 census this is the stree address\n    result.eventPlace.streetAddress = residencePlace;\n  }\n\n  if (result.eventPlace) {\n    // there is an event place. But sometimes this isn't really the event place\n    // For example for US SS Death Index it is the last residence place\n    if (data.collectionTitle == \"United States Social Security Death Index\") {\n      result.residencePlace = result.eventPlace;\n      delete result.eventPlace;\n    }\n  }\n\n  if (data.registrationDistrict) {\n    result.registrationDistrict = data.registrationDistrict;\n  }\n\n  if (data.registrationQuarter) {\n    let quarter = -1;\n    let fsQuarter = data.registrationQuarter;\n    for (let quarterName of quarterNames) {\n      if (fsQuarter == quarterName.name) {\n        quarter = quarterName.value;\n        break;\n      }\n    }\n    if (quarter != -1) {\n      result.setEventQuarter(quarter);\n    }\n  }\n\n  if (data.pageType == \"person\") {\n    generalizeDataForPerson(data, result);\n  } else {\n    generalizeDataGivenRecordType(data, result);\n  }\n\n  if (data.household && data.household.members) {\n    let selectedMember = undefined;\n    for (let member of data.household.members) {\n      if (member.isSelected) {\n        selectedMember = member;\n        break;\n      }\n    }\n\n    if (selectedMember) {\n      result.setMaritalStatus(selectedMember.maritalStatus);\n      result.setRelationshipToHead(selectedMember.relationship);\n    }\n  }\n\n  if (!result.maritalStatus && data.recordData) {\n    result.setMaritalStatus(data.recordData[\"MaritalStatus\"]);\n  }\n\n  if (data.household && data.household.members) {\n    // We can also determine parents and spouse in some cases\n    result.addSpouseOrParentsForSelectedHouseholdMember();\n\n    if (result.spouses && result.spouses.length == 1) {\n      let yearsMarried = data.recordData[\"Cnt Years Married\"];\n      if (yearsMarried) {\n        let censusDate = result.inferEventDate();\n        let marriageDateString = _base_core_generalize_data_utils_mjs__WEBPACK_IMPORTED_MODULE_0__.GeneralizedData.getSubtractAgeFromDate(censusDate, yearsMarried);\n        let marriageYear = _base_core_wts_string_mjs__WEBPACK_IMPORTED_MODULE_2__.WTS_String.getLastWord(marriageDateString);\n        if (marriageYear) {\n          result.spouses[0].marriageDate.yearString = marriageYear;\n        }\n      }\n    }\n  }\n\n  // Collection\n  if (data.fsCollectionId) {\n    result.collectionData = {\n      id: data.fsCollectionId,\n    };\n\n    if (data.referenceData) {\n      let refData = data.referenceData;\n      if (refData.sourceVolume) {\n        result.collectionData.volume = refData.sourceVolume;\n      }\n\n      if (refData.sourcePageNbr) {\n        result.collectionData.page = refData.sourcePageNbr;\n      }\n\n      if (refData.sourceScheduleType) {\n        result.collectionData.schedule = refData.sourceScheduleType;\n      }\n\n      if (refData.sourcePieceFolio) {\n        let pf = refData.sourcePieceFolio;\n        let slashIndex = pf.indexOf(\"/\");\n        if (slashIndex != -1) {\n          result.collectionData.piece = pf.substring(0, slashIndex).trim();\n          result.collectionData.folio = pf.substring(slashIndex + 1).trim();\n        } else {\n          result.collectionData.folio = pf;\n        }\n      }\n    }\n  }\n\n  result.hasValidData = true;\n\n  //console.log(\"End of FamilySearch generalizeData, result is:\");\n  //console.log(result);\n\n  return result;\n}\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9leHRlbnNpb24vc2l0ZS9mcy9jb3JlL2ZzX2dlbmVyYWxpemVfZGF0YS5tanMuanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7OztBQUFBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFTc0Q7QUFDUTtBQUNDOztBQUUvRDtBQUNBO0FBQ0E7QUFDQSxlQUFlLHVFQUFlO0FBQzlCLEdBQUc7QUFDSDtBQUNBO0FBQ0EsZUFBZSxnRUFBUTtBQUN2QjtBQUNBO0FBQ0Esb0JBQW9CLDRFQUFvQjtBQUN4QztBQUNBLE9BQU87QUFDUDtBQUNBO0FBQ0EsUUFBUSxZQUFZLDRFQUFvQixvQ0FBb0M7QUFDNUU7QUFDQSxvQkFBb0IsNEVBQW9CO0FBQ3hDO0FBQ0EsT0FBTztBQUNQO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQSxlQUFlLGdFQUFRO0FBQ3ZCO0FBQ0E7QUFDQSxlQUFlLDRFQUFvQjtBQUNuQztBQUNBLE9BQU87QUFDUDtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0EsZUFBZSw0RUFBb0I7QUFDbkMsR0FBRztBQUNIO0FBQ0E7QUFDQSxlQUFlLCtFQUF1QjtBQUN0QyxHQUFHO0FBQ0g7QUFDQTtBQUNBLGVBQWUsNEVBQW9CO0FBQ25DLEdBQUc7QUFDSDtBQUNBO0FBQ0EsZUFBZSxtRUFBVztBQUMxQjtBQUNBO0FBQ0Esb0JBQW9CLCtFQUF1QjtBQUMzQztBQUNBLE9BQU87QUFDUDtBQUNBLEdBQUc7QUFDSDtBQUNBO0FBQ0EsZUFBZSxtRUFBVztBQUMxQixHQUFHO0FBQ0g7QUFDQTtBQUNBLGVBQWUsbUVBQVc7QUFDMUIsR0FBRztBQUNIO0FBQ0E7QUFDQSxlQUFlLG1FQUFXO0FBQzFCLEdBQUc7QUFDSDtBQUNBO0FBQ0EsZUFBZSxrRUFBVTtBQUN6QixHQUFHO0FBQ0g7QUFDQTtBQUNBLGVBQWUsaUVBQVM7QUFDeEIsR0FBRztBQUNIO0FB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Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLElBQUk7QUFDSjtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUNBQWlDLHdHQUFzQztBQUN2RSwyQkFBMkIsNkVBQXNCO0FBQ2pEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVO0FBQ1Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRTBGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vQ2l0YXRpb25FeHRyYWN0b3IvLi9leHRlbnNpb24vc2l0ZS9mcy9jb3JlL2ZzX2dlbmVyYWxpemVfZGF0YS5tanM/NGY2ZCJdLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuTUlUIExpY2Vuc2VcblxuQ29weXJpZ2h0IChjKSAyMDIwIFJvYmVydCBNIFBhdmV5XG5cblBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHlcbm9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlIFwiU29mdHdhcmVcIiksIHRvIGRlYWxcbmluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHNcbnRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGxcbmNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQgcGVyc29ucyB0byB3aG9tIHRoZSBTb2Z0d2FyZSBpc1xuZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczpcblxuVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW4gYWxsXG5jb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLlxuXG5USEUgU09GVFdBUkUgSVMgUFJPVklERUQgXCJBUyBJU1wiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SXG5JTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSxcbkZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRVxuQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUlxuTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSxcbk9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4gVEhFXG5TT0ZUV0FSRS5cbiovXG5cbmltcG9ydCB7XG4gIEdlbmVyYWxpemVkRGF0YSxcbiAgR0QsXG4gIGRhdGVRdWFsaWZpZXJzLFxuICBXdHNOYW1lLFxuICBXdHNEYXRlLFxuICBXdHNQbGFjZSxcbn0gZnJvbSBcIi4uLy4uLy4uL2Jhc2UvY29yZS9nZW5lcmFsaXplX2RhdGFfdXRpbHMubWpzXCI7XG5pbXBvcnQgeyBSVCwgUm9sZSB9IGZyb20gXCIuLi8uLi8uLi9iYXNlL2NvcmUvcmVjb3JkX3R5cGUubWpzXCI7XG5pbXBvcnQgeyBXVFNfU3RyaW5nIH0gZnJvbSBcIi4uLy4uLy4uL2Jhc2UvY29yZS93dHNfc3RyaW5nLm1qc1wiO1xuXG5jb25zdCBmYWN0VHlwZVRvUmVjb3JkVHlwZSA9IFtcbiAge1xuICAgIHR5cGU6IHVuZGVmaW5lZCxcbiAgICBkZWZhdWx0UlQ6IFJULlVuY2xhc3NpZmllZCxcbiAgfSxcbiAge1xuICAgIHR5cGU6IFwiQmlydGhcIixcbiAgICBkZWZhdWx0UlQ6IFJULkJpcnRoLFxuICAgIHRpdGxlTWF0Y2hlczogW1xuICAgICAge1xuICAgICAgICByZWNvcmRUeXBlOiBSVC5CaXJ0aFJlZ2lzdHJhdGlvbixcbiAgICAgICAgbWF0Y2hlczogW1wiRW5nbGFuZCBhbmQgV2FsZXMgQmlydGggUmVnaXN0cmF0aW9uIEluZGV4XCIsIFwiTmV3IFplYWxhbmQsIENpdmlsIFJlY29yZHMgSW5kZXhlc1wiXSxcbiAgICAgIH0sXG4gICAgXSxcbiAgICByZWNvcmREYXRhTWF0Y2hlczogW1xuICAgICAgeyByZWNvcmRUeXBlOiBSVC5CaXJ0aFJlZ2lzdHJhdGlvbiwgbWF0Y2hlczogW1wiUmVnaXN0cmF0aW9uIE51bWJlclwiXSB9LFxuICAgICAge1xuICAgICAgICByZWNvcmRUeXBlOiBSVC5CaXJ0aFJlZ2lzdHJhdGlvbixcbiAgICAgICAgbWF0Y2hlczogW1wiQmFwdGlzbSBEYXRlXCIsIFwiQ2hyaXN0ZW5pbmcgRGF0ZVwiXSxcbiAgICAgIH0sXG4gICAgXSxcbiAgfSxcbiAge1xuICAgIHR5cGU6IFwiRGVhdGhcIixcbiAgICBkZWZhdWx0UlQ6IFJULkRlYXRoLFxuICAgIHRpdGxlTWF0Y2hlczogW1xuICAgICAge1xuICAgICAgICB0aXRsZTogUlQuRGVhdGhSZWdpc3RyYXRpb24sXG4gICAgICAgIG1hdGNoZXM6IFtcIkVuZ2xhbmQgYW5kIFdhbGVzIERlYXRoIFJlZ2lzdHJhdGlvbiBJbmRleFwiXSxcbiAgICAgIH0sXG4gICAgXSxcbiAgfSxcbiAge1xuICAgIHR5cGU6IFwiQmlydGhSZWdpc3RyYXRpb25cIixcbiAgICBkZWZhdWx0UlQ6IFJULkJpcnRoUmVnaXN0cmF0aW9uLFxuICB9LFxuICB7XG4gICAgdHlwZTogXCJNYXJyaWFnZVJlZ2lzdHJhdGlvblwiLFxuICAgIGRlZmF1bHRSVDogUlQuTWFycmlhZ2VSZWdpc3RyYXRpb24sXG4gIH0sXG4gIHtcbiAgICB0eXBlOiBcIkRlYXRoUmVnaXN0cmF0aW9uXCIsXG4gICAgZGVmYXVsdFJUOiBSVC5EZWF0aFJlZ2lzdHJhdGlvbixcbiAgfSxcbiAge1xuICAgIHR5cGU6IFwiTWFycmlhZ2VcIixcbiAgICBkZWZhdWx0UlQ6IFJULk1hcnJpYWdlLFxuICAgIHRpdGxlTWF0Y2hlczogW1xuICAgICAge1xuICAgICAgICByZWNvcmRUeXBlOiBSVC5NYXJyaWFnZVJlZ2lzdHJhdGlvbixcbiAgICAgICAgbWF0Y2hlczogW1wiRW5nbGFuZCBhbmQgV2FsZXMgTWFycmlhZ2UgUmVnaXN0cmF0aW9uIEluZGV4XCJdLFxuICAgICAgfSxcbiAgICBdLFxuICB9LFxuICB7XG4gICAgdHlwZTogXCJNYXJyaWFnZU5vdGljZVwiLFxuICAgIGRlZmF1bHRSVDogUlQuTWFycmlhZ2UsXG4gIH0sXG4gIHtcbiAgICB0eXBlOiBcIk1hcnJpYWdlTGljZW5zZVwiLFxuICAgIGRlZmF1bHRSVDogUlQuTWFycmlhZ2UsXG4gIH0sXG4gIHtcbiAgICB0eXBlOiBcIk1hcnJpYWdlQmFubnNcIixcbiAgICBkZWZhdWx0UlQ6IFJULk1hcnJpYWdlLFxuICB9LFxuICB7XG4gICAgdHlwZTogXCJEaXZvcmNlXCIsXG4gICAgZGVmYXVsdFJUOiBSVC5EaXZvcmNlLFxuICB9LFxuICB7XG4gICAgdHlwZTogXCJDZW5zdXNcIixcbiAgICBkZWZhdWx0UlQ6IFJULkNlbnN1cyxcbiAgfSxcbiAge1xuICAgIHR5cGU6IFwiUmVzaWRlbmNlXCIsXG4gICAgZGVmYXVsdFJUOiBSVC5SZXNpZGVuY2UsXG4gICAgdGl0bGVNYXRjaGVzOiBbXG4gICAgICB7IHJlY29yZFR5cGU6IFJULkxhbmRUYXgsIG1hdGNoZXM6IFtcIkxhbmQgVGF4XCJdIH0sXG4gICAgICB7IHJlY29yZFR5cGU6IFJULlNjaG9vbFJlY29yZHMsIG1hdGNoZXM6IFtcIlNjaG9vbCBSZWNvcmRzXCJdIH0sXG4gICAgICB7IHJlY29yZFR5cGU6IFJULkNlbnN1cywgbWF0Y2hlczogW1wiQ2Vuc3VzXCJdIH0sXG4gICAgXSxcbiAgfSxcbiAge1xuICAgIHR5cGU6IFwiRWR1Y2F0aW9uRW5yb2xsbWVudFwiLFxuICAgIGRlZmF1bHRSVDogUlQuU2Nob29sUmVjb3JkcyxcbiAgfSxcbiAge1xuICAgIHR5cGU6IFwiQmFwdGlzbVwiLFxuICAgIGRlZmF1bHRSVDogUlQuQmFwdGlzbSxcbiAgfSxcbiAge1xuICAgIHR5cGU6IFwiQ2hyaXN0ZW5pbmdcIixcbiAgICBkZWZhdWx0UlQ6IFJULkJhcHRpc20sXG4gIH0sXG4gIHtcbiAgICB0eXBlOiBcIkJ1cmlhbFwiLFxuICAgIGRlZmF1bHRSVDogUlQuQnVyaWFsLFxuICB9LFxuICB7XG4gICAgdHlwZTogXCJQcm9iYXRlXCIsXG4gICAgZGVmYXVsdFJUOiBSVC5Qcm9iYXRlLFxuICB9LFxuICB7XG4gICAgdHlwZTogXCJPYml0dWFyeVwiLFxuICAgIGRlZmF1bHRSVDogUlQuT2JpdHVhcnksXG4gIH0sXG4gIHtcbiAgICB0eXBlOiBcIkltbWlncmF0aW9uXCIsXG4gICAgZGVmYXVsdFJUOiBSVC5JbW1pZ3JhdGlvbixcbiAgICB0aXRsZU1hdGNoZXM6IFt7IHJlY29yZFR5cGU6IFJULlBhc3Nlbmdlckxpc3QsIG1hdGNoZXM6IFtcIlBhc3NlbmdlciBMaXN0XCJdIH1dLFxuICB9LFxuICB7XG4gICAgdHlwZTogXCJNaWxpdGFyeVNlcnZpY2VcIixcbiAgICBkZWZhdWx0UlQ6IFJULk1pbGl0YXJ5LFxuICB9LFxuICB7XG4gICAgdHlwZTogXCJNaWxpdGFyeURyYWZ0UmVnaXN0cmF0aW9uXCIsXG4gICAgZGVmYXVsdFJUOiBSVC5NaWxpdGFyeSxcbiAgfSxcbiAge1xuICAgIHR5cGU6IFwiVm90ZXJSZWdpc3RyYXRpb25cIixcbiAgICBkZWZhdWx0UlQ6IFJULkVsZWN0b3JhbFJlZ2lzdGVyLFxuICAgIHRpdGxlTWF0Y2hlczogW3sgcmVjb3JkVHlwZTogUlQuRWxlY3RvcmFsUmVnaXN0ZXIsIG1hdGNoZXM6IFtcIkVsZWN0b3JhbCBSZWdpc3RlclwiXSB9XSxcbiAgfSxcbiAge1xuICAgIHR5cGU6IFwiVGF4QXNzZXNzbWVudFwiLFxuICAgIGRlZmF1bHRSVDogUlQuVGF4LFxuICB9LFxuICB7XG4gICAgdHlwZTogXCJQZW5zaW9uXCIsXG4gICAgZGVmYXVsdFJUOiBSVC5QZW5zaW9uLFxuICB9LFxuICB7XG4gICAgdHlwZTogXCJQYXNzcG9ydEFwcGxpY2F0aW9uXCIsXG4gICAgZGVmYXVsdFJUOiBSVC5QYXNzcG9ydEFwcGxpY2F0aW9uLFxuICB9LFxuXTtcblxuY29uc3Qgc291cmNlUmVjb3JkVHlwZVRvUmVjb3JkVHlwZSA9IFtcbiAge1xuICAgIHR5cGU6IHVuZGVmaW5lZCxcbiAgICBkZWZhdWx0UlQ6IFJULlVuY2xhc3NpZmllZCxcbiAgfSxcbiAge1xuICAgIHR5cGU6IFwiTWFycmlhZ2VzXCIsXG4gICAgZGVmYXVsdFJUOiBSVC5NYXJyaWFnZSxcbiAgfSxcbl07XG5cbmZ1bmN0aW9uIGRldGVybWluZVJlY29yZFR5cGUoZXh0cmFjdGVkRGF0YSkge1xuICBjb25zdCB0aXRsZU1hdGNoZXMgPSBbeyB0eXBlOiBSVC5DZW5zdXMsIG1hdGNoZXM6IFtcIkNlbnN1c1wiXSB9XTtcblxuICAvL2NvbnNvbGUubG9nKFwiaW4gZGV0ZXJtaW5lUmVjb3JkVHlwZSwgZmFjdFR5cGUgaXNcIik7XG4gIC8vY29uc29sZS5sb2coZXh0cmFjdGVkRGF0YS5mYWN0VHlwZSk7XG5cbiAgZnVuY3Rpb24gbG9va3VwKGZhY3RUeXBlLCBjb2xsZWN0aW9uVGl0bGUsIHJlY29yZERhdGEsIHRhYmxlKSB7XG4gICAgZm9yIChsZXQgb2JqIG9mIHRhYmxlKSB7XG4gICAgICBpZiAoZmFjdFR5cGUgPT0gb2JqLnR5cGUpIHtcbiAgICAgICAgaWYgKG9iai50aXRsZU1hdGNoZXMgJiYgY29sbGVjdGlvblRpdGxlKSB7XG4gICAgICAgICAgZm9yIChsZXQgdGl0bGVNYXRjaCBvZiBvYmoudGl0bGVNYXRjaGVzKSB7XG4gICAgICAgICAgICBmb3IgKGxldCBtYXRjaCBvZiB0aXRsZU1hdGNoLm1hdGNoZXMpIHtcbiAgICAgICAgICAgICAgaWYgKGNvbGxlY3Rpb25UaXRsZS5pbmNsdWRlcyhtYXRjaCkpIHtcbiAgICAgICAgICAgICAgICBsZXQgcmVjb3JkVHlwZSA9IHRpdGxlTWF0Y2gucmVjb3JkVHlwZTtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVjb3JkVHlwZTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAocmVjb3JkRGF0YSAmJiBvYmoucmVjb3JkRGF0YU1hdGNoZXMpIHtcbiAgICAgICAgICBmb3IgKGxldCByZWNvcmREYXRhTWF0Y2ggb2Ygb2JqLnJlY29yZERhdGFNYXRjaGVzKSB7XG4gICAgICAgICAgICBmb3IgKGxldCBtYXRjaCBvZiByZWNvcmREYXRhTWF0Y2gubWF0Y2hlcykge1xuICAgICAgICAgICAgICBpZiAocmVjb3JkRGF0YS5oYXNPd25Qcm9wZXJ0eShtYXRjaCkpIHtcbiAgICAgICAgICAgICAgICBsZXQgcmVjb3JkVHlwZSA9IHJlY29yZERhdGFNYXRjaC5yZWNvcmRUeXBlO1xuICAgICAgICAgICAgICAgIHJldHVybiByZWNvcmRUeXBlO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGxldCByZWNvcmRUeXBlID0gb2JqLmRlZmF1bHRSVDtcbiAgICAgICAgaWYgKHJlY29yZFR5cGUpIHtcbiAgICAgICAgICByZXR1cm4gcmVjb3JkVHlwZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGxldCBzb3VyY2VUaXRsZSA9IGV4dHJhY3RlZERhdGEuc291cmNlVGl0bGVGb3JQZXJzb247XG4gIGxldCByZWNvcmREYXRhID0gZXh0cmFjdGVkRGF0YS5yZWNvcmREYXRhO1xuXG4gIC8vIElmIHRoZXJlIGlzIGEgcmVsYXRlZFBlcnNvbkZhY3RUeXBlIHRoYXQgaW1wbGllcyB0aGF0IGl0IGlzXG4gIC8vIHRoZSBmYWN0IHR5cGUgb2YgdGhlIHByaW1hcnkgZmFjdFxuICBpZiAoZXh0cmFjdGVkRGF0YS5yZWxhdGVkUGVyc29uRmFjdFR5cGUpIHtcbiAgICBsZXQgcmVjb3JkVHlwZSA9IGxvb2t1cChleHRyYWN0ZWREYXRhLnJlbGF0ZWRQZXJzb25GYWN0VHlwZSwgc291cmNlVGl0bGUsIHJlY29yZERhdGEsIGZhY3RUeXBlVG9SZWNvcmRUeXBlKTtcbiAgICBpZiAocmVjb3JkVHlwZSAhPSB1bmRlZmluZWQpIHtcbiAgICAgIHJldHVybiByZWNvcmRUeXBlO1xuICAgIH1cbiAgfVxuXG4gIGlmIChleHRyYWN0ZWREYXRhLmZhY3RUeXBlKSB7XG4gICAgbGV0IHJlY29yZFR5cGUgPSBsb29rdXAoZXh0cmFjdGVkRGF0YS5mYWN0VHlwZSwgc291cmNlVGl0bGUsIHJlY29yZERhdGEsIGZhY3RUeXBlVG9SZWNvcmRUeXBlKTtcbiAgICBpZiAocmVjb3JkVHlwZSAhPSB1bmRlZmluZWQpIHtcbiAgICAgIHJldHVybiByZWNvcmRUeXBlO1xuICAgIH1cbiAgfVxuXG4gIGlmIChyZWNvcmREYXRhICYmIHJlY29yZERhdGFbXCJTb3VyY2UgUmVjb3JkIFR5cGVcIl0pIHtcbiAgICBsZXQgc291cmNlUmVjb3JkVHlwZSA9IHJlY29yZERhdGFbXCJTb3VyY2UgUmVjb3JkIFR5cGVcIl07XG4gICAgbGV0IHJlY29yZFR5cGUgPSBsb29rdXAoc291cmNlUmVjb3JkVHlwZSwgc291cmNlVGl0bGUsIHJlY29yZERhdGEsIHNvdXJjZVJlY29yZFR5cGVUb1JlY29yZFR5cGUpO1xuICAgIGlmIChyZWNvcmRUeXBlICE9IHVuZGVmaW5lZCkge1xuICAgICAgcmV0dXJuIHJlY29yZFR5cGU7XG4gICAgfVxuICB9XG5cbiAgaWYgKHNvdXJjZVRpdGxlKSB7XG4gICAgZm9yIChsZXQgdGl0bGVNYXRjaCBvZiB0aXRsZU1hdGNoZXMpIHtcbiAgICAgIGZvciAobGV0IG1hdGNoIG9mIHRpdGxlTWF0Y2gubWF0Y2hlcykge1xuICAgICAgICBpZiAoc291cmNlVGl0bGUuaW5jbHVkZXMobWF0Y2gpKSB7XG4gICAgICAgICAgcmV0dXJuIHRpdGxlTWF0Y2gudHlwZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIC8vIGNoZWNrIGZvciBiaXJ0aCBvciBkZWF0aCByZWdpc3RyYXRpb25cbiAgICBpZiAoc291cmNlVGl0bGUuaW5jbHVkZXMoXCJSZWdpc3RyYXRpb25cIikpIHtcbiAgICAgIGlmIChzb3VyY2VUaXRsZS5pbmNsdWRlcyhcIkJpcnRoXCIpKSB7XG4gICAgICAgIHJldHVybiBSVC5CaXJ0aFJlZ2lzdHJhdGlvbjtcbiAgICAgIH1cbiAgICAgIGlmIChzb3VyY2VUaXRsZS5pbmNsdWRlcyhcIkRlYXRoXCIpKSB7XG4gICAgICAgIHJldHVybiBSVC5EZWF0aFJlZ2lzdHJhdGlvbjtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBjaGVjayBmb3IgYSBtYXJyaWFnZVxuICAgIGlmIChzb3VyY2VUaXRsZS5pbmNsdWRlcyhcIk1hcnJpYWdlXCIpICYmIGV4dHJhY3RlZERhdGEucmVjb3JkRGF0YSAmJiBleHRyYWN0ZWREYXRhLnJlY29yZERhdGFbXCJNYXJyaWFnZSBEYXRlXCJdKSB7XG4gICAgICByZXR1cm4gUlQuTWFycmlhZ2U7XG4gICAgfVxuXG4gICAgaWYgKHNvdXJjZVRpdGxlLmluY2x1ZGVzKFwiQ3JpbWluYWwgUmVnaXN0ZXJcIikpIHtcbiAgICAgIHJldHVybiBSVC5DcmltaW5hbFJlZ2lzdGVyO1xuICAgIH1cblxuICAgIGlmIChzb3VyY2VUaXRsZS5pbmNsdWRlcyhcIkZyZWVtYXNvbiBNZW1iZXJzaGlwXCIpKSB7XG4gICAgICByZXR1cm4gUlQuRnJlZW1hc29uTWVtYmVyc2hpcDtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gUlQuVW5jbGFzc2lmaWVkO1xufVxuXG5mdW5jdGlvbiBkZXRlcm1pbmVSZWNvcmRUeXBlQW5kUm9sZShleHRyYWN0ZWREYXRhLCByZXN1bHQpIHtcbiAgbGV0IHJlY29yZFR5cGUgPSBkZXRlcm1pbmVSZWNvcmRUeXBlKGV4dHJhY3RlZERhdGEpO1xuXG4gIGlmIChleHRyYWN0ZWREYXRhLnJlbGF0ZWRQZXJzb25GYWN0VHlwZSkge1xuICAgIGlmIChleHRyYWN0ZWREYXRhLnJlbGF0aW9uc2hpcFRvRmFjdFBlcnNvbikge1xuICAgICAgaWYgKGV4dHJhY3RlZERhdGEucmVsYXRpb25zaGlwVG9GYWN0UGVyc29uID09IFwiUGFyZW50XCIpIHtcbiAgICAgICAgcmVzdWx0LnJvbGUgPSBSb2xlLlBhcmVudDtcbiAgICAgIH0gZWxzZSBpZiAoZXh0cmFjdGVkRGF0YS5yZWxhdGlvbnNoaXBUb0ZhY3RQZXJzb24gPT0gXCJDaGlsZFwiKSB7XG4gICAgICAgIHJlc3VsdC5yb2xlID0gUm9sZS5DaGlsZDtcbiAgICAgIH0gZWxzZSBpZiAoZXh0cmFjdGVkRGF0YS5yZWxhdGlvbnNoaXBUb0ZhY3RQZXJzb24gPT0gXCJTcG91c2VcIikge1xuICAgICAgICByZXN1bHQucm9sZSA9IFJvbGUuU3BvdXNlO1xuICAgICAgfVxuICAgICAgaWYgKGV4dHJhY3RlZERhdGEucmVsYXRlZFBlcnNvbkZ1bGxOYW1lKSB7XG4gICAgICAgIHJlc3VsdC5wcmltYXJ5UGVyc29uID0gZXh0cmFjdGVkRGF0YS5yZWxhdGVkUGVyc29uRnVsbE5hbWU7XG4gICAgICB9XG4gICAgICBpZiAoZXh0cmFjdGVkRGF0YS5yZWxhdGVkUGVyc29uR2VuZGVyKSB7XG4gICAgICAgIHJlc3VsdC5wcmltYXJ5UGVyc29uR2VuZGVyID0gZXh0cmFjdGVkRGF0YS5yZWxhdGVkUGVyc29uR2VuZGVyO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHJlc3VsdC5yZWNvcmRUeXBlID0gcmVjb3JkVHlwZTtcbn1cblxuZnVuY3Rpb24gY2xlYW5PY2N1cGF0aW9uKHRleHQpIHtcbiAgbGV0IG5ld1RleHQgPSB0ZXh0O1xuICBpZiAodGV4dCAmJiAvXlteYS16XSskLy50ZXN0KHRleHQpKSB7XG4gICAgLy8gdGhlcmUgYXJlIG5vIGxvd2VyY2FzZSBjaGFyYWN0ZXJzXG4gICAgbmV3VGV4dCA9IFdUU19TdHJpbmcudG9Jbml0aWFsQ2Fwc0VhY2hXb3JkKHRleHQpO1xuICB9XG4gIHJldHVybiBuZXdUZXh0O1xufVxuXG5mdW5jdGlvbiBzZXRGaWVsZElmRGVmaW5lZCh0YXJnZXRPYmplY3QsIGZpZWxkTmFtZSwgdmFsdWUpIHtcbiAgaWYgKHR5cGVvZiB2YWx1ZSAhPT0gXCJ1bmRlZmluZWRcIikge1xuICAgIHRhcmdldE9iamVjdFtmaWVsZE5hbWVdID0gdmFsdWU7XG4gIH1cbn1cblxuY29uc3QgcXVhcnRlck5hbWVzID0gW1xuICB7XG4gICAgbmFtZTogXCJKYW4tRmViLU1hclwiLFxuICAgIHZhbHVlOiAxLFxuICB9LFxuICB7XG4gICAgbmFtZTogXCJBcHItTWF5LUp1blwiLFxuICAgIHZhbHVlOiAyLFxuICB9LFxuICB7XG4gICAgbmFtZTogXCJKdWwtQXVnLVNlcFwiLFxuICAgIHZhbHVlOiAzLFxuICB9LFxuICB7XG4gICAgbmFtZTogXCJPY3QtTm92LURlY1wiLFxuICAgIHZhbHVlOiA0LFxuICB9LFxuXTtcblxuZnVuY3Rpb24gc2VsZWN0RGF0ZShkYXRlU3RyaW5nLCBvcmlnaW5hbERhdGVTdHJpbmcpIHtcbiAgaWYgKCFkYXRlU3RyaW5nKSB7XG4gICAgcmV0dXJuIG9yaWdpbmFsRGF0ZVN0cmluZztcbiAgfVxuICBpZiAoIW9yaWdpbmFsRGF0ZVN0cmluZykge1xuICAgIHJldHVybiBkYXRlU3RyaW5nO1xuICB9XG5cbiAgLy8gc29tZXRpbWVzIGRhdGUgY29tZSB0aHJvdWdoIGluIGxpa2UgdGhpczpcbiAgLy8gQmlydGggRGF0ZTogMTEwODE5MjFcbiAgLy8gQmlydGggRGF0ZVx0KE9yaWdpbmFsKTogMDggTm92IDE5MjFcbiAgLy8gRXhhbXBsZSBpcyBVUyBTUyBEZWF0aCBJbmRleCBmb3IgMjAwNFxuICBpZiAoL1xcZFxcZFxcZFxcZFxcZFxcZFxcZFxcZC8udGVzdChkYXRlU3RyaW5nKSkge1xuICAgIHJldHVybiBvcmlnaW5hbERhdGVTdHJpbmc7XG4gIH1cblxuICAvLyBzb21ldGltZXMgZGF0ZSBjb21lIHRocm91Z2ggaW4gbGlrZSB0aGlzOlxuICAvLyBEZWF0aCBEYXRlOiAwNS8yNC8xOTc0XG4gIC8vIEJpcnRoIERhdGVcdChPcmlnaW5hbCk6IDI0IE1heSAxOTc0XG4gIC8vIEV4YW1wbGUgaXMgVVMgQ0EgRGVhdGggSW5kZXhcbiAgaWYgKC9cXGQ/XFxkXFwvXFxkP1xcZFxcL1xcZFxcZFxcZFxcZC8udGVzdChkYXRlU3RyaW5nKSkge1xuICAgIHJldHVybiBvcmlnaW5hbERhdGVTdHJpbmc7XG4gIH1cblxuICAvLyBzb21ldGltZXMgZGF0ZSBjb21lIHRocm91Z2ggaW4gbGlrZSB0aGlzOlxuICAvLyBcImJpcnRoRGF0ZU9yaWdpbmFsXCI6IFwiMSBOb3YgMTg1NFwiLFxuICAvLyBcImJpcnRoRGF0ZVwiOiBcIjEgMTEgMTg1NFwiLFxuICAvLyBFeGFtcGxlIGlzIGh0dHBzOi8vd3d3LmZhbWlseXNlYXJjaC5vcmcvYXJrOi82MTkwMy8xOjE6WEJRQy1YOVFcbiAgaWYgKC9cXGQ/XFxkXFxzK1xcZD9cXGRcXHMrXFxkXFxkXFxkXFxkLy50ZXN0KGRhdGVTdHJpbmcpKSB7XG4gICAgcmV0dXJuIG9yaWdpbmFsRGF0ZVN0cmluZztcbiAgfVxuXG4gIC8vIHNvbWV0aW1lcyBkYXRlU3RyaW5nIGlzIGp1c3QgYSB5ZWFyIGFuZCBvcmlnaW5hbERhdGVTdHJpbmcgaXMgdGhlIGZ1bGwgZGF0ZVxuICBpZiAoZGF0ZVN0cmluZy5sZW5ndGggPCA2ICYmIG9yaWdpbmFsRGF0ZVN0cmluZy5sZW5ndGggPiBkYXRlU3RyaW5nLmxlbmd0aCkge1xuICAgIHJldHVybiBvcmlnaW5hbERhdGVTdHJpbmc7XG4gIH1cblxuICByZXR1cm4gZGF0ZVN0cmluZztcbn1cblxuZnVuY3Rpb24gc2VsZWN0UGxhY2UocGxhY2VTdHJpbmcsIG9yaWdpbmFsUGxhY2VTdHJpbmcpIHtcbiAgLy8gc29tZXRpbWVzIHRoZXJlIGlzIG5vIHBsYWNlIGJ1dCB0aGVyZSBpcyBhbiBvcmlnaW5hbCBwbGFjZVxuICBpZiAoIXBsYWNlU3RyaW5nKSB7XG4gICAgcmV0dXJuIG9yaWdpbmFsUGxhY2VTdHJpbmc7XG4gIH1cblxuICAvLyBTb21ldGltZXMgRlMgcHV0cyB0aGluZ3MgaW4gdGhhdCBhcmUgbm90IFdpa2lUcmVlIGFwcHJvdmVkXG4gIHBsYWNlU3RyaW5nID0gcGxhY2VTdHJpbmcucmVwbGFjZSgvXFwsPyAqQnJpdGlzaCBDb2xvbmlhbCBBbWVyaWNhLywgXCJcIik7XG5cbiAgcmV0dXJuIHBsYWNlU3RyaW5nO1xufVxuXG5mdW5jdGlvbiBnZW5lcmFsaXplRGF0YUdpdmVuUmVjb3JkVHlwZShkYXRhLCByZXN1bHQpIHtcbiAgaWYgKGRhdGEuYWdlKSB7XG4gICAgaWYgKGRhdGEuYWdlICE9IFwiOTk5XCIpIHtcbiAgICAgIGxldCBhZ2UgPSBkYXRhLmFnZS5yZXBsYWNlKC9eMCooXFxkKS8sIFwiJDFcIik7IC8vIHJlbW92ZSBsZWFkaW5nIHplcm9lcyAoYnV0IG5vdCBhIHNpbmdsZSB6ZXJvIG9uIGl0cyBvd24pXG4gICAgICAvLyBvY2Nhc2lvbmFsbHkgdGhlIGFnZSBoYXMgZXh0cmEgdGV4dC4gZS5nLiBcIjcgeWVhcnNcIlxuICAgICAgaWYgKGFnZSAmJiBhZ2UubGVuZ3RoID4gMSkge1xuICAgICAgICBpZiAoYWdlLnNlYXJjaCgvW15cXGRdLykgIT0gLTEpIHtcbiAgICAgICAgICBhZ2UgPSBhZ2UucmVwbGFjZSgvXFxzKnllYXJzXFxzKiQvaSwgXCJcIik7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmIChyZXN1bHQucmVjb3JkVHlwZSA9PSBSVC5EZWF0aFJlZ2lzdHJhdGlvbiB8fCByZXN1bHQucmVjb3JkVHlwZSA9PSBSVC5EZWF0aCkge1xuICAgICAgICByZXN1bHQuYWdlQXREZWF0aCA9IGFnZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJlc3VsdC5hZ2VBdEV2ZW50ID0gYWdlO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGlmIChkYXRhLnJlY29yZERhdGEgJiYgZGF0YS5yZWNvcmREYXRhW1wiT2NjdXBhdGlvblwiXSkge1xuICAgIGxldCBvY2N1cGF0aW9uID0gY2xlYW5PY2N1cGF0aW9uKGRhdGEucmVjb3JkRGF0YVtcIk9jY3VwYXRpb25cIl0pO1xuICAgIGlmIChvY2N1cGF0aW9uKSB7XG4gICAgICByZXN1bHQub2NjdXBhdGlvbiA9IG9jY3VwYXRpb247XG4gICAgfVxuICB9XG5cbiAgaWYgKFxuICAgIHJlc3VsdC5yZWNvcmRUeXBlID09IFJULkJhcHRpc20gfHxcbiAgICByZXN1bHQucmVjb3JkVHlwZSA9PSBSVC5CaXJ0aCB8fFxuICAgIHJlc3VsdC5yZWNvcmRUeXBlID09IFJULkJpcnRoUmVnaXN0cmF0aW9uIHx8XG4gICAgcmVzdWx0LnJlY29yZFR5cGUgPT0gUlQuQmlydGhPckJhcHRpc20gfHxcbiAgICByZXN1bHQucmVjb3JkVHlwZSA9PSBSVC5EZWF0aCB8fFxuICAgIHJlc3VsdC5yZWNvcmRUeXBlID09IFJULkRlYXRoUmVnaXN0cmF0aW9uXG4gICkge1xuICAgIGlmIChyZXN1bHQucm9sZSAhPSBSb2xlLlBhcmVudCkge1xuICAgICAgaWYgKGRhdGEuZmF0aGVyKSB7XG4gICAgICAgIGxldCBmYXRoZXIgPSByZXN1bHQuYWRkRmF0aGVyKCk7XG4gICAgICAgIHNldEZpZWxkSWZEZWZpbmVkKGZhdGhlci5uYW1lLCBcIm5hbWVcIiwgZGF0YS5mYXRoZXIuZnVsbE5hbWUpO1xuICAgICAgICBzZXRGaWVsZElmRGVmaW5lZChmYXRoZXIubmFtZSwgXCJmb3JlbmFtZXNcIiwgZGF0YS5mYXRoZXIuZ2l2ZW5OYW1lKTtcbiAgICAgICAgc2V0RmllbGRJZkRlZmluZWQoZmF0aGVyLm5hbWUsIFwibGFzdE5hbWVcIiwgZGF0YS5mYXRoZXIuc3VybmFtZSk7XG4gICAgICAgIHNldEZpZWxkSWZEZWZpbmVkKGZhdGhlci5uYW1lLCBcInByZWZpeFwiLCBkYXRhLmZhdGhlci5wcmVmaXgpO1xuICAgICAgICBzZXRGaWVsZElmRGVmaW5lZChmYXRoZXIubmFtZSwgXCJzdWZmaXhcIiwgZGF0YS5mYXRoZXIuc3VmZml4KTtcbiAgICAgIH1cbiAgICAgIGlmIChkYXRhLm1vdGhlcikge1xuICAgICAgICBsZXQgbW90aGVyID0gcmVzdWx0LmFkZE1vdGhlcigpO1xuICAgICAgICBzZXRGaWVsZElmRGVmaW5lZChtb3RoZXIubmFtZSwgXCJuYW1lXCIsIGRhdGEubW90aGVyLmZ1bGxOYW1lKTtcbiAgICAgICAgc2V0RmllbGRJZkRlZmluZWQobW90aGVyLm5hbWUsIFwiZm9yZW5hbWVzXCIsIGRhdGEubW90aGVyLmdpdmVuTmFtZSk7XG4gICAgICAgIHNldEZpZWxkSWZEZWZpbmVkKG1vdGhlci5uYW1lLCBcImxhc3ROYW1lXCIsIGRhdGEubW90aGVyLnN1cm5hbWUpO1xuICAgICAgICBzZXRGaWVsZElmRGVmaW5lZChtb3RoZXIubmFtZSwgXCJwcmVmaXhcIiwgZGF0YS5tb3RoZXIucHJlZml4KTtcbiAgICAgICAgc2V0RmllbGRJZkRlZmluZWQobW90aGVyLm5hbWUsIFwic3VmZml4XCIsIGRhdGEubW90aGVyLnN1ZmZpeCk7XG4gICAgICB9XG5cbiAgICAgIC8vIHNwb3VzZSBjYW4gYmUgc3BlY2lmaWVkIG9uIGEgZGVhdGggcmVjb3JkIGZvciBleGFtcGxlXG4gICAgICBpZiAoZGF0YS5zcG91c2VGdWxsTmFtZSB8fCBkYXRhLnNwb3VzZVN1cm5hbWUgfHwgZGF0YS5zcG91c2VHaXZlbk5hbWUpIHtcbiAgICAgICAgcmVzdWx0LnNwb3VzZXMgPSBbXTtcbiAgICAgICAgbGV0IHJlc3VsdFNwb3VzZSA9IHt9O1xuICAgICAgICByZXN1bHRTcG91c2UubmFtZSA9IG5ldyBXdHNOYW1lKCk7XG5cbiAgICAgICAgaWYgKGRhdGEuc3BvdXNlRnVsbE5hbWUpIHtcbiAgICAgICAgICByZXN1bHRTcG91c2UubmFtZS5uYW1lID0gZGF0YS5zcG91c2VGdWxsTmFtZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZGF0YS5zcG91c2VTdXJuYW1lKSB7XG4gICAgICAgICAgcmVzdWx0U3BvdXNlLm5hbWUubGFzdE5hbWUgPSBkYXRhLnNwb3VzZVN1cm5hbWU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGRhdGEuc3BvdXNlR2l2ZW5OYW1lKSB7XG4gICAgICAgICAgcmVzdWx0U3BvdXNlLm5hbWUuZm9yZW5hbWVzID0gZGF0YS5zcG91c2VHaXZlbk5hbWU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGRhdGEuc3BvdXNlUHJlZml4KSB7XG4gICAgICAgICAgcmVzdWx0U3BvdXNlLm5hbWUucHJlZml4ID0gZGF0YS5zcG91c2VQcmVmaXg7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGRhdGEuc3BvdXNlU3VmZml4KSB7XG4gICAgICAgICAgcmVzdWx0U3BvdXNlLm5hbWUuc3VmZml4ID0gZGF0YS5zcG91c2VTdWZmaXg7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGRhdGEuc3BvdXNlQWdlKSB7XG4gICAgICAgICAgcmVzdWx0U3BvdXNlLmFnZSA9IGRhdGEuc3BvdXNlQWdlO1xuICAgICAgICB9XG4gICAgICAgIHJlc3VsdC5zcG91c2VzLnB1c2gocmVzdWx0U3BvdXNlKTtcbiAgICAgIH1cbiAgICB9XG4gIH0gZWxzZSBpZiAocmVzdWx0LnJlY29yZFR5cGUgPT0gUlQuTWFycmlhZ2UpIHtcbiAgICByZXN1bHQuc3BvdXNlcyA9IFtdO1xuICAgIGxldCByZXN1bHRTcG91c2UgPSB7fTtcblxuICAgIGlmIChyZXN1bHQucm9sZSAhPSBSb2xlLlBhcmVudCkge1xuICAgICAgaWYgKGRhdGEuZmF0aGVyKSB7XG4gICAgICAgIGxldCBmYXRoZXIgPSByZXN1bHQuYWRkRmF0aGVyKCk7XG4gICAgICAgIHNldEZpZWxkSWZEZWZpbmVkKGZhdGhlci5uYW1lLCBcIm5hbWVcIiwgZGF0YS5mYXRoZXIuZnVsbE5hbWUpO1xuICAgICAgICBzZXRGaWVsZElmRGVmaW5lZChmYXRoZXIubmFtZSwgXCJmb3JlbmFtZXNcIiwgZGF0YS5mYXRoZXIuZ2l2ZW5OYW1lKTtcbiAgICAgICAgc2V0RmllbGRJZkRlZmluZWQoZmF0aGVyLm5hbWUsIFwibGFzdE5hbWVcIiwgZGF0YS5mYXRoZXIuc3VybmFtZSk7XG4gICAgICAgIHNldEZpZWxkSWZEZWZpbmVkKGZhdGhlci5uYW1lLCBcInByZWZpeFwiLCBkYXRhLmZhdGhlci5wcmVmaXgpO1xuICAgICAgICBzZXRGaWVsZElmRGVmaW5lZChmYXRoZXIubmFtZSwgXCJzdWZmaXhcIiwgZGF0YS5mYXRoZXIuc3VmZml4KTtcbiAgICAgIH1cbiAgICAgIGlmIChkYXRhLm1vdGhlcikge1xuICAgICAgICBsZXQgbW90aGVyID0gcmVzdWx0LmFkZE1vdGhlcigpO1xuICAgICAgICBzZXRGaWVsZElmRGVmaW5lZChtb3RoZXIubmFtZSwgXCJuYW1lXCIsIGRhdGEubW90aGVyLmZ1bGxOYW1lKTtcbiAgICAgICAgc2V0RmllbGRJZkRlZmluZWQobW90aGVyLm5hbWUsIFwiZm9yZW5hbWVzXCIsIGRhdGEubW90aGVyLmdpdmVuTmFtZSk7XG4gICAgICAgIHNldEZpZWxkSWZEZWZpbmVkKG1vdGhlci5uYW1lLCBcImxhc3ROYW1lXCIsIGRhdGEubW90aGVyLnN1cm5hbWUpO1xuICAgICAgICBzZXRGaWVsZElmRGVmaW5lZChtb3RoZXIubmFtZSwgXCJwcmVmaXhcIiwgZGF0YS5tb3RoZXIucHJlZml4KTtcbiAgICAgICAgc2V0RmllbGRJZkRlZmluZWQobW90aGVyLm5hbWUsIFwic3VmZml4XCIsIGRhdGEubW90aGVyLnN1ZmZpeCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKGRhdGEuc3BvdXNlRnVsbE5hbWUgfHwgZGF0YS5zcG91c2VTdXJuYW1lIHx8IGRhdGEuc3BvdXNlR2l2ZW5OYW1lKSB7XG4gICAgICByZXN1bHRTcG91c2UubmFtZSA9IG5ldyBXdHNOYW1lKCk7XG5cbiAgICAgIGlmIChkYXRhLnNwb3VzZUZ1bGxOYW1lKSB7XG4gICAgICAgIHJlc3VsdFNwb3VzZS5uYW1lLm5hbWUgPSBkYXRhLnNwb3VzZUZ1bGxOYW1lO1xuICAgICAgfVxuICAgICAgaWYgKGRhdGEuc3BvdXNlU3VybmFtZSkge1xuICAgICAgICByZXN1bHRTcG91c2UubmFtZS5sYXN0TmFtZSA9IGRhdGEuc3BvdXNlU3VybmFtZTtcbiAgICAgIH1cbiAgICAgIGlmIChkYXRhLnNwb3VzZUdpdmVuTmFtZSkge1xuICAgICAgICByZXN1bHRTcG91c2UubmFtZS5mb3JlbmFtZXMgPSBkYXRhLnNwb3VzZUdpdmVuTmFtZTtcbiAgICAgIH1cbiAgICAgIGlmIChkYXRhLnNwb3VzZVByZWZpeCkge1xuICAgICAgICByZXN1bHRTcG91c2UubmFtZS5wcmVmaXggPSBkYXRhLnNwb3VzZVByZWZpeDtcbiAgICAgIH1cbiAgICAgIGlmIChkYXRhLnNwb3VzZVN1ZmZpeCkge1xuICAgICAgICByZXN1bHRTcG91c2UubmFtZS5zdWZmaXggPSBkYXRhLnNwb3VzZVN1ZmZpeDtcbiAgICAgIH1cbiAgICAgIGlmIChkYXRhLnNwb3VzZUFnZSkge1xuICAgICAgICByZXN1bHRTcG91c2UuYWdlID0gZGF0YS5zcG91c2VBZ2U7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmIChcbiAgICAgIGRhdGEucmVsYXRlZFBlcnNvblNwb3VzZUZ1bGxOYW1lIHx8XG4gICAgICBkYXRhLnJlbGF0ZWRQZXJzb25TcG91c2VTdXJuYW1lIHx8XG4gICAgICBkYXRhLnJlbGF0ZWRQZXJzb25TcG91c2VHaXZlbk5hbWVcbiAgICApIHtcbiAgICAgIHJlc3VsdFNwb3VzZS5uYW1lID0gbmV3IFd0c05hbWUoKTtcbiAgICAgIGlmIChkYXRhLnJlbGF0ZWRQZXJzb25TcG91c2VGdWxsTmFtZSkge1xuICAgICAgICByZXN1bHRTcG91c2UubmFtZS5uYW1lID0gZGF0YS5yZWxhdGVkUGVyc29uU3BvdXNlRnVsbE5hbWU7XG4gICAgICB9XG4gICAgICBpZiAoZGF0YS5yZWxhdGVkUGVyc29uU3BvdXNlU3VybmFtZSkge1xuICAgICAgICByZXN1bHRTcG91c2UubmFtZS5sYXN0TmFtZSA9IGRhdGEucmVsYXRlZFBlcnNvblNwb3VzZVN1cm5hbWU7XG4gICAgICB9XG4gICAgICBpZiAoZGF0YS5yZWxhdGVkUGVyc29uU3BvdXNlR2l2ZW5OYW1lKSB7XG4gICAgICAgIHJlc3VsdFNwb3VzZS5uYW1lLmZvcmVuYW1lcyA9IGRhdGEucmVsYXRlZFBlcnNvblNwb3VzZUdpdmVuTmFtZTtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKHJlc3VsdC5ldmVudERhdGUpIHtcbiAgICAgIHJlc3VsdFNwb3VzZS5tYXJyaWFnZURhdGUgPSByZXN1bHQuZXZlbnREYXRlO1xuICAgIH1cbiAgICBpZiAocmVzdWx0LmV2ZW50UGxhY2UpIHtcbiAgICAgIHJlc3VsdFNwb3VzZS5tYXJyaWFnZVBsYWNlID0gcmVzdWx0LmV2ZW50UGxhY2U7XG4gICAgfVxuXG4gICAgLy8gdGhlIG1hcnJpYWdlIHJlY29yZCBjYW4gY29udGFpbiBhbiBhY3R1YWwgbWFycmlhZ2UgZGF0ZSBhcyB3ZWxsIGFzIHRoZSBldmVudCBkYXRlXG4gICAgLy8gSWYgc28gaXQgaXMgcHJvYmFibHkgbW9yZSBhY2N1cmF0ZVxuICAgIGlmIChcbiAgICAgIGRhdGEucmVjb3JkRGF0YVtcIk1hcnJpYWdlIERhdGVcIl0gfHxcbiAgICAgIGRhdGEucmVjb3JkRGF0YVtcIk1hcnJpYWdlIERhdGUgKE9yaWdpbmFsKVwiXSB8fFxuICAgICAgZGF0YS5yZWNvcmREYXRhW1wiTWFycmlhZ2UgWWVhclwiXVxuICAgICkge1xuICAgICAgbGV0IG1hcnJpYWdlRGF0ZSA9IG5ldyBXdHNEYXRlKCk7XG4gICAgICBsZXQgZGF0ZVN0cmluZyA9IHNlbGVjdERhdGUoZGF0YS5yZWNvcmREYXRhW1wiTWFycmlhZ2UgRGF0ZVwiXSwgZGF0YS5yZWNvcmREYXRhW1wiTWFycmlhZ2UgRGF0ZSAoT3JpZ2luYWwpXCJdKTtcbiAgICAgIGlmIChkYXRlU3RyaW5nKSB7XG4gICAgICAgIG1hcnJpYWdlRGF0ZS5kYXRlU3RyaW5nID0gZGF0ZVN0cmluZztcbiAgICAgIH1cbiAgICAgIGlmIChkYXRhLnJlY29yZERhdGFbXCJNYXJyaWFnZSBZZWFyXCJdKSB7XG4gICAgICAgIG1hcnJpYWdlRGF0ZS55ZWFyU3RyaW5nID0gZGF0YS5yZWNvcmREYXRhW1wiTWFycmlhZ2UgWWVhclwiXTtcbiAgICAgIH1cbiAgICAgIHJlc3VsdFNwb3VzZS5tYXJyaWFnZURhdGUgPSBtYXJyaWFnZURhdGU7XG4gICAgICByZXN1bHQubWFycmlhZ2VEYXRlID0gbWFycmlhZ2VEYXRlLmdldERhdGVTdHJpbmcoKTtcbiAgICB9XG5cbiAgICByZXN1bHQuc3BvdXNlcy5wdXNoKHJlc3VsdFNwb3VzZSk7XG4gIH0gZWxzZSBpZiAocmVzdWx0LnJlY29yZFR5cGUgPT0gUlQuTWFycmlhZ2VSZWdpc3RyYXRpb24pIHtcbiAgICByZXN1bHQuc3BvdXNlcyA9IFtdO1xuICAgIGxldCByZXN1bHRTcG91c2UgPSB7fTtcblxuICAgIGlmIChkYXRhLnNwb3VzZUZ1bGxOYW1lIHx8IGRhdGEuc3BvdXNlU3VybmFtZSB8fCBkYXRhLnNwb3VzZUdpdmVuTmFtZSkge1xuICAgICAgcmVzdWx0U3BvdXNlLm5hbWUgPSBuZXcgV3RzTmFtZSgpO1xuXG4gICAgICBsZXQgc3BvdXNlRnVsbE5hbWUgPSBkYXRhLnNwb3VzZUZ1bGxOYW1lO1xuICAgICAgaWYgKHNwb3VzZUZ1bGxOYW1lID09IGRhdGEuc3BvdXNlU3VybmFtZSkge1xuICAgICAgICAvLyB0aGVyZSBjb3VsZCBiZSBtb3JlIGluZm8gaW4gcmVjb3JkIGRhdGFcbiAgICAgICAgbGV0IHJlY29yZERhdGEgPSBkYXRhLnJlY29yZERhdGE7XG4gICAgICAgIGlmIChyZWNvcmREYXRhKSB7XG4gICAgICAgICAgaWYgKHJlY29yZERhdGFbXCJPdGhlciBPbiBQYWdlIE5hbWUxXCJdICYmICFyZWNvcmREYXRhW1wiT3RoZXIgT24gUGFnZSBOYW1lMlwiXSkge1xuICAgICAgICAgICAgaWYgKHJlY29yZERhdGFbXCJPdGhlciBPbiBQYWdlIE5hbWUgU3VybjFcIl0gPT0gZGF0YS5zcG91c2VTdXJuYW1lKSB7XG4gICAgICAgICAgICAgIHNwb3VzZUZ1bGxOYW1lID0gcmVjb3JkRGF0YVtcIk90aGVyIE9uIFBhZ2UgTmFtZTFcIl07XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHJlY29yZERhdGFbXCJPdGhlciBPbiBQYWdlIE5hbWUxXCJdLmVuZHNXaXRoKGRhdGEuc3BvdXNlU3VybmFtZSkpIHtcbiAgICAgICAgICAgICAgc3BvdXNlRnVsbE5hbWUgPSByZWNvcmREYXRhW1wiT3RoZXIgT24gUGFnZSBOYW1lMVwiXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgaWYgKHNwb3VzZUZ1bGxOYW1lKSB7XG4gICAgICAgIHJlc3VsdFNwb3VzZS5uYW1lLm5hbWUgPSBzcG91c2VGdWxsTmFtZTtcbiAgICAgIH1cbiAgICAgIGlmIChkYXRhLnNwb3VzZVN1cm5hbWUpIHtcbiAgICAgICAgcmVzdWx0U3BvdXNlLm5hbWUubGFzdE5hbWUgPSBkYXRhLnNwb3VzZVN1cm5hbWU7XG4gICAgICB9XG4gICAgICBpZiAoZGF0YS5zcG91c2VHaXZlbk5hbWUpIHtcbiAgICAgICAgcmVzdWx0U3BvdXNlLm5hbWUuZm9yZW5hbWVzID0gZGF0YS5zcG91c2VHaXZlbk5hbWU7XG4gICAgICB9XG4gICAgICBpZiAoZGF0YS5zcG91c2VQcmVmaXgpIHtcbiAgICAgICAgcmVzdWx0U3BvdXNlLm5hbWUucHJlZml4ID0gZGF0YS5zcG91c2VQcmVmaXg7XG4gICAgICB9XG4gICAgICBpZiAoZGF0YS5zcG91c2VTdWZmaXgpIHtcbiAgICAgICAgcmVzdWx0U3BvdXNlLm5hbWUuc3VmZml4ID0gZGF0YS5zcG91c2VTdWZmaXg7XG4gICAgICB9XG4gICAgICBpZiAoZGF0YS5zcG91c2VBZ2UpIHtcbiAgICAgICAgcmVzdWx0U3BvdXNlLmFnZSA9IGRhdGEuc3BvdXNlQWdlO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAocmVzdWx0LmV2ZW50RGF0ZSkge1xuICAgICAgcmVzdWx0U3BvdXNlLm1hcnJpYWdlRGF0ZSA9IHJlc3VsdC5ldmVudERhdGU7XG4gICAgfVxuICAgIGlmIChyZXN1bHQuZXZlbnRQbGFjZSkge1xuICAgICAgcmVzdWx0U3BvdXNlLm1hcnJpYWdlUGxhY2UgPSByZXN1bHQuZXZlbnRQbGFjZTtcbiAgICB9XG5cbiAgICAvLyB0aGUgbWFycmlhZ2UgcmVnaXN0cmF0aW9uIGNhbiBjb250YWluIGFuIGFjdHVhbCBtYXJyaWFnZSBkYXRlXG4gICAgaWYgKFxuICAgICAgZGF0YS5yZWNvcmREYXRhW1wiTWFycmlhZ2UgRGF0ZVwiXSB8fFxuICAgICAgZGF0YS5yZWNvcmREYXRhW1wiTWFycmlhZ2UgRGF0ZSAoT3JpZ2luYWwpXCJdIHx8XG4gICAgICBkYXRhLnJlY29yZERhdGFbXCJNYXJyaWFnZSBZZWFyXCJdXG4gICAgKSB7XG4gICAgICBsZXQgbWFycmlhZ2VEYXRlID0gbmV3IFd0c0RhdGUoKTtcbiAgICAgIGxldCBkYXRlU3RyaW5nID0gc2VsZWN0RGF0ZShkYXRhLnJlY29yZERhdGFbXCJNYXJyaWFnZSBEYXRlXCJdLCBkYXRhLnJlY29yZERhdGFbXCJNYXJyaWFnZSBEYXRlIChPcmlnaW5hbClcIl0pO1xuICAgICAgaWYgKGRhdGVTdHJpbmcpIHtcbiAgICAgICAgbWFycmlhZ2VEYXRlLmRhdGVTdHJpbmcgPSBkYXRlU3RyaW5nO1xuICAgICAgfVxuICAgICAgaWYgKGRhdGEucmVjb3JkRGF0YVtcIk1hcnJpYWdlIFllYXJcIl0pIHtcbiAgICAgICAgbWFycmlhZ2VEYXRlLnllYXJTdHJpbmcgPSBkYXRhLnJlY29yZERhdGFbXCJNYXJyaWFnZSBZZWFyXCJdO1xuICAgICAgfVxuICAgICAgcmVzdWx0U3BvdXNlLm1hcnJpYWdlRGF0ZSA9IG1hcnJpYWdlRGF0ZTtcbiAgICAgIHJlc3VsdC5tYXJyaWFnZURhdGUgPSBtYXJyaWFnZURhdGUuZ2V0RGF0ZVN0cmluZygpO1xuICAgIH1cblxuICAgIHJlc3VsdC5zcG91c2VzLnB1c2gocmVzdWx0U3BvdXNlKTtcbiAgfVxuXG4gIGlmIChkYXRhLmhvdXNlaG9sZCkge1xuICAgIGxldCBoZWFkaW5ncyA9IGRhdGEuaG91c2Vob2xkLmhlYWRpbmdzO1xuICAgIGxldCBtZW1iZXJzID0gZGF0YS5ob3VzZWhvbGQubWVtYmVycztcbiAgICBpZiAoaGVhZGluZ3MgJiYgbWVtYmVycykge1xuICAgICAgcmVzdWx0LmhvdXNlaG9sZEFycmF5RmllbGRzID0gW107XG4gICAgICBsZXQgZmllbGRzRW5jb3VudGVyZWQgPSB7fTtcblxuICAgICAgbGV0IGhvdXNlaG9sZEFycmF5ID0gW107XG4gICAgICBmb3IgKGxldCBtZW1iZXIgb2YgbWVtYmVycykge1xuICAgICAgICBsZXQgaG91c2Vob2xkTWVtYmVyID0ge307XG4gICAgICAgIGlmIChtZW1iZXIuaXNDbG9zZWQpIHtcbiAgICAgICAgICBob3VzZWhvbGRNZW1iZXIuaXNDbG9zZWQgPSB0cnVlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGxldCBuYW1lID0gbWVtYmVyLmZ1bGxOYW1lO1xuICAgICAgICAgIGlmIChuYW1lKSB7XG4gICAgICAgICAgICBob3VzZWhvbGRNZW1iZXIubmFtZSA9IG5hbWU7XG4gICAgICAgICAgICBmaWVsZHNFbmNvdW50ZXJlZC5uYW1lID0gdHJ1ZTtcbiAgICAgICAgICB9XG4gICAgICAgICAgbGV0IHJlbGF0aW9uc2hpcCA9IG1lbWJlci5yZWxhdGlvbnNoaXA7XG4gICAgICAgICAgaWYgKHJlbGF0aW9uc2hpcCAmJiByZWxhdGlvbnNoaXAgIT0gXCJVbmtub3duXCIpIHtcbiAgICAgICAgICAgIGhvdXNlaG9sZE1lbWJlci5yZWxhdGlvbnNoaXAgPSBHRC5zdGFuZGFyZGl6ZVJlbGF0aW9uc2hpcFRvSGVhZChyZWxhdGlvbnNoaXApO1xuICAgICAgICAgICAgZmllbGRzRW5jb3VudGVyZWQucmVsYXRpb25zaGlwID0gdHJ1ZTtcbiAgICAgICAgICB9XG4gICAgICAgICAgbGV0IG1hcml0YWxTdGF0dXMgPSBHRC5zdGFuZGFyZGl6ZU1hcml0YWxTdGF0dXMobWVtYmVyLm1hcml0YWxTdGF0dXMpO1xuICAgICAgICAgIGlmIChtYXJpdGFsU3RhdHVzKSB7XG4gICAgICAgICAgICBob3VzZWhvbGRNZW1iZXIubWFyaXRhbFN0YXR1cyA9IG1hcml0YWxTdGF0dXM7XG4gICAgICAgICAgICBmaWVsZHNFbmNvdW50ZXJlZC5tYXJpdGFsU3RhdHVzID0gdHJ1ZTtcbiAgICAgICAgICB9XG4gICAgICAgICAgbGV0IGdlbmRlciA9IG1lbWJlci5nZW5kZXI7XG4gICAgICAgICAgaWYgKGdlbmRlciAmJiBnZW5kZXIgIT0gXCJVbmtub3duXCIpIHtcbiAgICAgICAgICAgIGhvdXNlaG9sZE1lbWJlci5nZW5kZXIgPSBHRC5zdGFuZGFyZGl6ZUdlbmRlcihnZW5kZXIpO1xuICAgICAgICAgICAgZmllbGRzRW5jb3VudGVyZWQuZ2VuZGVyID0gdHJ1ZTtcbiAgICAgICAgICB9XG4gICAgICAgICAgbGV0IGFnZSA9IG1lbWJlci5hZ2U7XG4gICAgICAgICAgaWYgKGFnZSAmJiBhZ2UgIT0gXCJVbmtub3duXCIgJiYgYWdlICE9IFwiOTk5XCIpIHtcbiAgICAgICAgICAgIGhvdXNlaG9sZE1lbWJlci5hZ2UgPSBhZ2U7XG4gICAgICAgICAgICBmaWVsZHNFbmNvdW50ZXJlZC5hZ2UgPSB0cnVlO1xuICAgICAgICAgIH1cbiAgICAgICAgICBsZXQgYmlydGhZZWFyID0gbWVtYmVyLmJpcnRoWWVhcjtcbiAgICAgICAgICBpZiAoYmlydGhZZWFyICYmIGJpcnRoWWVhciAhPSBcIlVua25vd25cIikge1xuICAgICAgICAgICAgaG91c2Vob2xkTWVtYmVyLmJpcnRoWWVhciA9IGJpcnRoWWVhcjtcbiAgICAgICAgICAgIGZpZWxkc0VuY291bnRlcmVkLmJpcnRoWWVhciA9IHRydWU7XG4gICAgICAgICAgfVxuICAgICAgICAgIGxldCBiaXJ0aERhdGUgPSBtZW1iZXIuYmlydGhEYXRlO1xuICAgICAgICAgIGlmIChiaXJ0aERhdGUgJiYgYmlydGhEYXRlICE9IFwiVW5rbm93blwiICYmIGJpcnRoRGF0ZSAhPSBiaXJ0aFllYXIpIHtcbiAgICAgICAgICAgIGhvdXNlaG9sZE1lbWJlci5iaXJ0aERhdGUgPSBiaXJ0aERhdGU7XG4gICAgICAgICAgICBmaWVsZHNFbmNvdW50ZXJlZC5iaXJ0aERhdGUgPSB0cnVlO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGxldCBvY2N1cGF0aW9uID0gY2xlYW5PY2N1cGF0aW9uKG1lbWJlci5vY2N1cGF0aW9uKTtcbiAgICAgICAgICBpZiAob2NjdXBhdGlvbiAmJiBvY2N1cGF0aW9uICE9IFwiVW5rbm93blwiKSB7XG4gICAgICAgICAgICBob3VzZWhvbGRNZW1iZXIub2NjdXBhdGlvbiA9IG9jY3VwYXRpb247XG4gICAgICAgICAgICBmaWVsZHNFbmNvdW50ZXJlZC5vY2N1cGF0aW9uID0gdHJ1ZTtcbiAgICAgICAgICB9XG4gICAgICAgICAgbGV0IGJpcnRoUGxhY2UgPSBtZW1iZXIuYmlydGhQbGFjZTtcbiAgICAgICAgICBpZiAoIWJpcnRoUGxhY2UpIHtcbiAgICAgICAgICAgIGJpcnRoUGxhY2UgPSBtZW1iZXIuYmlydGhQbGFjZU9yaWdpbmFsO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoYmlydGhQbGFjZSAmJiBiaXJ0aFBsYWNlICE9IFwiVW5rbm93blwiKSB7XG4gICAgICAgICAgICBob3VzZWhvbGRNZW1iZXIuYmlydGhQbGFjZSA9IGJpcnRoUGxhY2U7XG4gICAgICAgICAgICBmaWVsZHNFbmNvdW50ZXJlZC5iaXJ0aFBsYWNlID0gdHJ1ZTtcbiAgICAgICAgICB9XG4gICAgICAgICAgbGV0IGlzU2VsZWN0ZWQgPSBtZW1iZXJbXCJpc1NlbGVjdGVkXCJdO1xuICAgICAgICAgIGlmIChpc1NlbGVjdGVkKSB7XG4gICAgICAgICAgICBob3VzZWhvbGRNZW1iZXIuaXNTZWxlY3RlZCA9IGlzU2VsZWN0ZWQ7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGhvdXNlaG9sZEFycmF5LnB1c2goaG91c2Vob2xkTWVtYmVyKTtcbiAgICAgIH1cbiAgICAgIHJlc3VsdC5ob3VzZWhvbGRBcnJheSA9IGhvdXNlaG9sZEFycmF5O1xuXG4gICAgICBsZXQgcG9zc2libGVIb3VzZWhvbGRBcnJheUZpZWxkcyA9IFtcbiAgICAgICAgXCJuYW1lXCIsXG4gICAgICAgIFwicmVsYXRpb25zaGlwXCIsXG4gICAgICAgIFwibWFyaXRhbFN0YXR1c1wiLFxuICAgICAgICBcImdlbmRlclwiLFxuICAgICAgICBcImFnZVwiLFxuICAgICAgICBcImJpcnRoWWVhclwiLFxuICAgICAgICBcIm9jY3VwYXRpb25cIixcbiAgICAgICAgXCJiaXJ0aFBsYWNlXCIsXG4gICAgICBdO1xuXG4gICAgICBsZXQgaG91c2Vob2xkQXJyYXlGaWVsZHMgPSBbXTtcbiAgICAgIGZvciAobGV0IGZpZWxkIG9mIHBvc3NpYmxlSG91c2Vob2xkQXJyYXlGaWVsZHMpIHtcbiAgICAgICAgaWYgKGZpZWxkc0VuY291bnRlcmVkW2ZpZWxkXSkge1xuICAgICAgICAgIGhvdXNlaG9sZEFycmF5RmllbGRzLnB1c2goZmllbGQpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXN1bHQuaG91c2Vob2xkQXJyYXlGaWVsZHMgPSBob3VzZWhvbGRBcnJheUZpZWxkcztcbiAgICB9XG4gIH1cbn1cblxuZnVuY3Rpb24gZ2VuZXJhbGl6ZURhdGFGb3JQZXJzb24oZGF0YSwgcmVzdWx0KSB7XG4gIGZ1bmN0aW9uIHNldE5hbWUoZGF0YU9iamVjdCwgcmVzdWx0T2JqZWN0KSB7XG4gICAgaWYgKGRhdGFPYmplY3QuZnVsbE5hbWUpIHtcbiAgICAgIHJlc3VsdE9iamVjdC5uYW1lLm5hbWUgPSBkYXRhT2JqZWN0LmZ1bGxOYW1lO1xuICAgIH1cbiAgICBpZiAoZGF0YU9iamVjdC5zdXJuYW1lKSB7XG4gICAgICByZXN1bHRPYmplY3QubmFtZS5sYXN0TmFtZSA9IGRhdGFPYmplY3Quc3VybmFtZTtcbiAgICB9XG4gICAgaWYgKGRhdGFPYmplY3QuZ2l2ZW5OYW1lKSB7XG4gICAgICByZXN1bHRPYmplY3QubmFtZS5mb3JlbmFtZXMgPSBkYXRhT2JqZWN0LmdpdmVuTmFtZTtcbiAgICB9XG4gICAgaWYgKGRhdGFPYmplY3QucHJlZml4KSB7XG4gICAgICByZXN1bHRPYmplY3QubmFtZS5wcmVmaXggPSBkYXRhT2JqZWN0LnByZWZpeDtcbiAgICB9XG4gICAgaWYgKGRhdGFPYmplY3Quc3VmZml4KSB7XG4gICAgICByZXN1bHRPYmplY3QubmFtZS5zdWZmaXggPSBkYXRhT2JqZWN0LnN1ZmZpeDtcbiAgICB9XG4gIH1cblxuICAvLyB3ZSB3aWxsIGFscmVhZHkgaGF2ZSBzZXQgZnVsbE5hbWUgYnV0IHRyeSB0byBnZXQgdGhlIGZvcm5hbWVzIGFuZCBsYXN0IG5hbWVzXG4gIHNldE5hbWUoZGF0YSwgcmVzdWx0KTtcblxuICBpZiAoZGF0YS5zcG91c2VzKSB7XG4gICAgcmVzdWx0LnNwb3VzZXMgPSBbXTtcblxuICAgIGZvciAobGV0IHNwb3VzZSBvZiBkYXRhLnNwb3VzZXMpIHtcbiAgICAgIGxldCByZXN1bHRTcG91c2UgPSB7fTtcblxuICAgICAgaWYgKHNwb3VzZS5mdWxsTmFtZSB8fCBzcG91c2Uuc3VybmFtZSB8fCBzcG91c2UuZ2l2ZW5OYW1lKSB7XG4gICAgICAgIHJlc3VsdFNwb3VzZS5uYW1lID0gbmV3IFd0c05hbWUoKTtcbiAgICAgICAgc2V0TmFtZShzcG91c2UsIHJlc3VsdFNwb3VzZSk7XG4gICAgICB9XG5cbiAgICAgIGlmIChzcG91c2UubWFycmlhZ2VEYXRlIHx8IHNwb3VzZS5tYXJyaWFnZURhdGVPcmlnaW5hbCkge1xuICAgICAgICByZXN1bHRTcG91c2UubWFycmlhZ2VEYXRlID0gbmV3IFd0c0RhdGUoKTtcbiAgICAgICAgcmVzdWx0U3BvdXNlLm1hcnJpYWdlRGF0ZS5kYXRlU3RyaW5nID0gc2VsZWN0RGF0ZShzcG91c2UubWFycmlhZ2VEYXRlLCBzcG91c2UubWFycmlhZ2VEYXRlT3JpZ2luYWwpO1xuICAgICAgfVxuXG4gICAgICBpZiAoc3BvdXNlLm1hcnJpYWdlUGxhY2UgfHwgc3BvdXNlLm1hcnJpYWdlUGxhY2VPcmlnaW5hbCkge1xuICAgICAgICByZXN1bHRTcG91c2UubWFycmlhZ2VQbGFjZSA9IG5ldyBXdHNQbGFjZSgpO1xuICAgICAgICByZXN1bHRTcG91c2UubWFycmlhZ2VQbGFjZS5wbGFjZVN0cmluZyA9IHNlbGVjdFBsYWNlKHNwb3VzZS5tYXJyaWFnZVBsYWNlLCBzcG91c2UubWFycmlhZ2VQbGFjZU9yaWdpbmFsKTtcbiAgICAgIH1cblxuICAgICAgcmVzdWx0LnNwb3VzZXMucHVzaChyZXN1bHRTcG91c2UpO1xuICAgIH1cbiAgfVxuXG4gIGlmIChkYXRhLmZhdGhlcikge1xuICAgIGxldCBmYXRoZXIgPSByZXN1bHQuYWRkRmF0aGVyKCk7XG4gICAgc2V0TmFtZShkYXRhLmZhdGhlciwgZmF0aGVyKTtcbiAgfVxuXG4gIGlmIChkYXRhLm1vdGhlcikge1xuICAgIGxldCBtb3RoZXIgPSByZXN1bHQuYWRkTW90aGVyKCk7XG4gICAgc2V0TmFtZShkYXRhLm1vdGhlciwgbW90aGVyKTtcbiAgfVxufVxuXG4vLyBUaGlzIGZ1bmN0aW9uIGdlbmVyYWxpemVzIHRoZSBkYXRhIGV4dHJhY3RlZCBmcm9tIGEgRmFtaWx5U2VhcmNoIHBhZ2UuXG4vLyBXZSBrbm93IHdoYXQgZmllbGRzIGNhbiBiZSB0aGVyZS4gQW5kIHdlIGtub3cgdGhlIG9uZXMgd2Ugd2FudCBpbiBnZW5lcmFsaXplZERhdGEuXG5mdW5jdGlvbiBnZW5lcmFsaXplRGF0YShpbnB1dCkge1xuICBsZXQgZGF0YSA9IGlucHV0LmV4dHJhY3RlZERhdGE7XG5cbiAgbGV0IHJlc3VsdCA9IG5ldyBHZW5lcmFsaXplZERhdGEoKTtcblxuICBpZiAoZGF0YS5wYWdlVHlwZSA9PSBcInBlcnNvblwiKSB7XG4gICAgcmVzdWx0LnNvdXJjZVR5cGUgPSBcInByb2ZpbGVcIjtcbiAgfSBlbHNlIHtcbiAgICByZXN1bHQuc291cmNlVHlwZSA9IFwicmVjb3JkXCI7XG4gICAgZGV0ZXJtaW5lUmVjb3JkVHlwZUFuZFJvbGUoZGF0YSwgcmVzdWx0KTtcbiAgfVxuXG4gIHJlc3VsdC5zb3VyY2VPZkRhdGEgPSBcImZzXCI7XG5cbiAgcmVzdWx0LnNldFBlcnNvbkdlbmRlcihkYXRhLmdlbmRlcik7XG5cbiAgcmVzdWx0LnNldEZ1bGxOYW1lKGRhdGEuZnVsbE5hbWUpO1xuXG4gIGxldCBiaXJ0aERhdGUgPSBzZWxlY3REYXRlKGRhdGEuYmlydGhEYXRlLCBkYXRhLmJpcnRoRGF0ZU9yaWdpbmFsKTtcbiAgcmVzdWx0LnNldEJpcnRoRGF0ZShiaXJ0aERhdGUpO1xuICByZXN1bHQuc2V0QmlydGhZZWFyKGRhdGEuYmlydGhZZWFyKTtcbiAgbGV0IGJpcnRoUGxhY2UgPSBzZWxlY3RQbGFjZShkYXRhLmJpcnRoUGxhY2UsIGRhdGEuYmlydGhQbGFjZU9yaWdpbmFsKTtcbiAgcmVzdWx0LnNldEJpcnRoUGxhY2UoYmlydGhQbGFjZSk7XG5cbiAgbGV0IGRlYXRoRGF0ZSA9IHNlbGVjdERhdGUoZGF0YS5kZWF0aERhdGUsIGRhdGEuZGVhdGhEYXRlT3JpZ2luYWwpO1xuICByZXN1bHQuc2V0RGVhdGhEYXRlKGRlYXRoRGF0ZSk7XG4gIHJlc3VsdC5zZXREZWF0aFllYXIoZGF0YS5kZWF0aFllYXIpO1xuXG4gIGxldCBkZWF0aFBsYWNlID0gc2VsZWN0UGxhY2UoZGF0YS5kZWF0aFBsYWNlLCBkYXRhLmRlYXRoUGxhY2VPcmlnaW5hbCk7XG4gIHJlc3VsdC5zZXREZWF0aFBsYWNlKGRlYXRoUGxhY2UpO1xuXG4gIGxldCBldmVudERhdGUgPSBzZWxlY3REYXRlKGRhdGEuZXZlbnREYXRlLCBkYXRhLmV2ZW50RGF0ZU9yaWdpbmFsKTtcbiAgcmVzdWx0LnNldEV2ZW50RGF0ZShldmVudERhdGUpO1xuICByZXN1bHQuc2V0RXZlbnRZZWFyKGRhdGEuZXZlbnRZZWFyKTtcblxuICBsZXQgZXZlbnRQbGFjZSA9IHNlbGVjdFBsYWNlKGRhdGEuZXZlbnRQbGFjZSwgZGF0YS5ldmVudFBsYWNlT3JpZ2luYWwpO1xuXG4gIGlmICghZXZlbnRQbGFjZSkge1xuICAgIC8vIHNvbWV0aW1lcyB0aGUgZXZlbnQgcGxhY2UgaW5mbyBpcyBpbiBvdGhlciBmaWVsZHNcbiAgICBldmVudFBsYWNlID0gXCJcIjtcbiAgICBpZiAoZGF0YS5ldmVudENpdHkpIHtcbiAgICAgIGV2ZW50UGxhY2UgKz0gZGF0YS5ldmVudENpdHk7XG4gICAgfVxuICAgIGlmIChkYXRhLmV2ZW50Q291bnR5KSB7XG4gICAgICBpZiAoZXZlbnRQbGFjZSkge1xuICAgICAgICBldmVudFBsYWNlICs9IFwiLCBcIjtcbiAgICAgIH1cbiAgICAgIGV2ZW50UGxhY2UgKz0gZGF0YS5ldmVudENvdW50eTtcbiAgICB9XG4gICAgaWYgKGRhdGEuZXZlbnRTdGF0ZSkge1xuICAgICAgaWYgKGV2ZW50UGxhY2UpIHtcbiAgICAgICAgZXZlbnRQbGFjZSArPSBcIiwgXCI7XG4gICAgICB9XG4gICAgICBldmVudFBsYWNlICs9IGRhdGEuZXZlbnRTdGF0ZTtcbiAgICB9XG4gICAgaWYgKGRhdGEuZXZlbnRDb3VudHJ5KSB7XG4gICAgICBpZiAoZXZlbnRQbGFjZSkge1xuICAgICAgICBldmVudFBsYWNlICs9IFwiLCBcIjtcbiAgICAgIH1cbiAgICAgIGV2ZW50UGxhY2UgKz0gZGF0YS5ldmVudENvdW50cnk7XG4gICAgfVxuICB9XG5cbiAgcmVzdWx0LnNldEV2ZW50UGxhY2UoZXZlbnRQbGFjZSk7XG5cbiAgbGV0IHJlc2lkZW5jZVBsYWNlID0gZGF0YS5yZXNpZGVuY2U7XG4gIGlmICghcmVzaWRlbmNlUGxhY2UgJiYgZGF0YS5yZWNvcmREYXRhICYmIGRhdGEucmVjb3JkRGF0YVtcIk5vdGUgUmVzIFBsYWNlXCJdKSB7XG4gICAgLy8gc29tZXRpbWVzIHRoaXMgaXMgYSBmaWVsZCB0aGF0IGlzIG5vdCBvbiB0aGUgcmVzaWRlbmNlIGZhY3RcbiAgICByZXNpZGVuY2VQbGFjZSA9IGRhdGEucmVjb3JkRGF0YVtcIk5vdGUgUmVzIFBsYWNlXCJdO1xuICB9XG4gIGlmIChyZXNpZGVuY2VQbGFjZSAmJiByZXN1bHQuZXZlbnRQbGFjZSkge1xuICAgIC8vIGF0IGxlYXN0IGluIDE4NDEgY2Vuc3VzIHRoaXMgaXMgdGhlIHN0cmVlIGFkZHJlc3NcbiAgICByZXN1bHQuZXZlbnRQbGFjZS5zdHJlZXRBZGRyZXNzID0gcmVzaWRlbmNlUGxhY2U7XG4gIH1cblxuICBpZiAocmVzdWx0LmV2ZW50UGxhY2UpIHtcbiAgICAvLyB0aGVyZSBpcyBhbiBldmVudCBwbGFjZS4gQnV0IHNvbWV0aW1lcyB0aGlzIGlzbid0IHJlYWxseSB0aGUgZXZlbnQgcGxhY2VcbiAgICAvLyBGb3IgZXhhbXBsZSBmb3IgVVMgU1MgRGVhdGggSW5kZXggaXQgaXMgdGhlIGxhc3QgcmVzaWRlbmNlIHBsYWNlXG4gICAgaWYgKGRhdGEuY29sbGVjdGlvblRpdGxlID09IFwiVW5pdGVkIFN0YXRlcyBTb2NpYWwgU2VjdXJpdHkgRGVhdGggSW5kZXhcIikge1xuICAgICAgcmVzdWx0LnJlc2lkZW5jZVBsYWNlID0gcmVzdWx0LmV2ZW50UGxhY2U7XG4gICAgICBkZWxldGUgcmVzdWx0LmV2ZW50UGxhY2U7XG4gICAgfVxuICB9XG5cbiAgaWYgKGRhdGEucmVnaXN0cmF0aW9uRGlzdHJpY3QpIHtcbiAgICByZXN1bHQucmVnaXN0cmF0aW9uRGlzdHJpY3QgPSBkYXRhLnJlZ2lzdHJhdGlvbkRpc3RyaWN0O1xuICB9XG5cbiAgaWYgKGRhdGEucmVnaXN0cmF0aW9uUXVhcnRlcikge1xuICAgIGxldCBxdWFydGVyID0gLTE7XG4gICAgbGV0IGZzUXVhcnRlciA9IGRhdGEucmVnaXN0cmF0aW9uUXVhcnRlcjtcbiAgICBmb3IgKGxldCBxdWFydGVyTmFtZSBvZiBxdWFydGVyTmFtZXMpIHtcbiAgICAgIGlmIChmc1F1YXJ0ZXIgPT0gcXVhcnRlck5hbWUubmFtZSkge1xuICAgICAgICBxdWFydGVyID0gcXVhcnRlck5hbWUudmFsdWU7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAocXVhcnRlciAhPSAtMSkge1xuICAgICAgcmVzdWx0LnNldEV2ZW50UXVhcnRlcihxdWFydGVyKTtcbiAgICB9XG4gIH1cblxuICBpZiAoZGF0YS5wYWdlVHlwZSA9PSBcInBlcnNvblwiKSB7XG4gICAgZ2VuZXJhbGl6ZURhdGFGb3JQZXJzb24oZGF0YSwgcmVzdWx0KTtcbiAgfSBlbHNlIHtcbiAgICBnZW5lcmFsaXplRGF0YUdpdmVuUmVjb3JkVHlwZShkYXRhLCByZXN1bHQpO1xuICB9XG5cbiAgaWYgKGRhdGEuaG91c2Vob2xkICYmIGRhdGEuaG91c2Vob2xkLm1lbWJlcnMpIHtcbiAgICBsZXQgc2VsZWN0ZWRNZW1iZXIgPSB1bmRlZmluZWQ7XG4gICAgZm9yIChsZXQgbWVtYmVyIG9mIGRhdGEuaG91c2Vob2xkLm1lbWJlcnMpIHtcbiAgICAgIGlmIChtZW1iZXIuaXNTZWxlY3RlZCkge1xuICAgICAgICBzZWxlY3RlZE1lbWJlciA9IG1lbWJlcjtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKHNlbGVjdGVkTWVtYmVyKSB7XG4gICAgICByZXN1bHQuc2V0TWFyaXRhbFN0YXR1cyhzZWxlY3RlZE1lbWJlci5tYXJpdGFsU3RhdHVzKTtcbiAgICAgIHJlc3VsdC5zZXRSZWxhdGlvbnNoaXBUb0hlYWQoc2VsZWN0ZWRNZW1iZXIucmVsYXRpb25zaGlwKTtcbiAgICB9XG4gIH1cblxuICBpZiAoIXJlc3VsdC5tYXJpdGFsU3RhdHVzICYmIGRhdGEucmVjb3JkRGF0YSkge1xuICAgIHJlc3VsdC5zZXRNYXJpdGFsU3RhdHVzKGRhdGEucmVjb3JkRGF0YVtcIk1hcml0YWxTdGF0dXNcIl0pO1xuICB9XG5cbiAgaWYgKGRhdGEuaG91c2Vob2xkICYmIGRhdGEuaG91c2Vob2xkLm1lbWJlcnMpIHtcbiAgICAvLyBXZSBjYW4gYWxzbyBkZXRlcm1pbmUgcGFyZW50cyBhbmQgc3BvdXNlIGluIHNvbWUgY2FzZXNcbiAgICByZXN1bHQuYWRkU3BvdXNlT3JQYXJlbnRzRm9yU2VsZWN0ZWRIb3VzZWhvbGRNZW1iZXIoKTtcblxuICAgIGlmIChyZXN1bHQuc3BvdXNlcyAmJiByZXN1bHQuc3BvdXNlcy5sZW5ndGggPT0gMSkge1xuICAgICAgbGV0IHllYXJzTWFycmllZCA9IGRhdGEucmVjb3JkRGF0YVtcIkNudCBZZWFycyBNYXJyaWVkXCJdO1xuICAgICAgaWYgKHllYXJzTWFycmllZCkge1xuICAgICAgICBsZXQgY2Vuc3VzRGF0ZSA9IHJlc3VsdC5pbmZlckV2ZW50RGF0ZSgpO1xuICAgICAgICBsZXQgbWFycmlhZ2VEYXRlU3RyaW5nID0gR2VuZXJhbGl6ZWREYXRhLmdldFN1YnRyYWN0QWdlRnJvbURhdGUoY2Vuc3VzRGF0ZSwgeWVhcnNNYXJyaWVkKTtcbiAgICAgICAgbGV0IG1hcnJpYWdlWWVhciA9IFdUU19TdHJpbmcuZ2V0TGFzdFdvcmQobWFycmlhZ2VEYXRlU3RyaW5nKTtcbiAgICAgICAgaWYgKG1hcnJpYWdlWWVhcikge1xuICAgICAgICAgIHJlc3VsdC5zcG91c2VzWzBdLm1hcnJpYWdlRGF0ZS55ZWFyU3RyaW5nID0gbWFycmlhZ2VZZWFyO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLy8gQ29sbGVjdGlvblxuICBpZiAoZGF0YS5mc0NvbGxlY3Rpb25JZCkge1xuICAgIHJlc3VsdC5jb2xsZWN0aW9uRGF0YSA9IHtcbiAgICAgIGlkOiBkYXRhLmZzQ29sbGVjdGlvbklkLFxuICAgIH07XG5cbiAgICBpZiAoZGF0YS5yZWZlcmVuY2VEYXRhKSB7XG4gICAgICBsZXQgcmVmRGF0YSA9IGRhdGEucmVmZXJlbmNlRGF0YTtcbiAgICAgIGlmIChyZWZEYXRhLnNvdXJjZVZvbHVtZSkge1xuICAgICAgICByZXN1bHQuY29sbGVjdGlvbkRhdGEudm9sdW1lID0gcmVmRGF0YS5zb3VyY2VWb2x1bWU7XG4gICAgICB9XG5cbiAgICAgIGlmIChyZWZEYXRhLnNvdXJjZVBhZ2VOYnIpIHtcbiAgICAgICAgcmVzdWx0LmNvbGxlY3Rpb25EYXRhLnBhZ2UgPSByZWZEYXRhLnNvdXJjZVBhZ2VOYnI7XG4gICAgICB9XG5cbiAgICAgIGlmIChyZWZEYXRhLnNvdXJjZVNjaGVkdWxlVHlwZSkge1xuICAgICAgICByZXN1bHQuY29sbGVjdGlvbkRhdGEuc2NoZWR1bGUgPSByZWZEYXRhLnNvdXJjZVNjaGVkdWxlVHlwZTtcbiAgICAgIH1cblxuICAgICAgaWYgKHJlZkRhdGEuc291cmNlUGllY2VGb2xpbykge1xuICAgICAgICBsZXQgcGYgPSByZWZEYXRhLnNvdXJjZVBpZWNlRm9saW87XG4gICAgICAgIGxldCBzbGFzaEluZGV4ID0gcGYuaW5kZXhPZihcIi9cIik7XG4gICAgICAgIGlmIChzbGFzaEluZGV4ICE9IC0xKSB7XG4gICAgICAgICAgcmVzdWx0LmNvbGxlY3Rpb25EYXRhLnBpZWNlID0gcGYuc3Vic3RyaW5nKDAsIHNsYXNoSW5kZXgpLnRyaW0oKTtcbiAgICAgICAgICByZXN1bHQuY29sbGVjdGlvbkRhdGEuZm9saW8gPSBwZi5zdWJzdHJpbmcoc2xhc2hJbmRleCArIDEpLnRyaW0oKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXN1bHQuY29sbGVjdGlvbkRhdGEuZm9saW8gPSBwZjtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHJlc3VsdC5oYXNWYWxpZERhdGEgPSB0cnVlO1xuXG4gIC8vY29uc29sZS5sb2coXCJFbmQgb2YgRmFtaWx5U2VhcmNoIGdlbmVyYWxpemVEYXRhLCByZXN1bHQgaXM6XCIpO1xuICAvL2NvbnNvbGUubG9nKHJlc3VsdCk7XG5cbiAgcmV0dXJuIHJlc3VsdDtcbn1cblxuZXhwb3J0IHsgZ2VuZXJhbGl6ZURhdGEsIGdlbmVyYWxpemVEYXRhR2l2ZW5SZWNvcmRUeXBlLCBHZW5lcmFsaXplZERhdGEsIGRhdGVRdWFsaWZpZXJzIH07XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./extension/site/fs/core/fs_generalize_data.mjs\n");

/***/ }),

/***/ "./extension/site/fs/core/fs_options.mjs":
/*!***********************************************!*\
  !*** ./extension/site/fs/core/fs_options.mjs ***!
  \***********************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _base_core_options_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../base/core/options/options_registry.mjs */ \"./extension/base/core/options/options_registry.mjs\");\n/*\nMIT License\n\nCopyright (c) 2020 Robert M Pavey\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.\n*/\n\n\n\nconst searchOptionsGroup = {\n  category: \"search\",\n  subcategory: \"fs\",\n  tab: \"search\",\n  subsection: \"fs\",\n  subheading: \"parameters\",\n  options: [\n    {\n      optionName: \"birthYearExactness\",\n      type: \"select\",\n      label: \"Search exactness to use for birth year\",\n      values: [\n        { value: \"none\", text: \"Do not specify a birth year\" },\n        { value: \"auto\", text: \"Set automatically based on source\" },\n        { value: \"exact\", text: \"Exact year only\" },\n        { value: 1, text: \"+/- 1 years\" },\n        { value: 2, text: \"+/- 2 years\" },\n        { value: 5, text: \"+/- 5 years\" },\n        { value: 10, text: \"+/- 10 years\" },\n      ],\n      defaultValue: \"auto\",\n    },\n    {\n      optionName: \"deathYearExactness\",\n      type: \"select\",\n      label: \"Search exactness to use for death year\",\n      values: [\n        { value: \"none\", text: \"Do not specify a death year\" },\n        { value: \"auto\", text: \"Set automatically based on source\" },\n        { value: \"exact\", text: \"Exact year only\" },\n        { value: 1, text: \"+/- 1 years\" },\n        { value: 2, text: \"+/- 2 years\" },\n        { value: 5, text: \"+/- 5 years\" },\n        { value: 10, text: \"+/- 10 years\" },\n      ],\n      defaultValue: \"auto\",\n    },\n    {\n      optionName: \"marriageYearExactness\",\n      type: \"select\",\n      label: \"Search exactness to use for marriage year\",\n      values: [\n        { value: \"none\", text: \"Do not specify a marriage year\" },\n        { value: \"auto\", text: \"Set automatically based on source\" },\n        { value: \"exact\", text: \"Exact year only\" },\n        { value: 1, text: \"+/- 1 years\" },\n        { value: 2, text: \"+/- 2 years\" },\n        { value: 5, text: \"+/- 5 years\" },\n        { value: 10, text: \"+/- 10 years\" },\n      ],\n      defaultValue: \"auto\",\n    },\n    {\n      optionName: \"residenceYearExactness\",\n      type: \"select\",\n      label: \"Search exactness to use for residence year\",\n      values: [\n        { value: \"none\", text: \"Do not specify a residence year\" },\n        { value: \"auto\", text: \"Set automatically based on source\" },\n        { value: \"exact\", text: \"Exact year only\" },\n        { value: 1, text: \"+/- 1 years\" },\n        { value: 2, text: \"+/- 2 years\" },\n        { value: 5, text: \"+/- 5 years\" },\n        { value: 10, text: \"+/- 10 years\" },\n      ],\n      defaultValue: \"auto\",\n    },\n  ],\n};\n\nconst citationOptionsGroup = {\n  category: \"citation\",\n  subcategory: \"fs\",\n  tab: \"citation\",\n  subsection: \"fs\",\n  options: [\n    {\n      optionName: \"sourceRef\",\n      type: \"select\",\n      label: \"Build source reference\",\n      values: [\n        { value: \"record\", text: \"From record data\" },\n        {\n          value: \"fsCitationShort\",\n          text: \"Reuse & abbreviate reference from citation on FamilySearch page\",\n        },\n        {\n          value: \"fsCitationLong\",\n          text: \"Reuse full reference from citation on FamilySearch page\",\n        },\n      ],\n      defaultValue: \"fsCitationShort\",\n    },\n    {\n      optionName: \"dataStyle\",\n      type: \"select\",\n      label: \"Include record data at end of citation as\",\n      values: [\n        { value: \"none\", text: \"Do not include data\" },\n        {\n          value: \"string\",\n          text: \"Sentence (fall back to list if no sentence)\",\n        },\n        { value: \"list\", text: \"List of field names/values\" },\n        { value: \"table\", text: \"Table of field names/values\" },\n        {\n          value: \"fsCitation\",\n          text: \"Reuse parts of the citation on the FamilySearch page\",\n        },\n      ],\n      defaultValue: \"string\",\n      unitTestValue: \"fsCitation\",\n    },\n    {\n      optionName: \"includeExternalImageLink\",\n      type: \"checkbox\",\n      label: \"Include a link to an external image if available\",\n      defaultValue: true,\n    },\n    {\n      optionName: \"subscriptionRequired\",\n      type: \"select\",\n      label: \"Indicate that a subscription is required with FMP link\",\n      values: [\n        { value: \"none\", text: \"Do not add any such indication\" },\n        {\n          value: \"subscriptionRequired\",\n          text: 'Include the text \"subscription required\"',\n        },\n        {\n          value: \"requiresSubscription\",\n          text: 'Include the text \"requires subscription\"',\n        },\n        { value: \"dollar\", text: 'Include the text \"$\"' },\n        { value: \"paywall\", text: 'Include the text \"paywall\"' },\n      ],\n      defaultValue: \"none\",\n      unitTestValue: \"subscriptionRequired\",\n    },\n  ],\n};\n\n(0,_base_core_options_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerSubsectionForOptions)(\"search\", \"fs\", \"FamilySearch\");\n(0,_base_core_options_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerSiteSearchPopupOptionsGroup)(\"fs\", 3, 3);\n(0,_base_core_options_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerSubheadingForOptions)(\"search\", \"fs\", \"parameters\", \"Search Parameters\");\n(0,_base_core_options_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerOptionsGroup)(searchOptionsGroup);\n\n(0,_base_core_options_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerOptionsGroup)(citationOptionsGroup);\n(0,_base_core_options_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerSubsectionForOptions)(\"citation\", \"fs\", \"FamilySearch\");\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9leHRlbnNpb24vc2l0ZS9mcy9jb3JlL2ZzX29wdGlvbnMubWpzLmpzIiwibWFwcGluZ3MiOiI7O0FBQUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQU95RDs7QUFFekQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVSxvREFBb0Q7QUFDOUQsVUFBVSwwREFBMEQ7QUFDcEUsVUFBVSx5Q0FBeUM7QUFDbkQsVUFBVSwrQkFBK0I7QUFDekMsVUFBVSwrQkFBK0I7QUFDekMsVUFBVSwrQkFBK0I7QUFDekMsVUFBVSxpQ0FBaUM7QUFDM0M7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVSxvREFBb0Q7QUFDOUQsVUFBVSwwREFBMEQ7QUFDcEUsVUFBVSx5Q0FBeUM7QUFDbkQsVUFBVSwrQkFBK0I7QUFDekMsVUFBVSwrQkFBK0I7QUFDekMsVUFBVSwrQkFBK0I7QUFDekMsVUFBVSxpQ0FBaUM7QUFDM0M7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVSx1REFBdUQ7QUFDakUsVUFBVSwwREFBMEQ7QUFDcEUsVUFBVSx5Q0FBeUM7QUFDbkQsVUFBVSwrQkFBK0I7QUFDekMsVUFBVSwrQkFBK0I7QUFDekMsVUFBVSwrQkFBK0I7QUFDekMsVUFBVSxpQ0FBaUM7QUFDM0M7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVSx3REFBd0Q7QUFDbEUsVUFBVSwwREFBMEQ7QUFDcEUsVUFBVSx5Q0FBeUM7QUFDbkQsVUFBVSwrQkFBK0I7QUFDekMsVUFBVSwrQkFBK0I7QUFDekMsVUFBVSwrQkFBK0I7QUFDekMsVUFBVSxpQ0FBaUM7QUFDM0M7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVLDJDQUEyQztBQUNyRDtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVUsNENBQTRDO0FBQ3REO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVCxVQUFVLG1EQUFtRDtBQUM3RCxVQUFVLHFEQUFxRDtBQUMvRDtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVUsdURBQXVEO0FBQ2pFO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1QsVUFBVSwrQ0FBK0M7QUFDekQsVUFBVSxzREFBc0Q7QUFDaEU7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7O0FBRUEscUdBQTRCO0FBQzVCLDRHQUFtQztBQUNuQyxxR0FBNEI7QUFDNUIsNkZBQW9COztBQUVwQiw2RkFBb0I7QUFDcEIscUdBQTRCIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vQ2l0YXRpb25FeHRyYWN0b3IvLi9leHRlbnNpb24vc2l0ZS9mcy9jb3JlL2ZzX29wdGlvbnMubWpzP2NkMTciXSwic291cmNlc0NvbnRlbnQiOlsiLypcbk1JVCBMaWNlbnNlXG5cbkNvcHlyaWdodCAoYykgMjAyMCBSb2JlcnQgTSBQYXZleVxuXG5QZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYSBjb3B5XG5vZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSBcIlNvZnR3YXJlXCIpLCB0byBkZWFsXG5pbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzXG50byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsXG5jb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXNcbmZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6XG5cblRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkIGluIGFsbFxuY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS5cblxuVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEIFwiQVMgSVNcIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUlxuSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksXG5GSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEVcbkFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVJcbkxJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sXG5PVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOIFRIRVxuU09GVFdBUkUuXG4qL1xuXG5pbXBvcnQge1xuICByZWdpc3RlclN1YnNlY3Rpb25Gb3JPcHRpb25zLFxuICByZWdpc3RlclN1YmhlYWRpbmdGb3JPcHRpb25zLFxuICByZWdpc3Rlck9wdGlvbnNHcm91cCxcbiAgcmVnaXN0ZXJTaXRlU2VhcmNoUG9wdXBPcHRpb25zR3JvdXAsXG59IGZyb20gXCIuLi8uLi8uLi9iYXNlL2NvcmUvb3B0aW9ucy9vcHRpb25zX3JlZ2lzdHJ5Lm1qc1wiO1xuXG5jb25zdCBzZWFyY2hPcHRpb25zR3JvdXAgPSB7XG4gIGNhdGVnb3J5OiBcInNlYXJjaFwiLFxuICBzdWJjYXRlZ29yeTogXCJmc1wiLFxuICB0YWI6IFwic2VhcmNoXCIsXG4gIHN1YnNlY3Rpb246IFwiZnNcIixcbiAgc3ViaGVhZGluZzogXCJwYXJhbWV0ZXJzXCIsXG4gIG9wdGlvbnM6IFtcbiAgICB7XG4gICAgICBvcHRpb25OYW1lOiBcImJpcnRoWWVhckV4YWN0bmVzc1wiLFxuICAgICAgdHlwZTogXCJzZWxlY3RcIixcbiAgICAgIGxhYmVsOiBcIlNlYXJjaCBleGFjdG5lc3MgdG8gdXNlIGZvciBiaXJ0aCB5ZWFyXCIsXG4gICAgICB2YWx1ZXM6IFtcbiAgICAgICAgeyB2YWx1ZTogXCJub25lXCIsIHRleHQ6IFwiRG8gbm90IHNwZWNpZnkgYSBiaXJ0aCB5ZWFyXCIgfSxcbiAgICAgICAgeyB2YWx1ZTogXCJhdXRvXCIsIHRleHQ6IFwiU2V0IGF1dG9tYXRpY2FsbHkgYmFzZWQgb24gc291cmNlXCIgfSxcbiAgICAgICAgeyB2YWx1ZTogXCJleGFjdFwiLCB0ZXh0OiBcIkV4YWN0IHllYXIgb25seVwiIH0sXG4gICAgICAgIHsgdmFsdWU6IDEsIHRleHQ6IFwiKy8tIDEgeWVhcnNcIiB9LFxuICAgICAgICB7IHZhbHVlOiAyLCB0ZXh0OiBcIisvLSAyIHllYXJzXCIgfSxcbiAgICAgICAgeyB2YWx1ZTogNSwgdGV4dDogXCIrLy0gNSB5ZWFyc1wiIH0sXG4gICAgICAgIHsgdmFsdWU6IDEwLCB0ZXh0OiBcIisvLSAxMCB5ZWFyc1wiIH0sXG4gICAgICBdLFxuICAgICAgZGVmYXVsdFZhbHVlOiBcImF1dG9cIixcbiAgICB9LFxuICAgIHtcbiAgICAgIG9wdGlvbk5hbWU6IFwiZGVhdGhZZWFyRXhhY3RuZXNzXCIsXG4gICAgICB0eXBlOiBcInNlbGVjdFwiLFxuICAgICAgbGFiZWw6IFwiU2VhcmNoIGV4YWN0bmVzcyB0byB1c2UgZm9yIGRlYXRoIHllYXJcIixcbiAgICAgIHZhbHVlczogW1xuICAgICAgICB7IHZhbHVlOiBcIm5vbmVcIiwgdGV4dDogXCJEbyBub3Qgc3BlY2lmeSBhIGRlYXRoIHllYXJcIiB9LFxuICAgICAgICB7IHZhbHVlOiBcImF1dG9cIiwgdGV4dDogXCJTZXQgYXV0b21hdGljYWxseSBiYXNlZCBvbiBzb3VyY2VcIiB9LFxuICAgICAgICB7IHZhbHVlOiBcImV4YWN0XCIsIHRleHQ6IFwiRXhhY3QgeWVhciBvbmx5XCIgfSxcbiAgICAgICAgeyB2YWx1ZTogMSwgdGV4dDogXCIrLy0gMSB5ZWFyc1wiIH0sXG4gICAgICAgIHsgdmFsdWU6IDIsIHRleHQ6IFwiKy8tIDIgeWVhcnNcIiB9LFxuICAgICAgICB7IHZhbHVlOiA1LCB0ZXh0OiBcIisvLSA1IHllYXJzXCIgfSxcbiAgICAgICAgeyB2YWx1ZTogMTAsIHRleHQ6IFwiKy8tIDEwIHllYXJzXCIgfSxcbiAgICAgIF0sXG4gICAgICBkZWZhdWx0VmFsdWU6IFwiYXV0b1wiLFxuICAgIH0sXG4gICAge1xuICAgICAgb3B0aW9uTmFtZTogXCJtYXJyaWFnZVllYXJFeGFjdG5lc3NcIixcbiAgICAgIHR5cGU6IFwic2VsZWN0XCIsXG4gICAgICBsYWJlbDogXCJTZWFyY2ggZXhhY3RuZXNzIHRvIHVzZSBmb3IgbWFycmlhZ2UgeWVhclwiLFxuICAgICAgdmFsdWVzOiBbXG4gICAgICAgIHsgdmFsdWU6IFwibm9uZVwiLCB0ZXh0OiBcIkRvIG5vdCBzcGVjaWZ5IGEgbWFycmlhZ2UgeWVhclwiIH0sXG4gICAgICAgIHsgdmFsdWU6IFwiYXV0b1wiLCB0ZXh0OiBcIlNldCBhdXRvbWF0aWNhbGx5IGJhc2VkIG9uIHNvdXJjZVwiIH0sXG4gICAgICAgIHsgdmFsdWU6IFwiZXhhY3RcIiwgdGV4dDogXCJFeGFjdCB5ZWFyIG9ubHlcIiB9LFxuICAgICAgICB7IHZhbHVlOiAxLCB0ZXh0OiBcIisvLSAxIHllYXJzXCIgfSxcbiAgICAgICAgeyB2YWx1ZTogMiwgdGV4dDogXCIrLy0gMiB5ZWFyc1wiIH0sXG4gICAgICAgIHsgdmFsdWU6IDUsIHRleHQ6IFwiKy8tIDUgeWVhcnNcIiB9LFxuICAgICAgICB7IHZhbHVlOiAxMCwgdGV4dDogXCIrLy0gMTAgeWVhcnNcIiB9LFxuICAgICAgXSxcbiAgICAgIGRlZmF1bHRWYWx1ZTogXCJhdXRvXCIsXG4gICAgfSxcbiAgICB7XG4gICAgICBvcHRpb25OYW1lOiBcInJlc2lkZW5jZVllYXJFeGFjdG5lc3NcIixcbiAgICAgIHR5cGU6IFwic2VsZWN0XCIsXG4gICAgICBsYWJlbDogXCJTZWFyY2ggZXhhY3RuZXNzIHRvIHVzZSBmb3IgcmVzaWRlbmNlIHllYXJcIixcbiAgICAgIHZhbHVlczogW1xuICAgICAgICB7IHZhbHVlOiBcIm5vbmVcIiwgdGV4dDogXCJEbyBub3Qgc3BlY2lmeSBhIHJlc2lkZW5jZSB5ZWFyXCIgfSxcbiAgICAgICAgeyB2YWx1ZTogXCJhdXRvXCIsIHRleHQ6IFwiU2V0IGF1dG9tYXRpY2FsbHkgYmFzZWQgb24gc291cmNlXCIgfSxcbiAgICAgICAgeyB2YWx1ZTogXCJleGFjdFwiLCB0ZXh0OiBcIkV4YWN0IHllYXIgb25seVwiIH0sXG4gICAgICAgIHsgdmFsdWU6IDEsIHRleHQ6IFwiKy8tIDEgeWVhcnNcIiB9LFxuICAgICAgICB7IHZhbHVlOiAyLCB0ZXh0OiBcIisvLSAyIHllYXJzXCIgfSxcbiAgICAgICAgeyB2YWx1ZTogNSwgdGV4dDogXCIrLy0gNSB5ZWFyc1wiIH0sXG4gICAgICAgIHsgdmFsdWU6IDEwLCB0ZXh0OiBcIisvLSAxMCB5ZWFyc1wiIH0sXG4gICAgICBdLFxuICAgICAgZGVmYXVsdFZhbHVlOiBcImF1dG9cIixcbiAgICB9LFxuICBdLFxufTtcblxuY29uc3QgY2l0YXRpb25PcHRpb25zR3JvdXAgPSB7XG4gIGNhdGVnb3J5OiBcImNpdGF0aW9uXCIsXG4gIHN1YmNhdGVnb3J5OiBcImZzXCIsXG4gIHRhYjogXCJjaXRhdGlvblwiLFxuICBzdWJzZWN0aW9uOiBcImZzXCIsXG4gIG9wdGlvbnM6IFtcbiAgICB7XG4gICAgICBvcHRpb25OYW1lOiBcInNvdXJjZVJlZlwiLFxuICAgICAgdHlwZTogXCJzZWxlY3RcIixcbiAgICAgIGxhYmVsOiBcIkJ1aWxkIHNvdXJjZSByZWZlcmVuY2VcIixcbiAgICAgIHZhbHVlczogW1xuICAgICAgICB7IHZhbHVlOiBcInJlY29yZFwiLCB0ZXh0OiBcIkZyb20gcmVjb3JkIGRhdGFcIiB9LFxuICAgICAgICB7XG4gICAgICAgICAgdmFsdWU6IFwiZnNDaXRhdGlvblNob3J0XCIsXG4gICAgICAgICAgdGV4dDogXCJSZXVzZSAmIGFiYnJldmlhdGUgcmVmZXJlbmNlIGZyb20gY2l0YXRpb24gb24gRmFtaWx5U2VhcmNoIHBhZ2VcIixcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIHZhbHVlOiBcImZzQ2l0YXRpb25Mb25nXCIsXG4gICAgICAgICAgdGV4dDogXCJSZXVzZSBmdWxsIHJlZmVyZW5jZSBmcm9tIGNpdGF0aW9uIG9uIEZhbWlseVNlYXJjaCBwYWdlXCIsXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgICAgZGVmYXVsdFZhbHVlOiBcImZzQ2l0YXRpb25TaG9ydFwiLFxuICAgIH0sXG4gICAge1xuICAgICAgb3B0aW9uTmFtZTogXCJkYXRhU3R5bGVcIixcbiAgICAgIHR5cGU6IFwic2VsZWN0XCIsXG4gICAgICBsYWJlbDogXCJJbmNsdWRlIHJlY29yZCBkYXRhIGF0IGVuZCBvZiBjaXRhdGlvbiBhc1wiLFxuICAgICAgdmFsdWVzOiBbXG4gICAgICAgIHsgdmFsdWU6IFwibm9uZVwiLCB0ZXh0OiBcIkRvIG5vdCBpbmNsdWRlIGRhdGFcIiB9LFxuICAgICAgICB7XG4gICAgICAgICAgdmFsdWU6IFwic3RyaW5nXCIsXG4gICAgICAgICAgdGV4dDogXCJTZW50ZW5jZSAoZmFsbCBiYWNrIHRvIGxpc3QgaWYgbm8gc2VudGVuY2UpXCIsXG4gICAgICAgIH0sXG4gICAgICAgIHsgdmFsdWU6IFwibGlzdFwiLCB0ZXh0OiBcIkxpc3Qgb2YgZmllbGQgbmFtZXMvdmFsdWVzXCIgfSxcbiAgICAgICAgeyB2YWx1ZTogXCJ0YWJsZVwiLCB0ZXh0OiBcIlRhYmxlIG9mIGZpZWxkIG5hbWVzL3ZhbHVlc1wiIH0sXG4gICAgICAgIHtcbiAgICAgICAgICB2YWx1ZTogXCJmc0NpdGF0aW9uXCIsXG4gICAgICAgICAgdGV4dDogXCJSZXVzZSBwYXJ0cyBvZiB0aGUgY2l0YXRpb24gb24gdGhlIEZhbWlseVNlYXJjaCBwYWdlXCIsXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgICAgZGVmYXVsdFZhbHVlOiBcInN0cmluZ1wiLFxuICAgICAgdW5pdFRlc3RWYWx1ZTogXCJmc0NpdGF0aW9uXCIsXG4gICAgfSxcbiAgICB7XG4gICAgICBvcHRpb25OYW1lOiBcImluY2x1ZGVFeHRlcm5hbEltYWdlTGlua1wiLFxuICAgICAgdHlwZTogXCJjaGVja2JveFwiLFxuICAgICAgbGFiZWw6IFwiSW5jbHVkZSBhIGxpbmsgdG8gYW4gZXh0ZXJuYWwgaW1hZ2UgaWYgYXZhaWxhYmxlXCIsXG4gICAgICBkZWZhdWx0VmFsdWU6IHRydWUsXG4gICAgfSxcbiAgICB7XG4gICAgICBvcHRpb25OYW1lOiBcInN1YnNjcmlwdGlvblJlcXVpcmVkXCIsXG4gICAgICB0eXBlOiBcInNlbGVjdFwiLFxuICAgICAgbGFiZWw6IFwiSW5kaWNhdGUgdGhhdCBhIHN1YnNjcmlwdGlvbiBpcyByZXF1aXJlZCB3aXRoIEZNUCBsaW5rXCIsXG4gICAgICB2YWx1ZXM6IFtcbiAgICAgICAgeyB2YWx1ZTogXCJub25lXCIsIHRleHQ6IFwiRG8gbm90IGFkZCBhbnkgc3VjaCBpbmRpY2F0aW9uXCIgfSxcbiAgICAgICAge1xuICAgICAgICAgIHZhbHVlOiBcInN1YnNjcmlwdGlvblJlcXVpcmVkXCIsXG4gICAgICAgICAgdGV4dDogJ0luY2x1ZGUgdGhlIHRleHQgXCJzdWJzY3JpcHRpb24gcmVxdWlyZWRcIicsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICB2YWx1ZTogXCJyZXF1aXJlc1N1YnNjcmlwdGlvblwiLFxuICAgICAgICAgIHRleHQ6ICdJbmNsdWRlIHRoZSB0ZXh0IFwicmVxdWlyZXMgc3Vic2NyaXB0aW9uXCInLFxuICAgICAgICB9LFxuICAgICAgICB7IHZhbHVlOiBcImRvbGxhclwiLCB0ZXh0OiAnSW5jbHVkZSB0aGUgdGV4dCBcIiRcIicgfSxcbiAgICAgICAgeyB2YWx1ZTogXCJwYXl3YWxsXCIsIHRleHQ6ICdJbmNsdWRlIHRoZSB0ZXh0IFwicGF5d2FsbFwiJyB9LFxuICAgICAgXSxcbiAgICAgIGRlZmF1bHRWYWx1ZTogXCJub25lXCIsXG4gICAgICB1bml0VGVzdFZhbHVlOiBcInN1YnNjcmlwdGlvblJlcXVpcmVkXCIsXG4gICAgfSxcbiAgXSxcbn07XG5cbnJlZ2lzdGVyU3Vic2VjdGlvbkZvck9wdGlvbnMoXCJzZWFyY2hcIiwgXCJmc1wiLCBcIkZhbWlseVNlYXJjaFwiKTtcbnJlZ2lzdGVyU2l0ZVNlYXJjaFBvcHVwT3B0aW9uc0dyb3VwKFwiZnNcIiwgMywgMyk7XG5yZWdpc3RlclN1YmhlYWRpbmdGb3JPcHRpb25zKFwic2VhcmNoXCIsIFwiZnNcIiwgXCJwYXJhbWV0ZXJzXCIsIFwiU2VhcmNoIFBhcmFtZXRlcnNcIik7XG5yZWdpc3Rlck9wdGlvbnNHcm91cChzZWFyY2hPcHRpb25zR3JvdXApO1xuXG5yZWdpc3Rlck9wdGlvbnNHcm91cChjaXRhdGlvbk9wdGlvbnNHcm91cCk7XG5yZWdpc3RlclN1YnNlY3Rpb25Gb3JPcHRpb25zKFwiY2l0YXRpb25cIiwgXCJmc1wiLCBcIkZhbWlseVNlYXJjaFwiKTtcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./extension/site/fs/core/fs_options.mjs\n");

/***/ }),

/***/ "./extension/site/geneteka/core/geneteka_options.mjs":
/*!***********************************************************!*\
  !*** ./extension/site/geneteka/core/geneteka_options.mjs ***!
  \***********************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _base_core_options_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../base/core/options/options_registry.mjs */ \"./extension/base/core/options/options_registry.mjs\");\n/*\nMIT License\n\nCopyright (c) 2020 Robert M Pavey\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.\n*/\n\n\n\n(0,_base_core_options_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerSubsectionForOptions)(\"search\", \"geneteka\", \"Geneteka\");\n(0,_base_core_options_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerSiteSearchPopupOptionsGroup)(\"geneteka\", 8, 8);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9leHRlbnNpb24vc2l0ZS9nZW5ldGVrYS9jb3JlL2dlbmV0ZWthX29wdGlvbnMubWpzLmpzIiwibWFwcGluZ3MiOiI7O0FBQUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUt5RDs7QUFFekQscUdBQTRCO0FBQzVCLDRHQUFtQyIsInNvdXJjZXMiOlsid2VicGFjazovL0NpdGF0aW9uRXh0cmFjdG9yLy4vZXh0ZW5zaW9uL3NpdGUvZ2VuZXRla2EvY29yZS9nZW5ldGVrYV9vcHRpb25zLm1qcz80OTc0Il0sInNvdXJjZXNDb250ZW50IjpbIi8qXG5NSVQgTGljZW5zZVxuXG5Db3B5cmlnaHQgKGMpIDIwMjAgUm9iZXJ0IE0gUGF2ZXlcblxuUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEgY29weVxub2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGUgXCJTb2Z0d2FyZVwiKSwgdG8gZGVhbFxuaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVzdHJpY3Rpb24sIGluY2x1ZGluZyB3aXRob3V0IGxpbWl0YXRpb24gdGhlIHJpZ2h0c1xudG8gdXNlLCBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLCBkaXN0cmlidXRlLCBzdWJsaWNlbnNlLCBhbmQvb3Igc2VsbFxuY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzXG5mdXJuaXNoZWQgdG8gZG8gc28sIHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZyBjb25kaXRpb25zOlxuXG5UaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZCBpbiBhbGxcbmNvcGllcyBvciBzdWJzdGFudGlhbCBwb3J0aW9ucyBvZiB0aGUgU29mdHdhcmUuXG5cblRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCBcIkFTIElTXCIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1JcbklNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLFxuRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFXG5BVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSXG5MSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLFxuT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTiBUSEVcblNPRlRXQVJFLlxuKi9cblxuaW1wb3J0IHtcbiAgcmVnaXN0ZXJTdWJzZWN0aW9uRm9yT3B0aW9ucyxcbiAgcmVnaXN0ZXJTaXRlU2VhcmNoUG9wdXBPcHRpb25zR3JvdXAsXG59IGZyb20gXCIuLi8uLi8uLi9iYXNlL2NvcmUvb3B0aW9ucy9vcHRpb25zX3JlZ2lzdHJ5Lm1qc1wiO1xuXG5yZWdpc3RlclN1YnNlY3Rpb25Gb3JPcHRpb25zKFwic2VhcmNoXCIsIFwiZ2VuZXRla2FcIiwgXCJHZW5ldGVrYVwiKTtcbnJlZ2lzdGVyU2l0ZVNlYXJjaFBvcHVwT3B0aW9uc0dyb3VwKFwiZ2VuZXRla2FcIiwgOCwgOCk7XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./extension/site/geneteka/core/geneteka_options.mjs\n");

/***/ }),

/***/ "./extension/site/gro/core/gro_options.mjs":
/*!*************************************************!*\
  !*** ./extension/site/gro/core/gro_options.mjs ***!
  \*************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _base_core_options_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../base/core/options/options_registry.mjs */ \"./extension/base/core/options/options_registry.mjs\");\n/*\nMIT License\n\nCopyright (c) 2020 Robert M Pavey\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.\n*/\n\n\n\nconst citationOptionsGroup = {\n  category: \"citation\",\n  subcategory: \"gro\",\n  tab: \"citation\",\n  subsection: \"gro\",\n  options: [\n    {\n      optionName: \"changeNamesToInitialCaps\",\n      type: \"checkbox\",\n      label: \"Change person and place names from all caps to initial caps\",\n      defaultValue: true,\n    },\n    {\n      optionName: \"referenceInItalics\",\n      type: \"checkbox\",\n      label: 'Put the text \"GRO Reference\" in italics',\n      defaultValue: true,\n    },\n    {\n      optionName: \"linkStyle\",\n      type: \"select\",\n      label: \"Link to GRO site by\",\n      values: [\n        { value: \"search\", text: \"Hyperlink with full search parameters\" },\n        { value: \"index\", text: \"Hyperlink to correct GRO index\" },\n        { value: \"content\", text: \"Hyperlink to GRO content site\" },\n        { value: \"url_content\", text: \"Visible URL to GRO content site\" },\n      ],\n      defaultValue: \"search\",\n    },\n    {\n      optionName: \"useDistrictUrl\",\n      type: \"checkbox\",\n      label: \"Add a link to the registration district page on ukbmd.org.uk\",\n      defaultValue: true,\n    },\n  ],\n};\n\n(0,_base_core_options_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerSubsectionForOptions)(\"search\", \"gro\", \"GRO (UK)\");\n(0,_base_core_options_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerSiteSearchPopupOptionsGroup)(\"gro\", 5, 5);\n\n(0,_base_core_options_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerSubsectionForOptions)(\"citation\", \"gro\", \"GRO (UK)\");\n(0,_base_core_options_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerOptionsGroup)(citationOptionsGroup);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9leHRlbnNpb24vc2l0ZS9ncm8vY29yZS9ncm9fb3B0aW9ucy5tanMuanMiLCJtYXBwaW5ncyI6Ijs7QUFBQTtBQUNBOztBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBT3lEOztBQUV6RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFVBQVUsZ0VBQWdFO0FBQzFFLFVBQVUsd0RBQXdEO0FBQ2xFLFVBQVUseURBQXlEO0FBQ25FLFVBQVUsK0RBQStEO0FBQ3pFO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBOztBQUVBLHFHQUE0QjtBQUM1Qiw0R0FBbUM7O0FBRW5DLHFHQUE0QjtBQUM1Qiw2RkFBb0IiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9DaXRhdGlvbkV4dHJhY3Rvci8uL2V4dGVuc2lvbi9zaXRlL2dyby9jb3JlL2dyb19vcHRpb25zLm1qcz9iYjhkIl0sInNvdXJjZXNDb250ZW50IjpbIi8qXG5NSVQgTGljZW5zZVxuXG5Db3B5cmlnaHQgKGMpIDIwMjAgUm9iZXJ0IE0gUGF2ZXlcblxuUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEgY29weVxub2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGUgXCJTb2Z0d2FyZVwiKSwgdG8gZGVhbFxuaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVzdHJpY3Rpb24sIGluY2x1ZGluZyB3aXRob3V0IGxpbWl0YXRpb24gdGhlIHJpZ2h0c1xudG8gdXNlLCBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLCBkaXN0cmlidXRlLCBzdWJsaWNlbnNlLCBhbmQvb3Igc2VsbFxuY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzXG5mdXJuaXNoZWQgdG8gZG8gc28sIHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZyBjb25kaXRpb25zOlxuXG5UaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZCBpbiBhbGxcbmNvcGllcyBvciBzdWJzdGFudGlhbCBwb3J0aW9ucyBvZiB0aGUgU29mdHdhcmUuXG5cblRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCBcIkFTIElTXCIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1JcbklNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLFxuRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFXG5BVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSXG5MSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLFxuT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTiBUSEVcblNPRlRXQVJFLlxuKi9cblxuaW1wb3J0IHtcbiAgcmVnaXN0ZXJTdWJzZWN0aW9uRm9yT3B0aW9ucyxcbiAgcmVnaXN0ZXJTdWJoZWFkaW5nRm9yT3B0aW9ucyxcbiAgcmVnaXN0ZXJPcHRpb25zR3JvdXAsXG4gIHJlZ2lzdGVyU2l0ZVNlYXJjaFBvcHVwT3B0aW9uc0dyb3VwLFxufSBmcm9tIFwiLi4vLi4vLi4vYmFzZS9jb3JlL29wdGlvbnMvb3B0aW9uc19yZWdpc3RyeS5tanNcIjtcblxuY29uc3QgY2l0YXRpb25PcHRpb25zR3JvdXAgPSB7XG4gIGNhdGVnb3J5OiBcImNpdGF0aW9uXCIsXG4gIHN1YmNhdGVnb3J5OiBcImdyb1wiLFxuICB0YWI6IFwiY2l0YXRpb25cIixcbiAgc3Vic2VjdGlvbjogXCJncm9cIixcbiAgb3B0aW9uczogW1xuICAgIHtcbiAgICAgIG9wdGlvbk5hbWU6IFwiY2hhbmdlTmFtZXNUb0luaXRpYWxDYXBzXCIsXG4gICAgICB0eXBlOiBcImNoZWNrYm94XCIsXG4gICAgICBsYWJlbDogXCJDaGFuZ2UgcGVyc29uIGFuZCBwbGFjZSBuYW1lcyBmcm9tIGFsbCBjYXBzIHRvIGluaXRpYWwgY2Fwc1wiLFxuICAgICAgZGVmYXVsdFZhbHVlOiB0cnVlLFxuICAgIH0sXG4gICAge1xuICAgICAgb3B0aW9uTmFtZTogXCJyZWZlcmVuY2VJbkl0YWxpY3NcIixcbiAgICAgIHR5cGU6IFwiY2hlY2tib3hcIixcbiAgICAgIGxhYmVsOiAnUHV0IHRoZSB0ZXh0IFwiR1JPIFJlZmVyZW5jZVwiIGluIGl0YWxpY3MnLFxuICAgICAgZGVmYXVsdFZhbHVlOiB0cnVlLFxuICAgIH0sXG4gICAge1xuICAgICAgb3B0aW9uTmFtZTogXCJsaW5rU3R5bGVcIixcbiAgICAgIHR5cGU6IFwic2VsZWN0XCIsXG4gICAgICBsYWJlbDogXCJMaW5rIHRvIEdSTyBzaXRlIGJ5XCIsXG4gICAgICB2YWx1ZXM6IFtcbiAgICAgICAgeyB2YWx1ZTogXCJzZWFyY2hcIiwgdGV4dDogXCJIeXBlcmxpbmsgd2l0aCBmdWxsIHNlYXJjaCBwYXJhbWV0ZXJzXCIgfSxcbiAgICAgICAgeyB2YWx1ZTogXCJpbmRleFwiLCB0ZXh0OiBcIkh5cGVybGluayB0byBjb3JyZWN0IEdSTyBpbmRleFwiIH0sXG4gICAgICAgIHsgdmFsdWU6IFwiY29udGVudFwiLCB0ZXh0OiBcIkh5cGVybGluayB0byBHUk8gY29udGVudCBzaXRlXCIgfSxcbiAgICAgICAgeyB2YWx1ZTogXCJ1cmxfY29udGVudFwiLCB0ZXh0OiBcIlZpc2libGUgVVJMIHRvIEdSTyBjb250ZW50IHNpdGVcIiB9LFxuICAgICAgXSxcbiAgICAgIGRlZmF1bHRWYWx1ZTogXCJzZWFyY2hcIixcbiAgICB9LFxuICAgIHtcbiAgICAgIG9wdGlvbk5hbWU6IFwidXNlRGlzdHJpY3RVcmxcIixcbiAgICAgIHR5cGU6IFwiY2hlY2tib3hcIixcbiAgICAgIGxhYmVsOiBcIkFkZCBhIGxpbmsgdG8gdGhlIHJlZ2lzdHJhdGlvbiBkaXN0cmljdCBwYWdlIG9uIHVrYm1kLm9yZy51a1wiLFxuICAgICAgZGVmYXVsdFZhbHVlOiB0cnVlLFxuICAgIH0sXG4gIF0sXG59O1xuXG5yZWdpc3RlclN1YnNlY3Rpb25Gb3JPcHRpb25zKFwic2VhcmNoXCIsIFwiZ3JvXCIsIFwiR1JPIChVSylcIik7XG5yZWdpc3RlclNpdGVTZWFyY2hQb3B1cE9wdGlvbnNHcm91cChcImdyb1wiLCA1LCA1KTtcblxucmVnaXN0ZXJTdWJzZWN0aW9uRm9yT3B0aW9ucyhcImNpdGF0aW9uXCIsIFwiZ3JvXCIsIFwiR1JPIChVSylcIik7XG5yZWdpc3Rlck9wdGlvbnNHcm91cChjaXRhdGlvbk9wdGlvbnNHcm91cCk7XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./extension/site/gro/core/gro_options.mjs\n");

/***/ }),

/***/ "./extension/site/gro/core/gro_uri_builder.mjs":
/*!*****************************************************!*\
  !*** ./extension/site/gro/core/gro_uri_builder.mjs ***!
  \*****************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"GroUriBuilder\": () => (/* binding */ GroUriBuilder)\n/* harmony export */ });\n/* harmony import */ var _base_core_wts_string_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../base/core/wts_string.mjs */ \"./extension/base/core/wts_string.mjs\");\n/*\nMIT License\n\nCopyright (c) 2020 Robert M Pavey\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.\n*/\n\n\n\nclass GroUriBuilder {\n  constructor() {\n    this.uri = \"https://www.gro.gov.uk/gro/content/certificates/indexes_search.asp\";\n    this.searchTermAdded = false;\n  }\n\n  addSearchTerm(string) {\n    if (string == undefined || string == \"\") {\n      return;\n    }\n    if (!this.searchTermAdded) {\n      this.uri = this.uri.concat(\"?\", string);\n      this.searchTermAdded = true;\n    } else {\n      this.uri = this.uri.concat(\"&\", string);\n    }\n  }\n\n  addSearchParameter(parameter, value) {\n    if (value == undefined || value == \"\") {\n      return;\n    }\n\n    const encodedValue = encodeURIComponent(value);\n\n    if (!this.searchTermAdded) {\n      this.uri = this.uri.concat(\"?\", parameter, \"=\", encodedValue);\n      this.searchTermAdded = true;\n    } else {\n      this.uri = this.uri.concat(\"&\", parameter, \"=\", encodedValue);\n    }\n  }\n\n  addIndex(string) {\n    this.addSearchParameter(\"index\", string);\n  }\n\n  addFirstForename(string) {\n    this.addSearchParameter(\"forename1\", _base_core_wts_string_mjs__WEBPACK_IMPORTED_MODULE_0__.WTS_String.removeExtendedAsciiCharacters(string));\n  }\n\n  addSecondForename(string) {\n    let forename2 = _base_core_wts_string_mjs__WEBPACK_IMPORTED_MODULE_0__.WTS_String.getFirstWord(string);\n    this.addSearchParameter(\"forename2\", _base_core_wts_string_mjs__WEBPACK_IMPORTED_MODULE_0__.WTS_String.removeExtendedAsciiCharacters(forename2));\n  }\n\n  addSurname(string) {\n    this.addSearchParameter(\"surname\", _base_core_wts_string_mjs__WEBPACK_IMPORTED_MODULE_0__.WTS_String.removeExtendedAsciiCharacters(string));\n  }\n\n  addMothersSurname(string) {\n    if (string != \"-\") {\n      this.addSearchParameter(\"motherssurname\", _base_core_wts_string_mjs__WEBPACK_IMPORTED_MODULE_0__.WTS_String.removeExtendedAsciiCharacters(string));\n    }\n  }\n\n  addYear(string) {\n    this.addSearchParameter(\"year\", string);\n  }\n\n  addYearRange(string) {\n    this.addSearchParameter(\"range\", string);\n  }\n\n  addAge(string) {\n    this.addSearchParameter(\"age\", string);\n  }\n\n  addAgeRange(string) {\n    this.addSearchParameter(\"agerange\", string);\n  }\n\n  addGenderMale() {\n    this.addSearchTerm(\"gender=M\");\n  }\n\n  addGenderFemale() {\n    this.addSearchTerm(\"gender=F\");\n  }\n\n  addQuarter(string) {\n    this.addSearchParameter(\"quarter\", string);\n  }\n\n  addMonth(string) {\n    this.addSearchParameter(\"month\", string);\n  }\n\n  addDistrict(string) {\n    this.addSearchParameter(\"district\", string);\n  }\n\n  addVolume(string) {\n    this.addSearchParameter(\"volume\", string);\n  }\n\n  addPage(string) {\n    this.addSearchParameter(\"page\", string);\n  }\n\n  addRegister(string) {\n    this.addSearchParameter(\"reg\", string);\n  }\n\n  getUri() {\n    return this.uri;\n  }\n}\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9leHRlbnNpb24vc2l0ZS9ncm8vY29yZS9ncm9fdXJpX2J1aWxkZXIubWpzLmpzIiwibWFwcGluZ3MiOiI7Ozs7O0FBQUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUUrRDs7QUFFL0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSx5Q0FBeUMsK0ZBQXdDO0FBQ2pGOztBQUVBO0FBQ0Esb0JBQW9CLDhFQUF1QjtBQUMzQyx5Q0FBeUMsK0ZBQXdDO0FBQ2pGOztBQUVBO0FBQ0EsdUNBQXVDLCtGQUF3QztBQUMvRTs7QUFFQTtBQUNBO0FBQ0EsZ0RBQWdELCtGQUF3QztBQUN4RjtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUV5QiIsInNvdXJjZXMiOlsid2VicGFjazovL0NpdGF0aW9uRXh0cmFjdG9yLy4vZXh0ZW5zaW9uL3NpdGUvZ3JvL2NvcmUvZ3JvX3VyaV9idWlsZGVyLm1qcz80ZWMwIl0sInNvdXJjZXNDb250ZW50IjpbIi8qXG5NSVQgTGljZW5zZVxuXG5Db3B5cmlnaHQgKGMpIDIwMjAgUm9iZXJ0IE0gUGF2ZXlcblxuUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEgY29weVxub2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGUgXCJTb2Z0d2FyZVwiKSwgdG8gZGVhbFxuaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVzdHJpY3Rpb24sIGluY2x1ZGluZyB3aXRob3V0IGxpbWl0YXRpb24gdGhlIHJpZ2h0c1xudG8gdXNlLCBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLCBkaXN0cmlidXRlLCBzdWJsaWNlbnNlLCBhbmQvb3Igc2VsbFxuY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzXG5mdXJuaXNoZWQgdG8gZG8gc28sIHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZyBjb25kaXRpb25zOlxuXG5UaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZCBpbiBhbGxcbmNvcGllcyBvciBzdWJzdGFudGlhbCBwb3J0aW9ucyBvZiB0aGUgU29mdHdhcmUuXG5cblRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCBcIkFTIElTXCIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1JcbklNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLFxuRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFXG5BVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSXG5MSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLFxuT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTiBUSEVcblNPRlRXQVJFLlxuKi9cblxuaW1wb3J0IHsgV1RTX1N0cmluZyB9IGZyb20gXCIuLi8uLi8uLi9iYXNlL2NvcmUvd3RzX3N0cmluZy5tanNcIjtcblxuY2xhc3MgR3JvVXJpQnVpbGRlciB7XG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHRoaXMudXJpID0gXCJodHRwczovL3d3dy5ncm8uZ292LnVrL2dyby9jb250ZW50L2NlcnRpZmljYXRlcy9pbmRleGVzX3NlYXJjaC5hc3BcIjtcbiAgICB0aGlzLnNlYXJjaFRlcm1BZGRlZCA9IGZhbHNlO1xuICB9XG5cbiAgYWRkU2VhcmNoVGVybShzdHJpbmcpIHtcbiAgICBpZiAoc3RyaW5nID09IHVuZGVmaW5lZCB8fCBzdHJpbmcgPT0gXCJcIikge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAoIXRoaXMuc2VhcmNoVGVybUFkZGVkKSB7XG4gICAgICB0aGlzLnVyaSA9IHRoaXMudXJpLmNvbmNhdChcIj9cIiwgc3RyaW5nKTtcbiAgICAgIHRoaXMuc2VhcmNoVGVybUFkZGVkID0gdHJ1ZTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy51cmkgPSB0aGlzLnVyaS5jb25jYXQoXCImXCIsIHN0cmluZyk7XG4gICAgfVxuICB9XG5cbiAgYWRkU2VhcmNoUGFyYW1ldGVyKHBhcmFtZXRlciwgdmFsdWUpIHtcbiAgICBpZiAodmFsdWUgPT0gdW5kZWZpbmVkIHx8IHZhbHVlID09IFwiXCIpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBlbmNvZGVkVmFsdWUgPSBlbmNvZGVVUklDb21wb25lbnQodmFsdWUpO1xuXG4gICAgaWYgKCF0aGlzLnNlYXJjaFRlcm1BZGRlZCkge1xuICAgICAgdGhpcy51cmkgPSB0aGlzLnVyaS5jb25jYXQoXCI/XCIsIHBhcmFtZXRlciwgXCI9XCIsIGVuY29kZWRWYWx1ZSk7XG4gICAgICB0aGlzLnNlYXJjaFRlcm1BZGRlZCA9IHRydWU7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMudXJpID0gdGhpcy51cmkuY29uY2F0KFwiJlwiLCBwYXJhbWV0ZXIsIFwiPVwiLCBlbmNvZGVkVmFsdWUpO1xuICAgIH1cbiAgfVxuXG4gIGFkZEluZGV4KHN0cmluZykge1xuICAgIHRoaXMuYWRkU2VhcmNoUGFyYW1ldGVyKFwiaW5kZXhcIiwgc3RyaW5nKTtcbiAgfVxuXG4gIGFkZEZpcnN0Rm9yZW5hbWUoc3RyaW5nKSB7XG4gICAgdGhpcy5hZGRTZWFyY2hQYXJhbWV0ZXIoXCJmb3JlbmFtZTFcIiwgV1RTX1N0cmluZy5yZW1vdmVFeHRlbmRlZEFzY2lpQ2hhcmFjdGVycyhzdHJpbmcpKTtcbiAgfVxuXG4gIGFkZFNlY29uZEZvcmVuYW1lKHN0cmluZykge1xuICAgIGxldCBmb3JlbmFtZTIgPSBXVFNfU3RyaW5nLmdldEZpcnN0V29yZChzdHJpbmcpO1xuICAgIHRoaXMuYWRkU2VhcmNoUGFyYW1ldGVyKFwiZm9yZW5hbWUyXCIsIFdUU19TdHJpbmcucmVtb3ZlRXh0ZW5kZWRBc2NpaUNoYXJhY3RlcnMoZm9yZW5hbWUyKSk7XG4gIH1cblxuICBhZGRTdXJuYW1lKHN0cmluZykge1xuICAgIHRoaXMuYWRkU2VhcmNoUGFyYW1ldGVyKFwic3VybmFtZVwiLCBXVFNfU3RyaW5nLnJlbW92ZUV4dGVuZGVkQXNjaWlDaGFyYWN0ZXJzKHN0cmluZykpO1xuICB9XG5cbiAgYWRkTW90aGVyc1N1cm5hbWUoc3RyaW5nKSB7XG4gICAgaWYgKHN0cmluZyAhPSBcIi1cIikge1xuICAgICAgdGhpcy5hZGRTZWFyY2hQYXJhbWV0ZXIoXCJtb3RoZXJzc3VybmFtZVwiLCBXVFNfU3RyaW5nLnJlbW92ZUV4dGVuZGVkQXNjaWlDaGFyYWN0ZXJzKHN0cmluZykpO1xuICAgIH1cbiAgfVxuXG4gIGFkZFllYXIoc3RyaW5nKSB7XG4gICAgdGhpcy5hZGRTZWFyY2hQYXJhbWV0ZXIoXCJ5ZWFyXCIsIHN0cmluZyk7XG4gIH1cblxuICBhZGRZZWFyUmFuZ2Uoc3RyaW5nKSB7XG4gICAgdGhpcy5hZGRTZWFyY2hQYXJhbWV0ZXIoXCJyYW5nZVwiLCBzdHJpbmcpO1xuICB9XG5cbiAgYWRkQWdlKHN0cmluZykge1xuICAgIHRoaXMuYWRkU2VhcmNoUGFyYW1ldGVyKFwiYWdlXCIsIHN0cmluZyk7XG4gIH1cblxuICBhZGRBZ2VSYW5nZShzdHJpbmcpIHtcbiAgICB0aGlzLmFkZFNlYXJjaFBhcmFtZXRlcihcImFnZXJhbmdlXCIsIHN0cmluZyk7XG4gIH1cblxuICBhZGRHZW5kZXJNYWxlKCkge1xuICAgIHRoaXMuYWRkU2VhcmNoVGVybShcImdlbmRlcj1NXCIpO1xuICB9XG5cbiAgYWRkR2VuZGVyRmVtYWxlKCkge1xuICAgIHRoaXMuYWRkU2VhcmNoVGVybShcImdlbmRlcj1GXCIpO1xuICB9XG5cbiAgYWRkUXVhcnRlcihzdHJpbmcpIHtcbiAgICB0aGlzLmFkZFNlYXJjaFBhcmFtZXRlcihcInF1YXJ0ZXJcIiwgc3RyaW5nKTtcbiAgfVxuXG4gIGFkZE1vbnRoKHN0cmluZykge1xuICAgIHRoaXMuYWRkU2VhcmNoUGFyYW1ldGVyKFwibW9udGhcIiwgc3RyaW5nKTtcbiAgfVxuXG4gIGFkZERpc3RyaWN0KHN0cmluZykge1xuICAgIHRoaXMuYWRkU2VhcmNoUGFyYW1ldGVyKFwiZGlzdHJpY3RcIiwgc3RyaW5nKTtcbiAgfVxuXG4gIGFkZFZvbHVtZShzdHJpbmcpIHtcbiAgICB0aGlzLmFkZFNlYXJjaFBhcmFtZXRlcihcInZvbHVtZVwiLCBzdHJpbmcpO1xuICB9XG5cbiAgYWRkUGFnZShzdHJpbmcpIHtcbiAgICB0aGlzLmFkZFNlYXJjaFBhcmFtZXRlcihcInBhZ2VcIiwgc3RyaW5nKTtcbiAgfVxuXG4gIGFkZFJlZ2lzdGVyKHN0cmluZykge1xuICAgIHRoaXMuYWRkU2VhcmNoUGFyYW1ldGVyKFwicmVnXCIsIHN0cmluZyk7XG4gIH1cblxuICBnZXRVcmkoKSB7XG4gICAgcmV0dXJuIHRoaXMudXJpO1xuICB9XG59XG5cbmV4cG9ydCB7IEdyb1VyaUJ1aWxkZXIgfTtcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./extension/site/gro/core/gro_uri_builder.mjs\n");

/***/ }),

/***/ "./extension/site/np/core/np_options.mjs":
/*!***********************************************!*\
  !*** ./extension/site/np/core/np_options.mjs ***!
  \***********************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _base_core_options_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../base/core/options/options_registry.mjs */ \"./extension/base/core/options/options_registry.mjs\");\n/*\nMIT License\n\nCopyright (c) 2020 Robert M Pavey\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.\n*/\n\n\n\nconst searchOptionsGroup = {\n  category: \"search\",\n  subcategory: \"np\",\n  tab: \"search\",\n  subsection: \"np\",\n  subheading: \"parameters\",\n  options: [],\n};\n\nconst citationOptionsGroup = {\n  category: \"citation\",\n  subcategory: \"np\",\n  tab: \"citation\",\n  subsection: \"np\",\n  options: [],\n};\n\n(0,_base_core_options_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerSubsectionForOptions)(\"search\", \"np\", \"Newspapers.com\");\n(0,_base_core_options_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerSiteSearchPopupOptionsGroup)(\"np\", 4, 4);\n// registerSubheadingForOptions(\"search\", \"np\", \"parameters\", \"Search Parameters\");\n// registerOptionsGroup(searchOptionsGroup);\n// registerSubsectionForOptions(\"citation\", \"np\", \"Newspapers.com\");\n// registerOptionsGroup(citationOptionsGroup);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9leHRlbnNpb24vc2l0ZS9ucC9jb3JlL25wX29wdGlvbnMubWpzLmpzIiwibWFwcGluZ3MiOiI7O0FBQUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQU95RDs7QUFFekQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQSxxR0FBNEI7QUFDNUIsNEdBQW1DO0FBQ25DO0FBQ0E7QUFDQTtBQUNBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vQ2l0YXRpb25FeHRyYWN0b3IvLi9leHRlbnNpb24vc2l0ZS9ucC9jb3JlL25wX29wdGlvbnMubWpzPzA5Y2QiXSwic291cmNlc0NvbnRlbnQiOlsiLypcbk1JVCBMaWNlbnNlXG5cbkNvcHlyaWdodCAoYykgMjAyMCBSb2JlcnQgTSBQYXZleVxuXG5QZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYSBjb3B5XG5vZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSBcIlNvZnR3YXJlXCIpLCB0byBkZWFsXG5pbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzXG50byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsXG5jb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXNcbmZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6XG5cblRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkIGluIGFsbFxuY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS5cblxuVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEIFwiQVMgSVNcIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUlxuSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksXG5GSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEVcbkFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVJcbkxJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sXG5PVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOIFRIRVxuU09GVFdBUkUuXG4qL1xuXG5pbXBvcnQge1xuICByZWdpc3RlclN1YnNlY3Rpb25Gb3JPcHRpb25zLFxuICByZWdpc3RlclN1YmhlYWRpbmdGb3JPcHRpb25zLFxuICByZWdpc3Rlck9wdGlvbnNHcm91cCxcbiAgcmVnaXN0ZXJTaXRlU2VhcmNoUG9wdXBPcHRpb25zR3JvdXAsXG59IGZyb20gXCIuLi8uLi8uLi9iYXNlL2NvcmUvb3B0aW9ucy9vcHRpb25zX3JlZ2lzdHJ5Lm1qc1wiO1xuXG5jb25zdCBzZWFyY2hPcHRpb25zR3JvdXAgPSB7XG4gIGNhdGVnb3J5OiBcInNlYXJjaFwiLFxuICBzdWJjYXRlZ29yeTogXCJucFwiLFxuICB0YWI6IFwic2VhcmNoXCIsXG4gIHN1YnNlY3Rpb246IFwibnBcIixcbiAgc3ViaGVhZGluZzogXCJwYXJhbWV0ZXJzXCIsXG4gIG9wdGlvbnM6IFtdLFxufTtcblxuY29uc3QgY2l0YXRpb25PcHRpb25zR3JvdXAgPSB7XG4gIGNhdGVnb3J5OiBcImNpdGF0aW9uXCIsXG4gIHN1YmNhdGVnb3J5OiBcIm5wXCIsXG4gIHRhYjogXCJjaXRhdGlvblwiLFxuICBzdWJzZWN0aW9uOiBcIm5wXCIsXG4gIG9wdGlvbnM6IFtdLFxufTtcblxucmVnaXN0ZXJTdWJzZWN0aW9uRm9yT3B0aW9ucyhcInNlYXJjaFwiLCBcIm5wXCIsIFwiTmV3c3BhcGVycy5jb21cIik7XG5yZWdpc3RlclNpdGVTZWFyY2hQb3B1cE9wdGlvbnNHcm91cChcIm5wXCIsIDQsIDQpO1xuLy8gcmVnaXN0ZXJTdWJoZWFkaW5nRm9yT3B0aW9ucyhcInNlYXJjaFwiLCBcIm5wXCIsIFwicGFyYW1ldGVyc1wiLCBcIlNlYXJjaCBQYXJhbWV0ZXJzXCIpO1xuLy8gcmVnaXN0ZXJPcHRpb25zR3JvdXAoc2VhcmNoT3B0aW9uc0dyb3VwKTtcbi8vIHJlZ2lzdGVyU3Vic2VjdGlvbkZvck9wdGlvbnMoXCJjaXRhdGlvblwiLCBcIm5wXCIsIFwiTmV3c3BhcGVycy5jb21cIik7XG4vLyByZWdpc3Rlck9wdGlvbnNHcm91cChjaXRhdGlvbk9wdGlvbnNHcm91cCk7XG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./extension/site/np/core/np_options.mjs\n");

/***/ }),

/***/ "./extension/site/scotp/core/scotp_options.mjs":
/*!*****************************************************!*\
  !*** ./extension/site/scotp/core/scotp_options.mjs ***!
  \*****************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _base_core_options_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../base/core/options/options_registry.mjs */ \"./extension/base/core/options/options_registry.mjs\");\n/*\nMIT License\n\nCopyright (c) 2020 Robert M Pavey\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.\n*/\n\n\n\nconst searchOptionsGroup = {\n  category: \"search\",\n  subcategory: \"scotp\",\n  tab: \"search\",\n  subsection: \"scotp\",\n  subheading: \"parameters\",\n  options: [\n    {\n      optionName: \"surnameSoundex\",\n      type: \"checkbox\",\n      label: \"Use 'Phonetic matching' search option for surname\",\n      defaultValue: true,\n    },\n    {\n      optionName: \"forenameSoundex\",\n      type: \"checkbox\",\n      label: \"Use 'Phonetic matching' search option for forename\",\n      defaultValue: true,\n    },\n    {\n      optionName: \"parentNameSoundex\",\n      type: \"checkbox\",\n      label: \"Use 'Phonetic matching' search option for parent names\",\n      defaultValue: true,\n    },\n    {\n      optionName: \"birthYearExactness\",\n      type: \"select\",\n      label: \"Search exactness to use for birth year\",\n      values: [\n        { value: \"auto\", text: \"Set automatically based on source\" },\n        { value: 0, text: \"Exact year only\" },\n        { value: 1, text: \"+/- 1 years\" },\n        { value: 2, text: \"+/- 2 years\" },\n        { value: 5, text: \"+/- 5 years\" },\n        { value: 10, text: \"+/- 10 years\" },\n      ],\n      defaultValue: \"auto\",\n    },\n    {\n      optionName: \"deathYearExactness\",\n      type: \"select\",\n      label: \"Search exactness to use for death year\",\n      values: [\n        { value: \"auto\", text: \"Set automatically based on source\" },\n        { value: 0, text: \"Exact year only\" },\n        { value: 1, text: \"+/- 1 years\" },\n        { value: 2, text: \"+/- 2 years\" },\n        { value: 5, text: \"+/- 5 years\" },\n        { value: 10, text: \"+/- 10 years\" },\n      ],\n      defaultValue: \"auto\",\n    },\n    {\n      optionName: \"marriageYearExactness\",\n      type: \"select\",\n      label: \"Search exactness to use for marriage year\",\n      values: [\n        { value: \"auto\", text: \"Set automatically based on source\" },\n        { value: 0, text: \"Exact year only\" },\n        { value: 1, text: \"+/- 1 years\" },\n        { value: 2, text: \"+/- 2 years\" },\n        { value: 5, text: \"+/- 5 years\" },\n        { value: 10, text: \"+/- 10 years\" },\n      ],\n      defaultValue: \"auto\",\n    },\n    {\n      optionName: \"ageExactness\",\n      type: \"select\",\n      label: \"Search exactness to use for age in census\",\n      values: [\n        { value: \"auto\", text: \"Set automatically based on source\" },\n        { value: 0, text: \"Exact year only\" },\n        { value: 1, text: \"+/- 1 years\" },\n        { value: 2, text: \"+/- 2 years\" },\n        { value: 5, text: \"+/- 5 years\" },\n        { value: 10, text: \"+/- 10 years\" },\n      ],\n      defaultValue: \"auto\",\n    },\n  ],\n};\n\nconst citationOptionsGroup = {\n  category: \"citation\",\n  subcategory: \"scotp\",\n  tab: \"citation\",\n  subsection: \"scotp\",\n  options: [\n    {\n      optionName: \"dataStyle\",\n      type: \"select\",\n      label: \"Include record data at end of citation as\",\n      values: [\n        { value: \"none\", text: \"Do not include data\" },\n        {\n          value: \"string\",\n          text: \"Sentence (fall back to list if no sentence)\",\n        },\n        { value: \"list\", text: \"List of field names/values\" },\n        { value: \"table\", text: \"Table of field names/values\" },\n      ],\n      defaultValue: \"string\",\n      unitTestValue: \"string\",\n    },\n    {\n      optionName: \"urlStyle\",\n      type: \"select\",\n      label: \"Include Scotlands People URL as\",\n      values: [\n        {\n          value: \"visible\",\n          text: \"Just https://www.scotlandspeople.gov.uk/ as a visible URL\",\n        },\n        {\n          value: \"base\",\n          text: \"Just https://www.scotlandspeople.gov.uk/ as a WikiTree external link\",\n        },\n        {\n          value: \"original\",\n          text: \"The search URL used on the page the citation was created on\",\n        },\n        {\n          value: \"created\",\n          text: \"A search URL created by Sourcer to try to just get the one correct result\",\n        },\n        {\n          value: \"best\",\n          text: \"A search URL created by Sourcer unless the current page one had only one result\",\n        },\n        {\n          value: \"short\",\n          text: \"A shorter search URL created by Sourcer that avoids the verbose search parameters\",\n        },\n      ],\n      defaultValue: \"best\",\n      unitTestValue: \"created\",\n    },\n    {\n      optionName: \"databaseTitle\",\n      type: \"select\",\n      label: \"Get the text for the database/collection title from\",\n      values: [\n        {\n          value: \"nrs\",\n          text: \"The National Records of Scotland collection name\",\n        },\n        { value: \"header\", text: \"The heading of the search results page\" },\n      ],\n      defaultValue: \"nrs\",\n      unitTestValue: \"nrs\",\n    },\n    {\n      optionName: \"urlIncludeRef\",\n      type: \"checkbox\",\n      label: \"Include a '&ref=' query in search URL. It will only have effect for Sourcer users.\",\n      defaultValue: true,\n    },\n  ],\n};\n\n(0,_base_core_options_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerSubsectionForOptions)(\"search\", \"scotp\", \"ScotlandsPeople\");\n(0,_base_core_options_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerSiteSearchPopupOptionsGroup)(\"scotp\", 7, 7);\n(0,_base_core_options_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerSubheadingForOptions)(\"search\", \"scotp\", \"parameters\", \"Search Parameters\");\n(0,_base_core_options_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerOptionsGroup)(searchOptionsGroup);\n\n(0,_base_core_options_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerSubsectionForOptions)(\"citation\", \"scotp\", \"ScotlandsPeople\");\n(0,_base_core_options_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerOptionsGroup)(citationOptionsGroup);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9leHRlbnNpb24vc2l0ZS9zY290cC9jb3JlL3Njb3RwX29wdGlvbnMubWpzLmpzIiwibWFwcGluZ3MiOiI7O0FBQUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQU95RDs7QUFFekQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVSwwREFBMEQ7QUFDcEUsVUFBVSxtQ0FBbUM7QUFDN0MsVUFBVSwrQkFBK0I7QUFDekMsVUFBVSwrQkFBK0I7QUFDekMsVUFBVSwrQkFBK0I7QUFDekMsVUFBVSxpQ0FBaUM7QUFDM0M7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVSwwREFBMEQ7QUFDcEUsVUFBVSxtQ0FBbUM7QUFDN0MsVUFBVSwrQkFBK0I7QUFDekMsVUFBVSwrQkFBK0I7QUFDekMsVUFBVSwrQkFBK0I7QUFDekMsVUFBVSxpQ0FBaUM7QUFDM0M7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVSwwREFBMEQ7QUFDcEUsVUFBVSxtQ0FBbUM7QUFDN0MsVUFBVSwrQkFBK0I7QUFDekMsVUFBVSwrQkFBK0I7QUFDekMsVUFBVSwrQkFBK0I7QUFDekMsVUFBVSxpQ0FBaUM7QUFDM0M7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVSwwREFBMEQ7QUFDcEUsVUFBVSxtQ0FBbUM7QUFDN0MsVUFBVSwrQkFBK0I7QUFDekMsVUFBVSwrQkFBK0I7QUFDekMsVUFBVSwrQkFBK0I7QUFDekMsVUFBVSxpQ0FBaUM7QUFDM0M7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVLDRDQUE0QztBQUN0RDtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1QsVUFBVSxtREFBbUQ7QUFDN0QsVUFBVSxxREFBcUQ7QUFDL0Q7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVCxVQUFVLGlFQUFpRTtBQUMzRTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBOztBQUVBLHFHQUE0QjtBQUM1Qiw0R0FBbUM7QUFDbkMscUdBQTRCO0FBQzVCLDZGQUFvQjs7QUFFcEIscUdBQTRCO0FBQzVCLDZGQUFvQiIsInNvdXJjZXMiOlsid2VicGFjazovL0NpdGF0aW9uRXh0cmFjdG9yLy4vZXh0ZW5zaW9uL3NpdGUvc2NvdHAvY29yZS9zY290cF9vcHRpb25zLm1qcz8xMDhiIl0sInNvdXJjZXNDb250ZW50IjpbIi8qXG5NSVQgTGljZW5zZVxuXG5Db3B5cmlnaHQgKGMpIDIwMjAgUm9iZXJ0IE0gUGF2ZXlcblxuUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEgY29weVxub2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGUgXCJTb2Z0d2FyZVwiKSwgdG8gZGVhbFxuaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVzdHJpY3Rpb24sIGluY2x1ZGluZyB3aXRob3V0IGxpbWl0YXRpb24gdGhlIHJpZ2h0c1xudG8gdXNlLCBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLCBkaXN0cmlidXRlLCBzdWJsaWNlbnNlLCBhbmQvb3Igc2VsbFxuY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzXG5mdXJuaXNoZWQgdG8gZG8gc28sIHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZyBjb25kaXRpb25zOlxuXG5UaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZCBpbiBhbGxcbmNvcGllcyBvciBzdWJzdGFudGlhbCBwb3J0aW9ucyBvZiB0aGUgU29mdHdhcmUuXG5cblRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCBcIkFTIElTXCIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1JcbklNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLFxuRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFXG5BVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSXG5MSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLFxuT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTiBUSEVcblNPRlRXQVJFLlxuKi9cblxuaW1wb3J0IHtcbiAgcmVnaXN0ZXJTdWJzZWN0aW9uRm9yT3B0aW9ucyxcbiAgcmVnaXN0ZXJTdWJoZWFkaW5nRm9yT3B0aW9ucyxcbiAgcmVnaXN0ZXJPcHRpb25zR3JvdXAsXG4gIHJlZ2lzdGVyU2l0ZVNlYXJjaFBvcHVwT3B0aW9uc0dyb3VwLFxufSBmcm9tIFwiLi4vLi4vLi4vYmFzZS9jb3JlL29wdGlvbnMvb3B0aW9uc19yZWdpc3RyeS5tanNcIjtcblxuY29uc3Qgc2VhcmNoT3B0aW9uc0dyb3VwID0ge1xuICBjYXRlZ29yeTogXCJzZWFyY2hcIixcbiAgc3ViY2F0ZWdvcnk6IFwic2NvdHBcIixcbiAgdGFiOiBcInNlYXJjaFwiLFxuICBzdWJzZWN0aW9uOiBcInNjb3RwXCIsXG4gIHN1YmhlYWRpbmc6IFwicGFyYW1ldGVyc1wiLFxuICBvcHRpb25zOiBbXG4gICAge1xuICAgICAgb3B0aW9uTmFtZTogXCJzdXJuYW1lU291bmRleFwiLFxuICAgICAgdHlwZTogXCJjaGVja2JveFwiLFxuICAgICAgbGFiZWw6IFwiVXNlICdQaG9uZXRpYyBtYXRjaGluZycgc2VhcmNoIG9wdGlvbiBmb3Igc3VybmFtZVwiLFxuICAgICAgZGVmYXVsdFZhbHVlOiB0cnVlLFxuICAgIH0sXG4gICAge1xuICAgICAgb3B0aW9uTmFtZTogXCJmb3JlbmFtZVNvdW5kZXhcIixcbiAgICAgIHR5cGU6IFwiY2hlY2tib3hcIixcbiAgICAgIGxhYmVsOiBcIlVzZSAnUGhvbmV0aWMgbWF0Y2hpbmcnIHNlYXJjaCBvcHRpb24gZm9yIGZvcmVuYW1lXCIsXG4gICAgICBkZWZhdWx0VmFsdWU6IHRydWUsXG4gICAgfSxcbiAgICB7XG4gICAgICBvcHRpb25OYW1lOiBcInBhcmVudE5hbWVTb3VuZGV4XCIsXG4gICAgICB0eXBlOiBcImNoZWNrYm94XCIsXG4gICAgICBsYWJlbDogXCJVc2UgJ1Bob25ldGljIG1hdGNoaW5nJyBzZWFyY2ggb3B0aW9uIGZvciBwYXJlbnQgbmFtZXNcIixcbiAgICAgIGRlZmF1bHRWYWx1ZTogdHJ1ZSxcbiAgICB9LFxuICAgIHtcbiAgICAgIG9wdGlvbk5hbWU6IFwiYmlydGhZZWFyRXhhY3RuZXNzXCIsXG4gICAgICB0eXBlOiBcInNlbGVjdFwiLFxuICAgICAgbGFiZWw6IFwiU2VhcmNoIGV4YWN0bmVzcyB0byB1c2UgZm9yIGJpcnRoIHllYXJcIixcbiAgICAgIHZhbHVlczogW1xuICAgICAgICB7IHZhbHVlOiBcImF1dG9cIiwgdGV4dDogXCJTZXQgYXV0b21hdGljYWxseSBiYXNlZCBvbiBzb3VyY2VcIiB9LFxuICAgICAgICB7IHZhbHVlOiAwLCB0ZXh0OiBcIkV4YWN0IHllYXIgb25seVwiIH0sXG4gICAgICAgIHsgdmFsdWU6IDEsIHRleHQ6IFwiKy8tIDEgeWVhcnNcIiB9LFxuICAgICAgICB7IHZhbHVlOiAyLCB0ZXh0OiBcIisvLSAyIHllYXJzXCIgfSxcbiAgICAgICAgeyB2YWx1ZTogNSwgdGV4dDogXCIrLy0gNSB5ZWFyc1wiIH0sXG4gICAgICAgIHsgdmFsdWU6IDEwLCB0ZXh0OiBcIisvLSAxMCB5ZWFyc1wiIH0sXG4gICAgICBdLFxuICAgICAgZGVmYXVsdFZhbHVlOiBcImF1dG9cIixcbiAgICB9LFxuICAgIHtcbiAgICAgIG9wdGlvbk5hbWU6IFwiZGVhdGhZZWFyRXhhY3RuZXNzXCIsXG4gICAgICB0eXBlOiBcInNlbGVjdFwiLFxuICAgICAgbGFiZWw6IFwiU2VhcmNoIGV4YWN0bmVzcyB0byB1c2UgZm9yIGRlYXRoIHllYXJcIixcbiAgICAgIHZhbHVlczogW1xuICAgICAgICB7IHZhbHVlOiBcImF1dG9cIiwgdGV4dDogXCJTZXQgYXV0b21hdGljYWxseSBiYXNlZCBvbiBzb3VyY2VcIiB9LFxuICAgICAgICB7IHZhbHVlOiAwLCB0ZXh0OiBcIkV4YWN0IHllYXIgb25seVwiIH0sXG4gICAgICAgIHsgdmFsdWU6IDEsIHRleHQ6IFwiKy8tIDEgeWVhcnNcIiB9LFxuICAgICAgICB7IHZhbHVlOiAyLCB0ZXh0OiBcIisvLSAyIHllYXJzXCIgfSxcbiAgICAgICAgeyB2YWx1ZTogNSwgdGV4dDogXCIrLy0gNSB5ZWFyc1wiIH0sXG4gICAgICAgIHsgdmFsdWU6IDEwLCB0ZXh0OiBcIisvLSAxMCB5ZWFyc1wiIH0sXG4gICAgICBdLFxuICAgICAgZGVmYXVsdFZhbHVlOiBcImF1dG9cIixcbiAgICB9LFxuICAgIHtcbiAgICAgIG9wdGlvbk5hbWU6IFwibWFycmlhZ2VZZWFyRXhhY3RuZXNzXCIsXG4gICAgICB0eXBlOiBcInNlbGVjdFwiLFxuICAgICAgbGFiZWw6IFwiU2VhcmNoIGV4YWN0bmVzcyB0byB1c2UgZm9yIG1hcnJpYWdlIHllYXJcIixcbiAgICAgIHZhbHVlczogW1xuICAgICAgICB7IHZhbHVlOiBcImF1dG9cIiwgdGV4dDogXCJTZXQgYXV0b21hdGljYWxseSBiYXNlZCBvbiBzb3VyY2VcIiB9LFxuICAgICAgICB7IHZhbHVlOiAwLCB0ZXh0OiBcIkV4YWN0IHllYXIgb25seVwiIH0sXG4gICAgICAgIHsgdmFsdWU6IDEsIHRleHQ6IFwiKy8tIDEgeWVhcnNcIiB9LFxuICAgICAgICB7IHZhbHVlOiAyLCB0ZXh0OiBcIisvLSAyIHllYXJzXCIgfSxcbiAgICAgICAgeyB2YWx1ZTogNSwgdGV4dDogXCIrLy0gNSB5ZWFyc1wiIH0sXG4gICAgICAgIHsgdmFsdWU6IDEwLCB0ZXh0OiBcIisvLSAxMCB5ZWFyc1wiIH0sXG4gICAgICBdLFxuICAgICAgZGVmYXVsdFZhbHVlOiBcImF1dG9cIixcbiAgICB9LFxuICAgIHtcbiAgICAgIG9wdGlvbk5hbWU6IFwiYWdlRXhhY3RuZXNzXCIsXG4gICAgICB0eXBlOiBcInNlbGVjdFwiLFxuICAgICAgbGFiZWw6IFwiU2VhcmNoIGV4YWN0bmVzcyB0byB1c2UgZm9yIGFnZSBpbiBjZW5zdXNcIixcbiAgICAgIHZhbHVlczogW1xuICAgICAgICB7IHZhbHVlOiBcImF1dG9cIiwgdGV4dDogXCJTZXQgYXV0b21hdGljYWxseSBiYXNlZCBvbiBzb3VyY2VcIiB9LFxuICAgICAgICB7IHZhbHVlOiAwLCB0ZXh0OiBcIkV4YWN0IHllYXIgb25seVwiIH0sXG4gICAgICAgIHsgdmFsdWU6IDEsIHRleHQ6IFwiKy8tIDEgeWVhcnNcIiB9LFxuICAgICAgICB7IHZhbHVlOiAyLCB0ZXh0OiBcIisvLSAyIHllYXJzXCIgfSxcbiAgICAgICAgeyB2YWx1ZTogNSwgdGV4dDogXCIrLy0gNSB5ZWFyc1wiIH0sXG4gICAgICAgIHsgdmFsdWU6IDEwLCB0ZXh0OiBcIisvLSAxMCB5ZWFyc1wiIH0sXG4gICAgICBdLFxuICAgICAgZGVmYXVsdFZhbHVlOiBcImF1dG9cIixcbiAgICB9LFxuICBdLFxufTtcblxuY29uc3QgY2l0YXRpb25PcHRpb25zR3JvdXAgPSB7XG4gIGNhdGVnb3J5OiBcImNpdGF0aW9uXCIsXG4gIHN1YmNhdGVnb3J5OiBcInNjb3RwXCIsXG4gIHRhYjogXCJjaXRhdGlvblwiLFxuICBzdWJzZWN0aW9uOiBcInNjb3RwXCIsXG4gIG9wdGlvbnM6IFtcbiAgICB7XG4gICAgICBvcHRpb25OYW1lOiBcImRhdGFTdHlsZVwiLFxuICAgICAgdHlwZTogXCJzZWxlY3RcIixcbiAgICAgIGxhYmVsOiBcIkluY2x1ZGUgcmVjb3JkIGRhdGEgYXQgZW5kIG9mIGNpdGF0aW9uIGFzXCIsXG4gICAgICB2YWx1ZXM6IFtcbiAgICAgICAgeyB2YWx1ZTogXCJub25lXCIsIHRleHQ6IFwiRG8gbm90IGluY2x1ZGUgZGF0YVwiIH0sXG4gICAgICAgIHtcbiAgICAgICAgICB2YWx1ZTogXCJzdHJpbmdcIixcbiAgICAgICAgICB0ZXh0OiBcIlNlbnRlbmNlIChmYWxsIGJhY2sgdG8gbGlzdCBpZiBubyBzZW50ZW5jZSlcIixcbiAgICAgICAgfSxcbiAgICAgICAgeyB2YWx1ZTogXCJsaXN0XCIsIHRleHQ6IFwiTGlzdCBvZiBmaWVsZCBuYW1lcy92YWx1ZXNcIiB9LFxuICAgICAgICB7IHZhbHVlOiBcInRhYmxlXCIsIHRleHQ6IFwiVGFibGUgb2YgZmllbGQgbmFtZXMvdmFsdWVzXCIgfSxcbiAgICAgIF0sXG4gICAgICBkZWZhdWx0VmFsdWU6IFwic3RyaW5nXCIsXG4gICAgICB1bml0VGVzdFZhbHVlOiBcInN0cmluZ1wiLFxuICAgIH0sXG4gICAge1xuICAgICAgb3B0aW9uTmFtZTogXCJ1cmxTdHlsZVwiLFxuICAgICAgdHlwZTogXCJzZWxlY3RcIixcbiAgICAgIGxhYmVsOiBcIkluY2x1ZGUgU2NvdGxhbmRzIFBlb3BsZSBVUkwgYXNcIixcbiAgICAgIHZhbHVlczogW1xuICAgICAgICB7XG4gICAgICAgICAgdmFsdWU6IFwidmlzaWJsZVwiLFxuICAgICAgICAgIHRleHQ6IFwiSnVzdCBodHRwczovL3d3dy5zY290bGFuZHNwZW9wbGUuZ292LnVrLyBhcyBhIHZpc2libGUgVVJMXCIsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICB2YWx1ZTogXCJiYXNlXCIsXG4gICAgICAgICAgdGV4dDogXCJKdXN0IGh0dHBzOi8vd3d3LnNjb3RsYW5kc3Blb3BsZS5nb3YudWsvIGFzIGEgV2lraVRyZWUgZXh0ZXJuYWwgbGlua1wiLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgdmFsdWU6IFwib3JpZ2luYWxcIixcbiAgICAgICAgICB0ZXh0OiBcIlRoZSBzZWFyY2ggVVJMIHVzZWQgb24gdGhlIHBhZ2UgdGhlIGNpdGF0aW9uIHdhcyBjcmVhdGVkIG9uXCIsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICB2YWx1ZTogXCJjcmVhdGVkXCIsXG4gICAgICAgICAgdGV4dDogXCJBIHNlYXJjaCBVUkwgY3JlYXRlZCBieSBTb3VyY2VyIHRvIHRyeSB0byBqdXN0IGdldCB0aGUgb25lIGNvcnJlY3QgcmVzdWx0XCIsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICB2YWx1ZTogXCJiZXN0XCIsXG4gICAgICAgICAgdGV4dDogXCJBIHNlYXJjaCBVUkwgY3JlYXRlZCBieSBTb3VyY2VyIHVubGVzcyB0aGUgY3VycmVudCBwYWdlIG9uZSBoYWQgb25seSBvbmUgcmVzdWx0XCIsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICB2YWx1ZTogXCJzaG9ydFwiLFxuICAgICAgICAgIHRleHQ6IFwiQSBzaG9ydGVyIHNlYXJjaCBVUkwgY3JlYXRlZCBieSBTb3VyY2VyIHRoYXQgYXZvaWRzIHRoZSB2ZXJib3NlIHNlYXJjaCBwYXJhbWV0ZXJzXCIsXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgICAgZGVmYXVsdFZhbHVlOiBcImJlc3RcIixcbiAgICAgIHVuaXRUZXN0VmFsdWU6IFwiY3JlYXRlZFwiLFxuICAgIH0sXG4gICAge1xuICAgICAgb3B0aW9uTmFtZTogXCJkYXRhYmFzZVRpdGxlXCIsXG4gICAgICB0eXBlOiBcInNlbGVjdFwiLFxuICAgICAgbGFiZWw6IFwiR2V0IHRoZSB0ZXh0IGZvciB0aGUgZGF0YWJhc2UvY29sbGVjdGlvbiB0aXRsZSBmcm9tXCIsXG4gICAgICB2YWx1ZXM6IFtcbiAgICAgICAge1xuICAgICAgICAgIHZhbHVlOiBcIm5yc1wiLFxuICAgICAgICAgIHRleHQ6IFwiVGhlIE5hdGlvbmFsIFJlY29yZHMgb2YgU2NvdGxhbmQgY29sbGVjdGlvbiBuYW1lXCIsXG4gICAgICAgIH0sXG4gICAgICAgIHsgdmFsdWU6IFwiaGVhZGVyXCIsIHRleHQ6IFwiVGhlIGhlYWRpbmcgb2YgdGhlIHNlYXJjaCByZXN1bHRzIHBhZ2VcIiB9LFxuICAgICAgXSxcbiAgICAgIGRlZmF1bHRWYWx1ZTogXCJucnNcIixcbiAgICAgIHVuaXRUZXN0VmFsdWU6IFwibnJzXCIsXG4gICAgfSxcbiAgICB7XG4gICAgICBvcHRpb25OYW1lOiBcInVybEluY2x1ZGVSZWZcIixcbiAgICAgIHR5cGU6IFwiY2hlY2tib3hcIixcbiAgICAgIGxhYmVsOiBcIkluY2x1ZGUgYSAnJnJlZj0nIHF1ZXJ5IGluIHNlYXJjaCBVUkwuIEl0IHdpbGwgb25seSBoYXZlIGVmZmVjdCBmb3IgU291cmNlciB1c2Vycy5cIixcbiAgICAgIGRlZmF1bHRWYWx1ZTogdHJ1ZSxcbiAgICB9LFxuICBdLFxufTtcblxucmVnaXN0ZXJTdWJzZWN0aW9uRm9yT3B0aW9ucyhcInNlYXJjaFwiLCBcInNjb3RwXCIsIFwiU2NvdGxhbmRzUGVvcGxlXCIpO1xucmVnaXN0ZXJTaXRlU2VhcmNoUG9wdXBPcHRpb25zR3JvdXAoXCJzY290cFwiLCA3LCA3KTtcbnJlZ2lzdGVyU3ViaGVhZGluZ0Zvck9wdGlvbnMoXCJzZWFyY2hcIiwgXCJzY290cFwiLCBcInBhcmFtZXRlcnNcIiwgXCJTZWFyY2ggUGFyYW1ldGVyc1wiKTtcbnJlZ2lzdGVyT3B0aW9uc0dyb3VwKHNlYXJjaE9wdGlvbnNHcm91cCk7XG5cbnJlZ2lzdGVyU3Vic2VjdGlvbkZvck9wdGlvbnMoXCJjaXRhdGlvblwiLCBcInNjb3RwXCIsIFwiU2NvdGxhbmRzUGVvcGxlXCIpO1xucmVnaXN0ZXJPcHRpb25zR3JvdXAoY2l0YXRpb25PcHRpb25zR3JvdXApO1xuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./extension/site/scotp/core/scotp_options.mjs\n");

/***/ }),

/***/ "./extension/site/wikitree/core/wikitree_options.mjs":
/*!***********************************************************!*\
  !*** ./extension/site/wikitree/core/wikitree_options.mjs ***!
  \***********************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _base_core_options_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../../base/core/options/options_registry.mjs */ \"./extension/base/core/options/options_registry.mjs\");\n/*\nMIT License\n\nCopyright (c) 2020 Robert M Pavey\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.\n*/\n\n\n\nconst searchOptionsGroup = {\n  category: \"search\",\n  subcategory: \"wikitree\",\n  tab: \"search\",\n  subsection: \"wikitree\",\n  subheading: \"parameters\",\n  options: [\n    {\n      optionName: \"dateExactness\",\n      type: \"select\",\n      label: \"Date range for matching\",\n      values: [\n        { value: \"auto\", text: \"Set automatically based on source\" },\n        { value: \"exactDate\", text: \"Match exact date\" },\n        { value: \"exactYear\", text: \"Match year\" },\n        { value: \"2\", text: \"+/- 2 years\" },\n        { value: \"12\", text: \"+/- 12 years\" },\n        { value: \"30\", text: \"+/- 30 years\" },\n      ],\n      defaultValue: \"auto\",\n    },\n  ],\n};\n\n(0,_base_core_options_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerSubsectionForOptions)(\"search\", \"wikitree\", \"WikiTree\");\n(0,_base_core_options_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerSiteSearchPopupOptionsGroup)(\"wikitree\", 6, 6);\n(0,_base_core_options_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerSubheadingForOptions)(\"search\", \"wikitree\", \"parameters\", \"Search Parameters\");\n(0,_base_core_options_options_registry_mjs__WEBPACK_IMPORTED_MODULE_0__.registerOptionsGroup)(searchOptionsGroup);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9leHRlbnNpb24vc2l0ZS93aWtpdHJlZS9jb3JlL3dpa2l0cmVlX29wdGlvbnMubWpzLmpzIiwibWFwcGluZ3MiOiI7O0FBQUE7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQU95RDs7QUFFekQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVSwwREFBMEQ7QUFDcEUsVUFBVSw4Q0FBOEM7QUFDeEQsVUFBVSx3Q0FBd0M7QUFDbEQsVUFBVSxpQ0FBaUM7QUFDM0MsVUFBVSxtQ0FBbUM7QUFDN0MsVUFBVSxtQ0FBbUM7QUFDN0M7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBOztBQUVBLHFHQUE0QjtBQUM1Qiw0R0FBbUM7QUFDbkMscUdBQTRCO0FBQzVCLDZGQUFvQiIsInNvdXJjZXMiOlsid2VicGFjazovL0NpdGF0aW9uRXh0cmFjdG9yLy4vZXh0ZW5zaW9uL3NpdGUvd2lraXRyZWUvY29yZS93aWtpdHJlZV9vcHRpb25zLm1qcz9iMzQxIl0sInNvdXJjZXNDb250ZW50IjpbIi8qXG5NSVQgTGljZW5zZVxuXG5Db3B5cmlnaHQgKGMpIDIwMjAgUm9iZXJ0IE0gUGF2ZXlcblxuUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEgY29weVxub2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGUgXCJTb2Z0d2FyZVwiKSwgdG8gZGVhbFxuaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVzdHJpY3Rpb24sIGluY2x1ZGluZyB3aXRob3V0IGxpbWl0YXRpb24gdGhlIHJpZ2h0c1xudG8gdXNlLCBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLCBkaXN0cmlidXRlLCBzdWJsaWNlbnNlLCBhbmQvb3Igc2VsbFxuY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzXG5mdXJuaXNoZWQgdG8gZG8gc28sIHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZyBjb25kaXRpb25zOlxuXG5UaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZCBpbiBhbGxcbmNvcGllcyBvciBzdWJzdGFudGlhbCBwb3J0aW9ucyBvZiB0aGUgU29mdHdhcmUuXG5cblRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCBcIkFTIElTXCIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1JcbklNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLFxuRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFXG5BVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSXG5MSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLFxuT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTiBUSEVcblNPRlRXQVJFLlxuKi9cblxuaW1wb3J0IHtcbiAgcmVnaXN0ZXJTdWJzZWN0aW9uRm9yT3B0aW9ucyxcbiAgcmVnaXN0ZXJTdWJoZWFkaW5nRm9yT3B0aW9ucyxcbiAgcmVnaXN0ZXJPcHRpb25zR3JvdXAsXG4gIHJlZ2lzdGVyU2l0ZVNlYXJjaFBvcHVwT3B0aW9uc0dyb3VwLFxufSBmcm9tIFwiLi4vLi4vLi4vYmFzZS9jb3JlL29wdGlvbnMvb3B0aW9uc19yZWdpc3RyeS5tanNcIjtcblxuY29uc3Qgc2VhcmNoT3B0aW9uc0dyb3VwID0ge1xuICBjYXRlZ29yeTogXCJzZWFyY2hcIixcbiAgc3ViY2F0ZWdvcnk6IFwid2lraXRyZWVcIixcbiAgdGFiOiBcInNlYXJjaFwiLFxuICBzdWJzZWN0aW9uOiBcIndpa2l0cmVlXCIsXG4gIHN1YmhlYWRpbmc6IFwicGFyYW1ldGVyc1wiLFxuICBvcHRpb25zOiBbXG4gICAge1xuICAgICAgb3B0aW9uTmFtZTogXCJkYXRlRXhhY3RuZXNzXCIsXG4gICAgICB0eXBlOiBcInNlbGVjdFwiLFxuICAgICAgbGFiZWw6IFwiRGF0ZSByYW5nZSBmb3IgbWF0Y2hpbmdcIixcbiAgICAgIHZhbHVlczogW1xuICAgICAgICB7IHZhbHVlOiBcImF1dG9cIiwgdGV4dDogXCJTZXQgYXV0b21hdGljYWxseSBiYXNlZCBvbiBzb3VyY2VcIiB9LFxuICAgICAgICB7IHZhbHVlOiBcImV4YWN0RGF0ZVwiLCB0ZXh0OiBcIk1hdGNoIGV4YWN0IGRhdGVcIiB9LFxuICAgICAgICB7IHZhbHVlOiBcImV4YWN0WWVhclwiLCB0ZXh0OiBcIk1hdGNoIHllYXJcIiB9LFxuICAgICAgICB7IHZhbHVlOiBcIjJcIiwgdGV4dDogXCIrLy0gMiB5ZWFyc1wiIH0sXG4gICAgICAgIHsgdmFsdWU6IFwiMTJcIiwgdGV4dDogXCIrLy0gMTIgeWVhcnNcIiB9LFxuICAgICAgICB7IHZhbHVlOiBcIjMwXCIsIHRleHQ6IFwiKy8tIDMwIHllYXJzXCIgfSxcbiAgICAgIF0sXG4gICAgICBkZWZhdWx0VmFsdWU6IFwiYXV0b1wiLFxuICAgIH0sXG4gIF0sXG59O1xuXG5yZWdpc3RlclN1YnNlY3Rpb25Gb3JPcHRpb25zKFwic2VhcmNoXCIsIFwid2lraXRyZWVcIiwgXCJXaWtpVHJlZVwiKTtcbnJlZ2lzdGVyU2l0ZVNlYXJjaFBvcHVwT3B0aW9uc0dyb3VwKFwid2lraXRyZWVcIiwgNiwgNik7XG5yZWdpc3RlclN1YmhlYWRpbmdGb3JPcHRpb25zKFwic2VhcmNoXCIsIFwid2lraXRyZWVcIiwgXCJwYXJhbWV0ZXJzXCIsIFwiU2VhcmNoIFBhcmFtZXRlcnNcIik7XG5yZWdpc3Rlck9wdGlvbnNHcm91cChzZWFyY2hPcHRpb25zR3JvdXApO1xuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./extension/site/wikitree/core/wikitree_options.mjs\n");

/***/ })

/******/ 	});
/************************************************************************/
/******/ 	// The module cache
/******/ 	var __webpack_module_cache__ = {};
/******/ 	
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/ 		// Check if module is in cache
/******/ 		var cachedModule = __webpack_module_cache__[moduleId];
/******/ 		if (cachedModule !== undefined) {
/******/ 			return cachedModule.exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = __webpack_module_cache__[moduleId] = {
/******/ 			// no module.id needed
/******/ 			// no module.loaded needed
/******/ 			exports: {}
/******/ 		};
/******/ 	
/******/ 		// Execute the module function
/******/ 		__webpack_modules__[moduleId](module, module.exports, __webpack_require__);
/******/ 	
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/ 	
/************************************************************************/
/******/ 	/* webpack/runtime/define property getters */
/******/ 	(() => {
/******/ 		// define getter functions for harmony exports
/******/ 		__webpack_require__.d = (exports, definition) => {
/******/ 			for(var key in definition) {
/******/ 				if(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {
/******/ 					Object.defineProperty(exports, key, { enumerable: true, get: definition[key] });
/******/ 				}
/******/ 			}
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/hasOwnProperty shorthand */
/******/ 	(() => {
/******/ 		__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/make namespace object */
/******/ 	(() => {
/******/ 		// define __esModule on exports
/******/ 		__webpack_require__.r = (exports) => {
/******/ 			if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 				Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 			}
/******/ 			Object.defineProperty(exports, '__esModule', { value: true });
/******/ 		};
/******/ 	})();
/******/ 	
/************************************************************************/
/******/ 	
/******/ 	// startup
/******/ 	// Load entry module and return exports
/******/ 	// This entry module can't be inlined because the eval-source-map devtool is used.
/******/ 	var __webpack_exports__ = __webpack_require__("./app/extract_citation.js");
/******/ 	
/******/ 	return __webpack_exports__;
/******/ })()
;
});